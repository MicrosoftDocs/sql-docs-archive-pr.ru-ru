---
title: Определение связи «многие ко многим» | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 7bebb174-148c-4cbb-a285-2f6d536a16d5
author: minewiskan
ms.author: owend
ms.openlocfilehash: fb4e18831ae23b8cf1f0702b357672f7520478a8
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87731070"
---
# <a name="defining-a-many-to-many-relationship"></a><span data-ttu-id="49cdb-102">Определение связи «многие ко многим»</span><span class="sxs-lookup"><span data-stu-id="49cdb-102">Defining a Many-to-Many Relationship</span></span>
  <span data-ttu-id="49cdb-103">При определении измерения каждый из фактов, как правило, соединяется с одним и только одним элементом измерения, в то время как отдельные элементы измерения могут быть связаны с несколькими разными фактами.</span><span class="sxs-lookup"><span data-stu-id="49cdb-103">When you define a dimension, typically each fact joins to one and only one dimension member, whereas a single dimension member can be associated with many different facts.</span></span> <span data-ttu-id="49cdb-104">Например, клиент может иметь много заказов, но каждый заказ принадлежит только одному клиенту.</span><span class="sxs-lookup"><span data-stu-id="49cdb-104">For example, each customer can have many orders but each order belongs to a single customer.</span></span> <span data-ttu-id="49cdb-105">В терминологии реляционных баз данных это называется *связью «один ко многим*».</span><span class="sxs-lookup"><span data-stu-id="49cdb-105">In relational database terminology, this is referred to as a *one-to-many relationship*.</span></span> <span data-ttu-id="49cdb-106">Однако в некоторых случаях один факт может быть соединен с несколькими элементами измерения.</span><span class="sxs-lookup"><span data-stu-id="49cdb-106">However, sometimes a single fact can join to multiple dimension members.</span></span> <span data-ttu-id="49cdb-107">В терминологии реляционных баз данных такая связь имеет название *связь "многие ко многим"*.</span><span class="sxs-lookup"><span data-stu-id="49cdb-107">In relational database terminology, this is referred to as a *many-to-many relationship*.</span></span> <span data-ttu-id="49cdb-108">Например, клиент может иметь несколько причин для совершения покупки, а причина покупки может быть связана с несколькими покупками.</span><span class="sxs-lookup"><span data-stu-id="49cdb-108">For example, a customer may have multiple reasons for making a purchase, and a purchase reason can be associated with multiple purchases.</span></span> <span data-ttu-id="49cdb-109">Соединяемая таблица используется для определения причин покупок, которые связаны с каждой покупкой.</span><span class="sxs-lookup"><span data-stu-id="49cdb-109">A join table is used to define the sales reasons that relate to each purchase.</span></span> <span data-ttu-id="49cdb-110">Измерение «Причина покупки», основанное на таких связях, будет иметь несколько элементов, связанных с одной транзакцией продажи.</span><span class="sxs-lookup"><span data-stu-id="49cdb-110">A Sales Reason dimension constructed from such relationships would then have multiple members that relate to a single sales transaction.</span></span> <span data-ttu-id="49cdb-111">Связи «многие ко многим» выводят модель измерений за пределы классической схемы «звезда» и поддерживают комплексную аналитику, когда измерения не связаны напрямую с таблицей фактов.</span><span class="sxs-lookup"><span data-stu-id="49cdb-111">Many-to-many dimensions expand the dimensional model beyond the classic star schema and support complex analytics when dimensions are not directly related to a fact table.</span></span>

 <span data-ttu-id="49cdb-112">В службах [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)]связь «многие ко многим» между измерением и группой мер определяется указанием промежуточной таблицы фактов, которая соединяется с таблицей измерения.</span><span class="sxs-lookup"><span data-stu-id="49cdb-112">In [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)], you define a many-to-many relationship between a dimension and a measure group by specifying an intermediate fact table that is joined to the dimension table.</span></span> <span data-ttu-id="49cdb-113">В свою очередь, промежуточная таблица фактов соединена с промежуточной таблицей измерения, с которой связана эта таблица фактов.</span><span class="sxs-lookup"><span data-stu-id="49cdb-113">An intermediate fact table is joined, in turn, to an intermediate dimension table to which the fact table is joined.</span></span> <span data-ttu-id="49cdb-114">Связи «многие ко многим» между промежуточной таблицей фактов, таблицами измерений в этой связи и промежуточным измерением создают связи «многие ко многим» между элементами первичных измерений и мерами группы мер, которая указана данной связью.</span><span class="sxs-lookup"><span data-stu-id="49cdb-114">The many-to-many relationships between the intermediate fact table and both the dimension tables in the relationship and the intermediate dimension creates the many-to-many relationships between members of the primary dimension and measures in the measure group that is specified by the relationship.</span></span> <span data-ttu-id="49cdb-115">Чтобы определить связь «многие ко многим» между измерением и группой мер через промежуточную группу мер, промежуточная группа мер должна иметь одно или несколько общих измерений с исходной группой мер.</span><span class="sxs-lookup"><span data-stu-id="49cdb-115">In order to define a many-to-many relationship between a dimension and a measure group through an intermediate measure group, the intermediate measure group must share one or more dimensions with the original measure group.</span></span>

 <span data-ttu-id="49cdb-116">С измерением «многие ко многим» значения суммируются отдельно, что означает, что они не вычисляются более одного раза для элемента «Все».</span><span class="sxs-lookup"><span data-stu-id="49cdb-116">With a many-to-many dimension, values are distinct summed, which means that they do not aggregate more than once to the All member.</span></span>

> [!NOTE]
>  <span data-ttu-id="49cdb-117">Для поддержки связи измерения «многие ко многим» в представлении источника данных должно быть определено отношение «первичный ключ — внешний ключ» между всеми задействованными таблицами.</span><span class="sxs-lookup"><span data-stu-id="49cdb-117">In order to support a many-to-many dimension relationship, a primary key-foreign key relationship must be defined in the data source view between all the tables that are involved.</span></span> <span data-ttu-id="49cdb-118">В обратном случае будет невозможно выбрать верную промежуточную группу мер при определении связи на вкладке **Использование измерений** конструктора кубов.</span><span class="sxs-lookup"><span data-stu-id="49cdb-118">Otherwise, you will not be able to select the correct intermediate measure group when you establish the relationship in the **Dimension Usage** tab of Cube Designer.</span></span>

 <span data-ttu-id="49cdb-119">Дополнительные сведения см. в разделах [Связи измерений](multidimensional-models-olap-logical-cube-objects/dimension-relationships.md)и [Определение связей "многие ко многим" и свойств связей "многие ко многим"](multidimensional-models/define-a-many-to-many-relationship-and-many-to-many-relationship-properties.md).</span><span class="sxs-lookup"><span data-stu-id="49cdb-119">For more information, see [Dimension Relationships](multidimensional-models-olap-logical-cube-objects/dimension-relationships.md), and [Define a Many-to-Many Relationship and Many-to-Many Relationship Properties](multidimensional-models/define-a-many-to-many-relationship-and-many-to-many-relationship-properties.md).</span></span>

 <span data-ttu-id="49cdb-120">В задачах этого раздела предстоит определить измерение Sales Reasons и группу мер Sales Reasons, а также создать связь «многие ко многим» между измерением Sales Reasons и группой мер Internet Sales через группу мер Sales Reasons.</span><span class="sxs-lookup"><span data-stu-id="49cdb-120">In the tasks in this topic, you define the Sales Reasons dimension and the Sales Reasons measure group, and you define a many-to-many relationship between the Sales Reasons dimension and the Internet Sales measure group through the Sales Reasons measure group.</span></span>

## <a name="adding-required-tables-to-the-data-source-view"></a><span data-ttu-id="49cdb-121">Добавление необходимых таблиц к представлению источника данных</span><span class="sxs-lookup"><span data-stu-id="49cdb-121">Adding Required Tables to the Data Source View</span></span>

1.  <span data-ttu-id="49cdb-122">Откройте конструктор представлений источника данных для представления источников данных **Adventure Works DW 2012** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-122">Open Data Source View Designer for the **Adventure Works DW 2012** data source view.</span></span>

2.  <span data-ttu-id="49cdb-123">Щелкните правой кнопкой мыши в любом месте панели **Организатор диаграмм** , выберите пункт **создать диаграмму**и укажите в `Internet Sales Order Reasons` качестве имени для новой диаграммы.</span><span class="sxs-lookup"><span data-stu-id="49cdb-123">Right-click anywhere in the **Diagram Organizer** pane, click **New Diagram**, and specify `Internet Sales Order Reasons` as the name for this new diagram.</span></span>

3.  <span data-ttu-id="49cdb-124">Перетащите таблицу **InternetSales** с панели **Таблицы** на панель **Диаграмма** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-124">Drag the **InternetSales** table to the **Diagram** pane from the **Tables** pane.</span></span>

4.  <span data-ttu-id="49cdb-125">Щелкните правой кнопкой мыши панель **Диаграмма** и выберите команду **Добавить или удалить таблицы**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-125">Right-click anywhere in the **Diagram** pane, and then click **Add/Remove Tables**.</span></span>

5.  <span data-ttu-id="49cdb-126">В диалоговом окне **Добавление или удаление таблиц** добавьте в список **Включенные объекты** таблицы **DimSalesReason** и **FactInternetSalesReason** , а затем нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-126">In the **Add/Remove Tables** dialog box, add the **DimSalesReason** table and the **FactInternetSalesReason** table to the **Included objects** list, and then click **OK**.</span></span>

     <span data-ttu-id="49cdb-127">Обратите внимание, что связи «первичный-внешний ключ» между задействованными таблицами устанавливаются автоматически, поскольку эти связи определяются в базовой реляционной базе данных.</span><span class="sxs-lookup"><span data-stu-id="49cdb-127">Notice that the primary key-foreign key relationships between the tables that are involved are established automatically because those relationships are defined in the underlying relational database.</span></span> <span data-ttu-id="49cdb-128">Если эти связи не определены в базовой реляционной базе данных, их следует определить в представлении источника данных.</span><span class="sxs-lookup"><span data-stu-id="49cdb-128">If these relationships were not defined in the underlying relational database, you would have to define them in the data source view.</span></span>

6.  <span data-ttu-id="49cdb-129">В меню **Формат** выберите команду **Автоматический макет**и щелкните значок **Диаграмма**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-129">On the **Format** menu, point to **Auto Layout**, and then click **Diagram**.</span></span>

7.  <span data-ttu-id="49cdb-130">В окно свойств измените свойство **FriendlyName** таблицы **DimSalesReason** на `SalesReason` , а затем измените значение свойства **FriendlyName** таблицы **FactInternetSalesReason** на `InternetSalesReason` .</span><span class="sxs-lookup"><span data-stu-id="49cdb-130">In the Properties window, change the **FriendlyName** property of the **DimSalesReason** table to `SalesReason`, and then change the **FriendlyName** property of the **FactInternetSalesReason** table to `InternetSalesReason`.</span></span>

8.  <span data-ttu-id="49cdb-131">На панели **Таблицы** разверните узел **InternetSalesReason (dbo.FactInternetSalesReason)**, щелкните столбец **SalesOrderNumber**и просмотрите в окне свойств свойство **DataType** для этого столбца данных.</span><span class="sxs-lookup"><span data-stu-id="49cdb-131">In the **Tables** pane, expand **InternetSalesReason (dbo.FactInternetSalesReason)**, click **SalesOrderNumber**, and then review the **DataType** property for this data column in the Properties window.</span></span>

     <span data-ttu-id="49cdb-132">Обратите внимание, что в качестве типа данных для столбца **SalesOrderNumber** указан тип данных string.</span><span class="sxs-lookup"><span data-stu-id="49cdb-132">Notice that the data type for the **SalesOrderNumber** column is a string data type.</span></span>

9. <span data-ttu-id="49cdb-133">Проверьте типы данных для других столбцов в `InternetSalesReason` таблице.</span><span class="sxs-lookup"><span data-stu-id="49cdb-133">Review the data types for the other columns in the `InternetSalesReason` table.</span></span>

     <span data-ttu-id="49cdb-134">Обратите внимание, что для остальных двух столбцов этой таблицы указаны числовые типы данных.</span><span class="sxs-lookup"><span data-stu-id="49cdb-134">Notice that the data types for the other two columns in this table are numeric data types.</span></span>

10. <span data-ttu-id="49cdb-135">На панели **Таблицы** щелкните правой кнопкой мыши таблицу **InternetSalesReason (dbo.FactInternetSalesReason)** и выберите пункт **Просмотр данных**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-135">In the **Tables** pane, right-click **InternetSalesReason (dbo.FactInternetSalesReason)**, and then click **Explore Data**.</span></span>

     <span data-ttu-id="49cdb-136">Обратите внимание, что для каждого номера строки каждого заказа значение ключа указывает причину покупки данной позиции линии, как показано на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="49cdb-136">Notice that, for each line number within each order, a key value identifies the sales reason for the purchase of that line item, as shown in the following image.</span></span>

     <span data-ttu-id="49cdb-137">![Ключевое значение, определяющее причину продажи](../../2014/tutorials/media/l5-many-to-many-1.gif "Ключевое значение, определяющее причину продажи")</span><span class="sxs-lookup"><span data-stu-id="49cdb-137">![Key value to identify sales reason for purchases](../../2014/tutorials/media/l5-many-to-many-1.gif "Key value to identify sales reason for purchases")</span></span>

## <a name="defining-the-intermediate-measure-group"></a><span data-ttu-id="49cdb-138">Определение промежуточной группы мер</span><span class="sxs-lookup"><span data-stu-id="49cdb-138">Defining the Intermediate Measure Group</span></span>

1.  <span data-ttu-id="49cdb-139">Переключитесь в конструктор кубов на куб [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial и откройте вкладку **Структура куба** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-139">Switch to Cube Designer for the [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial cube, and then click the **Cube Structure** tab.</span></span>

2.  <span data-ttu-id="49cdb-140">Щелкните правой кнопкой мыши панель **Меры** и выберите команду **Создать группу мер**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-140">Right-click anywhere in the **Measures** pane, and then click **New Measure Group**.</span></span> <span data-ttu-id="49cdb-141">Дополнительные сведения см. в разделе [Создание мер и групп мер в многомерных моделях](multidimensional-models/create-measures-and-measure-groups-in-multidimensional-models.md).</span><span class="sxs-lookup"><span data-stu-id="49cdb-141">For more information, see [Create Measures and Measure Groups in Multidimensional Models](multidimensional-models/create-measures-and-measure-groups-in-multidimensional-models.md).</span></span>

3.  <span data-ttu-id="49cdb-142">В диалоговом окне **Создание группы мер** выберите `InternetSalesReason` в списке **представление источника данных пункт выберите таблицу** и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-142">In the **New Measure Group** dialog box, select `InternetSalesReason` in the **Select a table from the data source view** list, and then click **OK**.</span></span>

     <span data-ttu-id="49cdb-143">Обратите внимание, что на панели **Меры** теперь отображается группа мер **Internet Sales Reason** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-143">Notice that the **Internet Sales Reason** measure group now appears in the **Measures** pane.</span></span>

4.  <span data-ttu-id="49cdb-144">Разверните группу мер **Internet Sales Reason** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-144">Expand the **Internet Sales Reason** measure group.</span></span>

     <span data-ttu-id="49cdb-145">Обратите внимание, что для этой группы мер определена единственная мера, **Internet Sales Reason Count** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-145">Notice that only a single measure is defined for this new measure group, the **Internet Sales Reason Count** measure.</span></span>

5.  <span data-ttu-id="49cdb-146">Выберите меру **Internet Sales Reason Count** и просмотрите свойства этой меры в окне свойств.</span><span class="sxs-lookup"><span data-stu-id="49cdb-146">Select **Internet Sales Reason Count** and review the properties of this measure in the Properties window.</span></span>

     <span data-ttu-id="49cdb-147">Обратите внимание, что свойство **AggregateFunction** для этой меры определено как **Число** , а не **Сумма**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-147">Notice that the **AggregateFunction** property for this measure is defined as **Count** instead of **Sum**.</span></span> [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)]<span data-ttu-id="49cdb-148">выбрать **число** , поскольку базовый тип данных является строковым типом данных.</span><span class="sxs-lookup"><span data-stu-id="49cdb-148">chose **Count** because the underlying data type is a string data type.</span></span> <span data-ttu-id="49cdb-149">Другие два столбца в базовой таблице фактов не были выделены как меры, поскольку в службах [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] они определены как числовые ключи, а не фактические меры.</span><span class="sxs-lookup"><span data-stu-id="49cdb-149">The other two columns in the underlying fact table were not selected as measures because [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] detected them as numeric keys instead of as actual measures.</span></span> <span data-ttu-id="49cdb-150">Дополнительные сведения см. в разделе [Определение полуаддитивного режима](multidimensional-models/define-semiadditive-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="49cdb-150">For more information, see [Define Semiadditive Behavior](multidimensional-models/define-semiadditive-behavior.md).</span></span>

6.  <span data-ttu-id="49cdb-151">В окне «Свойства» измените значение свойства **Visible** меры **Internet Sales Reason Count** на **False**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-151">In the Properties window, change the **Visible** property of the **Internet Sales Reason Count** measure to **False**.</span></span>

     <span data-ttu-id="49cdb-152">Эта мера будет использована только для соединения измерения Sales Reason, которое предстоит определить после группы мер Internet Sales.</span><span class="sxs-lookup"><span data-stu-id="49cdb-152">This measure will only be used to join the Sales Reason dimension that you will define next to the Internet Sales measure group.</span></span> <span data-ttu-id="49cdb-153">Пользователи не смогут просматривать эту меру.</span><span class="sxs-lookup"><span data-stu-id="49cdb-153">Users will not browse this measure directly.</span></span>

     <span data-ttu-id="49cdb-154">На следующем рисунке демонстрируются свойства меры **Internet Sales Reason Count** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-154">The following image shows the properties for the **Internet Sales Reason Count** measure.</span></span>

     <span data-ttu-id="49cdb-155">![Свойства меры Internet Sales Reason Count](../../2014/tutorials/media/l5-many-to-many-2.gif "Свойства меры Internet Sales Reason Count")</span><span class="sxs-lookup"><span data-stu-id="49cdb-155">![Properties for Internet Sales Reason Count measure](../../2014/tutorials/media/l5-many-to-many-2.gif "Properties for Internet Sales Reason Count measure")</span></span>

## <a name="defining-the-many-to-many-dimension"></a><span data-ttu-id="49cdb-156">Определение измерения «многие ко многим»</span><span class="sxs-lookup"><span data-stu-id="49cdb-156">Defining the Many-to-Many Dimension</span></span>

1.  <span data-ttu-id="49cdb-157">В обозреватель решений щелкните правой кнопкой мыши элемент **измерения**и выберите пункт **создать измерение**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-157">In Solution Explorer, right-click **Dimensions**, and then click **New Dimension**.</span></span>

2.  <span data-ttu-id="49cdb-158">На странице **Вас приветствует мастер измерений** нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-158">On the **Welcome to the Dimension Wizard** page, click **Next**.</span></span>

3.  <span data-ttu-id="49cdb-159">На странице **Выбор метода создания** выберите параметр **Использовать существующую таблицу** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-159">On the **Select Creation Method** page, verify that the **Use an existing table** option is selected, and then click **Next**.</span></span>

4.  <span data-ttu-id="49cdb-160">На странице **Определение исходных сведений** убедитесь, что выбрано представление источника данных [!INCLUDE[ssSampleDBCoShort](../includes/sssampledbcoshort-md.md)] DW 2012.</span><span class="sxs-lookup"><span data-stu-id="49cdb-160">On the **Specify Source Information** page, verify that the [!INCLUDE[ssSampleDBCoShort](../includes/sssampledbcoshort-md.md)] DW 2012 data source view is selected.</span></span>

5.  <span data-ttu-id="49cdb-161">В списке **Основная таблица** выберите `SalesReason` .</span><span class="sxs-lookup"><span data-stu-id="49cdb-161">In the **Main table** list, select `SalesReason`.</span></span>

6.  <span data-ttu-id="49cdb-162">Убедитесь, что в списке **Ключевые столбцы** присутствует столбец **SalesReasonKey** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-162">In the **Key columns** list, verify that **SalesReasonKey** is listed.</span></span>

7.  <span data-ttu-id="49cdb-163">В списке **Столбец имени** выберите **SalesReasonName**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-163">In the **Name column** list, select **SalesReasonName**.</span></span>

8.  <span data-ttu-id="49cdb-164">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-164">Click **Next**.</span></span>

9. <span data-ttu-id="49cdb-165">На странице **Выбор атрибутов измерения** атрибут **Sales Reason Key** автоматически выбран, поскольку он является ключевым.</span><span class="sxs-lookup"><span data-stu-id="49cdb-165">On the **Select Dimension Attributes** page, the **Sales Reason Key** attribute is automatically selected because it is the key attribute.</span></span> <span data-ttu-id="49cdb-166">Установите флажок рядом с атрибутом **тип причины покупки** , измените его имя на `Sales Reason Type` , а затем нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-166">Select the check box beside the **Sales Reason Reason Type** attribute, change its name to `Sales Reason Type`, and then click **Next**.</span></span>

10. <span data-ttu-id="49cdb-167">На странице **Завершение работы мастера** нажмите кнопку **Готово** , чтобы создать измерение Sales Reason.</span><span class="sxs-lookup"><span data-stu-id="49cdb-167">On the **Completing the Wizard** page, click **Finish** to create the Sales Reason dimension.</span></span>

11. <span data-ttu-id="49cdb-168">В меню **File** (Файл) выберите команду **Save All** (Сохранить все).</span><span class="sxs-lookup"><span data-stu-id="49cdb-168">On the **File** menu, click **Save All**.</span></span>

12. <span data-ttu-id="49cdb-169">На панели **атрибуты** конструктора измерений для измерения « **Причина покупки** » выберите **ключ «причина покупки**», а затем измените значение свойства **Name** в окно свойств на`Sales Reason.`</span><span class="sxs-lookup"><span data-stu-id="49cdb-169">In the **Attributes** pane of the Dimension Designer for the **Sales Reason** dimension, select **Sales Reason Key**, and then change the **Name** property in the Properties window to `Sales Reason.`</span></span>

13. <span data-ttu-id="49cdb-170">На панели **иерархии** в конструкторе измерений создайте пользовательскую иерархию **Sales reasons** , которая содержит уровень `Sales Reason Type` и **причину покупки** в указанном порядке.</span><span class="sxs-lookup"><span data-stu-id="49cdb-170">In the **Hierarchies** pane of the Dimension Designer, create a **Sales Reasons** user hierarchy that contains the `Sales Reason Type` level and the **Sales Reason** level, in that order.</span></span>

14. <span data-ttu-id="49cdb-171">В окно свойств задайте в `All Sales Reasons` качестве значения свойства **AllMemberName** иерархии Sales reasons.</span><span class="sxs-lookup"><span data-stu-id="49cdb-171">In the Properties window, define `All Sales Reasons` as the value for the **AllMemberName** property of the Sales Reasons hierarchy.</span></span>

15. <span data-ttu-id="49cdb-172">Определите в `All Sales Reasons` качестве значения свойства **AttributeAllMemberName** измерения «причина покупки».</span><span class="sxs-lookup"><span data-stu-id="49cdb-172">Define `All Sales Reasons` as the value for **AttributeAllMemberName** property of the Sales Reason dimension.</span></span>

16. <span data-ttu-id="49cdb-173">Чтобы добавить созданное измерение в куб [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial, переключитесь в **Конструктор кубов**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-173">To add the newly created dimension to the [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial cube as a cube dimension, switch to **Cube Designer**.</span></span> <span data-ttu-id="49cdb-174">На вкладке **Структура куба** щелкните правой кнопкой мыши панель **Измерения** и выберите команду **Добавить измерение куба**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-174">On the **Cube Structure** tab, right-click in the **Dimensions** pane and select **Add Cube Dimension**.</span></span>

17. <span data-ttu-id="49cdb-175">В диалоговом окне **Добавление измерения куба** выберите **Sales Reason** и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-175">In the **Add Cube Dimension** dialog box, select **Sales Reason** and then click **OK**.</span></span>

18. <span data-ttu-id="49cdb-176">В меню **File** (Файл) выберите команду **Save All** (Сохранить все).</span><span class="sxs-lookup"><span data-stu-id="49cdb-176">On the **File** menu, click **Save All**.</span></span>

## <a name="defining-the-many-to-many-relationship"></a><span data-ttu-id="49cdb-177">Определение связи «многие ко многим»</span><span class="sxs-lookup"><span data-stu-id="49cdb-177">Defining the Many to Many Relationship</span></span>

1.  <span data-ttu-id="49cdb-178">Переключитесь в конструкторе кубов на куб [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial и откройте вкладку **Использование измерений** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-178">Switch to Cube Designer for the [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial cube, and then click the **Dimension Usage** tab.</span></span>

     <span data-ttu-id="49cdb-179">Обратите внимание, что измерение **Sales Reason** имеет обычную связь, определенную группой мер **Internet Sales Reason** , но не имеет связи, определенной группами мер **Internet Sales** или **Reseller Sales** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-179">Notice that the **Sales Reason** dimension has a regular relationship defined with the **Internet Sales Reason** measure group, but has no relationship defined with the **Internet Sales** or **Reseller Sales** measure groups.</span></span> <span data-ttu-id="49cdb-180">Обратите внимание, что измерение **Подробности заказа через Интернет** имеет обычную связь, определенную измерением **Причина продажи через Интернет** , которое в свою очередь имеет **Fact Relationship** с группой мер **Internet Sales** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-180">Notice also that the **Internet Sales Order Details** dimension has a regular relationship defined with the **Internet Sales Reason** dimension, which in turn has a **Fact Relationship** with the **Internet Sales** measure group.</span></span> <span data-ttu-id="49cdb-181">Если измерение не найдено (или не найдено другое измерение со связью с обеими группами мер: **Причина покупки через Интернет** и **Продажи через Интернет** ), не получится определить связь "многие ко многим".</span><span class="sxs-lookup"><span data-stu-id="49cdb-181">If this dimension was not present (or another dimension with a relationship with both the **Internet Sales Reason** and the **Internet Sales** measure group were not present), you would not be able to define the many-to-many relationship.</span></span>

2.  <span data-ttu-id="49cdb-182">Щелкните ячейку на пересечении группы мер **Продажи через Интернет** и измерения **Причина покупки** , а затем нажмите кнопку обзора (**...**).</span><span class="sxs-lookup"><span data-stu-id="49cdb-182">Click the cell at the intersection of the **Internet Sales** measure group and the **Sales Reason** dimension and then click the browse button (**...**).</span></span>

3.  <span data-ttu-id="49cdb-183">В диалоговом окне **Задание связи** в списке **Выберите тип связи** укажите значение **Многие ко многим** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-183">In the **Define Relationship** dialog box, select **Many-to-Many** in the **Select relationship type** list.</span></span>

     <span data-ttu-id="49cdb-184">Требуется определить промежуточную группу мер, соединяющую измерение Sales Reason и группу мер Internet Sales.</span><span class="sxs-lookup"><span data-stu-id="49cdb-184">You have to define the intermediate measure group that connects the Sales Reason dimension to the Internet Sales measure group.</span></span>

4.  <span data-ttu-id="49cdb-185">В списке **Промежуточная группа мер** выберите значение **Internet Sales Reason**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-185">In the **Intermediate measure group** list, select **Internet Sales Reason**.</span></span>

     <span data-ttu-id="49cdb-186">На следующем рисунке отражены изменения, сделанные в диалоговом окне **Задание связи** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-186">The following image shows the changes in the **Define Relationship** dialog box.</span></span>

     <span data-ttu-id="49cdb-187">![Диалоговое окно «Задание связи»](../../2014/tutorials/media/l5-many-to-many-3.gif "Диалоговое окно «Задание связи»")</span><span class="sxs-lookup"><span data-stu-id="49cdb-187">![Define Relationship dialog box](../../2014/tutorials/media/l5-many-to-many-3.gif "Define Relationship dialog box")</span></span>

5.  <span data-ttu-id="49cdb-188">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-188">Click **OK**.</span></span>

     <span data-ttu-id="49cdb-189">Обратите внимание на значок «многие ко многим», который отражает связь между измерением Sales Reason и группой мер Internet Sales.</span><span class="sxs-lookup"><span data-stu-id="49cdb-189">Notice the many-to-many icon that represents the relationship between the Sales Reason dimension and the Internet Sales measure group.</span></span>

## <a name="browsing-the-cube-and-the-many-to-many-dimension"></a><span data-ttu-id="49cdb-190">Просмотр куба и измерения «многие ко многим»</span><span class="sxs-lookup"><span data-stu-id="49cdb-190">Browsing the Cube and the Many-to-Many Dimension</span></span>

1.  <span data-ttu-id="49cdb-191">В меню **Сборка** выберите команду **Развернуть Analysis Services Tutorial**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-191">On the **Build** menu, click **Deploy Analysis Services Tutorial**.</span></span>

2.  <span data-ttu-id="49cdb-192">После успешного завершения развертывания перейдите на вкладку **Браузер** в конструкторе кубов [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial и нажмите кнопку **Повторное соединение**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-192">When deployment has successfully completed, switch to the **Browser** tab in Cube Designer for the [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] Tutorial cube, and then click **Reconnect**.</span></span>

3.  <span data-ttu-id="49cdb-193">В область данных панели "Данные" добавьте меру **Продажи через Интернет — объем продаж** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-193">Add the **Internet Sales-Sales Amount** measure to the data area of the data pane.</span></span>

4.  <span data-ttu-id="49cdb-194">Добавьте определенную пользователем иерархию **Причины покупки** из измерения **Причина покупки** в область строк панели данных.</span><span class="sxs-lookup"><span data-stu-id="49cdb-194">Add the **Sales Reasons** user-defined hierarchy from the **Sales Reason** dimension to the row area of the data pane.</span></span>

5.  <span data-ttu-id="49cdb-195">На панели метаданных разверните узлы **Заказчик**, **Расположение**, **География заказчика**, **Члены**, **Все заказчики**, **Австралия**, щелкните правой кнопкой мыши элемент **Квинсленд**и выберите команду **Добавить в фильтр**.</span><span class="sxs-lookup"><span data-stu-id="49cdb-195">In the metadata pane, expand **Customer**, expand **Location**, expand **Customer Geography**, expand **Members**, expand **All Customers**, expand **Australia**, right-click **Queensland**, and then click **Add to Filter**.</span></span>

6.  <span data-ttu-id="49cdb-196">Разверните каждый элемент уровня, `Sales Reason Type` чтобы проверить значения в долларах, связанные с каждой из причин, по которым клиент в Квинсленд дал заявку на покупку [!INCLUDE[ssSampleDBCoShort](../includes/sssampledbcoshort-md.md)] продукта через Интернет.</span><span class="sxs-lookup"><span data-stu-id="49cdb-196">Expand each member of the `Sales Reason Type` level to review the dollar values that are associated with each reason a customer in Queensland gave for their purchase of an [!INCLUDE[ssSampleDBCoShort](../includes/sssampledbcoshort-md.md)] product over the Internet.</span></span>

     <span data-ttu-id="49cdb-197">Обратите внимание, что итоговые суммы по каждой из причин покупки в совокупности больше, чем общая сумма продаж.</span><span class="sxs-lookup"><span data-stu-id="49cdb-197">Notice that the totals that are associated with each sales reason add up to more than the total sales.</span></span> <span data-ttu-id="49cdb-198">Это вызвано тем, что некоторые заказчики указали несколько причин покупки.</span><span class="sxs-lookup"><span data-stu-id="49cdb-198">This is because some customers cited multiple reasons for their purchase.</span></span>

     <span data-ttu-id="49cdb-199">На следующем рисунке показаны панели конструктора кубов **Фильтр** и **Данные** .</span><span class="sxs-lookup"><span data-stu-id="49cdb-199">The following image shows the **Filter** pane and **Data** pane of Cube Designer.</span></span>

     <span data-ttu-id="49cdb-200">![Панели «Фильтр» и «Данные» конструктора кубов](../../2014/tutorials/media/l5-many-to-many-5.gif "Панели «Фильтр» и «Данные» конструктора кубов")</span><span class="sxs-lookup"><span data-stu-id="49cdb-200">![Filter and Data panes of Cube Designer](../../2014/tutorials/media/l5-many-to-many-5.gif "Filter and Data panes of Cube Designer")</span></span>

## <a name="next-task-in-lesson"></a><span data-ttu-id="49cdb-201">Следующая задача занятия</span><span class="sxs-lookup"><span data-stu-id="49cdb-201">Next Task in Lesson</span></span>
 [<span data-ttu-id="49cdb-202">Определение степени гранулярности измерения в группе мер</span><span class="sxs-lookup"><span data-stu-id="49cdb-202">Defining Dimension Granularity within a Measure Group</span></span>](lesson-5-4-defining-dimension-granularity-within-a-measure-group.md)

## <a name="see-also"></a><span data-ttu-id="49cdb-203">См. также:</span><span class="sxs-lookup"><span data-stu-id="49cdb-203">See Also</span></span>
 <span data-ttu-id="49cdb-204">[Работа с диаграммами в конструкторе представлений источников данных &#40;Analysis Services&#41;](multidimensional-models/work-with-diagrams-in-data-source-view-designer-analysis-services.md) [связи измерений](multidimensional-models-olap-logical-cube-objects/dimension-relationships.md) [определяют связь "многие ко многим" и свойства связи](multidimensional-models/define-a-many-to-many-relationship-and-many-to-many-relationship-properties.md) "многие ко многим"</span><span class="sxs-lookup"><span data-stu-id="49cdb-204">[Work with Diagrams in Data Source View Designer &#40;Analysis Services&#41;](multidimensional-models/work-with-diagrams-in-data-source-view-designer-analysis-services.md) [Dimension Relationships](multidimensional-models-olap-logical-cube-objects/dimension-relationships.md) [Define a Many-to-Many Relationship and Many-to-Many Relationship Properties](multidimensional-models/define-a-many-to-many-relationship-and-many-to-many-relationship-properties.md)</span></span>


