---
title: Операции с журналом в Analysis Services | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: aa1db060-95dc-4198-8aeb-cffdda44b140
author: minewiskan
ms.author: owend
ms.openlocfilehash: 95d0e41576e449ab10b243ef49cbe283940afe0b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87666260"
---
# <a name="log-operations-in-analysis-services"></a>Журнал операций в службах Analysis Services
  Экземпляр Analysis Services будет регистрировать уведомления сервера, ошибки и предупреждения в файле msmdsrv. log — по одному для каждого устанавливаемого экземпляра. Администраторы обращаются к этому журналу для анализа как обычных, так и непредвиденных событий. В последних версиях ведение журнала было усовершенствовано, чтобы собирать больше сведений. Записи журнала теперь включают сведения о версии и выпуске продукта, а также о процессоре, памяти, подключении и событиях блокировки. Список всех изменений можно просмотреть в разделе [Улучшения ведения журнала](https://support.microsoft.com/kb/2965035).  
  
 Помимо встроенного ведения журнала, многие администраторы и разработчики используют средства, предоставляемые сообществом служб Analysis Services для сбора данных об операциях сервера, например **ASTrace**. Ссылки на загрузки вы найдете здесь: [Примеры для служб аналитики, предоставленные сообществом Microsoft SQL Server](https://sqlsrvanalysissrvcs.codeplex.com/) .  
  
 Этот раздел состоит из следующих подразделов.  
  
-   [Расположение и типы журналов](#bkmk_location)  
  
-   [Общие сведения о параметрах конфигурации файла журнала](#bkmk_general)  
  
-   [Файл журнала службы MSMDSRV](#bkmk_msmdsrv)  
  
-   [Журналы запросов](#bkmk_querylog)  
  
-   [Файлы мини-дампа (*.mdmp)](#bkmk_mdmp)  
  
-   [Советы и рекомендации](#bkmk_tips)  
  
> [!NOTE]  
>  Если необходимы дополнительные сведения о ведении журнала, узнайте об операциях трассировки, показывающих пути выполнения запросов и обработки. Объекты трассировки для динамической и длительной трассировки (например, аудит доступа к кубу), а также рекомендации о том, как лучше использовать "черный ящик", приложения SQL Server Profiler и xEvents, можно найти по ссылкам на этой странице: [Наблюдение за экземпляром служб Analysis Services](monitor-an-analysis-services-instance.md).  
  
##  <a name="location-and-types-of-logs"></a><a name="bkmk_location"></a>Расположение и типы журналов  
 Службы Analysis Services предоставляют журналы, описанные ниже.  
  
|Имя файла или расположение|Type|Используется для|По умолчанию включено|  
|---------------------------|----------|--------------|-------------------|  
|Msmdsrv.log|Журнал ошибок|Постоянное наблюдение и устранение основных неполадок|Да|  
|Таблица OlapQueryLog реляционной базы данных|Журнал запросов|Сбор входных данных для мастера оптимизации использования|Нет|  
|\<guid>Файлы файлы sqldmp. mdmp|Сбои и исключения|Устранение серьезных неполадок|Нет|  
  
 Настоятельно рекомендуется ознакомиться со следующей ссылкой для получения дополнительных сведений, не охваченных в этом разделе. [Подсказки к начальному сбору данных от службы технической поддержки Майкрософт](https://blogs.msdn.com/b/as_emea/archive/2012/01/02/initial-data-collection-for-troubleshooting-analysis-services-issues.aspx).  
  
##  <a name="general-information-on-log-file-configuration-settings"></a><a name="bkmk_general"></a>Общие сведения о параметрах конфигурации файла журнала  
 Разделы для каждого журнала можно найти в файле конфигурации сервера msmdsrv.ini, расположенном в папке \Program Files\Microsoft SQL Server\MSAS12.MSSQLSERVER\OLAP\Config. Инструкции по изменению файла см. в разделе [Configure Server Properties in Analysis Services](../server-properties/server-properties-in-analysis-services.md) .  
  
 По возможности рекомендуется задать свойства ведения журнала на странице свойств сервера Management Studio. Тем не менее иногда необходимо изменить файл msmdsrv.ini непосредственно для настройки параметров, которые не отображаются в средствах администрирования.  
  
 ![Раздел файла конфигурации, показывающий параметры журнала](../media/ssas-logfilesettings.png "Раздел файла конфигурации, показывающий параметры журнала")  
  
##  <a name="msmdsrv-service-log-file"></a><a name="bkmk_msmdsrv"></a>Файл журнала службы MSMDSRV  
 Службы Analysis Services записывают операции сервера в файл msmdsrv.log, по одному на экземпляр, расположенный в папке \Program files\Microsoft SQL Server\\<экземпляр\>\Olap\Log.  
  
 Этот файл журнала очищается при каждом перезапуске службы. В предыдущих выпусках администраторы иногда перезапускали службу с единственной целью очистить файл журнала, прежде чем он станет настолько большим, что его нельзя будет использовать. Это больше не требуется. Параметры конфигурации, появившиеся с выходом в SQL Server 2012 с пакетом обновления 2 (SP2) и более поздних версий, позволяют управлять размером файла журнала и его историей:  
  
-   `MaxFileSizeMB` определяет максимальный размер файла журнала в мегабайтах. Значение по умолчанию равно 256. Допустимое замещающее значение должно быть положительным целым числом. Когда будет достигнут размер `MaxFileSizeMB`, службы Analysis Services переименовывают текущий файл в msmdsrv{текущая_отметка_времени}.log и начинают новый файл msmdsrv.log.  
  
-   `MaxNumberFiles`Задает хранение старых файлов журнала. Значение по умолчанию равно 0 (отключено). Его можно изменить на положительное целое число, чтобы хранить версии файла журнала. Когда будет достигнуто `MaxNumberFiles`, службы Analysis Services удаляют файл с самой старой отметкой времени в имени.  
  
 Чтобы использовать эти параметры, выполните следующие действия:  
  
1.  Откройте msmdsrv.ini в блокноте.  
  
2.  Скопируйте следующие две строки:  
  
    ```  
    <MaxFileSizeMB>256</MaxFileSizeMB>  
    <MaxNumberOfLogFiles>5</MaxNumberOfLogFiles>  
    ```  
  
3.  Вставьте две строки в раздел Log msmdsrv.ini под именем файла для msmdsrv.log. Оба параметра необходимо добавить вручную. В файле msmdsrv.ini для них не существует заполнителей.  
  
     Измененный файл конфигурации должен выглядеть следующим образом:  
  
    ```  
    <Log>  
    <File>msmdsrv.log</File>  
    <MaxFileSizeMB>256</MaxFileSizeMB>  
    <MaxNumberOfLogFiles>5</MaxNumberOfLogFiles>  
    <FileBufferSize>0</FileBufferSize>  
  
    ```  
  
4.  Измените значения, если описанные выше отличаются от необходимых.  
  
5.  Сохраните файл.  
  
6.  Перезапустите службу.  
  
##  <a name="query-logs"></a><a name="bkmk_querylog"></a>Журналы запросов  
 Журнал запросов — немного неверное название, в том смысле, что он не регистрирует действия пользователей, связанные с запросами MDX или DAX. Вместо этого он собирает данные о запросах, сформированные службами Analysis Services, которые впоследствии используются в качестве входных данных в мастере оптимизации с учетом использования. Данные, собранные в журнале запросов, не предназначены для прямого анализа. В частности, наборы данных описаны в битовых массивах, при этом ноль или один указывают на части набора данных, включенные в запрос. Эти данные тоже предназначены для мастера.  
  
 Для мониторинга и устранения неполадок запросов многие разработчики и администраторы используют средство сообщества **ASTrace**. Также можно использовать приложение SQL Server Profiler, xEvents или трассировку служб Analysis Services. Ссылки, связанные с трассировкой, см. в разделе [Наблюдение за экземпляром служб Analysis Services](monitor-an-analysis-services-instance.md) .  
  
 Когда следует использовать журнал запросов Рекомендуется включить журнал запросов как часть процедуры по настройке производительности запросов, включающей мастер оптимизации с учетом использования. Журнал запросов не существует, пока не включен компонент, не создана поддерживающая структура данных и не заданы свойства, используемые службами Analysis Services для обнаружения и заполнения журнала.  
  
 Чтобы включить журнал запросов, выполните следующие действия.  
  
1.  Создайте реляционную базу данных SQL Server для хранения журнала запросов.  
  
2.  Предоставьте учетной записи службы Analysis Services достаточно разрешений в базе данных. Учетной записи необходимо предоставить разрешение на создание таблицы, записи в таблицу и считывания из таблицы.  
  
3.  В SQL Server Management Studio щелкните правой кнопкой мыши **Analysis Services**  |  **Свойства**  |  **Общие**, установите для **CreateQueryLogTable** значение true.  
  
4.  При необходимости измените **QueryLogSampling** или **QueryLogTableName** , если необходимо собирать образцы запросов с другой скоростью или использовать другое имя для таблицы.  
  
 Таблица журнала запросов не будет создана, пока не выполнится достаточно запросов многомерных выражений для соответствия требованиям выборки. Например, если оставить значение по умолчанию 10, то необходимо запустить по крайней мере 10 запросов, прежде чем таблица будет создана.  
  
 Параметры журнала запросов применяются ко всему серверу. Указанные настройки будут использоваться всеми базами данных на этом сервере.  
  
 ![Параметры журнала запросов в среде Management Studio](../media/ssas-querylogsettings.png "Параметры журнала запросов в среде Management Studio")  
  
 После того как параметры конфигурации указаны, запустите запрос многомерных выражений несколько раз. Если значение выборки равно 10, запустите запрос 11 раз. Убедитесь, что таблица создана. В среде Management Studio подключитесь к ядру реляционной СУБД, откройте папку базы данных, откройте папку **Таблицы** и убедитесь, что **OlapQueryLog** существует. Если таблица сразу не отображается, обновите содержимое папки, чтобы отобразить изменения содержимого.  
  
 Разрешите журналу запросов накопить достаточно данных для мастера оптимизации с учетом использования. Если запросы томов являются цикличными, необходимо захватить достаточно трафика, чтобы получить репрезентативный набор данных. Инструкции по запуску мастера см. в разделе [Мастер оптимизации с учетом использования](https://msdn.microsoft.com/library/ms189706.aspx) .  
  
 Дополнительные сведения о настройке журнала запросов см. в разделе [Настройка журнала запросов служб Analysis Services](https://technet.microsoft.com/library/Cc917676) . Несмотря на то что документ довольно старый, настройка журнала запросов не изменилась в последних выпусках и сведения этого раздела до сих пор актуальны.  
  
##  <a name="mini-dump-mdmp-files"></a><a name="bkmk_mdmp"></a>Файлы мини-дампа (. mdmp)  
 Файлы дампа записывают данные, используемые для анализа непредвиденных событий. Службы Analysis Services автоматически создают мини-дампы (с расширением MDMP) в ответ на сбой сервера, исключения и ошибки конфигурации. Эта функция включена, но автоматически не отправляет отчеты о сбоях.  
  
 Отчеты о сбоях настраиваются через раздел Exception в файле Msmdsrv.ini. На основе этих параметров создается файл дампа памяти. Следующий фрагмент кода показывает значения по умолчанию:  
  
```  
<Exception>  
<CreateAndSendCrashReports>1</CreateAndSendCrashReports>  
<CrashReportsFolder/>  
<SQLDumperFlagsOn>0x0</SQLDumperFlagsOn>  
<SQLDumperFlagsOff>0x0</SQLDumperFlagsOff>  
<MiniDumpFlagsOn>0x0</MiniDumpFlagsOn>  
<MiniDumpFlagsOff>0x0</MiniDumpFlagsOff>  
<MinidumpErrorList>0xC1000000, 0xC1000001, 0xC102003F, 0xC1360054, 0xC1360055</MinidumpErrorList>  
<ExceptionHandlingMode>0</ExceptionHandlingMode>  
<CriticalErrorHandling>1</CriticalErrorHandling>  
<MaxExceptions>500</MaxExceptions>  
<MaxDuplicateDumps>1</MaxDuplicateDumps>  
</Exception>  
```  
  
 **Настройка отчетов о сбоях**  
  
 Если иное не рекомендуется службой поддержки корпорации Майкрософт, большинство администраторов используют параметры по умолчанию. Эта старая статья базы знаний еще используется для предоставления инструкций по настройке файлов дампа. [Настройка служб Analysis Services для создания файлов дампа памяти](https://support.microsoft.com/kb/919711).  
  
 Наиболее вероятный параметр конфигурации, который будет изменен, — `CreateAndSendCrashReports`. Он используется, чтобы определить, будет ли создаваться файл дампа памяти.  
  
|Значение|Описание|  
|-----------|-----------------|  
|0|Отключает файл дампа памяти. Все остальные параметры в разделе Exception игнорируются.|  
|1|(По умолчанию) Включает, но не отправляет файл дампа памяти.|  
|2|Включает и автоматически отправляет отчет об ошибках в корпорацию Майкрософт.|  
  
 `CrashReportsFolder` — местоположение файлов дампа. По умолчанию MDMP-файл и связанные записи журнала можно найти в папке \Olap\Log.  
  
 `SQLDumperFlagsOn` используется для создания полного дампа. По умолчанию полные дампы памяти не включены. Для этого свойства можно задать значение `0x34`.  
  
 Дополнительные сведения см. по следующим ссылкам:  
  
-   [Углубленный анализ SQL Server с помощью мини-дампов](https://blogs.msdn.com/b/sqlcat/archive/2009/09/11/looking-deeper-into-sql-server-using-minidumps.aspx)  
  
-   [Создание файла дампа пользовательского режима](https://support.microsoft.com/kb/931673)  
  
-   [Использование служебной программы Sqldumper.exe для создания файла дампа памяти в SQL Server](https://support.microsoft.com/kb/917825)  
  
##  <a name="tips-and-best-practices"></a><a name="bkmk_tips"></a>Советы и рекомендации  
 Этот раздел содержит повторение советов, упоминаемых в этой статье.  
  
-   Настройка файла msmdsrv.log для управления размером и количеством файлов журнала msmdsrv. Параметры не включены по умолчанию, поэтому необходимо добавить их в качестве шага после выполнения установки. См. раздел [Файл журнала службы MSMDSRV](#bkmk_msmdsrv) в этой статье.  
  
-   Ознакомьтесь с этой записью блога от службы поддержки клиентов Майкрософт, чтобы узнать, какие ресурсы используются для получения сведений об операциях сервера: [Начальный сбор данных](https://blogs.msdn.com/b/as_emea/archive/2012/01/02/initial-data-collection-for-troubleshooting-analysis-services-issues.aspx)  
  
-   Используйте ASTrace2012 вместо журнала запросов, чтобы узнать, кто отправляет запросы к кубам. Журнал запросов обычно используется для ввода данных в мастер оптимизации с учетом использования, и данные, которые он записывает, не просто прочитать или интерпретировать. ASTrace2012 — это широко используемое средство сообщества, собирающее операции запросов. Ссылки для загрузки см. в разделе [Примеры сообщества Microsoft SQL Server: службы Analysis Services](https://sqlsrvanalysissrvcs.codeplex.com/).  
  
## <a name="see-also"></a>См. также:  
 [Управление экземплярами Analysis Services](analysis-services-instance-management.md)   
 [Общие сведения о мониторинге Analysis Services с помощью SQL Server Profiler](introduction-to-monitoring-analysis-services-with-sql-server-profiler.md)   
 [Настройка свойств сервера в службах Analysis Services](../server-properties/server-properties-in-analysis-services.md)  
  
  
