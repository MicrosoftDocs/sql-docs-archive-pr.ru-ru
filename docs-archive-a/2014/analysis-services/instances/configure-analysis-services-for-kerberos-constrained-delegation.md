---
title: Настройка Analysis Services для ограниченного делегирования Kerberos | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 6d751477-6bf1-48b4-8833-5a631bbe7650
author: minewiskan
ms.author: owend
ms.openlocfilehash: 03b852acb4868cd384ef34948c6aff70541638a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87731225"
---
# <a name="configure-analysis-services-for-kerberos-constrained-delegation"></a><span data-ttu-id="66365-102">Настройка служб Analysis Services для ограниченного делегирования Kerberos</span><span class="sxs-lookup"><span data-stu-id="66365-102">Configure Analysis Services for Kerberos constrained delegation</span></span>
  <span data-ttu-id="66365-103">Во время настройки служб Analysis Services для проверки подлинности Kerberos, скорее всего, потребуется добиться одного или обоих приведенных ниже результатов: олицетворения пользовательского удостоверения с помощью служб Analysis Services для доступа к данным или делегирования пользовательского удостоверения с помощью служб Analysis Services в службу более низкого уровня.</span><span class="sxs-lookup"><span data-stu-id="66365-103">When configuring Analysis Services for Kerberos authentication, you are most likely interested in achieving one or both of the following outcomes: having Analysis Services impersonate a user identity when querying data; or having Analysis Services delegate a user identity to a down-level service.</span></span> <span data-ttu-id="66365-104">У каждого сценария есть свои требования к конфигурации.</span><span class="sxs-lookup"><span data-stu-id="66365-104">Each scenario calls for slightly different configuration requirements.</span></span> <span data-ttu-id="66365-105">Для обоих сценариев необходима проверка, чтобы убедиться в правильности настройки.</span><span class="sxs-lookup"><span data-stu-id="66365-105">Both scenarios require verification to ensure configuration was done properly.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="66365-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] диспетчер конфигурации Kerberos для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** — это диагностическое средство, которое помогает расследовать проблемы Kerberos со связью при использовании [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="66365-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="66365-107">Дополнительные сведения см. в разделе [Диспетчер конфигурации Microsoft Kerberos для SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="66365-107">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
 <span data-ttu-id="66365-108">Этот раздел состоит из следующих подразделов.</span><span class="sxs-lookup"><span data-stu-id="66365-108">This topic contains the following sections:</span></span>  
  
-   [<span data-ttu-id="66365-109">Разрешение службам Analysis Services выполнять олицетворение пользовательского удостоверения</span><span class="sxs-lookup"><span data-stu-id="66365-109">Allow Analysis Services to impersonate a user identity</span></span>](#bkmk_impersonate)  
  
-   [<span data-ttu-id="66365-110">Настройка служб Analysis Services для доверенного делегирования</span><span class="sxs-lookup"><span data-stu-id="66365-110">Configure Analysis Services for trusted delegation</span></span>](#bkmk_delegate)  
  
-   [<span data-ttu-id="66365-111">Проверка олицетворенного или делегированного удостоверения</span><span class="sxs-lookup"><span data-stu-id="66365-111">Test for impersonated or delegated identity</span></span>](#bkmk_test)  
  
> [!NOTE]  
>  <span data-ttu-id="66365-112">Делегирование не требуется, если подключение к службам Analysis Services выполняется в один прыжок или в решении используются сохраненные учетные данные, предоставляемые службой SharePoint Secure Store или службами Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="66365-112">Delegation is not required if the connection to Analysis Services is a single hop, or your solution uses stored credentials provided by SharePoint Secure Store Service or Reporting Services.</span></span> <span data-ttu-id="66365-113">Если все соединения являются прямыми от Excel к базе данных служб Analysis Services либо соединениями на основе сохраняемых учетных данных, то можно использовать Kerberos (без NTLM) без необходимости настройки ограниченного делегирования.</span><span class="sxs-lookup"><span data-stu-id="66365-113">If all connections are direct connections from Excel to an Analysis Services database, or based on stored credentials, you can use Kerberos (or NTLM) without having to configure constrained delegation.</span></span>  
>   
>  <span data-ttu-id="66365-114">Ограниченное делегирование Kerberos требуется, если удостоверение пользователя должно проходить по нескольким компьютерным соединениям (называемым "двойным прыжком").</span><span class="sxs-lookup"><span data-stu-id="66365-114">Kerberos constrained delegation is required if the user identity has to flow over multiple computer connections (known as "double-hop").</span></span> <span data-ttu-id="66365-115">Если доступ к данным служб Analysis Services основан на пользовательском удостоверении и запрос соединения исходит от делегирующей службы, по контрольному списку в следующем разделе проверьте, что службы Analysis Services могут выполнить олицетворение исходного заявителя.</span><span class="sxs-lookup"><span data-stu-id="66365-115">When Analysis Services data access is contingent upon user identity, and the connection request is from a delegating service, use the checklist in the next section to ensure that Analysis Services is able to impersonate the original caller.</span></span> <span data-ttu-id="66365-116">Дополнительные сведения о потоках проверки подлинности служб Analysis Service см. в разделе [Проверка подлинности для бизнес-аналитики Майкрософт и делегирование удостоверений](https://go.microsoft.com/fwlink/?LinkID=286576).</span><span class="sxs-lookup"><span data-stu-id="66365-116">For more information about Analysis Services authentication flows, see [Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576).</span></span>  
>   
>  <span data-ttu-id="66365-117">По соображениям безопасности Майкрософт всегда рекомендует ограничивать делегирование.</span><span class="sxs-lookup"><span data-stu-id="66365-117">As a security best practice, Microsoft always recommends constrained delegation over unconstrained delegation.</span></span> <span data-ttu-id="66365-118">Неограниченное делегирование представляет большую угрозу безопасности, поскольку оно позволяет удостоверению службы олицетворять другого пользователя на *любом* нижестоящем компьютере, в службе или приложении (по сравнению со службами, явно определенными при ограниченном делегировании).</span><span class="sxs-lookup"><span data-stu-id="66365-118">Unconstrained delegation is a major security risk because it allows the service identity to impersonate another user on *any* downstream computer, service, or application (as opposed to just those services explicitly defined via constrained delegation).</span></span>  
  
##  <a name="allow-analysis-services-to-impersonate-a-user-identity"></a><a name="bkmk_impersonate"></a><span data-ttu-id="66365-119">Разрешить Analysis Services олицетворять удостоверение пользователя</span><span class="sxs-lookup"><span data-stu-id="66365-119">Allow Analysis Services to impersonate a user identity</span></span>  
 <span data-ttu-id="66365-120">Чтобы разрешить службе более высокого уровня, например службам Reporting Services, IIS или SharePoint, выполнять олицетворение пользовательского удостоверения для работы со службами Analysis Services, следует настроить ограниченное делегирование Kerberos для таких служб.</span><span class="sxs-lookup"><span data-stu-id="66365-120">To allow up-level services such as Reporting Services, IIS, or SharePoint to impersonate a user identity on Analysis Services, you must configure Kerberos constrained delegation for those services.</span></span> <span data-ttu-id="66365-121">В этом случае службы Analysis Services олицетворяют текущего пользователя с использованием удостоверения, предоставленного делегирующей службой, и возвращают результаты на основе членства пользовательского удостоверения в роли.</span><span class="sxs-lookup"><span data-stu-id="66365-121">In this scenario, Analysis Services impersonates the current user using the identity provided by the delegating service, returning results based on role membership of that user identity.</span></span>  
  
|<span data-ttu-id="66365-122">Задача</span><span class="sxs-lookup"><span data-stu-id="66365-122">Task</span></span>|<span data-ttu-id="66365-123">Описание</span><span class="sxs-lookup"><span data-stu-id="66365-123">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="66365-124">Этап 1. Убедитесь, что учетные записи подходят для делегирования</span><span class="sxs-lookup"><span data-stu-id="66365-124">Step 1: Verify that accounts are suitable for delegation</span></span>|<span data-ttu-id="66365-125">Убедитесь, что учетные записи, используемые для запуска служб, имеют необходимые свойства в Active Directory.</span><span class="sxs-lookup"><span data-stu-id="66365-125">Ensure that the accounts used to run the services have the correct properties in Active Directory.</span></span> <span data-ttu-id="66365-126">Учетные записи службы в Active Directory должны быть отмечены как критические учетные записи или исключены явным образом из сценариев делегирования.</span><span class="sxs-lookup"><span data-stu-id="66365-126">Service accounts in Active Directory must not be marked as sensitive accounts, or specifically excluded from delegation scenarios.</span></span> <span data-ttu-id="66365-127">Дополнительные сведения см. в разделе [Основные сведения об учетных записях пользователей](https://go.microsoft.com/fwlink/?LinkId=235818).</span><span class="sxs-lookup"><span data-stu-id="66365-127">For more information, see [Understanding User Accounts](https://go.microsoft.com/fwlink/?LinkId=235818).</span></span><br /><br /> <span data-ttu-id="66365-128">Важно. обычно все учетные записи и серверы должны принадлежать к одному домену Active Directory или к доверенным доменам в одном лесу. \*\* \* \* \* \* \*\*</span><span class="sxs-lookup"><span data-stu-id="66365-128">**\*\* Important \*\*** Generally, all accounts and servers must belong to the same Active Directory domain or to trusted domains in the same forest.</span></span> <span data-ttu-id="66365-129">Но поскольку Windows Server 2012 поддерживает делегирование через across границы домена, можно настроить ограниченное делегирование Kerberos через границы домена, если домен имеет функциональный уровень Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="66365-129">However, because Windows Server 2012 supports delegation across domain boundaries, you can configure Kerberos constrained delegation across a domain boundary if the domain functional level is Windows Server 2012.</span></span> <span data-ttu-id="66365-130">Другой вариант — настроить службы Analysis Services для доступа по HTTP-протоколу и использовать методы проверки подлинности служб IIS через клиентское соединение.</span><span class="sxs-lookup"><span data-stu-id="66365-130">Another alternative is to configure Analysis Services for HTTP access and use IIS authentication methods on the client connection.</span></span> <span data-ttu-id="66365-131">Дополнительные сведения см. в разделе [Настройка HTTP-доступа к службам Analysis Services в службах Internet Information Services (IIS) 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span><span class="sxs-lookup"><span data-stu-id="66365-131">For more information, see [Configure HTTP Access to Analysis Services on Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span></span>|  
|<span data-ttu-id="66365-132">Этап 2. Регистрация имени участника-службы</span><span class="sxs-lookup"><span data-stu-id="66365-132">Step 2: Register the SPN</span></span>|<span data-ttu-id="66365-133">Прежде чем задать ограниченное делегирование, необходимо зарегистрировать имя участника-службы (SPN) для экземпляра служб Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="66365-133">Before setting up constrained delegation, you must register a Service Principle Name (SPN) for the Analysis Services instance.</span></span> <span data-ttu-id="66365-134">Имя участника-службы Analysis Services необходимо при настройке ограниченного делегирования Kerberos для служб среднего уровня.</span><span class="sxs-lookup"><span data-stu-id="66365-134">You will need the Analysis Services SPN when configuring Kerberos constrained delegation for middle tier services.</span></span> <span data-ttu-id="66365-135">Инструкции см. в разделе [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) .</span><span class="sxs-lookup"><span data-stu-id="66365-135">See [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) for instructions.</span></span><br /><br /> <span data-ttu-id="66365-136">Имя участника-службы задает уникальный идентификатор службы в домене, настроенном для проверки подлинности Kerberos.</span><span class="sxs-lookup"><span data-stu-id="66365-136">A Service Principle Name (SPN) specifies the unique identity of a service in a domain configured for Kerberos authentication.</span></span> <span data-ttu-id="66365-137">Клиентские соединения с использованием встроенной безопасности часто запрашивают имя участника-службы в составе проверки подлинности SSPI.</span><span class="sxs-lookup"><span data-stu-id="66365-137">Client connections using integrated security often request an SPN as part of SSPI authentication.</span></span> <span data-ttu-id="66365-138">Запрос перенаправляется к контроллеру домена (DC) Active Directory, а служба проверки подлинности Kerberos предоставляет билет, если имя участника-службы, указанное клиентом, имеет совпадающую регистрацию имени участника-службы в Active Directory.</span><span class="sxs-lookup"><span data-stu-id="66365-138">The request is forwarded to an Active Directory Domain Controller (DC), with the KDC granting a ticket if the SPN presented by the client has a matching SPN registration in Active Directory.</span></span>|  
|<span data-ttu-id="66365-139">Этап 3. Настройка ограниченного делегирования</span><span class="sxs-lookup"><span data-stu-id="66365-139">Step 3: Configure constrained delegation</span></span>|<span data-ttu-id="66365-140">После проверки предназначенных для использования учетных записей и регистрации для них имен участников-служб следующим шагом будет настройка служб более высокого уровня, например IIS, Reporting Services, веб-службы SharePoint для ограниченного делегирования с указанием имени участника-службы Analysis Services в качестве конкретной службы, для которой разрешено делегирование.</span><span class="sxs-lookup"><span data-stu-id="66365-140">After validating the accounts you want to use and registering SPNs for those accounts, your next step is to configure up-level services, such as IIS, Reporting Services, or SharePoint web services for constrained delegation, specifying the Analysis Services SPN as the specific service for which delegation is allowed.</span></span><br /><br /> <span data-ttu-id="66365-141">Службы, запускаемые в режиме SharePoint, например службы Excel Services или Reporting Services в режиме интеграции с SharePoint, часто содержат книги и отчеты, которые используют многомерные или табличные данные служб Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="66365-141">Services that run in SharePoint, such as Excel Services or Reporting Services in SharePoint mode, often host workbooks and reports that consume Analysis Services multidimensional or tabular data.</span></span> <span data-ttu-id="66365-142">Настройка ограниченного делегирования для этих служб — обычная задача настройки конфигурации, необходимая для поддержки обновления данных из служб Excel.</span><span class="sxs-lookup"><span data-stu-id="66365-142">Configuring constrained delegation for these services is a common configuration task, and necessary for supporting data refresh from Excel Services.</span></span> <span data-ttu-id="66365-143">По следующим ссылкам можно получить инструкции для служб SharePoint, а также других служб, которые, по всей вероятности, будут передавать запросы на подключение к данным более низкого уровня для данных служб Analysis Services:</span><span class="sxs-lookup"><span data-stu-id="66365-143">The following links provide instructions for SharePoint services, as well as other services likely to present a downstream data connection request for Analysis Services data:</span></span><br /><br /> <span data-ttu-id="66365-144">[Делегирование удостоверения для служб Excel Services (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) или [Настройка служб Excel Services в SharePoint Server 2010 для проверки подлинности Kerberos](https://support.microsoft.com/kb/2466519)</span><span class="sxs-lookup"><span data-stu-id="66365-144">[Identity delegation for Excel Services (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) or [How to configure Excel Services in SharePoint Server 2010 for Kerberos authentication](https://support.microsoft.com/kb/2466519)</span></span><br /><br /> [<span data-ttu-id="66365-145">Делегирование удостоверения для служб PerformancePoint Services (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="66365-145">Identity delegation for PerformancePoint Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299827)<br /><br /> [<span data-ttu-id="66365-146">Делегирование удостоверения для служб SQL Server Reporting Services (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="66365-146">Identity delegation for SQL Server Reporting Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299828)<br /><br /> <span data-ttu-id="66365-147">По службам IIS 7.0 см. раздел [Настройка проверки подлинности Windows (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) или [Настройка служб SQL Server 2008 Analysis Services и SQL Server 2005 Analysis Services для использования проверки подлинности Kerberos](https://support.microsoft.com/kb/917409).</span><span class="sxs-lookup"><span data-stu-id="66365-147">For IIS 7.0 see [Configure Windows Authentication (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) or [How to configure SQL Server 2008 Analysis Services and SQL Server 2005 Analysis Services to use Kerberos authentication](https://support.microsoft.com/kb/917409).</span></span>|  
|<span data-ttu-id="66365-148">Этап 4. Проверка подключения</span><span class="sxs-lookup"><span data-stu-id="66365-148">Step 4: Test connections</span></span>|<span data-ttu-id="66365-149">В процессе тестирования попробуйте установить соединение с удаленного компьютера с различными удостоверениями и запросите службы Analysis Services с использованием тех же приложений, которые будут использоваться пользователями из сферы бизнеса.</span><span class="sxs-lookup"><span data-stu-id="66365-149">When testing, connect from remote computers, under different identities, and query Analysis Services using the same applications as business users.</span></span> <span data-ttu-id="66365-150">Можно использовать приложение SQL Server Profiler для контроля за соединением.</span><span class="sxs-lookup"><span data-stu-id="66365-150">You can use SQL Server Profiler to monitor the connection.</span></span> <span data-ttu-id="66365-151">По запросу должно отобразиться пользовательское удостоверение.</span><span class="sxs-lookup"><span data-stu-id="66365-151">You should see the user identity on the request.</span></span> <span data-ttu-id="66365-152">Дополнительные сведения см. в подразделе [Проверка олицетворенного или делегированного удостоверения](#bkmk_test) этого раздела.</span><span class="sxs-lookup"><span data-stu-id="66365-152">For more information, see [Test for impersonated or delegated identity](#bkmk_test) in this section.</span></span>|  
  
##  <a name="configure-analysis-services-for-trusted-delegation"></a><a name="bkmk_delegate"></a><span data-ttu-id="66365-153">Настройка Analysis Services для доверенного делегирования</span><span class="sxs-lookup"><span data-stu-id="66365-153">Configure Analysis Services for trusted delegation</span></span>  
 <span data-ttu-id="66365-154">Настройка служб Analysis Services для ограниченного делегирования Kerberos позволяет службе олицетворять клиентское удостоверение в службе более низкого уровня, например в реляционной базе данных, для передачи данных, как если бы клиент устанавливал соединение напрямую.</span><span class="sxs-lookup"><span data-stu-id="66365-154">Configuring Analysis Services for Kerberos constrained delegation allows the service to impersonate a client identity on a down-level service, such as the relational database engine, so that data can be queried as if the client was connected directly.</span></span>  
  
 <span data-ttu-id="66365-155">Сценарии делегирования для служб Analysis Services ограничены табличными моделями, настроенными для работы в режиме `DirectQuery`.</span><span class="sxs-lookup"><span data-stu-id="66365-155">Delegation scenarios for Analysis Services are limited to tabular models configured for `DirectQuery` mode.</span></span> <span data-ttu-id="66365-156">Это единственный случай, когда службы Analysis Services могут передавать делегированные учетные данные в другую службу.</span><span class="sxs-lookup"><span data-stu-id="66365-156">This is the only scenario in which Analysis Services can pass delegated credentials to another service.</span></span> <span data-ttu-id="66365-157">Во всех остальных сценариях (например в сценариях SharePoint, упомянутых в предыдущем разделе), службы Analysis Services представляют принимающую сторону цепи делегирования.</span><span class="sxs-lookup"><span data-stu-id="66365-157">In all other scenarios, such as SharePoint scenarios mentioned in the previous section, Analysis Services is on the receiving end of the delegation chain.</span></span> <span data-ttu-id="66365-158">Дополнительные сведения о режиме DirectQuery см. в разделе [Режим DirectQuery (табличные службы SSAS)](../tabular-models/directquery-mode-ssas-tabular.md).</span><span class="sxs-lookup"><span data-stu-id="66365-158">For more information about DirectQuery, see [DirectQuery Mode &#40;SSAS Tabular&#41;](../tabular-models/directquery-mode-ssas-tabular.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="66365-159">Часто ошибочно считается, что хранилище ROLAP, операции обработки или доступ к удаленным разделам каким-либо образом предоставляет требования к ограниченному делегированию.</span><span class="sxs-lookup"><span data-stu-id="66365-159">A common misconception is that ROLAP storage, processing operations, or access to remote partitions somehow introduce requirements for constrained delegation.</span></span> <span data-ttu-id="66365-160">Это не тот случай.</span><span class="sxs-lookup"><span data-stu-id="66365-160">This is not the case.</span></span> <span data-ttu-id="66365-161">Все данные операции выполняются непосредственно учетной записью службы (также известной как учетная запись обработки) от ее собственного имени.</span><span class="sxs-lookup"><span data-stu-id="66365-161">All of these operations are executed directly by the service account (also referred to as the processing account), on its own behalf.</span></span> <span data-ttu-id="66365-162">В Analysis Services делегирование для этих операций не требуется при условии, что разрешения для таких операций предоставляются непосредственно учетной записи службы (например, предоставление разрешений db_datareader в реляционной базе данных, чтобы служба могла обрабатывать данные).</span><span class="sxs-lookup"><span data-stu-id="66365-162">Delegation is not required for these operations in Analysis Services, given that permissions for such operations are granted directly to the service account (for example, granting db_datareader permissions on the relational database so that the service can process data).</span></span> <span data-ttu-id="66365-163">Дополнительные сведения об операциях и разрешениях сервером см. в статье [Настройка учетных записей службы (службы Analysis Services)](configure-service-accounts-analysis-services.md).</span><span class="sxs-lookup"><span data-stu-id="66365-163">For more information about server operations and permissions, see [Configure Service Accounts &#40;Analysis Services&#41;](configure-service-accounts-analysis-services.md).</span></span>  
  
 <span data-ttu-id="66365-164">В этом разделе приводится описание настройки служб Analysis Services для доверенного делегирования.</span><span class="sxs-lookup"><span data-stu-id="66365-164">This section explains how to set up Analysis Services for trusted delegation.</span></span> <span data-ttu-id="66365-165">После завершения этой задачи службы Analysis Services смогут передать учетные данные делегирования в SQL Server в поддержку режима DirectQuery, использующегося в табличных решениях.</span><span class="sxs-lookup"><span data-stu-id="66365-165">After you complete this task, Analysis Services will be able to pass delegated credentials to SQL Server, in support of DirectQuery mode used in Tabular solutions.</span></span>  
  
 <span data-ttu-id="66365-166">Перед началом работы</span><span class="sxs-lookup"><span data-stu-id="66365-166">Before you start:</span></span>  
  
-   <span data-ttu-id="66365-167">Убедитесь, что службы Analysis Services запущены.</span><span class="sxs-lookup"><span data-stu-id="66365-167">Verify that Analysis Services is started.</span></span>  
  
-   <span data-ttu-id="66365-168">Убедитесь в правильности имени участника-службы, зарегистрированного для служб Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="66365-168">Verify the SPN registered for Analysis Services is valid.</span></span> <span data-ttu-id="66365-169">Инструкции см. в разделе [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md).</span><span class="sxs-lookup"><span data-stu-id="66365-169">For instructions, see [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md)</span></span>  
  
 <span data-ttu-id="66365-170">Если оба условия соблюдены, выполните следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="66365-170">When both prerequisites are satisfied, continue with the following steps.</span></span> <span data-ttu-id="66365-171">Обратите внимание, что необходимо быть администратором домена для настройки ограниченного делегирования.</span><span class="sxs-lookup"><span data-stu-id="66365-171">Note that you must be a domain administrator to set up constrained delegation.</span></span>  
  
1.  <span data-ttu-id="66365-172">В окне «Пользователи и компьютеры Active Directory» найдите учетную запись службы, от имени которой выполняются службы Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="66365-172">In Active Directory Users and Computers, find the service account under which Analysis Services runs.</span></span> <span data-ttu-id="66365-173">Щелкните правой кнопкой учетную запись службы и выберите **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="66365-173">Right-click the service account and choose **Properties**.</span></span>  
  
     <span data-ttu-id="66365-174">Для иллюстрации действий на следующих снимках экрана OlapSvc и SQLSvc обозначают службы Analysis Services и SQL Server соответственно.</span><span class="sxs-lookup"><span data-stu-id="66365-174">For illustrative purposes, the following screenshots use OlapSvc and SQLSvc to represent Analysis Services and SQL Server, respectively.</span></span>  
  
     <span data-ttu-id="66365-175">OlapSvc — это учетная запись, которая будет настроена для ограниченного делегирования в SQLSvc.</span><span class="sxs-lookup"><span data-stu-id="66365-175">OlapSvc is the account that will be configured for constrained delegation to SQLSvc.</span></span> <span data-ttu-id="66365-176">После завершения этой задачи OlapSvc получит разрешение передавать делегированные учетные данные по билету в службу SQLSvc, олицетворяя исходного заявителя при запросе данных.</span><span class="sxs-lookup"><span data-stu-id="66365-176">When you complete this task, OlapSvc will have permission to pass delegated credentials on a service ticket to SQLSvc, impersonating the original caller when requesting data.</span></span>  
  
2.  <span data-ttu-id="66365-177">На вкладке «Делегирование» выберите **Доверять этому пользователю делегирование только для указанных служб**, затем **Использовать только Kerberos**.</span><span class="sxs-lookup"><span data-stu-id="66365-177">On the Delegation tab, select **Trust this user for delegation to specified services only**, followed by **Use Kerberos only**.</span></span> <span data-ttu-id="66365-178">Нажмите кнопку **Добавить** , чтобы указать, каким службам службы Analysis Services могут делегировать учетные данные.</span><span class="sxs-lookup"><span data-stu-id="66365-178">Click **Add** to specify which service Analysis Services is permitted to delegate credentials.</span></span>  
  
     <span data-ttu-id="66365-179">Вкладка «Делегирование» отображается только в том случае, если учетная запись пользователя (OlapSvc) назначена службе (службам Analysis Services) и служба имеет зарегистрированное имя участника-службы.</span><span class="sxs-lookup"><span data-stu-id="66365-179">Delegation tab appears only when the user account (OlapSvc) is assigned to a service (Analysis Services), and the service has an SPN registered for it.</span></span> <span data-ttu-id="66365-180">Для регистрации имени участника-службы необходимо, чтобы служба была запущена.</span><span class="sxs-lookup"><span data-stu-id="66365-180">SPN registration requires that the service is running.</span></span>  
  
     <span data-ttu-id="66365-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span><span class="sxs-lookup"><span data-stu-id="66365-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span></span>  
  
3.  <span data-ttu-id="66365-182">На странице «Добавление службы» выберите **Пользователи или компьютеры**.</span><span class="sxs-lookup"><span data-stu-id="66365-182">On the Add Services page, click **Users or Computers**.</span></span>  
  
     <span data-ttu-id="66365-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span><span class="sxs-lookup"><span data-stu-id="66365-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span></span>  
  
4.  <span data-ttu-id="66365-184">На странице «Выбор пользователей или компьютеров» введите имя учетной записи, используемой для запуска экземпляра SQL Server, который содержит табличные шаблоны баз данных служб Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="66365-184">On the Select Users or Computer page, enter the account used to run the SQL Server instance providing data to Analysis Services tabular model databases.</span></span> <span data-ttu-id="66365-185">Нажмите кнопку **ОК** , чтобы подтвердить учетную запись службы.</span><span class="sxs-lookup"><span data-stu-id="66365-185">Click **OK** to accept the service account.</span></span>  
  
     <span data-ttu-id="66365-186">Если учетную запись выбрать не удается, убедитесь, что SQL Server запущен и имеет имя участника-службы, зарегистрированное для этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="66365-186">If you cannot select the account you want, verify that SQL Server is running and has an SPN registered for that account.</span></span> <span data-ttu-id="66365-187">Дополнительные сведения об именах участников-служб для базы данных см. в разделе [Регистрация имя участника-службы для соединений Kerberos](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span><span class="sxs-lookup"><span data-stu-id="66365-187">For more information about SPNs for the database engine, see [Register a Service Principal Name for Kerberos Connections](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
     <span data-ttu-id="66365-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span><span class="sxs-lookup"><span data-stu-id="66365-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span></span>  
  
5.  <span data-ttu-id="66365-189">Экземпляр SQL Server должен появиться на странице «Добавление служб».</span><span class="sxs-lookup"><span data-stu-id="66365-189">The SQL Server instance should now appear in Add Services.</span></span> <span data-ttu-id="66365-190">Службы, которые используют эту учетную запись, также появятся в списке.</span><span class="sxs-lookup"><span data-stu-id="66365-190">Any service also using that account will also appear in the list.</span></span> <span data-ttu-id="66365-191">Выберите нужный экземпляр SQL Server.</span><span class="sxs-lookup"><span data-stu-id="66365-191">Choose the SQL Server instance you want to use.</span></span> <span data-ttu-id="66365-192">Нажмите кнопку **ОК** , чтобы подтвердить экземпляр.</span><span class="sxs-lookup"><span data-stu-id="66365-192">Click **OK** to accept the instance.</span></span>  
  
     <span data-ttu-id="66365-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span><span class="sxs-lookup"><span data-stu-id="66365-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span></span>  
  
6.  <span data-ttu-id="66365-194">Страница свойств учетной записи служб Analysis Services теперь должна выглядеть примерно так, как на следующем снимке экрана.</span><span class="sxs-lookup"><span data-stu-id="66365-194">The properties page of the Analysis Services service account should now look similar to the following screenshot.</span></span> <span data-ttu-id="66365-195">Нажмите кнопку **ОК** , чтобы сохранить внесенные изменения.</span><span class="sxs-lookup"><span data-stu-id="66365-195">Click **OK** to save your changes.</span></span>  
  
     <span data-ttu-id="66365-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span><span class="sxs-lookup"><span data-stu-id="66365-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span></span>  
  
7.  <span data-ttu-id="66365-197">Для проверки успешного делегирования подключитесь с удаленного клиентского компьютера под другим удостоверением и отправьте запрос для табличной модели.</span><span class="sxs-lookup"><span data-stu-id="66365-197">Test for successful delegation by connecting from a remote client computer, under a different identity, and query the tabular model.</span></span> <span data-ttu-id="66365-198">Пользовательское удостоверение должно отобразиться для соответствующего запроса в приложении SQL Server Profiler.</span><span class="sxs-lookup"><span data-stu-id="66365-198">You should see the user identity on the request in SQL Server Profiler.</span></span>  
  
##  <a name="test-for-impersonated-or-delegated-identity"></a><a name="bkmk_test"></a><span data-ttu-id="66365-199">Проверка олицетворенного или делегированного удостоверения</span><span class="sxs-lookup"><span data-stu-id="66365-199">Test for impersonated or delegated identity</span></span>  
 <span data-ttu-id="66365-200">Приложение SQL Server Profiler позволяет отслеживать удостоверение пользователя, который запрашивает данные.</span><span class="sxs-lookup"><span data-stu-id="66365-200">Use SQL Server Profiler to monitor the identity of the user who is querying data.</span></span>  
  
1.  <span data-ttu-id="66365-201">Запустите приложение **SQL Server Profiler** на экземпляре служб Analysis Services, затем запустите новую трассировку.</span><span class="sxs-lookup"><span data-stu-id="66365-201">Start **SQL Server Profiler** on the Analysis Services instance and then start a new trace.</span></span>  
  
2.  <span data-ttu-id="66365-202">В разделе «Выбор событий» убедитесь, что объекты `Audit Login` и `Audit Logout` отмечены в разделе «Аудит безопасности».</span><span class="sxs-lookup"><span data-stu-id="66365-202">In Events Selection, verify that `Audit Login` and `Audit Logout` are checked in the Security Audit section.</span></span>  
  
3.  <span data-ttu-id="66365-203">Подключитесь к службам Analysis Services через службу приложений (например, SharePoint или службы Reporting Services) с удаленного клиентского компьютера.</span><span class="sxs-lookup"><span data-stu-id="66365-203">Connect to Analysis Services via an application service (such as SharePoint or Reporting Services) from a remote client computer.</span></span> <span data-ttu-id="66365-204">Событие «Имя входа учетной записи аудита» отобразит удостоверение пользователя, подключенного к службам Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="66365-204">The Audit Login event will show the identity of the user connecting to Analysis Services.</span></span>  
  
 <span data-ttu-id="66365-205">Для более тщательного тестирования потребуются средства сетевого мониторинга, которые способны отслеживать запросы и отклики Kerberos по сети.</span><span class="sxs-lookup"><span data-stu-id="66365-205">Thorough testing will require the use of network monitoring tools that can capture Kerberos requests and responses on the network.</span></span> <span data-ttu-id="66365-206">Для этой задачи может использоваться служебная программа монитора сети (netmon.exe), в которой применены фильтры для Kerberos.</span><span class="sxs-lookup"><span data-stu-id="66365-206">The Network Monitor utility (netmon.exe), filtered for Kerberos, can be used for this task.</span></span> <span data-ttu-id="66365-207">Дополнительные сведения об использовании Netmon 3.4 и других инструментов для тестирования средств проверки подлинности Kerberos см. в разделе [Настройка проверки подлинности Kerberos: основная конфигурация (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span><span class="sxs-lookup"><span data-stu-id="66365-207">For more information about using Netmon 3.4 and other tools for testing Kerberos authentication, see [Configuring Kerberos authentication: Core configuration (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span></span>  
  
 <span data-ttu-id="66365-208">Кроме того, полное описание каждого параметра во вкладке "Делегирование" диалогового окна свойств объекта Active Directory см. в разделе [Самое запутанное диалоговое окно Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) .</span><span class="sxs-lookup"><span data-stu-id="66365-208">Additionally, see [The Most Confusing Dialog Box in Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) for a thorough description of each option in the Delegation tab of the Active Directory object's property dialog box.</span></span> <span data-ttu-id="66365-209">В этой статье также объясняется, как использовать LDP для тестирования и интерпретации результатов тестирования.</span><span class="sxs-lookup"><span data-stu-id="66365-209">This article also explains how to use LDP to test and interpret test results.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="66365-210">См. также:</span><span class="sxs-lookup"><span data-stu-id="66365-210">See Also</span></span>  
 <span data-ttu-id="66365-211">[Проверка подлинности и делегирование удостоверений бизнес-аналитики Майкрософт](https://go.microsoft.com/fwlink/?LinkID=286576) </span><span class="sxs-lookup"><span data-stu-id="66365-211">[Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576) </span></span>  
 <span data-ttu-id="66365-212">[Взаимная проверка подлинности с помощью Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span><span class="sxs-lookup"><span data-stu-id="66365-212">[Mutual Authentication Using Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span></span>  
 <span data-ttu-id="66365-213">[Подключение к Analysis Services](connect-to-analysis-services.md) </span><span class="sxs-lookup"><span data-stu-id="66365-213">[Connect to Analysis Services](connect-to-analysis-services.md) </span></span>  
 <span data-ttu-id="66365-214">[Регистрация имени участника-службы для экземпляра Analysis Services](spn-registration-for-an-analysis-services-instance.md) </span><span class="sxs-lookup"><span data-stu-id="66365-214">[SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) </span></span>  
 [<span data-ttu-id="66365-215">Свойства строки подключения (службы Analysis Services)</span><span class="sxs-lookup"><span data-stu-id="66365-215">Connection String Properties &#40;Analysis Services&#41;</span></span>](connection-string-properties-analysis-services.md)  
  
  
