---
title: Регистрация имени участника-службы для экземпляра Analysis Services | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 9e78dc37-a3f0-415d-847c-32fec69efa8c
author: minewiskan
ms.author: owend
ms.openlocfilehash: 3146a581e3cc0b434d2e5b153718f1f31cd903d1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750376"
---
# <a name="spn-registration-for-an-analysis-services-instance"></a>SPN registration for an Analysis Services instance
  Имя участника-службы (SPN) однозначно идентифицирует экземпляр службы в домене Active Directory, если протокол Kerberos используется для взаимной проверки подлинности идентификаторов клиента и службы. Имя участника-службы сопоставляется с учетной записью входа, от имени которой выполняется экземпляр службы.  
  
 Для клиентских приложений при подключении к службам Analysis Services через протокол проверки подлинности Kerberos клиентские библиотеки Analysis services формируют имя участника-службы, используя имя узла из строки подключения и других известных переменных, например класс службы, зафиксированных в любой конкретной версии служб Analysis Services.  
  
 Чтобы прошла взаимная проверки подлинности, имена участников-служб, построенные клиентом, должны соответствовать объекту имени участника-службы в контроллере домена Active Directory. Это означает, что может потребоваться регистрация нескольких имен участников-служб для единственного экземпляра служб Analysis Services, чтобы описать все способы, с помощью которых пользователь может задать имя узла в строке подключения. Например, возможно, потребуется два имени участника-службы для работы с полным доменным именем сервера (FQDN), а также для короткого имени компьютера. Правильная регистрация имени участника-службы Analysis Services необходима для выполнения успешного подключения. Если SPN отсутствует, имеет неправильный формат или повторяется, установить соединение не удастся.  
  
 Регистрация имени участника-службы выполняется вручную администратором служб Analysis Services. В отличие от компонента SQL Server Database Engine, службы Analysis Services при запуске не регистрируют автоматически имя участника-службы. Выполнять регистрацию вручную обязательно, если службы Analysis Services запускаются от имени стандартной виртуальной учетной записи, учетной записи пользователя домена или встроенной учетной записи, в том числе идентификатора безопасности службы.  
  
 Регистрация имени участника-службы не требуется, если служба запускается от имени предопределенной учетной записи управляемой службы, созданной администратором домена. Обратите внимание, что в зависимости от функционального уровня домена для регистрации имени участника-службы может потребоваться разрешение администратора домена.  
  
> [!TIP]  
>  **[!INCLUDE[msCoName](../../includes/msconame-md.md)] диспетчер конфигурации Kerberos для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** — это диагностическое средство, которое помогает расследовать проблемы Kerberos со связью при использовании [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. в разделе [Диспетчер конфигурации Microsoft Kerberos для SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).  
  
> [!TIP]  
>  **[!INCLUDE[msCoName](../../includes/msconame-md.md)] диспетчер конфигурации Kerberos для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** — это диагностическое средство, которое помогает расследовать проблемы Kerberos со связью при использовании [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. в разделе [Диспетчер конфигурации Microsoft Kerberos для SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).  
  
 Этот раздел состоит из следующих подразделов.  
  
 [Когда требуется регистрация имени участника-службы](#bkmk_scnearios)  
  
 [Формат имени участника-службы для Analysis Services](#bkmk_SPNSyntax)  
  
 [Регистрация имени участника-службы для виртуальной учетной записи.](#bkmk_virtual)  
  
 [Регистрация имени участника-службы для учетной записи домена.](#bkmk_domain)  
  
 [Регистрация имени участника-службы для встроенной учетной записи](#bkmk_builtin)  
  
 [Регистрация имени участника-службы для именованного экземпляра](#bkmk_spnNamed)  
  
 [Регистрация имени участника-службы для кластера SSAS](#bkmk_spnCluster)  
  
 [Регистрация имени участника-службы для экземпляров службы SSAS, настроенных на доступ по протоколу HTTP](#bkmk_spnHTTP)  
  
 [Регистрация имени участника-службы для экземпляров службы SSAS, слушающих фиксированные порты](#bkmk_spnFixedPorts)  
  
##  <a name="when-spn-registration-is-required"></a><a name="bkmk_scnearios"></a>Когда требуется регистрация имени участника-службы  
 Любое клиентское подключение, указывающее "SSPI = Kerberos" в строке подключения, повлечет требования регистрации имени участника-службы для экземпляра Analysis Services.  
  
 Регистрация имени участника-службы требуется в следующих ситуациях. Более подробные сведения см. в разделе [Configure Analysis Services for Kerberos constrained delegation](configure-analysis-services-for-kerberos-constrained-delegation.md).  
  
-   Делегирование удостоверения обязательно для передачи удостоверения пользователя от клиентского приложения или службы-посредника в службы Analysis Services. Делегирование удостоверения обычно используется в тех случаях, когда для определенных объектов определены фильтры или разрешения для отдельных пользователей.  
  
     Распространенный сценарий, при котором применяется делегация удостоверения, — настройка служб-посредников, например служб Excel Services или Reporting Services, с ограниченным делегированием, когда необходимо олицетворение пользователя при получении данных из служб Analysis Services. Для поддержки данной возможности необходимо указать имя участника-службы Analysis Services в качестве целевой службы при настройке служб Excel или Reporting Services для ограниченного делегирования.  
  
-   Службы Analysis Services делегируют удостоверение пользователя при получении данных из реляционной базы данных SQL Server для табличных баз данных в режиме DirectQuery. Это единственный случай, когда службы Analysis Services будут делегировать удостоверение пользователя в другую службу.  
  
##  <a name="spn-format-for-analysis-services"></a><a name="bkmk_SPNSyntax"></a>Формат имени участника-службы для Analysis Services  
 Для регистрации имени участника-службы используйте команду **setspn** . На современных операционных системах программа **setspn** устанавливается как системная. Дополнительные сведения см. в разделе [SetSPN](https://technet.microsoft.com/library/cc731241\(WS.10\).aspx).  
  
 В следующей таблице описываются все части имени участника-службы для служб Analysis Services.  
  
|Элемент|Описание|  
|-------------|-----------------|  
|Класс службы|MSOLAPSvc.3 определяет службу как экземпляр служб Analysis Services. «.3» — это версия протокола XMLA-over-TCP/IP, используемого в передачах служб Analysis Services. Он не связан с версией продукта. Таким образом, MSOLAPSvc.3 — это правильный класс службы для SQL Server 2005, 2008, 2008, 2012 R2 и любых последующих выпусков служб Analysis Services до тех пор, пока не будет обновлен сам протокол.|  
|Имя узла|Идентифицирует компьютер, на котором выполняется служба. Это может быть полное доменное имя или имя NetBIOS. Регистрация имени участника-службы необходима в обоих случаях.<br /><br /> При регистрации имени участника-службы для имени NetBIOS сервера обязательно используйте команду `SetupSPN -S` для проверки повторяющихся регистраций. Обратите внимание, что в пределах леса не гарантируется уникальность имен NetBIOS, а наличие дублированных регистраций имени участника-службы приведет к сбою подключения.<br /><br /> Для сбалансированных по нагрузке кластеров служб Analysis Services имя узла должно быть виртуальным именем, назначенным кластеру.<br /><br /> Никогда не создавайте имя участника-службы (SPN) с помощью IP-адреса. Протокол Kerberos использует возможности домена по разрешению DNS. Задание IP-адреса приводит к неиспользованию этих возможностей.|  
|Номер порта|Хотя номер порта и является частью синтаксиса имени участника-службы, не указывайте номер порта при регистрации имени участника-службы Analysis Services. Символ двоеточия ( : ), который, как правило, в стандартном синтаксисе имени участника-службы используется для указания номера порта, в службах Analysis Services применяется для указания имени экземпляра. Для экземпляров служб Analysis Services применяется порт по умолчанию (порт TCP 2383) или порт, назначенный службой обозревателя SQL Server (порт TCP 2382).|  
|Имя экземпляра|Analysis Services — службы, которые можно установить несколько раз на одном и том же компьютере. Каждый экземпляр определяется посредством его имени.<br /><br /> Перед именем экземпляра добавляется символ двоеточия ( : ). Например, если есть главный компьютер с именем SRV01 и именованный экземпляр SSAS-Tabular, то имя участника-службы выглядит как SRV01:SSAS-Tabular.<br /><br /> Обратите внимание, что синтаксис для указания именованного экземпляра служб Analysis Services отличается от того, что используется другими экземплярами SQL Server. Другие службы используют обратную косую черту (\) для добавления имени экземпляра в имя участника-службы.|  
|Service-account|Это стартовая учетная запись службы Windows **MSSQLServerOLAPService** . Это может быть учетная запись пользователя домена Windows, виртуальная учетная запись, управляемая учетная запись службы (MSA) или встроенная учетная запись, например идентификатор безопасности службы, NetworkService или LocalSystem. Учетную запись пользователя домена Windows можно отформатировать как домен \ пользователь или user@domain .|  
  
##  <a name="spn-registration-for-a-virtual-account"></a><a name="bkmk_virtual"></a>Регистрация имени участника-службы для виртуальной учетной записи  
 Виртуальные учетные записи для служб SQL Server являются типом записи по умолчанию. Виртуальная учетная запись — **NT Service\MSOLAPService** для экземпляра по умолчанию и **NT Service\MSOLAP $** \<instance-name> для именованного экземпляра.  
  
 Как следует из имен, эти учетные записи не присутствуют в Active Directory. Виртуальная учетная запись существует только на локальном компьютере. При подключении ко внешним службам, приложениям и устройствам подключение осуществляется от имени учетной записи локальной машины. Поэтому регистрация имени участника-службы для служб Analysis Services, выполняющихся от имени виртуальной учетной записи, фактически является регистрацией SPN для учетной записи машины.  
  
 **Пример синтаксиса для экземпляра по умолчанию, запущенного как NT Service\MSOLAPService.**  
  
 Этот пример демонстрирует синтаксис **setspn** для стандартного экземпляра служб Analysis Services, запущенного под стандартной виртуальной учетной записью. В данном примере имя хост-компьютера — **AW-SRV01**. Как было сказано ранее, регистрация имени участника-службы должна содержать *учетную запись машины* вместо виртуальной учетной записи **NT Service\MSOLAPService**.  
  
```  
Setspn -s MSOLAPSvc.3/AW-SRV01.AdventureWorks.com AW-SRV01  
```  
  
> [!NOTE]  
>  Помните, что нужно добавить две регистрации имени участника-службы: одно для имени NetBIOS, а другое для полного доменного имени хост-компьютера (узла). Разные клиентские приложения используют разные соглашения об именовании узлов при подключении к службам Analysis Services. Наличие двух регистраций имени участника-службы гарантирует учет обеих версий имени узла.  
  
 **Пример синтаксиса для именованного экземпляра, запущенного как NT Service\MSOLAP$\<instance-name>**  
  
 Этот пример демонстрирует синтаксис **setspn** для именованного экземпляра служб Analysis Services, запущенного под стандартной виртуальной учетной записью. В этом примере имя узла — **AW-SRV02**, а имя экземпляра — **AW-FINANCE**. Опять же, это учетная запись компьютера, указанная для имени субъекта-службы, а не для виртуальной учетной записи **NT Service\MSOLAP $** \<instance-name> .  
  
```  
Setspn -s MSOLAPSvc.3/AW-SRV02.AdventureWorks.com:AW-FINANCE AW-SRV02  
```  
  
##  <a name="spn-registration-for-a-domain-account"></a><a name="bkmk_domain"></a>Регистрация имени участника-службы для учетной записи домена  
 Использование учетной записи домена для запуска экземпляра служб Analysis Services — это распространенная практика.  
  
 Для экземпляров служб Analysis Services, которые выполняются в сетевом или локальном кластере с балансировкой нагрузки, требуется учетная запись домена, при этом каждый экземпляр будет выполняться от имени той же учетной записи домена.  
  
 **Пример синтаксиса для экземпляра по умолчанию, запущенного от имени пользователя домена.**  
  
 Этот пример демонстрирует синтаксис **setspn** для стандартного экземпляра служб Analysis Services, запущенного от имени учетной записи пользователя домена **SSAS-Service**в домене AdventureWorks.  
  
```  
Setspn -s msolapsvc.3\AW-SRV01.Adventureworks.com AdventureWorks\SSAS-Service  
```  
  
> [!TIP]  
>  Проверьте, было ли создано имя участника-службы для сервера Analysis Services, запустив командлет `Setspn -L <domain account>` или `Setspn -L <machinename>`в зависимости от способа регистрации имени участника-службы. Вы должны увидеть MSOLAPSVC. 3/ \<hostname> в списке.  
  
##  <a name="spn-registration-for-a-built-in-account"></a><a name="bkmk_builtin"></a>Регистрация имени участника-службы для встроенной учетной записи  
 Хотя подобный метод не рекомендуется, предыдущие установки служб Analysis Service иногда настраиваются для запуска от имени встроенной учетной записи, такой как Network Service, Local Service или Local System.  
  
 **Пример синтаксиса для экземпляра по умолчанию, запущенного от имени встроенной учетной записи**  
  
 Регистрация имени участника-службы для службы, выполняющейся от имени встроенной учетной записи или служебного идентификатора безопасности, выполняется с тем же синтаксисом имени участника-службы, который используется для виртуальной учетной записи. Вместо имени учетной записи используйте учетную запись компьютера:  
  
```  
Setspn -s MSOLAPSvc.3/AW-SRV01.AdventureWorks.com AW-SRV01  
```  
  
##  <a name="spn-registration-for-a-named-instance"></a><a name="bkmk_spnNamed"></a>Регистрация имени участника-службы для именованного экземпляра  
 Именованные экземпляры служб Analysis Services используют динамическое назначение портов, которые определяются службой обозревателя SQL Server. Если используется именованный экземпляр, зарегистрируйте имя участника-службы для службы обозревателя SQL Server и именованного экземпляра служб Analysis Services. Дополнительные сведения см. в документе [Имя участника-службы для обозревателя SQL Server требуется, когда устанавливается соединение с именованным экземпляром служб SQL Server Analysis Services или SQL Server](https://support.microsoft.com/kb/950599).  
  
 **Пример синтаксиса имени участника-службы для службы обозревателя SQL, запущенной как LocalService.**  
  
 Класс службы **MSOLAPDisco.3**. По умолчанию эта служба запускается как NT AUTHORITY\LocalService, а это означает, что регистрация имени участника-службы задается для учетной записи компьютера. В данном примере учетная запись машины — **AW-SRV01**, что соответствует имени компьютера.  
  
```  
Setspn -S MSOLAPDisco.3/AW-SRV01.AdventureWorks.com AW-SRV01  
```  
  
##  <a name="spn-registration-for-an-ssas-cluster"></a><a name="bkmk_spnCluster"></a>Регистрация имени участника-службы для кластера SSAS  
 Для кластеров отработки отказа служб Analysis Services имя узла должно быть виртуальным именем, назначенным кластеру. Это сетевое имя SQL Server, указанное во время установки SQL Server при установке служб Analysis Services на основе существующих WSFC. Это имя можно найти в Active Directory. Его также можно найти на **Failover Cluster Manager**  |  **Role**  |  вкладке**ресурсы** Диспетчер отказоустойчивости кластеров роли. Имя сервера на вкладке ресурсы должно использоваться в качестве "виртуального имени" в команде SPN.  
  
 **Синтаксис имени участника-службы для кластера служб Analysis Services**  
  
```  
Setspn -s msolapsvc.3/<virtualname.FQDN > <domain user account>  
```  
  
 Помните, что узлы в кластере служб Analysis Services должны использовать порт (TCP 2383) по умолчанию и выполняться под той же учетной записью пользователя домена, чтобы каждый узел имел один и тот же идентификатор безопасности. Дополнительные сведения см. в разделе [Кластеризация служб Analysis Services SQL Server](https://msdn.microsoft.com/library/dn736073.aspx) .  
  
##  <a name="spn-registration-for-ssas-instances-configured-for-http-access"></a><a name="bkmk_spnHTTP"></a>Регистрация имени участника-службы для экземпляров SSAS, настроенных для доступа по протоколу HTTP  
 В зависимости от требований к решению можно настроить службы Analysis Services для доступа по протоколу HTTP. Если решение содержит IIS как компонент среднего уровня и требуется проверять подлинность с помощью Kerberos, для сервера IIS может потребоваться ручная регистрация имени участника-службы. Дополнительные сведения см. в разделе "Настройка параметров на компьютере с IIS" в статье [настройка SQL Server 2008 Analysis Services и SQL Server 2005 Analysis Services для использования проверки подлинности Kerberos](https://support.microsoft.com/kb/917409).  
  
 С точки зрения регистрации имени участника-службы для экземпляра служб Analysis Services нет разницы между экземплярами, настроенными на использование протокола TCP или HTTP. Подключение к службам Analysis Services из IIS с помощью расширения MSMDPUMP ISAPI всегда производится через TCP-протокол.  
  
 Это значит, что можно использовать инструкции по регистрации имени участника-службы из предыдущих разделов, касающихся стандартного или именованного экземпляра. При указании имени узла используйте имя, которое было задано в файле msmdpump.ini при настройке службы для доступа по протоколу HTTP.  
  
 Дополнительные сведения о HTTP-доступе см. в разделе [Настройка HTTP-доступа к службам Analysis Services в службах Internet Information Services (IIS) 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).  
  
##  <a name="spn-registration-for-ssas-instances-listening-on-fixed-ports"></a><a name="bkmk_spnFixedPorts"></a>Регистрация имени участника-службы для экземпляров SSAS, прослушивающих фиксированные порты  
 При регистрации имени участника-службы Analysis Services нельзя указать номер порта. Если службы Analysis Services установлены как экземпляр по умолчанию и этот экземпляр настроен на прослушивание фиксированного порта, то теперь нужно настроить его для прослушивания порта (TCP 2383) по умолчанию. Для именованных экземпляров необходимо использовать службу обозревателя SQL Server с динамически назначаемыми портами.  
  
 Экземпляр служб Analysis Services может прослушивать только один порт. Использование нескольких портов не поддерживается. Дополнительные сведения о настройке порта см. в разделе [Configure the Windows Firewall to Allow Analysis Services Access](configure-the-windows-firewall-to-allow-analysis-services-access.md).  
  
## <a name="see-also"></a>См. также:  
 [Проверка подлинности и делегирование удостоверений бизнес-аналитики Майкрософт](https://go.microsoft.com/fwlink/?LinkID=286576)   
 [Взаимная проверка подлинности с помощью Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283)   
 [Настройка SQL Server 2008 Analysis Services и SQL Server 2005 Analysis Services для использования проверки подлинности Kerberos](https://support.microsoft.com/kb/917409)   
 [Синтаксис имен субъектов-служб (SPN) SetSPN (Setspn.exe)](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx)   
 [Какое имя субъекта-службы я использую и как оно получает?](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx)   
 [SetSPN](https://technet.microsoft.com/library/cc731241\(WS.10\).aspx)   
 [Пошаговое руководств по учетным записям служб](https://technet.microsoft.com/library/dd548356\(WS.10\).aspx)   
 [Настройка учетных записей службы Windows и разрешений](../../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md)   
 [Использование имен SPN при настройке веб-приложений, размещенных на службы IIS](https://support.microsoft.com/kb/929650)   
 [новые возможности учетных записей служб](https://technet.microsoft.com/library/dd367859\(WS.10\).aspx)   
 [Настройка проверки подлинности Kerberos для продуктов SharePoint 2010 (технический документ)](https://technet.microsoft.com/library/ff829837.aspx)  
  
  
