---
title: Хранение строк и параметры сортировки в табличных моделях | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 8516f0ad-32ee-4688-a304-e705143642ca
author: minewiskan
ms.author: owend
ms.openlocfilehash: 3aad4cf16c39897bc0796f4fb161eaf39abdb5fd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87738819"
---
# <a name="string-storage-and-collation-in-tabular-models"></a><span data-ttu-id="3c835-102">Хранение строк и параметры сортировки в табличных моделях</span><span class="sxs-lookup"><span data-stu-id="3c835-102">String Storage and Collation in Tabular Models</span></span>
  <span data-ttu-id="3c835-103">Строки (текстовые значения) хранятся в формате с большим сжатием в табличных моделях. В силу сжатия при извлечении полных или частичных строк можно получить неверные результаты.</span><span class="sxs-lookup"><span data-stu-id="3c835-103">Strings (text values) are stored in a highly compressed format in tabular models; because of this compression, you can get unexpected results when you retrieve entire or partial strings.</span></span> <span data-ttu-id="3c835-104">Кроме того, поскольку языковой стандарт и параметры сортировки строки наследуются в иерархическом порядке у ближайшего родительского объекта, если язык строки не определен явным образом, локаль и параметры сортировки родительского элемента могут повлиять на то, как каждая строка хранится, является строка уникальной или объединена с похожими строками согласно определению параметров сортировки родительского элемента.</span><span class="sxs-lookup"><span data-stu-id="3c835-104">Also, because string locale and collations are inherited hierarchically from the closest parent object, if the string language is not explicitly defined, the locale and collation of the parent can affect how each string is stored and whether the string is unique or conflated with similar strings as defined by the parent collation.</span></span>  
  
 <span data-ttu-id="3c835-105">В этом разделе содержится описание механизма, с помощью которого сжимаются и сохраняются строки, а также примеры того, как параметры сортировки и язык влияют на результаты текстовых формул в табличных моделях.</span><span class="sxs-lookup"><span data-stu-id="3c835-105">This topic describes the mechanism by which strings are compressed and stored, and provides examples of how collation and language affect the results of text formulas in tabular models.</span></span>  
  
## <a name="storage"></a><span data-ttu-id="3c835-106">Память</span><span class="sxs-lookup"><span data-stu-id="3c835-106">Storage</span></span>  
 <span data-ttu-id="3c835-107">В табличных моделях все данные сильно сжаты для того, чтобы занимать меньше места в памяти.</span><span class="sxs-lookup"><span data-stu-id="3c835-107">In tabular models all data is highly compressed to better fit in memory.</span></span> <span data-ttu-id="3c835-108">Как следствие, все строки, которые могут считаться лексически эквивалентными, сохраняются только один раз.</span><span class="sxs-lookup"><span data-stu-id="3c835-108">As a consequence, all strings that can be considered lexically equivalent are stored only once.</span></span> <span data-ttu-id="3c835-109">Первый экземпляр строки используется в качестве канонического представления, после которой каждая эквивалентная строка индексируется с тем же сжатым значением, что и первый экземпляр.</span><span class="sxs-lookup"><span data-stu-id="3c835-109">The first instance of the string is used as the canonical representation and thereafter each equivalent string is indexed to the same compressed value as the first occurrence.</span></span>  
  
 <span data-ttu-id="3c835-110">Ключевой вопрос заключается в том, что такое лексически эквивалентная строка?</span><span class="sxs-lookup"><span data-stu-id="3c835-110">The key question is: what constitutes a lexically equivalent string?</span></span> <span data-ttu-id="3c835-111">Две строки считаются лексически эквивалентными, если они могут рассматриваться как одно и то же слово.</span><span class="sxs-lookup"><span data-stu-id="3c835-111">Two strings are considered lexically equivalent if they can be considered as the same word.</span></span> <span data-ttu-id="3c835-112">Например, если искать в словаре русского языка слово **скрипка** , можно найти запись **Скрипка** или **скрипка**, в зависимости от политики редактирования словаря, однако оба слова считаются эквивалентными, и разница заглавной или прописной буквы не учитывается.</span><span class="sxs-lookup"><span data-stu-id="3c835-112">For example, in English when you search for the word **violin** in a dictionary, you might find the entry **Violin** or **violin**, depending on the editorial policy of the dictionary, but generally you consider both words equivalent, and disregard the difference in capitalization.</span></span> <span data-ttu-id="3c835-113">В табличной модели коэффициент, который определяет, являются ли две строки лексически эквивалентными, не является политикой редактирования или даже предпочтением пользователя, он представляет собой локаль и порядок сортировки, заданные столбцу.</span><span class="sxs-lookup"><span data-stu-id="3c835-113">In a tabular model, the factor that determines whether two strings are lexically equivalent is not editorial policy or even user preference, but the locale and collation order assigned to the column.</span></span>  
  
 <span data-ttu-id="3c835-114">Таким образом, решение о том, является ли верхний и нижний регистр отличием двух слов, зависит от параметров сортировки и локали.</span><span class="sxs-lookup"><span data-stu-id="3c835-114">Therefore, the decision of whether uppercase and lowercase letters should be handled as the same or different depends on the collation and locale.</span></span> <span data-ttu-id="3c835-115">Для любого слова локали первый экземпляр слова, находящийся в определенном столбце, служит каноническим представлением слова и строки, которая хранится в несжатом формате.</span><span class="sxs-lookup"><span data-stu-id="3c835-115">For any particular word within that locale, the first occurrence of the word that is found within a particular column therefore serves as the canonical representation of that word and that string is stored in uncompressed format.</span></span>  <span data-ttu-id="3c835-116">Все остальные строки проходят проверку относительно первого экземпляра, и если они не проходят тест на соответствие, то приписываются к сжатому значению первого экземпляра.</span><span class="sxs-lookup"><span data-stu-id="3c835-116">All other strings are tested against the first occurrence, and if they match the equivalence test, they are assigned to the compressed value of the first occurrence.</span></span> <span data-ttu-id="3c835-117">В дальнейшем при извлечении сжатых значений они будут представлены с помощью несжатого значения первого экземпляра строки.</span><span class="sxs-lookup"><span data-stu-id="3c835-117">Later, when the compressed values are retrieved they are represented using the uncompressed value of the first occurrence of the string.</span></span>  
  
 <span data-ttu-id="3c835-118">Следующий пример позволяет понять, как это работает.</span><span class="sxs-lookup"><span data-stu-id="3c835-118">An example will help to clarify how this works.</span></span> <span data-ttu-id="3c835-119">Следующий столбец «Классификация ― английский» был взят из таблицы, содержащей сведения о растениях и деревьях.</span><span class="sxs-lookup"><span data-stu-id="3c835-119">The following column "Classification - English" was extracted from a table that contains information about plants and trees.</span></span> <span data-ttu-id="3c835-120">Для каждого растения (имена растений не показаны) столбец классификации показывает общую категорию растения.</span><span class="sxs-lookup"><span data-stu-id="3c835-120">For each plant (the names of the plants are not shown here) the classification column shows the general category of plant.</span></span>  
  
|<span data-ttu-id="3c835-121">Классификация ― английский</span><span class="sxs-lookup"><span data-stu-id="3c835-121">Classification - English</span></span>|  
|-------------------------------|  
|<span data-ttu-id="3c835-122">дереВО</span><span class="sxs-lookup"><span data-stu-id="3c835-122">trEE</span></span>|  
|<span data-ttu-id="3c835-123">РасТениЕ</span><span class="sxs-lookup"><span data-stu-id="3c835-123">PlAnT</span></span>|  
|<span data-ttu-id="3c835-124">дереВО</span><span class="sxs-lookup"><span data-stu-id="3c835-124">TREE</span></span>|  
|<span data-ttu-id="3c835-125">РасТениЕ</span><span class="sxs-lookup"><span data-stu-id="3c835-125">PLANT</span></span>|  
|<span data-ttu-id="3c835-126">РасТениЕ</span><span class="sxs-lookup"><span data-stu-id="3c835-126">Plant</span></span>|  
|<span data-ttu-id="3c835-127">Дерево</span><span class="sxs-lookup"><span data-stu-id="3c835-127">Tree</span></span>|  
|<span data-ttu-id="3c835-128">РасТениЕ</span><span class="sxs-lookup"><span data-stu-id="3c835-128">plant</span></span>|  
|<span data-ttu-id="3c835-129">дереВО</span><span class="sxs-lookup"><span data-stu-id="3c835-129">tReE</span></span>|  
|<span data-ttu-id="3c835-130">tree</span><span class="sxs-lookup"><span data-stu-id="3c835-130">tree</span></span>|  
|<span data-ttu-id="3c835-131">РасТениЕ</span><span class="sxs-lookup"><span data-stu-id="3c835-131">pLaNt</span></span>|  
|<span data-ttu-id="3c835-132">дереВО</span><span class="sxs-lookup"><span data-stu-id="3c835-132">tREE</span></span>|  
  
 <span data-ttu-id="3c835-133">Возможно, данные были получены из многих различных источников, поэтому регистр и использование диакритических знаков было неверным и реляционная база данных сохранила эти отличия как есть.</span><span class="sxs-lookup"><span data-stu-id="3c835-133">Perhaps the data came from many different sources, and so the casing and use of accents was inconsistent, and the relational database stored those differences as is.</span></span> <span data-ttu-id="3c835-134">Однако в целом это либо значения **Растение** , либо **Дерево**просто с разным регистром.</span><span class="sxs-lookup"><span data-stu-id="3c835-134">But in general the values are either **Plant** or **Tree**, just with different casing.</span></span>  
  
 <span data-ttu-id="3c835-135">Когда эти значения загружаются в табличную модель, которая использует параметры сортировки по умолчанию и порядок сортировки для английского языка (США), регистр не имеет значения, поэтому для всего столбца будут храниться только два значения:</span><span class="sxs-lookup"><span data-stu-id="3c835-135">When these values are loaded into a tabular model that uses the default collation and sorting order for English (United States), case is not important, so only two values would be stored for the entire column:</span></span>  
  
|<span data-ttu-id="3c835-136">Классификация ― английский</span><span class="sxs-lookup"><span data-stu-id="3c835-136">Classification - English</span></span>|  
|-------------------------------|  
|<span data-ttu-id="3c835-137">дереВО</span><span class="sxs-lookup"><span data-stu-id="3c835-137">trEE</span></span>|  
|<span data-ttu-id="3c835-138">РасТениЕ</span><span class="sxs-lookup"><span data-stu-id="3c835-138">PlAnT</span></span>|  
  
 <span data-ttu-id="3c835-139">Если в модели используется столбец " **классификация — Английский**", то при отображении классификации завода будут отображаться не исходные значения, а их различные варианты использования верхнего и нижнего регистра, но только первый экземпляр.</span><span class="sxs-lookup"><span data-stu-id="3c835-139">If you use the column, **Classification - English**, in your model, wherever you display plant classification you will see not the original values, with their various uses of upper and lower case, but only the first instance.</span></span> <span data-ttu-id="3c835-140">Причина в том, что все варианты верхнего и нижнего регистров слова **дерево** считаются эквивалентными при этих параметрах сортировки и локали. Таким образом, была оставлена только одна строка, и только первый экземпляр этой строки, найденный системой, будет сохранен.</span><span class="sxs-lookup"><span data-stu-id="3c835-140">The reason is that all the uppercase and lowercase variants of **tree** are considered equivalent in this collation and locale; therefore, only one string was preserved and the first instance of that string that is encountered by the system is the one that is saved.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="3c835-141">Можно решить, какая строка будет сохранена первой, в соответствии с тем, какая строка признана верной, однако реализовать это будет сложно.</span><span class="sxs-lookup"><span data-stu-id="3c835-141">You might decide that you want to define which string will be the first to store, according to what you consider correct, but this could be very hard to so.</span></span> <span data-ttu-id="3c835-142">Не существует простых путей для определения того, какая строка должна быть обработана ядром первой, если учитывать, что все значения считаются одинаковыми.</span><span class="sxs-lookup"><span data-stu-id="3c835-142">There is no simple way to determine in advance which row should be processed first by the engine, given that all values are considered to be the same.</span></span> <span data-ttu-id="3c835-143">Вместо этого, если необходимо задать стандартное значение, очистите все строки, прежде чем загружать модель.</span><span class="sxs-lookup"><span data-stu-id="3c835-143">Instead, if you need to set the standard value, you should cleanse all your strings before loading the model.</span></span>  
  
## <a name="locale-and-collation-order"></a><span data-ttu-id="3c835-144">Локаль и порядок сортировки</span><span class="sxs-lookup"><span data-stu-id="3c835-144">Locale and Collation Order</span></span>  
 <span data-ttu-id="3c835-145">При сравнении строк (текстовых значений) эквивалентность определяется культурным аспектом интерпретации этих строк.</span><span class="sxs-lookup"><span data-stu-id="3c835-145">When comparing strings (text values), what defines equivalence is normally the cultural aspect of how such strings are interpreted.</span></span> <span data-ttu-id="3c835-146">В некоторых странах диакритический знак или верхний регистр символа может полностью изменить значение строки. Поэтому обычно такие отличия учитываются при определении эквивалентности для какого-либо языка или региона.</span><span class="sxs-lookup"><span data-stu-id="3c835-146">In some cultures an accent or the capitalization of a character can completely change the meaning of the string; therefore, typically such differences are considered when determining equivalency for any particular language or region.</span></span>  
  
 <span data-ttu-id="3c835-147">Обычно компьютер уже настроен и соответствует определенному лингвистическому стилю, поэтому строковые операции, такие как сортировка и сравнение текстовых значений, выполняются в соответствии с ожиданиями.</span><span class="sxs-lookup"><span data-stu-id="3c835-147">Usually, when you use your computer it is already configured to match your own cultural expectations and linguistic behavior, and string operations such as sorting and comparing text values behaves as you would expect.</span></span> <span data-ttu-id="3c835-148">Параметры, определяющие зависящее от языка поведение, определяются в настройках **Языки и региональные стандарты** в Windows.</span><span class="sxs-lookup"><span data-stu-id="3c835-148">The settings that control language-specific behavior are defined through the **Locale and Regional** settings in Windows.</span></span> <span data-ttu-id="3c835-149">Приложения считывают эти параметры и изменяют свое поведение соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="3c835-149">Applications read those settings and change their behavior accordingly.</span></span> <span data-ttu-id="3c835-150">В некоторых случаях приложение может иметь функцию, которая позволит изменить культурное поведение приложения или способ сравнения строк.</span><span class="sxs-lookup"><span data-stu-id="3c835-150">In some cases, an application might have a feature that allows you to change the cultural behavior of the application or the way in which strings are compared.</span></span>  
  
 <span data-ttu-id="3c835-151">При создании табличных шаблонов баз данных по умолчанию база данных наследует эти культурные и лингвистические параметры в форме языкового идентификатора и параметров сортировки.</span><span class="sxs-lookup"><span data-stu-id="3c835-151">When you are creating a tabular model database, by default the database inherits these cultural and linguistic settings in the form of a language identifier and collation.</span></span>  
  
-   <span data-ttu-id="3c835-152">Языковой идентификатор определяет набор символов, которые будут использованы для сравнения строк в соответствии с языковой средой.</span><span class="sxs-lookup"><span data-stu-id="3c835-152">The language identifier defines the character set you want to use for your strings according to your culture.</span></span>  
  
-   <span data-ttu-id="3c835-153">Параметры сортировки определяют порядок символов и их эквивалентность.</span><span class="sxs-lookup"><span data-stu-id="3c835-153">The collation defines the ordering of the characters and their equivalence.</span></span>  
  
 <span data-ttu-id="3c835-154">Следует отметить, что языковой идентификатор не только определяет язык, но также и страну или регион, где этот язык используется.</span><span class="sxs-lookup"><span data-stu-id="3c835-154">It is important to note that a language identifier not only identifies a language but, also the country or region where the language is used.</span></span> <span data-ttu-id="3c835-155">Каждый языковой идентификатор также имеет определение параметров сортировки по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="3c835-155">Each language identifier also has a default collation specification.</span></span> <span data-ttu-id="3c835-156">Дополнительные сведения об идентификаторах языков см. в разделе [Номера локалей, назначаемые Microsoft](https://msdn.microsoft.com/goglobal/bb964664.aspx).</span><span class="sxs-lookup"><span data-stu-id="3c835-156">For more information about language identifiers, see [Locale IDs Assigned by Microsoft](https://msdn.microsoft.com/goglobal/bb964664.aspx).</span></span> <span data-ttu-id="3c835-157">При ручной вставке значения можно использовать столбец LCID Dec для получения нужного идентификатора.</span><span class="sxs-lookup"><span data-stu-id="3c835-157">You can use the LCID Dec column to get the correct ID when manually inserting a value.</span></span> <span data-ttu-id="3c835-158">Дополнительные сведения об SQL-концепциях параметров сортировки см. в разделе [COLLATE (Transact-SQL)](/sql/t-sql/statements/collations).</span><span class="sxs-lookup"><span data-stu-id="3c835-158">For more information about the SQL concept of collations, see [COLLATE &#40;Transact-SQL&#41;](/sql/t-sql/statements/collations).</span></span> <span data-ttu-id="3c835-159">Дополнительные сведения об обозначениях параметров сортировки и стилях сравнения для имен параметров сортировки в Windows см. в разделе [Имя параметров сортировки Windows (Transact-SQL)](/sql/t-sql/statements/windows-collation-name-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="3c835-159">For information about the collation designators and the comparison styles for Windows collation names, see [Windows Collation Name &#40;Transact-SQL&#41;](/sql/t-sql/statements/windows-collation-name-transact-sql).</span></span> <span data-ttu-id="3c835-160">В разделе [Имя параметров сортировки SQL Server (Transact-SQL)](/sql/t-sql/statements/sql-server-collation-name-transact-sql) имена параметров сортировки Windows сопоставляются с именами, которые используются для SQL.</span><span class="sxs-lookup"><span data-stu-id="3c835-160">The topic, [SQL Server Collation Name &#40;Transact-SQL&#41;](/sql/t-sql/statements/sql-server-collation-name-transact-sql), maps the Windows collation names to the names used for SQL.</span></span>  
  
 <span data-ttu-id="3c835-161">После создания табличных шаблонов баз данных все новые объекты в модели унаследуют атрибуты языка и параметры сортировки базы данных.</span><span class="sxs-lookup"><span data-stu-id="3c835-161">Once your tabular model database has been created, all new objects in the model will inherit the language and collation attributes from the database attributes.</span></span> <span data-ttu-id="3c835-162">Это верно для всех объектов.</span><span class="sxs-lookup"><span data-stu-id="3c835-162">This is true for all objects.</span></span> <span data-ttu-id="3c835-163">Путь наследования начинается от объекта, находит родительский объект для определения наследуемых атрибутов языка и параметры сортировки, если таковые не найдены, продолжает движение вверх и находит атрибуты языка и сортировки на уровне базы данных.</span><span class="sxs-lookup"><span data-stu-id="3c835-163">The inheritance path begins at the object, looks at the parent for any language and collation attributes to inherit, and if none are found, continues to the top and finds the language and collation attributes at the database level.</span></span> <span data-ttu-id="3c835-164">Другими словами, если не указать атрибуты языка и параметры сортировки для объекта, то по умолчанию объект унаследует атрибуты своего ближайшего родительского элемента.</span><span class="sxs-lookup"><span data-stu-id="3c835-164">In other words, if you do not specify the language and collation attributes for an object, by default, the object inherits the attributes of its closest parent.</span></span>  
  
 <span data-ttu-id="3c835-165">Для столбцов атрибуты языка и параметры сортировки наследуются при создании в соответствии со следующими правилами.</span><span class="sxs-lookup"><span data-stu-id="3c835-165">For columns, the language and collation attributes are inherited at creation, according to the following rules:</span></span>  
  
1.  <span data-ttu-id="3c835-166">Выполняется поиск атрибутов языка и параметров сортировки в родительском объекте измерения.</span><span class="sxs-lookup"><span data-stu-id="3c835-166">The parent dimension object is searched for language and collation attributes.</span></span> <span data-ttu-id="3c835-167">Если существуют оба значения, они копируются в атрибуты столбца. Если существует только одно значение, второе будет вычислено, после чего оба значения будут присвоены. Если оба значения не найдены, выполняется переход к следующему уровню.</span><span class="sxs-lookup"><span data-stu-id="3c835-167">If both values exist, they are copied to the column attributes; if only one exists, the other is inferred from the existing one and both are assigned; if none exist, move to next step.</span></span>  
  
2.  <span data-ttu-id="3c835-168">Поиск объекта базы данных осуществляется с использованием того же процесса, который был описан в шаге 1 для измерений. Если атрибуты не найдены, выполняется переход к следующему шагу.</span><span class="sxs-lookup"><span data-stu-id="3c835-168">The database object is searched using the same process described in Step 1 for dimensions; if no attributes are found, move to the next step.</span></span>  
  
3.  <span data-ttu-id="3c835-169">Поиск серверного объекта выполняется с помощью того же процесса, который был описан в шаге 1 для измерений. Если атрибуты не найдены, столбец использует языковой идентификатор Windows и получает атрибут параметра сортировки от этого значения.</span><span class="sxs-lookup"><span data-stu-id="3c835-169">The server object is searched using the same process described in Step 1 for dimensions; if no attributes are found, the column uses the Windows language identifier and infers the collation attribute from that value.</span></span>  
  
 <span data-ttu-id="3c835-170">Следует отметить, что обычно языковой идентификатор и порядок параметра сортировки в базе данных-источнике практически не влияет на способ хранения значений в столбце табличной модели.</span><span class="sxs-lookup"><span data-stu-id="3c835-170">It is important to note that typically the language identifier and collation order in the source database has little to no effect on how values are stored in the tabular model column.</span></span> <span data-ttu-id="3c835-171">Исключение возникает, если база данных-источник преобразует или фильтрует запрошенные значения.</span><span class="sxs-lookup"><span data-stu-id="3c835-171">The exception is if the source database transforms or filters the requested values.</span></span>  
  
  
