---
title: Планирование обновления данных (PowerPivot для SharePoint) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- unattended data refresh [Analysis Services with SharePoint]
- scheduled data refresh [Analysis Services with SharePoint]
- data refresh [Analysis Services with SharePoint]
ms.assetid: 8571208f-6aae-4058-83c6-9f916f5e2f9b
author: minewiskan
ms.author: owend
ms.openlocfilehash: 9d6078cf59c27c15ead8f22047ba9add20757be7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87656635"
---
# <a name="schedule-a-data-refresh-powerpivot-for-sharepoint"></a>Планирование обновления данных (PowerPivot для SharePoint)
  Предусмотрена возможность планирования автоматического обновления данных PowerPivot в книге Excel, опубликованной на сайте SharePoint.  
  
 **[!INCLUDE[applies](../includes/applies-md.md)]** SharePoint 2010  
  
 **В этом разделе:**  
  
 [Предварительные требования](#prereq)  
  
 [Общие сведения об обновлении данных](#intro)  
  
 [Включение и планирование обновления данных](#drenablesched)  
  
 [Проверка обновления данных](#drverify)  
  
> [!NOTE]  
>  Обновление данных PowerPivot осуществляется экземплярами серверов служб Analysis Services на ферме SharePoint. Оно не связано с функцией обновления данных, предусмотренной в службах Excel. Функция планирования обновления данных PowePivot не будет обновлять данные, не относящиеся к PowerPivot.  
  
##  <a name="prerequisites"></a><a name="prereq"></a> Предварительные требования  
 Для создания расписания обновления данных необходимо иметь для книги уровень разрешения «Участие» или выше.  
  
 Должны быть доступны внешние источники данных, доступ к которым производится во время обновления данных, а для учетных данных, указываемых в расписании, должно быть предоставлено разрешение на доступ к этим источникам данных. Для запланированного обновления данных требуется доступ к расположению источника данных, доступному по сетевому подключению (например, из сетевой общей папки, а не из локальной папки на рабочей станции).  
  
 Источник данных не может быть документом Office или базой данных Access. Office не поддерживает использование компонентов подключения к данным Office в серверной среде. Если книга содержит данные из этих источников, необходимо удалить эти источники из списка источников данных в расписании обновления данных.  
  
 Книга должна иметь версию [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] . При использовании книг, созданных в предыдущем выпуске PowerPivot для Excel, планирование обновления данных работать не будет, пока база данных не будет обновлена до новейшей версии.  
  
 К моменту завершения операции обновления книга должна быть проверена. Блокировка книги устанавливается на файл в конце обновления данных при сохранении файла, а не в начале обновления.  
  
> [!NOTE]  
>  Сервер не блокирует книгу, пока происходит обновление данных. Тем не менее он блокирует файл по окончании обновления данных для проверки обновленного файла. Если в данный момент файл извлечен другим пользователем, обновленные данные будут выдаваться. Аналогично, если файл возвращен, но он значительно отличается от копии, полученной на сервере при начале обновления данных, обновленные данные будут удалены.  
  
##  <a name="data-refresh-overview"></a><a name="intro"></a>Общие сведения об обновлении данных  
 Данные PowerPivot в книге Excel могут быть получены из нескольких внешних источников данных, в том числе из внешних баз данных или файлов данных, доступ к которым осуществляется с удаленных серверов или из сетевых общих папок. Для книг PowerPivot, которые содержат импортированные данные из подключенных или внешних источников данных, можно настроить обновление данных, чтобы запланировать автоматический импорт данных из этих источников.  
  
 Доступ к внешнему источнику данных осуществляется с помощью внедренной строки подключения, URL-адреса или пути в формате UNC, которые указаны при импорте исходных данных в книгу с использованием клиентского приложения PowerPivot. Исходные сведения о соединении, хранящиеся в книге PowerPivot, повторно используются в последующих операциях обновления данных. Несмотря на то, что учетные данные, используемые для соединения с источником данных, можно изменить, строку соединения для обновления данных изменить нельзя; используются только сведения о существующих соединениях.  
  
 Для каждой книги существует только одна страница расписания обновления данных, на которой указаны все сведения. Как правило, расписание определяет пользователь, создающий книгу.  
  
 Владелец расписания выполняет следующие задачи.  
  
-   Определение расписания по умолчанию. Это расписание, которое используется, когда на уровне источника данных не определены расписания.  
  
-   Указание учетных данных для обновления данных  
  
-   Выберите, какие источники данных будут включены в операцию обновления.  
  
-   Укажите встроенные отдельные расписания и учетные данные для каждого источника данных, который запрашивается в ходе обновления данных (необязательно). Каждый источник данных можно обновлять независимо. Если создать пользовательские расписания для каждого источника данных, то расписание по умолчанию не действует.  
  
 Создание подробных расписаний для отдельных источников данных позволяет учесть в расписании обновления непостоянные изменения, происходящие во внешних источниках данных. Например, если внешний источник данных содержит данные о транзакциях, происходящих в течение дня, то можно создать отдельное расписание обновления данных для этого источника данных для получения обновлений ближе к вечеру.  
  
##  <a name="enable-and-schedule-data-refresh"></a><a name="drenablesched"></a>Включение и планирование обновления данных  
 Следующие инструкции описывают процесс планирования обновления данных PowerPivot в книге Excel, опубликованной в библиотеке SharePoint.  
  
1.  В библиотеке, которая содержит книгу, выберите книгу, а затем нажмите стрелку вниз, чтобы открыть список команд.  
  
2.  Щелкните ссылку **Управление обновлением данных PowerPivot**. Если расписание обновления данных уже определено, то вместо этого появится страница «Просмотр журнала обновления данных». Можно нажать **Настройка обновления данных** , чтобы открыть страницу определения расписания.  
  
3.  На странице определения расписания установите флажок **Включить** .  
  
4.  На странице «Подробности расписания» укажите тип расписания и подробные данные расписания. На этом шаге создается расписание по умолчанию.  
  
    > [!IMPORTANT]  
    >  Обязательно установите флажок **Кроме того, как можно скорее обновить данные** . Выполнение этих действий позволит проверить работоспособность обновления данных для этой книги. Следует учитывать, что может потребоваться определенное время для запуска обновления данных после сохранения расписания.  
  
5.  В поле «Самое раннее время запуска» выберите одно из следующих значений.  
  
    1.  Параметр**По окончании рабочего времени** указывает период обработки в нерабочее время, в который на серверах баз данных, вероятнее всего, будут находиться текущие данные, созданные на протяжении рабочего дня.  
  
    2.  Параметр**Заданное самое раннее время запуска** указывает часы и минуты самого раннего времени дня, в которое к очереди обработки добавляется запрос на обновление данных. Время задается с интервалами в 15 минут. Этот параметр относится к текущему дню, а также к будущим датам. Например, если указано значение 6:30, а текущее время — 16:30, то запрос на обновление будет добавлен к очереди в текущий день, поскольку время 16:30 следует за 6:30.  
  
     Самое раннее время начала определяет, когда происходит добавление запроса к очереди процессов. Фактическая обработка происходит после того, как на сервере освободится достаточно ресурсов, чтобы можно было начать обработку данных. Фактическое время обработки записывается в журнал обновления данных после завершения обработки.  
  
6.  Установите флажок **Также обновлять как можно скорее** для запуска обновления при первой же возможности, как только сервер сможет его выполнить. Успешный результат задания обновления данных говорит о том, что источники данных доступны, а разрешения и конфигурация сервера настроены правильно.  
  
7.  В окне «Уведомления по электронной почте» введите адрес электронной почты пользователя, который должен получать уведомление в случае ошибки обработки.  
  
8.  В учетных данных укажите учетную запись, используемую для запуска задания обновления данных. Учетная запись должна иметь разрешения «Участие» по отношению к книге, чтобы можно было открыть книгу для обновления в ней данных. Это должна быть учетная запись пользователя домена Windows. Во многих случаях эта учетная запись должна также иметь разрешения на чтение внешних источников данных, которые используются при обновлении данных. В частности, если изначально данные импортировались с параметром «Использовать проверку подлинности Windows», то строка подключения будет содержать учетные данные Windows текущего пользователя. Если текущим пользователем является учетная запись обновления данных, то для успешного обновления данных у нее должны быть разрешения на внешний источник данных. Выберите один из следующих вариантов.  
  
    1.  Выберите вариант **Использовать учетную запись обновления данных, настроенную администратором** , чтобы обрабатывать операцию обновления данных с помощью учетной записи автоматического обновления данных PowerPivot.  
  
    2.  Выберите вариант **Подключение со следующими учетными данными пользователя Windows** , если нужно вводить имя пользователя и пароль. Данные учетной записи вводятся в формате «домен\пользователь».  
  
    3.  Выберите вариант **Подключение с учетными данными, сохраненными в службе Secure Store** , если известен идентификатор целевого приложения, содержащего ранее сохраненные учетные данные, которые нужно использовать.  
  
     Дополнительные сведения об этих параметрах см. в статьях [Настройка сохраненных учетных данных для обновления данных powerpivot &#40;PowerPivot для SharePoint&#41;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md) и [Настройка учетной записи автоматического обновления данных powerpivot &#40;PowerPivot для SharePoint&#41;](configure-unattended-data-refresh-account-powerpivot-sharepoint.md).  
  
9. В окне «Источники данных» отметьте флажок **Все источники данных** , если нужно, чтобы при обновлении данных были выполнены повторные запросы ко всем исходным источникам данных.  
  
     Если выбран этот параметр, то любой внешний источник данных, который предоставляет данные PowerPivot, автоматически включается в обновление, даже если список источников данных изменился в результате добавления или удаления источников данных, которые предоставляют данные для книги.  
  
     Снимите флажок **Все источники данных** , если необходимо выбрать включаемые источники данных вручную. Если в дальнейшем в книге будет производиться добавление нового источника данных, то следует обязательно обновить список источников данных в расписании. В противном случае новые источники данных не будут включены в операцию обновления.  
  
     Список источников данных, которые можно выбирать, получается из книги PowerPivot при открытии страницы «Управление обновлением данных PowerPivot» для книги.  
  
     Следует выбирать только те источники данных, которые соответствуют следующим критериям.  
  
    -   Источник данных должен быть доступен в указанном расположении в момент обновления данных. Если исходный источник данных находится на локальном диске пользователя, который создал книгу, то необходимо либо исключить этот источник из операции обновления данных, либо опубликовать его в расположении, доступном через сетевое соединение. Если переместить источник данных в сетевую папку, необходимо открыть книгу в [!INCLUDE[ssGeminiClient](../includes/ssgeminiclient-md.md)] и обновить данные о соединении с источником данных. Это необходимо для повторного задания сведений о соединении, которые хранятся в книге PowerPivot.  
  
    -   Доступ к источнику данных должен производиться с использованием учетных данных, внедренных в книгу PowerPivot или указанных в расписании. Внедренные учетные данные хранятся в книге PowerPivot при импорте данных с помощью PowerPivot для Excel. Внедренные учетные данные часто содержат параметр «SSPI = IntegratedSecurity» или «SSPI = TrustedConnection», что означает использование учетных данных текущего пользователя для подключения к источнику данных. Если требуется переопределить учетные данные в расписании обновления данных, можно указать стандартные сохраненные учетные данные. Дополнительные сведения см. в разделе [Настройка сохраненных учетных данных для &#40;обновления данных PowerPivot PowerPivot для SharePoint&#41;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md).  
  
    -   Обновление данных должно завершиться успешно для всех указанных источников данных. В противном случае обновленные данные будут отвергнуты и в распоряжении пользователя останется последняя сохраненная версия книги. Исключите все источники данных, в отношении которых нет полной уверенности.  
  
    -   Обновление данных не должно приводить к тому, что другие данные в книге станут недействительными. При обновлении подмножества данных важно знать, останутся ли данные книги действительными после объединения новых данных с данными, оставшимися неизменными, которые относятся к другому периоду времени. Задача изучения зависимостей в данных и обеспечения приемлемости обновления данных для самой книги возлагается на ее автора.  
  
10. При необходимости можно определить отдельные расписания для конкретных источников данных. Это может потребоваться в том случае, если имеются такие исходные источники данных, которые сами обновляются по расписанию. Например, если в источнике данных PowerPivot используются данные из киоска данных, обновление которой происходит по понедельникам в 02:00, то можно определить встроенное расписание получения обновлений по понедельникам в 04:00.  
  
11. Нажмите кнопку **ОК** , чтобы сохранить расписание.  
  
##  <a name="verify-data-refresh"></a><a name="drverify"></a>Проверка обновления данных  
 Наилучший способ проверить обновление данных — выполнить обновление данных сразу, затем проверить на странице журнала, успешно ли оно выполнено. Наличие установленного флажка **Также обновлять как можно скорее** в расписании обеспечивает проверку работоспособности обновления данных.  
  
 Просмотреть регистрацию текущей и прошлой операций обновления данных можно на странице «Журнал обновления данных» для данной книги. Эта страница отображается только в том случае, если для книги запланировано обновление данных. Если расписание обновления данных отсутствует, то вместо этого появляется страница определения расписания.  
  
 Для просмотра журнала обновления данных необходим уровень разрешений «Участие» или выше.  
  
1.  На сайте SharePoint откройте библиотеку, которая содержит книгу PowerPivot.  
  
     Визуальный индикатор, указывающий, какие книги в библиотеке SharePoint содержат данные PowerPivot, отсутствует. Книги, содержащие обновляемые данные PowerPivot, должны быть известны заранее.  
  
2.  Выберите книгу и нажмите стрелку вниз, которая появляется справа.  
  
3.  Щелкните ссылку **Управление обновлением данных PowerPivot**.  
  
 Отображается страница истории, показывающая полную запись всех действий обновления для данных PowerPivot в текущей книге Excel, включая состояние последней операции обновления данных.  
  
 В некоторых случаях могут быть показаны фактические значения времени обработки, которые отличаются от времени, указанного пользователем. Это происходит в том случае, если сервер испытывает интенсивную рабочую нагрузку. При сильной нагрузке экземпляр службы [!INCLUDE[ssGemini](../includes/ssgemini-md.md)] ожидает освобождения достаточного объема системных ресурсов и только после этого приступает к обновлению данных.  
  
 После завершения операции обновления книга должна быть возвращена. Вслед за этим происходит сохранение книги с обновленными данными. Если файл извлечен, то обновление данных пропускается до следующего запланированного времени.  
  
 Если обнаруживается непредвиденное сообщение о состоянии (например, о том, что операция обновления завершилась сбоем или была отменена), то причины возникшей проблемы можно узнать, проверив разрешения и доступность сервера.  
  
 Просмотрите страницу устранения неполадок обновления данных PowerPivot в сети TechNet WIKI для получения справки по разрешению проблем обновления данных. Дополнительные сведения см. в разделе [Устранение неполадок обновления данных PowerPivot](https://go.microsoft.com/fwlink/?LinkId=251594)  
  
> [!NOTE]  
>  Администраторы SharePoint могут помочь в устранении неполадок с обновлением данных, просмотрев сводные отчеты по обновлению данных на панели мониторинга PowerPivot в центре администрирования. Дополнительные сведения см. в разделе [PowerPivot Management Dashboard and Usage Data](power-pivot-sharepoint/power-pivot-management-dashboard-and-usage-data.md).  
  
## <a name="see-also"></a>См. также:  
 [Обновление данных PowerPivot с SharePoint 2010](powerpivot-data-refresh-with-sharepoint-2010.md)   
 [Просмотр журнала обновления данных &#40;PowerPivot для SharePoint&#41;](power-pivot-sharepoint/view-data-refresh-history-power-pivot-for-sharepoint.md)   
 [Настройка сохраненных учетных данных для &#40;обновления данных PowerPivot PowerPivot для SharePoint&#41;](configure-stored-credentials-data-refresh-powerpivot-sharepoint.md)  
  
  
