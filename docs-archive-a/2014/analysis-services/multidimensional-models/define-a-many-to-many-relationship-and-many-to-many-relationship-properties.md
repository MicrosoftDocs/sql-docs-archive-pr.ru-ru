---
title: Определение связи «многие ко многим» и свойства связей «многие ко многим» | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- many-to-many relationships [Analysis Services]
ms.assetid: edb5f61a-a581-467a-a367-134b7f9b849f
author: minewiskan
ms.author: owend
ms.openlocfilehash: 1cd5d46ce07ff8eb6a3893c0dac261797c6ef19e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87667919"
---
# <a name="define-a-many-to-many-relationship-and-many-to-many-relationship-properties"></a><span data-ttu-id="8459a-102">Определение связей "многие ко многим" и свойств связей "многие ко многим"</span><span class="sxs-lookup"><span data-stu-id="8459a-102">Define a Many-to-Many Relationship and Many-to-Many Relationship Properties</span></span>
  <span data-ttu-id="8459a-103">В этом разделе рассматривается измерения «многие ко многим» в службах Analysis Services, включая случаи их использования и способы создания.</span><span class="sxs-lookup"><span data-stu-id="8459a-103">This topic explains many-to-many dimensions in Analysis Services, including when to use them and how to create them.</span></span>  
  
## <a name="introduction"></a><span data-ttu-id="8459a-104">Введение</span><span class="sxs-lookup"><span data-stu-id="8459a-104">Introduction</span></span>  
 <span data-ttu-id="8459a-105">Службы Analysis Services поддерживают измерения «многие ко многим», позволяя проводить более сложный анализ, чем тот, что может быть описан в классической схеме звезды.</span><span class="sxs-lookup"><span data-stu-id="8459a-105">Analysis Services supports many-to-many dimensions, allowing for more complex analytics than what can be described in a classic star schema.</span></span> <span data-ttu-id="8459a-106">В классической схеме звезды все измерения имеют связь «один ко многим» с таблицей фактов.</span><span class="sxs-lookup"><span data-stu-id="8459a-106">In a classic star schema, all dimensions have a one-to-many relationship with a fact table.</span></span> <span data-ttu-id="8459a-107">Каждый факт соединяется с одним элементом измерения, а один элемент измерения связан с несколькими фактами.</span><span class="sxs-lookup"><span data-stu-id="8459a-107">Each fact joins to one dimension member; a single dimension member is associated with many facts.</span></span>  
  
 <span data-ttu-id="8459a-108">Отношение «многие ко многим» убирает это ограничение моделирования, позволяя факту (например, балансу счета) быть связанным с несколькими членами того же измерения (баланс объединенного счета может рассматриваться как атрибут двумя или несколькими владельцами объединенного счета).</span><span class="sxs-lookup"><span data-stu-id="8459a-108">Many-to-many removes this modeling restriction by enabling a fact (such as an account balance) to be associated with multiple members of the same dimension (the balance of a joint account can be attributed to two or more owners of a joint account).</span></span>  
  
 <span data-ttu-id="8459a-109">Концептуально связь измерения «многие ко многим» в службах Analysis Services эквивалентна связям в реляционной модели и поддерживает те же виды сценариев.</span><span class="sxs-lookup"><span data-stu-id="8459a-109">Conceptually, a many-to-many dimensional relationship in Analysis Services is equivalent to many-to-many relationships in a relational model, supporting the same kinds of scenarios.</span></span> <span data-ttu-id="8459a-110">Примеры подобной связи приведены ниже.</span><span class="sxs-lookup"><span data-stu-id="8459a-110">Common examples of many-to-many include:</span></span>  
  
-   <span data-ttu-id="8459a-111">Студенты записаны на несколько курсов, каждый курс имеет несколько студентов.</span><span class="sxs-lookup"><span data-stu-id="8459a-111">Students are enrolled in many courses; each course has many students.</span></span>  
  
-   <span data-ttu-id="8459a-112">Врачи принимают много пациентов, пациенты ходят к нескольким врачам.</span><span class="sxs-lookup"><span data-stu-id="8459a-112">Doctors have many patients; patients have many doctors.</span></span>  
  
-   <span data-ttu-id="8459a-113">Клиенты имеют несколько банковских счетов, банковские счета могут принадлежать более чем одному клиенту.</span><span class="sxs-lookup"><span data-stu-id="8459a-113">Customers have many bank accounts; bank accounts might belong to more than one customer.</span></span>  
  
-   <span data-ttu-id="8459a-114">В Adventure Works многие клиенты имеют несколько причин для заказа товара, а причина покупки может быть связана с несколькими заказами.</span><span class="sxs-lookup"><span data-stu-id="8459a-114">In Adventure Works, many customers have many reasons for ordering a product, and a sales reason can be associated with many orders.</span></span>  
  
 <span data-ttu-id="8459a-115">С точки зрения аналитики связь «многие ко многим» решает проблему точного представления количества или суммы относительно связи измерения (исключая двойные подсчеты при обработке определенного члена измерения).</span><span class="sxs-lookup"><span data-stu-id="8459a-115">Analytically, the problem that a many-to-many relationship solves is accurate representation of a count or sum relative to the dimensional relationship (usually by eliminating double-counts when performing calculations for a specific dimension member).</span></span> <span data-ttu-id="8459a-116">Следующий пример позволяет прояснить это утверждение.</span><span class="sxs-lookup"><span data-stu-id="8459a-116">An example is necessary to clarify this point.</span></span> <span data-ttu-id="8459a-117">Рассмотрим продукт или услугу, которые относятся более чем к одной категории.</span><span class="sxs-lookup"><span data-stu-id="8459a-117">Consider a product or service that belongs to more than one category.</span></span> <span data-ttu-id="8459a-118">Если количество услуг подсчитывалось по категории, нужно, чтобы услуга, входящая в обе категории, была включена в каждую.</span><span class="sxs-lookup"><span data-stu-id="8459a-118">If you were counting the number of services by category, you would want a service belonging to both categories to be included in each one.</span></span> <span data-ttu-id="8459a-119">В то же время нежелательно переоценивать количество предоставляемых услуг.</span><span class="sxs-lookup"><span data-stu-id="8459a-119">At the same time, you would not want to overstate the number of services that you provide.</span></span> <span data-ttu-id="8459a-120">Указание связи измерения «многие ко многим» позволяет получать более точные результаты при запросе по категории или услуге.</span><span class="sxs-lookup"><span data-stu-id="8459a-120">By specifying the many-to-many dimensional relationship, you are more likely to get the correct results back when querying by category or by service.</span></span> <span data-ttu-id="8459a-121">Однако следует всегда проводить тщательную проверку правильности результатов.</span><span class="sxs-lookup"><span data-stu-id="8459a-121">However, thorough testing is always necessary to ensure that this is the case.</span></span>  
  
 <span data-ttu-id="8459a-122">С точки зрения структуры создание связи измерения «многие ко многим» сходно с созданием связи в реляционной модели данных.</span><span class="sxs-lookup"><span data-stu-id="8459a-122">Structurally, creating a many-to-many dimensional relationship is similar to how you might create many-to-many in a relational data model.</span></span> <span data-ttu-id="8459a-123">В реляционной модели для хранения ассоциаций строк используется *связующая таблица* , а в многомерной модели — *промежуточная группа мер*.</span><span class="sxs-lookup"><span data-stu-id="8459a-123">Whereas a relational model uses a *junction table* to store row associations, a multidimensional model uses an *intermediate measure group*.</span></span> <span data-ttu-id="8459a-124">Промежуточная группа мер — это термин, которым описывается таблица, сопоставляющая члены из разных измерений.</span><span class="sxs-lookup"><span data-stu-id="8459a-124">Intermediate measure group is the term we use to refer to a table that maps members from different dimensions.</span></span>  
  
 <span data-ttu-id="8459a-125">Связь «многие ко многим» не отображается визуально в диаграмме куба.</span><span class="sxs-lookup"><span data-stu-id="8459a-125">Visually, a many-to-many dimensional relationship is not indicated in a cube diagram.</span></span> <span data-ttu-id="8459a-126">Вместо нее используйте вкладку «Использование измерения» для быстрого определения подобных связей в модели.</span><span class="sxs-lookup"><span data-stu-id="8459a-126">Instead, use the Dimension Usage tab to quickly identify any many-to-many relationships in a model.</span></span> <span data-ttu-id="8459a-127">Связь «многие ко многим» обозначается следующим значком:</span><span class="sxs-lookup"><span data-stu-id="8459a-127">A many-to-many relationship is indicated by the following icon.</span></span>  
  
 <span data-ttu-id="8459a-128">![Значок «многие ко многим» при использовании измерения](../media/ssas-m2m-icondimusage.png "Значок «многие ко многим» при использовании измерения")</span><span class="sxs-lookup"><span data-stu-id="8459a-128">![Many-to-many icon in dimension usage](../media/ssas-m2m-icondimusage.png "Many-to-many icon in dimension usage")</span></span>  
  
 <span data-ttu-id="8459a-129">Нажмите кнопку, чтобы открыть окно «Определение связи» и проверить тип связи, а также узнать, какая промежуточная группа мер используется в связи.</span><span class="sxs-lookup"><span data-stu-id="8459a-129">Click the button to open the Define Relationship dialog box to verify the relationship type is many-to-many, and to view which intermediate measure group is used in the relationship.</span></span>  
  
 <span data-ttu-id="8459a-130">![Кнопка "определить связь" в использовании измерения](../media/ssas-m2m-btndimusage.png "Кнопка "определить связь" в использовании измерения")</span><span class="sxs-lookup"><span data-stu-id="8459a-130">![Define Relationship button  in dimension usage](../media/ssas-m2m-btndimusage.png "Define Relationship button  in dimension usage")</span></span>  
  
 <span data-ttu-id="8459a-131">В последующих подразделах вы узнаете, как настраивать измерение «многие ко многим» и тестировать поведение модели.</span><span class="sxs-lookup"><span data-stu-id="8459a-131">In subsequent sections, you will learn how to set up a many-to-many dimension and test model behaviors.</span></span> <span data-ttu-id="8459a-132">Если вы предпочитаете сначала просмотреть дополнительную информацию или пройти обучение, см. раздел **Дополнительные сведения** в конце данной статьи.</span><span class="sxs-lookup"><span data-stu-id="8459a-132">If you would rather review additional information or try tutorials first, see **Learn More** at the end of this article.</span></span>  
  
## <a name="create-a-many-to-many-dimension"></a><span data-ttu-id="8459a-133">Создание измерения «многие ко многим»</span><span class="sxs-lookup"><span data-stu-id="8459a-133">Create a many-to-many dimension</span></span>  
 <span data-ttu-id="8459a-134">Простая связь «многие ко многим» включает два измерения с количеством элементов «многие ко многим», промежуточную группу мер для хранения ассоциаций членов и группу мер фактов с измеряемыми данными, такими как сумма общих продаж или баланс банковского счета.</span><span class="sxs-lookup"><span data-stu-id="8459a-134">A simple many-to-many relationship includes two dimensions having a many-to-many cardinality, an intermediate measure group for storing member associations, and a fact measure group containing measurable data, such as sum of total sales or the balance of a bank account.</span></span>  
  
 <span data-ttu-id="8459a-135">Измерения в связи «многие ко многим» могут иметь соответствующие таблицы в представлении источника данных, где каждое измерение в модели основывается на таблице в источнике данных.</span><span class="sxs-lookup"><span data-stu-id="8459a-135">Dimensions in a many-to-many relationship might have correspondent tables in the DSV, where each dimension in the model is based on an existing table in a data source.</span></span> <span data-ttu-id="8459a-136">И наоборот, измерения в конкретной модели могут основываться на меньшем числе физических таблиц (или на других таблицах) в представлении источника данных.</span><span class="sxs-lookup"><span data-stu-id="8459a-136">Conversely, the dimensions in your model might derive from fewer or different physical tables in the DSV.</span></span> <span data-ttu-id="8459a-137">Используя измерения Sales Reasons и Sales Orders в качестве примера, куб Adventure Works демонстрирует связь «многие ко многим» с помощью измерений, которые существуют только как структуры данных и только в модели без физических аналогов в представлении источника данных.</span><span class="sxs-lookup"><span data-stu-id="8459a-137">Using Sales Reasons and Sales Orders as a case in point, the Adventure Works sample cube demonstrates a many-to-many relationship using dimensions that exist as model-only data structures, without physical counterparts in the DSV.</span></span> <span data-ttu-id="8459a-138">Измерение Sales Order основано на таблице фактов, а не на таблице измерения в источнике данных.</span><span class="sxs-lookup"><span data-stu-id="8459a-138">The Sales Order dimension is based on a fact table, rather than a dimension table, in the underlying data source.</span></span>  
  
 <span data-ttu-id="8459a-139">Следующая процедура подразумевает, что уже известно, какие сущности участвуют в связи «многие ко многим».</span><span class="sxs-lookup"><span data-stu-id="8459a-139">The next procedure assumes that you already know which entities participate in the many-to-many relationship.</span></span> <span data-ttu-id="8459a-140">Более подробную информацию см. в разделе **Дополнительные сведения** .</span><span class="sxs-lookup"><span data-stu-id="8459a-140">See **Learn More** for further study.</span></span>  
  
 <span data-ttu-id="8459a-141">Для иллюстрации шагов по созданию связи «многие ко многим» данная процедура воссоздает одну из подобных связей в кубе Adventure Works.</span><span class="sxs-lookup"><span data-stu-id="8459a-141">To illustrate the steps used to create a many-to-many relationship, this procedure re-creates one of the many-to-many relationships in the Adventure Works sample cube.</span></span> <span data-ttu-id="8459a-142">Если у вас есть источник данных (в данном случае хранилище данных примера Adventure Works), установленный на экземпляре реляционной СУБД, вы можете выполнить следующую процедуру.</span><span class="sxs-lookup"><span data-stu-id="8459a-142">If you have the source data (that is, the Adventure Works sample data warehouse) installed on a relational database engine instance, you can follow these steps.</span></span>  
  
#### <a name="step-1-verify-dsv-relationships"></a><span data-ttu-id="8459a-143">Шаг 1. Проверка связей представления источника данных</span><span class="sxs-lookup"><span data-stu-id="8459a-143">Step 1: Verify DSV relationships</span></span>  
  
1.  <span data-ttu-id="8459a-144">В приложении SQL Server Data Tools для многомерного проекта создайте источник данных для реляционного хранилища данных Adventure Works DW 2012, размещенного на экземпляре SQL Server Database Engine.</span><span class="sxs-lookup"><span data-stu-id="8459a-144">In SQL Server Data Tools, in a multidimensional project, create a data source to the Adventure Works DW 2012 relational data warehouse, hosted on a SQL Server Database Engine instance.</span></span>  
  
2.  <span data-ttu-id="8459a-145">Создайте представление источника данных, используя следующие таблицы:</span><span class="sxs-lookup"><span data-stu-id="8459a-145">Create a Data Source View using the following existing tables:</span></span>  
  
    -   <span data-ttu-id="8459a-146">FactInternetSales</span><span class="sxs-lookup"><span data-stu-id="8459a-146">FactInternetSales</span></span>  
  
    -   <span data-ttu-id="8459a-147">FactInternetSalesReason</span><span class="sxs-lookup"><span data-stu-id="8459a-147">FactInternetSalesReason</span></span>  
  
    -   <span data-ttu-id="8459a-148">DimSalesReason</span><span class="sxs-lookup"><span data-stu-id="8459a-148">DimSalesReason</span></span>  
  
3.  <span data-ttu-id="8459a-149">Проверьте, чтобы все таблицы, планируемые к использованию в связях «многие ко многим», были связаны в представлении источника данных через первичный ключ.</span><span class="sxs-lookup"><span data-stu-id="8459a-149">Verify that all of the tables you plan to use in the many-to-many relationships are related in the DSV through primary key relationships.</span></span> <span data-ttu-id="8459a-150">Это обязательно для формирования ссылки на промежуточную группу мер в последующем шаге.</span><span class="sxs-lookup"><span data-stu-id="8459a-150">This is a requirement for establishing a link to the intermediate measure group in a subsequent step.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="8459a-151">Если нижележащий источник данных не предоставляет связи по первичному и внешнему ключу, можно создать связи в представлении источника данных вручную.</span><span class="sxs-lookup"><span data-stu-id="8459a-151">If the underlying data source does not provide primary and foreign key relationships, you can create the relationships manually in the DSV.</span></span> <span data-ttu-id="8459a-152">Дополнительные сведения см. в разделе [Определение логических связей в представлении источника данных (службы Analysis Services)](define-logical-relationships-in-a-data-source-view-analysis-services.md).</span><span class="sxs-lookup"><span data-stu-id="8459a-152">For more information, see [Define Logical Relationships in a Data Source View &#40;Analysis Services&#41;](define-logical-relationships-in-a-data-source-view-analysis-services.md).</span></span>  
  
     <span data-ttu-id="8459a-153">Следующий пример подтверждает, что таблицы, используемые в данной процедуре, связаны по первичным ключам.</span><span class="sxs-lookup"><span data-stu-id="8459a-153">The following example confirms that the tables used in this procedure are linked using primary keys.</span></span>  
  
     <span data-ttu-id="8459a-154">![Представление источника данных, отображающее связанные таблицы](../media/ssas-m2m-dsvpkeys.PNG "Представление источника данных, отображающее связанные таблицы")</span><span class="sxs-lookup"><span data-stu-id="8459a-154">![DSV showing related tables](../media/ssas-m2m-dsvpkeys.PNG "DSV showing related tables")</span></span>  
  
#### <a name="step-2-create-dimensions-and-measure-groups"></a><span data-ttu-id="8459a-155">Шаг 2. Создание измерений и групп мер</span><span class="sxs-lookup"><span data-stu-id="8459a-155">Step 2: Create dimensions and measure groups</span></span>  
  
1.  <span data-ttu-id="8459a-156">В среде SQL Server Data Tools для многомерного проекта щелкните правой кнопкой мыши папку **Измерения** и выберите **Создать измерение**.</span><span class="sxs-lookup"><span data-stu-id="8459a-156">In SQL Server Data Tools, in a multidimensional project, right-click **Dimensions** and select **New Dimension**.</span></span>  
  
2.  <span data-ttu-id="8459a-157">Создайте новое измерение на основе существующей таблицы **DimSalesReason**.</span><span class="sxs-lookup"><span data-stu-id="8459a-157">Create a new dimension based on existing table, **DimSalesReason**.</span></span> <span data-ttu-id="8459a-158">При указании источника примите все значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="8459a-158">Accept all of the default values when specifying the source.</span></span>  
  
     <span data-ttu-id="8459a-159">Выберите все атрибуты.</span><span class="sxs-lookup"><span data-stu-id="8459a-159">For attributes, select all.</span></span>  
  
     <span data-ttu-id="8459a-160">![Список атрибутов в новом измерении](../media/ssas-m2m-dimsalesreason.PNG "Список атрибутов в новом измерении")</span><span class="sxs-lookup"><span data-stu-id="8459a-160">![Attributes list in new dimension](../media/ssas-m2m-dimsalesreason.PNG "Attributes list in new dimension")</span></span>  
  
3.  <span data-ttu-id="8459a-161">Создайте второе измерение на основе существующей таблицы Fact Internet Sales.</span><span class="sxs-lookup"><span data-stu-id="8459a-161">Create a second dimension based on existing table, Fact Internet Sales.</span></span> <span data-ttu-id="8459a-162">Эта таблица фактов содержит информацию измерения Sales Order.</span><span class="sxs-lookup"><span data-stu-id="8459a-162">Although this is a fact table, it contains Sales Order information.</span></span> <span data-ttu-id="8459a-163">Мы используем ее для построения этого измерения.</span><span class="sxs-lookup"><span data-stu-id="8459a-163">We'll use it to build a Sales Order dimension.</span></span>  
  
4.  <span data-ttu-id="8459a-164">В окне указания сведений об источнике вы увидите предупреждение о том, что нужно указать столбец Name.</span><span class="sxs-lookup"><span data-stu-id="8459a-164">In Specify Source Information, you will see a warning that indicates a Name column must be specified.</span></span> <span data-ttu-id="8459a-165">Выберите **SalesOrderNumber** в качестве Name.</span><span class="sxs-lookup"><span data-stu-id="8459a-165">Choose **SalesOrderNumber** as the Name.</span></span>  
  
     <span data-ttu-id="8459a-166">![Измерение заказа на продажу, отображающее столбец имен](../media/ssas-m2m-dimsalesordersource.PNG "Измерение заказа на продажу, отображающее столбец имен")</span><span class="sxs-lookup"><span data-stu-id="8459a-166">![Sales Order dimension showing the name column](../media/ssas-m2m-dimsalesordersource.PNG "Sales Order dimension showing the name column")</span></span>  
  
5.  <span data-ttu-id="8459a-167">На следующей странице мастера выберите атрибуты.</span><span class="sxs-lookup"><span data-stu-id="8459a-167">On the next page of the wizard, choose the attributes.</span></span> <span data-ttu-id="8459a-168">В данном примере можно выбрать только **SalesOrderNumber**.</span><span class="sxs-lookup"><span data-stu-id="8459a-168">In this example, you can select just **SalesOrderNumber**.</span></span>  
  
     <span data-ttu-id="8459a-169">![Измерение заказа на продажу, отображающее список атрибутов](../media/ssas-m2m-dimsalesorderattrib.PNG "Измерение заказа на продажу, отображающее список атрибутов")</span><span class="sxs-lookup"><span data-stu-id="8459a-169">![Sales order dimension showing attribute list](../media/ssas-m2m-dimsalesorderattrib.PNG "Sales order dimension showing attribute list")</span></span>  
  
6.  <span data-ttu-id="8459a-170">Переименуйте измерение в **Dim Sales Orders**, придерживаясь согласованного порядка именования измерений.</span><span class="sxs-lookup"><span data-stu-id="8459a-170">Rename the dimension to **Dim Sales Orders**, so that you have a consistent naming convention for the dimensions.</span></span>  
  
     <span data-ttu-id="8459a-171">![Страница мастера, отображающая переименование измерения](../media/ssas-m2m-dimsalesorders.PNG "Страница мастера, отображающая переименование измерения")</span><span class="sxs-lookup"><span data-stu-id="8459a-171">![Wizard page showing dimension rename](../media/ssas-m2m-dimsalesorders.PNG "Wizard page showing dimension rename")</span></span>  
  
7.  <span data-ttu-id="8459a-172">Щелкните правой кнопкой мыши **Кубы** и выберите пункт **Создать куб**.</span><span class="sxs-lookup"><span data-stu-id="8459a-172">Right-click **Cubes** and select **New Cube**.</span></span>  
  
8.  <span data-ttu-id="8459a-173">В таблицах групп мер выберите **FactInternetSales** и **FactInternetSalesReason**.</span><span class="sxs-lookup"><span data-stu-id="8459a-173">In measure group tables, choose **FactInternetSales** and **FactInternetSalesReason**.</span></span>  
  
     <span data-ttu-id="8459a-174">**FactInternetSales** следует выбрать, поскольку этот элемент содержит меры, которые мы будем использовать в кубе.</span><span class="sxs-lookup"><span data-stu-id="8459a-174">You are choosing **FactInternetSales** because it contains the measures you want to use in the cube.</span></span> <span data-ttu-id="8459a-175">А выбор **FactInternetSalesReason** обусловлен тем, что это промежуточная группа мер, предоставляющая сведения о связях заказов на покупку и причин покупки.</span><span class="sxs-lookup"><span data-stu-id="8459a-175">You are choosing **FactInternetSalesReason** because it is the intermediate measure group, providing member association data that relates sales orders to sales reasons.</span></span>  
  
9. <span data-ttu-id="8459a-176">Выберите меры для каждой таблицы фактов.</span><span class="sxs-lookup"><span data-stu-id="8459a-176">Choose measures for each fact table.</span></span>  
  
     <span data-ttu-id="8459a-177">Чтобы упростить модель, уберите все меры, затем выберите в нижней части списка лишь **Sales Amount** и **Fact Internet Sales Count** .</span><span class="sxs-lookup"><span data-stu-id="8459a-177">To simplify your model, clear all the measures, and then select just **Sales Amount** and **Fact Internet Sales Count** at the bottom of the list.</span></span> <span data-ttu-id="8459a-178">**FactInternetSalesReason** имеет только одну меру, поэтому выбирается автоматически.</span><span class="sxs-lookup"><span data-stu-id="8459a-178">The **FactInternetSalesReason** only has one measure, so it is selected for you automatically.</span></span>  
  
10. <span data-ttu-id="8459a-179">В списке измерений будут отображаться **Dim Sales Reason** и **Dim Sales Orders**.</span><span class="sxs-lookup"><span data-stu-id="8459a-179">In the dimension list, you should see **Dim Sales Reason** and **Dim Sales Orders**.</span></span>  
  
     <span data-ttu-id="8459a-180">На странице "Выбор новых измерений" появится приглашение на создание нового измерения для **Fact Internet Sales Dimension**.</span><span class="sxs-lookup"><span data-stu-id="8459a-180">In the Select New Dimensions page, the wizard prompts you to create a new dimension for **Fact Internet Sales Dimension**.</span></span> <span data-ttu-id="8459a-181">Это измерение не требуется, поэтому его можно убрать из списка.</span><span class="sxs-lookup"><span data-stu-id="8459a-181">You do not need this dimension, so you can clear it from the list.</span></span>  
  
11. <span data-ttu-id="8459a-182">Присвойте кубу имя и нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="8459a-182">Name the cube and click **Finish**.</span></span>  
  
#### <a name="step-3-define-many-to-many-relationship"></a><span data-ttu-id="8459a-183">Шаг 3. Определение связи "многие ко многим"</span><span class="sxs-lookup"><span data-stu-id="8459a-183">Step 3: Define Many-to-Many relationship</span></span>  
  
1.  <span data-ttu-id="8459a-184">В конструкторе кубов щелкните вкладку Использование измерений. Обратите внимание, что связь «многие ко многим» между **изм продаж** и **фактом Интернет-продаж**уже существует.</span><span class="sxs-lookup"><span data-stu-id="8459a-184">In cube designer, click Dimension Usage tab. Notice that there is already a many-to-many relationship between **Dim Sales Reason** and **Fact Internet Sales**.</span></span> <span data-ttu-id="8459a-185">Напомним, что связь «многие ко многим» обозначается следующим значком.</span><span class="sxs-lookup"><span data-stu-id="8459a-185">Recall that the following icon indicates a many-to-many relationship.</span></span>  
  
     <span data-ttu-id="8459a-186">![Значок «многие ко многим» при использовании измерения](../media/ssas-m2m-icondimusage.png "Значок «многие ко многим» при использовании измерения")</span><span class="sxs-lookup"><span data-stu-id="8459a-186">![Many-to-many icon in dimension usage](../media/ssas-m2m-icondimusage.png "Many-to-many icon in dimension usage")</span></span>  
  
2.  <span data-ttu-id="8459a-187">Щелкните ячейку на пересечении **Dim Sales Reason** и **Fact Internet Sales**, затем нажмите кнопку, чтобы открыть окно определения связи.</span><span class="sxs-lookup"><span data-stu-id="8459a-187">Click on the intersection cell between **Dim Sales Reason** and **Fact Internet Sales**, and then click the button to open the Define Relationship dialog box.</span></span>  
  
     <span data-ttu-id="8459a-188">В этом диалоговом окне можно указать связь «многие ко многим».</span><span class="sxs-lookup"><span data-stu-id="8459a-188">You can see that this dialog box is used to specify a many-to-many relationship.</span></span> <span data-ttu-id="8459a-189">Если бы мы добавляли измерения с обычной связью, то в этом окне изменили бы их на «многие ко многим».</span><span class="sxs-lookup"><span data-stu-id="8459a-189">If you were adding dimensions that had a regular relationship instead, you would use this dialog box to change it to many-to-many.</span></span>  
  
     <span data-ttu-id="8459a-190">![Кнопка "определить связь" в использовании измерения](../media/ssas-m2m-btndimusage.png "Кнопка "определить связь" в использовании измерения")</span><span class="sxs-lookup"><span data-stu-id="8459a-190">![Define Relationship button  in dimension usage](../media/ssas-m2m-btndimusage.png "Define Relationship button  in dimension usage")</span></span>  
  
3.  <span data-ttu-id="8459a-191">Разверните проект в многомерный экземпляр служб Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="8459a-191">Deploy the project to an Analysis Services multidimensional instance.</span></span> <span data-ttu-id="8459a-192">В следующем шаге мы откроем куб в Excel, чтобы проверить его поведение.</span><span class="sxs-lookup"><span data-stu-id="8459a-192">In the next step, you will browse the cube in Excel to verify its behaviors.</span></span>  
  
## <a name="testing-many-to-many"></a><span data-ttu-id="8459a-193">Тестирование связи «многие ко многим»</span><span class="sxs-lookup"><span data-stu-id="8459a-193">Testing Many-to-Many</span></span>  
 <span data-ttu-id="8459a-194">При задании в кубе связи «многие ко многим» тестирование результатов является обязательным.</span><span class="sxs-lookup"><span data-stu-id="8459a-194">When you define a many-to-many relationship in a cube, testing is imperative to ensure queries return expected results.</span></span> <span data-ttu-id="8459a-195">Необходимо тестировать куб с помощью клиентского приложения, которое будут использовать конечные пользователи.</span><span class="sxs-lookup"><span data-stu-id="8459a-195">You should test the cube using the client application tool that will be used by end-users.</span></span> <span data-ttu-id="8459a-196">В следующей процедуре мы откроем куб в Excel, чтобы проверить результаты запросов.</span><span class="sxs-lookup"><span data-stu-id="8459a-196">In this next procedure, you will use Excel to connect to the cube and verify query results.</span></span>  
  
#### <a name="browse-the-cube-in-excel"></a><span data-ttu-id="8459a-197">Откройте куб в Excel</span><span class="sxs-lookup"><span data-stu-id="8459a-197">Browse the cube in Excel</span></span>  
  
1.  <span data-ttu-id="8459a-198">Разверните проект, затем откройте куб, чтобы подтвердить правильность выполнения агрегирований.</span><span class="sxs-lookup"><span data-stu-id="8459a-198">Deploy the project and then browse the cube to confirm the aggregations are valid.</span></span>  
  
2.  <span data-ttu-id="8459a-199">В Excel щелкните **данные**  |  **из других источников**  |  **Analysis Services**.</span><span class="sxs-lookup"><span data-stu-id="8459a-199">In Excel, click **Data** | **From Other Sources** | **From Analysis Services**.</span></span> <span data-ttu-id="8459a-200">Введите имя сервера, выберите базу данных и куб.</span><span class="sxs-lookup"><span data-stu-id="8459a-200">Enter the name of the server, choose the database and cube.</span></span>  
  
3.  <span data-ttu-id="8459a-201">Создайте сводную таблицу, которая использует следующее:</span><span class="sxs-lookup"><span data-stu-id="8459a-201">Create a PivotTable that uses the following:</span></span>  
  
    -   <span data-ttu-id="8459a-202">**Sales Amount** как значение</span><span class="sxs-lookup"><span data-stu-id="8459a-202">**Sales Amount** as the Value</span></span>  
  
    -   <span data-ttu-id="8459a-203">**Sales Reason Name** для столбцов</span><span class="sxs-lookup"><span data-stu-id="8459a-203">**Sales Reason Name** on Columns</span></span>  
  
    -   <span data-ttu-id="8459a-204">**Sales Order Number** для строк</span><span class="sxs-lookup"><span data-stu-id="8459a-204">**Sales Order Number** on Rows</span></span>  
  
4.  <span data-ttu-id="8459a-205">Проанализируйте результаты.</span><span class="sxs-lookup"><span data-stu-id="8459a-205">Analyze the results.</span></span> <span data-ttu-id="8459a-206">Мы используем примеры данных, поэтому на первый взгляд кажется, что все заказы на продажу имеют одинаковые значения.</span><span class="sxs-lookup"><span data-stu-id="8459a-206">Because we are using sample data, the initial impression is that all sales orders have identical values.</span></span> <span data-ttu-id="8459a-207">Но если выполнить прокрутку результатов вниз, то можно видеть разброс данных.</span><span class="sxs-lookup"><span data-stu-id="8459a-207">However, if you scroll down, you begin to see data variation.</span></span>  
  
     <span data-ttu-id="8459a-208">Немного ниже вы увидите сумму продаж и причины для заказа с номером **SO5382**.</span><span class="sxs-lookup"><span data-stu-id="8459a-208">Part way down, you can find the sales amount and sales reasons for order number **SO5382**.</span></span> <span data-ttu-id="8459a-209">Общая сумма этого заказа — **539,99**, а в качестве причин указаны Promotion, Other и Price.</span><span class="sxs-lookup"><span data-stu-id="8459a-209">Grand total of this particular order is **539.99**, and the purchase reasons attributed to this order include Promotion, Other and Price.</span></span>  
  
     <span data-ttu-id="8459a-210">![Лист Excel с агрегированиями «многие ко многим»](../media/ssas-m2m-excel.png "Лист Excel с агрегированиями «многие ко многим»")</span><span class="sxs-lookup"><span data-stu-id="8459a-210">![Excel worksheet showing many-to-many aggregations](../media/ssas-m2m-excel.png "Excel worksheet showing many-to-many aggregations")</span></span>  
  
     <span data-ttu-id="8459a-211">Обратите внимание, что столбец Sales Amount для этого заказа вычислен правильно; здесь показано **539,99** за весь заказ.</span><span class="sxs-lookup"><span data-stu-id="8459a-211">Notice that the Sales Amount is correctly calculated for the order; it is **539.99** for the entire order.</span></span> <span data-ttu-id="8459a-212">Хотя **539,99** указано для каждой причины, это значение не суммируется для всех трех причин, что привело бы к ошибке в общем итоге.</span><span class="sxs-lookup"><span data-stu-id="8459a-212">Although **539.99** is indicated for each reason, that value is not summed for all three reasons, erroneously inflating our grand total.</span></span>  
  
     <span data-ttu-id="8459a-213">А зачем вообще помещать сумму продаж под каждой причиной продажи?</span><span class="sxs-lookup"><span data-stu-id="8459a-213">Why put a sales amount under each sales reason in the first place?</span></span> <span data-ttu-id="8459a-214">Это позволяет идентифицировать объем продаж, который можно приписать каждой причине.</span><span class="sxs-lookup"><span data-stu-id="8459a-214">The answer is that it allows us to identify the amount of sales we can attribute to each reason.</span></span>  
  
5.  <span data-ttu-id="8459a-215">Выполните прокрутку до нижней части листа.</span><span class="sxs-lookup"><span data-stu-id="8459a-215">Scroll to the bottom of the worksheet.</span></span> <span data-ttu-id="8459a-216">Теперь хорошо видно, что Price (Цена) является самой важной причиной для покупок клиентов по сравнению с другими причинами и общей суммой.</span><span class="sxs-lookup"><span data-stu-id="8459a-216">It is now easy to see that Price is the most important reason for customer purchases, relative to other reasons as well as the grand total.</span></span>  
  
     <span data-ttu-id="8459a-217">![Книга Excel с итогами «многие ко многим»](../media/ssas-m2m-excelgrandtotal.png "Книга Excel с итогами «многие ко многим»")</span><span class="sxs-lookup"><span data-stu-id="8459a-217">![Excel workbook showing totals in many-to-many](../media/ssas-m2m-excelgrandtotal.png "Excel workbook showing totals in many-to-many")</span></span>  
  
#### <a name="tips-for-handling-unexpected-query-results"></a><span data-ttu-id="8459a-218">Советы по обработке непредвиденных результатов запросов</span><span class="sxs-lookup"><span data-stu-id="8459a-218">Tips for handling unexpected query results</span></span>  
  
1.  <span data-ttu-id="8459a-219">Скрывайте в промежуточной группе мер такие меры, как подсчеты, которые не возвращают в запросе значимые результаты.</span><span class="sxs-lookup"><span data-stu-id="8459a-219">Hide measures in the intermediate measure group, such as the count, that do not return meaningful results in a query.</span></span> <span data-ttu-id="8459a-220">Это не позволит пользователям использовать агрегирования, дающие на выходе бессмысленные данные.</span><span class="sxs-lookup"><span data-stu-id="8459a-220">This prevents people from trying to use aggregations producing meaningless data.</span></span> <span data-ttu-id="8459a-221">Чтобы спрятать меру, задайте атрибуту **Видимость** значение **False** в конструкторе измерения.</span><span class="sxs-lookup"><span data-stu-id="8459a-221">To hide a measure, set **Visibility** to **False** on the attribute in dimension designer.</span></span>  
  
2.  <span data-ttu-id="8459a-222">Создавайте перспективы, использующие подмножество мер, и измерения, обеспечивающие аналитический процесс, который вы желаете предоставить пользователям.</span><span class="sxs-lookup"><span data-stu-id="8459a-222">Create perspectives to use a subset of measures and dimensions that support the analytical experience you want to provide.</span></span> <span data-ttu-id="8459a-223">Возможно, куб, который содержит много групп мер и измерений, не во всех случаях будет работать как надо.</span><span class="sxs-lookup"><span data-stu-id="8459a-223">Possibly, a cube that contains many measure groups and dimensions do not work well together in all cases.</span></span> <span data-ttu-id="8459a-224">Изолируя измерения и группы мер, которые будут использоваться вместе, вы обеспечиваете более прогнозируемый результат.</span><span class="sxs-lookup"><span data-stu-id="8459a-224">By isolating the dimensions and measure groups that you intend to be used together, you ensure a more predictable outcome.</span></span>  
  
3.  <span data-ttu-id="8459a-225">Всегда помните, что нужно развернуть модель и снова подключиться к ней после ее изменения.</span><span class="sxs-lookup"><span data-stu-id="8459a-225">Always remember to deploy and reconnect after changing a model.</span></span> <span data-ttu-id="8459a-226">В Excel нажмите кнопку «Обновить» на ленте «Анализ» сводной таблицы.</span><span class="sxs-lookup"><span data-stu-id="8459a-226">In Excel, use the Refresh button on the PivotTable Analyze ribbon.</span></span>  
  
4.  <span data-ttu-id="8459a-227">Избегайте использования связанных групп мер в нескольких связях типа «многие ко многим», особенно если эти связи находятся в разных кубах.</span><span class="sxs-lookup"><span data-stu-id="8459a-227">Avoid using linked measure groups in multiple many-to-many relationships, especially when those relationships are in different cubes.</span></span> <span data-ttu-id="8459a-228">Это может привести к формированию неоднозначных агрегатов.</span><span class="sxs-lookup"><span data-stu-id="8459a-228">Doing so can result in ambiguous aggregations.</span></span> <span data-ttu-id="8459a-229">Дополнительные сведения см. в разделе [Неверные суммы для связанных мер в кубе, содержащих связи "многие ко многим"](https://social.technet.microsoft.com/wiki/contents/articles/22911.incorrect-amounts-for-linked-measures-in-cubes-containing-many-to-many-relationships-ssas-troubleshooting.aspx).</span><span class="sxs-lookup"><span data-stu-id="8459a-229">For more information, see [Incorrect Amounts for Linked Measures in Cubes containing Many-to-Many Relationships](https://social.technet.microsoft.com/wiki/contents/articles/22911.incorrect-amounts-for-linked-measures-in-cubes-containing-many-to-many-relationships-ssas-troubleshooting.aspx).</span></span>  
  
##  <a name="learn-more"></a><a name="bkmk_Learn"></a><span data-ttu-id="8459a-230">Подробнее</span><span class="sxs-lookup"><span data-stu-id="8459a-230">Learn more</span></span>  
 <span data-ttu-id="8459a-231">Дополнительную информацию, которая поможет в освоении данных концепций, можно получить по следующим ссылкам.</span><span class="sxs-lookup"><span data-stu-id="8459a-231">Use the following links to get additional information that helps you master the concepts.</span></span>  
  
 [<span data-ttu-id="8459a-232">Определение измерения «многие ко многим» в службах Analysis Services</span><span class="sxs-lookup"><span data-stu-id="8459a-232">How do I define a many-to-many dimension in Analysis Services</span></span>](../lesson-5-3-defining-a-many-to-many-relationship.md)  
  
 [<span data-ttu-id="8459a-233">Революция концепции «многие ко многим» 2.0</span><span class="sxs-lookup"><span data-stu-id="8459a-233">The many-to-many Revolution 2.0</span></span>](https://go.microsoft.com/fwlink/?LinkId=324760)  
  
 [<span data-ttu-id="8459a-234">Руководство. Пример измерения "многие ко многим" для служб SQL Server Analysis Services</span><span class="sxs-lookup"><span data-stu-id="8459a-234">Tutorial: Many-to-many dimension example for SQL Server Analysis Services</span></span>](https://go.microsoft.com/fwlink/?LinkId=324761)  
  
## <a name="see-also"></a><span data-ttu-id="8459a-235">См. также:</span><span class="sxs-lookup"><span data-stu-id="8459a-235">See Also</span></span>  
 <span data-ttu-id="8459a-236">[Связи измерений](../multidimensional-models-olap-logical-cube-objects/dimension-relationships.md) </span><span class="sxs-lookup"><span data-stu-id="8459a-236">[Dimension Relationships](../multidimensional-models-olap-logical-cube-objects/dimension-relationships.md) </span></span>  
 <span data-ttu-id="8459a-237">[Руководство по установке образца данных и проектов для Analysis Services учебника по многомерному моделированию](../install-sample-data-and-projects.md) </span><span class="sxs-lookup"><span data-stu-id="8459a-237">[Install Sample Data and Projects for the Analysis Services Multidimensional Modeling Tutorial](../install-sample-data-and-projects.md) </span></span>  
 <span data-ttu-id="8459a-238">[Развертывание проектов Analysis Services &#40;SSDT&#41;](deploy-analysis-services-projects-ssdt.md) </span><span class="sxs-lookup"><span data-stu-id="8459a-238">[Deploy Analysis Services Projects &#40;SSDT&#41;](deploy-analysis-services-projects-ssdt.md) </span></span>  
 [<span data-ttu-id="8459a-239">Перспективы в многомерных моделях</span><span class="sxs-lookup"><span data-stu-id="8459a-239">Perspectives in Multidimensional Models</span></span>](perspectives-in-multidimensional-models.md)  
  
  
