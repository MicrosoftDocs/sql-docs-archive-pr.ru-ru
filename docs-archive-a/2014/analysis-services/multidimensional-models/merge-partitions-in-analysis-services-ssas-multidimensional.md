---
title: Слияние секций в Analysis Services (службы SSAS — многомерные) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
helpviewer_keywords:
- partitions [Analysis Services], merging
- merging partitions [Analysis Services]
ms.assetid: b3857b9b-de43-4911-989d-d14da0196f89
author: minewiskan
ms.author: owend
ms.openlocfilehash: 42820a202c4da58e21dfd55756b7bb03522ea879
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87740568"
---
# <a name="merge-partitions-in-analysis-services-ssas---multidimensional"></a>Объединение секций в службах Analysis Services (SSAS — многомерные данные)
  Можно совмещать секции в существующей базе данных [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] для объединения фактических данных из нескольких секций одной группы мер.  
  
 [Распространенные сценарии](#bkmk_Scenario)  
  
 [Требования](#bkmk_prereq)  
  
 [Обновление источника секции после слияния секций](#bkmk_Where)  
  
 [Особые замечания для секций, сегментированных по таблице фактов или именованному запросу](#bkmk_fact)  
  
 [Как объединять секции с помощью среды SSMS](#bkmk_partitionSSMS)  
  
 [Слияние секций с помощью XMLA](#bkmk_partitionsXMLA)  
  
##  <a name="common-scenarios"></a><a name="bkmk_Scenario"></a>Распространенные сценарии  
 Самая обычная конфигурация сценария использует разделение данных во временном измерении. Гранулярность времени, связанная с каждой секцией, зависит от бизнес-требований конкретного проекта. Например, сегментация может выполняться по годам, последний год — разделяться по месяцам с выделением отдельной секции для активного месяца. Секция активного месяца регулярно принимает новые данные.  
  
 После завершения текущего месяца выполняется слияние секции с месяцами в секции прошедших в этом году месяцев и т. д. В конце года формируется секция для всего года.  
  
 Как показывает данный сценарий, слияние секций может стать обычной задачей, выполняемой на регулярной основе, при наличии прогрессивного подхода по организации и консолидации исторических данных.  
  
##  <a name="requirements"></a><a name="bkmk_prereq"></a> Требования  
 Можно выполнять слияние секций только в том случае, если они удовлетворяют всем условиям, перечисленным ниже:  
  
-   Они имеют одинаковую группу мер.  
  
-   Обладают одной и той же структурой.  
  
-   Они должны находиться в обработанном состоянии.  
  
-   Обладают одними и теми же режимами хранения.  
  
-   Содержат одинаковые статистические схемы.  
  
-   Они совместно используют уровень совместимости одного и того же хранилища строк (применяется только к секционированным группам мер числа различных объектов).  
  
 Если целевая секция пуста (есть агрегатная схема, но нет агрегатов), операция слияния пропустит агрегаты для исходных секций. Для построения агрегатов нужно выполнить для секции команду Process Index, Process Full или Process Default.  
  
 Удаленные секции можно объединять только с удаленными секциями, определенными на том же удаленном экземпляре служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].  
  
> [!NOTE]  
>  Если используется сочетание локальных и удаленных секций, альтернативой будет создание новых секций, в которых содержатся объединенные данные и удалены более неиспользуемые секции.  
  
 Чтобы создать секцию, которая может использоваться в последующем слиянии, во время создания секции в мастере секционирования можно скопировать статистическую схему из другой секции куба. Это гарантирует, что у всех таких секций будет одна и та же статистическая схема. Во время слияния статистические схемы исходной секции объединяются со статистическими схемами целевой секции.  
  
##  <a name="update-the-partition-source-after-merging-partitions"></a><a name="bkmk_Where"></a>Обновление источника секции после слияния секций  
 Секции сегментируются по запросу, например по предложению WHERE SQL-запроса, используемого для обработки данных, или по таблице или именованному запросу, которые предоставляют данные для секции. Свойство `Source` секции указывает, привязана секция к запросу или таблице.  
  
 При слиянии секций их содержимое объединяется, но свойство `Source` не обновляется. Это означает, что при повторной обработке секции, сохраняющей исходный `Source`, будут получены неверные данные. Секция ошибочно агрегирует данные на уровне родительского объекта. Следующий пример демонстрирует эту ситуацию.  
  
 **Проблема**  
  
 Предположим, что имеется куб, содержащий сведения о трех безалкогольных напитках. Он имеет три секции, использующие одну и ту же таблицу фактов. Эти секции разделены по продуктам. Секция 1 содержит данные о [ColaFull], секция 2 содержит данные о [ColaDecaf], а секция 3 содержит данные о [ColaDiet]. При слиянии секции 3 в секцию 2 данные в получающейся в результате секции (секции 2) правильны, а данные куба являются точными. Однако при обработке содержимое секции 2 может определяться «родителем» элементов на уровне продуктов. Этот "родительский" элемент [SoftDrinks] также включает [ColaFull], продукт в секции 1. При обработке секции 2 будет загружена секция с данными для всех безалкогольных напитков, включая [ColaFull]. После этого куб будет содержать дублирующиеся данные для [ColaFull] и возвращать неправильные данные конечным пользователям.  
  
 **Решение**  
  
 Нужно обновить свойство `Source`, изменив предложение WHERE или именованный запрос, или же вручную объединить данные из нижележащих таблиц фактов, чтобы последующая обработка была правильной.  
  
 В этом примере после слияния секции 3 в секцию 2 можно ввести фильтр, например ("Product" = 'ColaDecaf' OR "Product" = 'ColaDiet'), в получающуюся в результате секцию 2, чтобы указать, что из таблицы фактов будут извлекаться только данные о [ColaDecaf] и [ColaDiet], а данные, относящиеся к [ColaFull], будут исключены. Или можно указать фильтры для секции 2 и секции 3 при их создании, и эти фильтры будут скомбинированы во время процесса слияния. В любом случае, после обработки секции куб не будет содержать дублирующихся данных.  
  
 **Заключение**  
  
 После слияния секций всегда проверяйте фильтр в `Source` для определения его правильности по отношению к объединенным данным. Если вы начали с секцией, включавшей исторические данные для кварталов Q1, Q2 и Q3, и теперь они объединяются c Q4, нужно исправить фильтр, чтобы он включал Q4. В противном случае последующая обработка секции даст ошибочные результаты. Они не будут правильными для Q4.  
  
##  <a name="special-considerations-for-partitions-segmented-by-fact-table-or-named-query"></a><a name="bkmk_fact"></a>Особые соображения для секций, сегментированных по таблице фактов или именованным запросам  
 В дополнении к запросам секции также могут быть сегментированы по таблице или именованному запросу. Если исходная секция и целевая секция используют одну и ту же таблицу фактов в источнике данных или представлении источника данных, то после слияния секций свойство `Source` будет действительным. Оно определяет данные таблицы фактов, подходящие для результирующей секции. Поскольку факты, необходимые для получающейся в результате секции, присутствуют в таблице фактов, изменения в свойстве `Source` не требуются.  
  
 Секции, использующие данные из нескольких таблиц фактов или именованных запросов, требуют дополнительной работы. Необходимо вручную осуществить слияние фактов из таблицы фактов исходной секции в таблицу фактов целевой секции.  
  
 Можно также изменить источник для секции, получившейся в результате слияния, на именованный запрос, возвращающий содержимое двух отдельных таблиц фактов. Если этот этап не выполнен вручную, то таблица фактов не содержит полные данные.  
  
 По той же причине требуется обновление секций, получающих сегментированные данные из именованных запросов. Объединенная секция должна иметь именованный запрос, который возвращает совместный результирующий набор, полученный ранее из разных именованных запросов.  
  
## <a name="partition-storage-considerations-molap"></a>Замечания о хранилищах для секций: MOLAP  
 При слиянии секций многомерного OLAP (MOLAP) также осуществляется слияние фактов, хранимых в многомерных структурах секций. В результате получается внутренне полная и последовательная секция. Однако факты, хранимые в секциях MOLAP, представляют собой копии фактов из таблицы фактов. При последующей обработке секции факты в многомерной структуре удаляются (только в случае полной обработки и обновления) и данные копируются из таблицы фактов, как указано в источнике данных и фильтре для секции. Если исходная секция использует не ту таблицу фактов, которую использует целевая секция, то необходимо вручную осуществить слияние таблицы фактов исходной секции с таблицей фактов целевой секции для гарантии того, что полный набор данных доступен при обработке получившейся в результате секции. Это также имеет место, когда две секции были основаны на различных именованных запросах.  
  
> [!IMPORTANT]  
>  Получившаяся в результате секция MOLAP с неполной таблицей фактов содержит таблицу фактов, получившуюся в результате внутреннего слияния, и функционирует корректно до ее обработки.  
  
## <a name="partition-storage-considerations-holap-and-rolap-partitions"></a>Замечания о хранилищах для секций: секции HOLAP и ROLAP  
 При слиянии секций гибридного OLAP (HOLAP) или реляционного OLAP (ROLAP), имеющих разные таблицы фактов, слияние этих таблиц фактов не осуществляется автоматически. Если слияние этих таблиц фактов не осуществлено вручную, то для получившейся в результате секции доступна только таблица фактов, связанная с целевой секцией. Факты, связанные с исходной секцией, недоступны для углубленной детализации в получившейся в результате секции, и при обработке этой секции статистические вычисления не суммируют данные из недоступной таблицы.  
  
> [!IMPORTANT]  
>  Получившаяся в результате слияния секция HOLAP или ROLAP с неполной таблицей фактов содержит правильные статистические вычисления, но неполные факты. Запросы, относящиеся к отсутствующим фактам, возвращают неправильные данные. При обработке секции статистические схемы вычисляются только на основе доступных фактов.  
  
 Отсутствие недоступных фактов может не быть замечено, если только пользователь не попытается осуществить углубленную детализацию факта в недоступной таблице или не выполнит запрос, для которого необходим факт из недоступной таблицы. Поскольку агрегаты комбинируются во время процесса слияния, запросы, результаты которых основаны только на статистических вычислениях, возвращают правильные данные, в то время как другие запросы могут возвращать неправильные данные. Даже после обработки получившейся в результате секции отсутствие данных из недоступной таблицы фактов может не быть замечено, особенно если они представляют собой лишь малую часть скомбинированных данных.  
  
 Слияние таблиц фактов может быть осуществлено до или после слияния секций. Однако агрегаты не будут точно представлять базовые факты до завершения выполнения обеих операций. Рекомендуется осуществлять слияние секций HOLAP или ROLAP, обращающихся к различным таблицам фактов, когда пользователи не подключены к кубу, содержащему эти секции.  
  
##  <a name="how-to-merge-partitions-using-ssms"></a><a name="bkmk_partitionSSMS"></a>Слияние секций с помощью SSMS  
  
> [!IMPORTANT]  
>  Перед слиянием секций сначала копируйте сведения о фильтре данных (например, предложение WHERE для фильтров на основе SQL-запросов). После завершения слияния нужно обновить свойство Partition Source секции, которая содержит накопленные фактические данные.  
  
1.  В обозревателе объектов разверните узел **Группы мер** куба, содержащего секции, слияние которых необходимо осуществить, разверните узел **Секции**и щелкните правой кнопкой мыши секцию, которая является целью операции слияния. Например, если перемещаются квартальные фактические данные в секцию, которая хранит данные за год, выберите секцию, которая содержит годовые фактические данные.  
  
2.  Нажмите кнопку **объединить секции** , чтобы открыть диалоговое окно **слияние секции \<partition name> ** .  
  
3.  В разделе **Исходные секции**установите флажок рядом с каждой исходной секцией, для которой необходимо слияние осуществить с целевой секцией, затем нажмите кнопку **ОК**.  
  
    > [!NOTE]  
    >  Исходные секции удаляются сразу же после слияния источника в целевой секции. Обновите папку с секциями, чтобы видеть обновленное содержимое.  
  
4.  Щелкните правой кнопкой мыши секцию с объединенными данными и выберите **Свойства**.  
  
5.  Откройте `Source` свойство и измените предложение WHERE таким образом, чтобы оно включало только что Объединенные данные секции. Вспомним, что `Source` свойство не обновляется автоматически. Если выполнить повторную обработку без предварительного обновления `Source` , то могут быть получены не все ожидаемые данные.  
  
##  <a name="how-to-merge-partitions-using-xmla"></a><a name="bkmk_partitionsXMLA"></a> Как объединять секции с помощью XMLA  
 В этом разделе сведения см. в разделе [Слияние секций (XML)](../multidimensional-models-scripting-language-assl-xmla/merging-partitions-xmla.md).  
  
## <a name="see-also"></a>См. также:  
 [Обработка объектов Analysis Services](processing-analysis-services-objects.md)   
 [Секции &#40;Analysis Services многомерных данных&#41;](../multidimensional-models-olap-logical-cube-objects/partitions-analysis-services-multidimensional-data.md)   
 [Создание локальной секции &#40;Analysis Services и управление ею&#41;](create-and-manage-a-local-partition-analysis-services.md)   
 [Создание &#40;Analysis Services удаленных секций и управление ими&#41;](create-and-manage-a-remote-partition-analysis-services.md)   
 [Задать обратную запись секции](set-partition-writeback.md)   
 [Секции, доступные для записи](../multidimensional-models-olap-logical-cube-objects/partitions-write-enabled-partitions.md)   
 [Настройка хранилища строк для измерений и секций](configure-string-storage-for-dimensions-and-partitions.md)  
  
  
