---
title: Конфигурация ошибок при обработке кубов, секций и измерений (службы SSAS — многомерные) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
f1_keywords:
- sql12.asvs.sqlserverstudio.cubeproperties.errorconfiguration.f1
- sql12.asvs.sqlserverstudio.dimensionproperties.errorconfiguration.f1
- sql12.asvs.sqlserverstudio.partitionproperties.errorconfiguration.f1
ms.assetid: 3f442645-790d-4dc8-b60a-709c98022aae
author: minewiskan
ms.author: owend
ms.openlocfilehash: 76202281ff6bff23bc2f2abcfd857a6f2102d667
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669129"
---
# <a name="error-configuration-for-cube-partition-and-dimension-processing-ssas---multidimensional"></a>Конфигурация ошибок при обработке кубов, секций и измерений (службы SSAS — многомерные данные)
  Свойства конфигурации ошибок для кубов, секций и объектов измерения определяют реакцию сервера на возникновение ошибок целостности данных во время обработки. Обычно такие ошибки вызваны повторяющимися или отсутствующими ключами и значения NULL в ключевом столбце. Хоть запись с ошибкой и не будет добавлена в базу данных, можно задать свойства, которые определят дальнейшую реакцию на ошибку. По умолчанию обработка останавливается. Однако во время разработки куба желательно продолжить обработку при возникновении ошибки для тестирования поведения куба с импортированным данными, даже если они не будут полными.  
  
 Этот раздел включает следующие подразделы:  
  
-   [Порядок выполнения](#bkmk_exec)  
  
-   [Поведение по умолчанию](#bkmk_default)  
  
-   [Свойства конфигурации ошибок](#bkmk_props)  
  
-   [Место установки свойств конфигурации ошибок](#bkmk_tools)  
  
-   [Отсутствующие ключи (KeyNotFound)](#bkmk_missing)  
  
-   [Внешние ключи NULL в таблице фактов (KeyNotFound)](#bkmk_nullfact)  
  
-   [Ключи NULL в измерении](#bkmk_nulldim)  
  
-   [Дублированные ключи, приводящие к неоднородным связям (KeyDuplicate)](#bkmk_dupe)  
  
-   [Изменение предельного числа ошибок или ошибок](#bkmk_limit)  
  
-   [Указание пути к журналу ошибок](#bkmk_log)  
  
-   [Следующий шаг](#bkmk_next)  
  
##  <a name="execution-order"></a><a name="bkmk_exec"></a>Порядок выполнения  
 Сервер для каждой записи всегда выполняет правила `NullProcessing` до правил `ErrorConfiguration`. Это важно учитывать, потому что свойства обработки значения NULL, преобразующие NULL в нуль, могут впоследствии ввести ошибки повторяющихся ключей, когда две или более записи с ошибками будут иметь нуль в ключевом столбце.  
  
##  <a name="default-behaviors"></a><a name="bkmk_default"></a>Поведение по умолчанию  
 По умолчанию обработка останавливается при обнаружении первой ошибки в каком-либо ключевом столбце. Это поведение контролируется значением предельного количества ошибок, которое определяет нуль в качестве дозволенного количества ошибок и директиву «Остановить обработку», предписывающую серверу остановить обработку при достижении предельного количества ошибок.  
  
 Записи, ведущие к ошибкам из-за наличия NULL и повторяющихся или отсутствующих значений, преобразуются в неизвестный элемент или отбрасываются. [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] не импортирует данные, которые нарушают ограничения целостности данных.  
  
-   Преобразование в неизвестный элемент производится по умолчанию. Это происходит из-за параметра `ConvertToUnknown` для `KeyErrorAction`. Записи, приписанные неизвестному элементу, помещаются в «карантин» базы данных в качестве свидетельства проблемы, которая впоследствии может быть исследована разработчиком после завершения обработки данных.  
  
     Неизвестные элементы исключаются из рабочих нагрузок запросов, но они будут отображаться в некоторых клиентских приложениях, если `UnknownMember` для параметра задано значение **Visible**.  
  
     Если нужно отслеживать, сколько значений NULL было преобразовано в неизвестный элемент, можно изменить свойство `NullKeyConvertedToUnknown` так, чтобы эти ошибки отмечались в журнале или в окне «Обработка».  
  
-   Записи будут отбрасываться, если вручную установить для свойства `KeyErrorAction` значение `DiscardRecord`.  
  
 С помощью свойств конфигурации ошибок можно определить, как сервер будет реагировать на возникновение ошибки. Среди возможных вариантов: немедленная остановка обработки, продолжить обработку, но прервать ведение журнала или же продолжить обработку и ведение журнала ошибок. Поведение по умолчанию зависит от серьезности ошибки.  
  
 Подсчет ошибок отслеживает количество возникающих ошибок. Если установлен верхний предел, ответ сервера меняется при достижении этого предела. По умолчанию сервер останавливает обработку после достижения предела. По умолчанию предел равен 0, что приводит к остановке обработки при учете первой же ошибки.  
  
 Важные ошибки, такие как отсутствующий ключ или значение NULL в поле ключа, должны быть быстро устранены. По умолчанию эти ошибки подпадают под действие поведения сервера `ReportAndContinue` — сервер ловит ошибку, увеличивает подсчет ошибок и затем продолжает обработку (если только не задано нулевое предельное количество ошибок, тогда обработка прерывается сразу же).  
  
 По умолчанию другие ошибки создаются, но не учитываются и не заносятся в журнал (это параметр `IgnoreError`), поскольку не обязательно нарушают целостность данных.  
  
 На подсчеты количества ошибок влияют параметры обработки значений NULL. Для атрибутов измерения эти параметры определяют реакцию сервера при обнаружении значений NULL. По умолчанию значения NULL в числовом столбце преобразуются в нули, а NULL в строковом столбце — в пустые строки. Свойства `NullProcessing` можно переопределить на отлов значений NULL до возникновения ошибок `KeyNotFound` и `KeyDuplicate`, связанных с ними. Дополнительные сведения см. в разделе [Ключи NULL в измерении](#bkmk_nulldim) .  
  
 Ошибки регистрируются в диалоговом окне «Обработка», но не сохраняются. Можно указать имя файла журнала ошибок ключа для сбора ошибок в текстовом файле.  
  
##  <a name="error-configuration-properties"></a><a name="bkmk_props"></a>Свойства конфигурации ошибок  
 Есть девять свойств конфигурации ошибок. Пять из них определяют реакцию сервера на определенную ошибку. Другие четыре свойства относятся к рабочим нагрузкам конфигурации ошибок и определяют разрешенное количество ошибок, действия при достижении предела и возможность сбора ошибок в файле журнала.  
  
 **Реакция сервера на определенные ошибки**  
  
|Свойство|Значение по умолчанию|Другие значения|  
|--------------|-------------|------------------|  
|`CalculationError`<br /><br /> Происходит при инициализации конфигурации ошибок.|`IgnoreError` не подсчитывает ошибки и не заносит их в журнал; обработка продолжается, пока количество ошибок меньше максимального предела.|`ReportAndContinue` фиксирует ошибки в журнале и ведет их подсчет.<br /><br /> `ReportAndStop` сообщает об ошибке и сразу же прекращает обработку вне зависимости от значения предельного количества ошибок.|  
|`KeyNotFound`<br /><br /> Возникает, когда для внешнего ключа в таблице фактов отсутствует совпадающий первичный ключ в связанной таблице измерения (например, таблица фактов Sales имеет запись с кодом продукта, которого нет в таблице измерения Product). Эта ошибка может произойти во время обработки секций или измерений, связанных по схеме «снежинка».|`ReportAndContinue` фиксирует ошибки в журнале и ведет их подсчет.|`ReportAndStop` сообщает об ошибке и сразу же прекращает обработку вне зависимости от значения предельного количества ошибок.<br /><br /> `IgnoreError` не подсчитывает ошибки и не заносит их в журнал; обработка продолжается, пока количество ошибок меньше максимального предела. По умолчанию записи, ведущие к этой ошибке, преобразуются в неизвестный элемент. Однако можно изменить свойство `KeyErrorAction`, тогда такие записи будут отбрасываться.|  
|`KeyDuplicate`<br /><br /> Возникает при обнаружении в измерении повторяющихся ключей атрибутов. В большинстве случаев допустимо иметь повторяющиеся ключи атрибутов. Эта ошибка сообщает о повторах, чтобы разработчик мог проверить измерение на изъяны проектирования, которые приводят к возникновению несогласованных связей между атрибутами.|`IgnoreError` не подсчитывает ошибки и не заносит их в журнал; обработка продолжается, пока количество ошибок меньше максимального предела.|`ReportAndContinue` фиксирует ошибки в журнале и ведет их подсчет.<br /><br /> `ReportAndStop` сообщает об ошибке и сразу же прекращает обработку вне зависимости от значения предельного количества ошибок.|  
|`NullKeyNotAllowed`<br /><br /> Происходит `NullProcessing`  =  `Error` , когда задается для атрибута измерения или если в ключевом столбце атрибута имеются значения NULL, используемые для уникальной идентификации элемента.|`ReportAndContinue` фиксирует ошибки в журнале и ведет их подсчет.|`ReportAndStop` сообщает об ошибке и сразу же прекращает обработку вне зависимости от значения предельного количества ошибок.<br /><br /> `IgnoreError` не подсчитывает ошибки и не заносит их в журнал; обработка продолжается, пока количество ошибок меньше максимального предела. По умолчанию записи, ведущие к этой ошибке, преобразуются в неизвестный элемент. Однако можно указать свойство `KeyErrorAction`, тогда такие записи будут отбрасываться.|  
|`NullKeyConvertedToUnknown`<br /><br /> Возникает, когда значения NULL впоследствии преобразуются в неизвестный элемент. `NullProcessing`  =  `ConvertToUnknown` При настройке атрибута измерения эта ошибка будет вызвана.|`IgnoreError` не подсчитывает ошибки и не заносит их в журнал; обработка продолжается, пока количество ошибок меньше максимального предела.|Если вы рассматриваете эту ошибку как информационное предупреждение, оставьте значение по умолчанию. В ином случае можно выбрать `ReportAndContinue`, чтобы ошибка отмечалась в окне «Обработка» и учитывалась при подсчете предельного количества ошибок.<br /><br /> `ReportAndStop` сообщает об ошибке и сразу же прекращает обработку вне зависимости от значения предельного количества ошибок.|  
  
 **Общие свойства**  
  
|**Свойство**|**Значения**|  
|------------------|----------------|  
|`KeyErrorAction`|Это действие, выполняемое сервером при возникновении ошибки `KeyNotFound`. Допустимая реакция на эту ошибку: `ConvertToUnknown` или `DiscardRecord`.|  
|`KeyErrorLogFile`|Это определяемое пользователем имя файла должно иметь расширение LOG и находиться в папке, для которой учетная запись службы имеет разрешения на чтение и запись. Файл журнала будет содержать только ошибки, возникшие во время обработки. Для сбора более подробной информации воспользуйтесь средством «черный ящик».|  
|`KeyErrorLimit`|Максимальное число ошибок целостности данных, допустимых для сервера, прежде чем он остановит обработку. Значение -1 указывает, что предел не установлен. Значение по умолчанию — 0, т. е. обработка останавливается при первой ошибке. Также можно задать целое число.|  
|`KeyErrorLimitAction`|Это действие, выполняемое сервером, при достижении количества ключевых ошибок верхнего предела. Действие **Остановить обработку**сразу же завершает операцию обработки. С действием **Остановить ведение журнала**обработка продолжается, но ошибки больше не учитываются и не отмечаются в журнале.|  
  
##  <a name="where-to-set-error-configuration-properties"></a><a name="bkmk_tools"></a> Место установки свойств конфигурации ошибок  
 Используйте страницы свойств в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] после развертывания базы данных или в проекте модели в [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)]. Одинаковый набор свойств есть в обеих средах. Чтобы изменить значения по умолчанию, свойства конфигурации ошибок можно задать в файле msmdrsrv.ini либо сделать это с помощью команд `Batch` и `Process`, если обработка выполняется как скрипт.  
  
 Конфигурацию ошибок можно задать для любого объекта, который может быть обработан в отдельной операции.  
  
#### <a name="sql-server-management-studio"></a>SQL Server Management Studio  
  
1.  В обозревателе объектов щелкните правой кнопкой мыши элемент **Свойства** для одного из следующих объектов: измерение, куб или секция.  
  
2.  В окне свойств щелкните по вкладке **Конфигурация ошибок**.  
  
#### <a name="sql-server-data-tools"></a>SQL Server Data Tools  
  
1.  Дважды щелкните по измерению или кубу в обозревателе решений. `ErrorConfiguration`отображается в свойствах на панели ниже.  
  
2.  Кроме того, только для одного измерения щелкните правой кнопкой мыши измерение в обозреватель решений, выберите `Process` , а затем выберите **изменить параметры** в диалоговом окне Обработка измерения. Параметры конфигурации ошибок появятся на вкладке «Ошибки ключей измерения».  
  
##  <a name="missing-keys-keynotfound"></a><a name="bkmk_missing"></a>Отсутствующие ключи (KeyNotFound)  
 Записи с отсутствующим значением ключа не могут быть добавлены в базу данных, даже когда ошибки пропускаются или не задано предельное количество ошибок.  
  
 Сервер формирует ошибку `KeyNotFound` во время обработки секции, когда запись в таблице фактов содержит значение внешнего ключа, но внешний ключ не имеет соответствующей записи в связанной таблице измерения. Эта ошибка также происходит при обработке связанных или собранных по схеме «снежинка» таблиц измерений, когда запись в одном измерении указывает внешний ключ, который отсутствует в связанном измерении.  
  
 Когда возникает ошибка `KeyNotFound`, запись, послужившая причиной, назначается неизвестному элементу. Это поведение контролируется с помощью **действия ключа**и устанавливается в значение `ConvertToUnknown` , чтобы можно было просматривать выделенные записи для дальнейшего изучения.  
  
##  <a name="null-foreign-keys-in-a-fact-table-keynotfound"></a><a name="bkmk_nullfact"></a> Внешние ключи NULL в таблице фактов (KeyNotFound)  
 По умолчанию значение NULL в столбце внешнего ключа фактической таблицы преобразуется в нуль. С учетом того, что нуль не является допустимым значением внешнего ключа, ошибка `KeyNotFound` будет учтена и подсчитана для предельного количества ошибок, которое по умолчанию равно нулю.  
  
 Чтобы разрешить продолжение обработки, можно оперировать значением NULL до его преобразования и проверки на ошибки. Для этого задайте для значение `NullProcessing` `Error` .  
  
#### <a name="set-nullprocessing-property-on-a-measure"></a>Установка свойства NullProcessing для меры  
  
1.  В обозревателе решений среды SQL Server Data Tools дважды щелкните по кубу, чтобы открыть его в конструкторе кубов.  
  
2.  На панели мер щелкните нужную меру правой кнопкой мыши и выберите пункт **Свойства**.  
  
3.  В окне Свойства разверните узел **источник** , чтобы просмотреть `NullProcessing` свойство. По умолчанию свойству задано значение **Автоматическая** , что для элементов OLAP преобразует значения NULL в полях с числовыми данными в нули.  
  
4.  Измените значение на, `Error` чтобы исключить любые записи со значением NULL, избегая преобразования NULL в числовой (нуль). Это изменение позволяет избежать ошибок повторяющихся ключей, связанных с несколькими записями, нулевыми в ключевом столбце, и избежать `KeyNotFound` ошибок, если внешний ключ с нулевым значением не имеет эквивалента первичного ключа в связанной таблице измерения.  
  
##  <a name="null-keys-in-a-dimension"></a><a name="bkmk_nulldim"></a> Ключи NULL в измерении  
 Чтобы продолжить обработку при обнаружении значений NULL во внешних ключах измерения, собранного по схеме «снежинка», сначала обработайте значения NULL, установив `NullProcessing` для свойства `KeyColumn` атрибута измерения. Это приведет к отбрасыванию или преобразованию записи до возникновения ошибки `KeyNotFound`.  
  
 Есть два варианта обработки значений NULL в атрибуте измерения:  
  
-   Задайте `NullProcessing` = `UnknownMember` для выделения записей со значениями NULL для неизвестного элемента. Это формирует ошибку `NullKeyConvertedToUnknown`, которая по умолчанию пропускается.  
  
-   Задайте `NullProcessing` = `Error` для исключения записей со значениями NULL. Это формирует ошибку `NullKeyNotAllowed`, которая записывается в журнал и учитывается при подсчете предельного количества ошибок ключа. Чтобы разрешить продолжение обработки, можно задать свойство конфигурации ошибки в **ключе NULL** `IgnoreError` .  
  
 Значения NULL могут быть проблемой для неключевых полей, так как запросы MDX возвращают различные результаты в зависимости от того, интерпретируется ли NULL как нуль или пустое значение. По этой причине [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] предоставляет варианты обработки значения NULL, которые позволяют заранее определить нужное поведение преобразования. Дополнительные сведения см. в разделе [Определение свойств Unknown Member и Null Processing](../lesson-4-7-defining-the-unknown-member-and-null-processing-properties.md) и <xref:Microsoft.AnalysisServices.NullProcessing> .  
  
#### <a name="set-nullprocessing-property-on-a-dimension-attribute"></a>Установка свойства NullProcessing для атрибута измерения  
  
1.  В обозревателе решений среды SQL Server Data Tools дважды щелкните по измерению, чтобы открыть его в конструкторе измерения.  
  
2.  На панели атрибутов щелкните нужный атрибут правой кнопкой мыши и выберите пункт **Свойства**.  
  
3.  В окне Свойства разверните узел **KeyColumns** , чтобы просмотреть `NullProcessing` свойство. По умолчанию свойству задано значение **Автоматическая** , что преобразует значения NULL в полях с числовыми данными в нули. Измените значение на `Error` или на `UnknownMember`.  
  
     Это изменение удаляет базовые условия, которые инициируются `KeyNotFound` путем отмены или преобразования записи перед их проверкой на наличие ошибок.  
  
     В зависимости от конфигурации ошибок одно из этих действий может привести к формированию ошибки, которая будет учтена. Возможно, потребуется настроить дополнительные свойства, например значение, равное `KeyNotFound` `ReportAndContinue` или `KeyErrorLimit` ненулевому значению, чтобы продолжить обработку после сообщения об ошибках и их подсчета.  
  
##  <a name="duplicate-keys-resulting-inconsistent-relationships-keyduplicate"></a><a name="bkmk_dupe"></a> Повторяющиеся ключи, ведущие к несогласованным связям (KeyDuplicate)  
 По умолчанию присутствие повторяющегося ключа не прерывает обработку, но эта ошибка пропускается, а повторяющаяся запись исключается из базы данных.  
  
 Чтобы изменить такое поведение, установите `KeyDuplicate` в `ReportAndContinue` или `ReportAndStop`, чтобы эта ошибка была отмечена. Затем эту ошибку можно изучить, чтобы определить потенциальные изъяны в проектировании измерения.  
  
##  <a name="change-the-error-limit-or-error-limit-action"></a><a name="bkmk_limit"></a> Изменение предельного количества ошибок или действия при его достижении  
 Предельное количество ошибок можно поднять, чтобы разрешить формирование большего числа ошибок во время обработки. У нас нет рекомендаций, до какого числа стоит увеличивать предельное количество ошибок. Подходящее значение будет зависеть от конкретного случая. Ограничения ошибок задаются как `KeyErrorLimit` в `ErrorConfiguration` свойствах в [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)] или в виде **числа ошибок** на вкладке Конфигурация ошибок для свойств измерений, кубов или групп мер в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] .  
  
 Можно задать действие, которое после достижения предельного количества ошибок остановит обработку или ведение журнала. Предположим, что задано действие `StopLogging` для предельного количества ошибок в 100 штук. На 101-й ошибке обработка продолжится, но ошибки больше не будут учитываться и не будут отмечаться в журнале. Действия с ограничением ошибок задаются как `KeyErrorLimitAction` в `ErrorConfiguration` свойствах в [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)] , так и в действии при **возникновении ошибки** на вкладке Конфигурация ошибок для свойств измерений, кубов или групп мер в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] .  
  
##  <a name="set-the-error-log-path"></a><a name="bkmk_log"></a>Настройка пути к журналу ошибок  
 Можно указать файл для хранения сообщения об ошибках, связанных с ключами и обнаруженных во время обработки. По умолчанию во время интерактивной обработки сообщения об ошибках можно просматривать в окне «Обработка». После закрытия окна или сеанса обработки сообщения они удаляются. Журнал будет содержать только сведения об ошибках, относящихся к ключам, идентичных ошибкам, отображаемым в диалоговых окнах обработки.  
  
 Ошибки будут заноситься в текстовый файл, который должен иметь расширение LOG. Файл будет пустым в случае отсутствия ошибок. По умолчанию файл создается в папке DATA. Можно указать и другую папку, главное, чтобы учетная запись служб Analysis Services имела разрешения на запись в это место.  
  
##  <a name="next-step"></a><a name="bkmk_next"></a>Следующий шаг  
 Определитесь, будут ошибки прерывать обработку или же пропускаться. Помните, что пропускается только сама ошибка. Запись, приведшая к ошибке, не пропускается; она отбрасывается либо преобразуется в неизвестный элемент. Записи, нарушающие правила целостности данных, никогда не добавляются в базу данных. По умолчанию обработка прерывается при возникновении первой ошибки, но это поведение можно изменить, увеличив предельное количество ошибок. При разработке кубов может быть полезно сделать правила конфигурации ошибок менее строгими, чтобы разрешить продолжение обработки и собрать данные для тестирования.  
  
 Определитесь, следует ли изменить стандартные правила обработки значений NULL. По умолчанию значения NULL в строковом столбце обрабатываются как пустые значения, а NULL в числовом столбце — как нуль. Инструкции по установке правил обработки значений NULL для атрибута см. в разделе [Defining the Unknown Member and Null Processing Properties](../lesson-4-7-defining-the-unknown-member-and-null-processing-properties.md) .  
  
## <a name="see-also"></a>См. также:  
 [Свойства журнала](../server-properties/log-properties.md)   
 [Определение свойств Unknown Member и Null Processing](../lesson-4-7-defining-the-unknown-member-and-null-processing-properties.md)  
  
  
