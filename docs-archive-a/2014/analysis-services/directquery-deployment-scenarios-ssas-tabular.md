---
title: Сценарии развертывания DirectQuery (табличные службы SSAS) | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 2aaf5cb8-294b-4031-94b3-fe605d7fc4c7
author: minewiskan
ms.author: owend
ms.openlocfilehash: 2c90d90b40686b5953e26853ed9f53dcfd157f0f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87668503"
---
# <a name="directquery-deployment-scenarios-ssas-tabular"></a>Сценарии развертывания DirectQuery (табличные службы SSAS)
  В этом разделе содержится пошаговое руководство по структурной организации и процедуре развертывания моделей DirectQuery. Модель DirectQuery можно настроить либо на использование только реляционных данных (только DirectQuery), либо на переключение между использованием только закэшированных и только реляционных данных (гибридный режим). Этот раздел описывает процесс реализации обоих режимов, а также возможные различия в результатах запросов, выполняемых в разных режимах и конфигурациях безопасности.  
  
 [Проектирование и этапы развертывания](#bkmk_DQProcedure)  
  
 [Сравнение конфигураций DirectQuery](#bkmk_Configurations)  
  
##  <a name="design-and-deployment-steps"></a><a name="bkmk_DQProcedure"></a>Этапы проектирования и развертывания  
 **Шаг 1. Создание решения**  
  
 Вне зависимости от используемого режима необходимо ознакомиться с описанием ограничений по данным, используемым в моделях DirectQuery. Одним из таких ограничений, например, является то, что все данные, используемые в модели и отчетах, должны извлекаться из одной базы данных SQL Server. Дополнительные сведения см. в разделе [Режим DirectQuery (табличные службы SSAS)](tabular-models/directquery-mode-ssas-tabular.md).  
  
 Также следует рассмотреть все ограничения в отношении мер и вычисляемых столбцов и определить, совместимы ли используемые в модели формулы с режимом DirectQuery. Может потребоваться удаление или изменение следующих элементов.  
  
-   Вычисляемые столбцы не поддерживаются.  
  
-   Недопустимо использование скопированных и вставленных данных. Если ускоренное создание решения производится путем импорта модели PowerPivot, то перед его выполнением необходимо удалить связанные таблицы, поскольку такие данные не могут быть удалены после импорта и станут причиной блокировки при проверке DirectQuery.  
  
 **Шаг 2. Включение режима DirectQuery в конструкторе моделей**  
  
 По умолчанию DirectQuery отключен. Поэтому необходимо настроить среду разработки для поддержки режима DirectQuery.  
  
 Щелкните правой кнопкой мыши узел **model. bim** в Обозреватель решений и задайте для свойства **режим DirectQuery**значение `On` .  
  
 Можно включить режим DirectQuery в любое время. Однако, чтобы не создавать несовместимые с режимом DirectQuery столбцы или формулы, рекомендуется включить режим DirectQuery с самого начала.  
  
 Первоначально даже модели DirectQuery всегда создаются в памяти. Режим запроса по умолчанию для базы данных рабочей области — **DirectQuery и в памяти**. Такой гибридный режим позволяет производить кэширование импортируемых данных для оптимизации производительности во время разработки модели, одновременно выполняя проверку на соответствие требованиям DirectQuery.  
  
 **Шаг 3. Устранение ошибок проверки**  
  
 При возникновении ошибок проверки при включении DirectQuery или при добавлении новых данных или формул откройте **Список ошибок**Visual Studio и выполните необходимые в этом случае действия.  
  
-   Внесите изменения в любые параметры свойств для режима DirectQuery, руководствуясь сведениями из сообщений об ошибках.  
  
-   Удалите вычисляемые столбцы. Если для конкретной меры требуется вычисляемый столбец, всегда можно создать столбец с помощью [конструктора реляционных запросов &#40;SSAS&#41;](relational-query-designer-ssas.md) , предоставляемых в мастере импорта таблиц.  
  
-   Измените или удалите формулы, несовместимые с режимом DirectQuery. Если для вычисления требуется какая-либо функция, попробуйте заменить ее эквивалентом из Transact SQL.  
  
-   При необходимости добавьте данные.  Если ранее в модели использовались данные, скопированные и вставленные из поставщиков, отличных от SQL Server, то можно создавать новые представления и производные столбцы в рамках существующего подключения или использовать распределенные запросы.  Все данные, используемые в моделях DirectQuery, должны быть доступны из одного и того же источника данных SQL Server.  
  
 **Шаг 4. Установка предпочтительного метода для ответа на запросы в модели**  
  
|||  
|-|-|  
|**Только DirectQuery**|Установите это свойство в значение **DirectQuery**.|  
|**Гибридный режим**|Установите это свойство в значение **В памяти с DirectQuery** или **DirectQuery и в памяти**.<br /><br /> Это значение можно изменить позже в качестве альтернативной настройки.<br /><br /> Обратите внимание, что клиенты могут переопределить предпочтительный метод в строке подключения.|  
  
 **Шаг 5. Укажите секцию DirectQuery**  
  
|||  
|-|-|  
|**Только DirectQuery**|Необязательный элемент. Модель, где используется только метод DirectQuery, не нуждается в секции.<br /><br /> Но если при разработке модели секции были созданы, то не забывайте, что в качестве источника данных может использоваться только одна из них. По умолчанию первая созданная секция будет использована в качестве секции Direct Query.<br /><br /> Чтобы убедиться в том, что все данные, необходимые для модели, доступны из секции DirectQuery, выберите раздел DirectQuery и измените инструкцию SQL так, чтобы извлекался полный набор данных.|  
|**Гибридный режим**|Если хотя бы одна таблица в модели содержит множество секций, то необходимо выбрать одну из них в качестве источника для запросов в режиме *DirectQuery*. Если не назначить секцию по умолчанию, то в качестве секции DirectQuery будет использована первая созданная секция.<br /><br /> Установите параметры обработки для всех секций, кроме секции DirectQuery. Обычно раздел DirectQuery никогда не обрабатывается, поскольку данные передаются от реляционного источника данных.<br /><br /> Дополнительные сведения см. в [разделах partitions и режим DirectQuery &#40;табличные&#41;SSAS ](tabular-models/define-partitions-in-directquery-models-ssas-tabular.md).|  
  
 **Шаг 6. Настройка олицетворения**  
  
 Олицетворение поддерживается только для моделей DirectQuery. **Параметры олицетворения**определяют учетные данные, которые будут использоваться при просмотре данных, полученных от заданного источника данных SQL Server.  
  
|||  
|-|-|  
|**Только DirectQuery**|Для свойства  **Параметры олицетворения** укажите учетную запись, которая будет использоваться для подключения к источнику данных SQL Server.<br /><br /> При использовании значения **ImpersonateCurrentUser**экземпляр служб [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] , в котором размещена модель, передаст учетные данные текущего пользователя модели в базу данных SQL Server.|  
|**Гибридный режим**|Задайте для свойства **Параметры олицетворения** учетную запись, которая будет использоваться для доступа к источнику данных SQL Server.<br /><br /> Этот параметр не отражается на учетных данных, которые используются для обработки кэша моделью.|  
  
 **Шаг 7. Развертывание модели**  
  
 Когда вы будете готовы развернуть модель, откройте меню **проект** Visual Studio и выберите пункт **свойства**. Установите свойство **QueryMode** в одно из значений, описанных в следующей таблице.  
  
 Дополнительные сведения см. [в разделе Развертывание из SQL Server Data Tools &#40;табличных&#41;SSAS ](tabular-models/deploy-from-sql-server-data-tools-ssas-tabular.md).  
  
|||  
|-|-|  
|**Только DirectQuery**|**DirectQueryOnly**<br /><br /> Поскольку был задан режим только Direct Query, метаданные модели развертываются на сервере, однако сама модель не обрабатывается.<br /><br /> Обратите внимание, что после развертывания модели кэш, используемый базой данных рабочей области, не удаляется автоматически. Если вы не хотите, чтобы пользователи имели доступ к кэшированным данным, можно очистить кэш, использовавшийся во время разработки. Дополнительные сведения см. [в разделе очистка Analysis Services кэшей](instances/clear-the-analysis-services-caches.md).|  
|**Гибридный режим**|**DirectQuery и в памяти**<br /><br /> **В памяти с DirectQuery**<br /><br /> Оба этих значения позволяют при необходимости использовать либо кэш, либо реляционный источник данных. Этот порядок определяет, какой источник данных используется по умолчанию при ответе на запросы к модели.<br /><br /> В гибридном режиме кэш должен обрабатываться одновременно с развертыванием метаданных модели на сервере.<br /><br /> Этот параметр можно изменить после развертывания.|  
  
 **Шаг 8. Проверка развернутой модели**  
  
 В среде [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)]откройте экземпляр служб [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] , на котором развернута модель. Щелкните правой кнопкой мыши имя базы данных и выберите пункт **Свойства**.  
  
-   Значение свойства **DirectQueryMode**было установлено при определении свойств развертывания.  
  
-   Значение свойства **Сведения об олицетворении источника данных**было установлено при определении параметров олицетворения пользователя. Дополнительные сведения см. в разделе [Задание параметров олицетворения (многомерная база данных SSAS)](multidimensional-models/set-impersonation-options-ssas-multidimensional.md).  
  
-   Эти свойства можно изменить в любое время после развертывания модели.  
  
##  <a name="comparing-directquery-options"></a><a name="bkmk_Configurations"></a>Сравнение параметров DirectQuery  
 **Только DirectQuery**  
 Этот режим предпочтителен, когда требуется гарантировать использование единственного источника данных либо когда объем данных слишком велик для размещения в памяти. При работе с очень большим источником реляционных данных во время разработки такую модель можно создать на основе некоторого подмножества данных. При развертывании модели в режиме «только DirectQuery» можно изменить определение источника данных так, чтобы он включал все требуемые данные.  
  
 Этот режим также предпочтителен, если вы хотите использовать возможности безопасности, предоставляемые в реляционном источнике данных и предназначенные для контроля доступа пользователей к данным. При использовании кэшированных табличных моделей можно также использовать роли [!INCLUDE[ssASnoversion](../includes/ssasnoversion-md.md)] для контроля доступа к данным, однако при этом необходимо обеспечить защиту данных, сохраненных в кэше. Этот режим необходимо использовать всегда, когда в контексте безопасности не допускается кэширование данных.  
  
 В следующей таблице показаны возможные результаты развертывания с использованием режима «только DirectQuery».  
  
|||  
|-|-|  
|**DirectQuery без кэширования**|Данные в кэш не загружаются. Модель не может быть обработана.<br /><br /> Запросы к модели могут выполняться только с помощью клиентов, поддерживающих запросы DAX. Результаты запроса всегда возвращаются из исходного источника данных.<br /><br /> **DirectQueryMode** = `On`<br /><br /> **QueryMode**  =  **DirectQuery**|  
|**DirectQuery с запросами только данных кэша**|Развертывание завершается с ошибкой. Такая конфигурация не поддерживается.<br /><br /> **DirectQueryMode** = `On`<br /><br /> **QueryMode**  =  **В памяти**|  
  
 **Гибридный режим**  
 Развертывание модели в гибридом режиме обладает многочисленными преимуществами: при необходимости из источника данных SQL Server можно получить самые последние данные, однако сохраненный кэш позволяет работать с данными в памяти, обеспечивая более высокую производительность при разработке отчетов или проверке модели.  
  
 Гибридный режим DirectQuery также полезен при работе с очень большой моделью. Во время обработки можно переключить модель в режим DirectQuery, чтобы пользователи не получали устаревшие данные и имели доступ к модели при обработке кэша. Пользователи могут почувствовать небольшое снижение в производительности, однако они смогут получать самые последние данные напрямую из реляционного хранилища.  
  
 В следующей таблице выполняется сравнение результатов развертывания с каждым из сочетаний параметров, использованных в режиме DirectQuery.  
  
|||  
|-|-|  
|**Задано предпочтение гибридного режима с кэшем**|Модель может обрабатываться, а данные могут загружаться в кэш. В запросах по умолчанию используется кэш.  Если клиенту необходимо использовать источник DirectQuery, в строку подключения необходимо вставить параметр.<br /><br /> **DirectQueryMode** = `On`<br /><br /> **QueryMode**  =  **В памяти с DirectQuery**|  
|**Задано предпочтение гибридного режима с DirectQuery**|Модель обрабатывается, а данные могут загружаться в кэш. Тем не менее запросы используют DirectQuery по умолчанию. Если клиенту необходимо использовать кэшированные данные, в строку подключения необходимо вставить параметр. Если таблицы в модели секционированы, главная секция кэша данных также устанавливается в режим **В памяти с DirectQuery**.<br /><br /> **DirectQueryMode** = `On`<br /><br /> **QueryMode**  =  **DirectQuery с нав памяти**|  
  
## <a name="see-also"></a>См. также:  
 [Режим DirectQuery &#40;табличные&#41;SSAS](tabular-models/directquery-mode-ssas-tabular.md)   
 [Доступ к данным табличной модели](tabular-models/tabular-model-data-access.md)  
  
  
