---
title: Ограничения первичных и внешних ключей | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- foreign keys [SQL Server], cascading referential integrity
- FOREIGN KEY constraints
- foreign keys [SQL Server]
- foreign keys [SQL Server], about foreign key constraints
ms.assetid: 31fbcc9f-2dc5-4bf9-aa50-ed70ec7b5bcd
author: stevestein
ms.author: sstein
ms.openlocfilehash: b6e7b88de880348fabb00cb46d3028716441bc2b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87666980"
---
# <a name="primary-and-foreign-key-constraints"></a><span data-ttu-id="d2ac2-102">Ограничения первичных и внешних ключей</span><span class="sxs-lookup"><span data-stu-id="d2ac2-102">Primary and Foreign Key Constraints</span></span>
  <span data-ttu-id="d2ac2-103">Первичные и внешние ключи представляют собой два типа ограничений, которые могут использоваться для обеспечения целостности данных в таблицах [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d2ac2-103">Primary keys and foreign keys are two types of constraints that can be used to enforce data integrity in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tables.</span></span> <span data-ttu-id="d2ac2-104">Это важные объекты базы данных.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-104">These are important database objects.</span></span>

 <span data-ttu-id="d2ac2-105">Эта тема описана в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-105">This topic contains the following sections.</span></span>

 [<span data-ttu-id="d2ac2-106">Ограничения первичного ключа</span><span class="sxs-lookup"><span data-stu-id="d2ac2-106">Primary Key Constraints</span></span>](../tables/primary-and-foreign-key-constraints.md#PKeys)

 [<span data-ttu-id="d2ac2-107">Foreign Key Constraints</span><span class="sxs-lookup"><span data-stu-id="d2ac2-107">Foreign Key Constraints</span></span>](../tables/primary-and-foreign-key-constraints.md#FKeys)

 [<span data-ttu-id="d2ac2-108">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="d2ac2-108">Related Tasks</span></span>](../tables/primary-and-foreign-key-constraints.md#Tasks)

##  <a name="primary-key-constraints"></a><a name="PKeys"></a> <span data-ttu-id="d2ac2-109">Ограничения первичного ключа</span><span class="sxs-lookup"><span data-stu-id="d2ac2-109">Primary Key Constraints</span></span>
 <span data-ttu-id="d2ac2-110">Обычно в таблице есть столбец или сочетание столбцов, содержащих значения, уникально определяющие каждую строку таблицы.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-110">A table typically has a column or combination of columns that contain values that uniquely identify each row in the table.</span></span> <span data-ttu-id="d2ac2-111">Этот столбец, или столбцы, называются первичным ключом (PK) таблицы и обеспечивает целостность сущности таблицы.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-111">This column, or columns, is called the primary key (PK) of the table and enforces the entity integrity of the table.</span></span> <span data-ttu-id="d2ac2-112">Ограничения первичного ключа часто определяются в столбце идентификаторов, поскольку гарантируют уникальность данных.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-112">Because primary key constraints guarantee unique data, they are frequently defined on an identity column.</span></span>

 <span data-ttu-id="d2ac2-113">При задании ограничения первичного ключа для таблицы компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] гарантирует уникальность данных путем автоматического создания уникального индекса для первичных ключевых столбцов.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-113">When you specify a primary key constraint for a table, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] enforces data uniqueness by automatically creating a unique index for the primary key columns.</span></span> <span data-ttu-id="d2ac2-114">Этот индекс также обеспечивает быстрый доступ к данным при использовании первичного ключа в запросах.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-114">This index also permits fast access to data when the primary key is used in queries.</span></span> <span data-ttu-id="d2ac2-115">Если ограничение первичного ключа задано более чем для одного столбца, то значения могут дублироваться в пределах одного столбца, но каждое сочетание значений всех столбцов в определении ограничения первичного ключа должно быть уникальным.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-115">If a primary key constraint is defined on more than one column, values may be duplicated within one column, but each combination of values from all the columns in the primary key constraint definition must be unique.</span></span>

 <span data-ttu-id="d2ac2-116">Как показано на следующем рисунке, столбцы **ProductID** и **VendorID** в таблице **Purchasing.ProductVendor** формируют составное ограничение первичного ключа для данной таблицы.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-116">As shown in the following illustration, the **ProductID** and **VendorID** columns in the **Purchasing.ProductVendor** table form a composite primary key constraint for this table.</span></span> <span data-ttu-id="d2ac2-117">При этом гарантируется, что каждая строка в таблице **ProductVendor** имеет уникальное сочетание значений **ProductID** и **VendorID**.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-117">This makes sure that every row in the **ProductVendor** table has a unique combination of **ProductID** and **VendorID**.</span></span> <span data-ttu-id="d2ac2-118">Это предотвращает вставку повторяющихся строк.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-118">This prevents the insertion of duplicate rows.</span></span>

 <span data-ttu-id="d2ac2-119">![Составное ограничение PRIMARY KEY](../../database-engine/media/fund04.gif "Составное ограничение PRIMARY KEY")</span><span class="sxs-lookup"><span data-stu-id="d2ac2-119">![Composite PRIMARY KEY constraint](../../database-engine/media/fund04.gif "Composite PRIMARY KEY constraint")</span></span>

-   <span data-ttu-id="d2ac2-120">В таблице возможно наличие только одного ограничения по первичному ключу.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-120">A table can contain only one primary key constraint.</span></span>

-   <span data-ttu-id="d2ac2-121">Первичный ключ не может включать больше 16 столбцов, а общая длина ключа не может превышать 900 байт.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-121">A primary key cannot exceed 16 columns and a total key length of 900 bytes.</span></span>

-   <span data-ttu-id="d2ac2-122">Индекс, формируемый ограничением первичного ключа, не может повлечь за собой выход количества индексов в таблице за пределы в 999 некластеризованных индексов и 1 кластеризованный.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-122">The index generated by a primary key constraint cannot cause the number of indexes on the table to exceed 999 nonclustered indexes and 1 clustered index.</span></span>

-   <span data-ttu-id="d2ac2-123">Если для ограничения первичного ключа не указано, является ли индекс кластеризованным или некластеризованным, то создается кластеризованный индекс, если таковой отсутствует в таблице.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-123">If clustered or nonclustered is not specified for a primary key constraint, clustered is used if there no clustered index on the table.</span></span>

-   <span data-ttu-id="d2ac2-124">Все столбцы с ограничением первичного ключа должны быть определены как не допускающие значения NULL.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-124">All columns defined within a primary key constraint must be defined as not null.</span></span> <span data-ttu-id="d2ac2-125">Если допустимость значения NULL не указана, то все столбцы c ограничением первичного ключа устанавливаются как не допускающие значения NULL.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-125">If nullability is not specified, all columns participating in a primary key constraint have their nullability set to not null.</span></span>

-   <span data-ttu-id="d2ac2-126">Если первичный ключ определен на столбце определяемого пользователем типа данных CLR, реализация этого типа должна поддерживать двоичную сортировку.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-126">If a primary key is defined on a CLR user-defined type column, the implementation of the type must support binary ordering.</span></span>

##  <a name="foreign-key-constraints"></a><a name="FKeys"></a> <span data-ttu-id="d2ac2-127">Foreign Key Constraints</span><span class="sxs-lookup"><span data-stu-id="d2ac2-127">Foreign Key Constraints</span></span>
 <span data-ttu-id="d2ac2-128">Внешний ключ (FK) — это столбец или сочетание столбцов, которое применяется для принудительного установления связи между данными в двух таблицах с целью контроля данных, которые могут храниться в таблице внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-128">A foreign key (FK) is a column or combination of columns that is used to establish and enforce a link between the data in two tables to control the data that can be stored in the foreign key table.</span></span> <span data-ttu-id="d2ac2-129">Если один или несколько столбцов, в которых находится первичный ключ для одной таблицы, упоминается в одном или нескольких столбцах другой таблицы, то в ссылке внешнего ключа создается связь между двумя таблицами.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-129">In a foreign key reference, a link is created between two tables when the column or columns that hold the primary key value for one table are referenced by the column or columns in another table.</span></span> <span data-ttu-id="d2ac2-130">Этот столбец становится внешним ключом во второй таблице.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-130">This column becomes a foreign key in the second table.</span></span>

 <span data-ttu-id="d2ac2-131">Например, таблица **Sales.SalesOrderHeader** связана с таблицей **Sales.SalesPerson** с помощью внешнего ключа, так как существует логическая связь между заказами на продажу и менеджерами по продажам.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-131">For example, the **Sales.SalesOrderHeader** table has a foreign key link to the **Sales.SalesPerson** table because there is a logical relationship between sales orders and salespeople.</span></span> <span data-ttu-id="d2ac2-132">Столбец **SalesPersonID** в таблице **Sales.SalesOrderHeader** соответствует первичному ключевому столбцу в таблице **SalesPerson** .</span><span class="sxs-lookup"><span data-stu-id="d2ac2-132">The **SalesPersonID** column in the **SalesOrderHeader** table matches the primary key column of the **SalesPerson** table.</span></span> <span data-ttu-id="d2ac2-133">Столбец **SalesPersonID** в таблице **Sales.SalesOrderHeader** является внешним ключом для таблицы **SalesPerson** .</span><span class="sxs-lookup"><span data-stu-id="d2ac2-133">The **SalesPersonID** column in the **SalesOrderHeader** table is the foreign key to the **SalesPerson** table.</span></span> <span data-ttu-id="d2ac2-134">С помощью установления данной связи по внешнему ключу значение для **SalesPersonID** не может быть вставлено в таблицу **SalesOrderHeader** , если оно в настоящий момент не содержится в таблице **SalesPerson** .</span><span class="sxs-lookup"><span data-stu-id="d2ac2-134">By creating this foreign key relationship, a value for **SalesPersonID** cannot be inserted into the **SalesOrderHeader** table if it does not already exist in the **SalesPerson** table.</span></span>

### <a name="indexes-on-foreign-key-constraints"></a><span data-ttu-id="d2ac2-135">Индексы в ограничениях внешнего ключа</span><span class="sxs-lookup"><span data-stu-id="d2ac2-135">Indexes on Foreign Key Constraints</span></span>
 <span data-ttu-id="d2ac2-136">В отличие от ограничений первичного ключа, при создании ограничения внешнего ключа соответствующий индекс автоматически не создается.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-136">Unlike primary key constraints, creating a foreign key constraint does not automatically create a corresponding index.</span></span> <span data-ttu-id="d2ac2-137">Тем не менее, часто возникает необходимость создания индекса для внешнего ключа вручную по следующим причинам:</span><span class="sxs-lookup"><span data-stu-id="d2ac2-137">However, manually creating an index on a foreign key is often useful for the following reasons:</span></span>

-   <span data-ttu-id="d2ac2-138">Столбцы внешнего ключа часто используются в критериях соединения при совместном применении в запросах данных из связанных таблиц. Это реализуется путем сопоставления столбца или столбцов в ограничении внешнего ключа в одной таблице с одним или несколькими столбцами первичного или уникального ключа в другой таблице.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-138">Foreign key columns are frequently used in join criteria when the data from related tables is combined in queries by matching the column or columns in the foreign key constraint of one table with the primary or unique key column or columns in the other table.</span></span> <span data-ttu-id="d2ac2-139">Индекс позволяет компоненту [!INCLUDE[ssDE](../../includes/ssde-md.md)] быстро находить связанные данные в таблице внешних ключей.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-139">An index enables the [!INCLUDE[ssDE](../../includes/ssde-md.md)] to quickly find related data in the foreign key table.</span></span> <span data-ttu-id="d2ac2-140">Впрочем, создание индекса не является обязательным.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-140">However, creating this index is not required.</span></span> <span data-ttu-id="d2ac2-141">Данные из двух связанных таблиц можно комбинировать, даже если между таблицами не определены ограничения первичного ключа или внешнего ключа, но связь по внешнему ключу между двумя таблицами показывает, что эти две таблицы оптимизированы для совместного применения в запросе, где ключи используются в качестве критериев.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-141">Data from two related tables can be combined even if no primary key or foreign key constraints are defined between the tables, but a foreign key relationship between two tables indicates that the two tables have been optimized to be combined in a query that uses the keys as its criteria.</span></span>

-   <span data-ttu-id="d2ac2-142">С помощью ограничений внешнего ключа в связанных таблицах проверяются изменения ограничений первичного ключа.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-142">Changes to primary key constraints are checked with foreign key constraints in related tables.</span></span>

### <a name="referential-integrity"></a><span data-ttu-id="d2ac2-143">Ссылочная целостность</span><span class="sxs-lookup"><span data-stu-id="d2ac2-143">Referential Integrity</span></span>
 <span data-ttu-id="d2ac2-144">Главная задача ограничения внешнего ключа состоит в управлении данными, которые могут быть сохранены в таблице внешнего ключа, но это ограничение контролирует также изменение данных в таблице первичного ключа.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-144">Although the main purpose of a foreign key constraint is to control the data that can be stored in the foreign key table, it also controls changes to data in the primary key table.</span></span> <span data-ttu-id="d2ac2-145">Например, при удалении строки для менеджера по продажам из таблицы **Sales.SalesPerson** , идентификатор которого используется в заказах на продажу в таблице **Sales.SalesOrderHeader** , ссылочная целостность двух таблиц будет нарушена. Заказы на продажу удаленного менеджера в таблице **SalesOrderHeader** станут недействительными без связи с данными в таблице **SalesPerson** .</span><span class="sxs-lookup"><span data-stu-id="d2ac2-145">For example, if the row for a salesperson is deleted from the **Sales.SalesPerson** table, and the salesperson's ID is used for sales orders in the **Sales.SalesOrderHeader** table, the relational integrity between the two tables is broken; the deleted salesperson's sales orders are orphaned in the **SalesOrderHeader** table without a link to the data in the **SalesPerson** table.</span></span>

 <span data-ttu-id="d2ac2-146">Ограничение внешнего ключа предотвращает возникновение этой ситуации.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-146">A foreign key constraint prevents this situation.</span></span> <span data-ttu-id="d2ac2-147">Ограничение обеспечивает целостность ссылок следующим образом: оно запрещает изменение данных в таблице первичного ключа, если такие изменения сделают недопустимой ссылку в таблице внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-147">The constraint enforces referential integrity by guaranteeing that changes cannot be made to data in the primary key table if those changes invalidate the link to data in the foreign key table.</span></span> <span data-ttu-id="d2ac2-148">Если при попытке удалить строку в таблице первичного ключа или изменить значение этого ключа будет обнаружено, что удаленному или измененному значению первичного ключа соответствует определенное значение в ограничении внешнего ключа в другой таблице, то действие выполнено не будет.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-148">If an attempt is made to delete the row in a primary key table or to change a primary key value, the action will fail when the deleted or changed primary key value corresponds to a value in the foreign key constraint of another table.</span></span> <span data-ttu-id="d2ac2-149">Для успешного изменения или удаления строки с ограничением внешнего ключа необходимо сначала удалить данные внешнего ключа в таблице внешнего ключа либо изменить в таблице внешнего ключа данные, которые связывают внешний ключ с данными другого первичного ключа.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-149">To successfully change or delete a row in a foreign key constraint, you must first either delete the foreign key data in the foreign key table or change the foreign key data in the foreign key table, which links the foreign key to different primary key data.</span></span>

#### <a name="cascading-referential-integrity"></a><span data-ttu-id="d2ac2-150">Каскадная ссылочная целостность</span><span class="sxs-lookup"><span data-stu-id="d2ac2-150">Cascading Referential Integrity</span></span>
 <span data-ttu-id="d2ac2-151">С помощью каскадных ограничений ссылочной целостности можно определять действия, которые компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] будет предпринимать, когда пользователь попытается удалить или обновить ключ, на который указывают еще существующие внешние ключи.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-151">By using cascading referential integrity constraints, you can define the actions that the [!INCLUDE[ssDE](../../includes/ssde-md.md)] takes when a user tries to delete or update a key to which existing foreign keys point.</span></span> <span data-ttu-id="d2ac2-152">Могут быть определены следующие каскадные действия.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-152">The following cascading actions can be defined.</span></span>

 <span data-ttu-id="d2ac2-153">ДЕЙСТВИЕ не [!INCLUDE[ssDE](../../includes/ssde-md.md)] вызывает ошибку, и выполняется откат операции удаления или обновления строки в родительской таблице.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-153">NO ACTION The [!INCLUDE[ssDE](../../includes/ssde-md.md)] raises an error and the delete or update action on the row in the parent table is rolled back.</span></span>

 <span data-ttu-id="d2ac2-154">Строки, соответствующие строкам, обновляются или удаляются в ссылающейся таблице при обновлении или удалении этой строки в родительской таблице.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-154">CASCADE Corresponding rows are updated or deleted in the referencing table when that row is updated or deleted in the parent table.</span></span> <span data-ttu-id="d2ac2-155">Значение CASCADE не может быть указано, если столбец типа `timestamp` является частью внешнего или ссылочного ключа.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-155">CASCADE cannot be specified if a `timestamp` column is part of either the foreign key or the referenced key.</span></span> <span data-ttu-id="d2ac2-156">Действие ON DELETE CASCADE не может быть указано в таблице, для которой определен триггер INSTEAD OF DELETE.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-156">ON DELETE CASCADE cannot be specified for a table that has an INSTEAD OF DELETE trigger.</span></span> <span data-ttu-id="d2ac2-157">Предложение ON UPDATE CASCADE не может быть задано применительно к таблицам, для которых определены триггеры INSTEAD OF UPDATE.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-157">ON UPDATE CASCADE cannot be specified for tables that have INSTEAD OF UPDATE triggers.</span></span>

 <span data-ttu-id="d2ac2-158">ЗАДАТЬ значения NULL все значения, составляющие внешний ключ, устанавливаются в значение NULL при обновлении или удалении соответствующей строки в родительской таблице.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-158">SET NULL All the values that make up the foreign key are set to NULL when the corresponding row in the parent table is updated or deleted.</span></span> <span data-ttu-id="d2ac2-159">Для выполнения этого ограничения внешние ключевые столбцы должны допускать значения NULL.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-159">For this constraint to execute, the foreign key columns must be nullable.</span></span> <span data-ttu-id="d2ac2-160">Не может быть задано применительно к таблицам, для которых определены триггеры INSTEAD OF UPDATE.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-160">Cannot be specified for tables that have INSTEAD OF UPDATE triggers.</span></span>

 <span data-ttu-id="d2ac2-161">УСТАНОВИТЬ значения по умолчанию для всех значений, составляющих внешний ключ, в случае обновления или удаления соответствующей строки в родительской таблице.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-161">SET DEFAULT All the values that make up the foreign key are set to their default values if the corresponding row in the parent table is updated or deleted.</span></span> <span data-ttu-id="d2ac2-162">Для выполнения этого ограничения все внешние ключевые столбцы должны иметь определения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-162">For this constraint to execute, all foreign key columns must have default definitions.</span></span> <span data-ttu-id="d2ac2-163">Если столбец допускает значения NULL и значение по умолчанию явно не определено, значением столбца по умолчанию становится NULL.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-163">If a column is nullable, and there is no explicit default value set, NULL becomes the implicit default value of the column.</span></span> <span data-ttu-id="d2ac2-164">Не может быть задано применительно к таблицам, для которых определены триггеры INSTEAD OF UPDATE.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-164">Cannot be specified for tables that have INSTEAD OF UPDATE triggers.</span></span>

 <span data-ttu-id="d2ac2-165">Ключевые слова CASCADE, SET NULL, SET DEFAULT и NO ACTION можно сочетать в таблицах, имеющих взаимные ссылочные связи.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-165">CASCADE, SET NULL, SET DEFAULT and NO ACTION can be combined on tables that have referential relationships with each other.</span></span> <span data-ttu-id="d2ac2-166">Если компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] обнаруживает ключевое слово NO ACTION, оно остановит и произведет откат связанных операций CASCADE, SET NULL и SET DEFAULT.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-166">If the [!INCLUDE[ssDE](../../includes/ssde-md.md)] encounters NO ACTION, it stops and rolls back related CASCADE, SET NULL and SET DEFAULT actions.</span></span> <span data-ttu-id="d2ac2-167">Если инструкция DELETE содержит сочетание ключевых слов CASCADE, SET NULL, SET DEFAULT и NO ACTION, то все операции CASCADE, SET NULL и SET DEFAULT выполняются перед поиском компонентом [!INCLUDE[ssDE](../../includes/ssde-md.md)] операции NO ACTION.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-167">When a DELETE statement causes a combination of CASCADE, SET NULL, SET DEFAULT and NO ACTION actions, all the CASCADE, SET NULL and SET DEFAULT actions are applied before the [!INCLUDE[ssDE](../../includes/ssde-md.md)] checks for any NO ACTION.</span></span>

### <a name="triggers-and-cascading-referential-actions"></a><span data-ttu-id="d2ac2-168">Триггеры и каскадные ссылочные действия</span><span class="sxs-lookup"><span data-stu-id="d2ac2-168">Triggers and Cascading Referential Actions</span></span>
 <span data-ttu-id="d2ac2-169">Каскадные ссылочные действия запускают триггеры AFTER UPDATE или AFTER DELETE следующим образом:</span><span class="sxs-lookup"><span data-stu-id="d2ac2-169">Cascading referential actions fire the AFTER UPDATE or AFTER DELETE triggers in the following manner:</span></span>

-   <span data-ttu-id="d2ac2-170">Все каскадные ссылочные действия, прямо вызванные исходными инструкциями DELETE или UPDATE, выполняются первыми.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-170">All the cascading referential actions directly caused by the original DELETE or UPDATE are performed first.</span></span>

-   <span data-ttu-id="d2ac2-171">Если есть какие-либо триггеры AFTER, определенные для измененных таблиц, эти триггеры запускаются после выполнения всех каскадных действий.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-171">If there are any AFTER triggers defined on the affected tables, these triggers fire after all cascading actions are performed.</span></span> <span data-ttu-id="d2ac2-172">Эти триггеры запускаются в порядке, обратном каскадным действиям.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-172">These triggers fire in opposite order of the cascading action.</span></span> <span data-ttu-id="d2ac2-173">Если для одной таблицы определены несколько триггеров, они запускаются в случайном порядке, если только не указаны выделенные первый и последний триггеры таблицы.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-173">If there are multiple triggers on a single table, they fire in random order, unless there is a dedicated first or last trigger for the table.</span></span> <span data-ttu-id="d2ac2-174">Этот порядок определяется процедурой [sp_settriggerorder](/sql/relational-databases/system-stored-procedures/sp-settriggerorder-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d2ac2-174">This order is as specified by using [sp_settriggerorder](/sql/relational-databases/system-stored-procedures/sp-settriggerorder-transact-sql).</span></span>

-   <span data-ttu-id="d2ac2-175">Если последовательности каскадных действий происходят из таблицы, которая была непосредственной целью действий DELETE или UPDATE, порядок запуска триггеров этими последовательностями действий не определен.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-175">If multiple cascading chains originate from the table that was the direct target of an UPDATE or DELETE action, the order in which these chains fire their respective triggers is unspecified.</span></span> <span data-ttu-id="d2ac2-176">Однако одна последовательность действий всегда запускает все свои триггеры до того, как это начнет делать следующая.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-176">However, one chain always fires all its triggers before another chain starts firing.</span></span>

-   <span data-ttu-id="d2ac2-177">Триггер AFTER таблицы, являвшейся непосредственной целью действий DELETE или UPDATE, запускается вне зависимости от того, были ли изменены хоть какие-нибудь строки.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-177">An AFTER trigger on the table that is the direct target of an UPDATE or DELETE action fires regardless of whether any rows are affected.</span></span> <span data-ttu-id="d2ac2-178">В этом случае ни на какие другие таблицы каскадирование не влияет.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-178">There are no other tables affected by cascading in this case.</span></span>

-   <span data-ttu-id="d2ac2-179">Если один из предыдущих триггеров выполняет операции DELETE или UPDATE над другими таблицами, эти операции могут вызывать собственные последовательности каскадных действий.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-179">If any one of the previous triggers perform UPDATE or DELETE operations on other tables, these actions can start secondary cascading chains.</span></span> <span data-ttu-id="d2ac2-180">Эти вторичные последовательности действий обрабатываются для каждой операции DELETE или UPDATE после выполнения всех триггеров первичных последовательностей действий.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-180">These secondary chains are processed for each UPDATE or DELETE operation at a time after all triggers on all primary chains fire.</span></span> <span data-ttu-id="d2ac2-181">Этот процесс может рекурсивно повторяться для последующих операций DELETE или UPDATE.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-181">This process may be recursively repeated for subsequent UPDATE or DELETE operations.</span></span>

-   <span data-ttu-id="d2ac2-182">Выполнение операций CREATE, ALTER, DELETE или других операций языка DDL внутри триггеров может привести к запуску триггеров DDL.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-182">Performing CREATE, ALTER, DELETE, or other data definition language (DDL) operations inside the triggers may cause DDL triggers to fire.</span></span> <span data-ttu-id="d2ac2-183">Это может привести к дальнейшим операциям DELETE или UPDATE, которые начнут дополнительные последовательности каскадных действий и запустят свои триггеры.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-183">This may subsequently perform DELETE or UPDATE operations that start additional cascading chains and triggers.</span></span>

-   <span data-ttu-id="d2ac2-184">Если в любой конкретной последовательности каскадных ссылочных действий произойдет ошибка, в этой последовательности не будут запущены никакие триггеры AFTER, а для операций DELETE или UPDATE, создаваемых этой последовательностью, будет выполнен откат.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-184">If an error is generated inside any particular cascading referential action chain, an error is raised, no AFTER triggers are fired in that chain, and the DELETE or UPDATE operation that created the chain is rolled back.</span></span>

-   <span data-ttu-id="d2ac2-185">У таблицы, для которой определен триггер INSTEAD OF, может также быть предложение REFERENCES, указывающее конкретное каскадное действие.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-185">A table that has an INSTEAD OF trigger cannot also have a REFERENCES clause that specifies a cascading action.</span></span> <span data-ttu-id="d2ac2-186">Однако триггер AFTER целевой таблицы каскадного действия может выполнить инструкцию INSERT, UPDATE или DELETE для другой таблицы или представления, которое запустит триггер INSTEAD OF для этого объекта.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-186">However, an AFTER trigger on a table targeted by a cascading action can execute an INSERT, UPDATE, or DELETE statement on another table or view that fires an INSTEAD OF trigger defined on that object.</span></span>

##  <a name="related-tasks"></a><a name="Tasks"></a> <span data-ttu-id="d2ac2-187">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="d2ac2-187">Related Tasks</span></span>
 <span data-ttu-id="d2ac2-188">В следующей таблице перечислены общие задачи, связанные с ограничениями первичного ключа и внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-188">The following table lists the common tasks associated with primary key and foreign key constraints.</span></span>

|<span data-ttu-id="d2ac2-189">Задача</span><span class="sxs-lookup"><span data-stu-id="d2ac2-189">Task</span></span>|<span data-ttu-id="d2ac2-190">Раздел</span><span class="sxs-lookup"><span data-stu-id="d2ac2-190">Topic</span></span>|
|----------|-----------|
|<span data-ttu-id="d2ac2-191">Описывает, как создать первичный ключ.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-191">Describes how to create a primary key.</span></span>|[<span data-ttu-id="d2ac2-192">Создание первичных ключей</span><span class="sxs-lookup"><span data-stu-id="d2ac2-192">Create Primary Keys</span></span>](../tables/create-primary-keys.md)|
|<span data-ttu-id="d2ac2-193">Описывает, как удалить первичный ключ.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-193">Describes how to delete a primary key.</span></span>|[<span data-ttu-id="d2ac2-194">Удаление первичных ключей</span><span class="sxs-lookup"><span data-stu-id="d2ac2-194">Delete Primary Keys</span></span>](../tables/delete-primary-keys.md)|
|<span data-ttu-id="d2ac2-195">Описывает, как изменить первичный ключ.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-195">Describes how to modify a primary key.</span></span>|[<span data-ttu-id="d2ac2-196">Изменение первичных ключей</span><span class="sxs-lookup"><span data-stu-id="d2ac2-196">Modify Primary Keys</span></span>](../tables/modify-primary-keys.md)|
|<span data-ttu-id="d2ac2-197">Описывается создание связей внешнего ключа</span><span class="sxs-lookup"><span data-stu-id="d2ac2-197">Describes how to create foreign key relationships</span></span>|[<span data-ttu-id="d2ac2-198">Создание связей по внешнему ключу</span><span class="sxs-lookup"><span data-stu-id="d2ac2-198">Create Foreign Key Relationships</span></span>](../tables/create-foreign-key-relationships.md)|
|<span data-ttu-id="d2ac2-199">Описывает, как изменить связи внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-199">Describes how to modify foreign key relationships.</span></span>|[<span data-ttu-id="d2ac2-200">Изменение связей по внешнему ключу</span><span class="sxs-lookup"><span data-stu-id="d2ac2-200">Modify Foreign Key Relationships</span></span>](../tables/modify-foreign-key-relationships.md)|
|<span data-ttu-id="d2ac2-201">Описывает, как удалить связи внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-201">Describes how to delete foreign key relationships.</span></span>|[<span data-ttu-id="d2ac2-202">Удаление связей по внешнему ключу</span><span class="sxs-lookup"><span data-stu-id="d2ac2-202">Delete Foreign Key Relationships</span></span>](../tables/delete-foreign-key-relationships.md)|
|<span data-ttu-id="d2ac2-203">Описывает, как просматривать свойства внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-203">Describes how to view foreign key properties.</span></span>|[<span data-ttu-id="d2ac2-204">Просмотр свойств внешнего ключа</span><span class="sxs-lookup"><span data-stu-id="d2ac2-204">View Foreign Key Properties</span></span>](../tables/view-foreign-key-properties.md)|
|<span data-ttu-id="d2ac2-205">Описывает, как отключить ограничения внешнего ключа для репликации.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-205">Describes how to disable foreign key constraints for replication.</span></span>|[<span data-ttu-id="d2ac2-206">Отключение ограничений внешнего ключа для репликации</span><span class="sxs-lookup"><span data-stu-id="d2ac2-206">Disable Foreign Key Constraints for Replication</span></span>](../tables/disable-foreign-key-constraints-for-replication.md)|
|<span data-ttu-id="d2ac2-207">Описывает, как отключить ограничения внешнего ключа на время выполнения инструкций INSERT и UPDATE.</span><span class="sxs-lookup"><span data-stu-id="d2ac2-207">Describes how to disable foreign key constraints during an INSERT or UPDATE statement.</span></span>|[<span data-ttu-id="d2ac2-208">Отключение ограничений внешнего ключа для инструкций INSERT и UPDATE</span><span class="sxs-lookup"><span data-stu-id="d2ac2-208">Disable Foreign Key Constraints with INSERT and UPDATE Statements</span></span>](../tables/disable-foreign-key-constraints-with-insert-and-update-statements.md)|


