---
title: Ограничения уникальности и проверочные ограничения | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- constraints [SQL Server], Visual Database Tools
- Visual Database Tools [SQL Server], constraints
ms.assetid: 637098af-2567-48f8-90f4-b41df059833e
author: stevestein
ms.author: sstein
ms.openlocfilehash: 205e4ae3d6f89f10a933bf357d1eeda458852584
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87728125"
---
# <a name="unique-constraints-and-check-constraints"></a><span data-ttu-id="13da0-102">Ограничения уникальности и проверочные ограничения</span><span class="sxs-lookup"><span data-stu-id="13da0-102">Unique Constraints and Check Constraints</span></span>
  <span data-ttu-id="13da0-103">Ограничения UNIQUE и CHECK — это два типа ограничений, которые могут использоваться для обеспечения целостности данных в таблицах [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="13da0-103">UNIQUE constraints and CHECK constraints are two types of constraints that can be used to enforce data integrity in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tables.</span></span> <span data-ttu-id="13da0-104">Это важные объекты базы данных.</span><span class="sxs-lookup"><span data-stu-id="13da0-104">These are important database objects.</span></span>  
  
 <span data-ttu-id="13da0-105">Эта тема описана в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="13da0-105">This topic contains the following sections.</span></span>  
  
 [<span data-ttu-id="13da0-106">Ограничения UNIQUE</span><span class="sxs-lookup"><span data-stu-id="13da0-106">UNIQUE Constraints</span></span>](#Unique)  
  
 [<span data-ttu-id="13da0-107">Ограничения CHECK</span><span class="sxs-lookup"><span data-stu-id="13da0-107">CHECK Constraints</span></span>](#Check)  
  
 [<span data-ttu-id="13da0-108">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="13da0-108">Related Tasks</span></span>](#Tasks)  
  
##  <a name="unique-constraints"></a><a name="Unique"></a> <span data-ttu-id="13da0-109">Ограничения UNIQUE</span><span class="sxs-lookup"><span data-stu-id="13da0-109">UNIQUE Constraints</span></span>  
 <span data-ttu-id="13da0-110">Ограничения представляют собой правила, которые принудительно применяются в [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] от имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="13da0-110">Constraints are rules that the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] enforces for you.</span></span> <span data-ttu-id="13da0-111">Например, ограничения UNIQUE можно использовать для обеспечения того, чтобы в указанные столбцы, не входящие в состав первичного ключа, не вводились повторяющиеся значения.</span><span class="sxs-lookup"><span data-stu-id="13da0-111">For example, you can use UNIQUE constraints to make sure that no duplicate values are entered in specific columns that do not participate in a primary key.</span></span> <span data-ttu-id="13da0-112">Хотя уникальность значений ограничения UNIQUE и PRIMARY KEY гарантируют в равной степени, в случае, когда необходимо обеспечить уникальность в столбце или комбинации столбцов, которые не являются первичными ключевыми, вместо ограничения PRIMARY KEY следует использовать ограничение UNIQUE.</span><span class="sxs-lookup"><span data-stu-id="13da0-112">Although both a UNIQUE constraint and a PRIMARY KEY constraint enforce uniqueness, use a UNIQUE constraint instead of a PRIMARY KEY constraint when you want to enforce the uniqueness of a column, or combination of columns, that is not the primary key.</span></span>  
  
 <span data-ttu-id="13da0-113">В отличие от PRIMARY KEY, ограничения UNIQUE допускают значение NULL.</span><span class="sxs-lookup"><span data-stu-id="13da0-113">Unlike PRIMARY KEY constraints, UNIQUE constraints allow for the value NULL.</span></span> <span data-ttu-id="13da0-114">Однако, как и всякое другое значение столбца с ограничением UNIQUE, NULL может встречаться только один раз.</span><span class="sxs-lookup"><span data-stu-id="13da0-114">However, as with any value participating in a UNIQUE constraint, only one null value is allowed per column.</span></span> <span data-ttu-id="13da0-115">На ограничение UNIQUE могут ссылаться ограничения FOREIGN KEY.</span><span class="sxs-lookup"><span data-stu-id="13da0-115">A UNIQUE constraint can be referenced by a FOREIGN KEY constraint.</span></span>  
  
 <span data-ttu-id="13da0-116">При добавлении ограничения UNIQUE на уже существующий столбец или группу столбцов в таблице, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] по умолчанию проверяет уникальность всех существующих значений в указанных столбцах.</span><span class="sxs-lookup"><span data-stu-id="13da0-116">When a UNIQUE constraint is added to an existing column or columns in the table, by default, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] examines the existing data in the columns to make sure all values are unique.</span></span> <span data-ttu-id="13da0-117">При попытке добавить ограничение UNIQUE к столбцу, содержащему повторяющиеся значения, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] возвращает ошибку, а ограничение не добавляется.</span><span class="sxs-lookup"><span data-stu-id="13da0-117">If a UNIQUE constraint is added to a column that has duplicated values, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] returns an error and does not add the constraint.</span></span>  
  
 <span data-ttu-id="13da0-118">Компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] автоматически создает индекс UNIQUE, что обеспечивает выполнение требований уникальности значений для ограничений UNIQUE.</span><span class="sxs-lookup"><span data-stu-id="13da0-118">The [!INCLUDE[ssDE](../../includes/ssde-md.md)] automatically creates a UNIQUE index to enforce the uniqueness requirement of the UNIQUE constraint.</span></span> <span data-ttu-id="13da0-119">Поэтому, при попытке вставки в таблицу строки с повторяющимися данными, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] выдает сообщение об ошибке, в котором сообщается о нарушении ограничения UNIQUE, а строка в таблицу не вставляется.</span><span class="sxs-lookup"><span data-stu-id="13da0-119">Therefore, if an attempt to insert a duplicate row is made, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] returns an error message that states the UNIQUE constraint has been violated and does not add the row to the table.</span></span> <span data-ttu-id="13da0-120">Для обеспечения выполнения ограничения UNIQUE по умолчанию создается уникальный некластеризованный индекс, если явно не указано создание кластеризованного индекса.</span><span class="sxs-lookup"><span data-stu-id="13da0-120">Unless a clustered index is explicitly specified, a unique, nonclustered index is created by default to enforce the UNIQUE constraint.</span></span>  
  
##  <a name="check-constraints"></a><a name="Check"></a> <span data-ttu-id="13da0-121">Ограничения CHECK</span><span class="sxs-lookup"><span data-stu-id="13da0-121">CHECK Constraints</span></span>  
 <span data-ttu-id="13da0-122">Проверочные ограничения принудительно сохраняют целостность домена, ограничивая значения, которые может принимать один или более столбцов.</span><span class="sxs-lookup"><span data-stu-id="13da0-122">CHECK constraints enforce domain integrity by limiting the values that are accepted by one or more columns.</span></span> <span data-ttu-id="13da0-123">Проверочное ограничение можно создать с любым логическим выражением, возвращающим значение TRUE или FALSE на основе логических операторов.</span><span class="sxs-lookup"><span data-stu-id="13da0-123">You can create a CHECK constraint with any logical (Boolean) expression that returns TRUE or FALSE based on the logical operators.</span></span> <span data-ttu-id="13da0-124">Например, чтобы ограничить интервал значений столбца **salary** , можно создать ограничение CHECK, позволяющее столбцу принимать значения только в интервале от 15 000 до 100 000 долларов.</span><span class="sxs-lookup"><span data-stu-id="13da0-124">For example, the range of values for a **salary** column can be limited by creating a CHECK constraint that allows for only data that ranges from $15,000 through $100,000.</span></span> <span data-ttu-id="13da0-125">Это ограничение исключает возможность устанавливать размер зарплаты, отличный от обычного.</span><span class="sxs-lookup"><span data-stu-id="13da0-125">This prevents salaries from being entered beyond the regular salary range.</span></span> <span data-ttu-id="13da0-126">Логическое выражение будет иметь следующий вид: `salary >= 15000 AND salary <= 100000`.</span><span class="sxs-lookup"><span data-stu-id="13da0-126">The logical expression would be the following: `salary >= 15000 AND salary <= 100000`.</span></span>  
  
 <span data-ttu-id="13da0-127">К одному столбцу можно применять несколько проверочных ограничений.</span><span class="sxs-lookup"><span data-stu-id="13da0-127">You can apply multiple CHECK constraints to a single column.</span></span> <span data-ttu-id="13da0-128">Кроме того, можно применять одно проверочное ограничение к нескольким столбцам. Для этого ограничение нужно создать на уровне таблицы.</span><span class="sxs-lookup"><span data-stu-id="13da0-128">You can also apply a single CHECK constraint to multiple columns by creating it at the table level.</span></span> <span data-ttu-id="13da0-129">Например, с помощью проверочного ограничения, распространяющегося на несколько столбцов, можно подтвердить, что в любой строке со значением **USA** в столбце **country_region** имеется также двухсимвольное значение в столбце **state** .</span><span class="sxs-lookup"><span data-stu-id="13da0-129">For example, a multiple-column CHECK constraint could be used to confirm that any row with a **country_region** column value of **USA** also has a two-character value in the **state** column.</span></span> <span data-ttu-id="13da0-130">Это позволяет выполнить проверку сразу нескольких условий из одного выражения.</span><span class="sxs-lookup"><span data-stu-id="13da0-130">This allows for multiple conditions to be checked in one location.</span></span>  
  
 <span data-ttu-id="13da0-131">Проверочные ограничения подобны ограничениям внешнего ключа, так как они управляют значениями, которые присваиваются столбцу.</span><span class="sxs-lookup"><span data-stu-id="13da0-131">CHECK constraints are similar to FOREIGN KEY constraints in that they control the values that are put in a column.</span></span> <span data-ttu-id="13da0-132">Однако они по-разному определяют допустимые значения: ограничения внешнего ключа получают список допустимых значений из другой таблицы, а проверочные ограничения определяют допустимые значения по логическому выражению.</span><span class="sxs-lookup"><span data-stu-id="13da0-132">The difference is in how they determine which values are valid: FOREIGN KEY constraints obtain the list of valid values from another table, while CHECK constraints determine the valid values from a logical expression.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="13da0-133">Ограничения, которые включают явное или неявное преобразование данных, могут вызывать ошибки в операциях такого рода.</span><span class="sxs-lookup"><span data-stu-id="13da0-133">Constraints that include implicit or explicit data type conversion may cause certain operations to fail.</span></span> <span data-ttu-id="13da0-134">Например, ограничения, заданные для таблиц, которые являются исходными при переключении секций, могут приводить к ошибкам при использовании оператора ALTER TABLE...SWITCH.</span><span class="sxs-lookup"><span data-stu-id="13da0-134">For example, such constraints defined on tables that are sources of partition switching may cause an ALTER TABLE...SWITCH operation to fail.</span></span> <span data-ttu-id="13da0-135">Следует избегать преобразования типов данных в определениях ограничений.</span><span class="sxs-lookup"><span data-stu-id="13da0-135">Avoid data type conversion in constraint definitions.</span></span>  
  
### <a name="limitations-of-check-constraints"></a><span data-ttu-id="13da0-136">Ограничения проверочных ограничений</span><span class="sxs-lookup"><span data-stu-id="13da0-136">Limitations of CHECK Constraints</span></span>  
 <span data-ttu-id="13da0-137">Проверочные ограничения отклоняют значения, вычисляемые в FALSE.</span><span class="sxs-lookup"><span data-stu-id="13da0-137">CHECK constraints reject values that evaluate to FALSE.</span></span> <span data-ttu-id="13da0-138">Поскольку значения NULL вычисляются как UNKNOWN, то их наличие в выражениях может переопределить ограничение.</span><span class="sxs-lookup"><span data-stu-id="13da0-138">Because null values evaluate to UNKNOWN, their presence in expressions may override a constraint.</span></span> <span data-ttu-id="13da0-139">Например, предположим, что вы размещаете ограничение `int` на **столбец MyColumn** , указывая, что **MyColumn** может содержать только значение 10 (**MyColumn = 10**).</span><span class="sxs-lookup"><span data-stu-id="13da0-139">For example, suppose you place a constraint on an `int` column **MyColumn** specifying that **MyColumn** can contain only the value 10 (**MyColumn=10**).</span></span> <span data-ttu-id="13da0-140">При вставке значения NULL в столбец **MyColumn**компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] вставит значение NULL и не возвратит ошибку.</span><span class="sxs-lookup"><span data-stu-id="13da0-140">If you insert the value NULL into **MyColumn**, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] inserts NULL and does not return an error.</span></span>  
  
 <span data-ttu-id="13da0-141">Проверочное ограничение возвращает TRUE, если для проверяемого условия в любой строке таблицы отсутствует значение FALSE.</span><span class="sxs-lookup"><span data-stu-id="13da0-141">A CHECK constraint returns TRUE when the condition it is checking is not FALSE for any row in the table.</span></span> <span data-ttu-id="13da0-142">Проверочное ограничение работает на уровне строки.</span><span class="sxs-lookup"><span data-stu-id="13da0-142">A CHECK constraint works at the row level.</span></span> <span data-ttu-id="13da0-143">Если в только что созданной таблице отсутствуют строки, то любое проверочное ограничение на эту таблицу считается допустимым.</span><span class="sxs-lookup"><span data-stu-id="13da0-143">If a table that has just been created does not have any rows, any CHECK constraint on this table is considered valid.</span></span> <span data-ttu-id="13da0-144">В результате могут возвращаться неожиданные результаты, как в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="13da0-144">This situation can produce unexpected results, as in the following example.</span></span>  
  
```  
CREATE TABLE CheckTbl (col1 int, col2 int);  
GO  
CREATE FUNCTION CheckFnctn()  
RETURNS int  
AS   
BEGIN  
   DECLARE @retval int  
   SELECT @retval = COUNT(*) FROM CheckTbl  
   RETURN @retval  
END;  
GO  
ALTER TABLE CheckTbl  
ADD CONSTRAINT chkRowCount CHECK (dbo.CheckFnctn() >= 1 );  
GO  
```  
  
 <span data-ttu-id="13da0-145">Ограничение `CHECK` показывает, что в таблице `CheckTbl`должна быть хотя бы одна строка.</span><span class="sxs-lookup"><span data-stu-id="13da0-145">The `CHECK` constraint being added specifies that there must be at least one row in table `CheckTbl`.</span></span> <span data-ttu-id="13da0-146">Однако поскольку в таблице нет ни одной строки, над которой можно было бы произвести проверку ограничения, инструкция ALTER TABLE завершается успешно.</span><span class="sxs-lookup"><span data-stu-id="13da0-146">However, because there are no rows in the table against which to check the condition of this constraint, the ALTER TABLE statement succeeds.</span></span>  
  
 <span data-ttu-id="13da0-147">Проверочные ограничения не проверяются во время выполнения инструкций DELETE.</span><span class="sxs-lookup"><span data-stu-id="13da0-147">CHECK constraints are not validated during DELETE statements.</span></span> <span data-ttu-id="13da0-148">Таким образом, выполнение инструкций DELETE над таблицами с некоторыми типами проверочных ограничений может приводить к неожиданным результатам.</span><span class="sxs-lookup"><span data-stu-id="13da0-148">Therefore, executing DELETE statements on tables with certain types of check constraints may produce unexpected results.</span></span> <span data-ttu-id="13da0-149">Например, предположим, что следующие выражения выполняются над таблицей `CheckTbl`.</span><span class="sxs-lookup"><span data-stu-id="13da0-149">For example, consider the following statements executed on table `CheckTbl`.</span></span>  
  
```  
INSERT INTO CheckTbl VALUES (10, 10);  
GO  
DELETE CheckTbl WHERE col1 = 10;  
```  
  
 <span data-ttu-id="13da0-150">Инструкция `DELETE` выполняется успешно, даже если ограничение `CHECK` определяет, что в таблице `CheckTbl` должна быть хотя бы `1` строка.</span><span class="sxs-lookup"><span data-stu-id="13da0-150">The `DELETE` statement succeeds, even though the `CHECK` constraint specifies that table `CheckTbl` must have at least `1` row.</span></span>  
  
##  <a name="related-tasks"></a><a name="Tasks"></a> <span data-ttu-id="13da0-151">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="13da0-151">Related Tasks</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="13da0-152">Если таблица опубликована для репликации, то изменения схемы следует проводить при помощи инструкции языка Transact-SQL [ALTER TABLE](/sql/t-sql/statements/alter-table-transact-sql) или объектов SMO.</span><span class="sxs-lookup"><span data-stu-id="13da0-152">If the table is published for replication, you must make schema changes using the Transact-SQL statement [ALTER TABLE](/sql/t-sql/statements/alter-table-transact-sql) or SQL Server Management Objects (SMO).</span></span> <span data-ttu-id="13da0-153">При изменении схемы с помощью конструктора таблиц или конструктора диаграмм баз данных конструктор пытается удалить и затем вновь создать таблицу.</span><span class="sxs-lookup"><span data-stu-id="13da0-153">When schema changes are made using the Table Designer or the Database Diagram Designer, it attempts to drop and recreate the table.</span></span> <span data-ttu-id="13da0-154">Но поскольку удалять опубликованные объекты нельзя, изменения схемы не будут применены.</span><span class="sxs-lookup"><span data-stu-id="13da0-154">You cannot drop published objects, therefore the schema change will fail.</span></span>  
  
|<span data-ttu-id="13da0-155">Задача</span><span class="sxs-lookup"><span data-stu-id="13da0-155">Task</span></span>|<span data-ttu-id="13da0-156">Раздел</span><span class="sxs-lookup"><span data-stu-id="13da0-156">Topic</span></span>|  
|----------|-----------|  
|<span data-ttu-id="13da0-157">Описывает, как создать ограничение уникальности.</span><span class="sxs-lookup"><span data-stu-id="13da0-157">Describes how to create a unique constraint.</span></span>|[<span data-ttu-id="13da0-158">Создание ограничений уникальности</span><span class="sxs-lookup"><span data-stu-id="13da0-158">Create Unique Constraints</span></span>](../tables/create-unique-constraints.md)|  
|<span data-ttu-id="13da0-159">Описывает, как изменить ограничение уникальности.</span><span class="sxs-lookup"><span data-stu-id="13da0-159">Describes how to modify a unique constraint.</span></span>|[<span data-ttu-id="13da0-160">Изменение ограничений уникальности</span><span class="sxs-lookup"><span data-stu-id="13da0-160">Modify Unique Constraints</span></span>](../tables/modify-unique-constraints.md)|  
|<span data-ttu-id="13da0-161">Описывает, как удалить ограничение уникальности.</span><span class="sxs-lookup"><span data-stu-id="13da0-161">Describes how to delete a unique constraint.</span></span>|[<span data-ttu-id="13da0-162">Удаление ограничений уникальности</span><span class="sxs-lookup"><span data-stu-id="13da0-162">Delete Unique Constraints</span></span>](../tables/delete-unique-constraints.md)|  
|<span data-ttu-id="13da0-163">Описывает, как отключить проверочное ограничение при добавлении или обновлении агентом репликации данных в таблице.</span><span class="sxs-lookup"><span data-stu-id="13da0-163">Describes how to disable a check constraint when a replication agent inserts or updates data in your table.</span></span>|[<span data-ttu-id="13da0-164">Отключение проверочных ограничений для репликации</span><span class="sxs-lookup"><span data-stu-id="13da0-164">Disable Check Constraints for Replication</span></span>](../tables/disable-check-constraints-for-replication.md)|  
|<span data-ttu-id="13da0-165">Описывает, как отключить проверочное ограничение при добавлении, обновлении или удалении данных из таблицы.</span><span class="sxs-lookup"><span data-stu-id="13da0-165">Describes how to disable a check constraint when data is added to, updated in, or deleted from a table.</span></span>|[<span data-ttu-id="13da0-166">Отключение проверочных ограничений в инструкциях INSERT и UPDATE</span><span class="sxs-lookup"><span data-stu-id="13da0-166">Disable Check Constraints with INSERT and UPDATE Statements</span></span>](../tables/disable-check-constraints-with-insert-and-update-statements.md)|  
|<span data-ttu-id="13da0-167">Описывает, как изменить выражение ограничения или параметры, которые включают или отключают ограничение применительно к определенным условиям.</span><span class="sxs-lookup"><span data-stu-id="13da0-167">Describes how to change the constraint expression or the options that enable or disable the constraint for specific conditions.</span></span>|[<span data-ttu-id="13da0-168">Изменение проверочных ограничений</span><span class="sxs-lookup"><span data-stu-id="13da0-168">Modify Check Constraints</span></span>](../tables/modify-check-constraints.md)|  
|<span data-ttu-id="13da0-169">Описывает, как удалить проверочное ограничение.</span><span class="sxs-lookup"><span data-stu-id="13da0-169">Describes how to delete a check constraint.</span></span>|[<span data-ttu-id="13da0-170">Удаление проверочных ограничений</span><span class="sxs-lookup"><span data-stu-id="13da0-170">Delete Check Constraints</span></span>](../tables/delete-check-constraints.md)|  
|<span data-ttu-id="13da0-171">Описывает, как просматривать свойства проверочного ограничения.</span><span class="sxs-lookup"><span data-stu-id="13da0-171">Describes how to view the properties of a check constraint.</span></span>|[<span data-ttu-id="13da0-172">Ограничения уникальности и проверочные ограничения</span><span class="sxs-lookup"><span data-stu-id="13da0-172">Unique Constraints and Check Constraints</span></span>](../tables/unique-constraints-and-check-constraints.md)|  
  
  
