---
title: Использование мастера планов обслуживания | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
f1_keywords:
- sql12.ag.maintwiz.planprop.f1
- sql12.ag.maintwiz.task.f1
- sql12.ag.maintwiz.maintcleanup.f1
- sql12.ag.maintwiz.indexdefrag.f1
- sql12.ag.maintwiz.order.f1
- sql12.ag.maintwiz.histcleanup.f1
- sql12.ag.maintwiz.backuplog.f1
- sql12.ag.maintwiz.progress.f1
- sql12.ag.maintwiz.execagentjob.f1
- sql12.ag.maintwiz.integrity.f1
- sql12.ag.maintwiz.welcome.f1
- sql12.ag.maintwiz.backupdiff.f1
- sql12.ag.maintwiz.server.f1
- sql12.ag.maintwiz.summary.f1
- sql12.ag.maintwiz.backupfull.f1
- sql12.ag.maintwiz.report.f1
- sql12.ag.maintwiz.shrinkdb.f1
- sql12.ag.maintwiz.reindex.f1
- sql12.ag.maintwiz.updatestats.f1
helpviewer_keywords:
- Maintenance Plan Wizard
- Database Maintenance Plan Wizard
- Database Maintenance Plan Wizard, starting
ms.assetid: db65c726-9892-480c-873b-3af29afcee44
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: ac134bbd4c65da4700990b69b09134230e98903f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87656411"
---
# <a name="use-the-maintenance-plan-wizard"></a>Использование мастера планов обслуживания
  В этом разделе описывается создание плана обслуживания одного или нескольких серверов с помощью мастера планов обслуживания в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]. Мастер планов обслуживания создает план обслуживания, который может регулярно выполняться агентом [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Это позволяет выполнять различные задачи администрирования базы данных, включая резервное копирование, проверки целостности базы данных или обновление статистики базы данных через указанные интервалы времени.  
  
 **В этом разделе**  
  
-   **Перед началом работы**  
  
     [Ограничения](#Restrictions)  
  
     [Безопасность](#Security)  
  
-   [Создание плана обслуживания с помощью мастера планов обслуживания в среде SQL Server Management Studio](#SSMSProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> Ограничения  
  
-   Для создания многосерверного плана обслуживания необходимо настроить многосерверную среду, содержащую один главный сервер и один или несколько целевых серверов. План многосерверного обслуживания необходимо создать и хранить на главном сервере. На целевых серверах эти планы можно просматривать, но нельзя хранить.  
  
-   Члены ролей **db_ssisadmin** и **dc_admin** могут повышать свои права доступа до **sysadmin**. Такое повышение прав доступа может происходить, поскольку эти роли могут изменять пакеты служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , а эти пакеты могут выполняться [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] при помощи контекста безопасности **sysadmin** агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Чтобы предотвратить такое повышение прав доступа при выполнении планов обслуживания, наборов элементов сбора данных и других пакетов служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , настройте задания агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , запускающие пакеты, на использование учетной записи-посредника с ограниченными правами доступа или добавьте в роли **db_ssisadmin** и **dc_admin** только членов роли **sysadmin** .  
  
###  <a name="security"></a><a name="Security"></a> безопасность  
  
####  <a name="permissions"></a><a name="Permissions"></a> Permissions  
 Для создания планов обслуживания и работы с ними пользователь должен быть членом предопределенной роли сервера **sysadmin** . В обозревателе объектов узел **Планы обслуживания** отображается только для пользователей, являющихся членами предопределенной роли сервера **sysadmin** .  
  
##  <a name="using-maintenance-plan-wizard"></a><a name="SSMSProcedure"></a>Использование мастера планов обслуживания  
  
#### <a name="to-start-the-maintenance-plan-wizard"></a>Запуск мастера планов обслуживания  
  
1.  Разверните сервер, где нужно создать план управления.  
  
2.  Разверните папку **Управление** .  
  
3.  Щелкните правой кнопкой мыши папку **Планы обслуживания** и выберите пункт **Мастер планов обслуживания**.  
  
4.  На странице **Мастер планов обслуживания SQL Server** нажмите кнопку **Далее**.  
  
5.  На странице **Выбор свойств плана** выполните следующие действия.  
  
    1.  В поле **Имя** введите имя создаваемого плана обслуживания.  
  
    2.  В поле **Описание** кратко опишите план обслуживания.  
  
    3.  В списке **Выполнить от имени** укажите учетные данные, используемые агентом Microsoft SQL Server при выполнении плана обслуживания.  
  
    4.  Выберите вариант **Отдельные расписания для каждой задачи** или **Единое расписание для всего плана или без расписания** , чтобы указать повторяющееся расписание плана обслуживания.  
  
        > [!NOTE]  
        >  Если выбран вариант **Отдельные расписания для каждой задачи**, необходимо выполнить шаги, приведенные далее в пункте **Д** , для каждой задачи в плане обслуживания.  
  
    5.  Если выбран вариант **Единое расписание для всего плана или без расписания**, то нажмите кнопку **Изменить**в разделе **Расписание**.  
  
        1.  В диалоговом окне **Создание расписания задания** в поле **Имя** введите имя расписания задания.  
  
        2.  В списке **Тип расписания** выберите тип расписания:  
  
            -   **Запускать автоматически при запуске агента SQL Server**  
  
            -   **Запускать при бездействии процессоров**  
  
            -   **Повторяющееся**. Это параметр выбирается по умолчанию.  
  
            -   **Однократно**  
  
        3.  Установите или снимите флажок **Включен** , чтобы включить или отключить расписание.  
  
        4.  При выборе **Повторяющееся**:  
  
            1.  В разделе **Частота**в списке **Выполняется** укажите частоту выполнения:  
  
                -   При выборе **Ежедневно**в поле **Выполняется каждые** укажите частоту повторного выполнения расписания задания в днях.  
  
                -   При выборе **Еженедельно**в поле **Выполняется каждые** укажите частоту повторного выполнения расписания задания в неделях. Выберите день или дни недели, в которые выполняется расписание задания.  
  
                -   При выборе **Ежемесячно**щелкните **День** или **Определенный**.  
  
                    -   При выборе **День**введите дату месяца, в которую должно выполняться расписание задания, и укажите частоту повторного выполнения расписания задания в месяцах. Например, если требуется, чтобы расписание задания выполнялось 15 числа каждого второго месяца, выберите **День** и введите в первом поле 15 и 2 — во втором поле. Обратите внимание, что число, введенное во втором поле, не должно превышать 99.  
  
                    -   При выборе **Определенный**выберите определенный день недели в месяце, в котором должно выполняться расписание задания, и укажите частоту повторного выполнения расписания задания в месяцах. Например, если требуется, чтобы расписание задания выполнялось в последний день недели каждого второго месяца, выберите **День**, затем **последний** в первом списке и **рабочий день** во втором списке, а потом введите "2" во втором поле. Также можно выбрать **первый**, **второй**, **третий** или **четвертый**, а также конкретные дни недели (например: воскресенье или среду) в первых двух списках. Обратите внимание, что число, введенное в последнем поле, не должно превышать 99.  
  
            2.  В поле **Сколько раз в день**укажите частоту повторного выполнения расписания задания в день запуска расписания задания:  
  
                -   При выборе **Выполнять раз в**укажите определенное время дня для запуска расписания задания в поле **Выполнять раз в** . Укажите время дня: час, минуту и секунду.  
  
                -   При выборе **Выполняется каждые**укажите частоту выполнения задания в выбранный день в поле **Частота**. Например, если требуется, чтобы расписание задания выполнялось каждые 2 часа в день запуска расписания задания, выберите **Выполняется кажд.** , введите "2" в первом поле, а затем выберите в списке **часы**. В этом списке также можно выбрать **минуты** и **секунды**. Обратите внимание, что число, введенное в первом поле, не должно превышать 100.  
  
                     В поле **Начинать в** введите время для начала запуска расписания задания. В поле **Заканчивать в** введите время для завершения повторного выполнения расписания задания. Укажите время дня: час, минуту и секунду.  
  
            3.  В разделе **Длительность**, в области **Дата начала**введите дату начала запуска расписания задания. Выберите **Дата окончания** или **Без даты окончания** , чтобы указать дату завершения выполнения расписания задания. При выборе **Дата окончания**введите дату завершения запуска расписания задания.  
  
        5.  При выборе значения **Однократно**в **Однократное выполнение**в поле **Дата** введите дату запуска расписания задания. В поле **Время** введите время запуска расписания задания. Укажите время дня: час, минуту и секунду.  
  
        6.  В разделе **Сводка**в **Описание**проверьте правильность всех параметров расписания задания.  
  
        7.  Нажмите кнопку **ОК**.  
  
    6.  Щелкните **Далее**.  
  
6.  На странице **Выбор целевых серверов** выберите серверы, на которых необходимо запустить план обслуживания. Эта страница видна только на экземплярах [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , сконфигурированных как главный сервер.  
  
    > [!NOTE]  
    >  Чтобы создать многосерверный план обслуживания, необходимо настроить многосерверную среду, содержащую один главный сервер и один или несколько целевых серверов, при этом локальный сервер должен быть настроен в качестве главного. В многосерверной среде на этой странице отображается **(локальный)** главный сервер и все соответствующие целевые серверы.  
  
7.  На странице **Выбор задач по обслуживанию** выберите одну или несколько задач обслуживания для добавления к плану. После выбора всех необходимых задач нажмите кнопку **Далее**.  
  
    > [!NOTE]  
    >  Выбранные здесь задачи определяют, параметры на каких страницах понадобится заполнить после страницы **Выбор порядка задач по обслуживанию**.  
  
8.  На странице **Выбор порядка задач по обслуживанию** выберите задачу и измените ее порядок выполнения кнопками **Вверх...** и **Вниз...** . После определения порядка задач нажмите кнопку **Далее**.  
  
    > [!NOTE]  
    >  Если выбран вариант **Отдельные расписания для каждой задачи** на странице **Выбор свойств плана**, то изменение порядка задач по обслуживанию невозможно.  
  
#### <a name="define-database-check-integrity-checkdb-tasks"></a>Определение задач по проверке целостности базы данных (CHECKDB)  
  
1.  На странице **Определение задачи по проверке целостности базы данных** выберите базы данных, в которых будут проверяться размещение и структурная целостность пользовательских и системных таблиц и индексов. Выполнение инструкции `DBCC CHECKDB`[!INCLUDE[tsql](../../includes/tsql-md.md)] в этой задаче гарантирует обнаружение всех проблем целостности с базой данных, что позволяет системному администратору или владельцу базы данных устранить проблемы позднее. Дополнительные сведения см. в разделе [DBCC CHECKDB (Transact-SQL).](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql)По завершении нажмите кнопку **Далее**.  
  
     На этой странице доступны следующие параметры.  
  
     Список**Базы данных**  
     Укажите базы данных, для которых должна выполняться эта задача.  
  
    -   **Все базы данных**  
  
         Создайте план обслуживания, который запускает эту задачу для всех баз данных [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], за исключением **tempdb**.  
  
    -   **Системные базы данных**  
  
         Создайте план обслуживания, который запускает эту задачу для системных баз данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , за исключением **tempdb** и созданных пользователем баз.  
  
    -   **Все пользовательские базы данных (кроме master, model, msdb, tempdb)**  
  
         Создать план обслуживания, который производит запуск этой задачи по отношению ко всем базам данных, созданных пользователем. Для системных баз данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] задачи обслуживания выполняться не будут.  
  
    -   **Следующие базы данных**  
  
         Создать план обслуживания, который производит запуск этой задачи по отношению только к выбранным базам данных. Если выбран этот параметр, необходимо выбрать в списке хотя бы одну базу данных.  
  
     Флажок**Включить индексы**  
     Проверка целостности всех страниц индекса, а также табличных страниц данных.  
  
#### <a name="define-database-shrink-tasks"></a>Определение задач по сжатию базы данных  
  
1.  На странице **Определение задачи «Сжатие базы данных»** создайте задачу, которая уменьшает размер выбранных баз данных, используя инструкцию `DBCC SHRINKDATABASE` с параметром `NOTRUNCATE` или `TRUNCATEONLY` . Дополнительные сведения см. в разделе [DBCC SHRINKDATABASE (Transact-SQL)](/sql/t-sql/database-console-commands/dbcc-shrinkdatabase-transact-sql). После завершения нажмите кнопку **Далее**.  
  
    > [!WARNING]  
    >  Данные, перемещаемые в процессе сжатия файла, могут быть разбросаны по любым доступным местам в файле. Это вызывает фрагментацию индекса и может увеличить время выполнения запросов, выполняющих поиск в диапазоне индекса. Чтобы устранить фрагментацию, предусмотрите возможность перестроения индексов файла после сжатия.  
  
     На этой странице доступны следующие параметры.  
  
     Список**Базы данных**  
     Укажите базы данных, для которых должна выполняться эта задача. Дополнительные сведения о параметрах, доступных в этом списке, см. выше в шаге 9.  
  
     Поле**Сжать базу данных при превышении ею размера**  
     Укажите размер в мегабайтах, по достижении которого будет выполняться задача.  
  
     Поле**Объем свободного места после сжатия**  
     Сжатия останавливается, когда свободное место в файлах базы данных достигает этого объема (в процентах).  
  
     **Удерживать свободное место в файлах базы данных**  
     База данных сжимается до состояния непрерывных страниц, но страницы не освобождаются, и файлы базы данных не сжимаются. С помощью этого параметра можно предусмотреть ситуацию, когда в будущем ожидается повторное увеличение базы данных, и поэтому не нужно перераспределять пространство. Этот параметр не позволяет достичь максимальной степени сжатия файлов базы данных. В этом случае используется параметр NOTRUNCATE.  
  
     **Возвращать освободившееся место в операционную систему**  
     База данных сжимается до состояния непрерывных страниц, и страницы возвращаются обратно в операционную систему, где они могут использоваться другими программами. Файлы этой базы данных максимально сжимаются. В этом случае используется параметр TRUNCATEONLY. Это параметр по умолчанию.  
  
#### <a name="define-the-index-tasks"></a>Определение задач индекса  
  
1.  На странице **Определение задачи «Реорганизация индекса»** выберите серверы, на которые будут перемещаться страницы индекса для более эффективного порядка поиска. Эта задача использует инструкцию `ALTER INDEX ... REORGANIZE`. Дополнительные сведения см. в разделе [ALTER INDEX (Transact-SQL)](/sql/t-sql/statements/alter-index-transact-sql). После завершения нажмите кнопку **Далее**.  
  
     На этой странице доступны следующие параметры.  
  
     Список**Базы данных**  
     Укажите базы данных, для которых должна выполняться эта задача. Дополнительные сведения о параметрах, доступных в этом списке, см. выше в шаге 9.  
  
     Список**Объект**  
     В списке **Выбор** можно отображать только таблицы, только представления или таблицы и представления. Этот список доступен, если в списке **База данных** выше выбрана только одна база данных.  
  
     Список**Выбор**  
     Укажите таблицы или индексы, которые должны обрабатываться этой задачей. Недоступно, если в диалоговом окне «Объект» выбран тип **Таблицы и представления** .  
  
     Флажок**Сжимать большие объекты**  
     По возможности освобождается пространство для таблиц и представлений. Этот параметр использует инструкцию `ALTER INDEX ... LOB_COMPACTION = ON`.  
  
2.  На странице **Определение задачи "Перестроение индекса"** выберите базы данных, в которых будут повторно создаваться несколько индексов. Эта задача использует инструкцию `ALTER INDEX ... REBUILD PARTITION`. Дополнительные сведения см. в разделе [ALTER INDEX (Transact-SQL)](/sql/t-sql/statements/alter-index-transact-sql). После завершения нажмите кнопку **Далее**.  
  
     На этой странице доступны следующие параметры.  
  
     Список**Базы данных**  
     Укажите базы данных, для которых должна выполняться эта задача. Дополнительные сведения о параметрах, доступных в этом списке, см. выше в шаге 9.  
  
     Список**Объект**  
     В списке **Выбор** можно отображать только таблицы, только представления или таблицы и представления. Этот список доступен, если в списке **База данных** выше выбрана только одна база данных.  
  
     Список**Выбор**  
     Укажите таблицы или индексы, которые должны обрабатываться этой задачей. Недоступно, если в диалоговом окне «Объект» выбран тип **Таблицы и представления** .  
  
     Область**Параметры свободного места**  
     Представляет параметры для применения коэффициента заполнения к индексам и таблицам.  
  
     **Свободное пространство по умолчанию на странице**  
     Реорганизует страницы с использованием объема свободного места по умолчанию. Индексы таблиц в базе данных будут удалены и созданы повторно с коэффициентом заполнения, указанным при создании индексов. Это параметр по умолчанию.  
  
     Поле**Изменить долю свободного места на странице**  
     Удалите индексы таблиц в базе данных и создайте их повторно с новым, автоматически вычисляемым коэффициентом заполнения, резервирующим указанный объем свободного пространства на страницах индекса. Чем выше процентное значение, тем больше свободного места резервируется на страницах индекса и тем больше будет размер индекса. Допустимые значения: от 0 до 100. Используется параметр `FILLFACTOR` .  
  
     Область**Дополнительные параметры**  
     Представляет дополнительные параметры для сортировки индексов и повторного индексирования.  
  
     Флажок**Сортировать результаты в tempdb**  
     Использует параметр `SORT_IN_TEMPDB` , определяющий место временного хранения промежуточных результатов сортировки, сформированных при создании индекса. Если операция сортировки не требуется или сортировка может быть выполнена в памяти, параметр `SORT_IN_TEMPDB` не обрабатывается.  
  
     Флажок**Сохранять индекс в режиме "в сети" в процессе переиндексирования**  
     Использует параметр `ONLINE` , который дает пользователям возможность получать доступ к базовой таблице или данным кластеризованного индекса, а также к любым, связанным с ними некластеризованным индексам при операциях с индексами. При выборе этого параметра активируются другие параметры для перестроения индексов, которые не допускают перестроения в режиме "в сети": **Не перестраивать индексы** и **Перестроение индекса в автономном режиме**.  
  
    > [!NOTE]  
    >  Операции с индексами в сети доступны не во всех выпусках [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]. Дополнительные сведения см. [в разделе функции, поддерживаемые различными Выпусками SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).  
  
#### <a name="define-the-update-statistics-task"></a>Определение задачи «Обновление статистики»  
  
1.  На странице **Определение задачи «Обновление статистики»** определите базы данных, в которых будет обновляться статистика индекса и таблицы. Эта задача использует инструкцию `UPDATE STATISTICS`. Дополнительные сведения см. в разделе [UPDATE STATISTICS (Transact-SQL)](/sql/t-sql/statements/update-statistics-transact-sql). По завершении нажмите кнопку **Далее**.  
  
     На этой странице доступны следующие параметры.  
  
     Список**Базы данных**  
     Укажите базы данных, для которых должна выполняться эта задача. Дополнительные сведения о параметрах, доступных в этом списке, см. выше в шаге 9.  
  
     Список**Объект**  
     В списке **Выбор** можно отображать только таблицы, только представления или таблицы и представления. Этот список доступен, если в списке **База данных** выше выбрана только одна база данных.  
  
     Список**Выбор**  
     Укажите таблицы или индексы, которые должны обрабатываться этой задачей. Недоступно, если в диалоговом окне «Объект» выбран тип **Таблицы и представления** .  
  
     **Вся собранная статистика**  
     Обновить статистику столбцов и статистику индексов.  
  
     **Только статистика по столбцам**  
     Обновить только статистику столбцов. Используется параметр `WITH COLUMNS` .  
  
     **Только статистика индексов**  
     Обновить только статистику индексов. Используется параметр `WITH INDEX` .  
  
     **Тип просмотра**  
     Тип просмотра, который используется для сбора обновленной статистики.  
  
     **Полный просмотр**  
     Считывает все строки в таблице или представлении для сбора статистики.  
  
     **Пример**  
     Укажите процент таблицы или индексированного представления либо количество строк для выборки, если статистика собирается для больших таблиц или представлений.  
  
#### <a name="define-the-history-cleanup-task"></a>Определение задачи «Очистка журнала»  
  
1.  На странице **Определение задачи «Очистка журнала»** определите базы данных, в которых нужно удалить журнал задач. Эта задача использует инструкции `EXEC sp_purge_jobhistory`, `EXEC sp_maintplan_delete_log`и `EXEC sp_delete_backuphistory` для удаления сведений журнала из таблиц **msdb** . По завершении нажмите кнопку **Далее**.  
  
     На этой странице доступны следующие параметры.  
  
     **Выберите данные журнала для удаления**  
     Выберите тип удаляемых данных задачи  
  
     **Журнал резервного копирования и восстановления**  
     Хранение записей о том, когда были созданы последние резервные копии, может помочь [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в создании плана восстановления, когда потребуется восстановить базу данных. Срок хранения должен как минимум соответствовать частоте полных резервных копирований базы данных.  
  
     **Журнал заданий агента SQL Server**  
     Этот журнал может помочь устранить ошибки, возникшие при выполнении заданий, или определить, почему были выполнены операции с базой данных.  
  
     **Журнал плана обслуживания**  
     Этот журнал может помочь устранить ошибки, возникшие при выполнении заданий плана обслуживания, или определить, почему были выполнены операции с базой данных.  
  
     **Удалить из журнала записи старше**  
     Укажите возраст элементов, которые следует удалить. Можно указать срок в **ч**, **дн.** , **нед.** (по умолчанию), **мес.** или **годах**.  
  
#### <a name="define-the-execute-agent-job-task"></a>Определение задачи «Выполнение задания агента»  
  
1.  На странице **Определение задачи «Выполнение задания агента»** в разделе **Доступные задания агента SQL Server**выберите задания для выполнения. Этот параметр не будет доступен, если нет заданий агента SQL Server. Эта задача использует инструкцию `EXEC sp_start_job`. Дополнительные сведения см. в разделе [sp_start_job (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql). По завершении нажмите кнопку **Далее**.  
  
#### <a name="define-backup-tasks"></a>Определение задач резервного копирования  
  
1.  На странице **Определение задачи "Резервное копирование базы данных (полное)"** выберите базы данных, для которых создается полная резервная копия. Эта задача использует инструкцию `BACKUP DATABASE`. Дополнительные сведения см. в разделе [BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql). По завершении нажмите кнопку **Далее**.  
  
     На этой странице доступны следующие параметры.  
  
     Список**Тип резервного копирования**  
     Отображает тип выполняемой резервной копии. Доступно только для чтения.  
  
     Список**Базы данных**  
     Укажите базы данных, для которых должна выполняться эта задача. Дополнительные сведения о параметрах, доступных в этом списке, см. выше в шаге 9.  
  
     **Компонент резервного копирования**  
     Выберите **База данных** для создания резервной копии всей базы данных. Выберите **Файл и файловые группы** для создания резервной копии части базы данных. При выборе этого значения укажите имя файла или файловой группы. Если в окне **Базы данных** выбрано несколько баз данных, то в области **Компонент резервного копирования** выберите только **Базы данных**. Для резервного копирования файлов или файловых групп создайте задачу для каждой базы данных. Эти параметры доступны, если в списке **База данных** выше выбрана только одна база данных.  
  
     Флажок**Срок действия резервного набора данных истекает**  
     Указывает время, по истечении которого резервный набор данных для этой резервной копии может быть перезаписан. Выберите параметр **После** и введите число дней до истечения срока действия или выберите параметр **Вкл** и укажите дату истечения срока. Этот параметр будет отключен, если в качества назначения резервного копирования выбран параметр **URL-адрес** .  
  
     **Создать резервную копию на**  
     Задает носитель, на котором создается резервная копия базы данных. Выберите **Диск**, **Лента**или **URL-адрес**. Доступны только ленточные устройства, подключенные к компьютеру, на котором находится база данных.  
  
     **Создание резервных копий баз данных в одном или нескольких файлах**  
     Нажмите кнопку **Добавить** , чтобы открыть диалоговое окно **Выбор места расположения резервной копии** . Этот параметр будет отключен, если в качества назначения резервного копирования выбран параметр «URL-адрес».  
  
     Нажмите кнопку **Удалить** , чтобы удалить файл из поля.  
  
     Нажмите кнопку **Содержимое** , чтобы прочитать заголовок файла и отобразить текущее содержимое резервной копии файла.  
  
     Диалоговое окно**Выбор места расположения резервной копии**  
     Выберите файл, ленточный накопитель или устройство резервного копирования в качестве назначения резервной копии. Этот параметр будет отключен, если в качества назначения резервного копирования выбран параметр «URL-адрес».  
  
     Список**Если файлы резервной копии существуют**  
     Укажите, как обрабатывать существующие резервные копии. Выберите пункт **Добавить** для добавления новых резервных копий после уже существующих в файле или на ленте. Выберите пункт **Перезаписать** , чтобы удалить старое содержимое из файла или с ленты и записать на его место новую резервную копию.  
  
     **Создать файл резервной копии для каждой базы данных**  
     Создавать файл резервной копии в расположении, указанном в соответствующем окне папки. Создается один файл для каждой выбранной базы данных. Этот параметр будет отключен, если в качества назначения резервного копирования выбран параметр «URL-адрес».  
  
     Флажок**Создавать вложенный каталог для каждой базы данных**  
     Создать внутри указанного каталога на диске отдельный вложенный каталог для резервной копии каждой базы данных, создаваемой как часть плана обслуживания.  
  
    > [!IMPORTANT]  
    >  Этот вложенный каталог будет наследовать разрешения от родительского. Ограничьте разрешения для предотвращения несанкционированного доступа.  
  
     Поле**Папка**  
     Укажите папку, в которой будут автоматически создаваться файлы баз данных. Этот параметр будет отключен, если в качества назначения резервного копирования выбран параметр «URL-адрес».  
  
     **Учетные данные SQL**  
     Учетные данные SQL, используемые для проверки подлинности в службе хранилища Azure. Если у вас нет существующих учетных данных SQL, нажмите кнопку **Создать** , чтобы создать новые учетные данные SQL.  
  
    > [!IMPORTANT]  
    >  В диалоговом окне, которое открывается при нажатии кнопки **Создать** , необходимо ввести сертификат управления или профиль публикации подписки. Если у вас нет доступа к сертификату управления или профилю публикации, можно создать учетные данные SQL, указав имя учетной записи хранилища и сведения ключа доступа при помощи Transact-SQL или SQL Server Management Studio. См. пример кода в разделе [Создание учетных данных](../security/authentication-access/create-a-credential.md#Credential) для создания учетных данных с помощью TRANSACT-SQL. Также можно в среде SQL Server Management Studio, из экземпляра компонента database engine, щелкнуть правой кнопкой мыши **Безопасность**и выбрать пункт **Создать**, а затем **Учетные данные**. Укажите имя учетной записи хранения в поле **Идентификатор** и ключ доступа в поле **Пароль** .  
  
     **Контейнер хранилища Azure**  
     Укажите имя контейнера службы хранилища Azure.  
  
     **Префикс URL-адреса:**  
     Этот элемент создается автоматически на основе данных учетной записи хранения в учетных данных SQL и заданного имени контейнера Azure. Мы рекомендуем не изменять данные в этом поле, если только не используется домен в формате, отличном от **\<storage account>.blob.core.windows.net**.  
  
     Поле**Расширение файла резервной копии**  
     Укажите расширение, которое должно использоваться для файлов резервных копий. Значение по умолчанию — BAK.  
  
     Флажок**Проверять целостность резервной копии**  
     Проверка полноты резервного набора данных и читаемости всех томов.  
  
     **Шифрование резервной копии**  
     Для создания шифрованной резервной копии установите флажок **Зашифровать файл резервной копии** . Выберите алгоритм шифрования для шага шифрования и выберите сертификат или асимметричный ключ из списка существующих сертификатов или асимметричных ключей. Доступны следующие алгоритмы шифрования:  
  
    -   AES 128  
  
    -   AES 192  
  
    -   AES 256  
  
    -   Triple DES  
  
     Параметр шифрования отключен, если вы решили присоединить резервную копию к существующему резервному набору данных.  
  
     Рекомендуется регулярно создавать резервные копии сертификата или ключей и сохранять их в местоположении, отличном от местоположения шифруемой резервной копии.  
  
     Поддерживаются только ключи, относящиеся к расширенному управлению ключами.  
  
     Список**Сжимать резервные копии**  
     В выпуске [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)] (или более поздней версии) выберите одно из следующих значений [сжатия резервных копий](../backup-restore/backup-compression-sql-server.md) :  
  
    |||  
    |-|-|  
    |**Использовать параметр сервера по умолчанию**|Щелкните для использования настроек уровня сервера, установленных по умолчанию. Значения по умолчанию устанавливаются в параметре конфигурации сервера **backup compression default** . Сведения о том, как просмотреть текущую настройку этого параметра, см. в разделе [Параметр конфигурации сервера "Просмотр или настройка параметра сжатия резервных копий по умолчанию"](../../database-engine/configure-windows/view-or-configure-the-backup-compression-default-server-configuration-option.md).|  
    |**Сжимать резервные копии**|Щелкните для сжатия резервной копии, независимо от уровня сервера по умолчанию.<br /><br /> **\*\* Важно! \*\*** По умолчанию сжатие существенно повышает загрузку ЦП. Дополнительная нагрузка на ЦП может помешать выполнению параллельных операций. Поэтому лучше создавать сжатые резервные копии с низким приоритетом в сеансах, доступ которых к ЦП ограничивается регулятором ресурсов. Дополнительные сведения см. ниже в подразделе [Использование регулятора ресурсов для ограничения загрузки ЦП при сжатии резервной копии (Transact-SQL)](../backup-restore/use-resource-governor-to-limit-cpu-usage-by-backup-compression-transact-sql.md).|  
    |**Не сжимать резервные копии**|Щелкните для создания резервной копии без сжатия, независимо от уровня сервера по умолчанию.|  
  
2.  На странице **Определение задачи "Резервное копирование базы данных (разностное)"** выберите базы данных, для которых создается частичная резервная копия. Дополнительные сведения о параметрах, доступных на этой странице, см. выше в списке определений на шаге 16. Эта задача использует инструкцию `BACKUP DATABASE ... WITH DIFFERENTIAL`. Дополнительные сведения см. в разделе [BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql).  По завершении нажмите кнопку **Далее**.  
  
3.  На странице **Определение задачи "Резервное копирование базы данных (журнал транзакций)"** выберите базы данных, для которых создается резервная копия журнала транзакций. Дополнительные сведения о параметрах, доступных на этой странице, см. выше в списке определений на шаге 16. Эта задача использует инструкцию `BACKUP LOG`. Дополнительные сведения см. в разделе [BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql). По завершении нажмите кнопку **Далее**.  
  
#### <a name="define-maintenance-cleanup-tasks"></a>Определение задач «Очистка после обслуживания»  
  
1.  На странице **Определение задачи «Очистка после обслуживания»** укажите типы файлов, которые удаляются в рамках плана обслуживания, в том числе текстовые отчеты, созданные планами обслуживания, и файлы резервных копий базы данных. Эта задача использует инструкцию `EXEC xp_delete_file`. По завершении нажмите кнопку **Далее**.  
  
    > [!IMPORTANT]  
    >  Эта задача автоматически не удаляет файлы во вложенных папках указанного каталога. Это снижает вероятность злоумышленного проникновения с использованием задачи «Очистка после обслуживания» для удаления файлов. Если нужно удалять файлы во вложенных папках первого уровня, установите флажок **Включить вложенные папки первого уровня**.  
  
     На этой странице доступны следующие параметры.  
  
     **Удалить файлы следующего типа**  
     Укажите тип файлов для удаления.  
  
     **Файлы резервных копий**  
     Удаляет файлы резервной копии базы данных.  
  
     **Текстовые отчеты плана обслуживания**  
     Удаляет текстовые отчеты предыдущих запусков планов обслуживания.  
  
     **Размещение файла**  
     Укажите путь к удаляемым файлам.  
  
     **Удалить определенный файл**  
     Удаляет файл, указанный в текстовом поле **Имя файла** .  
  
     **Удалить из папки файлы с определенным расширением**  
     Удаляет все файлы с определенным расширением в указанной папке. Позволяет удалить несколько файлов сразу, например все файлы резервных копий с расширением BAK в папке «Вторник».  
  
     Поле**Папка**  
     Путь к папке, содержащей удаляемые файлы, и ее имя.  
  
     Поле**Расширение файла**  
     Введите расширение удаляемых файлов. Для удаления сразу несколько файлов, например всех файлов резервных копий с расширением BAK из папки «Вторник», укажите BAK.  
  
     Флажок**Включить вложенные папки первого уровня**  
     Удаляет файлы с расширением, заданным в поле **Расширение файла** , из вложенных папок первого уровня относительно папки, заданной в поле **Папка**.  
  
     Флажок**Удалить файлы на основе возраста во время выполнения задачи**  
     Задайте минимальный возраст удаляемых файлов, указав числовое значение и единицу времени в поле **Удалить все файлы старше чем** .  
  
     **Удалить все файлы старше чем**  
     Задайте минимальный возраст удаляемых файлов, указав числовое значение и единицу времени (**час**, **день**, **неделя**, **месяц**или **год**). Файлы, старше указанного временного интервала, будут удалены.  
  
#### <a name="select-report-options"></a>Выбор параметров отчета  
  
1.  На странице **Выбор параметров отчета** выберите параметры для сохранения или распространения отчета о действиях плана обслуживания. Эта задача использует инструкцию `EXEC sp_notify_operator`. Дополнительные сведения см. в разделе [sp_notify_operator (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-notify-operator-transact-sql). По завершении нажмите кнопку **Далее**.  
  
     На этой странице доступны следующие параметры.  
  
     Флажок**Записать отчет в текстовый файл**  
     Сохраните отчет в файл.  
  
     Поле**Расположение папки**  
     Задайте местонахождения файла, который будет содержать отчет.  
  
     Флажок**Отчет по электронной почте**  
     Отправляет сообщение электронной почты, если задача завершается ошибкой. Для использования этой задачи необходимо включить и правильно настроить компонент Database Mail с MSDB в качестве базы данных обслуживания почты, а также использовать оператор агента [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] с допустимым электронным адресом.  
  
     **Оператор агента**  
     Указать получателя электронного письма.  
  
     **Профиль электронной почты**  
     Задайте профиль, определяющий отправителя сообщения по электронной почте.  
  
#### <a name="complete-the-wizard"></a>Завершение работы мастера  
  
1.  На странице **Завершение работы мастера** проверьте параметры, выбранные на предыдущих страницах, и нажмите кнопку **Готово**.  
  
2.  Страница **Ход работы мастера планов обслуживания** позволяет следить за сведениями о состоянии действий, выполняемых мастером планов обслуживания. В зависимости от действий, выбранных в мастере, страница выполнения может содержать одно или несколько действий. В верхнем поле показано общее состояние мастера и число полученных им сообщений о состоянии, предупреждений и сообщений об ошибках.  
  
     На странице **Ход работы мастера планов обслуживания** доступны следующие параметры.  
  
     **Сведения**  
     Сведения о событии, состоянии и любых сообщениях, которые возвращены в результате действий мастера.  
  
     **Действие**  
     Задает тип и имя каждого действия.  
  
     **Состояние**  
     Указывает, вернуло ли действие мастера в целом значение **Успешно** или **Ошибка**.  
  
     **Сообщение**  
     Любые сообщения об ошибках или предупреждения от процесса.  
  
     **Отчет**  
     Создание отчета, содержащего результаты мастера создания секций. Доступные параметры: **Просмотреть отчет**, **Сохранить отчет в файл**, **Копировать отчет в буфер обмена**и **Отправить отчет по электронной почте**.  
  
     **Просмотреть отчет**  
     Открытие диалогового окна **Просмотр отчета** , которое содержит текстовый отчет о работе мастера создания секций.  
  
     **Сохранить отчет в файл**  
     Открытие диалогового окна **Сохранить отчет как** .  
  
     **Копировать отчет в буфер обмена**  
     Копирование результатов отчета о работе мастера в буфер обмена.  
  
     **Отправить отчет по электронной почте**  
     Копирование результатов отчета о состоянии мастера в сообщение электронной почты.  
  
  
