---
title: Инициализация транзакционной подписки без моментального снимка | Документация Майкрософт
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- transactional replication, initializing
- replication [SQL Server], initializing
- initializing subscriptions [SQL Server replication], without snapshots
ms.assetid: 75c8c1f8-60bc-44a8-944b-d18d1f6bda11
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 88e240b75cdbb239548cfcb8e5d8df5eb2af2973
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655591"
---
# <a name="initialize-a-transactional-subscription-without-a-snapshot"></a><span data-ttu-id="c47a0-102">Initialize a Transactional Subscription Without a Snapshot</span><span class="sxs-lookup"><span data-stu-id="c47a0-102">Initialize a Transactional Subscription Without a Snapshot</span></span>
  <span data-ttu-id="c47a0-103">По умолчанию инициализация подписки на публикацию транзакций осуществляется с помощью моментального снимка, созданного агентом моментальных снимков и применяемого агентом распространителя.</span><span class="sxs-lookup"><span data-stu-id="c47a0-103">By default, a subscription to a transactional publication is initialized with a snapshot, which is generated by the Snapshot Agent and applied by the Distribution Agent.</span></span> <span data-ttu-id="c47a0-104">Например, в некоторых сценариях, использующих большие исходные наборы данных, лучше инициализировать подписку другим методом.</span><span class="sxs-lookup"><span data-stu-id="c47a0-104">In some scenarios, such as those involving large initial datasets, it is preferable to initialize a subscription using another method.</span></span> <span data-ttu-id="c47a0-105">Другие методы инициализации подписчика:</span><span class="sxs-lookup"><span data-stu-id="c47a0-105">Other methods of initializing a Subscriber include:</span></span>  
  
-   <span data-ttu-id="c47a0-106">Указание резервной копии.</span><span class="sxs-lookup"><span data-stu-id="c47a0-106">Specifying a backup.</span></span> <span data-ttu-id="c47a0-107">Восстановите резервную копию на подписчике, а затем агент распространителя скопирует все необходимые метаданные репликации и системные процедуры.</span><span class="sxs-lookup"><span data-stu-id="c47a0-107">Restore the backup on the Subscriber, and then the Distribution Agent copies any required replication metadata and system procedures.</span></span> <span data-ttu-id="c47a0-108">Инициализация с помощью резервной копии — самый быстрый и удобный способ доставки данных на подписчик, поскольку можно использовать любую резервную копию, если она была сделана после включения для базы данных возможности инициализации с помощью резервной копии.</span><span class="sxs-lookup"><span data-stu-id="c47a0-108">Initializing with a backup is the fastest way to deliver data to the Subscriber and is convenient, because any recent backup can be used if it was taken after the publication was enabled for initialization with a backup.</span></span>  
  
-   <span data-ttu-id="c47a0-109">Копирование первоначального набора данных на подписчик с помощью другого механизма, например присоединения базы данных.</span><span class="sxs-lookup"><span data-stu-id="c47a0-109">Copying an initial dataset to the Subscriber through another mechanism, such as attaching a database.</span></span> <span data-ttu-id="c47a0-110">Необходимо удостовериться в том, что на подписчике находятся правильные данные и схема, после чего агент распространителя скопирует все необходимые метаданные и системные процедуры.</span><span class="sxs-lookup"><span data-stu-id="c47a0-110">You must ensure the correct data and schema are at the Subscriber, and then the Distribution Agent copies any required metadata and system procedures.</span></span>  
  
## <a name="initializing-a-subscription-with-a-backup"></a><span data-ttu-id="c47a0-111">Инициализация подписки с помощью резервной копии</span><span class="sxs-lookup"><span data-stu-id="c47a0-111">Initializing a subscription with a backup</span></span>  
 <span data-ttu-id="c47a0-112">Резервная копия содержит базу данных целиком, поэтому каждая база данных подписки при инициализации будет содержать полную копию базы данных публикации:</span><span class="sxs-lookup"><span data-stu-id="c47a0-112">A backup contains an entire database; therefore each subscription database will contain a complete copy of the publication database when it is initialized:</span></span>  
  
-   <span data-ttu-id="c47a0-113">Резервная копия включает таблицы, не указанные в качестве статей публикации.</span><span class="sxs-lookup"><span data-stu-id="c47a0-113">The backup includes tables not specified as articles for the publication.</span></span>  
  
-   <span data-ttu-id="c47a0-114">Резервная копия включает все данные, даже если для таблицы указаны фильтры строк или столбцов.</span><span class="sxs-lookup"><span data-stu-id="c47a0-114">The backup includes all data, even if row or column filters are specified on a table.</span></span>  
  
 <span data-ttu-id="c47a0-115">Удаление любых нежелательных объектов и данных после восстановления резервной копии должно выполняться администратором или приложением.</span><span class="sxs-lookup"><span data-stu-id="c47a0-115">It is the responsibility of the administrator or application to remove any unwanted objects or data after the backup has been restored.</span></span> <span data-ttu-id="c47a0-116">При последующих синхронизациях изменения данных реплицируются только в том случае, если они относятся к таблицам, указанным в качестве статей, а изменения соответствуют указанным критериям фильтрации.</span><span class="sxs-lookup"><span data-stu-id="c47a0-116">In subsequent synchronizations, data changes are only replicated if they apply to tables specified as articles, and the changes meet any filtering criteria you specified.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c47a0-117">Если необходимо, чтобы подписчик синхронизировался автоматически, при восстановлении резервной копии следует обеспечить то, чтобы резервная копия поступала от издателя.</span><span class="sxs-lookup"><span data-stu-id="c47a0-117">When restoring a backup, you must ensure that the backup came from the Publisher if you want the Subscriber to automatically synchronize.</span></span> <span data-ttu-id="c47a0-118">Значения регистрационных номеров транзакций в журнале (LSN), содержащиеся в резервной копии (используемые для определения точки начала синхронизации), специфичны для издателя.</span><span class="sxs-lookup"><span data-stu-id="c47a0-118">The log sequence number (LSN) values in the backup (which are used to set the point at which to start synchronizing) are specific to the Publisher.</span></span>  
  
 <span data-ttu-id="c47a0-119">**Инициализация подписки с помощью резервной копии**</span><span class="sxs-lookup"><span data-stu-id="c47a0-119">**To initialize a subscription with a backup**</span></span>  
  
 <span data-ttu-id="c47a0-120">Чтобы инициализировать подписку с помощью резервной копии, следует включить эту возможность при создании публикации, а затем указать значения нескольких параметров при создании подписки.</span><span class="sxs-lookup"><span data-stu-id="c47a0-120">To initialize a subscription with a backup, you first must enable the option when you create a publication, and then specify values for a number of options when you create a subscription.</span></span> <span data-ttu-id="c47a0-121">Публикации можно включить с помощью мастера создания публикаций или программно.</span><span class="sxs-lookup"><span data-stu-id="c47a0-121">Publications can be enabled through the New Publication Wizard or programmatically.</span></span> <span data-ttu-id="c47a0-122">Однако указать необходимые значения параметров подписки можно только программно.</span><span class="sxs-lookup"><span data-stu-id="c47a0-122">However, the values required for the subscription options can only be specified programmatically.</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="c47a0-123">: [Включение инициализации из резервной копии для публикаций транзакций (SQL Server Management Studio)](enable-initialization-with-backup-for-transactional-publications.md)</span><span class="sxs-lookup"><span data-stu-id="c47a0-123">: [Enable Initialization with a Backup for Transactional Publications &#40;SQL Server Management Studio&#41;](enable-initialization-with-backup-for-transactional-publications.md)</span></span>  
  
-   <span data-ttu-id="c47a0-124">Программирование репликации на Transact-SQL: [Инициализация транзакционной подписки из резервной копии (программирование репликации на языке Transact-SQL)](initialize-a-transactional-subscription-from-a-backup.md)</span><span class="sxs-lookup"><span data-stu-id="c47a0-124">Replication Transact-SQL programming: [Initialize a Transactional Subscription from a Backup &#40;Replication Transact-SQL Programming&#41;](initialize-a-transactional-subscription-from-a-backup.md)</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c47a0-125">Если подписка инициализируется без использования моментального снимка, то учетной записи, под которой выполняется служба SQL Server на издателе, должны быть предоставлены разрешения на запись в папку моментальных снимков на распространителе.</span><span class="sxs-lookup"><span data-stu-id="c47a0-125">If a subscription is initialized without using a snapshot, the account under which the SQL Server service runs at the Publisher must have write permissions on the snapshot folder at the Distributor.</span></span> <span data-ttu-id="c47a0-126">Дополнительные сведения о разрешениях см. в разделе [Replication Agent Security Model](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="c47a0-126">For more information about permissions, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
### <a name="ensuring-the-suitability-of-a-backup"></a><span data-ttu-id="c47a0-127">Обеспечение пригодности резервной копии</span><span class="sxs-lookup"><span data-stu-id="c47a0-127">Ensuring the suitability of a backup</span></span>  
 <span data-ttu-id="c47a0-128">Резервная копия пригодна для инициализации подписчика, если все транзакции, происходящие после создания резервной копии, хранятся на распространителе.</span><span class="sxs-lookup"><span data-stu-id="c47a0-128">A backup is suitable for initializing a Subscriber if all transactions that occur after the backup was taken are stored at the Distributor.</span></span> <span data-ttu-id="c47a0-129">Если резервная копия непригодна, система репликации выдаст сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="c47a0-129">Replication will display an error message if the backup is not suitable.</span></span>  
  
 <span data-ttu-id="c47a0-130">Чтобы обеспечить пригодность резервной копии для использования, придерживайтесь следующих рекомендаций:</span><span class="sxs-lookup"><span data-stu-id="c47a0-130">To help ensure that a backup is suitable for use, follow these guidelines:</span></span>  
  
-   <span data-ttu-id="c47a0-131">Пользуйтесь последней доступной резервной копией, а если последняя резервная копия старше, чем максимальный срок хранения рассылки, создайте новую резервную копию, прежде чем пытаться инициализировать подписку с ее помощью.</span><span class="sxs-lookup"><span data-stu-id="c47a0-131">Use the latest backup available, and if the latest backup is older than the maximum distribution retention period, create a new backup before attempting to initialize a subscription with a backup.</span></span> <span data-ttu-id="c47a0-132">Дополнительные сведения о сроке хранения см. в разделе [Subscription Expiration and Deactivation](subscription-expiration-and-deactivation.md).</span><span class="sxs-lookup"><span data-stu-id="c47a0-132">For more information about retention period, see [Subscription Expiration and Deactivation](subscription-expiration-and-deactivation.md).</span></span>  
  
-   <span data-ttu-id="c47a0-133">По умолчанию задача очистки на распространителе удаляет транзакции старше 72 часов из базы данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="c47a0-133">By default, the distribution cleanup job clears transactions older than 72 hours from the distribution database.</span></span> <span data-ttu-id="c47a0-134">Очистка основывается на сроке хранения, установленном для публикации.</span><span class="sxs-lookup"><span data-stu-id="c47a0-134">Cleanup is based on the retention period set for the publication.</span></span> <span data-ttu-id="c47a0-135">При синхронизации с более старыми резервными копиями рассмотрите возможность временного отключения этого задания перед восстановлением резервной копии и возможность повторного включения после успешного создания подписки.</span><span class="sxs-lookup"><span data-stu-id="c47a0-135">When synchronizing with older backups, consider temporarily disabling the job before the backup you would like to restore and re-enabling it after the subscription is successfully created.</span></span> <span data-ttu-id="c47a0-136">Это предотвращает удаление из базы данных распространителя транзакций, которые могут понадобиться для успешной синхронизации из резервной копии.</span><span class="sxs-lookup"><span data-stu-id="c47a0-136">This prevents removal of transactions from the distribution database that might be needed to synchronize successfully from the backup.</span></span> <span data-ttu-id="c47a0-137">Сведения о выполнении заданий очистки см. в статье [Запуск заданий по обслуживанию репликации (SQL Server Management Studio)](administration/run-replication-maintenance-jobs-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="c47a0-137">For information about running cleanup jobs, see [Run Replication Maintenance Jobs &#40;SQL Server Management Studio&#41;](administration/run-replication-maintenance-jobs-sql-server-management-studio.md).</span></span>  
  
 <span data-ttu-id="c47a0-138">В некоторых случаях после настройки подписок, инициализируемых с помощью резервной копии, следует вручную выполнить настройки в восстановленной базе данных подписчика.</span><span class="sxs-lookup"><span data-stu-id="c47a0-138">In some cases you must manually perform customizations in the restored Subscriber database after setting up subscriptions that are initialized with a backup.</span></span> <span data-ttu-id="c47a0-139">В общем случае внесение изменений вручную в восстановленную базу данных подписчика требуется, если публикация определена таким образом, что допускается отличие содержимого базы данных подписчика от содержимого базы данных издателя.</span><span class="sxs-lookup"><span data-stu-id="c47a0-139">In general, manual modifications at the restored Subscriber database are required if the Publication is defined in such a way that the Subscriber database content is expected to be different from the Publisher database content.</span></span>  
  
-   <span data-ttu-id="c47a0-140">Индексированные представления в восстановленной базе данных должны быть преобразованы в таблицы, если они публикуются как статьи таблиц, полученных из индексированных представлений на основе журнала операций.</span><span class="sxs-lookup"><span data-stu-id="c47a0-140">Indexed-views at the restored database have to be converted to tables if they are published as log-based indexed-view-to-table articles</span></span>  
  
-   <span data-ttu-id="c47a0-141">Входящие в подписку столбцы типа timestamp в восстановленной базе данных должны быть преобразованы в столбцы типа **binary(8)** : скопируйте содержимое таблиц, содержащих столбцы типа timestamp, в новые таблицы, имеющие те же схемы, за исключением того, что вместо столбцов типа timestamp они содержат столбцы типа **binary(8)** , удалите исходные таблицы и присвойте новым таблицам имена исходных таблиц.</span><span class="sxs-lookup"><span data-stu-id="c47a0-141">Subscribed timestamp columns at the restored database must be converted to **binary(8)** columns: copy the content of the tables containing timestamp columns to new tables with matching schemas except having **binary(8)** columns in place of the timestamp columns, drop the original tables, and rename the new tables with the same names as the original tables.</span></span>  
  
## <a name="initializing-a-subscription-with-an-alternative-method"></a><span data-ttu-id="c47a0-142">Инициализация подписки альтернативным способом</span><span class="sxs-lookup"><span data-stu-id="c47a0-142">Initializing a subscription with an alternative method</span></span>  
 <span data-ttu-id="c47a0-143">Подписку можно инициализировать любым методом, позволяющим скопировать на подписчик схему и данные базы данных публикации, например службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c47a0-143">It is possible to initialize a subscription using any method that allows you to copy the publication database schema and data to the Subscriber, such as [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)].</span></span> <span data-ttu-id="c47a0-144">При использовании для инициализации подписчика альтернативного метода объекты поддержки репликации копируются на подписчик.</span><span class="sxs-lookup"><span data-stu-id="c47a0-144">When you use an alternative method to initialize the Subscriber, replication support objects are copied to the Subscriber.</span></span>  
  
 <span data-ttu-id="c47a0-145">В отличие от инициализации, с помощью резервной копии необходимо обеспечить то, чтобы данные и схема были должным образом синхронизированы во время добавления подписки.</span><span class="sxs-lookup"><span data-stu-id="c47a0-145">Unlike initializing with a backup, you or your application must ensure the data and schema are properly synchronized at the time you add the subscription.</span></span> <span data-ttu-id="c47a0-146">Например, если между моментом копирования данных и схемы на подписчик и моментом добавления подписки издатель активен, то изменения данных, которые произошли в результате этой активности, могут не реплицироваться на подписчик.</span><span class="sxs-lookup"><span data-stu-id="c47a0-146">If, for example, there is activity on the Publisher between the time data and schema are copied to the Subscriber and the time at which the subscription is added, changes resulting from this activity might not be replicated to the Subscriber.</span></span>  
  
 <span data-ttu-id="c47a0-147">Описание альтернативного метода инициализации подписки см. в разделе [Initialize a Subscription Manually](initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="c47a0-147">To initialize a subscription with an alternative method, see [Initialize a Subscription Manually](initialize-a-subscription-manually.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c47a0-148">См. также:</span><span class="sxs-lookup"><span data-stu-id="c47a0-148">See Also</span></span>  
 [<span data-ttu-id="c47a0-149">Инициализация подписки</span><span class="sxs-lookup"><span data-stu-id="c47a0-149">Initialize a Subscription</span></span>](initialize-a-subscription.md)  
  
  
