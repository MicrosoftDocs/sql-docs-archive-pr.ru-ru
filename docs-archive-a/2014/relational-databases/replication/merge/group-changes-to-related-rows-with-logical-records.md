---
title: Группирование изменений в связанных строках с помощью логических записей | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- merge replication logical records [SQL Server replication]
- articles [SQL Server replication], logical records
- logical records [SQL Server replication]
ms.assetid: ad76799c-4486-4b98-9705-005433041321
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 433e0edbe83d102e6002bd133f967f27a236f66e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87654215"
---
# <a name="group-changes-to-related-rows-with-logical-records"></a><span data-ttu-id="9d3b9-102">Изменения группирования связанных строк с логическими записями</span><span class="sxs-lookup"><span data-stu-id="9d3b9-102">Group Changes to Related Rows with Logical Records</span></span>
  
> [!NOTE]
>  [!INCLUDE[ssNoteDepFutureAvoid](../../../includes/ssnotedepfutureavoid-md.md)]

 <span data-ttu-id="9d3b9-103">По умолчанию репликация слиянием обрабатывает изменения данных построчно.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-103">By default, merge replication processes data changes on a row-by-row basis.</span></span> <span data-ttu-id="9d3b9-104">Во многих случаях это является подходящим способом, но для некоторых приложений важно, чтобы связанные строки обрабатывались как одно целое.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-104">In many circumstances this is appropriate, but for some applications, it is essential that related rows be processed as a unit.</span></span> <span data-ttu-id="9d3b9-105">Функция логических записей репликации слиянием позволяет определить отношения между связанными строками в разных таблицах, чтобы строки обрабатывались как одно целое.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-105">The logical records feature of merge replication allows you to define a relationship between related rows in different tables so that the rows are processed as a unit.</span></span>

> [!NOTE]
>  <span data-ttu-id="9d3b9-106">Функция логических записей может использоваться автономно или совместно с фильтрами соединения.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-106">The logical records feature can be used alone or in conjunction with join filters.</span></span> <span data-ttu-id="9d3b9-107">Дополнительные сведения о фильтрах соединения см. в разделе [Join Filters](join-filters.md).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-107">For more information about join filters, see [Join Filters](join-filters.md).</span></span> <span data-ttu-id="9d3b9-108">Для использования логических записей необходим уровень совместимости публикации, равный по меньшей мере 90RTM.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-108">To use logical records, the compatibility level of the publication must be at least 90RTM.</span></span>

 <span data-ttu-id="9d3b9-109">Рассмотрим три связанные таблицы.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-109">Consider these three related tables:</span></span>

 <span data-ttu-id="9d3b9-110">![Логическая запись из трех таблиц только с именами столбцов](../media/logical-records-01.gif "Логическая запись из трех таблиц только с именами столбцов")</span><span class="sxs-lookup"><span data-stu-id="9d3b9-110">![Three table logical record, with column names only](../media/logical-records-01.gif "Three table logical record, with column names only")</span></span>

 <span data-ttu-id="9d3b9-111">Таблица **Customers** является родительской таблицей в этом отношении, и ее первичным ключевым столбцом является **CustID**.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-111">The **Customers** table is the parent table in this relationship and has a primary key column **CustID**.</span></span> <span data-ttu-id="9d3b9-112">Таблица **Orders** содержит первичный ключевой столбец **OrderID**, имеет ограничение внешнего ключа для столбца **CustID** , который ссылается на столбец **CustID** в таблице **Customers** .</span><span class="sxs-lookup"><span data-stu-id="9d3b9-112">The **Orders** table has a primary key column **OrderID**, with a foreign key constraint on the **CustID** column that references the **CustID** column in the **Customers** table.</span></span> <span data-ttu-id="9d3b9-113">Аналогично таблица **OrderItems** содержит первичный ключевой столбец **OrderItemID**, имеет ограничение внешнего ключа для столбца **OrderID** , который ссылается на столбец **OrderID** в таблице **Orders** .</span><span class="sxs-lookup"><span data-stu-id="9d3b9-113">Similarly, the **OrderItems** table has a primary key column **OrderItemID**, with a foreign key constraint on the **OrderID** column that references the **OrderID** column in the **Orders** table.</span></span>

 <span data-ttu-id="9d3b9-114">В этом примере логическая запись состоит из всех строк в таблице **Orders** , которые связаны с единственным значением **CustID** , и всех строк таблицы **OrderItems** , которые им соответствуют в таблице **Orders** .</span><span class="sxs-lookup"><span data-stu-id="9d3b9-114">In this example, a logical record consists of all the rows in the **Orders** table that are related to a single **CustID** value and all of the rows in the **OrderItems** table that are related to those rows in the **Orders** table.</span></span> <span data-ttu-id="9d3b9-115">На этой диаграмме показаны все строки в трех таблицах, которые содержатся в логической записи для Customer2.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-115">This diagram shows all the rows in the three tables that are in the logical record for Customer2:</span></span>

 <span data-ttu-id="9d3b9-116">![Логическая запись из трех таблиц со значениями](../media/logical-records-02.gif "Логическая запись из трех таблиц со значениями")</span><span class="sxs-lookup"><span data-stu-id="9d3b9-116">![Three table logical record with values](../media/logical-records-02.gif "Three table logical record with values")</span></span>

 <span data-ttu-id="9d3b9-117">Чтобы определить связь логических записей между статьями, см. раздел [Определение логической записи Отношения между Объединить таблицы статей](../publish/define-a-logical-record-relationship-between-merge-table-articles.md).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-117">To define a logical record relationship between articles, see [Define a Logical Record Relationship Between Merge Table Articles](../publish/define-a-logical-record-relationship-between-merge-table-articles.md).</span></span>

## <a name="benefits-of-logical-records"></a><span data-ttu-id="9d3b9-118">Преимущества логических записей</span><span class="sxs-lookup"><span data-stu-id="9d3b9-118">Benefits of Logical Records</span></span>
 <span data-ttu-id="9d3b9-119">Функция логических записей имеет два основных преимущества:</span><span class="sxs-lookup"><span data-stu-id="9d3b9-119">The logical records feature has two primary benefits:</span></span>

-   <span data-ttu-id="9d3b9-120">Применение изменений данных как единого целого.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-120">Application of data changes as a unit.</span></span>

-   <span data-ttu-id="9d3b9-121">Обнаружение и разрешение конфликтов одновременно на нескольких строках из нескольких таблиц.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-121">The detection and resolution of conflicts simultaneously on multiple rows from multiple tables.</span></span>

### <a name="the-application-of-changes-as-a-unit"></a><span data-ttu-id="9d3b9-122">Применение изменений как одного целого</span><span class="sxs-lookup"><span data-stu-id="9d3b9-122">The Application of Changes As a Unit</span></span>
 <span data-ttu-id="9d3b9-123">Если обработка слияния прервана, например в случае обрыва подключения, для частично завершенного набора связанных реплицированных изменений выполняется откат при использовании логических записей.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-123">If merge processing is interrupted, such as in the case of a dropped connection, the partially completed set of related replicated changes is rolled back if logical records are used.</span></span> <span data-ttu-id="9d3b9-124">Например, рассмотрим случай, когда подписчик добавляет новый заказ с **OrderID** = 6 и двумя новыми строками в таблицу **OrderItems** с **OrderItemID** = 10 и **OrderItemID** = 11 для **OrderID** = 6.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-124">For example, consider the case where a Subscriber adds a new order with **OrderID** = 6 and two new rows in the **OrderItems** table with **OrderItemID** = 10 and **OrderItemID** = 11 for **OrderID** = 6.</span></span>

 <span data-ttu-id="9d3b9-125">![Логическая запись из трех таблиц со значениями](../media/logical-records-04.gif "Логическая запись из трех таблиц со значениями")</span><span class="sxs-lookup"><span data-stu-id="9d3b9-125">![Three table logical record with values](../media/logical-records-04.gif "Three table logical record with values")</span></span>

 <span data-ttu-id="9d3b9-126">Если процесс репликации прерван после завершения строки **Orders** для **OrderID** = 6, но перед завершением строк **OrderItems** 10 и 11 и логические записи не используются, тогда значение **OrderTotal** для **OrderID** = 6 не будет согласовываться с суммой значений **OrderAmount** для строк **OrderItems** .</span><span class="sxs-lookup"><span data-stu-id="9d3b9-126">If the replication process is interrupted after the **Orders** row for **OrderID** = 6 is complete, but before the **OrderItems** 10 and 11 are completed, and logical records are not used, the **OrderTotal** value for **OrderID** = 6 will not be consistent with the sum of the **OrderAmount** values for the **OrderItems** rows.</span></span> <span data-ttu-id="9d3b9-127">Если используются логические записи, то строка **Orders** для **OrderID** = 6 не фиксируется до тех пор, пока связанные изменения **OrderItems** не будут реплицированы.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-127">If logical records are used, the **Orders** row for **OrderID** = 6 is not committed until the related **OrderItems** changes are replicated.</span></span>

 <span data-ttu-id="9d3b9-128">В другом сценарии, если используются логические записи и выполняется запрос таблиц во время применения процессом слияния изменений, пользователь не увидит частично реплицированных изменений до тех пор, пока они все не завершатся.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-128">In a different scenario, if logical records are used, and someone is querying tables when the merge process is applying changes, the user will not see the partially replicated changes until they are all complete.</span></span> <span data-ttu-id="9d3b9-129">Например, процессом репликации передается строка Orders для **OrderID** = 6, и пользователь запрашивает таблицы до того, как процесс репликации реплицирует строки **OrderItems** , в этом случае значение **OrderTotal** не будет совпадать с суммой значений **OrderAmount** .</span><span class="sxs-lookup"><span data-stu-id="9d3b9-129">For example, the replication process has uploaded the Orders row for **OrderID** = 6, but a user queries the tables before the replication process has replicated the **OrderItems** rows, the **OrderTotal** value would not be the same as the sum of the **OrderAmount** values.</span></span> <span data-ttu-id="9d3b9-130">Если используются логические записи, строка **Orders** не будет видима до тех пор, пока не будут заполнены строки **OrderItems** и транзакция не будет зафиксирована как одно целое.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-130">If logical records are used, the **Orders** row would not be visible until the **OrderItems** rows are complete and the transaction has been committed as a unit.</span></span>

### <a name="the-application-of-conflict-handling-to-more-than-one-table"></a><span data-ttu-id="9d3b9-131">Применение обработки конфликтов в нескольких таблицах</span><span class="sxs-lookup"><span data-stu-id="9d3b9-131">The Application of Conflict Handling to More Than One Table</span></span>
 <span data-ttu-id="9d3b9-132">Рассмотрим случай, когда два подписчика имеют набор данных, упомянутый выше.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-132">Consider the case where two Subscribers have the data set above:</span></span>

-   <span data-ttu-id="9d3b9-133">Пользователь на первом подписчике изменяет **OrderAmount** для **OrderItemID** 5 с 100 на 150 и **OrderTotal** для **OrderID** 3 с 200 на 250.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-133">A user at the first Subscriber changes the **OrderAmount** of **OrderItemID** 5 from 100 to 150 and the **OrderTotal** of **OrderID** 3 from 200 to 250.</span></span>

-   <span data-ttu-id="9d3b9-134">Пользователь на втором подписчике изменяет **OrderAmount** для **OrderItemID** 6 с 25 на 125 и **OrderTotal** для **OrderID** 3 с 200 на 300.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-134">A user at the second Subscriber changes the **OrderAmount** of **OrderItemID** 6 from 25 to 125 and the **OrderTotal** of **OrderID** 3 from 200 to 300.</span></span>

 <span data-ttu-id="9d3b9-135">Если изменения реплицируются без использования логических записей, то разные значения **OrderTotal** приведут к конфликту и только одно из них будет реплицировано.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-135">If these changes are replicated without using logical records, the different **OrderTotal** values would result in a conflict and only one of them would be replicated.</span></span> <span data-ttu-id="9d3b9-136">Но неконфликтующие изменения в таблице **OrderItems** будут реплицированы без конфликта, оставляя конечные значения **OrderTotal** в несогласованном состоянии относительно строк **OrderItems** .</span><span class="sxs-lookup"><span data-stu-id="9d3b9-136">But the non-conflicting changes in the **OrderItems** table would be replicated without conflict, leaving the final **OrderTotal** values in an inconsistent state with respect to the **OrderItems** rows.</span></span> <span data-ttu-id="9d3b9-137">При использовании логических записей в этом сценарии для изменения **OrderItems** , связанного с проигравшим изменением таблицы **Orders** , также будет выполнен откат, и конечное значение **OrderTotal** будет равно точной сумме строк **OrderItems** .</span><span class="sxs-lookup"><span data-stu-id="9d3b9-137">If logical records are used in this scenario, the **OrderItems** change associated with the losing **Orders** table change would also be rolled back, and the final **OrderTotal** value would be an accurate summary of the **OrderItems** rows.</span></span>

 <span data-ttu-id="9d3b9-138">Дополнительные сведения о возможностях по определению и разрешению конфликтов при использовании логических записей см. в статье [Распознавание и разрешение конфликтов в логических записях](advanced-merge-replication-conflict-resolving-in-logical-record.md).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-138">For more information about options related to conflict detection and resolution with logical records, see [Detecting and Resolving Conflicts in Logical Records](advanced-merge-replication-conflict-resolving-in-logical-record.md).</span></span>

## <a name="considerations-for-using-logical-records"></a><span data-ttu-id="9d3b9-139">Вопросы использования логических записей</span><span class="sxs-lookup"><span data-stu-id="9d3b9-139">Considerations for Using Logical Records</span></span>
 <span data-ttu-id="9d3b9-140">Учитывайте следующие аспекты при использовании логических записей.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-140">Keep the following considerations in mind when using logical records.</span></span>

### <a name="general-considerations"></a><span data-ttu-id="9d3b9-141">Общие рекомендации</span><span class="sxs-lookup"><span data-stu-id="9d3b9-141">General Considerations</span></span>

-   <span data-ttu-id="9d3b9-142">Рекомендуется, чтобы количество таблиц в логической записи было как можно меньше и не превышало пяти.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-142">It is recommended that you keep the number of tables in a logical record as low as possible; five tables or less is recommended.</span></span>

-   <span data-ttu-id="9d3b9-143">Логические записи не могут ссылаться на столбцы, имеющие любой из следующих типов данных:</span><span class="sxs-lookup"><span data-stu-id="9d3b9-143">Logical records cannot reference columns with any of the following data types:</span></span>

    -   <span data-ttu-id="9d3b9-144">`varchar(max)` и `nvarchar(max)`</span><span class="sxs-lookup"><span data-stu-id="9d3b9-144">`varchar(max)` and `nvarchar(max)`</span></span>

    -   `varbinary(max)`

    -   <span data-ttu-id="9d3b9-145">`text` и `ntext`</span><span class="sxs-lookup"><span data-stu-id="9d3b9-145">`text` and `ntext`</span></span>

    -   `image`

    -   `XML`

    -   `UDT`

-   <span data-ttu-id="9d3b9-146">Связи по внешним ключам в опубликованных таблицах не могут определяться с параметром CASCADE.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-146">Foreign key relationships in published tables cannot be defined with the CASCADE option.</span></span> <span data-ttu-id="9d3b9-147">Дополнительные сведения см. в статьях [CREATE TABLE (Transact-SQL)](/sql/t-sql/statements/create-table-transact-sql) и [ALTER TABLE (Transact-SQL)](/sql/t-sql/statements/alter-table-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-147">For more information, see [CREATE TABLE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql) and [ALTER TABLE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-table-transact-sql).</span></span>

-   <span data-ttu-id="9d3b9-148">Нельзя обновлять любые столбцы, используемые в предложении логических отношений.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-148">You cannot update any columns that are used in the logical relation clause.</span></span>

-   <span data-ttu-id="9d3b9-149">Пользовательское разрешение конфликтов с обработчиками бизнес-логики или пользовательскими сопоставителями конфликтов не поддерживается для статей, входящих в логическую запись.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-149">Custom conflict resolution with business logic handlers or custom resolvers is not supported for articles that are included in a logical record.</span></span>

-   <span data-ttu-id="9d3b9-150">Если логические записи используются в публикации, содержащей параметризованные фильтры, следует инициализировать каждый подписчик с помощью моментального снимка для его секции.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-150">If logical records are used in a publication that includes parameterized filters, you must initialize each Subscriber with a snapshot for its partition.</span></span> <span data-ttu-id="9d3b9-151">Если подписчик инициализируется с помощью другого метода, произойдет сбой агента слияния.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-151">If you initialize a Subscriber with another method, the Merge Agent will fail.</span></span> <span data-ttu-id="9d3b9-152">Дополнительные сведения см. в статье [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-152">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>

-   <span data-ttu-id="9d3b9-153">Конфликты, затрагивающие логические записи, не отображаются в средстве просмотра конфликтов.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-153">Conflicts that involve logical records are not displayed in Conflict Viewer.</span></span> <span data-ttu-id="9d3b9-154">Для просмотра сведений о таких конфликтах используются хранимые процедуры репликации.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-154">To view information about these conflicts, use replication stored procedures.</span></span> <span data-ttu-id="9d3b9-155">Дополнительные сведения см. в статье [Просмотр сведений о конфликтах для публикаций слиянием &#40;программирование репликации на языке Transact-SQL&#41;](../view-conflict-information-for-merge-publications.md).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-155">For more information, see [View Conflict Information for Merge Publications &#40;Replication Transact-SQL Programming&#41;](../view-conflict-information-for-merge-publications.md).</span></span>

### <a name="publication-settings"></a><span data-ttu-id="9d3b9-156">Настройки публикации</span><span class="sxs-lookup"><span data-stu-id="9d3b9-156">Publication Settings</span></span>

-   <span data-ttu-id="9d3b9-157">Уровень совместимости публикации должен быть не менее 90RTM.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-157">The publication must have a compatibility level of 90RTM or greater.</span></span> <span data-ttu-id="9d3b9-158">Дополнительные сведения см. в разделе "Уровень совместимости публикации" статьи [Обратная совместимость репликации](../replication-backward-compatibility.md).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-158">For more information, see the "Publication Compatibility Level" section of [Replication Backward Compatibility](../replication-backward-compatibility.md).</span></span>

-   <span data-ttu-id="9d3b9-159">В публикации должен использоваться собственный режим моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-159">The publication must use native snapshot mode.</span></span> <span data-ttu-id="9d3b9-160">Этот режим используется по умолчанию, если не выполняется репликация на [!INCLUDE[ssEW](../../../includes/ssew-md.md)], не поддерживающий логические записи.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-160">This is the default unless you are replicating to [!INCLUDE[ssEW](../../../includes/ssew-md.md)], which does not support logical records.</span></span>

-   <span data-ttu-id="9d3b9-161">Публикация не может разрешить веб-синхронизацию.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-161">The publication cannot allow Web synchronization.</span></span> <span data-ttu-id="9d3b9-162">Дополнительные сведения о веб-синхронизации см. в разделе [Web Synchronization for Merge Replication](../web-synchronization-for-merge-replication.md).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-162">For more information about Web synchronization, see [Web Synchronization for Merge Replication](../web-synchronization-for-merge-replication.md).</span></span>

-   <span data-ttu-id="9d3b9-163">Чтобы использовать логические записи в фильтрованной публикации:</span><span class="sxs-lookup"><span data-stu-id="9d3b9-163">In order to use logical records on a filtered publication:</span></span>

    -   <span data-ttu-id="9d3b9-164">должны также использоваться предварительно вычисляемые секции.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-164">Precomputed partitions must also be used.</span></span> <span data-ttu-id="9d3b9-165">Требования для предварительно вычисляемых секций также применяются к логическим записям.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-165">The requirements of precomputed partitions also apply to logical records.</span></span> <span data-ttu-id="9d3b9-166">Дополнительные сведения см. в статье [Оптимизация производительности параметризованного фильтра с помощью предварительно вычисляемых секций](parameterized-filters-optimize-for-precomputed-partitions.md).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-166">For more information, see [Optimize Parameterized Filter Performance with Precomputed Partitions](parameterized-filters-optimize-for-precomputed-partitions.md).</span></span>

    -   <span data-ttu-id="9d3b9-167">Нельзя использовать неперекрывающиеся параметризованные фильтры.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-167">You cannot use nonoverlapping parameterized filters.</span></span> <span data-ttu-id="9d3b9-168">Дополнительные сведения см. в подразделе «Установка параметров секции» раздела [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-168">For more information, see the "Setting 'partition options'" section of [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).</span></span>

-   <span data-ttu-id="9d3b9-169">Если в публикации используются фильтры соединения, свойство **join unique key** должно быть установлено в значение **true** для всех фильтров соединения, включенных в отношения логических записей.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-169">If the publication uses join filters, the **join unique key** property must be set to **true** for all join filters that are involved in logical record relationships.</span></span> <span data-ttu-id="9d3b9-170">Дополнительные сведения см. в статье [Join Filters](join-filters.md).</span><span class="sxs-lookup"><span data-stu-id="9d3b9-170">For more information, see [Join Filters](join-filters.md).</span></span>

### <a name="relationships-between-tables"></a><span data-ttu-id="9d3b9-171">Связи между таблицами</span><span class="sxs-lookup"><span data-stu-id="9d3b9-171">Relationships Between Tables</span></span>

-   <span data-ttu-id="9d3b9-172">Таблицы, связанные через логические записи, должны иметь связь «первичный-внешний ключ».</span><span class="sxs-lookup"><span data-stu-id="9d3b9-172">Tables related through logical records must have a primary key-foreign key relationship.</span></span>

-   <span data-ttu-id="9d3b9-173">Параметр NOT FOR REPLICATION не может быть установлен для ограничений внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-173">The NOT FOR REPLICATION option cannot be set for foreign key constraints.</span></span>

-   <span data-ttu-id="9d3b9-174">Дочерняя таблица может иметь только одну родительскую таблицу.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-174">Child tables can have only one parent table.</span></span>

     <span data-ttu-id="9d3b9-175">Например, база данных, отслеживающая классы и студентов, могла бы иметь структуру, похожую на следующую:</span><span class="sxs-lookup"><span data-stu-id="9d3b9-175">For example, a database tracking classes and students might have a design similar to:</span></span>

     <span data-ttu-id="9d3b9-176">![Дочерняя таблица с несколькими родительскими](../media/logical-records-03.gif "Дочерняя таблица с несколькими родительскими")</span><span class="sxs-lookup"><span data-stu-id="9d3b9-176">![Child table with more than one parent table](../media/logical-records-03.gif "Child table with more than one parent table")</span></span>

     <span data-ttu-id="9d3b9-177">Нельзя использовать логическую запись для представления трех таблиц в этом отношении, потому что строки в **ClassMembers** не связаны с одиночной строкой первичного ключа.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-177">You cannot use a logical record to represent the three tables in this relationship, because the rows in **ClassMembers** are not associated with a single primary key row.</span></span> <span data-ttu-id="9d3b9-178">Таблицы **Classes** и **ClassMembers** могут по-прежнему образовывать логическую запись, так же как таблицы **ClassMembers** и **Students**, но не все три таблицы.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-178">The tables **Classes** and **ClassMembers** could still form a logical record, as could the tables **ClassMembers** and **Students**, but not all three.</span></span>

-   <span data-ttu-id="9d3b9-179">Публикация не может содержать циклических отношений фильтров соединения.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-179">The publication cannot contain circular join filter relationships.</span></span>

     <span data-ttu-id="9d3b9-180">Как видно из примера с таблицами **Customers**, **Orders**и **OrderItems**, невозможно было бы использовать логические записи, если таблица **Orders** содержала бы также ограничение внешнего ключа, которое ссылалось на таблицу **OrderItems** .</span><span class="sxs-lookup"><span data-stu-id="9d3b9-180">Using the example with the tables **Customers**, **Orders**, and **OrderItems**, you could not use logical records if the **Orders** table also had a foreign key constraint that referenced the **OrderItems** table.</span></span>

## <a name="performance-implications-of-logical-records"></a><span data-ttu-id="9d3b9-181">Влияние логических записей на производительность</span><span class="sxs-lookup"><span data-stu-id="9d3b9-181">Performance implications of logical records</span></span>
 <span data-ttu-id="9d3b9-182">Функция логических записей требует затрат производительности.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-182">The logical record feature does come with a performance cost.</span></span> <span data-ttu-id="9d3b9-183">Если логические записи не используются, агент репликации может обработать одновременно все изменения для данной статьи, и так как изменения применяются построчно, требования блокировок и записи транзакций в журнал, необходимые для применения изменений, минимальны.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-183">If logical records are not used, the replication agent can process all of the changes for a given article at the same time, and because the changes are applied in a row-by-row fashion, the locking and transaction log requirements necessary for applying the changes are minimal.</span></span>

 <span data-ttu-id="9d3b9-184">Если используются логические записи, агент слияния должен обрабатывать все изменения для каждой логической записи совместно.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-184">If logical records are used, the Merge Agent must process the changes for each entire logical record together.</span></span> <span data-ttu-id="9d3b9-185">Это влияет на время, которое требуется агенту слияния для репликации строк.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-185">This has an effect on the amount of time it takes the Merge Agent to replicate the rows.</span></span> <span data-ttu-id="9d3b9-186">Кроме того, так как агент открывает отдельную транзакцию для каждой логической записи, потребность в блокировках может увеличиться.</span><span class="sxs-lookup"><span data-stu-id="9d3b9-186">Additionally, because the agent opens a separate transaction for each logical record, locking requirements can increase.</span></span>

## <a name="see-also"></a><span data-ttu-id="9d3b9-187">См. также:</span><span class="sxs-lookup"><span data-stu-id="9d3b9-187">See Also</span></span>
 [<span data-ttu-id="9d3b9-188">Article Options for Merge Replication</span><span class="sxs-lookup"><span data-stu-id="9d3b9-188">Article Options for Merge Replication</span></span>](article-options-for-merge-replication.md)


