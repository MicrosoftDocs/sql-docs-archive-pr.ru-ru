---
title: Репликация слиянием | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- merge replication [SQL Server replication], about merge replication
- merge replication [SQL Server replication]
ms.assetid: ff87c368-4c00-4e48-809d-ea752839551e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 7feef9e4debc228d1685c664c072139d60b56c22
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87654201"
---
# <a name="merge-replication"></a><span data-ttu-id="d7509-102">Репликация слиянием</span><span class="sxs-lookup"><span data-stu-id="d7509-102">Merge Replication</span></span>
  <span data-ttu-id="d7509-103">Репликация слиянием, как и репликация транзакций, как правило, начинается с моментального снимка объектов и данных базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="d7509-103">Merge replication, like transactional replication, typically starts with a snapshot of the publication database objects and data.</span></span> <span data-ttu-id="d7509-104">Последующие изменения данных и схемы, произведенные на стороне издателя и подписчиков, отслеживаются при помощи триггеров.</span><span class="sxs-lookup"><span data-stu-id="d7509-104">Subsequent data changes and schema modifications made at the Publisher and Subscribers are tracked with triggers.</span></span> <span data-ttu-id="d7509-105">Подписчик синхронизируется с издателем при подключении к сети и обменивается с ним всеми строками, которые изменились со времени последней синхронизации издателя и подписчика.</span><span class="sxs-lookup"><span data-stu-id="d7509-105">The Subscriber synchronizes with the Publisher when connected to the network and exchanges all rows that have changed between the Publisher and Subscriber since the last time synchronization occurred.</span></span>

 <span data-ttu-id="d7509-106">Как правило, репликация слиянием применяется в средах «сервер-клиент».</span><span class="sxs-lookup"><span data-stu-id="d7509-106">Merge replication is typically used in server-to-client environments.</span></span> <span data-ttu-id="d7509-107">Репликация слиянием подходит для любой из следующих ситуаций.</span><span class="sxs-lookup"><span data-stu-id="d7509-107">Merge replication is appropriate in any of the following situations:</span></span>

-   <span data-ttu-id="d7509-108">Несколько подписчиков могут обновлять одни и те же данные в разное время и передавать эти изменения на издатель и на другие подписчики.</span><span class="sxs-lookup"><span data-stu-id="d7509-108">Multiple Subscribers might update the same data at various times and propagate those changes to the Publisher and to other Subscribers.</span></span>

-   <span data-ttu-id="d7509-109">Подписчикам нужно получить данные, внести изменения в режиме «вне сети» и позднее синхронизировать изменения с издателем и другими подписчиками.</span><span class="sxs-lookup"><span data-stu-id="d7509-109">Subscribers need to receive data, make changes offline, and later synchronize changes with the Publisher and other Subscribers.</span></span>

-   <span data-ttu-id="d7509-110">Каждому подписчику нужна индивидуальная секция данных.</span><span class="sxs-lookup"><span data-stu-id="d7509-110">Each Subscriber requires a different partition of data.</span></span>

-   <span data-ttu-id="d7509-111">Поскольку возможно возникновение конфликтов, необходимы средства по распознаванию и разрешению конфликтов.</span><span class="sxs-lookup"><span data-stu-id="d7509-111">Conflicts might occur and, when they do, you need the ability to detect and resolve them.</span></span>

-   <span data-ttu-id="d7509-112">Приложению требуется конечное изменение данных, а не доступ к промежуточным состояниям данных.</span><span class="sxs-lookup"><span data-stu-id="d7509-112">The application requires net data change rather than access to intermediate data states.</span></span> <span data-ttu-id="d7509-113">Например, если строка меняется пять раз на подписчике до его синхронизации с издателем, на издателе строка изменится только один раз для отображения конечного изменения данных (то есть, пятого значения).</span><span class="sxs-lookup"><span data-stu-id="d7509-113">For example, if a row changes five times at a Subscriber before it synchronizes with a Publisher, the row will change only once at the Publisher to reflect the net data change (that is, the fifth value).</span></span>

 <span data-ttu-id="d7509-114">Репликация слиянием позволяет различным сайтам работать автономно, и позднее выполнить слияние обновлений в единый результат.</span><span class="sxs-lookup"><span data-stu-id="d7509-114">Merge replication allows various sites to work autonomously and later merge updates into a single, uniform result.</span></span> <span data-ttu-id="d7509-115">Поскольку обновления выполняются на нескольких узлах, одни и те же данные могут быть обновлены издателем и несколькими подписчиками.</span><span class="sxs-lookup"><span data-stu-id="d7509-115">Because updates are made at more than one node, the same data may have been updated by the Publisher and by more than one Subscriber.</span></span> <span data-ttu-id="d7509-116">Поэтому при слиянии обновлений могут возникать конфликты, и репликация слиянием предоставляет несколько способов обработки конфликтов.</span><span class="sxs-lookup"><span data-stu-id="d7509-116">Therefore, conflicts can occur when updates are merged and merge replication provides a number of ways to handle conflicts.</span></span>

 <span data-ttu-id="d7509-117">Репликация слиянием реализуется агентом моментальных снимков [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и агентом слияния.</span><span class="sxs-lookup"><span data-stu-id="d7509-117">Merge replication is implemented by the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Snapshot Agent and Merge Agent.</span></span> <span data-ttu-id="d7509-118">Если публикация не отфильтрована или использует статические фильтры, агент слияния создает один моментальный снимок.</span><span class="sxs-lookup"><span data-stu-id="d7509-118">If the publication is unfiltered or uses static filters, the Snapshot Agent creates a single snapshot.</span></span> <span data-ttu-id="d7509-119">Если публикация использует параметризованные фильтры, то агент слияния создает моментальный снимок для каждой секции данных.</span><span class="sxs-lookup"><span data-stu-id="d7509-119">If the publication uses parameterized filters, the Snapshot Agent creates a snapshot for each partition of data.</span></span> <span data-ttu-id="d7509-120">Агент слияния применяет все исходные моментальные снимки на подписчиках.</span><span class="sxs-lookup"><span data-stu-id="d7509-120">The Merge Agent applies the initial snapshots to the Subscribers.</span></span> <span data-ttu-id="d7509-121">Он также объединяет добавочные изменения данных, которые возникли на издателе или подписчиках после создания исходного моментального снимка, выявляет и разрешает любые конфликты в соответствии с заданными вами правилами.</span><span class="sxs-lookup"><span data-stu-id="d7509-121">It also merges incremental data changes that occurred at the Publisher or Subscribers after the initial snapshot was created, and detects and resolves any conflicts according to rules you configure.</span></span>

 <span data-ttu-id="d7509-122">Для отслеживания изменений репликация слиянием и репликация транзакций с подписками, обновляемыми посредством очередей, должны быть способны уникально идентифицировать каждую строку в каждой опубликованной таблице.</span><span class="sxs-lookup"><span data-stu-id="d7509-122">To track changes, merge replication (and transactional replication with queued updating subscriptions) must be able to uniquely identify every row in every published table.</span></span> <span data-ttu-id="d7509-123">Чтобы этого добиться, при репликации слиянием добавляется столбец `rowguid` в каждую таблицу в том случае, если в них еще нет столбца с типом данных `uniqueidentifier` с набором свойств `ROWGUIDCOL` (в этом случае столбец не используется).</span><span class="sxs-lookup"><span data-stu-id="d7509-123">To accomplish this merge replication adds the column `rowguid` to every table, unless the table already has a column of data type `uniqueidentifier` with the `ROWGUIDCOL` property set (in which case this column is used).</span></span> <span data-ttu-id="d7509-124">Если таблица удалена из публикации, столбец `rowguid` удаляется; если существующий столбец был использован для отслеживания, столбец не удаляется.</span><span class="sxs-lookup"><span data-stu-id="d7509-124">If the table is dropped from the publication, the `rowguid` column is removed; if an existing column was used for tracking, the column is not removed.</span></span> <span data-ttu-id="d7509-125">Фильтр не должен включать столбец `rowguidcol`, который используется в процессе репликации для идентификации строк.</span><span class="sxs-lookup"><span data-stu-id="d7509-125">A filter must not include the `rowguidcol` used by replication to identify rows.</span></span> <span data-ttu-id="d7509-126">Функция `newid()` формирует значения по умолчанию для столбца `rowguid`, однако заказчики могут предоставить guid для каждой строки, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="d7509-126">The `newid()` function is provided as a default for the `rowguid` column, however customers can provide a guid for each row if needed.</span></span> <span data-ttu-id="d7509-127">Однако не следует предоставлять значение 00000000-0000-0000-0000-000000000000.</span><span class="sxs-lookup"><span data-stu-id="d7509-127">However, do not provide value 00000000-0000-0000-0000-000000000000.</span></span>

 <span data-ttu-id="d7509-128">В диаграмме ниже показаны компоненты, используемые при репликации слиянием.</span><span class="sxs-lookup"><span data-stu-id="d7509-128">The following diagram shows the components used in merge replication.</span></span>

 <span data-ttu-id="d7509-129">![Компоненты репликации слиянием и потоки данных](../media/merge.gif "Компоненты репликации слиянием и потоки данных")</span><span class="sxs-lookup"><span data-stu-id="d7509-129">![Merge replication components and data flow](../media/merge.gif "Merge replication components and data flow")</span></span>


