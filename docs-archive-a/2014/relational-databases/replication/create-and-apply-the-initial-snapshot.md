---
title: Создание и применение исходного моментального снимка | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], creating
- snapshot replication [SQL Server], initial snapshots
ms.assetid: 742727a1-5189-44ec-b3ae-6fd7aa1f5347
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: b7ac008fe139adf55376bb50fbf60dddcd6b9ae5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655655"
---
# <a name="create-and-apply-the-initial-snapshot"></a><span data-ttu-id="d2156-102">Создание и применение исходного моментального снимка</span><span class="sxs-lookup"><span data-stu-id="d2156-102">Create and Apply the Initial Snapshot</span></span>
  <span data-ttu-id="d2156-103">В данном разделе описывается процесс создания и применения исходного моментального снимка в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] при помощи среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)]или объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="d2156-103">This topic describes how to create and apply the initial snapshot in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="d2156-104">Публикации слиянием, использующие параметризованные фильтры, требуют моментальных снимков, состоящих из двух частей.</span><span class="sxs-lookup"><span data-stu-id="d2156-104">Merge publications that use parameterized filters require a two-part snapshot.</span></span> <span data-ttu-id="d2156-105">Дополнительные сведения см. в статье [Создание моментального снимка для публикации слиянием с параметризованными фильтрами](create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="d2156-105">For more information, see [Create a Snapshot for a Merge Publication with Parameterized Filters](create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).</span></span>  
  
 <span data-ttu-id="d2156-106">**В этом разделе**</span><span class="sxs-lookup"><span data-stu-id="d2156-106">**In This Topic**</span></span>  
  
-   <span data-ttu-id="d2156-107">**Для создания и применения исходного моментального снимка используется:**</span><span class="sxs-lookup"><span data-stu-id="d2156-107">**To create and apply the initial snapshot, using:**</span></span>  
  
     [<span data-ttu-id="d2156-108">Среда SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d2156-108">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="d2156-109">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d2156-109">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="d2156-110">объекты RMO;</span><span class="sxs-lookup"><span data-stu-id="d2156-110">Replication Management Objects (RMO)</span></span>](#RMOProcedure)  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="d2156-111">Использование среды SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d2156-111">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="d2156-112">По умолчанию, если выполняется агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , агент моментальных снимков создает моментальный снимок сразу после того, как создана публикация с помощью мастера создания публикаций.</span><span class="sxs-lookup"><span data-stu-id="d2156-112">By default, if [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent is running, a snapshot is generated by the Snapshot Agent immediately after a publication is created with the New Publication Wizard.</span></span> <span data-ttu-id="d2156-113">Затем по умолчанию агент распространителя (для репликации моментальных снимков и репликации транзакций) или агент слияния (для подписок на публикацию слиянием) применяет моментальный снимок ко всем подпискам.</span><span class="sxs-lookup"><span data-stu-id="d2156-113">By default, it is then applied by the Distribution Agent (for snapshot and transactional replication) or Merge Agent (for merge subscriptions) for all subscriptions.</span></span> <span data-ttu-id="d2156-114">Моментальный снимок также можно создать с помощью среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] и монитора репликации.</span><span class="sxs-lookup"><span data-stu-id="d2156-114">A snapshot can also be generated using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] and Replication Monitor.</span></span> <span data-ttu-id="d2156-115">Сведения о запуске монитора репликации см. в [этой статье](monitor/start-the-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="d2156-115">For information about starting Replication Monitor, see [Start the Replication Monitor](monitor/start-the-replication-monitor.md).</span></span>  
  
#### <a name="to-create-a-snapshot-in-management-studio"></a><span data-ttu-id="d2156-116">Создание моментального снимка в среде Management Studio</span><span class="sxs-lookup"><span data-stu-id="d2156-116">To create a snapshot in Management Studio</span></span>  
  
1.  <span data-ttu-id="d2156-117">Подключитесь к издателю в среде [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], а затем раскройте узел сервера.</span><span class="sxs-lookup"><span data-stu-id="d2156-117">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="d2156-118">Раскройте папку **Репликация** , а затем папку **Локальные публикации** .</span><span class="sxs-lookup"><span data-stu-id="d2156-118">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="d2156-119">Щелкните правой кнопкой мыши публикацию, для которой нужно создать моментальный снимок, а затем выберите **Просмотреть состояние агента моментальных снимков**.</span><span class="sxs-lookup"><span data-stu-id="d2156-119">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="d2156-120">В диалоговом окне **Просмотр состояния агента моментальных снимков — \<Publication>** нажмите кнопку **Пуск**.</span><span class="sxs-lookup"><span data-stu-id="d2156-120">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
 <span data-ttu-id="d2156-121">Когда агент моментальных снимков закончит создание моментального снимка, на экране появится сообщение: «[100%] Сформирован моментальный снимок 17 статей».</span><span class="sxs-lookup"><span data-stu-id="d2156-121">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-create-a-snapshot-in-replication-monitor"></a><span data-ttu-id="d2156-122">Создание моментального снимка в мониторе репликации</span><span class="sxs-lookup"><span data-stu-id="d2156-122">To create a snapshot in Replication Monitor</span></span>  
  
1.  <span data-ttu-id="d2156-123">В мониторе репликации раскройте группу издателей на левой панели, а затем раскройте нужного издателя.</span><span class="sxs-lookup"><span data-stu-id="d2156-123">In Replication Monitor, expand a Publisher group in the left pane, and then expand a Publisher.</span></span>  
  
2.  <span data-ttu-id="d2156-124">Щелкните правой кнопкой мыши публикацию, для которой нужно создать моментальный снимок, и выберите **Создать моментальный снимок**.</span><span class="sxs-lookup"><span data-stu-id="d2156-124">Right-click the publication for which you want to generate a snapshot, and then click **Generate Snapshot**.</span></span>  
  
3.  <span data-ttu-id="d2156-125">Чтобы просмотреть состояние агента моментальных снимков, перейдите на вкладку **Агенты** . Для получения дополнительных сведений щелкните правой кнопкой мыши агент моментальных снимков в сетке и выберите **Просмотреть сведения**.</span><span class="sxs-lookup"><span data-stu-id="d2156-125">To view the status of the Snapshot Agent, click the **Agents** tab. For more detailed information, right-click the Snapshot Agent in the grid, and then click **View Details**.</span></span>  
  
#### <a name="to-apply-a-snapshot"></a><span data-ttu-id="d2156-126">Применение моментального снимка</span><span class="sxs-lookup"><span data-stu-id="d2156-126">To apply a snapshot</span></span>  
  
1.  <span data-ttu-id="d2156-127">После создания моментальный снимок применяется при синхронизации подписки с помощью агента распространителя или агента слияния:</span><span class="sxs-lookup"><span data-stu-id="d2156-127">After the snapshot is generated, it is applied by synchronizing the subscription with the Distribution Agent or the Merge Agent:</span></span>  
  
    -   <span data-ttu-id="d2156-128">Если агент настроен для постоянной работы (выбор по умолчанию для репликации транзакций), моментальный снимок применяется автоматически после того, как он был создан.</span><span class="sxs-lookup"><span data-stu-id="d2156-128">If the agent is set to run continuously (the default for transactional replication), the snapshot is automatically applied after it is generated.</span></span>  
  
    -   <span data-ttu-id="d2156-129">Если агент настроен для работы по расписанию, моментальный снимок применяется при следующем запланированном запуске агента.</span><span class="sxs-lookup"><span data-stu-id="d2156-129">If the agent is set to run on a schedule, the snapshot is applied the next time the agent is scheduled to run.</span></span>  
  
    -   <span data-ttu-id="d2156-130">Если агент настроен для работы по запросу, моментальный снимок применяется при следующем запуске агента.</span><span class="sxs-lookup"><span data-stu-id="d2156-130">If the agent is set to run on demand, it is applied the next time you run the agent.</span></span>  
  
     <span data-ttu-id="d2156-131">Дополнительные сведения о синхронизации подписок см. в разделах [Synchronize a Push Subscription](synchronize-a-push-subscription.md) и [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="d2156-131">For more information about synchronizing subscriptions, see [Synchronize a Push Subscription](synchronize-a-push-subscription.md) and [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="d2156-132">Использование Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d2156-132">Using Transact-SQL</span></span>  
 <span data-ttu-id="d2156-133">Исходные моментальные снимки можно создавать программно, создавая и запуская задания агента моментальных снимков либо запуская исполняемый файл агента моментальных снимков из пакетного файла.</span><span class="sxs-lookup"><span data-stu-id="d2156-133">Initial snapshots can be programmatically created either by creating and running a Snapshot Agent job or by running the Snapshot Agent executable file from a batch file.</span></span> <span data-ttu-id="d2156-134">После создания исходный моментальный снимок передается на подписчик и применяется при первой синхронизации подписки.</span><span class="sxs-lookup"><span data-stu-id="d2156-134">After an initial snapshot has been generated, it is transferred to and applied at the Subscriber when the subscription is first synchronized.</span></span> <span data-ttu-id="d2156-135">Если агент моментальных снимков запускается из командной строки или пакетного файла, потребуется повторно запустить агент, когда существующий моментальный снимок станет недействительным.</span><span class="sxs-lookup"><span data-stu-id="d2156-135">If you run the Snapshot Agent from a command prompt or a batch file, you will need to rerun the agent whenever the existing snapshot becomes invalid.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d2156-136">По возможности предлагайте пользователям вводить учетные данные системы безопасности во время выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="d2156-136">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="d2156-137">В случае необходимости хранения учетных данных в файле скрипта этот файл следует защищать во избежание несанкционированного доступа.</span><span class="sxs-lookup"><span data-stu-id="d2156-137">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-and-run-a-snapshot-agent-job-to-generate-the-initial-snapshot"></a><span data-ttu-id="d2156-138">Создание и запуск задания агента моментальных снимков для формирования исходного моментального снимка</span><span class="sxs-lookup"><span data-stu-id="d2156-138">To create and run a Snapshot Agent job to generate the initial snapshot</span></span>  
  
1.  <span data-ttu-id="d2156-139">Создайте моментальный снимок, публикацию слиянием или публикацию транзакций.</span><span class="sxs-lookup"><span data-stu-id="d2156-139">Create a snapshot, transactional, or merge publication.</span></span> <span data-ttu-id="d2156-140">Дополнительные сведения см. в разделе [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="d2156-140">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="d2156-141">Выполните хранимую процедуру [sp_addpublication_snapshot (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d2156-141">Execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="d2156-142">Укажите **@publication** и следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="d2156-142">Specify **@publication** and the following parameters:</span></span>  
  
    -   <span data-ttu-id="d2156-143">**@job_login — указывает** учетные данные для проверки подлинности Windows, под которыми запускается агент моментальных снимков на распространителе.</span><span class="sxs-lookup"><span data-stu-id="d2156-143">**The @job_login, which specifies** the Windows Authentication credentials under which the Snapshot Agent runs at the Distributor.</span></span>  
  
    -   <span data-ttu-id="d2156-144">**@job_password** — пароль для указанных учетных данных Windows.</span><span class="sxs-lookup"><span data-stu-id="d2156-144">**The @job_password**, which is the password for the supplied Windows credentials.</span></span>  
  
    -   <span data-ttu-id="d2156-145">(Необязательно) Значение **0** в параметре **@publisher_security_mode** , если агент при соединении с издателем будет использовать проверку подлинности SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d2156-145">(Optional) A value of **0** for **@publisher_security_mode** if the agent will use SQL Server Authentication when connecting to the Publisher.</span></span> <span data-ttu-id="d2156-146">В этом случае необходимо также указать сведения об имени входа для проверки подлинности SQL Server для **@publisher_login** и **@publisher_password** .</span><span class="sxs-lookup"><span data-stu-id="d2156-146">In this case, you must also specify the SQL Server Authentication login information for **@publisher_login** and **@publisher_password**.</span></span>  
  
    -   <span data-ttu-id="d2156-147">(Необязательно) Расписание синхронизации для задания агента моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="d2156-147">(Optional) A synchronization schedule for the Snapshot Agent job.</span></span> <span data-ttu-id="d2156-148">Дополнительные сведения см. в статье [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="d2156-148">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d2156-149">Если издатель настраивается с удаленным распространителем, то значения, передаваемые для всех аргументов, включая *job_login* и *job_password*, передаются распространителю в формате обычного (незашифрованного) текста.</span><span class="sxs-lookup"><span data-stu-id="d2156-149">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="d2156-150">Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="d2156-150">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="d2156-151">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="d2156-151">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="d2156-152">Добавьте статьи к публикации.</span><span class="sxs-lookup"><span data-stu-id="d2156-152">Add articles to the publication.</span></span> <span data-ttu-id="d2156-153">Дополнительные сведения см. в статье [определить статью](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="d2156-153">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
4.  <span data-ttu-id="d2156-154">На издателе в базе данных публикации выполните хранимую процедуру [sp_startpublication_snapshot (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-startpublication-snapshot-transact-sql), указав в параметре **@publication** значение из шага 1.</span><span class="sxs-lookup"><span data-stu-id="d2156-154">At the Publisher on the publication database, execute [sp_startpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-startpublication-snapshot-transact-sql), specifying the value of **@publication** from step 1.</span></span>  
  
#### <a name="to-run-the-snapshot-agent-to-generate-the-initial-snapshot"></a><span data-ttu-id="d2156-155">Запуск агента моментальных снимков для формирования исходного моментального снимка</span><span class="sxs-lookup"><span data-stu-id="d2156-155">To run the Snapshot Agent to generate the initial snapshot</span></span>  
  
1.  <span data-ttu-id="d2156-156">Создайте моментальный снимок, публикацию слиянием или публикацию транзакций.</span><span class="sxs-lookup"><span data-stu-id="d2156-156">Create a snapshot, transactional, or merge publication.</span></span> <span data-ttu-id="d2156-157">Дополнительные сведения см. в разделе [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="d2156-157">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="d2156-158">Добавьте статьи к публикации.</span><span class="sxs-lookup"><span data-stu-id="d2156-158">Add articles to the publication.</span></span> <span data-ttu-id="d2156-159">Дополнительные сведения см. в статье [определить статью](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="d2156-159">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="d2156-160">Из командной строки или из пакетного файла запустите [агент слияния репликации](agents/replication-snapshot-agent.md) , вызвав программу **snapshot.exe**со следующими параметрами командной строки.</span><span class="sxs-lookup"><span data-stu-id="d2156-160">From the command prompt or in a batch file, start the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) by running **snapshot.exe**, specifying the following command-line arguments:</span></span>  
  
    -   <span data-ttu-id="d2156-161">**-Publication**</span><span class="sxs-lookup"><span data-stu-id="d2156-161">**-Publication**</span></span>  
  
    -   <span data-ttu-id="d2156-162">**-Publisher**</span><span class="sxs-lookup"><span data-stu-id="d2156-162">**-Publisher**</span></span>  
  
    -   <span data-ttu-id="d2156-163">**-Distributor**</span><span class="sxs-lookup"><span data-stu-id="d2156-163">**-Distributor**</span></span>  
  
    -   <span data-ttu-id="d2156-164">**-PublisherDB**</span><span class="sxs-lookup"><span data-stu-id="d2156-164">**-PublisherDB**</span></span>  
  
    -   <span data-ttu-id="d2156-165">**-ReplicationType**</span><span class="sxs-lookup"><span data-stu-id="d2156-165">**-ReplicationType**</span></span>  
  
     <span data-ttu-id="d2156-166">При использовании проверки подлинности SQL Server необходимо также указать следующие аргументы.</span><span class="sxs-lookup"><span data-stu-id="d2156-166">If you are using SQL Server Authentication, you must also specify the following arguments:</span></span>  
  
    -   <span data-ttu-id="d2156-167">**-DistributorLogin**</span><span class="sxs-lookup"><span data-stu-id="d2156-167">**-DistributorLogin**</span></span>  
  
    -   <span data-ttu-id="d2156-168">**-DistributorPassword**</span><span class="sxs-lookup"><span data-stu-id="d2156-168">**-DistributorPassword**</span></span>  
  
    -   <span data-ttu-id="d2156-169">**-DistributorSecurityMode** = **0**</span><span class="sxs-lookup"><span data-stu-id="d2156-169">**-DistributorSecurityMode** = **0**</span></span>  
  
    -   <span data-ttu-id="d2156-170">**-PublisherLogin**</span><span class="sxs-lookup"><span data-stu-id="d2156-170">**-PublisherLogin**</span></span>  
  
    -   <span data-ttu-id="d2156-171">**-PublisherPassword**</span><span class="sxs-lookup"><span data-stu-id="d2156-171">**-PublisherPassword**</span></span>  
  
    -   <span data-ttu-id="d2156-172">**-PublisherSecurityMode** = **0**</span><span class="sxs-lookup"><span data-stu-id="d2156-172">**-PublisherSecurityMode** = **0**</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="d2156-173">Примеры (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="d2156-173">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="d2156-174">В этом примере показано, как создавать публикации транзакций и добавлять задания агента моментальных снимков к новым публикациям (с помощью переменных скрипта **sqlcmd** ).</span><span class="sxs-lookup"><span data-stu-id="d2156-174">This example shows how to create a transactional publication and add a Snapshot Agent job for the new publication (using **sqlcmd** scripting variables).</span></span> <span data-ttu-id="d2156-175">В примере также запускается задание.</span><span class="sxs-lookup"><span data-stu-id="d2156-175">The example also starts the job.</span></span>  
  
 [!code-sql[HowTo#sp_trangenerate_snapshot](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpubinitialsnapshot.sql#sp_trangenerate_snapshot)]  
  
 <span data-ttu-id="d2156-176">В этом примере создается публикация слиянием, к которой добавляется задание агента моментальных снимков (с помощью переменных **sqlcmd** ).</span><span class="sxs-lookup"><span data-stu-id="d2156-176">This example creates a merge publication and adds a Snapshot Agent job (using **sqlcmd** variables) for the publication.</span></span> <span data-ttu-id="d2156-177">В этом примере также запускается задание.</span><span class="sxs-lookup"><span data-stu-id="d2156-177">This example also starts the job.</span></span>  
  
 [!code-sql[HowTo#sp_mergegenerate_snapshot](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubinitialsnapshot.sql#sp_mergegenerate_snapshot)]  
  
 <span data-ttu-id="d2156-178">Следующие параметры командной строки запускают агент моментальных снимков для формирования моментальных снимков для публикации слиянием.</span><span class="sxs-lookup"><span data-stu-id="d2156-178">The following command-line arguments start the Snapshot Agent to generate the snapshot for a merge publication.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d2156-179">Пример разбит на строки для удобства чтения.</span><span class="sxs-lookup"><span data-stu-id="d2156-179">Line breaks were added to improve readability.</span></span> <span data-ttu-id="d2156-180">В пакетном файле команды необходимо вводить в одной строке.</span><span class="sxs-lookup"><span data-stu-id="d2156-180">In a batch file, commands must be made in a single line.</span></span>  
  
 [!code-sql[HowTo#startmergesnapshot_10](../../snippets/tsql/SQL15/replication/howto/tsql/createmergesnapshot_10.bat)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="d2156-181">При помощи объектов RMO</span><span class="sxs-lookup"><span data-stu-id="d2156-181">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="d2156-182">После создания публикации агент моментальных снимков создает моментальный снимок.</span><span class="sxs-lookup"><span data-stu-id="d2156-182">The Snapshot Agent generates snapshots after a publication is created.</span></span> <span data-ttu-id="d2156-183">Создание моментального снимка и прямой доступ из управляемого кода к функциям агента репликации могут производиться программным путем с помощью объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="d2156-183">You can generate these snapshots programmatically by using Replication Management Objects (RMO) and direct managed code access to replication agent functionalities.</span></span> <span data-ttu-id="d2156-184">Какие именно объекты при этом применяются, зависит от типа репликации.</span><span class="sxs-lookup"><span data-stu-id="d2156-184">The objects you use depend on the type of replication.</span></span> <span data-ttu-id="d2156-185">Агент моментальных снимков может быть запущен как синхронно с помощью объекта <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> , так и в асинхронном режиме из задания агента.</span><span class="sxs-lookup"><span data-stu-id="d2156-185">The Snapshot Agent can be started synchronously using the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> object or asynchronously using the agent job.</span></span> <span data-ttu-id="d2156-186">После создания исходного моментального снимка он передается на сервер подписчика и применяется при первом сеансе синхронизации подписки.</span><span class="sxs-lookup"><span data-stu-id="d2156-186">After the initial snapshot has been generated, it is transferred to and applied at the Subscriber when the subscription is first synchronized.</span></span> <span data-ttu-id="d2156-187">Когда данные в существующем моментальном снимке устарели, соответствующий ему агент должен быть запущен повторно.</span><span class="sxs-lookup"><span data-stu-id="d2156-187">You will need to rerun the agent whenever the existing snapshot no longer contains valid, up-to-date data.</span></span> <span data-ttu-id="d2156-188">Дополнительные сведения см. в статье [Обслуживание публикаций](publish/maintain-publications.md).</span><span class="sxs-lookup"><span data-stu-id="d2156-188">For more information, see [Maintain Publications](publish/maintain-publications.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d2156-189">По возможности предлагайте пользователям вводить учетные данные системы безопасности во время выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="d2156-189">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="d2156-190">Если необходимо хранить учетные данные, используйте [службы шифрования](https://go.microsoft.com/fwlink/?LinkId=34733) , предоставляемые платформой [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d2156-190">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-snapshot-or-transactional-publication-by-starting-the-snapshot-agent-job-asynchronous"></a><span data-ttu-id="d2156-191">Создание исходного моментального снимка для публикации транзакций или моментальных снимков из задания агента моментальных снимков (в асинхронном режиме)</span><span class="sxs-lookup"><span data-stu-id="d2156-191">To generate the initial snapshot for a snapshot or transactional publication by starting the Snapshot Agent job (asynchronous)</span></span>  
  
1.  <span data-ttu-id="d2156-192">Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="d2156-192">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="d2156-193">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.TransPublication>.</span><span class="sxs-lookup"><span data-stu-id="d2156-193">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class.</span></span> <span data-ttu-id="d2156-194">Задайте для публикации свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> и <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> , а также установите созданное на шаге 1 соединение <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> в качестве значения для свойства.</span><span class="sxs-lookup"><span data-stu-id="d2156-194">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
3.  <span data-ttu-id="d2156-195">Вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> , чтобы загрузить оставшиеся свойства объекта.</span><span class="sxs-lookup"><span data-stu-id="d2156-195">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to load the remaining properties of the object.</span></span> <span data-ttu-id="d2156-196">Если этот метод возвращает `false`, то либо на шаге 2 были неверно определены свойства публикации, либо публикация не существует.</span><span class="sxs-lookup"><span data-stu-id="d2156-196">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>  
  
4.  <span data-ttu-id="d2156-197">Если значение <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> равно `false`, то для создания задания агента моментальных снимков для этой публикации вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A>.</span><span class="sxs-lookup"><span data-stu-id="d2156-197">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
5.  <span data-ttu-id="d2156-198">Вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> , чтобы запустить задание агента, которое создает моментальный снимок для этой публикации.</span><span class="sxs-lookup"><span data-stu-id="d2156-198">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method to start the agent job that generates the snapshot for this publication.</span></span>  
  
6.  <span data-ttu-id="d2156-199">Если параметр <xref:Microsoft.SqlServer.Replication.TransPublication.SnapshotAvailable%2A> имеет значение `true`, моментальный снимок доступен для подписчиков (необязательно).</span><span class="sxs-lookup"><span data-stu-id="d2156-199">(Optional) When the value of <xref:Microsoft.SqlServer.Replication.TransPublication.SnapshotAvailable%2A> is `true`, the snapshot is available to Subscribers.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-snapshot-or-transactional-publication-by-running-the-snapshot-agent-synchronous"></a><span data-ttu-id="d2156-200">Создание исходного моментального снимка для публикации транзакций или моментальных снимков запуском агента моментальных снимков (в синхронном режиме)</span><span class="sxs-lookup"><span data-stu-id="d2156-200">To generate the initial snapshot for a snapshot or transactional publication by running the Snapshot Agent (synchronous)</span></span>  
  
1.  <span data-ttu-id="d2156-201">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> и укажите следующие необходимые свойства.</span><span class="sxs-lookup"><span data-stu-id="d2156-201">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="d2156-202"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> — имя издателя.</span><span class="sxs-lookup"><span data-stu-id="d2156-202"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="d2156-203"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> — имя базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="d2156-203"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="d2156-204"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> — имя публикации.</span><span class="sxs-lookup"><span data-stu-id="d2156-204"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="d2156-205"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> — имя распространителя.</span><span class="sxs-lookup"><span data-stu-id="d2156-205"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="d2156-206"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> — значение параметра <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> , чтобы использовать проверку подлинности Windows для соединения с издателем, или значение <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> и значения параметров <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> и <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> , чтобы использовать проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для соединения с издателем.</span><span class="sxs-lookup"><span data-stu-id="d2156-206"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Publisher or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher.</span></span> <span data-ttu-id="d2156-207">Рекомендуется использовать проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="d2156-207">Windows Authentication is recommended.</span></span>  
  
    -   <span data-ttu-id="d2156-208"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> — значение параметра <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> , чтобы использовать проверку подлинности Windows для соединения с распространителем, или значение <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> и значения параметров <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> и <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> , чтобы использовать проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для соединения с распространителем.</span><span class="sxs-lookup"><span data-stu-id="d2156-208"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Distributor or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span> <span data-ttu-id="d2156-209">Рекомендуется использовать проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="d2156-209">Windows Authentication is recommended.</span></span>  
  
2.  <span data-ttu-id="d2156-210">Укажите значение <xref:Microsoft.SqlServer.Replication.ReplicationType.Transactional> или <xref:Microsoft.SqlServer.Replication.ReplicationType.Snapshot> в параметре <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span><span class="sxs-lookup"><span data-stu-id="d2156-210">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Transactional> or <xref:Microsoft.SqlServer.Replication.ReplicationType.Snapshot> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
3.  <span data-ttu-id="d2156-211">Вызовите метод <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> .</span><span class="sxs-lookup"><span data-stu-id="d2156-211">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-merge-publication-by-starting-the-snapshot-agent-job-asynchronous"></a><span data-ttu-id="d2156-212">Создание исходного моментального снимка для публикации слиянием из задания агента моментальных снимков (в асинхронном режиме)</span><span class="sxs-lookup"><span data-stu-id="d2156-212">To generate the initial snapshot for a merge publication by starting the Snapshot Agent job (asynchronous)</span></span>  
  
1.  <span data-ttu-id="d2156-213">Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="d2156-213">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="d2156-214">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePublication>.</span><span class="sxs-lookup"><span data-stu-id="d2156-214">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class.</span></span> <span data-ttu-id="d2156-215">Задайте для публикации свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> и <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> , а также установите созданное на шаге 1 соединение <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> в качестве значения для свойства.</span><span class="sxs-lookup"><span data-stu-id="d2156-215">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
3.  <span data-ttu-id="d2156-216">Вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> , чтобы загрузить оставшиеся свойства объекта.</span><span class="sxs-lookup"><span data-stu-id="d2156-216">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to load the remaining properties of the object.</span></span> <span data-ttu-id="d2156-217">Если этот метод возвращает `false`, то либо на шаге 2 были неверно определены свойства публикации, либо публикация не существует.</span><span class="sxs-lookup"><span data-stu-id="d2156-217">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>  
  
4.  <span data-ttu-id="d2156-218">Если значение <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> равно `false`, то для создания задания агента моментальных снимков для этой публикации вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A>.</span><span class="sxs-lookup"><span data-stu-id="d2156-218">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
5.  <span data-ttu-id="d2156-219">Вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> , чтобы запустить задание агента, которое создает моментальный снимок для этой публикации.</span><span class="sxs-lookup"><span data-stu-id="d2156-219">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method to start the agent job that generates the snapshot for this publication.</span></span>  
  
6.  <span data-ttu-id="d2156-220">Если параметр <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> имеет значение `true`, моментальный снимок доступен для подписчиков (необязательно).</span><span class="sxs-lookup"><span data-stu-id="d2156-220">(Optional) When the value of <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> is `true`, the snapshot is available to Subscribers.</span></span>  
  
#### <a name="to-generate-the-initial-snapshot-for-a-merge-publication-by-running-the-snapshot-agent-synchronous"></a><span data-ttu-id="d2156-221">Создание исходного моментального снимка для публикации слиянием запуском агента моментальных снимков (в синхронном режиме)</span><span class="sxs-lookup"><span data-stu-id="d2156-221">To generate the initial snapshot for a merge publication by running the Snapshot Agent (synchronous)</span></span>  
  
1.  <span data-ttu-id="d2156-222">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> и укажите следующие необходимые свойства.</span><span class="sxs-lookup"><span data-stu-id="d2156-222">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="d2156-223"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> — имя издателя.</span><span class="sxs-lookup"><span data-stu-id="d2156-223"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="d2156-224"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> — имя базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="d2156-224"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="d2156-225"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> — имя публикации.</span><span class="sxs-lookup"><span data-stu-id="d2156-225"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="d2156-226"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> — имя распространителя.</span><span class="sxs-lookup"><span data-stu-id="d2156-226"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="d2156-227"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> — значение параметра <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> , чтобы использовать проверку подлинности Windows для соединения с издателем, или значение <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> и значения параметров <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> и <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> , чтобы использовать проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для соединения с издателем.</span><span class="sxs-lookup"><span data-stu-id="d2156-227"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Publisher or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher.</span></span> <span data-ttu-id="d2156-228">Рекомендуется использовать проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="d2156-228">Windows Authentication is recommended.</span></span>  
  
    -   <span data-ttu-id="d2156-229"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> — значение параметра <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> , чтобы использовать проверку подлинности Windows для соединения с распространителем, или значение <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> и значения параметров <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> и <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> , чтобы использовать проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для соединения с распространителем.</span><span class="sxs-lookup"><span data-stu-id="d2156-229"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Distributor or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span> <span data-ttu-id="d2156-230">Рекомендуется использовать проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="d2156-230">Windows Authentication is recommended.</span></span>  
  
2.  <span data-ttu-id="d2156-231">Укажите значение <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> в параметре <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span><span class="sxs-lookup"><span data-stu-id="d2156-231">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
3.  <span data-ttu-id="d2156-232">Вызовите метод <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> .</span><span class="sxs-lookup"><span data-stu-id="d2156-232">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="d2156-233">Примеры (объекты RMO)</span><span class="sxs-lookup"><span data-stu-id="d2156-233">Examples (RMO)</span></span>  
 <span data-ttu-id="d2156-234">В следующем примере производится синхронный запуск агента моментальных снимков, который создает исходный моментальный снимок публикации транзакций.</span><span class="sxs-lookup"><span data-stu-id="d2156-234">This example synchronously runs the Snapshot Agent to generate the initial snapshot for a transactional publication.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatesnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatesnapshot)]  
  
 <span data-ttu-id="d2156-235">В следующем примере производится асинхронный запуск задания агента моментальных снимков, который создает исходный моментальный снимок публикации транзакций.</span><span class="sxs-lookup"><span data-stu-id="d2156-235">This example asynchronously starts the agent job to generate the initial snapshot for a transactional publication.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateSnapshot_WithJob](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatesnapshot_withjob)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateSnapshot_WithJob](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatesnapshot_withjob)]  
  
## <a name="see-also"></a><span data-ttu-id="d2156-236">См. также:</span><span class="sxs-lookup"><span data-stu-id="d2156-236">See Also</span></span>  
 <span data-ttu-id="d2156-237">[Create a Publication](publish/create-a-publication.md) </span><span class="sxs-lookup"><span data-stu-id="d2156-237">[Create a Publication](publish/create-a-publication.md) </span></span>  
 <span data-ttu-id="d2156-238">[Create a Pull Subscription](create-a-pull-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="d2156-238">[Create a Pull Subscription](create-a-pull-subscription.md) </span></span>  
 <span data-ttu-id="d2156-239">[Create a Push Subscription](create-a-push-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="d2156-239">[Create a Push Subscription](create-a-push-subscription.md) </span></span>  
 <span data-ttu-id="d2156-240">[Specify Synchronization Schedules](specify-synchronization-schedules.md) </span><span class="sxs-lookup"><span data-stu-id="d2156-240">[Specify Synchronization Schedules](specify-synchronization-schedules.md) </span></span>  
 <span data-ttu-id="d2156-241">[Создание и применение моментального снимка](create-and-apply-the-snapshot.md) </span><span class="sxs-lookup"><span data-stu-id="d2156-241">[Create and Apply the Snapshot](create-and-apply-the-snapshot.md) </span></span>  
 <span data-ttu-id="d2156-242">[Инициализация подписки с помощью моментального снимка](initialize-a-subscription-with-a-snapshot.md) </span><span class="sxs-lookup"><span data-stu-id="d2156-242">[Initialize a Subscription with a Snapshot](initialize-a-subscription-with-a-snapshot.md) </span></span>  
 <span data-ttu-id="d2156-243">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="d2156-243">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="d2156-244">[Replication Security Best Practices](security/replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="d2156-244">[Replication Security Best Practices](security/replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="d2156-245">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="d2156-245">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 [<span data-ttu-id="d2156-246">Использование программы sqlcmd с переменными скрипта</span><span class="sxs-lookup"><span data-stu-id="d2156-246">Use sqlcmd with Scripting Variables</span></span>](../scripting/sqlcmd-use-with-scripting-variables.md)  
  
  
