---
title: Определение связи логических записей между статьями таблиц слияния | Документация Майкрософт
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- merge replication logical records [SQL Server replication]
- articles [SQL Server replication], logical records
- logical records [SQL Server replication]
ms.assetid: ff847b3a-c6b0-4eaf-b225-2ffc899c5558
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 60c92a237562704e5bc5d43717f863aa78a14b55
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750684"
---
# <a name="define-a-logical-record-relationship-between-merge-table-articles"></a><span data-ttu-id="83274-102">Определение связи логических записей между статьями таблиц слияния</span><span class="sxs-lookup"><span data-stu-id="83274-102">Define a Logical Record Relationship Between Merge Table Articles</span></span>
  <span data-ttu-id="83274-103">В данном разделе описывается процесс определения связи логических записей между статьями таблиц слияния в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)]или объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="83274-103">This topic describes how to define a logical record relationship between merge table articles in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
 <span data-ttu-id="83274-104">Репликация слиянием позволяет определить связь между связанными строками в различных таблицах.</span><span class="sxs-lookup"><span data-stu-id="83274-104">Merge replication allows you to define a relationship between related rows in different tables.</span></span> <span data-ttu-id="83274-105">Эти строки затем могут быть обработаны во время синхронизации как элементы транзакции.</span><span class="sxs-lookup"><span data-stu-id="83274-105">These rows can then be processed as a transactional unit during synchronization.</span></span> <span data-ttu-id="83274-106">Логическая запись может быть определена между двумя статьями независимо от наличия связи фильтров соединения между ними.</span><span class="sxs-lookup"><span data-stu-id="83274-106">A logical record can be defined between two articles whether or not they have a join filter relationship.</span></span> <span data-ttu-id="83274-107">Дополнительные сведения см. в статье [Группирование изменений в связанных строках с помощью логических записей](../merge/group-changes-to-related-rows-with-logical-records.md).</span><span class="sxs-lookup"><span data-stu-id="83274-107">For more information, see [Group Changes to Related Rows with Logical Records](../merge/group-changes-to-related-rows-with-logical-records.md).</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../../includes/ssnotedepfutureavoid-md.md)]  
  
 <span data-ttu-id="83274-108">**В этом разделе**</span><span class="sxs-lookup"><span data-stu-id="83274-108">**In This Topic**</span></span>  
  
-   <span data-ttu-id="83274-109">**Перед началом работы**</span><span class="sxs-lookup"><span data-stu-id="83274-109">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="83274-110">Ограничения</span><span class="sxs-lookup"><span data-stu-id="83274-110">Limitations and Restrictions</span></span>](#Restrictions)  
  
-   <span data-ttu-id="83274-111">**Для определения связи логических записей между статьями таблиц слияния используется:**</span><span class="sxs-lookup"><span data-stu-id="83274-111">**To define a logical record relationship between merge table articles, using:**</span></span>  
  
     [<span data-ttu-id="83274-112">Среда SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="83274-112">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="83274-113">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="83274-113">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="83274-114">объекты RMO;</span><span class="sxs-lookup"><span data-stu-id="83274-114">Replication Management Objects (RMO)</span></span>](#RMOProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="83274-115">Перед началом</span><span class="sxs-lookup"><span data-stu-id="83274-115">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="83274-116">Ограничения</span><span class="sxs-lookup"><span data-stu-id="83274-116">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="83274-117">Если добавление, изменение или удаление логической записи выполняется после инициализации подписок на публикацию, следует создать новый моментальный снимок и повторно инициализировать все подписки после внесения изменений.</span><span class="sxs-lookup"><span data-stu-id="83274-117">If you add, modify, or delete a logical record after subscriptions to the publication have been initialized, you must generate a new snapshot and reinitialize all subscriptions after making the change.</span></span> <span data-ttu-id="83274-118">Дополнительные сведения о требованиях к изменениям свойств см. в статье [Изменение свойств публикации и статьи](change-publication-and-article-properties.md).</span><span class="sxs-lookup"><span data-stu-id="83274-118">For more information about requirements for property changes, see [Change Publication and Article Properties](change-publication-and-article-properties.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="83274-119">Использование среды SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="83274-119">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="83274-120">Определите логические записи в диалоговом окне **Добавить соединение**, которое доступно в мастере создания публикаций и диалоговом окне **Свойства публикации — \<Publication>публикация >** .</span><span class="sxs-lookup"><span data-stu-id="83274-120">Define logical records in the **Add Join** dialog box, which is available in the New Publication Wizard and the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="83274-121">Дополнительные сведения об использовании мастера и доступе к этому диалоговому окну см. в статьях [Создание публикации](create-a-publication.md) и [Просмотр и изменение свойств публикации](view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="83274-121">For more information about using the wizard and accessing the dialog box, see [Create a Publication](create-a-publication.md) and [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
 <span data-ttu-id="83274-122">Логические записи могут определяться в диалоговом окне **Добавление соединения** , только если они применяются к фильтру соединения в публикации слиянием и если публикация соответствует требованиям для использования предварительно вычисляемых секций.</span><span class="sxs-lookup"><span data-stu-id="83274-122">Logical records can be defined in the **Add Join** dialog box only if they are applied to a join filter in a merge publication, and the publication follows the requirements for using precomputed partitions.</span></span> <span data-ttu-id="83274-123">Чтобы определить логические записи, которые не применяются к фильтрам соединения, и чтобы установить обнаружение и разрешение конфликтов на уровне логических записей, следует использовать хранимые процедуры.</span><span class="sxs-lookup"><span data-stu-id="83274-123">To define logical records that are not applied to join filters and to set conflict detection and resolution at the logical record level, you must use stored procedures.</span></span>  
  
#### <a name="to-define-a-logical-record-relationship"></a><span data-ttu-id="83274-124">Определение связи логических записей</span><span class="sxs-lookup"><span data-stu-id="83274-124">To define a logical record relationship</span></span>  
  
1.  <span data-ttu-id="83274-125">На странице **Фильтрация строк** таблицы мастера создания публикаций или странице **Фильтрация строк** диалогового окна **Свойства публикации — \<Publication>** выберите фильтр строк в области **Отфильтрованные таблицы**.</span><span class="sxs-lookup"><span data-stu-id="83274-125">On the **Filter Table Rows** page of the New Publication Wizard or the **Filter Rows** page of the **Publication Properties - \<Publication>** dialog box, select a row filter in the **Filtered Tables** pane.</span></span>  
  
     <span data-ttu-id="83274-126">Связь логических записей ассоциирована с фильтром соединения, который расширяет фильтр строк.</span><span class="sxs-lookup"><span data-stu-id="83274-126">A logical record relationship is associated with a join filter, which extends a row filter.</span></span> <span data-ttu-id="83274-127">Поэтому необходимо определить фильтр строк, прежде чем можно будет расширить фильтр с помощью фильтра соединения и применить связь логических записей.</span><span class="sxs-lookup"><span data-stu-id="83274-127">Therefore you must define a row filter before you can extend the filter with a join and apply a logical record relationship.</span></span> <span data-ttu-id="83274-128">После того как определен один фильтр соединения, можно расширить этот фильтр соединения с помощью еще одного фильтра соединения.</span><span class="sxs-lookup"><span data-stu-id="83274-128">After one join filter is defined, you can extend this join filter with another join filter.</span></span> <span data-ttu-id="83274-129">Дополнительные сведения об определении фильтров соединения см. в разделе [Определение и изменение фильтра соединения между статьями публикации слиянием](define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="83274-129">For more information about defining join filters, see [Define and Modify a Join Filter Between Merge Articles](define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
2.  <span data-ttu-id="83274-130">Щелкните **Добавить**и выберите **Добавить соединение для расширения выбранного фильтра**.</span><span class="sxs-lookup"><span data-stu-id="83274-130">Click **Add**, and then click **Add Join to Extend the Selected Filter**.</span></span>  
  
3.  <span data-ttu-id="83274-131">Определите фильтр соединения в диалоговом окне **Добавление соединения** , а затем установите флажок **Логическая запись**.</span><span class="sxs-lookup"><span data-stu-id="83274-131">Define a join filter in the **Add Join** dialog box, and then select the check box **Logical Record**.</span></span>  
  
4.  <span data-ttu-id="83274-132">Если вы находитесь в диалоговом окне **Свойства публикации — \<Publication>** , нажмите кнопку **OK**, чтобы сохранить результаты и закрыть диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="83274-132">If you are in the **Publication Properties - \<Publication>** dialog box, click **OK** to save and close the dialog box.</span></span>  
  
#### <a name="to-delete-a-logical-record-relationship"></a><span data-ttu-id="83274-133">Удаление связи логических записей</span><span class="sxs-lookup"><span data-stu-id="83274-133">To delete a logical record relationship</span></span>  
  
-   <span data-ttu-id="83274-134">Удалите лишь связь логических записей или удалите и связь логических записей, и ассоциированный с ней фильтр соединения.</span><span class="sxs-lookup"><span data-stu-id="83274-134">Delete only the logical record relationship or delete the logical record relationship and the join filter associated with it.</span></span>  
  
     <span data-ttu-id="83274-135">Чтобы удалить только связь логических записей.</span><span class="sxs-lookup"><span data-stu-id="83274-135">To delete only the logical record relationship:</span></span>  
  
    1.  <span data-ttu-id="83274-136">На странице **Фильтрация строк** мастера создания публикаций или странице **Фильтрация строк** диалогового окна **Свойства публикации — \<Publication>** выберите фильтр соединения, связанный с отношением логической записи, в области **Отфильтрованные таблицы**, а затем нажмите кнопку **Изменить**.</span><span class="sxs-lookup"><span data-stu-id="83274-136">On the **Filter Rows** page of the New Publication Wizard or the **Filter Rows** page of the **Publication Properties - \<Publication>** dialog box, select the join filter associated with the logical record relationship in the **Filtered Tables** pane, and then click **Edit**.</span></span>  
  
    2.  <span data-ttu-id="83274-137">В диалоговом окне **Изменить соединение** снимите флажок **Логическая запись**.</span><span class="sxs-lookup"><span data-stu-id="83274-137">In the **Edit Join** dialog box, clear the check box **Logical Record**.</span></span>  
  
    3.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
     <span data-ttu-id="83274-138">Чтобы удалить связь логических записей и фильтр соединения, ассоциированный с этой связью, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="83274-138">To delete the logical record relationship and join filter associated with it:</span></span>  
  
    -   <span data-ttu-id="83274-139">На странице **Фильтрация строк** мастера создания публикаций или в диалоговом окне **Свойства публикации — \<Publication>** выберите фильтр в области **Отфильтрованные таблицы**, а затем нажмите кнопку **Удалить**.</span><span class="sxs-lookup"><span data-stu-id="83274-139">On the **Filter Rows** page of the New Publication Wizard or **Publication Properties - \<Publication>** dialog box, select a filter in the **Filtered Tables** pane, and then click **Delete**.</span></span> <span data-ttu-id="83274-140">Если удаляемый фильтр соединения расширен за счет других фильтров, эти фильтры также будут удалены.</span><span class="sxs-lookup"><span data-stu-id="83274-140">If the join filter you delete is itself extended by other joins, those joins will also be deleted.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="83274-141">Использование Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="83274-141">Using Transact-SQL</span></span>  
 <span data-ttu-id="83274-142">С помощью хранимых процедур репликации можно программно задать связь логических записей между статьями.</span><span class="sxs-lookup"><span data-stu-id="83274-142">You can programmatically specify logical record relationships between articles using replication stored procedures.</span></span>  
  
#### <a name="to-define-a-logical-record-relationship-without-an-associated-join-filter"></a><span data-ttu-id="83274-143">Определение связи логических записей без сопутствующего фильтра соединения</span><span class="sxs-lookup"><span data-stu-id="83274-143">To define a logical record relationship without an associated join filter</span></span>  
  
1.  <span data-ttu-id="83274-144">Если публикация содержит фильтруемые статьи, выполните хранимую процедуру [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql)и проверьте значение параметра **use_partition_groups** в результирующем наборе.</span><span class="sxs-lookup"><span data-stu-id="83274-144">If the publication contains any articles that are filtered, execute [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), and note the value of **use_partition_groups** in the result set.</span></span>  
  
    -   <span data-ttu-id="83274-145">Если значение равно **1**, то предварительно вычисляемые секции уже используются.</span><span class="sxs-lookup"><span data-stu-id="83274-145">If the value is **1**, then precomputed partitions are already being used.</span></span>  
  
    -   <span data-ttu-id="83274-146">Если значение равно **0**, выполните хранимую процедуру [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) на издателе в базе данных публикации.</span><span class="sxs-lookup"><span data-stu-id="83274-146">If the value is **0**, then execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="83274-147">Задайте **use_partition_groups** в качестве значения параметра **@property** и **true** в качестве значения параметра **@value**.</span><span class="sxs-lookup"><span data-stu-id="83274-147">Specify a value of **use_partition_groups** for **@property** and a value of **true** for **@value**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="83274-148">Если публикация не поддерживает предварительно вычисляемые секции, то логические записи использовать нельзя.</span><span class="sxs-lookup"><span data-stu-id="83274-148">If the publication does not support precomputed partitions, then logical records cannot be used.</span></span> <span data-ttu-id="83274-149">Дополнительные сведения см. в статье [Оптимизация производительности параметризованного фильтра с помощью предварительно вычисляемых секций](../merge/parameterized-filters-optimize-for-precomputed-partitions.md).</span><span class="sxs-lookup"><span data-stu-id="83274-149">For more information, see Requirements for Using Precomputed Partitions in the topic [Optimize Parameterized Filter Performance with Precomputed Partitions](../merge/parameterized-filters-optimize-for-precomputed-partitions.md).</span></span>  
  
    -   <span data-ttu-id="83274-150">Если это значение NULL, то необходимо запустить агент моментальных снимков для создания исходного моментального снимка для публикации.</span><span class="sxs-lookup"><span data-stu-id="83274-150">If the value is NULL, then the Snapshot Agent needs to be run to generate the initial snapshot for the publication.</span></span>  
  
2.  <span data-ttu-id="83274-151">Если статьи, входящие в логическую запись, не существуют, выполните хранимую процедуру [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) на издателе в базе данных публикации.</span><span class="sxs-lookup"><span data-stu-id="83274-151">If the articles that will comprise the logical record do not exist, execute [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="83274-152">Укажите один из приведенных ниже параметров определения и распознавания конфликтов в логической записи.</span><span class="sxs-lookup"><span data-stu-id="83274-152">Specify one of the following conflict detection and resolution options for the logical record:</span></span>  
  
    -   <span data-ttu-id="83274-153">Для распознавания и разрешения конфликтов, возникающих в связанных строках логической записи, присвойте значение **true** в качестве значения параметра **@logical_record_level_conflict_detection** и **@logical_record_level_conflict_resolution**.</span><span class="sxs-lookup"><span data-stu-id="83274-153">To detect and resolve conflicts that occur within related rows in the logic record, specify a value of **true** for **@logical_record_level_conflict_detection** and **@logical_record_level_conflict_resolution**.</span></span>  
  
    -   <span data-ttu-id="83274-154">Чтобы использовать стандартное обнаружение и разрешение конфликтов на уровне строк или столбцов, укажите значение `false` для **@logical_record_level_conflict_detection** и **@logical_record_level_conflict_resolution** , которое является значением по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="83274-154">To use the standard row- or column-level conflict detection and resolution, specify a value of `false` for **@logical_record_level_conflict_detection** and **@logical_record_level_conflict_resolution**, which is the default.</span></span>  
  
3.  <span data-ttu-id="83274-155">Повторите шаг 2 для каждой статьи, которая содержит логическую запись.</span><span class="sxs-lookup"><span data-stu-id="83274-155">Repeat step 2 for each article that will comprise the logical record.</span></span> <span data-ttu-id="83274-156">Необходимо использовать в каждой статье логической записи одинаковые параметры определения и разрешения конфликтов.</span><span class="sxs-lookup"><span data-stu-id="83274-156">You must use the same conflict detection and resolution option for each article in the logical record.</span></span> <span data-ttu-id="83274-157">Дополнительные сведения см. в статье [Распознавание и разрешение конфликтов в логических записях](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md).</span><span class="sxs-lookup"><span data-stu-id="83274-157">For more information, see [Detecting and Resolving Conflicts in Logical Records](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md).</span></span>  
  
4.  <span data-ttu-id="83274-158">На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergefilter](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="83274-158">At the publisher on the publication database, execute [sp_addmergefilter](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql).</span></span> <span data-ttu-id="83274-159">Укажите **@publication** , имя одной статьи в связи для **@article** , имя второй статьи в параметре, **@join_articlename** имя для связи, **@filtername** предложение, определяющее связь между двумя статьями **@join_filterclause** , тип объединения для **@join_unique_key** и одно из следующих значений для **@filter_type** :</span><span class="sxs-lookup"><span data-stu-id="83274-159">Specify **@publication**, the name of one article in the relationship for **@article**, the name of the second article for **@join_articlename**, a name for the relationship for **@filtername**, a clause that defines the relationship between the two articles for **@join_filterclause**, the type of join for **@join_unique_key** and one of the following values for **@filter_type**:</span></span>  
  
    -   <span data-ttu-id="83274-160">**2** — определяет логическую связь;</span><span class="sxs-lookup"><span data-stu-id="83274-160">**2** - Defines a logical relationship.</span></span>  
  
    -   <span data-ttu-id="83274-161">**3** — определят логическую связь с фильтром соединения.</span><span class="sxs-lookup"><span data-stu-id="83274-161">**3** - Defines a logical relationship with a join filter.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="83274-162">Фильтр соединения не используется, направление связи между двумя статьями несущественно.</span><span class="sxs-lookup"><span data-stu-id="83274-162">If a join filter is not used, the direction of the relationship between the two articles is not important.</span></span>  
  
5.  <span data-ttu-id="83274-163">Повторите шаг 2 для всех оставшихся связей логических записей в публикации.</span><span class="sxs-lookup"><span data-stu-id="83274-163">Repeat step 2 for each remaining logical record relationship in the publication.</span></span>  
  
#### <a name="to-change-conflict-detection-and-resolution-for-logical-records"></a><span data-ttu-id="83274-164">Изменение способа определения и разрешения конфликтов логических записей</span><span class="sxs-lookup"><span data-stu-id="83274-164">To change conflict detection and resolution for logical records</span></span>  
  
1.  <span data-ttu-id="83274-165">Для определения и разрешения конфликтов, возникающих в связанных строках логической записи, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="83274-165">To detect and resolve conflicts that occur within related rows in the logical record:</span></span>  
  
    -   <span data-ttu-id="83274-166">В базе данных публикации на издателе выполните процедуру [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="83274-166">At the Publisher on the publication database, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="83274-167">Задайте **@property** в качестве значения параметра **@property** и **true** в качестве значения параметра **@value**.</span><span class="sxs-lookup"><span data-stu-id="83274-167">Specify a value of **logical_record_level_conflict_detection** for **@property** and a value of **true** for **@value**.</span></span> <span data-ttu-id="83274-168">Задайте **1** в качестве значения параметра **@force_invalidate_snapshot** и **@force_reinit_subscription**.</span><span class="sxs-lookup"><span data-stu-id="83274-168">Specify a value of **1** for **@force_invalidate_snapshot** and **@force_reinit_subscription**.</span></span>  
  
    -   <span data-ttu-id="83274-169">В базе данных публикации на издателе выполните процедуру [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="83274-169">At the Publisher on the publication database, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="83274-170">Задайте **@property** в качестве значения параметра **@property** и **true** в качестве значения параметра **@value**.</span><span class="sxs-lookup"><span data-stu-id="83274-170">Specify a value of **logical_record_level_conflict_resolution** for **@property** and a value of **true** for **@value**.</span></span> <span data-ttu-id="83274-171">Задайте **1** в качестве значения параметра **@force_invalidate_snapshot** и **@force_reinit_subscription**.</span><span class="sxs-lookup"><span data-stu-id="83274-171">Specify a value of **1** for **@force_invalidate_snapshot** and **@force_reinit_subscription**.</span></span>  
  
2.  <span data-ttu-id="83274-172">Для использования стандартного метода определения и разрешения конфликтов уровня строки и столбца выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="83274-172">To use the standard row-level or column-level conflict detection and resolution:</span></span>  
  
    -   <span data-ttu-id="83274-173">В базе данных публикации на издателе выполните процедуру [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="83274-173">At the Publisher on the publication database, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="83274-174">Укажите значение **logical_record_level_conflict_detection** в **@property** параметре и значение для параметра `false` **@value** .</span><span class="sxs-lookup"><span data-stu-id="83274-174">Specify a value of **logical_record_level_conflict_detection** for **@property** and a value of `false` for **@value**.</span></span> <span data-ttu-id="83274-175">Задайте **1** в качестве значения параметра **@force_invalidate_snapshot** и **@force_reinit_subscription**.</span><span class="sxs-lookup"><span data-stu-id="83274-175">Specify a value of **1** for **@force_invalidate_snapshot** and **@force_reinit_subscription**.</span></span>  
  
    -   <span data-ttu-id="83274-176">В базе данных публикации на издателе выполните процедуру [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="83274-176">At the Publisher on the publication database, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="83274-177">Укажите значение **logical_record_level_conflict_resolution** в **@property** параметре и значение для параметра `false` **@value** .</span><span class="sxs-lookup"><span data-stu-id="83274-177">Specify a value of **logical_record_level_conflict_resolution** for **@property** and a value of `false` for **@value**.</span></span> <span data-ttu-id="83274-178">Задайте **1** в качестве значения параметра **@force_invalidate_snapshot** и **@force_reinit_subscription**.</span><span class="sxs-lookup"><span data-stu-id="83274-178">Specify a value of **1** for **@force_invalidate_snapshot** and **@force_reinit_subscription**.</span></span>  
  
#### <a name="to-remove-a-logical-record-relationship"></a><span data-ttu-id="83274-179">Удаление связи логических записей</span><span class="sxs-lookup"><span data-stu-id="83274-179">To remove a logical record relationship</span></span>  
  
1.  <span data-ttu-id="83274-180">На издателе в базе данных публикации выполните приведенный ниже запрос для получения сведений обо всех связях логических записей, определенных для указанной публикации:</span><span class="sxs-lookup"><span data-stu-id="83274-180">At the Publisher on the publication database, execute the following query to return information about all logical record relationships defined for the specified publication:</span></span>  
  
     [!code-sql[HowTo#sp_ReturnMergeLogicalRecords](../../../snippets/tsql/SQL15/replication/howto/tsql/createlogicalrecordpub.sql#sp_returnmergelogicalrecords)]  
  
     <span data-ttu-id="83274-181">Запомните имя удаляемой связи логических записей, содержащееся в столбце `filtername` результирующего набора.</span><span class="sxs-lookup"><span data-stu-id="83274-181">Note the name of the logical record relationship being removed in the `filtername` column in the result set.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="83274-182">Этот запрос возвращает те же сведения, что и системная хранимая процедура [sp_helpmergefilter](/sql/relational-databases/system-stored-procedures/sp-helpmergefilter-transact-sql), однако системная хранимая процедура возвращает только сведения по тем связям логических записей, которые являются также фильтрами соединения.</span><span class="sxs-lookup"><span data-stu-id="83274-182">This query returns the same information as [sp_helpmergefilter](/sql/relational-databases/system-stored-procedures/sp-helpmergefilter-transact-sql); however, this system stored procedure only returns information about logical record relationships that are also join filters.</span></span>  
  
2.  <span data-ttu-id="83274-183">На издателе в базе данных публикации выполните хранимую процедуру [sp_dropmergefilter](/sql/relational-databases/system-stored-procedures/sp-dropmergefilter-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="83274-183">At the Publisher on the publication database, execute [sp_dropmergefilter](/sql/relational-databases/system-stored-procedures/sp-dropmergefilter-transact-sql).</span></span> <span data-ttu-id="83274-184">Укажите **@publication** , имя одной из статей в связи для **@article** и имя связи из шага 1 в параметре **@filtername** .</span><span class="sxs-lookup"><span data-stu-id="83274-184">Specify **@publication**, the name of one of the articles in the relationship for **@article**, and the name of the relationship from step 1 for **@filtername**.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="83274-185">Примеры (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="83274-185">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="83274-186">В этом примере разрешается использование предварительно вычисляемых секций в существующей публикации и создается логическая запись, в которую входят две новые статьи для таблиц `SalesOrderHeader` и `SalesOrderDetail` .</span><span class="sxs-lookup"><span data-stu-id="83274-186">This example enables precomputed partitions on an existing publication, and creates a logical record comprising the two new articles for the `SalesOrderHeader` and `SalesOrderDetail` tables.</span></span>  
  
 [!code-sql[HowTo#sp_AddMergeLogicalRecord](../../../snippets/tsql/SQL15/replication/howto/tsql/createlogicalrecordpub.sql#sp_addmergelogicalrecord)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="83274-187">При помощи объектов RMO</span><span class="sxs-lookup"><span data-stu-id="83274-187">Using Replication Management Objects (RMO)</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="83274-188">Репликация слиянием позволяет указывать, что конфликты должны отслеживаться и разрешаться на уровне логических записей, но эти параметры нельзя задать с помощью объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="83274-188">Merge replication allows you to specify that conflicts be tracked and resolved at the logical record level, but these options cannot be set using RMO.</span></span>  
  
#### <a name="to-define-a-logical-record-relationship-without-an-associated-join-filter"></a><span data-ttu-id="83274-189">Определение связи логических записей без сопутствующего фильтра соединения</span><span class="sxs-lookup"><span data-stu-id="83274-189">To define a logical record relationship without an associated join filter</span></span>  
  
1.  <span data-ttu-id="83274-190">Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="83274-190">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="83274-191">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePublication> , установите для публикации свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> и <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> , а также установите созданное на шаге 1 соединение в качестве значения свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> .</span><span class="sxs-lookup"><span data-stu-id="83274-191">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
3.  <span data-ttu-id="83274-192">Чтобы получить свойства объекта, вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="83274-192">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="83274-193">Если этот метод возвращает `false`, то либо на шаге 2 были неверно определены свойства публикации, либо публикация не существует.</span><span class="sxs-lookup"><span data-stu-id="83274-193">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>  
  
4.  <span data-ttu-id="83274-194">Если свойство <xref:Microsoft.SqlServer.Replication.MergePublication.PartitionGroupsOption%2A> имеет значение <xref:Microsoft.SqlServer.Replication.PartitionGroupsOption.False>, укажите значение <xref:Microsoft.SqlServer.Replication.PartitionGroupsOption.True>.</span><span class="sxs-lookup"><span data-stu-id="83274-194">If the <xref:Microsoft.SqlServer.Replication.MergePublication.PartitionGroupsOption%2A> property is set to <xref:Microsoft.SqlServer.Replication.PartitionGroupsOption.False>, set it to <xref:Microsoft.SqlServer.Replication.PartitionGroupsOption.True>.</span></span>  
  
5.  <span data-ttu-id="83274-195">Если статьи, которые должны составить логическую запись, не существуют, создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergeArticle> и задайте следующие свойства.</span><span class="sxs-lookup"><span data-stu-id="83274-195">If the articles that are to comprise the logical record do not exist, create an instance of the <xref:Microsoft.SqlServer.Replication.MergeArticle> class, and set the following properties:</span></span>  
  
    -   <span data-ttu-id="83274-196">Имя статьи для <xref:Microsoft.SqlServer.Replication.Article.Name%2A>.</span><span class="sxs-lookup"><span data-stu-id="83274-196">The name of the article for <xref:Microsoft.SqlServer.Replication.Article.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="83274-197">Имя публикации в свойстве <xref:Microsoft.SqlServer.Replication.Article.PublicationName%2A>.</span><span class="sxs-lookup"><span data-stu-id="83274-197">The name of the publication for <xref:Microsoft.SqlServer.Replication.Article.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="83274-198">Если статья отфильтрована горизонтально, задайте условие фильтра строк для свойства <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> (необязательно).</span><span class="sxs-lookup"><span data-stu-id="83274-198">(Optional) If the article is horizontally filtered, specify the row filter clause for the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property.</span></span> <span data-ttu-id="83274-199">Используйте это свойство для определения статического или параметризованного фильтра строк.</span><span class="sxs-lookup"><span data-stu-id="83274-199">Use this property to specify a static or parameterized row filter.</span></span> <span data-ttu-id="83274-200">Дополнительные сведения см. в разделе [Параметризованные фильтры строк](../merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="83274-200">For more information, see [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
     <span data-ttu-id="83274-201">Дополнительные сведения см. в статье [определить статью](define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="83274-201">For more information, see [Define an Article](define-an-article.md).</span></span>  
  
6.  <span data-ttu-id="83274-202">Вызовите метод <xref:Microsoft.SqlServer.Replication.Article.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="83274-202">Call the <xref:Microsoft.SqlServer.Replication.Article.Create%2A> method.</span></span>  
  
7.  <span data-ttu-id="83274-203">Повторите шаги 5 и 6 для каждой статьи, составляющей логическую запись.</span><span class="sxs-lookup"><span data-stu-id="83274-203">Repeat steps 5 and 6 for each article comprising the logical record.</span></span>  
  
8.  <span data-ttu-id="83274-204">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> , чтобы определить связь логических записей между статьями.</span><span class="sxs-lookup"><span data-stu-id="83274-204">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> class to define the logical record relationship between articles.</span></span> <span data-ttu-id="83274-205">Затем установите следующие свойства.</span><span class="sxs-lookup"><span data-stu-id="83274-205">Then, set the following properties:</span></span>  
  
    -   <span data-ttu-id="83274-206">Имя дочерней статьи в связи логических записей для свойства <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.ArticleName%2A> .</span><span class="sxs-lookup"><span data-stu-id="83274-206">The name of the child article in the logical record relationship for the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.ArticleName%2A> property.</span></span>  
  
    -   <span data-ttu-id="83274-207">Имя существующей, родительской статьи в связи логических записей для свойства <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.JoinArticleName%2A> .</span><span class="sxs-lookup"><span data-stu-id="83274-207">The name of the existing, parent article in the logical record relationship for the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.JoinArticleName%2A> property.</span></span>  
  
    -   <span data-ttu-id="83274-208">Имя связи логических записей для свойства <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.FilterName%2A> .</span><span class="sxs-lookup"><span data-stu-id="83274-208">A name for the logical record relationship for the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.FilterName%2A> property.</span></span>  
  
    -   <span data-ttu-id="83274-209">Выражение, определяющее связь для свойства <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.JoinFilterClause%2A> .</span><span class="sxs-lookup"><span data-stu-id="83274-209">The expression that defines the relationship for the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.JoinFilterClause%2A> property.</span></span>  
  
    -   <span data-ttu-id="83274-210">Значение <xref:Microsoft.SqlServer.Replication.FilterTypes.LogicalRecordLink> для свойства <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.FilterTypes%2A> .</span><span class="sxs-lookup"><span data-stu-id="83274-210">A value of <xref:Microsoft.SqlServer.Replication.FilterTypes.LogicalRecordLink> for the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.FilterTypes%2A> property.</span></span> <span data-ttu-id="83274-211">Если связь логических записей является также фильтром соединения, укажите значение <xref:Microsoft.SqlServer.Replication.FilterTypes.JoinFilterAndLogicalRecordLink> для этого свойства.</span><span class="sxs-lookup"><span data-stu-id="83274-211">If the logical record relationship is also a join filter, specify a value of <xref:Microsoft.SqlServer.Replication.FilterTypes.JoinFilterAndLogicalRecordLink> for this property.</span></span> <span data-ttu-id="83274-212">Дополнительные сведения см. в статье [Группирование изменений в связанных строках с помощью логических записей](../merge/group-changes-to-related-rows-with-logical-records.md).</span><span class="sxs-lookup"><span data-stu-id="83274-212">For more information, see [Group Changes to Related Rows with Logical Records](../merge/group-changes-to-related-rows-with-logical-records.md).</span></span>  
  
9. <span data-ttu-id="83274-213">Вызовите метод <xref:Microsoft.SqlServer.Replication.MergeArticle.AddMergeJoinFilter%2A> для объекта, представляющего дочернюю статью в этой связи.</span><span class="sxs-lookup"><span data-stu-id="83274-213">Call the <xref:Microsoft.SqlServer.Replication.MergeArticle.AddMergeJoinFilter%2A> method on the object that represents the child article in the relationship.</span></span> <span data-ttu-id="83274-214">Передайте объект <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> из шага 8, чтобы определить связь.</span><span class="sxs-lookup"><span data-stu-id="83274-214">Pass the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> object from step 8 to define the relationship.</span></span>  
  
10. <span data-ttu-id="83274-215">Повторите шаги 8 и 9 для каждой оставшейся связи логических записей в публикации.</span><span class="sxs-lookup"><span data-stu-id="83274-215">Repeat steps 8 and 9 for each remaining logical record relationship in the publication.</span></span>  
  
###  <a name="example-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="83274-216">Пример (объекты RMO)</span><span class="sxs-lookup"><span data-stu-id="83274-216">Example (RMO)</span></span>  
 <span data-ttu-id="83274-217">В этом примере создается логическая запись, составленная из двух новых статей для таблиц `SalesOrderHeader` и `SalesOrderDetail` .</span><span class="sxs-lookup"><span data-stu-id="83274-217">This example creates a logical record comprising the two new articles for the `SalesOrderHeader` and `SalesOrderDetail` tables.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateLogicalRecord](../../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createlogicalrecord)]  
  
 [!code-vb[HowTo#rmo_vb_CreateLogicalRecord](../../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createlogicalrecord)]  
  
## <a name="see-also"></a><span data-ttu-id="83274-218">См. также:</span><span class="sxs-lookup"><span data-stu-id="83274-218">See Also</span></span>  
 <span data-ttu-id="83274-219">[Определение и изменение фильтра соединения между статьями публикации слиянием](define-and-modify-a-join-filter-between-merge-articles.md) </span><span class="sxs-lookup"><span data-stu-id="83274-219">[Define and Modify a Join Filter Between Merge Articles](define-and-modify-a-join-filter-between-merge-articles.md) </span></span>  
 <span data-ttu-id="83274-220">[Определение и изменение параметризованного фильтра строк для статьи публикации слиянием](define-and-modify-a-parameterized-row-filter-for-a-merge-article.md) </span><span class="sxs-lookup"><span data-stu-id="83274-220">[Define and Modify a Parameterized Row Filter for a Merge Article](define-and-modify-a-parameterized-row-filter-for-a-merge-article.md) </span></span>  
 <span data-ttu-id="83274-221">[Определение и изменение статического строкового фильтра](define-and-modify-a-static-row-filter.md) </span><span class="sxs-lookup"><span data-stu-id="83274-221">[Define and Modify a Static Row Filter](define-and-modify-a-static-row-filter.md) </span></span>  
 <span data-ttu-id="83274-222">[Группирование изменений в связанных строках с помощью логических записей](../merge/group-changes-to-related-rows-with-logical-records.md) </span><span class="sxs-lookup"><span data-stu-id="83274-222">[Group Changes to Related Rows with Logical Records](../merge/group-changes-to-related-rows-with-logical-records.md) </span></span>  
 <span data-ttu-id="83274-223">[Оптимизация производительности параметризованного фильтра с помощью предварительно вычисляемых секций](../merge/parameterized-filters-optimize-for-precomputed-partitions.md) </span><span class="sxs-lookup"><span data-stu-id="83274-223">[Optimize Parameterized Filter Performance with Precomputed Partitions](../merge/parameterized-filters-optimize-for-precomputed-partitions.md) </span></span>  
 [<span data-ttu-id="83274-224">Группирование изменений в связанных строках с помощью логических записей</span><span class="sxs-lookup"><span data-stu-id="83274-224">Group Changes to Related Rows with Logical Records</span></span>](../merge/group-changes-to-related-rows-with-logical-records.md)  
  
  
