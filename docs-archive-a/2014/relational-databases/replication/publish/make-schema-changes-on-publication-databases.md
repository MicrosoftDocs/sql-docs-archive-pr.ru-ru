---
title: Внесение изменений в схемы баз данных публикации | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- replication [SQL Server], schema changes
- snapshot replication [SQL Server], replicating schema changes
- merge replication [SQL Server replication], replicating schema changes
- transactional replication, replicating schema changes
- schemas [SQL Server replication], replicating changes
- publishing [SQL Server replication], schema changes
ms.assetid: 926c88d7-a844-402f-bcb9-db49e5013b69
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e26d3e89fcba41d474ca56637f9e465f17127348
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655054"
---
# <a name="make-schema-changes-on-publication-databases"></a><span data-ttu-id="81432-102">Внесение изменений схем в базы данных публикации</span><span class="sxs-lookup"><span data-stu-id="81432-102">Make Schema Changes on Publication Databases</span></span>
  <span data-ttu-id="81432-103">Репликация поддерживает широкий диапазон изменений схем для опубликованных объектов.</span><span class="sxs-lookup"><span data-stu-id="81432-103">Replication supports a wide range of schema changes to published objects.</span></span> <span data-ttu-id="81432-104">При внесении любого из следующих изменений схемы в соответствующий опубликованный объект на издателе [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] это изменение распространяется по умолчанию на все подписчики [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="81432-104">When you make any of the following schema changes on the appropriate published object at a [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publisher, that change is propagated by default to all [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Subscribers:</span></span>  
  
-   <span data-ttu-id="81432-105">ALTER TABLE</span><span class="sxs-lookup"><span data-stu-id="81432-105">ALTER TABLE</span></span>  
  
-   <span data-ttu-id="81432-106">Не следует использовать параметр ALTER TABLE SET LOCK ESCALATION, если включена репликация изменения схемы и топология включает [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] или [!INCLUDE[ssEWnoversion](../../../includes/ssewnoversion-md.md)] Subscribers.ALTER VIEW</span><span class="sxs-lookup"><span data-stu-id="81432-106">ALTER TABLE SET LOCK ESCALATION should not be used if schema change replication is enabled and a topology includes [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or [!INCLUDE[ssEWnoversion](../../../includes/ssewnoversion-md.md)] Subscribers.ALTER VIEW</span></span>  
  
-   <span data-ttu-id="81432-107">ALTER PROCEDURE</span><span class="sxs-lookup"><span data-stu-id="81432-107">ALTER PROCEDURE</span></span>  
  
-   <span data-ttu-id="81432-108">ALTER FUNCTION</span><span class="sxs-lookup"><span data-stu-id="81432-108">ALTER FUNCTION</span></span>  
  
-   <span data-ttu-id="81432-109">ALTER TRIGGER</span><span class="sxs-lookup"><span data-stu-id="81432-109">ALTER TRIGGER</span></span>  
  
     <span data-ttu-id="81432-110">Параметр ALTER TRIGGER можно использовать только для триггеров языка обработки данных DML, поскольку триггеры языка описания данных DDL не могут быть реплицированы.</span><span class="sxs-lookup"><span data-stu-id="81432-110">ALTER TRIGGER can be used only for data manipulation language [DML] triggers because data definition language [DDL] triggers cannot be replicated.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="81432-111">Изменения схем таблиц должны выполняться с использованием [!INCLUDE[tsql](../../../includes/tsql-md.md)] или объектов SMO [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="81432-111">Schema changes to tables must be made by using [!INCLUDE[tsql](../../../includes/tsql-md.md)] or [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Management Objects (SMO).</span></span> <span data-ttu-id="81432-112">Когда изменения схемы выполняются в среде [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], среда [!INCLUDE[ssManStudio](../../../includes/ssmanstudio-md.md)] пытается удалить и затем повторно создать таблицу.</span><span class="sxs-lookup"><span data-stu-id="81432-112">When schema changes are made in [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[ssManStudio](../../../includes/ssmanstudio-md.md)] attempts to drop and re-create the table.</span></span> <span data-ttu-id="81432-113">Опубликованные объекты невозможно удалить, поэтому изменения схемы завершаются ошибкой.</span><span class="sxs-lookup"><span data-stu-id="81432-113">You cannot drop published objects, therefore the schema change fails.</span></span>  
  
 <span data-ttu-id="81432-114">При репликации транзакций и репликации слиянием изменения схемы распространяются в режиме последовательных добавлений при запусках агента распространителя или агента слияния.</span><span class="sxs-lookup"><span data-stu-id="81432-114">For transactional replication and merge replication, schema changes are propagated incrementally when the Distribution Agent or Merge Agent runs.</span></span> <span data-ttu-id="81432-115">В случае репликации моментальных снимков изменения схемы распространяются при применении нового моментального снимка на подписчике.</span><span class="sxs-lookup"><span data-stu-id="81432-115">For snapshot replication, schema changes are propagated when a new snapshot is applied at the Subscriber.</span></span> <span data-ttu-id="81432-116">В репликации моментальных снимков при каждой синхронизации подписчику отправляется новая копия схемы.</span><span class="sxs-lookup"><span data-stu-id="81432-116">In snapshot replication, a new copy of the schema is sent to the Subscriber each time synchronization occurs.</span></span> <span data-ttu-id="81432-117">Поэтому все изменения схемы (не только перечисленные выше) в ранее опубликованных объектах автоматически распространяются при каждой синхронизации.</span><span class="sxs-lookup"><span data-stu-id="81432-117">Therefore, all schema changes (not just those listed above) to previously published objects are automatically propagated with each synchronization.</span></span>  
  
 <span data-ttu-id="81432-118">Дополнительные сведения о добавлении и удалении статей в существующих публикациях см. в [этой статье](add-articles-to-and-drop-articles-from-existing-publications.md).</span><span class="sxs-lookup"><span data-stu-id="81432-118">For information about adding and removing articles from publications, see [Add Articles to and Drop Articles from Existing Publications](add-articles-to-and-drop-articles-from-existing-publications.md).</span></span>  
  
 <span data-ttu-id="81432-119">**Репликация изменений схемы**</span><span class="sxs-lookup"><span data-stu-id="81432-119">**To replicate schema changes**</span></span>  
  
 <span data-ttu-id="81432-120">Перечисленные выше изменения схемы реплицируются по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="81432-120">The schema changes listed above are replicated by default.</span></span> <span data-ttu-id="81432-121">Сведения об отключении репликации изменений схемы см. в разделе [Replicate Schema Changes](replicate-schema-changes.md).</span><span class="sxs-lookup"><span data-stu-id="81432-121">For information about disabling the replication of schema changes, see [Replicate Schema Changes](replicate-schema-changes.md).</span></span>  
  
## <a name="considerations-for-schema-changes"></a><span data-ttu-id="81432-122">Вопросы изменений схемы</span><span class="sxs-lookup"><span data-stu-id="81432-122">Considerations for Schema Changes</span></span>  
 <span data-ttu-id="81432-123">При репликации изменений схемы учитывайте следующее.</span><span class="sxs-lookup"><span data-stu-id="81432-123">Keep the following considerations in mind when replicating schema changes.</span></span>  
  
### <a name="general-considerations"></a><span data-ttu-id="81432-124">Общие рекомендации</span><span class="sxs-lookup"><span data-stu-id="81432-124">General Considerations</span></span>  
  
-   <span data-ttu-id="81432-125">Изменения схемы подвержены любым ограничениям, накладываемым языком [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="81432-125">Schema changes are subject to any restrictions imposed by [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span> <span data-ttu-id="81432-126">Например, ALTER TABLE не позволяет изменять первичные ключевые столбцы.</span><span class="sxs-lookup"><span data-stu-id="81432-126">For example, ALTER TABLE does not allow you to ALTER primary key columns.</span></span>  
  
-   <span data-ttu-id="81432-127">Сопоставление типов данных выполняется только для исходного моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="81432-127">Data type mapping is performed only for the initial snapshot.</span></span> <span data-ttu-id="81432-128">Изменения схемы не сопоставляются с предыдущими версиями типов данных.</span><span class="sxs-lookup"><span data-stu-id="81432-128">Schema changes are not mapped to previous versions of data types.</span></span> <span data-ttu-id="81432-129">Например, если инструкция `ALTER TABLE ADD datetime2 column` используется в [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], тип данных не преобразуется в `nvarchar` для подписчиков [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="81432-129">For example, if the statement `ALTER TABLE ADD datetime2 column` is used in [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the data type is not translated to `nvarchar` for [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] Subscribers.</span></span> <span data-ttu-id="81432-130">В некоторых случаях изменения схемы блокируются на издателе.</span><span class="sxs-lookup"><span data-stu-id="81432-130">In some cases, schema changes are blocked on the Publisher.</span></span>  
  
-   <span data-ttu-id="81432-131">Если в публикации разрешено распространение изменений схемы, то изменения схемы распространяются независимо от того, как установлен соответствующий параметр схемы для статьи в публикации.</span><span class="sxs-lookup"><span data-stu-id="81432-131">If a publication is set to allow the propagation of schema changes, schema changes are propagated regardless of how the related schema option is set for an article in the publication.</span></span> <span data-ttu-id="81432-132">Например, если вы указываете не реплицировать ограничения внешних ключей для статьи таблицы, а затем выполняете команду ALTER TABLE, которая добавляет внешний ключ в таблицу на издателе, внешний ключ будет добавлен в таблицу на подписчике.</span><span class="sxs-lookup"><span data-stu-id="81432-132">For example, if you select not to replicate foreign key constraints for a table article, but then issue an ALTER TABLE command that adds a foreign key to the table at the Publisher, the foreign key is added to the table at the Subscriber.</span></span> <span data-ttu-id="81432-133">Чтобы предотвратить это, отключите распространение изменений схемы перед выполнением команды ALTER TABLE.</span><span class="sxs-lookup"><span data-stu-id="81432-133">To prevent this, disable the propagation of schema changes before issuing the ALTER TABLE command.</span></span>  
  
-   <span data-ttu-id="81432-134">Изменения схемы должны выполняться только на издателе, а не на подписчиках (включая переиздающих подписчиков).</span><span class="sxs-lookup"><span data-stu-id="81432-134">Schema changes should be made only at the Publisher, not at Subscribers (including republishing Subscribers).</span></span> <span data-ttu-id="81432-135">Репликация слиянием предотвращает изменения схемы на подписчиках.</span><span class="sxs-lookup"><span data-stu-id="81432-135">Merge replication prevents schema changes at the Subscriber.</span></span> <span data-ttu-id="81432-136">Репликация транзакций не предотвращает изменения, однако изменения могут быть причиной ошибки репликации.</span><span class="sxs-lookup"><span data-stu-id="81432-136">Transactional replication does not prevent the changes, but the changes can cause replication to fail.</span></span>  
  
-   <span data-ttu-id="81432-137">Изменения, распространяемые на переиздающего подписчика, по умолчанию распространяются на его подписчиков.</span><span class="sxs-lookup"><span data-stu-id="81432-137">Changes propagated to a republishing Subscriber are by default propagated to its Subscribers.</span></span>  
  
-   <span data-ttu-id="81432-138">Если изменение схемы ссылается на объекты или ограничения, существующие на издателе, но отсутствующие на подписчике, изменение схемы будет успешно выполнено на издателе, а на подписчике оно завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="81432-138">If the schema change references objects or constraints existing on the Publisher but not on the Subscriber, the schema change will succeed on the Publisher but will fail on the Subscriber.</span></span>  
  
-   <span data-ttu-id="81432-139">Любой объект на подписчике, на который имеются ссылки, при добавлении внешнего ключа должен иметь то же имя и того же владельца, что и соответствующий объект на издателе.</span><span class="sxs-lookup"><span data-stu-id="81432-139">All objects on the Subscriber that are referenced when adding a foreign key must have the same name and owner as the corresponding object on the Publisher.</span></span>  
  
-   <span data-ttu-id="81432-140">Явное добавление, удаление и изменение индексов не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="81432-140">Explicitly adding, dropping, or altering indexes is not supported.</span></span> <span data-ttu-id="81432-141">Поддерживается неявное создание индексов для ограничений (например, для ограничения первичного ключа).</span><span class="sxs-lookup"><span data-stu-id="81432-141">Indexes created implicitly for constraints (such as a primary key constraint) are supported.</span></span>  
  
-   <span data-ttu-id="81432-142">Изменение или удаление столбцов идентификаторов, управляемых репликацией, не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="81432-142">Altering or dropping identity columns that are managed by replication is not supported.</span></span> <span data-ttu-id="81432-143">Дополнительные сведения об автоматическом управлении столбцами идентификаторов см. в статье [Репликация столбцов идентификаторов](replicate-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="81432-143">For more information about automatic management of identity columns, see [Replicate Identity Columns](replicate-identity-columns.md).</span></span>  
  
-   <span data-ttu-id="81432-144">Изменения схемы, включающие недетерминированные функции, не поддерживаются, поскольку они могут привести к разным данным на издателе и на подписчике (эта разница данных называется расхождением).</span><span class="sxs-lookup"><span data-stu-id="81432-144">Schema changes that include nondeterministic functions are not supported because they can result in data at the Publisher and Subscriber being different (referred to as non-convergence).</span></span> <span data-ttu-id="81432-145">Например, если на издателе выполнить команду `ALTER TABLE SalesOrderDetail ADD OrderDate DATETIME DEFAULT GETDATE()`, значения будут отличаться от случая, когда команда реплицируется на подписчик и выполняется.</span><span class="sxs-lookup"><span data-stu-id="81432-145">For example, if you issue the following command at the Publisher: `ALTER TABLE SalesOrderDetail ADD OrderDate DATETIME DEFAULT GETDATE()`, the values are different when the command is replicated to the Subscriber and executed.</span></span> <span data-ttu-id="81432-146">Дополнительные сведения о недетерминированных функциях см. в разделе [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span><span class="sxs-lookup"><span data-stu-id="81432-146">For more information about nondeterministic functions, see [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span></span>  
  
-   <span data-ttu-id="81432-147">Рекомендуется именовать ограничения явным образом.</span><span class="sxs-lookup"><span data-stu-id="81432-147">It is recommended that constraints be explicitly named.</span></span> <span data-ttu-id="81432-148">Если ограничение не именовано явным образом, то [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] создает для него имя. Эти имена будут отличаться для издателя и подписчика.</span><span class="sxs-lookup"><span data-stu-id="81432-148">If a constraint is not explicitly named, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] generates a name for the constraint, and these names will be different on the Publisher and each Subscriber.</span></span> <span data-ttu-id="81432-149">Это может стать причиной проблем во время репликации изменений схемы.</span><span class="sxs-lookup"><span data-stu-id="81432-149">This can cause issues during the replication of schema changes.</span></span> <span data-ttu-id="81432-150">Например, если на издателе удаляется столбец и зависимое ограничение, то во время репликации будет произведена попытка удалить ограничение на подписчике.</span><span class="sxs-lookup"><span data-stu-id="81432-150">For example, if you drop a column at the Publisher and a dependent constraint is dropped, replication will attempt to drop the constraint at the Subscriber.</span></span> <span data-ttu-id="81432-151">Эта попытка удаления на подписчике завершится ошибкой, так как имена ограничения на издателе и на подписчике различаются.</span><span class="sxs-lookup"><span data-stu-id="81432-151">The drop at the Subscriber will fail because the name of the constraint is different.</span></span> <span data-ttu-id="81432-152">Если синхронизация завершается сбоем из-за различия имен ограничения, то удалите ограничение на подписчике вручную, а затем перезапустите агент слияния.</span><span class="sxs-lookup"><span data-stu-id="81432-152">If synchronization fails because of a constraint naming issue, manually drop the constraint at the Subscriber and then rerun the Merge Agent.</span></span>  
  
-   <span data-ttu-id="81432-153">При публикации какой-либо таблицы для репликации невозможно изменить данные столбца в этой таблице на данные типа XML, если моментальный снимок публикации уже создан. Перед изменением столбца необходимо вначале удалить репликацию.</span><span class="sxs-lookup"><span data-stu-id="81432-153">If a table is published for replication, it is not possible to alter a column in that table to a data type of XML if a publication snapshot has already been generated To alter the column, you must first remove replication.</span></span>  
  
-   <span data-ttu-id="81432-154">Уровень изоляции «read uncommitted» не является поддерживаемым уровнем изоляции при выполнении DDL в опубликованной таблице.</span><span class="sxs-lookup"><span data-stu-id="81432-154">Read uncommitted is not a supported isolation level when doing DDL on a published table.</span></span>  
  
-   <span data-ttu-id="81432-155">Аргумент `SET CONTEXT_INFO` не следует использовать для изменения контекста транзакций, изменения схемы выполняются для опубликованных объектов.</span><span class="sxs-lookup"><span data-stu-id="81432-155">`SET CONTEXT_INFO` should not be used to modify the context of transactions where schema changes are performed against published objects.</span></span>  
  
#### <a name="adding-columns"></a><span data-ttu-id="81432-156">Добавление столбцов</span><span class="sxs-lookup"><span data-stu-id="81432-156">Adding Columns</span></span>  
  
-   <span data-ttu-id="81432-157">Для добавления в таблицу нового столбца и включения этого столбца в существующую публикацию выполните инструкцию ALTER TABLE \<Table> ADD \<Column>.</span><span class="sxs-lookup"><span data-stu-id="81432-157">To add a new column to a table and include that column in an existing publication, execute ALTER TABLE \<Table> ADD \<Column>.</span></span> <span data-ttu-id="81432-158">По умолчанию этот столбец затем реплицируется на все подписчики.</span><span class="sxs-lookup"><span data-stu-id="81432-158">By default, the column is then replicated to all Subscribers.</span></span> <span data-ttu-id="81432-159">Столбец должен допускать использование значений NULL или содержать ограничение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="81432-159">The column must allow NULL values or include a default constraint.</span></span> <span data-ttu-id="81432-160">Дополнительные сведения о добавлении столбцов см. в подразделе «Репликация слиянием» этого раздела.</span><span class="sxs-lookup"><span data-stu-id="81432-160">For more information about adding columns, see the "Merge Replication" section in this topic.</span></span>  
  
-   <span data-ttu-id="81432-161">Чтобы добавить в таблицу новый столбец, не включая его в существующую публикацию, отключите репликацию изменений схемы, а затем выполните инструкцию ALTER TABLE \<Table> ADD \<Column>.</span><span class="sxs-lookup"><span data-stu-id="81432-161">To add a new column to a table and not include that column in an existing publication, disable the replication of schema changes, and then execute ALTER TABLE \<Table> ADD \<Column>.</span></span>  
  
-   <span data-ttu-id="81432-162">Чтобы включить имеющийся столбец в существующую публикацию, используйте процедуры [sp_articlecolumn (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql), [sp_mergearticlecolumn (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql) или диалоговое окно **Свойства публикации — \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="81432-162">To include an existing column in an existing publication, use [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql), [sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql), or the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
     <span data-ttu-id="81432-163">Дополнительные сведения см. в разделе [Define and Modify a Column Filter](define-and-modify-a-column-filter.md).</span><span class="sxs-lookup"><span data-stu-id="81432-163">For more information, see [Define and Modify a Column Filter](define-and-modify-a-column-filter.md).</span></span> <span data-ttu-id="81432-164">Это потребует повторной инициализации подписок.</span><span class="sxs-lookup"><span data-stu-id="81432-164">This will require subscriptions to be reinitialized.</span></span>  
  
-   <span data-ttu-id="81432-165">Добавление столбца идентификаторов в опубликованную таблицу не поддерживается, поскольку это может привести к расхождению данных при репликации столбца на подписчик.</span><span class="sxs-lookup"><span data-stu-id="81432-165">Adding an identity column to a published table is not supported, because it can result in non-convergence when the column is replicated to the Subscriber.</span></span> <span data-ttu-id="81432-166">Значения в столбце идентификаторов на издателе зависят от порядка, в котором строки изменяемой таблицы хранятся физически.</span><span class="sxs-lookup"><span data-stu-id="81432-166">The values in the identity column at the Publisher depend on the order in which the rows for the affected table are physically stored.</span></span> <span data-ttu-id="81432-167">Строки могут храниться по-разному на подписчике. Поэтому значение для столбца идентификаторов может быть разным для одинаковых строк.</span><span class="sxs-lookup"><span data-stu-id="81432-167">The rows might be stored differently at the Subscriber; therefore the value for the identity column can be different for the same rows.</span></span>  
  
#### <a name="dropping-columns"></a><span data-ttu-id="81432-168">Удаление столбцов</span><span class="sxs-lookup"><span data-stu-id="81432-168">Dropping Columns</span></span>  
  
-   <span data-ttu-id="81432-169">Для удаления столбца из имеющийся публикации и удаления столбца из таблицы на издателе выполните инструкцию ALTER TABLE \<Table> DROP \<Column>.</span><span class="sxs-lookup"><span data-stu-id="81432-169">To drop a column from an existing publication and drop the column from the table at the Publisher, execute ALTER TABLE \<Table> DROP \<Column>.</span></span> <span data-ttu-id="81432-170">По умолчанию столбец затем удаляется из таблицы на всех подписчиках.</span><span class="sxs-lookup"><span data-stu-id="81432-170">By default, the column is then dropped from the table at all Subscribers.</span></span>  
  
-   <span data-ttu-id="81432-171">Чтобы удалить столбец из имеющейся публикации, но сохранить его в таблице на издателе, используйте процедуры [sp_articlecolumn (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql), [sp_mergearticlecolumn (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql) или диалоговое окно **Свойства публикации — \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="81432-171">To drop a column from an existing publication but retain the column in the table at the Publisher, use [sp_articlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-articlecolumn-transact-sql), [sp_mergearticlecolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-mergearticlecolumn-transact-sql), or the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
     <span data-ttu-id="81432-172">Дополнительные сведения см. в разделе [Define and Modify a Column Filter](define-and-modify-a-column-filter.md).</span><span class="sxs-lookup"><span data-stu-id="81432-172">For more information, see [Define and Modify a Column Filter](define-and-modify-a-column-filter.md).</span></span> <span data-ttu-id="81432-173">Это потребует создания нового моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="81432-173">This will require a new snapshot to be generated.</span></span>  
  
-   <span data-ttu-id="81432-174">Удаляемый столбец не может использоваться в предложениях фильтра любой статьи любой публикации в базе данных.</span><span class="sxs-lookup"><span data-stu-id="81432-174">The column to be dropped cannot be used in the filter clauses of any article of any publication in the database.</span></span>  
  
-   <span data-ttu-id="81432-175">При удалении столбца из опубликованной статьи имейте в виду возможное влияние на базу данных ограничений, индексов и свойств столбца.</span><span class="sxs-lookup"><span data-stu-id="81432-175">When dropping a column from a published article, take into consideration any constraints, indexes, or properties of the column that could affect the database.</span></span> <span data-ttu-id="81432-176">Пример:</span><span class="sxs-lookup"><span data-stu-id="81432-176">For example:</span></span>  
  
    -   <span data-ttu-id="81432-177">Нельзя удалить столбцы, используемые первичным ключом, из статей в публикациях транзакций, потому что они используются репликацией.</span><span class="sxs-lookup"><span data-stu-id="81432-177">You cannot drop columns used in a primary key from articles in transactional publications, because they are used by replication.</span></span>  
  
    -   <span data-ttu-id="81432-178">Нельзя удалить столбец rowguid из статей в публикациях слиянием или столбец mstran_repl_version из статей в публикациях транзакций, поддерживающих обновляемые подписки, поскольку они используются репликацией.</span><span class="sxs-lookup"><span data-stu-id="81432-178">You cannot drop the rowguid column from articles in merge publications or the mstran_repl_version column from articles in transactional publications that support updating subscriptions, because they are used by replication.</span></span>  
  
    -   <span data-ttu-id="81432-179">Изменения индекса не распространяются на подписчики: при удалении столбца на издателе и зависимого индекса репликация удаления индекса не производится.</span><span class="sxs-lookup"><span data-stu-id="81432-179">Index changes are not propagated to Subscribers: if you drop a column at the Publisher and a dependent index is dropped, the index drop is not replicated.</span></span> <span data-ttu-id="81432-180">Чтобы выполнить удаление столбца при его реплицировании с издателя на подписчик, следует удалить индекс на подписчике перед удалением столбца на издателе.</span><span class="sxs-lookup"><span data-stu-id="81432-180">You should drop the index at the Subscriber before dropping the column at the Publisher, so that the column drop succeeds when it is replicated from the Publisher to the Subscriber.</span></span> <span data-ttu-id="81432-181">Если выполнить синхронизацию не удалось из-за какого-либо индекса на подписчике, то удалите этот индекс вручную, а затем перезапустите агент слияния.</span><span class="sxs-lookup"><span data-stu-id="81432-181">If synchronization fails because of an index at the Subscriber, manually drop the index and then rerun the Merge Agent.</span></span>  
  
    -   <span data-ttu-id="81432-182">Ограничения следует именовать явным образом для удаления.</span><span class="sxs-lookup"><span data-stu-id="81432-182">Constraints should be explicitly named to allow for dropping.</span></span> <span data-ttu-id="81432-183">Дополнительные сведения см. в подразделе «Общие вопросы» этого раздела.</span><span class="sxs-lookup"><span data-stu-id="81432-183">For more information, see the "General Considerations" section earlier in this topic.</span></span>  
  
### <a name="transactional-replication"></a><span data-ttu-id="81432-184">репликация транзакций</span><span class="sxs-lookup"><span data-stu-id="81432-184">Transactional Replication</span></span>  
  
-   <span data-ttu-id="81432-185">Изменения схемы распространяются на подписчики, использующие предыдущие версии [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], однако инструкция DDL должна содержать только тот синтаксис, который поддерживается версией подписчика.</span><span class="sxs-lookup"><span data-stu-id="81432-185">Schema changes are propagated to Subscribers running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], but the DDL statement should only include syntax supported by the version at the Subscriber.</span></span>  
  
     <span data-ttu-id="81432-186">Если подписчик публикует данные повторно, поддерживаемые изменения схемы включают только добавление и удаление столбца.</span><span class="sxs-lookup"><span data-stu-id="81432-186">If the Subscriber republishes data, the only supported schema changes are adding and dropping a column.</span></span> <span data-ttu-id="81432-187">Эти изменения нужно выполнить на издателе с использованием процедуры [sp_repladdcolumn (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) и [sp_repldropcolumn (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) вместо применения синтаксиса ALTER TABLE DDL.</span><span class="sxs-lookup"><span data-stu-id="81432-187">These changes should be made on the Publisher using [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) and [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) rather than ALTER TABLE DDL syntax.</span></span>  
  
-   <span data-ttu-id="81432-188">Репликация изменений схемы не выполняется для подписчиков, отличных от подписчиков SQL Server.</span><span class="sxs-lookup"><span data-stu-id="81432-188">Schema changes are not replicated to non-SQL Server Subscribers.</span></span>  
  
-   <span data-ttu-id="81432-189">Изменения схемы не распространяются на издатели, не относящиеся к[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="81432-189">Schema changes are not propagated from non-[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publishers.</span></span>  
  
-   <span data-ttu-id="81432-190">Индексированные представления, которые реплицируются в виде таблиц, невозможно изменить.</span><span class="sxs-lookup"><span data-stu-id="81432-190">You cannot alter indexed views that are replicated as tables.</span></span> <span data-ttu-id="81432-191">Индексированные представления, которые реплицируются как индексированные представления, могут быть изменены, однако их изменение приведет к тому, что они станут обычными, а не индексированными представлениями.</span><span class="sxs-lookup"><span data-stu-id="81432-191">Indexed views that are replicated as indexed views can be altered, but altering them will cause them to become regular views, rather than indexed views.</span></span>  
  
-   <span data-ttu-id="81432-192">Если публикация поддерживает подписки с немедленным обновлением или обновляемой посредством очередей подписки, перед выполнением изменений схемы следует заморозить систему: любые действия в опубликованной таблице должны быть прекращены на издателе и подписчиках, а отложенные изменения данных должны быть распространены на все узлы.</span><span class="sxs-lookup"><span data-stu-id="81432-192">If the publication supports immediate updating or queued updating subscriptions, the system must be quiesced before making schema changes: all activity on the published table must be stopped at the Publisher and Subscribers, and pending data changes must be propagated to all nodes.</span></span> <span data-ttu-id="81432-193">После распространения изменений схемы на все узлы можно возобновить действия в опубликованных таблицах.</span><span class="sxs-lookup"><span data-stu-id="81432-193">After the schema changes have propagated to all nodes, activity can resume on the published tables.</span></span>  
  
-   <span data-ttu-id="81432-194">Если публикация находится в одноранговой топологии, перед выполнением изменений схемы система должна быть приостановлена.</span><span class="sxs-lookup"><span data-stu-id="81432-194">If the publication is in a peer-to-peer topology, the system must be quiesced before making schema changes.</span></span> <span data-ttu-id="81432-195">Дополнительные сведения см. в разделе [Замораживание топологии репликации (программирование репликации на языке Transact-SQL)](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span><span class="sxs-lookup"><span data-stu-id="81432-195">For more information, see [Quiesce a Replication Topology &#40;Replication Transact-SQL Programming&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span></span>  
  
-   <span data-ttu-id="81432-196">Добавление в таблицу столбца типа timestamp и сопоставление типа timestamp с типом binary(8) вызывает повторную инициализацию статьи для всех активных подписок.</span><span class="sxs-lookup"><span data-stu-id="81432-196">Adding a timestamp column to a table and mapping the timestamp to binary(8) causes the article to be reinitialized for all active subscriptions.</span></span>  
  
### <a name="merge-replication"></a><span data-ttu-id="81432-197">Репликация слиянием</span><span class="sxs-lookup"><span data-stu-id="81432-197">Merge Replication</span></span>  
  
-   <span data-ttu-id="81432-198">Способ обработки изменений схемы при репликации слиянием определяется уровнем совместимости публикации и режимом моментального снимка — собственным (по умолчанию) или символьным.</span><span class="sxs-lookup"><span data-stu-id="81432-198">How merge replication handles schema changes is determined by the publication compatibility level, and whether the snapshot is set to native mode (default) or character mode:</span></span>  
  
    -   <span data-ttu-id="81432-199">Для репликации изменений схемы уровень совместимости публикации должен быть не меньше 90RTM.</span><span class="sxs-lookup"><span data-stu-id="81432-199">To replicate schema changes, the compatibility level of the publication must be at least 90RTM.</span></span> <span data-ttu-id="81432-200">Если на подписчиках используются предыдущие версии [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] или уровень совместимости ниже 90RTM, для удаления и добавления столбцов по-прежнему можно использовать хранимые процедуры [sp_repladdcolumn (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) и [sp_repldropcolumn (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="81432-200">If Subscribers are running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] or the compatibility level is less than 90RTM you can use [sp_repladdcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repladdcolumn-transact-sql) and [sp_repldropcolumn &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-repldropcolumn-transact-sql) to add and drop columns.</span></span> <span data-ttu-id="81432-201">Однако эти процедуры являются устаревшими.</span><span class="sxs-lookup"><span data-stu-id="81432-201">However, these procedures are deprecated.</span></span>  
  
    -   <span data-ttu-id="81432-202">Если попытаться добавить в существующую статью столбец с типом данных, появившимся в [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)], то [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] будет вести себя следующим образом.</span><span class="sxs-lookup"><span data-stu-id="81432-202">If you try to add to an existing article a column with a data type that was introduced in [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)], [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] has the following behavior:</span></span>  
  
        ||<span data-ttu-id="81432-203">100RTM, собственный режим моментального снимка</span><span class="sxs-lookup"><span data-stu-id="81432-203">100RTM, native snapshot</span></span>|<span data-ttu-id="81432-204">100RTM, символьный режим моментального снимка</span><span class="sxs-lookup"><span data-stu-id="81432-204">100RTM, character snapshot</span></span>|<span data-ttu-id="81432-205">Все другие уровни совместимости</span><span class="sxs-lookup"><span data-stu-id="81432-205">All other compatibility levels</span></span>|  
        |-|-----------------------------|--------------------------------|------------------------------------|  
        |`hierarchyid`|<span data-ttu-id="81432-206">Разрешить изменения</span><span class="sxs-lookup"><span data-stu-id="81432-206">Allow change</span></span>|<span data-ttu-id="81432-207">Блокировать изменения</span><span class="sxs-lookup"><span data-stu-id="81432-207">Block change</span></span>|<span data-ttu-id="81432-208">Блокировать изменения</span><span class="sxs-lookup"><span data-stu-id="81432-208">Block change</span></span>|  
        |<span data-ttu-id="81432-209">`geography` и `geometry`</span><span class="sxs-lookup"><span data-stu-id="81432-209">`geography` and `geometry`</span></span>|<span data-ttu-id="81432-210">Разрешить изменения</span><span class="sxs-lookup"><span data-stu-id="81432-210">Allow change</span></span>|<span data-ttu-id="81432-211">Разрешить изменение<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="81432-211">Allow change<sup>1</sup></span></span>|<span data-ttu-id="81432-212">Блокировать изменения</span><span class="sxs-lookup"><span data-stu-id="81432-212">Block change</span></span>|  
        |`filestream`|<span data-ttu-id="81432-213">Разрешить изменения</span><span class="sxs-lookup"><span data-stu-id="81432-213">Allow change</span></span>|<span data-ttu-id="81432-214">Блокировать изменения</span><span class="sxs-lookup"><span data-stu-id="81432-214">Block change</span></span>|<span data-ttu-id="81432-215">Блокировать изменения</span><span class="sxs-lookup"><span data-stu-id="81432-215">Block change</span></span>|  
        |<span data-ttu-id="81432-216">`date`, `time`, `datetime2` и `datetimeoffset`</span><span class="sxs-lookup"><span data-stu-id="81432-216">`date`, `time`, `datetime2`, and `datetimeoffset`</span></span>|<span data-ttu-id="81432-217">Разрешить изменения</span><span class="sxs-lookup"><span data-stu-id="81432-217">Allow change</span></span>|<span data-ttu-id="81432-218">Разрешить изменение<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="81432-218">Allow change<sup>1</sup></span></span>|<span data-ttu-id="81432-219">Блокировать изменения</span><span class="sxs-lookup"><span data-stu-id="81432-219">Block change</span></span>|  
  
         <span data-ttu-id="81432-220"><sup>1</sup> SQL Server Compact подписчики преобразуют эти типы данных на подписчике.</span><span class="sxs-lookup"><span data-stu-id="81432-220"><sup>1</sup> SQL Server Compact Subscribers convert these data types at the Subscriber.</span></span>  
  
-   <span data-ttu-id="81432-221">Если при применении изменения схемы возникает ошибка (например, ошибка по причине добавления внешнего ключа, ссылающегося на таблицу, которая недоступна на подписчике), синхронизация завершается ошибкой, и подписка должна быть инициализирована повторно.</span><span class="sxs-lookup"><span data-stu-id="81432-221">If an error occurs when applying a schema change (such as an error resulting from adding a foreign key that references a table not available at the Subscriber), synchronization fails and the subscription must be reinitialized.</span></span>  
  
-   <span data-ttu-id="81432-222">Если изменение схемы выполняется в столбце, входящем в фильтр соединения или параметризованный фильтр, потребуется повторно инициализировать все подписки и заново создать моментальный снимок.</span><span class="sxs-lookup"><span data-stu-id="81432-222">If a schema change is made on a column involved in a join filter or parameterized filter, you must reinitialize all subscriptions and regenerate the snapshot.</span></span>  
  
-   <span data-ttu-id="81432-223">Репликация слиянием обеспечивает игнорирование хранимыми процедурами изменений схемы во время устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="81432-223">Merge replication provides stored procedures to skip schema changes during troubleshooting.</span></span> <span data-ttu-id="81432-224">Дополнительные сведения см. в статьях [sp_markpendingschemachange (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-markpendingschemachange-transact-sql) и [sp_enumeratependingschemachanges (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-enumeratependingschemachanges-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="81432-224">For more information, see [sp_markpendingschemachange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-markpendingschemachange-transact-sql) and [sp_enumeratependingschemachanges &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-enumeratependingschemachanges-transact-sql).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="81432-225">См. также:</span><span class="sxs-lookup"><span data-stu-id="81432-225">See Also</span></span>  
 <span data-ttu-id="81432-226">[ALTER TABLE (Transact-SQL)](/sql/t-sql/statements/alter-table-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="81432-226">[ALTER TABLE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-table-transact-sql) </span></span>  
 <span data-ttu-id="81432-227">[ALTER VIEW (Transact-SQL)](/sql/t-sql/statements/alter-view-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="81432-227">[ALTER VIEW &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-view-transact-sql) </span></span>  
 <span data-ttu-id="81432-228">[ALTER PROCEDURE (Transact-SQL)](/sql/t-sql/statements/alter-procedure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="81432-228">[ALTER PROCEDURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-procedure-transact-sql) </span></span>  
 <span data-ttu-id="81432-229">[ALTER FUNCTION (Transact-SQL)](/sql/t-sql/statements/alter-function-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="81432-229">[ALTER FUNCTION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-function-transact-sql) </span></span>  
 <span data-ttu-id="81432-230">[ALTER TRIGGER (Transact-SQL)](/sql/t-sql/statements/alter-trigger-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="81432-230">[ALTER TRIGGER &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-trigger-transact-sql) </span></span>  
 <span data-ttu-id="81432-231">[Публикация данных и объектов базы данных](publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="81432-231">[Publish Data and Database Objects](publish-data-and-database-objects.md) </span></span>  
 <span data-ttu-id="81432-232">[Regenerate Custom Transactional Procedures to Reflect Schema Changes](../transactional/transactional-articles-regenerate-to-reflect-schema-changes.md) (Повторное создание пользовательских процедур транзакций для отражения изменений схем)</span><span class="sxs-lookup"><span data-stu-id="81432-232">[Regenerate Custom Transactional Procedures to Reflect Schema Changes](../transactional/transactional-articles-regenerate-to-reflect-schema-changes.md)</span></span>  
  
  
