---
title: Репликация секционированных таблиц и индексов | Документация Майкрософт
ms.custom: ''
ms.date: 09/10/2015
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- partitioned indexes [SQL Server], replicating
- partitioned tables [SQL Server], replicating
- replication [SQL Server], partitioned tables
- publishing [SQL Server replication], partitioned tables
- transactional replication, partitioned tables
ms.assetid: c9fa81b1-6c81-4c11-927b-fab16301a8f5
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 616707bfb11b48b170fc8f0e8872076d2cd09d1c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87656312"
---
# <a name="replicate-partitioned-tables-and-indexes"></a><span data-ttu-id="5c83a-102">Репликация секционированных таблиц и индексов</span><span class="sxs-lookup"><span data-stu-id="5c83a-102">Replicate Partitioned Tables and Indexes</span></span>
  <span data-ttu-id="5c83a-103">Секционирование делает большие таблицы и индексы более управляемыми, так как позволяет быстро и эффективно получать доступ к подмножествам данных и управлять ими, при этом сохраняя целостность всей коллекции данных.</span><span class="sxs-lookup"><span data-stu-id="5c83a-103">Partitioning makes large tables or indexes more manageable because partitioning enables you to manage and access subsets of data quickly and efficiently, and maintain the integrity of a data collection at the same time.</span></span> <span data-ttu-id="5c83a-104">Дополнительные сведения см. в разделе [Partitioned Tables and Indexes](../../partitions/partitioned-tables-and-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="5c83a-104">For more information, see [Partitioned Tables and Indexes](../../partitions/partitioned-tables-and-indexes.md).</span></span> <span data-ttu-id="5c83a-105">Репликация поддерживает секционирование, предоставляя набор свойств, которые указывают, как работать с секционированными таблицами и индексами.</span><span class="sxs-lookup"><span data-stu-id="5c83a-105">Replication supports partitioning by providing a set of properties that specify how partitioned tables and indexes should be treated.</span></span>  
  
## <a name="article-properties-for-transactional-and-merge-replication"></a><span data-ttu-id="5c83a-106">Свойства статьи для репликации слиянием и репликации транзакций</span><span class="sxs-lookup"><span data-stu-id="5c83a-106">Article Properties for Transactional and Merge Replication</span></span>  
 <span data-ttu-id="5c83a-107">В таблице перечислены объекты, применяемые для секционирования данных.</span><span class="sxs-lookup"><span data-stu-id="5c83a-107">The following table lists the objects that are used to partition data.</span></span>  
  
|<span data-ttu-id="5c83a-108">Объект</span><span class="sxs-lookup"><span data-stu-id="5c83a-108">Object</span></span>|<span data-ttu-id="5c83a-109">Создан с помощью</span><span class="sxs-lookup"><span data-stu-id="5c83a-109">Created by using</span></span>|  
|------------|----------------------|  
|<span data-ttu-id="5c83a-110">Секционированная таблица или индекс</span><span class="sxs-lookup"><span data-stu-id="5c83a-110">Partitioned table or index</span></span>|<span data-ttu-id="5c83a-111">CREATE TABLE или CREATE INDEX</span><span class="sxs-lookup"><span data-stu-id="5c83a-111">CREATE TABLE or CREATE INDEX</span></span>|  
|<span data-ttu-id="5c83a-112">Функция секционирования</span><span class="sxs-lookup"><span data-stu-id="5c83a-112">Partition function</span></span>|<span data-ttu-id="5c83a-113">CREATE PARTITION FUNCTION</span><span class="sxs-lookup"><span data-stu-id="5c83a-113">CREATE PARTITION FUNCTION</span></span>|  
|<span data-ttu-id="5c83a-114">Схема секционирования</span><span class="sxs-lookup"><span data-stu-id="5c83a-114">Partition scheme</span></span>|<span data-ttu-id="5c83a-115">CREATE PARTITION SCHEME</span><span class="sxs-lookup"><span data-stu-id="5c83a-115">CREATE PARTITION SCHEME</span></span>|  
  
 <span data-ttu-id="5c83a-116">Первый набор свойств, связанных с секционированием, — параметры схемы статьи, определяющие, следует ли копировать объекты секционирования в экземпляр подписчика.</span><span class="sxs-lookup"><span data-stu-id="5c83a-116">The first set of properties related to partitioning are the article schema options that determine whether partitioning objects should be copied to the Subscriber.</span></span> <span data-ttu-id="5c83a-117">Эти параметры схемы могут быть установлены следующими способами.</span><span class="sxs-lookup"><span data-stu-id="5c83a-117">These schema options can be set in the following ways:</span></span>  
  
-   <span data-ttu-id="5c83a-118">На странице **Свойства статьи** мастера создания публикаций или в диалоговом окне «Свойства публикации».</span><span class="sxs-lookup"><span data-stu-id="5c83a-118">In the **Article Properties** page of the New Publication Wizard or the Publication Properties dialog box.</span></span> <span data-ttu-id="5c83a-119">Чтобы скопировать объекты, перечисленные в предыдущей таблице, укажите значение `true` для свойств **копирование схем секционирования таблицы** и **копирование схем секционирования индекса**.</span><span class="sxs-lookup"><span data-stu-id="5c83a-119">To copy the objects listed in the previous table, specify a value of `true` for the properties **Copy table partitioning schemes** and **Copy index partitioning schemes**.</span></span> <span data-ttu-id="5c83a-120">Сведения о доступе к странице **Свойства статьи** см. в статье [Просмотр и изменение свойств публикации](view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="5c83a-120">For information about how to access the **Article Properties** page, see [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
-   <span data-ttu-id="5c83a-121">С помощью параметра *schema_option* одной из следующих хранимых процедур:</span><span class="sxs-lookup"><span data-stu-id="5c83a-121">By using the *schema_option* parameter of one of the following stored procedures:</span></span>  
  
    -   <span data-ttu-id="5c83a-122">[sp_addarticle](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) или [sp_changearticle](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql) для репликации транзакций;</span><span class="sxs-lookup"><span data-stu-id="5c83a-122">[sp_addarticle](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) or [sp_changearticle](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql) for transactional replication</span></span>  
  
    -   <span data-ttu-id="5c83a-123">[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) или [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) для репликации слиянием.</span><span class="sxs-lookup"><span data-stu-id="5c83a-123">[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) or [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) for merge replication</span></span>  
  
     <span data-ttu-id="5c83a-124">Чтобы копировать объекты, перечисленные в предыдущей таблице, выберите соответствующие значения параметров схемы.</span><span class="sxs-lookup"><span data-stu-id="5c83a-124">To copy the objects listed in the previous table, specify the appropriate schema option values.</span></span> <span data-ttu-id="5c83a-125">Дополнительные сведения об указании параметров схемы см. в разделе [Specify Schema Options](specify-schema-options.md).</span><span class="sxs-lookup"><span data-stu-id="5c83a-125">For information about how to specify schema options, see [Specify Schema Options](specify-schema-options.md).</span></span>  
  
 <span data-ttu-id="5c83a-126">Репликация копирует объекты на подписчик во время начальной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="5c83a-126">Replication copies objects to the Subscriber during the initial synchronization.</span></span> <span data-ttu-id="5c83a-127">Если схема секционирования использует файловые группы, отличные от PRIMARY, эти файловые группы должны существовать на подписчике до начальной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="5c83a-127">If the partition scheme uses filegroups other than the PRIMARY filegroup, those filegroups must exist on the Subscriber before the initial synchronization.</span></span>  
  
 <span data-ttu-id="5c83a-128">После инициализации подписчика изменения данных распространяются на подписчик и применяются к соответствующим секциям.</span><span class="sxs-lookup"><span data-stu-id="5c83a-128">After the Subscriber is initialized, data changes are propagated to the Subscriber and applied to the appropriate partitions.</span></span> <span data-ttu-id="5c83a-129">Однако изменения схемы секционирования не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="5c83a-129">However, changes to the partition scheme are not supported.</span></span> <span data-ttu-id="5c83a-130">Репликация транзакций и репликация слиянием не поддерживают репликацию следующих команд: ALTER PARTITION FUNCTION, ALTER PARTITION SCHEME, а также инструкции REBUILD WITH PARTITION команды ALTER INDEX.</span><span class="sxs-lookup"><span data-stu-id="5c83a-130">Transactional and merge replication do not support replicating the following commands: ALTER PARTITION FUNCTION, ALTER PARTITION SCHEME, or the REBUILD WITH PARTITION statement of ALTER INDEX.</span></span>  <span data-ttu-id="5c83a-131">Изменения, связанные с ними, не будут автоматически реплицироваться на подписчика.</span><span class="sxs-lookup"><span data-stu-id="5c83a-131">The changes associated with them will not be automatically replicated to the Subscriber.</span></span> <span data-ttu-id="5c83a-132">Пользователь должен вручную внести соответствующие изменения.</span><span class="sxs-lookup"><span data-stu-id="5c83a-132">It is the responsibility of the user to make similar changes manually at the Subscriber.</span></span>  
  
## <a name="replication-support-for-partition-switching"></a><span data-ttu-id="5c83a-133">Поддержка переключения секций при репликации</span><span class="sxs-lookup"><span data-stu-id="5c83a-133">Replication Support for Partition Switching</span></span>  
 <span data-ttu-id="5c83a-134">Одно из главных преимуществ секционирования — способность быстро и эффективно перемещать подмножества данных между секциями.</span><span class="sxs-lookup"><span data-stu-id="5c83a-134">One of the key benefits of table partitioning is the ability to quickly and efficiently move subsets of data between partitions.</span></span> <span data-ttu-id="5c83a-135">Данные перемещаются командой SWITCH PARTITION.</span><span class="sxs-lookup"><span data-stu-id="5c83a-135">Data is moved by using the SWITCH PARTITION command.</span></span> <span data-ttu-id="5c83a-136">По умолчанию, если таблица включена для репликации, операции SWITCH PARTITION блокированы по следующим причинам.</span><span class="sxs-lookup"><span data-stu-id="5c83a-136">By default, when a table is enabled for replication, SWITCH PARTITION operations are blocked for the following reasons:</span></span>  
  
-   <span data-ttu-id="5c83a-137">Если данные перемещаются в таблицу или из таблицы, которая существует на издателе, но не на подписчике, издатель и подписчик могут оказаться несогласованными друг с другом.</span><span class="sxs-lookup"><span data-stu-id="5c83a-137">If data is moved into or out of a table that exists at the Publisher but does not exist at the Subscriber, the Publisher and Subscriber could become inconsistent with one another.</span></span> <span data-ttu-id="5c83a-138">Эта проблема обычно возникает при перемещении данных в промежуточную таблицу или из нее.</span><span class="sxs-lookup"><span data-stu-id="5c83a-138">This problem typically occurs when data is moved into or out of a staging table.</span></span>  
  
-   <span data-ttu-id="5c83a-139">Если определение секционированной таблицы отличается на подписчике и издателе, агент распространителя завершит свою работу ошибкой при попытке применить изменения на подписчике.</span><span class="sxs-lookup"><span data-stu-id="5c83a-139">If the Subscriber has a different definition for the partitioned table than the Publisher, the Distribution Agent will fail when it tries to apply changes at the Subscriber.</span></span>  
  
 <span data-ttu-id="5c83a-140">Несмотря на эти возможные проблемы, переключение секций можно включить при репликации транзакций.</span><span class="sxs-lookup"><span data-stu-id="5c83a-140">Despite these potential issues, partition switching can be enabled for transactional replication.</span></span> <span data-ttu-id="5c83a-141">Прежде чем включить переключение секций, убедитесь, что все таблицы, участвующие в переключении секций, существуют на издателе и на подписчике и что определения таблиц и разделов совпадают.</span><span class="sxs-lookup"><span data-stu-id="5c83a-141">Before you enable partition switching, make sure that all tables that are involved in partition switching exist at the Publisher and Subscriber, and make sure that the table and partition definitions are the same.</span></span>  
  
 <span data-ttu-id="5c83a-142">Если все секции имеют одинаковую схему на издателях и подписчиках, можно включить параметр *allow_partition_switch* вместе с *replication_partition_switch* , что позволит выполнить репликацию только инструкции о смене секции для подписчика.</span><span class="sxs-lookup"><span data-stu-id="5c83a-142">When partitions have the exact same partition scheme at the publishers and subscribers you can turn on *allow_partition_switch* along with *replication_partition_switch* which will only replicate the partition switch statement to the subscriber.</span></span> <span data-ttu-id="5c83a-143">Можно также включить параметр *allow_partition_switch* без репликации DDL.</span><span class="sxs-lookup"><span data-stu-id="5c83a-143">You can also turn on *allow_partition_switch* without replicating the DDL.</span></span> <span data-ttu-id="5c83a-144">Это полезно, когда из раздела требуется убрать сведения за прошлые месяцы, однако сохранить реплицированную секцию в течение следующего года в целях резервного копирования на подписчике.</span><span class="sxs-lookup"><span data-stu-id="5c83a-144">This is useful in the case where you want to roll old months out of the partition but keep the replicated partition in place for another year for backup purposes at the subscriber.</span></span>  
  
 <span data-ttu-id="5c83a-145">При включении переключения секций в SQL Server 2008 R2 через текущую версию вам могут также потребоваться операции разбиения и слияния в ближайшем будущем.</span><span class="sxs-lookup"><span data-stu-id="5c83a-145">If you enable partition switching on SQL Server 2008 R2 through the current version, you might also need split and merge operations in near future.</span></span> <span data-ttu-id="5c83a-146">Перед выполнением разбиения или слияния секций в реплицированной таблице убедитесь, что нужная секция не содержит реплицированные команды в режиме ожидания.</span><span class="sxs-lookup"><span data-stu-id="5c83a-146">Before executing a split or merge operation on a replicated table ensure that the partition in question does not have any pending replicated commands.</span></span> <span data-ttu-id="5c83a-147">Также следует учитывать, что при разбиении или слиянии в секции не должны выполняться операции DML.</span><span class="sxs-lookup"><span data-stu-id="5c83a-147">You should also ensure that no DML operations are executed on the partition during the split and merge operations.</span></span> <span data-ttu-id="5c83a-148">Наличие транзакций, не обработанных агентом чтения журнала, или выполнение операций DML в секции реплицируемой таблицы во время выполнения операции разбиения или слияния (с использованием одной секции) может привести к ошибке обработки агентом чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="5c83a-148">If there are transactions which the log reader has not processed, or if DML operations are performed on a partition of a replicated table while a split or merge operation is executed (involving the same partition), it could lead to a processing error with log reader agent.</span></span> <span data-ttu-id="5c83a-149">Чтобы ее исправить , может потребоваться повторная инициализация подписки.</span><span class="sxs-lookup"><span data-stu-id="5c83a-149">In order to correct the error, it might require a re-initialization of the subscription.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="5c83a-150">Не нужно включать переключения секций для одноранговых публикаций из-за наличия скрытых столбцов, используемых для обнаружения и разрешения конфликтов.</span><span class="sxs-lookup"><span data-stu-id="5c83a-150">You should not enable partition switching for Peer-to-Peer publications, due to the hidden column which is used to detect and resolve conflict.</span></span>  
  
### <a name="enabling-partition-switching"></a><span data-ttu-id="5c83a-151">Включение переключения секций</span><span class="sxs-lookup"><span data-stu-id="5c83a-151">Enabling Partition Switching</span></span>  
 <span data-ttu-id="5c83a-152">Следующие свойства публикации транзакций позволяют пользователям управлять переключением секций в реплицируемой среде.</span><span class="sxs-lookup"><span data-stu-id="5c83a-152">The following properties for transactional publications enable users to control the behavior of partition switching in a replicated environment:</span></span>  
  
-   <span data-ttu-id="5c83a-153">\*\* \@ allow_partition_switch\*\*, если задано значение `true` , Переключить секцию можно выполнить в базе данных публикации.</span><span class="sxs-lookup"><span data-stu-id="5c83a-153">**\@allow_partition_switch**, when set to `true`, SWITCH PARTITION can be executed against the publication database.</span></span>  
  
-   <span data-ttu-id="5c83a-154">\*\* \@ replicate_partition_switch\*\* определяет, должна ли инструкция DDL SWITCH PARTITION реплицироваться подписчикам.</span><span class="sxs-lookup"><span data-stu-id="5c83a-154">**\@replicate_partition_switch** determines whether the SWITCH PARTITION DDL statement should be replicated to Subscribers.</span></span> <span data-ttu-id="5c83a-155">Этот параметр допустим, только если \*\* \@ allow_partition_switch\*\* имеет значение `true` .</span><span class="sxs-lookup"><span data-stu-id="5c83a-155">This option is valid only when **\@allow_partition_switch** is set to `true`.</span></span>  
  
 <span data-ttu-id="5c83a-156">Эти свойства можно задать с помощью хранимой процедуры [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql) при создании публикации или с помощью процедуры [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) после создания публикации.</span><span class="sxs-lookup"><span data-stu-id="5c83a-156">You can set these properties by using [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql) when the publication is created, or by using [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) after the publication is created.</span></span> <span data-ttu-id="5c83a-157">Как уже отмечалось, репликация слиянием не поддерживает переключение секций.</span><span class="sxs-lookup"><span data-stu-id="5c83a-157">As noted earlier, merge replication does not support partition switching.</span></span> <span data-ttu-id="5c83a-158">Чтобы выполнить команду SWITCH PARTITION для таблицы, для которой включена репликация слиянием, удалите эту таблицу из публикации.</span><span class="sxs-lookup"><span data-stu-id="5c83a-158">To execute SWITCH PARTITION on a table that is enabled for merge replication, remove the table from the publication.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5c83a-159">См. также:</span><span class="sxs-lookup"><span data-stu-id="5c83a-159">See Also</span></span>  
 [<span data-ttu-id="5c83a-160">Публикация данных и объектов базы данных</span><span class="sxs-lookup"><span data-stu-id="5c83a-160">Publish Data and Database Objects</span></span>](publish-data-and-database-objects.md)  
  
  
