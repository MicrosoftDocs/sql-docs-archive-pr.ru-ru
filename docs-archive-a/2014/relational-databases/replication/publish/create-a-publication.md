---
title: Создание публикации | Документация Майкрософт
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], creating
- articles [SQL Server replication], defining
- adding articles
- articles [SQL Server replication], adding
ms.assetid: 52ee6de9-1d58-4cb9-8711-372bddbe7154
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 14d8b3f1a998b18ae0153c1771fa11afd925da9c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87668780"
---
# <a name="create-a-publication"></a><span data-ttu-id="d6542-102">Create a Publication</span><span class="sxs-lookup"><span data-stu-id="d6542-102">Create a Publication</span></span>
  <span data-ttu-id="d6542-103">В данном разделе описывается процесс создания публикации в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)]или объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="d6542-103">This topic describes how to create a publication in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
 <span data-ttu-id="d6542-104">**В этом разделе**</span><span class="sxs-lookup"><span data-stu-id="d6542-104">**In This Topic**</span></span>  
  
-   <span data-ttu-id="d6542-105">**Перед началом работы**</span><span class="sxs-lookup"><span data-stu-id="d6542-105">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="d6542-106">Ограничения</span><span class="sxs-lookup"><span data-stu-id="d6542-106">Limitations and Restrictions</span></span>](#Restrictions)  
  
     [<span data-ttu-id="d6542-107">Безопасность</span><span class="sxs-lookup"><span data-stu-id="d6542-107">Security</span></span>](#Security)  
  
-   <span data-ttu-id="d6542-108">**Для создания публикации и определения статей используется:**</span><span class="sxs-lookup"><span data-stu-id="d6542-108">**To create a publication and define articles, using:**</span></span>  
  
     [<span data-ttu-id="d6542-109">Среда SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d6542-109">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="d6542-110">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d6542-110">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="d6542-111">объекты RMO;</span><span class="sxs-lookup"><span data-stu-id="d6542-111">Replication Management Objects (RMO)</span></span>](#RMOProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="d6542-112">Перед началом</span><span class="sxs-lookup"><span data-stu-id="d6542-112">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="d6542-113">Ограничения</span><span class="sxs-lookup"><span data-stu-id="d6542-113">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="d6542-114">Названия публикаций и статей не могут содержать следующие символы: %, \*, [ , ], |, :, ", ?</span><span class="sxs-lookup"><span data-stu-id="d6542-114">Publication and article names cannot include any of the following characters: % , \* , [ , ] , | , : , " , ?</span></span> <span data-ttu-id="d6542-115">, ' , \ , / , \< , >.</span><span class="sxs-lookup"><span data-stu-id="d6542-115">, ' , \ , / , \< , >.</span></span> <span data-ttu-id="d6542-116">Если объекты в базе данных, содержащие любые из этих символов, нужно реплицировать, то в диалоговом окне **\<Article>Свойства статьи —** , которое доступно на странице **Статьи** мастера, нужно задать имя статьи, отличающееся от имени объекта.</span><span class="sxs-lookup"><span data-stu-id="d6542-116">If objects in the database include any of these characters and you want to replicate them, you must specify an article name that is different from the object name in the **Article Properties - \<Article>** dialog box, which is available from the **Articles** page in the wizard.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="d6542-117">безопасность</span><span class="sxs-lookup"><span data-stu-id="d6542-117">Security</span></span>  
 <span data-ttu-id="d6542-118">По возможности предлагайте пользователям вводить учетные данные системы безопасности во время выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="d6542-118">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="d6542-119">Если необходимо хранить учетные данные, используйте [службы шифрования](https://go.microsoft.com/fwlink/?LinkId=34733) , предоставляемые платформой [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d6542-119">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="d6542-120">Использование среды SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d6542-120">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="d6542-121">Создание публикаций и определение статей осуществляется с помощью мастера создания публикаций.</span><span class="sxs-lookup"><span data-stu-id="d6542-121">Create publications and define articles with the New Publication Wizard.</span></span> <span data-ttu-id="d6542-122">После создания публикации ее свойства можно просмотреть и изменить в диалоговом окне **Свойства публикации — \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="d6542-122">After a publication is created, view and modify publication properties in the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="d6542-123">Дополнительные сведения о создании публикаций из базы данных Oracle вы найдете в [этой статье](create-a-publication-from-an-oracle-database.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-123">For information about creating a publication from an Oracle database, see [Create a Publication from an Oracle Database](create-a-publication-from-an-oracle-database.md).</span></span>  
  
#### <a name="to-create-a-publication-and-define-articles"></a><span data-ttu-id="d6542-124">Создание публикации и определение статей</span><span class="sxs-lookup"><span data-stu-id="d6542-124">To create a publication and define articles</span></span>  
  
1.  <span data-ttu-id="d6542-125">Подключитесь к издателю в среде [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], а затем раскройте узел сервера.</span><span class="sxs-lookup"><span data-stu-id="d6542-125">Connect to the Publisher in [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="d6542-126">Раскройте папку **Репликация** , а затем щелкните правой кнопкой мыши папку **Локальные публикации** .</span><span class="sxs-lookup"><span data-stu-id="d6542-126">Expand the **Replication** folder, and then right-click the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="d6542-127">Щелкните **Создать публикацию**.</span><span class="sxs-lookup"><span data-stu-id="d6542-127">Click **New Publication**.</span></span>  
  
4.  <span data-ttu-id="d6542-128">Следуйте указаниям на страницах мастера создания публикаций, чтобы:</span><span class="sxs-lookup"><span data-stu-id="d6542-128">Follow the pages in the New Publication Wizard to:</span></span>  
  
    -   <span data-ttu-id="d6542-129">задать распространитель, если распространение не было настроено на сервере.</span><span class="sxs-lookup"><span data-stu-id="d6542-129">Specify a Distributor if distribution has not been configured on the server.</span></span> <span data-ttu-id="d6542-130">Дополнительные сведения о настройке распространения см. в статье [Настройка публикации и распространения](../configure-publishing-and-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-130">For more information about configuring distribution, see [Configure Publishing and Distribution](../configure-publishing-and-distribution.md).</span></span>  
  
         <span data-ttu-id="d6542-131">Если на странице **Распространитель** вы задаете, что сервер издателя буде функционировать как свой собственный распространитель (локальный распространитель), а сервер не настроен в качестве распространителя, то мастер создания публикаций произведет настройку сервера.</span><span class="sxs-lookup"><span data-stu-id="d6542-131">If you specify on the **Distributor** page that the Publisher server will act as its own Distributor (a local Distributor), and the server is not configured as a Distributor, the New Publication Wizard will configure the server.</span></span> <span data-ttu-id="d6542-132">Нужно будет задать для распространителя папку моментальных снимков по умолчанию на странице **Папка моментальных снимков** .</span><span class="sxs-lookup"><span data-stu-id="d6542-132">You will specify a default snapshot folder for the Distributor on the **Snapshot Folder** page.</span></span> <span data-ttu-id="d6542-133">Папка моментальных снимков — это просто каталог, назначенный для совместного использования; агенты, считывающие и записывающие данные в эту папку, должны иметь достаточные разрешения для доступа к ней.</span><span class="sxs-lookup"><span data-stu-id="d6542-133">The snapshot folder is simply a directory that you have designated as a share; agents that read from and write to this folder must have sufficient permissions to access it.</span></span> <span data-ttu-id="d6542-134">Дополнительные сведения о надлежащей защите папок см. в статье [Организация безопасности папки моментальных снимков](../security/secure-the-snapshot-folder.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-134">For more information about securing the folder appropriately, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
         <span data-ttu-id="d6542-135">Если задано, что в качестве распространителя будет функционировать другой сервер, необходимо ввести пароль на странице **Административный пароль** для соединений, устанавливаемых между издателем и распространителем.</span><span class="sxs-lookup"><span data-stu-id="d6542-135">If you specify that another server should act as the Distributor, you must enter a password on the **Administrative Password** page for connections made from the Publisher to the Distributor.</span></span> <span data-ttu-id="d6542-136">Пароль должен совпадать с паролем, указанным при включении издателя на удаленном распространителе.</span><span class="sxs-lookup"><span data-stu-id="d6542-136">This password must match the password specified when the Publisher was enabled at the remote Distributor.</span></span>  
  
         <span data-ttu-id="d6542-137">Дополнительные сведения см. в разделе [Configure Distribution](../configure-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-137">For more information, see [Configure Distribution](../configure-distribution.md).</span></span>  
  
    -   <span data-ttu-id="d6542-138">Выберите базу данных публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-138">Choose a publication database.</span></span>  
  
    -   <span data-ttu-id="d6542-139">Выберите тип публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-139">Select a publication type.</span></span> <span data-ttu-id="d6542-140">Дополнительные сведения см. в статье [Типы репликации](../types-of-replication.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-140">For more information, see [Types of Replication](../types-of-replication.md).</span></span>  
  
    -   <span data-ttu-id="d6542-141">Задайте данные и объекты базы данных для публикации. При необходимости отфильтруйте столбцы из статей таблиц и установите свойства статей.</span><span class="sxs-lookup"><span data-stu-id="d6542-141">Specify data and database objects to publish; optionally filter columns from table articles, and set article properties.</span></span>  
  
    -   <span data-ttu-id="d6542-142">Если требуется, отфильтруйте строки из статей таблиц.</span><span class="sxs-lookup"><span data-stu-id="d6542-142">Optionally filter rows from table articles.</span></span> <span data-ttu-id="d6542-143">Дополнительные сведения см. в статье [Фильтрация опубликованных данных](filter-published-data.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-143">For more information, see [Filter Published Data](filter-published-data.md).</span></span>  
  
    -   <span data-ttu-id="d6542-144">Настройте расписание для агента моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="d6542-144">Set the Snapshot Agent schedule.</span></span>  
  
    -   <span data-ttu-id="d6542-145">Задайте учетные данные, под которыми следующие агенты репликации будут запускаться и устанавливать соединения:</span><span class="sxs-lookup"><span data-stu-id="d6542-145">Specify the credentials under which the following replication agents run and make connections:</span></span>  
  
         <span data-ttu-id="d6542-146">— агент моментальных снимков для всех публикаций;</span><span class="sxs-lookup"><span data-stu-id="d6542-146">\- Snapshot Agent for all publications.</span></span>  
  
         <span data-ttu-id="d6542-147">— агент чтения журнала для всех публикаций транзакций;</span><span class="sxs-lookup"><span data-stu-id="d6542-147">\- Log Reader Agent for all transactional publications.</span></span>  
  
         <span data-ttu-id="d6542-148">— агент чтения очереди для публикаций транзакций, допускающих обновление подписок.</span><span class="sxs-lookup"><span data-stu-id="d6542-148">\- Queue Reader Agent for transactional publications that allow updating subscriptions.</span></span>  
  
         <span data-ttu-id="d6542-149">Дополнительные сведения см. в разделах [Replication Agent Security Model](../security/replication-agent-security-model.md) и [Replication Security Best Practices](../security/replication-security-best-practices.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-149">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md) and [Replication Security Best Practices](../security/replication-security-best-practices.md).</span></span>  
  
    -   <span data-ttu-id="d6542-150">При необходимости создайте скрипт для публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-150">Optionally script the publication.</span></span> <span data-ttu-id="d6542-151">Дополнительные сведения см. в разделе [Scripting Replication](../scripting-replication.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-151">For more information, see [Scripting Replication](../scripting-replication.md).</span></span>  
  
    -   <span data-ttu-id="d6542-152">Задайте имя для публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-152">Specify a name for the publication.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="d6542-153">Использование Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d6542-153">Using Transact-SQL</span></span>  
 <span data-ttu-id="d6542-154">Создание публикации может быть произведено программным путем с помощью хранимых процедур репликации.</span><span class="sxs-lookup"><span data-stu-id="d6542-154">Publications can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="d6542-155">Какие именно хранимые процедуры должны для этого применяться, зависит от типа создаваемой публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-155">The stored procedures that are used will depend on the type of publication being created.</span></span>  
  
#### <a name="to-create-a-snapshot-or-transactional-publication"></a><span data-ttu-id="d6542-156">Создание публикации транзакций или моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="d6542-156">To create a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="d6542-157">Чтобы активировать публикацию текущей базы данных в репликации моментальных снимков или транзакций, в базе данных публикации на издателе выполните хранимую процедуру [sp_replicationdboption (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6542-157">At the Publisher on the publication database, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql) to enable publication of the current database using snapshot or transactional replication.</span></span>  
  
2.  <span data-ttu-id="d6542-158">Для публикации транзакций необходимо выяснить наличие задания агента чтения журнала для базы данных публикации</span><span class="sxs-lookup"><span data-stu-id="d6542-158">For a transactional publication, determine whether a Log Reader Agent job exists for the publication database.</span></span> <span data-ttu-id="d6542-159">(этот шаг необязателен для публикаций моментальных снимков).</span><span class="sxs-lookup"><span data-stu-id="d6542-159">(This step is not required for snapshot publications.)</span></span>  
  
    -   <span data-ttu-id="d6542-160">Если задание агента чтения журнала для указанной базы данных публикации уже существует, перейдите к шагу 3.</span><span class="sxs-lookup"><span data-stu-id="d6542-160">If a Log Reader Agent job exists for the publication database, proceed to step 3.</span></span>  
  
    -   <span data-ttu-id="d6542-161">Если неизвестно, существует ли задание агента чтения журнала для публикуемой базы данных, выполните процедуру [sp_helplogreader_agent (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-helplogreader-agent-transact-sql) на издателе в базе данных издателя.</span><span class="sxs-lookup"><span data-stu-id="d6542-161">If you are unsure whether a Log Reader Agent job exists for a published database, execute [sp_helplogreader_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helplogreader-agent-transact-sql) at the Publisher on the publication database.</span></span>  
  
    -   <span data-ttu-id="d6542-162">Если результирующий набор пуст, необходимо создать задание агента чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="d6542-162">If the result set is empty, create a Log Reader Agent job.</span></span> <span data-ttu-id="d6542-163">На издателе выполните процедуру [sp_addlogreader_agent (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addlogreader-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6542-163">At the Publisher, execute [sp_addlogreader_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addlogreader-agent-transact-sql).</span></span> <span data-ttu-id="d6542-164">Укажите в параметрах **\@job_name** и **\@password** учетные данные [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows, с которыми работает агент.</span><span class="sxs-lookup"><span data-stu-id="d6542-164">Specify the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows credentials under which the agent runs for **\@job_name** and **\@password**.</span></span> <span data-ttu-id="d6542-165">Если агент будет использовать проверку подлинности SQL Server для подключения к издателю, также необходимо указать значение **0** в параметре **\@publisher_security_mode** и данные входа [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в параметрах **\@publisher_login** и **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="d6542-165">If the agent will use SQL Server Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="d6542-166">Перейдите к шагу 3.</span><span class="sxs-lookup"><span data-stu-id="d6542-166">Proceed to step 3.</span></span>  
  
3.  <span data-ttu-id="d6542-167">На издателе выполните процедуру [sp_addpublication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6542-167">At the Publisher, execute [sp_addpublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span></span> <span data-ttu-id="d6542-168">Укажите имя публикации для \*\* \@ публикации**, а для параметра \*\* \@ repl_freq** укажите значение `snapshot` для публикации моментальных снимков или значение `continuous` для публикации транзакций.</span><span class="sxs-lookup"><span data-stu-id="d6542-168">Specify a publication name for **\@publication**, and, for the **\@repl_freq** parameter, specify a value of `snapshot` for a snapshot publication or a value of `continuous` for a transactional publication.</span></span> <span data-ttu-id="d6542-169">Укажите все остальные параметры публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-169">Specify any other publication options.</span></span> <span data-ttu-id="d6542-170">Таким образом будет определена публикация.</span><span class="sxs-lookup"><span data-stu-id="d6542-170">This defines the publication.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d6542-171">Имена публикаций не могут содержать следующие символы:</span><span class="sxs-lookup"><span data-stu-id="d6542-171">Publication names cannot include the following characters:</span></span>  
    >   
    >  <span data-ttu-id="d6542-172">% \* [ ] | : " ?</span><span class="sxs-lookup"><span data-stu-id="d6542-172">% \* [ ] | : " ?</span></span> <span data-ttu-id="d6542-173">\ / \< ></span><span class="sxs-lookup"><span data-stu-id="d6542-173">\ / \< ></span></span>  
  
4.  <span data-ttu-id="d6542-174">На издателе выполните процедуру [sp_addpublication_snapshot (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6542-174">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="d6542-175">Укажите имя публикации, использовавшееся в шаге 3, в параметре **\@publication**, а учетные данные Windows, с которыми работает агент моментальных снимков, — в параметрах **\@snapshot_job_name** и **\@password**.</span><span class="sxs-lookup"><span data-stu-id="d6542-175">Specify the publication name used in step 3 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@snapshot_job_name** and **\@password**.</span></span> <span data-ttu-id="d6542-176">Если агент будет использовать проверку подлинности SQL Server для подключения к издателю, также необходимо указать значение **0** в параметре **\@publisher_security_mode** и данные входа [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в параметрах **\@publisher_login** и **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="d6542-176">If the agent will use SQL Server Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="d6542-177">Будет создано задание агента моментальных снимков для публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-177">This creates a Snapshot Agent job for the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d6542-178">Если издатель настраивается с удаленным распространителем, то значения, передаваемые для всех аргументов, включая *job_login* и *job_password*, передаются распространителю в формате обычного (незашифрованного) текста.</span><span class="sxs-lookup"><span data-stu-id="d6542-178">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="d6542-179">Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="d6542-179">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="d6542-180">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-180">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
5.  <span data-ttu-id="d6542-181">Добавьте статьи к публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-181">Add articles to the publication.</span></span> <span data-ttu-id="d6542-182">Дополнительные сведения см. в статье [определить статью](define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-182">For more information, see [Define an Article](define-an-article.md).</span></span>  
  
6.  <span data-ttu-id="d6542-183">Запустите задание агента моментальных снимков, чтобы создать исходный моментальный снимок для этой публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-183">Start the Snapshot Agent job to generate the initial snapshot for this publication.</span></span> <span data-ttu-id="d6542-184">Дополнительные сведения см. в разделе [Create and Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-184">For more information, see [Create and Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md).</span></span>  
  
#### <a name="to-create-a-merge-publication"></a><span data-ttu-id="d6542-185">Создание публикации слиянием</span><span class="sxs-lookup"><span data-stu-id="d6542-185">To create a merge publication</span></span>  
  
1.  <span data-ttu-id="d6542-186">Чтобы активировать публикацию текущей базы в репликации слиянием, на издателе выполните хранимую процедуру [sp_replicationdboption (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6542-186">At the Publisher, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql) to enable publication of the current database using merge replication.</span></span>  
  
2.  <span data-ttu-id="d6542-187">На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergepublication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6542-187">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="d6542-188">Укажите имя публикации в параметре **\@publication**, а также все остальные параметры публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-188">Specify a name for the publication for **\@publication** and any other publication options.</span></span> <span data-ttu-id="d6542-189">Таким образом будет определена публикация.</span><span class="sxs-lookup"><span data-stu-id="d6542-189">This defines the publication.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d6542-190">Имена публикаций не могут содержать следующие символы:</span><span class="sxs-lookup"><span data-stu-id="d6542-190">Publication names cannot include the following characters:</span></span>  
    >   
    >  <span data-ttu-id="d6542-191">% \* [ ] | : " ?</span><span class="sxs-lookup"><span data-stu-id="d6542-191">% \* [ ] | : " ?</span></span> <span data-ttu-id="d6542-192">\ / \< ></span><span class="sxs-lookup"><span data-stu-id="d6542-192">\ / \< ></span></span>  
  
3.  <span data-ttu-id="d6542-193">На издателе выполните процедуру [sp_addpublication_snapshot (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6542-193">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="d6542-194">Укажите имя публикации, использовавшееся в шаге 2, в параметре **\@publication**, а учетные данные Windows, с которыми работает агент моментальных снимков, — в параметрах **\@snapshot_job_name** и **\@password**.</span><span class="sxs-lookup"><span data-stu-id="d6542-194">Specify the publication name used in step 2 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@snapshot_job_name** and **\@password**.</span></span> <span data-ttu-id="d6542-195">Если агент будет использовать проверку подлинности SQL Server для подключения к издателю, также необходимо указать значение **0** в параметре **\@publisher_security_mode** и данные входа [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в параметрах **\@publisher_login** и **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="d6542-195">If the agent will use SQL Server Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="d6542-196">Будет создано задание агента моментальных снимков для публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-196">This creates a Snapshot Agent job for the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d6542-197">Если издатель настраивается с удаленным распространителем, то значения, передаваемые для всех аргументов, включая *job_login* и *job_password*, передаются распространителю в формате обычного (незашифрованного) текста.</span><span class="sxs-lookup"><span data-stu-id="d6542-197">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="d6542-198">Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="d6542-198">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="d6542-199">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-199">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
4.  <span data-ttu-id="d6542-200">Добавьте статьи к публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-200">Add articles to the publication.</span></span> <span data-ttu-id="d6542-201">Дополнительные сведения см. в статье [определить статью](define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-201">For more information, see [Define an Article](define-an-article.md).</span></span>  
  
5.  <span data-ttu-id="d6542-202">Запустите задание агента моментальных снимков, чтобы создать исходный моментальный снимок для этой публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-202">Start the Snapshot Agent job to generate the initial snapshot for this publication.</span></span> <span data-ttu-id="d6542-203">Дополнительные сведения см. в разделе [Create and Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-203">For more information, see [Create and Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md).</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="d6542-204">Примеры (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="d6542-204">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="d6542-205">В следующем примере производится создание публикации транзакций.</span><span class="sxs-lookup"><span data-stu-id="d6542-205">This example creates a transactional publication.</span></span> <span data-ttu-id="d6542-206">Учетные данные Windows, необходимые для создания задания агента моментальных снимков и агента чтения журнала, передаются через переменные скрипта.</span><span class="sxs-lookup"><span data-stu-id="d6542-206">Scripting variables are used to pass Windows credentials that are needed to create jobs for the Snapshot Agent and Log Reader Agent.</span></span>  
  
 [!code-sql[HowTo#sp_AddTranPub](../../../snippets/tsql/SQL15/replication/howto/tsql/createtranpub.sql#sp_addtranpub)]  
  
 <span data-ttu-id="d6542-207">В следующем примере производится создание публикации слиянием.</span><span class="sxs-lookup"><span data-stu-id="d6542-207">This example creates a merge publication.</span></span> <span data-ttu-id="d6542-208">Учетные данные Windows, необходимые для создания задания агента моментальных снимков, передаются через переменные скрипта.</span><span class="sxs-lookup"><span data-stu-id="d6542-208">Scripting variables are used to pass Windows credentials that are needed to create the job for the Snapshot Agent.</span></span>  
  
 [!code-sql[HowTo#sp_AddMergePub](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepub.sql#sp_addmergepub)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="d6542-209">При помощи объектов RMO</span><span class="sxs-lookup"><span data-stu-id="d6542-209">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="d6542-210">Публикации можно создавать программно с помощью объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="d6542-210">You can create publications programmatically by using Replication Management Objects (RMO).</span></span> <span data-ttu-id="d6542-211">Классы RMO, с помощью которых создается публикация, зависят от типа создаваемой публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-211">The RMO classes that you use to create a publication depend on the type of publication you create.</span></span>  
  
#### <a name="to-create-a-snapshot-or-transactional-publication"></a><span data-ttu-id="d6542-212">Создание публикации транзакций или моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="d6542-212">To create a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="d6542-213">Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="d6542-213">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="d6542-214">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> для базы данных публикации, установите в качестве значения свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> экземпляр соединения <xref:Microsoft.SqlServer.Management.Common.ServerConnection> , созданный на шаге 1, и вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="d6542-214">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="d6542-215">Если метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> возвращает значение `false`, убедитесь, что база данных существует.</span><span class="sxs-lookup"><span data-stu-id="d6542-215">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, verify that the database exists.</span></span>  
  
3.  <span data-ttu-id="d6542-216">Если свойство <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledTransPublishing%2A> имеет значение `false`, то его следует заменить на `true`.</span><span class="sxs-lookup"><span data-stu-id="d6542-216">If the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledTransPublishing%2A> property is `false`, set it to `true`.</span></span>  
  
4.  <span data-ttu-id="d6542-217">Для публикации транзакций проверьте значение свойства <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentExists%2A> .</span><span class="sxs-lookup"><span data-stu-id="d6542-217">For a transactional publication, check the value of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentExists%2A> property.</span></span> <span data-ttu-id="d6542-218">Если свойство имеет значение `true`, то задание агента чтения журнала уже есть в базе данных.</span><span class="sxs-lookup"><span data-stu-id="d6542-218">If this property is `true`, a Log Read Agent job already exists for this database.</span></span> <span data-ttu-id="d6542-219">Если свойство имеет значение `false`, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="d6542-219">If this property is `false`, do the following:</span></span>  
  
    -   <span data-ttu-id="d6542-220">Задайте поля <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> и <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> или <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> в <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A> для передачи данных учетной записи [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows, под которой запущен агент чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="d6542-220">Set the <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows account under which the Log Reader Agent runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d6542-221">Указывать свойство <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A> не обязательно, если публикация создается членом предопределенной роли сервера `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="d6542-221">Setting <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentProcessSecurity%2A> is not required when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="d6542-222">В этом случае агент будет выполнять олицетворение учетную запись агента SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d6542-222">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="d6542-223">Дополнительные сведения см. в статье [Модель безопасности агента репликации](../security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-223">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="d6542-224">(необязательно) при соединении с издателем с проверкой подлинности SQL Server укажите значения свойств <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> и <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> или <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> объекта <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentPublisherSecurity%2A> .</span><span class="sxs-lookup"><span data-stu-id="d6542-224">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LogReaderAgentPublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
    -   <span data-ttu-id="d6542-225">С помощью метода <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.CreateLogReaderAgent%2A> создайте задание агента чтения журнала для базы данных.</span><span class="sxs-lookup"><span data-stu-id="d6542-225">Call the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.CreateLogReaderAgent%2A> method to create the Log Reader Agent job for the database.</span></span>  
  
5.  <span data-ttu-id="d6542-226">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.TransPublication> и укажите для него следующие свойства:</span><span class="sxs-lookup"><span data-stu-id="d6542-226">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="d6542-227">Соединение <xref:Microsoft.SqlServer.Management.Common.ServerConnection> , созданное на шаге 1, в качестве значения свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="d6542-227">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="d6542-228">имя опубликованной базы данных в свойстве <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>;</span><span class="sxs-lookup"><span data-stu-id="d6542-228">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="d6542-229">имя публикации в качестве значения свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>;</span><span class="sxs-lookup"><span data-stu-id="d6542-229">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="d6542-230">значение <xref:Microsoft.SqlServer.Replication.PublicationType> или <xref:Microsoft.SqlServer.Replication.PublicationType.Transactional> в параметре <xref:Microsoft.SqlServer.Replication.PublicationType.Snapshot>;</span><span class="sxs-lookup"><span data-stu-id="d6542-230">A <xref:Microsoft.SqlServer.Replication.PublicationType> of either <xref:Microsoft.SqlServer.Replication.PublicationType.Transactional> or <xref:Microsoft.SqlServer.Replication.PublicationType.Snapshot>.</span></span>  
  
    -   <span data-ttu-id="d6542-231">поля <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> и <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> свойства <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> , чтобы указать учетные данные для учетной записи Windows, с которой работает агент моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="d6542-231">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the Windows account under which the Snapshot Agent runs.</span></span> <span data-ttu-id="d6542-232">Эта учетная запись также используется, когда агент моментальных снимков соединяется с локальным распространителем, и для любых удаленных соединений, где применяется проверка подлинности Windows;</span><span class="sxs-lookup"><span data-stu-id="d6542-232">This account is also used when the Snapshot Agent makes connections to the local Distributor and for any remote connections when using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d6542-233">Указывать свойство <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> не обязательно, если публикация создается членом предопределенной роли сервера `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="d6542-233">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is not required when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="d6542-234">В этом случае агент будет выполнять олицетворение учетную запись агента SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d6542-234">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="d6542-235">Дополнительные сведения см. в статье [Модель безопасности агента репликации](../security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-235">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="d6542-236">Поля <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> и <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> или <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> в <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentPublisherSecurity%2A> при соединении с издателем с использованием проверки подлинности SQL Server (необязательно).</span><span class="sxs-lookup"><span data-stu-id="d6542-236">(Optional) The <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentPublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
    -   <span data-ttu-id="d6542-237">С помощью операторов включающего логического ИЛИ (`|` в Visual C# и `Or` в Visual Basic) и исключающего логического ИЛИ (`^` в Visual C# и `Xor` в Visual Basic) задайте значение <xref:Microsoft.SqlServer.Replication.PublicationAttributes> для свойства <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> (необязательно).</span><span class="sxs-lookup"><span data-stu-id="d6542-237">(Optional) Use the inclusive logical OR operator (`|` in Visual C# and `Or` in Visual Basic) and the exclusive logical OR operator (`^` in Visual C# and `Xor` in Visual Basic) to set the <xref:Microsoft.SqlServer.Replication.PublicationAttributes> values for the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property.</span></span>  
  
    -   <span data-ttu-id="d6542-238">Имя издателя в качестве значения <xref:Microsoft.SqlServer.Replication.TransPublication.PublisherName%2A> , если издатель не является издателем SQL Server (необязательно).</span><span class="sxs-lookup"><span data-stu-id="d6542-238">(Optional) The name of the Publisher for <xref:Microsoft.SqlServer.Replication.TransPublication.PublisherName%2A> when the Publisher is a non-SQL Server Publisher.</span></span>  
  
6.  <span data-ttu-id="d6542-239">Чтобы создать публикацию, вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="d6542-239">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d6542-240">При настройке издателя с удаленным распространителем значения, передаваемые для всех свойств, включая <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, отправляются распространителю в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="d6542-240">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="d6542-241">Перед вызовом метода <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> следует зашифровать подключение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="d6542-241">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="d6542-242">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-242">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
7.  <span data-ttu-id="d6542-243">Вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> , чтобы создать задание агента моментальных снимков для публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-243">Call the <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> method to create the Snapshot Agent job for the publication.</span></span>  
  
#### <a name="to-create-a-merge-publication"></a><span data-ttu-id="d6542-244">Создание публикации слиянием</span><span class="sxs-lookup"><span data-stu-id="d6542-244">To create a merge publication</span></span>  
  
1.  <span data-ttu-id="d6542-245">Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="d6542-245">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="d6542-246">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> для базы данных публикации, установите в качестве значения свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> экземпляр соединения <xref:Microsoft.SqlServer.Management.Common.ServerConnection> , созданный на шаге 1, и вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="d6542-246">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="d6542-247">Если метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> возвращает значение `false`, убедитесь, что база данных существует.</span><span class="sxs-lookup"><span data-stu-id="d6542-247">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, verify that the database exists.</span></span>  
  
3.  <span data-ttu-id="d6542-248">Если свойство <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> имеет значение `false`, то его следует изменить на `true` и вызвать метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="d6542-248">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> Property is `false`, set it to `true`, and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="d6542-249">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePublication> и укажите для него следующие свойства:</span><span class="sxs-lookup"><span data-stu-id="d6542-249">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="d6542-250">Соединение <xref:Microsoft.SqlServer.Management.Common.ServerConnection> , созданное на шаге 1, в качестве значения свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="d6542-250">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="d6542-251">имя опубликованной базы данных в свойстве <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>;</span><span class="sxs-lookup"><span data-stu-id="d6542-251">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="d6542-252">имя публикации в качестве значения свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>;</span><span class="sxs-lookup"><span data-stu-id="d6542-252">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="d6542-253">поля <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> и <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> свойства <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> , чтобы указать учетные данные для учетной записи Windows, с которой работает агент моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="d6542-253">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the Windows account under which the Snapshot Agent runs.</span></span> <span data-ttu-id="d6542-254">Эта учетная запись также используется, когда агент моментальных снимков соединяется с локальным распространителем, и для любых удаленных соединений, где применяется проверка подлинности Windows;</span><span class="sxs-lookup"><span data-stu-id="d6542-254">This account is also used when the Snapshot Agent makes connections to the local Distributor and for any remote connections when using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d6542-255">Указывать свойство <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> не обязательно, если публикация создается членом предопределенной роли сервера `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="d6542-255">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is not required when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="d6542-256">Дополнительные сведения см. в статье [Модель безопасности агента репликации](../security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-256">For more information, see [Replication Agent Security Model](../security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="d6542-257">С помощью операторов включающего логического ИЛИ (`|` в Visual C# и `Or` в Visual Basic) и исключающего логического ИЛИ (`^` в Visual C# и `Xor` в Visual Basic) задайте значение <xref:Microsoft.SqlServer.Replication.PublicationAttributes> для свойства <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> (необязательно).</span><span class="sxs-lookup"><span data-stu-id="d6542-257">(Optional) Use the inclusive logical OR operator (`|` in Visual C# and `Or` in Visual Basic) and the exclusive logical OR operator (`^` in Visual C# and `Xor` in Visual Basic) to set the <xref:Microsoft.SqlServer.Replication.PublicationAttributes> values for the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property.</span></span>  
  
5.  <span data-ttu-id="d6542-258">Чтобы создать публикацию, вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="d6542-258">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d6542-259">При настройке издателя с удаленным распространителем значения, передаваемые для всех свойств, включая <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, отправляются распространителю в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="d6542-259">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="d6542-260">Перед вызовом метода <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> следует зашифровать подключение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="d6542-260">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="d6542-261">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-261">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="d6542-262">Вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> , чтобы создать задание агента моментальных снимков для публикации.</span><span class="sxs-lookup"><span data-stu-id="d6542-262">Call the <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> method to create the Snapshot Agent job for the publication.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="d6542-263">Примеры (объекты RMO)</span><span class="sxs-lookup"><span data-stu-id="d6542-263">Examples (RMO)</span></span>  
 <span data-ttu-id="d6542-264">В этом примере в базе данных AdventureWorks разрешается публикация транзакций, определяется задание агента чтения журнала и создается публикация AdvWorksProductTran.</span><span class="sxs-lookup"><span data-stu-id="d6542-264">This example enables the AdventureWorks database for transactional publishing, defines a Log Reader Agent job, and creates the AdvWorksProductTran publication.</span></span> <span data-ttu-id="d6542-265">Для этой публикации необходимо определить статью.</span><span class="sxs-lookup"><span data-stu-id="d6542-265">An article must be defined for this publication.</span></span> <span data-ttu-id="d6542-266">Данные учетной записи Windows, необходимые для создания задания агента чтения журнала и задания агента моментальных снимков, передаются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="d6542-266">The Windows account credentials that are needed to create the Log Reader Agent job and the Snapshot Agent job are passed at runtime.</span></span> <span data-ttu-id="d6542-267">Более подробные сведения по определению статей моментальных снимков и транзакций с помощью объектов RMO см. в разделе [Define an Article](define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-267">To learn how to use RMO to define snapshot and transactional articles, see [Define an Article](define-an-article.md).</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPub](../../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPub](../../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpub)]  
  
 <span data-ttu-id="d6542-268">В этом примере в базе данных AdventureWorks разрешается публикация слиянием и создается публикация AdvWorksSalesOrdersMerge.</span><span class="sxs-lookup"><span data-stu-id="d6542-268">This example enables the AdventureWorks database for merge publishing and creates the AdvWorksSalesOrdersMerge publication.</span></span> <span data-ttu-id="d6542-269">Для этой публикации все равно необходимо определить статьи.</span><span class="sxs-lookup"><span data-stu-id="d6542-269">Articles must still be defined for this publication.</span></span> <span data-ttu-id="d6542-270">Данные учетной записи Windows, необходимые для создания задания агента моментальных снимков, предоставляются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="d6542-270">The Windows account credentials that are needed to create the Snapshot Agent job are passed at runtime.</span></span> <span data-ttu-id="d6542-271">Более подробные сведения по определению статей публикацией слиянием с помощью объектов RMO см. в разделе [Define an Article](define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="d6542-271">To learn how to use RMO to define merge articles, see [Define an Article](define-an-article.md).</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
## <a name="see-also"></a><span data-ttu-id="d6542-272">См. также:</span><span class="sxs-lookup"><span data-stu-id="d6542-272">See Also</span></span>  
 <span data-ttu-id="d6542-273">[Использование программы sqlcmd с переменными скрипта](../../scripting/sqlcmd-use-with-scripting-variables.md) </span><span class="sxs-lookup"><span data-stu-id="d6542-273">[Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md) </span></span>  
 <span data-ttu-id="d6542-274">[Публикация данных и объектов базы данных](publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="d6542-274">[Publish Data and Database Objects](publish-data-and-database-objects.md) </span></span>  
 <span data-ttu-id="d6542-275">[Replication Management Objects Concepts](../concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="d6542-275">[Replication Management Objects Concepts](../concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="d6542-276">[Define an Article](define-an-article.md) </span><span class="sxs-lookup"><span data-stu-id="d6542-276">[Define an Article](define-an-article.md) </span></span>  
 <span data-ttu-id="d6542-277">[Просмотр и изменение свойств публикации](view-and-modify-publication-properties.md) </span><span class="sxs-lookup"><span data-stu-id="d6542-277">[View and Modify Publication Properties](view-and-modify-publication-properties.md) </span></span>  
 <span data-ttu-id="d6542-278">[Настройка распространения](../configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="d6542-278">[Configure Distribution](../configure-distribution.md) </span></span>  
 <span data-ttu-id="d6542-279">[Организация безопасности распространителя](../security/secure-the-distributor.md) </span><span class="sxs-lookup"><span data-stu-id="d6542-279">[Secure the Distributor](../security/secure-the-distributor.md) </span></span>  
 [<span data-ttu-id="d6542-280">Защита издателя</span><span class="sxs-lookup"><span data-stu-id="d6542-280">Secure the Publisher</span></span>](../security/secure-the-publisher.md)  
  
  
