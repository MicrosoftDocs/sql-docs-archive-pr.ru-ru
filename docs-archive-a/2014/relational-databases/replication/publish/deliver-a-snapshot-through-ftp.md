---
title: Доставка моментального снимка через FTP | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], FTP snapshots
- FTP snapshots [SQL Server replication]
- snapshot replication [SQL Server], FTP
ms.assetid: 99872c4f-40ce-4405-8fd4-44052d3bd827
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2e6700e6989a5a7e32202a0710bc663978a136cf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87656329"
---
# <a name="deliver-a-snapshot-through-ftp"></a><span data-ttu-id="d6161-102">Доставка моментального снимка через FTP</span><span class="sxs-lookup"><span data-stu-id="d6161-102">Deliver a Snapshot Through FTP</span></span>
  <span data-ttu-id="d6161-103">В этом разделе описывается доставка моментального снимка по протоколу FTP в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d6161-103">This topic describes how to deliver a snapshot through FTP in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span>  
  
##  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="d6161-104">Ограничения</span><span class="sxs-lookup"><span data-stu-id="d6161-104">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="d6161-105">Агент моментальных снимков должен иметь разрешения на запись в указанный каталог, а агент распространителя или агент слияния должен иметь разрешения на чтение из этого каталога.</span><span class="sxs-lookup"><span data-stu-id="d6161-105">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="d6161-106">При использовании подписок по запросу следует указать в качестве пути, соответствующего соглашению об универсальном назначении имен (UNC), общий каталог, например \\\ftpserver\home\snapshots.</span><span class="sxs-lookup"><span data-stu-id="d6161-106">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\ftpserver\home\snapshots.</span></span> <span data-ttu-id="d6161-107">Дополнительные сведения см. в статье [Организация безопасности папки моментальных снимков](../security/secure-the-snapshot-folder.md).</span><span class="sxs-lookup"><span data-stu-id="d6161-107">For more information, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="d6161-108">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="d6161-108">Prerequisites</span></span>  
  
-   <span data-ttu-id="d6161-109">Для передачи файлов моментальных снимков с использованием протокола FTP (File Transfer Protocol) необходимо настроить FTP-сервер.</span><span class="sxs-lookup"><span data-stu-id="d6161-109">To transfer snapshot files using File Transfer Protocol (FTP), you must first configure an FTP server.</span></span> <span data-ttu-id="d6161-110">Дополнительные сведения см. в документации служб IIS [!INCLUDE[msCoName](../../../includes/msconame-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d6161-110">For more information, see the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Internet Information Services (IIS) documentation.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="d6161-111">безопасность</span><span class="sxs-lookup"><span data-stu-id="d6161-111">Security</span></span>  
 <span data-ttu-id="d6161-112">В целях повышения безопасности рекомендуется реализовать частную виртуальную сеть (VPN) при доставке моментальных снимков по протоколу FTP через Интернет.</span><span class="sxs-lookup"><span data-stu-id="d6161-112">To help improve security, we recommend that you implement a virtual private network (VPN) when using FTP snapshot delivery over the Internet.</span></span> <span data-ttu-id="d6161-113">Дополнительные сведения см. в статье [Публикация данных через Интернет с помощью виртуальных частных сетей](../publish-data-over-the-internet-using-vpn.md).</span><span class="sxs-lookup"><span data-stu-id="d6161-113">For more information, see [Publish Data over the Internet Using VPN](../publish-data-over-the-internet-using-vpn.md).</span></span>  
  
 <span data-ttu-id="d6161-114">Для обеспечения безопасности рекомендуется запретить анонимный вход на FTP-сервер.</span><span class="sxs-lookup"><span data-stu-id="d6161-114">As a security best practice, do not allow anonymous logins to the FTP server.</span></span> <span data-ttu-id="d6161-115">Агент моментальных снимков должен иметь разрешения на запись в указанный каталог, а агент распространителя или агент слияния должен иметь разрешения на чтение из этого каталога.</span><span class="sxs-lookup"><span data-stu-id="d6161-115">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="d6161-116">При использовании подписок по запросу следует указать в качестве пути, соответствующего соглашению об универсальном назначении имен (UNC), общий каталог, например \\\ftpserver\home\snapshots.</span><span class="sxs-lookup"><span data-stu-id="d6161-116">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\ftpserver\home\snapshots.</span></span> <span data-ttu-id="d6161-117">Дополнительные сведения см. в статье [Организация безопасности папки моментальных снимков](../security/secure-the-snapshot-folder.md).</span><span class="sxs-lookup"><span data-stu-id="d6161-117">For more information, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
 <span data-ttu-id="d6161-118">По возможности запрашивайте у пользователей учетные данные в среде выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="d6161-118">When possible, prompt users to enter their credentials at runtime.</span></span> <span data-ttu-id="d6161-119">Если учетные данные хранятся в файле скрипта, необходимо защитить этот файл.</span><span class="sxs-lookup"><span data-stu-id="d6161-119">If you store credentials in a script file, you must secure the file.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="d6161-120">Использование среды SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d6161-120">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="d6161-121">После настройки FTP-сервера укажите каталог и сведения безопасности для этого сервера в диалоговом окне **Свойства публикации — \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="d6161-121">After the FTP server is configured, specify directory and security information for this server in the **Publication Properties \<Publication>** dialog box.</span></span> <span data-ttu-id="d6161-122">Дополнительные сведения о доступе к этому диалоговому окну см. в разделе [Просмотр и изменение свойств публикации](view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="d6161-122">For more information about accessing this dialog box, see [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
#### <a name="to-specify-ftp-information"></a><span data-ttu-id="d6161-123">Указание сведений FTP</span><span class="sxs-lookup"><span data-stu-id="d6161-123">To specify FTP information</span></span>  
  
1.  <span data-ttu-id="d6161-124">В диалоговом окне **Свойства публикации — \<Publication>** установите флажок **Разрешить подписчикам загружать файлы моментальных снимков по протоколу FTP** на одной из следующих страниц.</span><span class="sxs-lookup"><span data-stu-id="d6161-124">In the **Publication Properties - \<Publication>** dialog box, select **Allow Subscribers to download snapshot files using FTP** from one of the following pages:</span></span>   
    -   <span data-ttu-id="d6161-125">Страница **Моментальный снимок FTP** для публикаций моментальных снимков, публикаций транзакций и публикаций слиянием с издателей, использующих версии, предшествующие [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d6161-125">The **FTP Snapshot** page, for snapshot and transactional publications, and merge publications for Publishers running versions prior to [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>    
    -   <span data-ttu-id="d6161-126">Страница **Моментальный снимок FTP и Интернет** для публикаций слиянием с издателей, использующих [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] или более позднюю версию.</span><span class="sxs-lookup"><span data-stu-id="d6161-126">The **FTP Snapshot and Internet** page, for merge publications from Publishers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span>    
2.  <span data-ttu-id="d6161-127">Укажите значения для свойств **Имя FTP-сервера**, **Номер порта**, **Путь из корневой папки FTP**, **Имя входа**и **Пароль**.</span><span class="sxs-lookup"><span data-stu-id="d6161-127">Specify values for **FTP server name**, **Port number**, **Path from the FTP root folder**, **Login**, and **Password**.</span></span>    
     <span data-ttu-id="d6161-128">Например, если корневой каталог FTP-сервера является \\\ftpserver\home и нужно, чтобы моментальные снимки хранились в \\\ftpserver\home\snapshots, укажите значение \snapshots\ftp для свойства **Путь из корневой папки FTP** (репликация присоединяет ftp к пути папки моментальных снимков при создании файлов моментальных снимков).</span><span class="sxs-lookup"><span data-stu-id="d6161-128">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify \snapshots\ftp for the property **Path from the FTP root folder** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
3.  <span data-ttu-id="d6161-129">Укажите, что агент моментальных снимков должен записывать файлы моментальных снимков в каталог, указанный на шаге 2.</span><span class="sxs-lookup"><span data-stu-id="d6161-129">Specify that the Snapshot Agent should write the snapshot files to the directory specified in step 2.</span></span> <span data-ttu-id="d6161-130">Например, чтобы агент моментальных снимков записывал файлы моментальных снимков в \\\ftpserver\home\snapshots\ftp, следует указать путь \\\ftpserver\home\snapshots в одном из двух мест:</span><span class="sxs-lookup"><span data-stu-id="d6161-130">For example, to have the Snapshot Agent write the snapshot files to \\\ftpserver\home\snapshots\ftp, you must specify the path \\\ftpserver\home\snapshots in one of two places:</span></span>    
    -   <span data-ttu-id="d6161-131">Расположение моментальных снимков по умолчанию для распространителя, связанного с этой публикацией.</span><span class="sxs-lookup"><span data-stu-id="d6161-131">The default snapshot location for the Distributor associated with this publication.</span></span>    
         <span data-ttu-id="d6161-132">Дополнительные сведения об указании расположения моментальных снимков по умолчанию см. [в разделе Указание расположения моментальных снимков по умолчанию](../snapshot-options.md#snapshot-folder-locations).</span><span class="sxs-lookup"><span data-stu-id="d6161-132">For more information about specifying the default snapshot location, see [Specify the Default Snapshot Location](../snapshot-options.md#snapshot-folder-locations).</span></span>    
    -   <span data-ttu-id="d6161-133">Альтернативное расположение папки моментальных снимков для данной публикации.</span><span class="sxs-lookup"><span data-stu-id="d6161-133">An alternate snapshot folder location for this publication.</span></span> <span data-ttu-id="d6161-134">Если моментальный снимок сжимается, необходимо альтернативное расположение папки.</span><span class="sxs-lookup"><span data-stu-id="d6161-134">An alternate location is required if the snapshot is compressed.</span></span>    
         <span data-ttu-id="d6161-135">Введите путь в текстовое поле **Размещение файлов в следующей папке** на странице моментальный снимок страницы \*\*Свойства публикации — \<Publication> \*\* диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="d6161-135">Enter the path in the **Put files in the following folder** textbox on the Snapshot page of the **Publication Properties - \<Publication>** dialog box.</span></span>   
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="d6161-136">Использование Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d6161-136">Using Transact-SQL</span></span>  
 <span data-ttu-id="d6161-137">Можно установить параметр, который сделает доступными файлы моментальных снимков на сервере, а настройки FTP можно изменить программно с помощью хранимых процедур репликации.</span><span class="sxs-lookup"><span data-stu-id="d6161-137">The option to make snapshot files available on an FTP server can be set and these FTP settings can be modified programmatically using replication stored procedures.</span></span> <span data-ttu-id="d6161-138">Эта процедура зависит от типа публикации.</span><span class="sxs-lookup"><span data-stu-id="d6161-138">The procedure used depends on the type of publication.</span></span> <span data-ttu-id="d6161-139">Доставка моментальных снимков по протоколу FTP используется только с подписками по запросу.</span><span class="sxs-lookup"><span data-stu-id="d6161-139">FTP snapshot delivery is only used with pull subscriptions.</span></span>  
  
#### <a name="to-enable-ftp-snapshot-delivery-for-a-snapshot-or-transactional-publication"></a><span data-ttu-id="d6161-140">Включение доставки моментальных снимков по протоколу FTP для публикации моментальных снимков или публикации транзакций</span><span class="sxs-lookup"><span data-stu-id="d6161-140">To enable FTP snapshot delivery for a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="d6161-141">На издателе в базе данных публикации выполните хранимую процедуру [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6161-141">At the Publisher on the publication database, execute [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span></span> <span data-ttu-id="d6161-142">Укажите **@publication** , значение `true` для **@enabled_for_internet** и соответствующие значения для следующих параметров:</span><span class="sxs-lookup"><span data-stu-id="d6161-142">Specify **@publication**, a value of `true` for **@enabled_for_internet**, and appropriate values for the following parameters:</span></span>    
    -   <span data-ttu-id="d6161-143">**@ftp_address**— адрес FTP-сервера, используемого для доставки моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="d6161-143">**@ftp_address** - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="d6161-144">(Необязательно) **@ftp_port** — порт, используемый FTP-сервером.</span><span class="sxs-lookup"><span data-stu-id="d6161-144">(Optional) **@ftp_port** - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="d6161-145">(Необязательно) **@ftp_subdirectory** — подкаталог FTP-каталога по умолчанию, назначенный имени входа FTP.</span><span class="sxs-lookup"><span data-stu-id="d6161-145">(Optional) **@ftp_subdirectory** - the subdirectory of the default FTP directory assigned to an FTP login.</span></span> <span data-ttu-id="d6161-146">Например, если корневой каталог FTP-сервера — \\ \ftpserver\home и требуется хранить моментальные снимки в \\ \ftpserver\home\snapshots, укажите **значение \snapshots\ftp** для **@ftp_subdirectory** (репликация добавляет "FTP" в путь к папке моментальных снимков при создании файлов моментальных снимков).</span><span class="sxs-lookup"><span data-stu-id="d6161-146">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify **\snapshots\ftp** for **@ftp_subdirectory** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
    -   <span data-ttu-id="d6161-147">(Необязательно) **@ftp_login** — Учетная запись входа, используемая при соединении с FTP-сервером.</span><span class="sxs-lookup"><span data-stu-id="d6161-147">(Optional) **@ftp_login** - a login account used when connecting to the FTP server.</span></span>    
    -   <span data-ttu-id="d6161-148">(Необязательно) **@ftp_password** — пароль для имени входа FTP.</span><span class="sxs-lookup"><span data-stu-id="d6161-148">(Optional) **@ftp_password** - the password for the FTP login.</span></span>  
  
     <span data-ttu-id="d6161-149">Таким образом создается публикация, использующая протокол FTP.</span><span class="sxs-lookup"><span data-stu-id="d6161-149">This creates a publication that uses FTP.</span></span> <span data-ttu-id="d6161-150">Дополнительные сведения см. в разделе [Create a Publication](create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="d6161-150">For more information, see [Create a Publication](create-a-publication.md).</span></span>  
  
#### <a name="to-enable-ftp-snapshot-delivery-for-a-merge-publication"></a><span data-ttu-id="d6161-151">Включение доставки моментальных снимков по протоколу FTP для публикации слиянием</span><span class="sxs-lookup"><span data-stu-id="d6161-151">To enable FTP snapshot delivery for a merge publication</span></span>  
  
1.  <span data-ttu-id="d6161-152">На издателе в базе данных публикации выполните процедуру [sp_addmergepublication](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6161-152">At the Publisher on the publication database, execute [sp_addmergepublication](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="d6161-153">Укажите **@publication** значение `true` для параметра **@enabled_for_internet** и соответствующие значения для следующих параметров:</span><span class="sxs-lookup"><span data-stu-id="d6161-153">Specify **@publication**, a value of `true` for **@enabled_for_internet** and appropriate values for the following parameters:</span></span>  
  
    -   <span data-ttu-id="d6161-154">**@ftp_address**— адрес FTP-сервера, используемого для доставки моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="d6161-154">**@ftp_address** - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="d6161-155">(Необязательно) **@ftp_port** — порт, используемый FTP-сервером.</span><span class="sxs-lookup"><span data-stu-id="d6161-155">(Optional) **@ftp_port** - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="d6161-156">(Необязательно) **@ftp_subdirectory** — подкаталог FTP-каталога по умолчанию, назначенный имени входа FTP.</span><span class="sxs-lookup"><span data-stu-id="d6161-156">(Optional) **@ftp_subdirectory** - the subdirectory of the default FTP directory assigned to an FTP login.</span></span> <span data-ttu-id="d6161-157">Например, если корневой каталог FTP-сервера — \\ \ftpserver\home и требуется хранить моментальные снимки в \\ \ftpserver\home\snapshots, укажите **значение \snapshots\ftp** для **@ftp_subdirectory** (репликация добавляет "FTP" в путь к папке моментальных снимков при создании файлов моментальных снимков).</span><span class="sxs-lookup"><span data-stu-id="d6161-157">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify **\snapshots\ftp** for **@ftp_subdirectory** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
    -   <span data-ttu-id="d6161-158">(Необязательно) **@ftp_login** — Учетная запись входа, используемая при соединении с FTP-сервером.</span><span class="sxs-lookup"><span data-stu-id="d6161-158">(Optional) **@ftp_login** - a login account used when connecting to the FTP server.</span></span>    
    -   <span data-ttu-id="d6161-159">(Необязательно) **@ftp_password** — пароль для имени входа FTP.</span><span class="sxs-lookup"><span data-stu-id="d6161-159">(Optional) **@ftp_password** - the password for the FTP login.</span></span>  
  
     <span data-ttu-id="d6161-160">Таким образом создается публикация, использующая протокол FTP.</span><span class="sxs-lookup"><span data-stu-id="d6161-160">This creates a publication that uses FTP.</span></span> <span data-ttu-id="d6161-161">Дополнительные сведения см. в разделе [Create a Publication](create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="d6161-161">For more information, see [Create a Publication](create-a-publication.md).</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication-that-uses-ftp-snapshot-delivery"></a><span data-ttu-id="d6161-162">Создание подписки по запросу на публикацию моментальных снимков или публикацию транзакций, использующую доставку моментальных снимков по протоколу FTP</span><span class="sxs-lookup"><span data-stu-id="d6161-162">To create a pull subscription to a snapshot or transactional publication that uses FTP snapshot delivery</span></span>  
  
1.  <span data-ttu-id="d6161-163">На подписчике в базе данных подписки выполните хранимую процедуру [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6161-163">At the Subscriber on the subscription database, execute [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span></span> <span data-ttu-id="d6161-164">Укажите **@publisher** и **@publication** .</span><span class="sxs-lookup"><span data-stu-id="d6161-164">Specify **@publisher** and **@publication**.</span></span>  
  
    -   <span data-ttu-id="d6161-165">На подписчике в базе данных подписки выполните хранимую процедуру [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6161-165">At the Subscriber on the subscription database, execute [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="d6161-166">Укажите **@publisher** , **@publisher_db** , **@publication** , [!INCLUDE[msCoName](../../../includes/msconame-md.md)] учетные данные Windows, с которыми выполняется агент распространения на подписчике **@job_login** **@job_password** , и значение `true` для **@use_ftp** .</span><span class="sxs-lookup"><span data-stu-id="d6161-166">Specify **@publisher**, **@publisher_db**, **@publication**, the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**, and a value of `true` for **@use_ftp**.</span></span>  
  
2.  <span data-ttu-id="d6161-167">Чтобы зарегистрировать подписку по запросу, выполните на издателе в базе данных публикации хранимую процедуру [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="d6161-167">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="d6161-168">Дополнительные сведения см. в статье [Создание подписки по запросу](../create-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="d6161-168">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication-that-uses-ftp-snapshot-delivery"></a><span data-ttu-id="d6161-169">Создание подписки по запросу на публикацию слиянием, использующую доставку моментальных снимков по протоколу FTP</span><span class="sxs-lookup"><span data-stu-id="d6161-169">To create a pull subscription to a merge publication that uses FTP snapshot delivery</span></span>  
  
1.  <span data-ttu-id="d6161-170">В базе данных подписки на издателе выполните процедуру [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6161-170">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="d6161-171">Укажите **@publisher** и **@publication** .</span><span class="sxs-lookup"><span data-stu-id="d6161-171">Specify **@publisher** and **@publication**.</span></span>   
2.  <span data-ttu-id="d6161-172">На подписчике в базе данных подписки выполните хранимую процедуру [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6161-172">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="d6161-173">Укажите **@publisher** , **@publisher_db** , **@publication** , учетные данные Windows, с которыми выполняется агент распространения на подписчике **@job_login** **@job_password** , и значение `true` для **@use_ftp** .</span><span class="sxs-lookup"><span data-stu-id="d6161-173">Specify **@publisher**, **@publisher_db**, **@publication**, the Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**, and a value of `true` for **@use_ftp**.</span></span>    
3.  <span data-ttu-id="d6161-174">Чтобы зарегистрировать подписку по запросу, выполните на издателе в базе данных публикации хранимую процедуру [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="d6161-174">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="d6161-175">Дополнительные сведения см. в статье [Создание подписки по запросу](../create-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="d6161-175">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>  
  
#### <a name="to-change-one-or-more-ftp-snapshot-delivery-settings-for-a-snapshot-or-transactional-publication"></a><span data-ttu-id="d6161-176">Изменение одной или нескольких доставок моментальных снимков по протоколу FTP для публикации моментальных снимков или публикации транзакций</span><span class="sxs-lookup"><span data-stu-id="d6161-176">To change one or more FTP snapshot delivery settings for a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="d6161-177">На издателе в базе данных публикации выполните процедуру [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6161-177">At the Publisher on the publication database, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql).</span></span> <span data-ttu-id="d6161-178">Укажите одно из следующих значений для **@property** и новое значение этого параметра в параметре **@value** :</span><span class="sxs-lookup"><span data-stu-id="d6161-178">Specify one of the following values for **@property** and a new value of this setting for **@value**:</span></span>    
    -   <span data-ttu-id="d6161-179">`ftp_address` — адрес FTP-сервера, который используется для доставки моментального снимка;</span><span class="sxs-lookup"><span data-stu-id="d6161-179">`ftp_address` - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="d6161-180">`ftp_port` — порт FTP-сервера;</span><span class="sxs-lookup"><span data-stu-id="d6161-180">`ftp_port` - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="d6161-181">`ftp_subdirectory` — подкаталог FTP-каталога по умолчанию, в котором хранится моментальный снимок;</span><span class="sxs-lookup"><span data-stu-id="d6161-181">`ftp_subdirectory` - the subdirectory of the default FTP directory used for the FTP snapshot.</span></span>    
    -   <span data-ttu-id="d6161-182">`ftp_login` — имя входа для подключения к FTP-серверу;</span><span class="sxs-lookup"><span data-stu-id="d6161-182">`ftp_login` - a login used to connect to the FTP server.</span></span>    
    -   <span data-ttu-id="d6161-183">`ftp_password` — пароль для имени входа.</span><span class="sxs-lookup"><span data-stu-id="d6161-183">`ftp_password` - the password for the FTP login.</span></span>  
  
2.  <span data-ttu-id="d6161-184">Повторите шаг 1 для каждого изменяемого параметра FTP-соединения (необязательно).</span><span class="sxs-lookup"><span data-stu-id="d6161-184">(Optional) Repeat step 1 for each FTP setting being changed.</span></span>    
3.  <span data-ttu-id="d6161-185">Чтобы отключить доставку моментальных снимков по протоколу FTP, выполните на издателе в базе данных публикации хранимую процедуру [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) (необязательно).</span><span class="sxs-lookup"><span data-stu-id="d6161-185">(Optional) To disable FTP snapshot delivery, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="d6161-186">Укажите значение в параметре `enabled_for_internet` **@property** и значение в параметре `false` **@value** .</span><span class="sxs-lookup"><span data-stu-id="d6161-186">Specify a value of `enabled_for_internet` for **@property** and a value of `false` for **@value**.</span></span>  
  
#### <a name="to-change-ftp-snapshot-delivery-settings-for-a-merge-publication"></a><span data-ttu-id="d6161-187">Изменение настроек доставки моментальных снимков по протоколу FTP для публикации слиянием</span><span class="sxs-lookup"><span data-stu-id="d6161-187">To change FTP snapshot delivery settings for a merge publication</span></span>  
  
1.  <span data-ttu-id="d6161-188">В базе данных публикации на издателе выполните процедуру [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d6161-188">At the Publisher on the publication database, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql).</span></span> <span data-ttu-id="d6161-189">Укажите одно из следующих значений для **@property** и новое значение этого параметра в параметре **@value** :</span><span class="sxs-lookup"><span data-stu-id="d6161-189">Specify one of the following values for **@property** and a new value of this setting for **@value**:</span></span>  
  
    -   <span data-ttu-id="d6161-190">`ftp_address` — адрес FTP-сервера, который используется для доставки моментального снимка;</span><span class="sxs-lookup"><span data-stu-id="d6161-190">`ftp_address` - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="d6161-191">`ftp_port` — порт FTP-сервера;</span><span class="sxs-lookup"><span data-stu-id="d6161-191">`ftp_port` - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="d6161-192">`ftp_subdirectory` — подкаталог FTP-каталога по умолчанию, в котором хранится моментальный снимок;</span><span class="sxs-lookup"><span data-stu-id="d6161-192">`ftp_subdirectory` - the subdirectory of the default FTP directory used for the FTP snapshot.</span></span>   
    -   <span data-ttu-id="d6161-193">`ftp_login` — имя входа для подключения к FTP-серверу;</span><span class="sxs-lookup"><span data-stu-id="d6161-193">`ftp_login` - a login used to connect to the FTP server.</span></span>    
    -   <span data-ttu-id="d6161-194">`ftp_password` — пароль для имени входа.</span><span class="sxs-lookup"><span data-stu-id="d6161-194">`ftp_password` - the password for the FTP login.</span></span>    
2.  <span data-ttu-id="d6161-195">Повторите шаг 1 для каждого изменяемого параметра FTP-соединения (необязательно).</span><span class="sxs-lookup"><span data-stu-id="d6161-195">(Optional) Repeat step 1 for each FTP setting being changed.</span></span>    
3.  <span data-ttu-id="d6161-196">Чтобы отключить доставку моментальных снимков по протоколу FTP, выполните на издателе в базе данных публикации хранимую процедуру [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) (необязательно).</span><span class="sxs-lookup"><span data-stu-id="d6161-196">(Optional) To disable FTP snapshot delivery, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="d6161-197">Укажите значение в параметре `enabled_for_internet` **@property** и значение в параметре `false` **@value** .</span><span class="sxs-lookup"><span data-stu-id="d6161-197">Specify a value of `enabled_for_internet` for **@property** and a value of `false` for **@value**.</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="d6161-198">Примеры (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="d6161-198">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="d6161-199">В следующем примере создается публикация слиянием, позволяющая подписчикам получить доступ к данным моментального снимка с помощью протокола FTP.</span><span class="sxs-lookup"><span data-stu-id="d6161-199">The following example creates a merge publication that allows Subscribers to access the snapshot data using FTP.</span></span> <span data-ttu-id="d6161-200">Для доступа к общей папке FTP подписчик должен использовать защищенное VPN-соединение.</span><span class="sxs-lookup"><span data-stu-id="d6161-200">The Subscriber should use a secure VPN connection when accessing the FTP share.</span></span> <span data-ttu-id="d6161-201">Для передачи значений имени входа и пароля используются переменные скриптов**sqlcmd** .</span><span class="sxs-lookup"><span data-stu-id="d6161-201">**sqlcmd** scripting variables are used to supply login and password values.</span></span> <span data-ttu-id="d6161-202">Дополнительные сведения см. в статье [Использование программы sqlcmd с переменными скрипта](../../scripting/sqlcmd-use-with-scripting-variables.md).</span><span class="sxs-lookup"><span data-stu-id="d6161-202">For more information, see [Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md).</span></span>  
  
 [!code-sql[HowTo#sp_createmergepub_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubftp.sql#sp_createmergepub_ftp)]  
  
 <span data-ttu-id="d6161-203">В следующем примере создается подписка на публикацию слиянием, в которой подписчик получает моментальный снимок с помощью протокола FTP.</span><span class="sxs-lookup"><span data-stu-id="d6161-203">The following example creates a subscription to a merge publication, where the Subscriber obtains the snapshot using FTP.</span></span> <span data-ttu-id="d6161-204">Для доступа к общей папке FTP подписчик должен использовать защищенное VPN-соединение.</span><span class="sxs-lookup"><span data-stu-id="d6161-204">The Subscriber should use a secure VPN connection when accessing the FTP share.</span></span> <span data-ttu-id="d6161-205">Для передачи значений имени входа и пароля используются переменные скриптов**sqlcmd** .</span><span class="sxs-lookup"><span data-stu-id="d6161-205">**sqlcmd** scripting variables are used to supply login and password values.</span></span> <span data-ttu-id="d6161-206">Дополнительные сведения см. в статье [Использование программы sqlcmd с переменными скрипта](../../scripting/sqlcmd-use-with-scripting-variables.md).</span><span class="sxs-lookup"><span data-stu-id="d6161-206">For more information, see [Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md).</span></span>  
  
 [!code-sql[HowTo#sp_createmergepullsub_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsubftp.sql#sp_createmergepullsub_ftp)]  
  
 [!code-sql[HowTo#sp_createmergepullsubagent_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsubftp.sql#sp_createmergepullsubagent_ftp)]  
  
## <a name="see-also"></a><span data-ttu-id="d6161-207">См. также:</span><span class="sxs-lookup"><span data-stu-id="d6161-207">See Also</span></span>  
 <span data-ttu-id="d6161-208">[Replication System Stored Procedures Concepts](../concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="d6161-208">[Replication System Stored Procedures Concepts](../concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="d6161-209">[Передавать моментальные снимки по протоколу FTP](../transfer-snapshots-through-ftp.md) </span><span class="sxs-lookup"><span data-stu-id="d6161-209">[Transfer Snapshots Through FTP](../transfer-snapshots-through-ftp.md) </span></span>  
 <span data-ttu-id="d6161-210">[Изменение свойств публикации и статьи](change-publication-and-article-properties.md) </span><span class="sxs-lookup"><span data-stu-id="d6161-210">[Change Publication and Article Properties](change-publication-and-article-properties.md) </span></span>  
 [<span data-ttu-id="d6161-211">Инициализация подписки с помощью моментального снимка</span><span class="sxs-lookup"><span data-stu-id="d6161-211">Initialize a Subscription with a Snapshot</span></span>](../initialize-a-subscription-with-a-snapshot.md)  
  
  
