---
title: Инициализация подписки с помощью моментального снимка | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], initializing subscriptions
- initializing subscriptions [SQL Server replication], snapshots
ms.assetid: 77a9ade2-cdc0-4ae9-a02d-6e29d7c2ada0
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: f8b776e71e9d1197bc174169aee8ccf692884308
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655596"
---
# <a name="initialize-a-subscription-with-a-snapshot"></a><span data-ttu-id="73886-102">Инициализация подписки с помощью моментального снимка</span><span class="sxs-lookup"><span data-stu-id="73886-102">Initialize a Subscription with a Snapshot</span></span>
  <span data-ttu-id="73886-103">После того как публикация создана, обычно создается и копируется в папку моментальных снимков исходный моментальный снимок (это происходит по умолчанию для публикаций слиянием, созданных с помощью мастера создания публикаций).</span><span class="sxs-lookup"><span data-stu-id="73886-103">After a publication has been created, an initial snapshot is typically created and copied to the snapshot folder (this occurs by default for merge publications created with the New Publication Wizard).</span></span> <span data-ttu-id="73886-104">Затем, при начальной синхронизации подписки, снимок применяется к подписчику агентом распространителя (для публикаций транзакций и публикаций моментальных снимков) или агентом слияния (для публикаций слиянием).</span><span class="sxs-lookup"><span data-stu-id="73886-104">It is then applied to the Subscriber by the Distribution Agent (for transactional and snapshot publications) or the Merge Agent (for merge publications) during the initial synchronization of the subscription.</span></span> <span data-ttu-id="73886-105">Процесс создания моментального снимка зависит от типа публикации:</span><span class="sxs-lookup"><span data-stu-id="73886-105">The snapshot process depends on the type of publication:</span></span>  
  
-   <span data-ttu-id="73886-106">Если моментальный снимок предназначен для публикации моментальных снимков, публикации транзакций или публикации слиянием, не использующей параметризованных фильтров, снимок содержит схему и данные в файлах программы массового копирования (bcp), а также ограничения, расширенные свойства, индексы, триггеры и системные таблицы, необходимые для репликации.</span><span class="sxs-lookup"><span data-stu-id="73886-106">If the snapshot is for a snapshot publication, a transactional publication, or a merge publication that doesn't use parameterized filters, the snapshot contains the schema and data in bulk copy program (bcp) files, as well as constraints, extended properties, indexes, triggers, and the system tables necessary for replication.</span></span> <span data-ttu-id="73886-107">Дополнительные сведения о создании и применении моментального снимка см. в [этой статье](create-and-apply-the-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="73886-107">For more information about creating and applying the snapshot, see [Create and Apply the Snapshot](create-and-apply-the-snapshot.md).</span></span>  
  
-   <span data-ttu-id="73886-108">Если требуется моментальный снимок для публикации слиянием, в которой используются параметризованные фильтры, процесс создания моментального снимка происходит в два этапа.</span><span class="sxs-lookup"><span data-stu-id="73886-108">If the snapshot is for a merge publication that uses parameterized filters, the snapshot is created using a two-part process.</span></span> <span data-ttu-id="73886-109">Сначала создается моментальный снимок схемы, который содержит скрипты репликации и схему публикуемых объектов, но не содержит данные.</span><span class="sxs-lookup"><span data-stu-id="73886-109">First a schema snapshot is created that contains the replication scripts and the schema of the published objects, but not the data.</span></span> <span data-ttu-id="73886-110">Потом каждая подписка инициализируется при помощи моментального снимка, который содержит скрипты и схему, скопированную из моментального снимка схемы, и данные, которые принадлежат секции подписки.</span><span class="sxs-lookup"><span data-stu-id="73886-110">Each subscription is then initialized with a snapshot that includes the scripts and schema copied from the schema snapshot and the data that belongs to the subscription's partition.</span></span> <span data-ttu-id="73886-111">Дополнительные сведения см. в статье [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="73886-111">For more information, see [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
 <span data-ttu-id="73886-112">Моментальный снимок состоит из различных файлов, в зависимости от типа репликации и статей в публикации.</span><span class="sxs-lookup"><span data-stu-id="73886-112">The snapshot consists of different files depending on the type of replication and the articles in your publication.</span></span> <span data-ttu-id="73886-113">Эти файлы копируются в папку моментальных снимков по умолчанию, указанную при настройке распространителя, или в альтернативную папку моментальных снимков, указанную при создании публикации.</span><span class="sxs-lookup"><span data-stu-id="73886-113">These files are copied to the default snapshot folder specified when the Distributor was configured or the alternate snapshot folder specified when the publication was created.</span></span>  
  
|<span data-ttu-id="73886-114">Тип репликации</span><span class="sxs-lookup"><span data-stu-id="73886-114">Type of Replication</span></span>|<span data-ttu-id="73886-115">Общие файлы моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="73886-115">Common Snapshot Files</span></span>|  
|-------------------------|---------------------------|  
|<span data-ttu-id="73886-116">Репликация моментальных снимков или репликация транзакций</span><span class="sxs-lookup"><span data-stu-id="73886-116">Snapshot Replication or Transactional Replication</span></span>|<span data-ttu-id="73886-117">схема (SCH); данные (BCP); ограничения и индексы (DRI); ограничения (IDX); триггеры (TRG): для обновления только подписчиков; сжатые файлы моментальных снимков (CAB).</span><span class="sxs-lookup"><span data-stu-id="73886-117">schema (.sch); data (.bcp); constraints and indexes (.dri); constraints (.idx); triggers (.trg):for updating Subscribers only; compressed snapshot files (.cab).</span></span>|  
|<span data-ttu-id="73886-118">Репликация слиянием</span><span class="sxs-lookup"><span data-stu-id="73886-118">Merge Replication</span></span>|<span data-ttu-id="73886-119">схема (SCH); данные (BCP); ограничения и индексы (DRI); триггеры (TRG); данные системной таблицы (SYS); таблицы конфликтов (CFT); сжатые файлы моментальных снимков (CAB).</span><span class="sxs-lookup"><span data-stu-id="73886-119">schema (.sch); data (.bcp); constraints and indexes (.dri); triggers (.trg); system table data (.sys); conflict tables (.cft); compressed snapshot files (.cab).</span></span>|  
  
 <span data-ttu-id="73886-120">Если передача моментального снимка прерывается в любой точке, она автоматически возобновляется, не передавая повторно файлы, которые уже были переданы полностью.</span><span class="sxs-lookup"><span data-stu-id="73886-120">If the snapshot transfer is interrupted at any point, it will automatically resume and will not resend any files that have already been completely transferred.</span></span> <span data-ttu-id="73886-121">Единицей доставки для агента моментальных снимков является BCP-файл статьи публикации, поэтому файлы, доставленные частично, должны быть повторно доставлены полностью.</span><span class="sxs-lookup"><span data-stu-id="73886-121">The unit of delivery for the Snapshot Agent is the bcp file for each publication article, so files that are partially delivered must be completely redelivered.</span></span> <span data-ttu-id="73886-122">Однако возобновление моментального снимка может значительно снизить объем передаваемых данных и гарантировать своевременную доставку снимка, даже если соединение ненадежно.</span><span class="sxs-lookup"><span data-stu-id="73886-122">However, resuming the snapshot can significantly reduce the amount of data transmitted and ensure timely snapshot delivery even if the connection is unreliable.</span></span>  
  
## <a name="snapshot-options"></a><span data-ttu-id="73886-123">Параметры моментального снимка</span><span class="sxs-lookup"><span data-stu-id="73886-123">Snapshot Options</span></span>  
 <span data-ttu-id="73886-124">При инициализации подписки с помощью моментального снимка есть несколько возможностей.</span><span class="sxs-lookup"><span data-stu-id="73886-124">There are a number of options available when initializing a subscription with a snapshot.</span></span> <span data-ttu-id="73886-125">Вы можете:</span><span class="sxs-lookup"><span data-stu-id="73886-125">You can:</span></span>  
  
-   <span data-ttu-id="73886-126">Указать другое расположение папки моментальных снимков вместо или дополнительно к папке по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="73886-126">Specify an alternate snapshot folder location instead of, or in addition, to the default snapshot folder location.</span></span> <span data-ttu-id="73886-127">Дополнительные сведения см. в статье [Alternate Snapshot Folder Locations](alternate-snapshot-folder-locations.md).</span><span class="sxs-lookup"><span data-stu-id="73886-127">For more information, see [Alternate Snapshot Folder Locations](alternate-snapshot-folder-locations.md).</span></span>  
  
-   <span data-ttu-id="73886-128">Сжать моментальные снимки для хранения на съемном носителе или для передачи по медленной сети.</span><span class="sxs-lookup"><span data-stu-id="73886-128">Compress snapshots for storage on removable media or for transfer over a slow network.</span></span> <span data-ttu-id="73886-129">Дополнительные сведения см. в разделе [Compressed Snapshots](compressed-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="73886-129">For more information, see [Compressed Snapshots](compressed-snapshots.md).</span></span>  
  
-   <span data-ttu-id="73886-130">Выполнить скрипты Transact-SQL до или после применения моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="73886-130">Execute Transact-SQL scripts before or after the snapshot is applied.</span></span> <span data-ttu-id="73886-131">Дополнительные сведения см. в статье [Выполнение скриптов до и после применения моментального снимка](snapshot-options.md#execute-scripts-before-and-after-snapshot-is-applied).</span><span class="sxs-lookup"><span data-stu-id="73886-131">For more information, see [Execute Scripts Before and After the Snapshot Is Applied](snapshot-options.md#execute-scripts-before-and-after-snapshot-is-applied).</span></span>  
  
-   <span data-ttu-id="73886-132">Передать файлы моментальных снимков с помощью протокола передачи файлов (FTP).</span><span class="sxs-lookup"><span data-stu-id="73886-132">Transfer snapshot files using File Transfer Protocol (FTP).</span></span> <span data-ttu-id="73886-133">Дополнительные сведения см. в статье [Передача моментальных снимков через FTP](transfer-snapshots-through-ftp.md).</span><span class="sxs-lookup"><span data-stu-id="73886-133">For more information, see [Transfer Snapshots Through FTP](transfer-snapshots-through-ftp.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="73886-134">См. также:</span><span class="sxs-lookup"><span data-stu-id="73886-134">See Also</span></span>  
 <span data-ttu-id="73886-135">[Инициализация подписки](initialize-a-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="73886-135">[Initialize a Subscription](initialize-a-subscription.md) </span></span>  
 [<span data-ttu-id="73886-136">Защита папки моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="73886-136">Secure the Snapshot Folder</span></span>](security/secure-the-snapshot-folder.md)  
  
  
