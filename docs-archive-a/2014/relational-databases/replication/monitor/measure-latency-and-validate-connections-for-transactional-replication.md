---
title: Измерение задержки и проверка правильности соединений для репликации транзакций | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Replication Monitor, performance
- tracer tokens [SQL Server replication]
- latency [SQL Server replication]
- transactional replication, tracer tokens
- monitoring performance [SQL Server replication], tracer tokens
ms.assetid: 4addd426-7523-4067-8d7d-ca6bae4c9e34
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 3ba1e5eddfdcffa5fbefdea323f110ba9d15ca8c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87657653"
---
# <a name="measure-latency-and-validate-connections-for-transactional-replication"></a><span data-ttu-id="e0e4b-102">Измерение задержки и проверка правильности соединений для репликации транзакций</span><span class="sxs-lookup"><span data-stu-id="e0e4b-102">Measure Latency and Validate Connections for Transactional Replication</span></span>
  <span data-ttu-id="e0e4b-103">В данном разделе описывается измерение задержки и проверка соединений для репликации транзакций в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] с помощью монитора репликации, [!INCLUDE[tsql](../../../includes/tsql-md.md)]или объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-103">This topic describes how to measure latency and validate connections for transactional replication in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using Replication Monitor, [!INCLUDE[tsql](../../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="e0e4b-104">Репликация транзакций предоставляет функцию трассировочных токенов, которая обеспечивает удобный способ измерения длительности задержки в топологиях репликации транзакций и помогает проверять соединения между издателем, распространителем и подписчиками.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-104">Transactional replication provides the tracer token feature, which provides a convenient way to measure latency in transactional replication topologies and to validate the connections between the Publisher, Distributor and Subscribers.</span></span> <span data-ttu-id="e0e4b-105">Токен (небольшой объем данных) записывается в журнал транзакций базы данных публикации и помечается так, как если бы он был обычной реплицируемой транзакцией, а затем проходит по системе, позволяя вычислить следующие характеристики:</span><span class="sxs-lookup"><span data-stu-id="e0e4b-105">A token (a small amount of data) is written to the transaction log of the publication database, marked as though it were a typical replicated transaction, and sent through the system, allowing a calculation of:</span></span>  
  
-   <span data-ttu-id="e0e4b-106">Время, прошедшее между фиксацией транзакции на издателе и вставкой соответствующей команды в базу данных распространителя на распространителе.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-106">How much time elapses between a transaction being committed at the Publisher and the corresponding command being inserted in the distribution database at the Distributor.</span></span>  
  
-   <span data-ttu-id="e0e4b-107">Время, прошедшее между вставкой команды в базу данных распространителя и соответствующей транзакцией, зафиксированной у подписчика.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-107">How much time elapses between a command being inserted in the distribution database and the corresponding transaction being committed at a Subscriber.</span></span>  
  
 <span data-ttu-id="e0e4b-108">Из этих вычислений можно получить ответы на следующие вопросы:</span><span class="sxs-lookup"><span data-stu-id="e0e4b-108">From these calculations, you can answer a number of questions, including:</span></span>  
  
-   <span data-ttu-id="e0e4b-109">Какой подписчик позднее всех получает изменения от издателя?</span><span class="sxs-lookup"><span data-stu-id="e0e4b-109">Which Subscribers take the longest to receive a change from the Publisher?</span></span>  
  
-   <span data-ttu-id="e0e4b-110">Какие подписчики, ожидающие получение трассировочного токена, его не получили (если таковые имеются)?</span><span class="sxs-lookup"><span data-stu-id="e0e4b-110">Of the Subscribers expected to receive the tracer token, which, if any, have not received it?</span></span>  
  
 <span data-ttu-id="e0e4b-111">**В этом разделе**</span><span class="sxs-lookup"><span data-stu-id="e0e4b-111">**In This Topic**</span></span>  
  
-   <span data-ttu-id="e0e4b-112">**Перед началом работы**</span><span class="sxs-lookup"><span data-stu-id="e0e4b-112">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="e0e4b-113">Ограничения</span><span class="sxs-lookup"><span data-stu-id="e0e4b-113">Limitations and Restrictions</span></span>](#Restrictions)  
  
-   <span data-ttu-id="e0e4b-114">**Для измерения задержки и проверки соединений используется:**</span><span class="sxs-lookup"><span data-stu-id="e0e4b-114">**To measure latency and validate connections, using:**</span></span>  
  
     [<span data-ttu-id="e0e4b-115">Монитор репликации SQL Server</span><span class="sxs-lookup"><span data-stu-id="e0e4b-115">SQL Server Replication Monitor</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="e0e4b-116">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="e0e4b-116">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="e0e4b-117">Объекты RMO</span><span class="sxs-lookup"><span data-stu-id="e0e4b-117">Replication Management Objects</span></span>](#RMOProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="e0e4b-118">Перед началом</span><span class="sxs-lookup"><span data-stu-id="e0e4b-118">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="e0e4b-119">Ограничения</span><span class="sxs-lookup"><span data-stu-id="e0e4b-119">Limitations and Restrictions</span></span>  
 <span data-ttu-id="e0e4b-120">Трассировочные токены также могут быть полезны при «замораживании» системы, когда останавливаются все действия и проверяется получение всеми узлами всех необработанных изменений.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-120">Tracer tokens can also be useful when quiescing a system, which involves stopping all activity and verifying that all nodes have received all outstanding changes.</span></span> <span data-ttu-id="e0e4b-121">Дополнительные сведения см. в разделе [Замораживание топологии репликации (программирование репликации на языке Transact-SQL)](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span><span class="sxs-lookup"><span data-stu-id="e0e4b-121">For more information, see [Quiesce a Replication Topology &#40;Replication Transact-SQL Programming&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span></span>  
  
 <span data-ttu-id="e0e4b-122">Чтобы использовать трассировочные токены, необходимо использовать определенные версии [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="e0e4b-122">To use tracer tokens, you must use certain versions of [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>  
  
-   <span data-ttu-id="e0e4b-123">Распространитель должен быть [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-123">The Distributor must be [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span>  
  
-   <span data-ttu-id="e0e4b-124">Издатель должен быть [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] или более поздней версии, либо издателем Oracle.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-124">The Publisher must be [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later or be an Oracle Publisher.</span></span>  
  
-   <span data-ttu-id="e0e4b-125">Для принудительных подписок статистика трассировочного токена собирается от издателя, распространителя и подписчиков, если подписчик равен [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7,0 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-125">For push subscriptions, tracer token statistics are gathered from the Publisher, Distributor, and Subscribers if the Subscriber is [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7.0 or later.</span></span>  
  
-   <span data-ttu-id="e0e4b-126">Для подписок по запросу статистика по трассировочным токенам собирается с подписчиков, только если это подписчик [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-126">For pull subscriptions, tracer token statistics are gathered from Subscribers only if the Subscriber is [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span> <span data-ttu-id="e0e4b-127">Если подписчик равен [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7,0 или [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2000](../../../includes/ssversion2000-md.md)] , статистика собирается только от издателя и распространителя.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-127">If the Subscriber is [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7.0 or [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2000](../../../includes/ssversion2000-md.md)], statistics are gathered only from the Publisher and Distributor.</span></span>  
  
 <span data-ttu-id="e0e4b-128">Следует также учитывать ряд других вопросов и ограничений:</span><span class="sxs-lookup"><span data-stu-id="e0e4b-128">There are also a number of other issues and restrictions to be aware of:</span></span>  
  
-   <span data-ttu-id="e0e4b-129">Подписки должны быть активными, чтобы получать трассировочный токен.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-129">Subscriptions must be active to receive a tracer token.</span></span> <span data-ttu-id="e0e4b-130">Подписка является активной, если она инициализирована.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-130">A subscription is active if it has been initialized.</span></span>  
  
-   <span data-ttu-id="e0e4b-131">При повторной инициализации удаляются все отложенные трассировочные токены для соответствующих подписок.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-131">Reinitialization removes any pending tracer tokens for the relevant subscriptions.</span></span>  
  
-   <span data-ttu-id="e0e4b-132">Подписчики получают только трассировочные токены, созданные после их исходной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-132">Subscribers only receive tracer tokens that were created after their initial synchronization.</span></span>  
  
-   <span data-ttu-id="e0e4b-133">Трассировочные токены не пересылаются переиздающими подписчиками.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-133">Tracer tokens are not forwarded by republishing Subscribers.</span></span>  
  
-   <span data-ttu-id="e0e4b-134">После отработки отказа на вторичной реплике монитор репликации не сможет изменить имя экземпляра публикации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и будет продолжать отображать сведения о репликации по имени исходного первичного экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e0e4b-134">After failover to a secondary, Replication Monitor is unable to adjust the name of the publishing instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and will continue to display replication information under the name of the original primary instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="e0e4b-135">После отработки отказа нельзя ввести трассировочный токен с помощью монитора репликации, но трассировочный токен, введенный в новый издатель с помощью [!INCLUDE[tsql](../../../includes/tsql-md.md)], отображается в мониторе репликации.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-135">After failover, a tracer token cannot be entered by using the Replication Monitor, however a tracer token entered on the new publisher by using [!INCLUDE[tsql](../../../includes/tsql-md.md)], is visible in Replication Monitor.</span></span>  
  
##  <a name="using-sql-server-replication-monitor"></a><a name="SSMSProcedure"></a><span data-ttu-id="e0e4b-136">Использование монитора Репликация SQL Server</span><span class="sxs-lookup"><span data-stu-id="e0e4b-136">Using SQL Server Replication Monitor</span></span>  
 <span data-ttu-id="e0e4b-137">Сведения о запуске монитора репликации см. в [этой статье](start-the-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="e0e4b-137">For information about starting Replication Monitor, see [Start the Replication Monitor](start-the-replication-monitor.md).</span></span>  
  
#### <a name="to-insert-a-tracer-token-and-view-information-on-the-token"></a><span data-ttu-id="e0e4b-138">Вставка трассировочного токена и просмотр сведений о токене</span><span class="sxs-lookup"><span data-stu-id="e0e4b-138">To insert a tracer token and view information on the token</span></span>  
  
1.  <span data-ttu-id="e0e4b-139">Раскройте на левой панели группу издателей, раскройте издатель и выберите нужную публикацию.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-139">Expand a Publisher group in the left pane, expand a Publisher, and then click a publication.</span></span>  
  
2.  <span data-ttu-id="e0e4b-140">Щелкните вкладку **Трассировочные токены** .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-140">Click the **Tracer Tokens** tab.</span></span>  
  
3.  <span data-ttu-id="e0e4b-141">Выберите команду **Вставить трассировочный маркер**.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-141">Click **Insert Tracer**.</span></span>  
  
4.  <span data-ttu-id="e0e4b-142">Просмотрите затраченное время для трассировочного маркера в следующих столбцах: **От издателя к распространителю**, **От распространителя к подписчику**, **Общая задержка**.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-142">View elapsed time for the tracer token in the following columns: **Publisher to Distributor**, **Distributor to Subscriber**, **Total Latency**.</span></span> <span data-ttu-id="e0e4b-143">Значение **Pending** указывает, что маркер не достиг данной точки.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-143">A value of **Pending** indicates that the token has not reached a given point.</span></span>  
  
#### <a name="to-view-information-on-a-tracer-token-inserted-previously"></a><span data-ttu-id="e0e4b-144">Просмотр сведений о трассировочном токене, вставленном ранее</span><span class="sxs-lookup"><span data-stu-id="e0e4b-144">To view information on a tracer token inserted previously</span></span>  
  
1.  <span data-ttu-id="e0e4b-145">Раскройте на левой панели группу издателей, раскройте издатель и выберите нужную публикацию.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-145">Expand a Publisher group in the left pane, expand a Publisher, and then click a publication.</span></span>  
  
2.  <span data-ttu-id="e0e4b-146">Щелкните вкладку **Трассировочные токены** .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-146">Click the **Tracer Tokens** tab.</span></span>  
  
3.  <span data-ttu-id="e0e4b-147">Выберите время в раскрывающемся списке **Время вставки** .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-147">Select a time from the **Time inserted** drop-down list.</span></span>  
  
4.  <span data-ttu-id="e0e4b-148">Просмотрите затраченное время для трассировочного маркера в следующих столбцах: **От издателя к распространителю**, **От распространителя к подписчику**, **Общая задержка**.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-148">View elapsed time for the tracer token in the following columns: **Publisher to Distributor**, **Distributor to Subscriber**, **Total Latency**.</span></span> <span data-ttu-id="e0e4b-149">Значение **Pending** указывает, что маркер не достиг данной точки.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-149">A value of **Pending** indicates that the token has not reached a given point.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="e0e4b-150">Данные трассировочных токенов хранятся в течение того же периода времени, что и другие данные предыстории; этот период определяется сроком хранения журнала в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-150">Tracer token information is retained for the same time period as other historical data, which is governed by the history retention period of the distribution database.</span></span> <span data-ttu-id="e0e4b-151">Дополнительные сведения о доступе к этим диалоговым окнам см. в статье [Просмотр и изменение свойств издателя и распространителя](../view-and-modify-distributor-and-publisher-properties.md).</span><span class="sxs-lookup"><span data-stu-id="e0e4b-151">For information about changing distribution database properties, see [View and Modify Distributor and Publisher Properties](../view-and-modify-distributor-and-publisher-properties.md).</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="e0e4b-152">Использование Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="e0e4b-152">Using Transact-SQL</span></span>  
  
#### <a name="to-post-a-tracer-token-to-a-transactional-publication"></a><span data-ttu-id="e0e4b-153">Отправка трассировочного токена в публикацию транзакций</span><span class="sxs-lookup"><span data-stu-id="e0e4b-153">To post a tracer token to a transactional publication</span></span>  
  
1.  <span data-ttu-id="e0e4b-154">На издателе в базе данных публикации выполните хранимую процедуру [sp_helppublication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql) (необязательно).</span><span class="sxs-lookup"><span data-stu-id="e0e4b-154">(Optional) At the Publisher on the publication database, execute [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span> <span data-ttu-id="e0e4b-155">Удостоверьтесь в том, что публикация существует и находится в активном состоянии.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-155">Verify that the publication exists and that the status is active.</span></span>  
  
2.  <span data-ttu-id="e0e4b-156">На издателе в базе данных публикации выполните хранимую процедуру [sp_helpsubscription (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-helpsubscription-transact-sql) (необязательно).</span><span class="sxs-lookup"><span data-stu-id="e0e4b-156">(Optional) At the Publisher on the publication database, execute [sp_helpsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpsubscription-transact-sql).</span></span> <span data-ttu-id="e0e4b-157">Удостоверьтесь в том, что подписка существует и находится в активном состоянии.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-157">Verify that the subscription exists and that the status is active.</span></span>  
  
3.  <span data-ttu-id="e0e4b-158">На издателе в базе данных издателя выполните процедуру [sp_posttracertoken (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-posttracertoken-transact-sql), указав параметр **@publication**.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-158">At the Publisher on the publication database, execute [sp_posttracertoken &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-posttracertoken-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="e0e4b-159">Запишите значение **@tracer_token_id** параметра OUTPUT.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-159">Note the value of the **@tracer_token_id** output parameter.</span></span>  
  
#### <a name="to-determine-latency-and-validate-connections-for-a-transactional-publication"></a><span data-ttu-id="e0e4b-160">Измерение задержки и проверка соединений для публикации транзакций</span><span class="sxs-lookup"><span data-stu-id="e0e4b-160">To determine latency and validate connections for a transactional publication</span></span>  
  
1.  <span data-ttu-id="e0e4b-161">Передайте трассировочный токен в публикацию при помощи описанной выше процедуры.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-161">Post a tracer token to the publication using the previous procedure.</span></span>  
  
2.  <span data-ttu-id="e0e4b-162">На издателе в базе данных издателя выполните процедуру [sp_helptracertokens (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), указав параметр **@publication**.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-162">At the Publisher on the publication database, execute [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="e0e4b-163">Будет возвращен список всех трассировочных токенов, опубликованных для публикации.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-163">This returns a list of all tracer tokens posted to the publication.</span></span> <span data-ttu-id="e0e4b-164">Запомните нужное значение **tracer_id** в результирующем наборе.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-164">Note the desired **tracer_id** in the result set.</span></span>  
  
3.  <span data-ttu-id="e0e4b-165">На издателе в базе данных издателя выполните процедуру [sp_helptracertokenhistory (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-helptracertokenhistory-transact-sql), указав параметр **@publication** и идентификатор трассировочного маркера, полученного на шаге 2, в параметре **@tracer_id**.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-165">At the Publisher on the publication database, execute [sp_helptracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokenhistory-transact-sql), specifying **@publication** and the tracer token ID from step 2 for **@tracer_id**.</span></span> <span data-ttu-id="e0e4b-166">В результате этого будут возвращены сведения о задержке для выделенного трассировочного токена.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-166">This returns latency information for the selected tracer token.</span></span>  
  
#### <a name="to-remove-tracer-tokens"></a><span data-ttu-id="e0e4b-167">Удаление трассировочных токенов</span><span class="sxs-lookup"><span data-stu-id="e0e4b-167">To remove tracer tokens</span></span>  
  
1.  <span data-ttu-id="e0e4b-168">На издателе в базе данных издателя выполните процедуру [sp_helptracertokens (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), указав параметр **@publication**.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-168">At the Publisher on the publication database, execute [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="e0e4b-169">Будет возвращен список всех трассировочных токенов, опубликованных для публикации.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-169">This returns a list of all tracer tokens posted to the publication.</span></span> <span data-ttu-id="e0e4b-170">Запомните нужное значение **tracer_id** в результирующем наборе для удаляемого трассировочного токена.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-170">Note the **tracer_id** for the tracer token to delete in the result set.</span></span>  
  
2.  <span data-ttu-id="e0e4b-171">На издателе в базе данных публикации выполните хранимую процедуру [sp_deletetracertokenhistory (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-deletetracertokenhistory-transact-sql), указав параметр **@publication**, а также идентификатор удаляемого трассировочного маркера, полученного на шаге 2, в параметре **@tracer_id**.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-171">At the Publisher on the publication database, execute [sp_deletetracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-deletetracertokenhistory-transact-sql), specifying **@publication** and the ID of the tracer to delete from step 2 for **@tracer_id**.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="e0e4b-172">Примеры (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="e0e4b-172">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="e0e4b-173">В этом примере продемонстрирована отправка трассировочного токена, и просмотр сведений о задержке по возвращенному идентификатору отправленного трассировочного токена.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-173">This example posts a tracer token record and uses the returned ID of the posted tracer token to view latency information.</span></span>  
  
 [!code-sql[HowTo#sp_tracertokens](../../../snippets/tsql/SQL15/replication/howto/tsql/createtracertokens.sql#sp_tracertokens)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="e0e4b-174">При помощи объектов RMO</span><span class="sxs-lookup"><span data-stu-id="e0e4b-174">Using Replication Management Objects (RMO)</span></span>  
  
#### <a name="to-post-a-tracer-token-to-a-transactional-publication"></a><span data-ttu-id="e0e4b-175">Отправка трассировочного токена в публикацию транзакций</span><span class="sxs-lookup"><span data-stu-id="e0e4b-175">To post a tracer token to a transactional publication</span></span>  
  
1.  <span data-ttu-id="e0e4b-176">Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-176">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="e0e4b-177">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.TransPublication>.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-177">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class.</span></span>  
  
3.  <span data-ttu-id="e0e4b-178">Задайте для публикации свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> и <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> , а также установите созданное на шаге 1 соединение <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> в качестве значения для свойства.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-178">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="e0e4b-179">Чтобы получить свойства объекта, вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-179">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="e0e4b-180">Если этот метод возвращает `false`, то либо на шаге 3 были неверно определены свойства публикации, либо публикация не существует.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-180">If this method returns `false`, either the publication properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="e0e4b-181">Вызовите метод <xref:Microsoft.SqlServer.Replication.TransPublication.PostTracerToken%2A> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-181">Call the <xref:Microsoft.SqlServer.Replication.TransPublication.PostTracerToken%2A> method.</span></span> <span data-ttu-id="e0e4b-182">Этот метод обеспечивает вставку трассировочного токена в журнал транзакций публикации.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-182">This method inserts a tracer token into the publication's transaction log.</span></span>  
  
#### <a name="to-determine-latency-and-validate-connections-for-a-transactional-publication"></a><span data-ttu-id="e0e4b-183">Измерение задержки и проверка соединений для публикации транзакций</span><span class="sxs-lookup"><span data-stu-id="e0e4b-183">To determine latency and validate connections for a transactional publication</span></span>  
  
1.  <span data-ttu-id="e0e4b-184">Создайте соединение с распространителем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-184">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="e0e4b-185">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.PublicationMonitor>.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-185">Create an instance of the <xref:Microsoft.SqlServer.Replication.PublicationMonitor> class.</span></span>  
  
3.  <span data-ttu-id="e0e4b-186">Установите свойства <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>и <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> , а в качестве значения свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> установите созданное на шаге 1 соединение.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-186">Set the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>, and <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> properties, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="e0e4b-187">Чтобы получить свойства объекта, вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-187">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="e0e4b-188">Если этот метод возвращает `false`, то либо на шаге 3 были неверно определены свойства монитора публикации, либо публикация не существует.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-188">If this method returns `false`, either the publication monitor properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="e0e4b-189">Вызовите метод <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-189">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> method.</span></span> <span data-ttu-id="e0e4b-190">Приведите возвращенный объект <xref:System.Collections.ArrayList> к типу массива объектов <xref:Microsoft.SqlServer.Replication.TracerToken> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-190">Cast the returned <xref:System.Collections.ArrayList> object to an array of <xref:Microsoft.SqlServer.Replication.TracerToken> objects.</span></span>  
  
6.  <span data-ttu-id="e0e4b-191">Вызовите метод <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokenHistory%2A> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-191">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokenHistory%2A> method.</span></span> <span data-ttu-id="e0e4b-192">Передайте значение <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> для трассировочного токена, полученного на шаге 5.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-192">Pass a value of <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> for a tracer token from step 5.</span></span> <span data-ttu-id="e0e4b-193">В результате будут возвращены сведения о задержке для выделенного трассировочного токена в виде объекта <xref:System.Data.DataSet> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-193">This returns latency information for the selected tracer token as a <xref:System.Data.DataSet> object.</span></span> <span data-ttu-id="e0e4b-194">Если возвращены все сведения о трассировочном токене, то существует соединение между издателем и распространителем, а также соединение между распространителем и подписчиком, и топология репликации работоспособна.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-194">If all tracer token information is returned, the connection between the Publisher and Distributor and the connection between the Distributor and the Subscriber both exist and the replication topology is functioning.</span></span>  
  
#### <a name="to-remove-tracer-tokens"></a><span data-ttu-id="e0e4b-195">Удаление трассировочных токенов</span><span class="sxs-lookup"><span data-stu-id="e0e4b-195">To remove tracer tokens</span></span>  
  
1.  <span data-ttu-id="e0e4b-196">Создайте соединение с распространителем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-196">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="e0e4b-197">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.PublicationMonitor>.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-197">Create an instance of the <xref:Microsoft.SqlServer.Replication.PublicationMonitor> class.</span></span>  
  
3.  <span data-ttu-id="e0e4b-198">Установите свойства <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>и <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> , а в качестве значения свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> установите созданное на шаге 1 соединение.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-198">Set the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>, and <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> properties, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="e0e4b-199">Чтобы получить свойства объекта, вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-199">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="e0e4b-200">Если этот метод возвращает `false`, то либо на шаге 3 были неверно определены свойства монитора публикации, либо публикация не существует.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-200">If this method returns `false`, either the publication monitor properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="e0e4b-201">Вызовите метод <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-201">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> method.</span></span> <span data-ttu-id="e0e4b-202">Приведите возвращенный объект <xref:System.Collections.ArrayList> к типу массива объектов <xref:Microsoft.SqlServer.Replication.TracerToken> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-202">Cast the returned <xref:System.Collections.ArrayList> object to an array of <xref:Microsoft.SqlServer.Replication.TracerToken> objects.</span></span>  
  
6.  <span data-ttu-id="e0e4b-203">Вызовите метод <xref:Microsoft.SqlServer.Replication.PublicationMonitor.CleanUpTracerTokenHistory%2A> .</span><span class="sxs-lookup"><span data-stu-id="e0e4b-203">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.CleanUpTracerTokenHistory%2A> method.</span></span> <span data-ttu-id="e0e4b-204">Передайте одно из следующих значений.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-204">Pass one of the following values:</span></span>  
  
    -   <span data-ttu-id="e0e4b-205">Значение <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> для трассировочного токена, полученного на шаге 5.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-205">The <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> for a tracer token from step 5.</span></span> <span data-ttu-id="e0e4b-206">В результате этого сведения для выделенного токена будут удалены.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-206">This deletes information for a selected token.</span></span>  
  
    -   <span data-ttu-id="e0e4b-207">Объект <xref:System.DateTime>.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-207">A <xref:System.DateTime> object.</span></span> <span data-ttu-id="e0e4b-208">В результате этого будут удалены сведения обо всех токенах, созданных до наступления указанного момента времени.</span><span class="sxs-lookup"><span data-stu-id="e0e4b-208">This deletes information for all tokens older than the specified date and time.</span></span>  
  
###  <a name="PShellExample"></a>  
