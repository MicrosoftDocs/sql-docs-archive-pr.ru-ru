---
title: Окончание срока действия и отключение подписки | Документация Майкрософт
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Distributors [SQL Server replication], distribution retention period
- subscriptions [SQL Server replication], expiration
- publications [SQL Server replication], publication retention periods
- expiration [SQL Server replication]
- retention periods [SQL Server replication]
- publication retention periods
- distribution retention period
- subscriptions [SQL Server replication], deactivation
- deactivating subscriptions
ms.assetid: 4d03f5ab-e721-4f56-aebc-60f6a56c1e07
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6d81e8b5c02fcfe5399be9e63c8160036a999547
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87749691"
---
# <a name="subscription-expiration-and-deactivation"></a><span data-ttu-id="18def-102">Окончание срока действия и отключение подписки</span><span class="sxs-lookup"><span data-stu-id="18def-102">Subscription Expiration and Deactivation</span></span>
  <span data-ttu-id="18def-103">Подписки могут быть деактивированы или могут закончиться сроки их действия, если они не будут синхронизированы в течение определенного *срока хранения*.</span><span class="sxs-lookup"><span data-stu-id="18def-103">Subscriptions can be deactivated or can expire if they are not synchronized within a specified *retention period*.</span></span> <span data-ttu-id="18def-104">Выполняемое действие зависит от типа репликации и от превышенного срока хранения.</span><span class="sxs-lookup"><span data-stu-id="18def-104">The action that occurs depends on the type of replication and the retention period that is exceeded.</span></span>  
  
 <span data-ttu-id="18def-105">Чтобы задать сроки хранения, выполните действия из статей [Установка срока действия подписок](publish/set-the-expiration-period-for-subscriptions.md), [Настройка срока хранения распространения для публикаций транзакций (SQL Server Management Studio)](set-distribution-retention-period-for-transactional-publications.md) и [Настройки публикации и распространения](configure-publishing-and-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="18def-105">To set retention periods, see [Set the Expiration Period for Subscriptions](publish/set-the-expiration-period-for-subscriptions.md), [Set the Distribution Retention Period for Transactional Publications &#40;SQL Server Management Studio&#41;](set-distribution-retention-period-for-transactional-publications.md), and [Configure Publishing and Distribution](configure-publishing-and-distribution.md).</span></span>  
  
## <a name="transactional-replication"></a><span data-ttu-id="18def-106">репликация транзакций</span><span class="sxs-lookup"><span data-stu-id="18def-106">Transactional Replication</span></span>  
 <span data-ttu-id="18def-107">Репликация транзакций использует максимальный срок хранения распространения ( **@max_distretention** параметр [Sp_adddistributiondb &#40;TRANSACT-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql)) и срок хранения публикации ( **@retention** параметр [sp_addpublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql)):</span><span class="sxs-lookup"><span data-stu-id="18def-107">Transactional replication uses the maximum distribution retention period (the **@max_distretention** parameter of [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql)) and the publication retention period (the **@retention** parameter of [sp_addpublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql)):</span></span>  
  
-   <span data-ttu-id="18def-108">Если подписка не синхронизирована в пределах максимального срока хранения распространения (по умолчанию 72 часа) и в базе данных распространителя есть изменения, которые не были доставлены подписчику, то подписка будет помечена как деактивированная заданием **Очистка распространения** , выполняемым на распространителе.</span><span class="sxs-lookup"><span data-stu-id="18def-108">If a subscription is not synchronized within the maximum distribution retention period (default of 72 hours) and there are changes in the distribution database that have not been delivered to the Subscriber, the subscription will be marked deactivated by the **Distribution clean up** job that runs on the Distributor.</span></span> <span data-ttu-id="18def-109">Эта подписка должна быть инициализирована повторно.</span><span class="sxs-lookup"><span data-stu-id="18def-109">The subscription must be reinitialized.</span></span>  
  
-   <span data-ttu-id="18def-110">Если подписка не будет синхронизирована в пределах срока хранения публикации (по умолчанию 336 часов), то срок действия подписки истечет и она будет удалена заданием **Очистка истекшей подписки** , выполняемым на издателе.</span><span class="sxs-lookup"><span data-stu-id="18def-110">If a subscription is not synchronized within the publication retention period (default of 336 hours), the subscription will expire and be dropped by the **Expired subscription clean up** job that runs on the Publisher.</span></span> <span data-ttu-id="18def-111">Эта подписка должна быть вновь создана и синхронизирована.</span><span class="sxs-lookup"><span data-stu-id="18def-111">The subscription must be recreated and synchronized.</span></span>  
  
     <span data-ttu-id="18def-112">Если истекает срок действия принудительной подписки, она полностью удаляется, а подписки по запросу не удаляются.</span><span class="sxs-lookup"><span data-stu-id="18def-112">If a push subscription expires, it is completely removed, but pull subscriptions are not.</span></span> <span data-ttu-id="18def-113">Подписки по запросу должны удаляться на подписчике.</span><span class="sxs-lookup"><span data-stu-id="18def-113">You must clean up pull subscriptions at the Subscriber.</span></span> <span data-ttu-id="18def-114">Дополнительные сведения см. в статье [Delete a Pull Subscription](delete-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="18def-114">For more information, see [Delete a Pull Subscription](delete-a-pull-subscription.md).</span></span>  
  
## <a name="merge-replication"></a><span data-ttu-id="18def-115">Репликация слиянием</span><span class="sxs-lookup"><span data-stu-id="18def-115">Merge Replication</span></span>  
 <span data-ttu-id="18def-116">Репликация слиянием использует срок хранения публикации ( **@retention** **@retention_period_unit** параметры и [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="18def-116">Merge replication uses the publication retention period (the **@retention** and **@retention_period_unit** parameters of [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql)).</span></span> <span data-ttu-id="18def-117">Когда срок действия подписки истекает, ее необходимо повторно инициализировать, потому что метаданные для этой подписки удаляются.</span><span class="sxs-lookup"><span data-stu-id="18def-117">When a subscription expires, it must be reinitialized, because metadata for the subscription is removed.</span></span> <span data-ttu-id="18def-118">Не инициализированные повторно подписки удаляются заданием **Очистка истекшей подписки** , выполняемым на издателе.</span><span class="sxs-lookup"><span data-stu-id="18def-118">Subscriptions that are not reinitialized are dropped by the **Expired subscription clean up** job that runs on the Publisher.</span></span> <span data-ttu-id="18def-119">По умолчанию это задание запускается ежедневно; оно удаляет все принудительные подписки, которые не синхронизированы для удвоения срока хранения публикации.</span><span class="sxs-lookup"><span data-stu-id="18def-119">By default, this job runs daily; it removes all push subscriptions that have not synchronized for double the length of the publication retention period.</span></span> <span data-ttu-id="18def-120">Пример:</span><span class="sxs-lookup"><span data-stu-id="18def-120">For example:</span></span>  
  
-   <span data-ttu-id="18def-121">Допустим, срок хранения публикации равен 14 дням, тогда действие подписки может истечь, если она не будет синхронизирована в течение 14 дней.</span><span class="sxs-lookup"><span data-stu-id="18def-121">If a publication has a retention period of 14 days, a subscription can expire if it has not synchronized within 14 days.</span></span>  
  
     <span data-ttu-id="18def-122">Если на издателе выполняется [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] или более поздняя версия, и агент подписки входит в состав [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] или более поздней версии, тогда действие подписки истечет, только если будут внесены изменения в данные секции этой подписки.</span><span class="sxs-lookup"><span data-stu-id="18def-122">If the Publisher is running [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or a later version and the agent for the subscription is from [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or a later version, a subscription only expires if there have been changes to the data in that subscription's partition.</span></span> <span data-ttu-id="18def-123">Например, предположим, что подписчик получает пользовательские данные только для клиентов в Германии.</span><span class="sxs-lookup"><span data-stu-id="18def-123">For example, suppose a Subscriber receives customer data only for customers in Germany.</span></span> <span data-ttu-id="18def-124">Если срок хранения задан равным 14 дням, срок действия подписки истечет на 14-й день, только если за последние 14 дней не вносились изменения в данные немецких клиентов.</span><span class="sxs-lookup"><span data-stu-id="18def-124">If the retention period is set to 14 days, the subscription expires on day 14 only if there have been changes to the German customer data in the last 14 days.</span></span>  
  
-   <span data-ttu-id="18def-125">В интервале от 14 до 27 дней после последней синхронизации подписка может быть инициализирована повторно.</span><span class="sxs-lookup"><span data-stu-id="18def-125">From 14 days to 27 days after the last synchronization, the subscription can be reinitialized.</span></span>  
  
-   <span data-ttu-id="18def-126">Через 28 дней после последней синхронизации подписка удаляется заданием **Очистка истекшей подписки** .</span><span class="sxs-lookup"><span data-stu-id="18def-126">At 28 days after the last synchronization, the subscription is dropped by the **Expired subscription clean up** job.</span></span> <span data-ttu-id="18def-127">Если истекает срок действия принудительной подписки, она полностью удаляется, а подписки по запросу не удаляются.</span><span class="sxs-lookup"><span data-stu-id="18def-127">If a push subscription expires, it is completely removed, but pull subscriptions are not.</span></span> <span data-ttu-id="18def-128">Подписки по запросу должны удаляться на подписчике.</span><span class="sxs-lookup"><span data-stu-id="18def-128">You must clean up pull subscriptions at the Subscriber.</span></span> <span data-ttu-id="18def-129">Дополнительные сведения см. в статье [Delete a Pull Subscription](delete-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="18def-129">For more information, see [Delete a Pull Subscription](delete-a-pull-subscription.md).</span></span>  
  
### <a name="considerations-for-setting-the-publication-retention-period-for-merge-publications"></a><span data-ttu-id="18def-130">Вопросы установки срока хранения публикации слиянием</span><span class="sxs-lookup"><span data-stu-id="18def-130">Considerations for Setting the Publication Retention Period for Merge Publications</span></span>  
 <span data-ttu-id="18def-131">При установке срока хранения для публикаций слиянием учитывайте следующие факторы:</span><span class="sxs-lookup"><span data-stu-id="18def-131">Keep the following considerations in mind when setting the retention period for merge publications:</span></span>  
  
-   <span data-ttu-id="18def-132">Срок хранения для публикаций слиянием содержит 24-часовой льготный период для размещения подписчиков в разных часовых поясах.</span><span class="sxs-lookup"><span data-stu-id="18def-132">The retention period for merge publications has a 24-hour grace period to accommodate Subscribers in different time zones.</span></span> <span data-ttu-id="18def-133">Например, если установить срок хранения продолжительностью в один день, то действительный срок хранения будет равен 48 часам.</span><span class="sxs-lookup"><span data-stu-id="18def-133">If, for example, you set a retention period of one day, the actual retention period is 48 hours.</span></span>  
  
-   <span data-ttu-id="18def-134">Очистка метаданных репликации слиянием зависит от срока хранения публикации:</span><span class="sxs-lookup"><span data-stu-id="18def-134">Cleanup of merge replication metadata is dependent on the publication retention period:</span></span>  
  
    -   <span data-ttu-id="18def-135">Репликации не удастся очистить метаданные в базах данных публикации и подписки, пока не закончится срок хранения.</span><span class="sxs-lookup"><span data-stu-id="18def-135">Replication cannot clean up metadata in the publication and subscription databases until the retention period is reached.</span></span> <span data-ttu-id="18def-136">Будьте осмотрительны при указании больших значений срока хранения, так как они могут негативно сказываться на производительности репликации.</span><span class="sxs-lookup"><span data-stu-id="18def-136">Use caution in specifying a high value for the retention period, because it can negatively impact replication performance.</span></span> <span data-ttu-id="18def-137">Рекомендуется использовать небольшие значения, если можно надежно предсказать, что все подписчики будут синхронизироваться регулярно в течение указанного периода времени.</span><span class="sxs-lookup"><span data-stu-id="18def-137">It is recommended that you use a lower setting if you can reliably predict that all Subscribers will synchronize regularly within that time period.</span></span>  
  
    -   <span data-ttu-id="18def-138">Можно указать, что срок действия подписок никогда не истекает (значение 0 для **@retention** ), но настоятельно рекомендуется не использовать это значение, так как метаданные не могут быть очищены.</span><span class="sxs-lookup"><span data-stu-id="18def-138">It is possible to specify that subscriptions never expire (a value of 0 for **@retention**), but it is strongly recommended that you do not use this value, because metadata cannot be cleaned up.</span></span>  
  
-   <span data-ttu-id="18def-139">Срок хранения, устанавливаемый для любого переиздающего подписчика, не должен превышать срок хранения, заданный для исходного издателя.</span><span class="sxs-lookup"><span data-stu-id="18def-139">The retention period for any republisher must be set to a value equal to or less than the retention period set at the original Publisher.</span></span> <span data-ttu-id="18def-140">Для всех издателей и их альтернативных участников синхронизации также следует использовать одинаковые значения срока хранения публикаций.</span><span class="sxs-lookup"><span data-stu-id="18def-140">You should also use the same publication retention values for all Publishers and their alternate synchronization partners.</span></span> <span data-ttu-id="18def-141">Использование разных значений может привести к несогласованности данных.</span><span class="sxs-lookup"><span data-stu-id="18def-141">Using different values may lead to non-convergence.</span></span> <span data-ttu-id="18def-142">Если необходимо изменить значение срока хранения публикации, выполните повторную инициализацию подписчика, чтобы избежать несогласованности данных.</span><span class="sxs-lookup"><span data-stu-id="18def-142">If you need to change the publication retention value, reinitialize the Subscriber to avoid the non-convergence of data.</span></span>  
  
-   <span data-ttu-id="18def-143">Если после очистки срок хранения публикации увеличен и выполняется попытка объединения подписки с издателем (на котором уже удалены метаданные), срок действия подписки не истечет, поскольку было увеличено значение срока хранения.</span><span class="sxs-lookup"><span data-stu-id="18def-143">If, after a clean up, the publication retention period is increased and a subscription tries to merge with the Publisher (which has already deleted the metadata), the subscription will not expire because of the increased retention value.</span></span> <span data-ttu-id="18def-144">Однако издатель не имеет достаточно метаданных для загрузки изменений на подписчик, что ведет к несогласованности данных.</span><span class="sxs-lookup"><span data-stu-id="18def-144">However, the Publisher does not have enough metadata to download changes to the Subscriber, which leads to non-convergence.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="18def-145">См. также:</span><span class="sxs-lookup"><span data-stu-id="18def-145">See Also</span></span>  
 <span data-ttu-id="18def-146">[Повторная инициализация подписок](reinitialize-subscriptions.md) </span><span class="sxs-lookup"><span data-stu-id="18def-146">[Reinitialize Subscriptions](reinitialize-subscriptions.md) </span></span>  
 <span data-ttu-id="18def-147">[Администрирование агента репликации](agents/replication-agent-administration.md) </span><span class="sxs-lookup"><span data-stu-id="18def-147">[Replication Agent Administration](agents/replication-agent-administration.md) </span></span>  
 [<span data-ttu-id="18def-148">Подписка на публикации</span><span class="sxs-lookup"><span data-stu-id="18def-148">Subscribe to Publications</span></span>](subscribe-to-publications.md)  
  
  
