---
title: Создание моментального снимка для публикации слиянием с параметризованными фильтрами | Документация Майкрософт
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- parameterized filters [SQL Server replication], snapshots
- snapshots [SQL Server replication], parameterized filters and
- filters [SQL Server replication], parameterized
ms.assetid: 00dfb229-f1de-4d33-90b0-d7c99ab52dcb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: dad6f1648cba44b38e37720f7e395687f769d91e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87730526"
---
# <a name="create-a-snapshot-for-a-merge-publication-with-parameterized-filters"></a><span data-ttu-id="18498-102">Создание моментального снимка для публикации слиянием с параметризованными фильтрами</span><span class="sxs-lookup"><span data-stu-id="18498-102">Create a Snapshot for a Merge Publication with Parameterized Filters</span></span>
  <span data-ttu-id="18498-103">В данном разделе описывается процесс создания моментального снимка для публикации слиянием с параметризованными фильтрами в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)]или объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="18498-103">This topic describes how to create a snapshot for a merge publication with parameterized filters in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="18498-104">Перед началом</span><span class="sxs-lookup"><span data-stu-id="18498-104">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="18498-105">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="18498-105">Recommendations</span></span>  
  
-   <span data-ttu-id="18498-106">При создании моментальных снимков для публикации слиянием с помощью параметризованных фильтров необходимо сначала создать стандартный моментальный снимок (схему), который будет содержать все опубликованные данные и метаданные подписчика для подписки.</span><span class="sxs-lookup"><span data-stu-id="18498-106">When generating a snapshot for a merge publication using parameterized filters, you must first generate a standard (schema) snapshot that contains all of the published data and Subscriber metadata for the subscription.</span></span> <span data-ttu-id="18498-107">Дополнительные сведения см. в разделе [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="18498-107">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span> <span data-ttu-id="18498-108">После создания моментального снимка схемы можно создать моментальный снимок, содержащий секцию опубликованных данных для конкретного подписчика.</span><span class="sxs-lookup"><span data-stu-id="18498-108">After you have created the schema snapshot, you can generate the snapshot that contains the Subscriber-specific partition of the published data.</span></span>  
  
-   <span data-ttu-id="18498-109">Если при фильтрации одной или нескольких статей публикации получаются неперекрывающиеся секции, которые являются уникальными для каждой подписки, метаданные очищаются при каждом запуске агента слияния.</span><span class="sxs-lookup"><span data-stu-id="18498-109">If the filtering for one or more articles in the publication yields non-overlapping partitions that are unique for each subscription, metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="18498-110">Это означает, что срок действия секционированного снимка истекает быстрее.</span><span class="sxs-lookup"><span data-stu-id="18498-110">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="18498-111">При выборе этого параметра необходимо рассмотреть возможность разрешения подписчикам инициировать создание и доставку моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="18498-111">When using this option, you should consider allowing Subscribers to initiate snapshot generation and delivery.</span></span> <span data-ttu-id="18498-112">Дополнительные сведения о параметрах фильтрации см. в разделе об установке параметров секции статьи [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md) (Моментальные снимки для публикаций слиянием с параметризованными фильтрами).</span><span class="sxs-lookup"><span data-stu-id="18498-112">For more information about filtering options, see the "Setting 'partition options'" section of [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="18498-113">Использование среды SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="18498-113">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="18498-114">Моментальные снимки для секций создаются на странице **Секции данных** диалогового окна **Свойства публикации — \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="18498-114">Generate snapshots for partitions on the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="18498-115">Дополнительные сведения о доступе к этому диалоговому окну см. в разделе [Просмотр и изменение свойств публикации](publish/view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="18498-115">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span> <span data-ttu-id="18498-116">Подписчикам можно разрешить инициировать создание и доставку или только создание моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="18498-116">You can allow Subscribers to initiate snapshot generation and delivery and/or generate snapshots.</span></span>  
  
 <span data-ttu-id="18498-117">Перед созданием моментальных снимков для одной или нескольких секций необходимо следующее.</span><span class="sxs-lookup"><span data-stu-id="18498-117">Before generating snapshots for one or more partitions, you must:</span></span>  
  
1.  <span data-ttu-id="18498-118">Создать публикацию слиянием при помощи мастера создания публикаций и указать один или несколько параметризованных фильтров строк на странице **Добавление фильтра** окна мастера.</span><span class="sxs-lookup"><span data-stu-id="18498-118">Create a merge publication with the New Publication Wizard, and specify one or more parameterized row filters on the **Add Filter** page of the wizard.</span></span> <span data-ttu-id="18498-119">Дополнительные сведения см. в статье [Определение и изменение параметризованного фильтра строк для статьи публикации слиянием](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="18498-119">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
2.  <span data-ttu-id="18498-120">Создайте моментальный снимок схемы для публикации.</span><span class="sxs-lookup"><span data-stu-id="18498-120">Generate a schema snapshot for the publication.</span></span> <span data-ttu-id="18498-121">По умолчанию создание моментального снимка схемы происходит по завершении выполнения мастера создания публикаций; создание моментального снимка схемы также возможно из среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="18498-121">By default, a schema snapshot is generated when you complete the New Publication Wizard; you can also generate a schema snapshot from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
#### <a name="to-generate-a-schema-snapshot"></a><span data-ttu-id="18498-122">Создание моментального снимка схемы</span><span class="sxs-lookup"><span data-stu-id="18498-122">To generate a schema snapshot</span></span>  
  
1.  <span data-ttu-id="18498-123">Подключитесь к издателю в среде [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], а затем раскройте узел сервера.</span><span class="sxs-lookup"><span data-stu-id="18498-123">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="18498-124">Раскройте папку **Репликация** , а затем — папку **Публикации** .</span><span class="sxs-lookup"><span data-stu-id="18498-124">Expand the **Replication** folder, and then expand the **Publications** folder.</span></span>  
  
3.  <span data-ttu-id="18498-125">Щелкните правой кнопкой мыши публикацию, для которой нужно создать моментальный снимок, а затем выберите **Просмотреть состояние агента моментальных снимков**.</span><span class="sxs-lookup"><span data-stu-id="18498-125">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="18498-126">В диалоговом окне **Просмотр состояния агента моментальных снимков — \<Publication>** нажмите кнопку **Пуск**.</span><span class="sxs-lookup"><span data-stu-id="18498-126">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
     <span data-ttu-id="18498-127">Когда агент моментальных снимков закончит создание моментального снимка, на экране появится сообщение: «[100%] Сформирован моментальный снимок 17 статей».</span><span class="sxs-lookup"><span data-stu-id="18498-127">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-allow-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="18498-128">Разрешение подписчикам запускать создание и доставку моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="18498-128">To allow Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="18498-129">На странице **Секции данных** диалогового окна **Свойства публикации — \<Publication>** выберите **Автоматически определять секцию и при необходимости создавать моментальный снимок, когда новый подписчик пытается выполнить синхронизацию**.</span><span class="sxs-lookup"><span data-stu-id="18498-129">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, select **Automatically define a partition and generate a snapshot if needed when a new Subscriber tries to synchronize**.</span></span>  
  
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
#### <a name="to-generate-and-refresh-snapshots"></a><span data-ttu-id="18498-130">Создание и обновление моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="18498-130">To generate and refresh snapshots</span></span>  
  
1.  <span data-ttu-id="18498-131">На странице **Секции данных** диалогового окна **Свойства публикации — \<Publication>** нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="18498-131">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, click **Add**.</span></span>  
  
2.  <span data-ttu-id="18498-132">Введите значение **HOST_NAME()** или значение **SUSER_SNAME()** , относящееся к секции, для которой нужно создать моментальный снимок.</span><span class="sxs-lookup"><span data-stu-id="18498-132">Enter a value for the **HOST_NAME()** and/or **SUSER_SNAME()** value associated with the partition for which you want to create a snapshot.</span></span>  
  
3.  <span data-ttu-id="18498-133">При необходимости задайте расписание обновления моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="18498-133">Optionally specify a schedule for refreshing snapshots:</span></span>  
  
    1.  <span data-ttu-id="18498-134">Установите флажок **Запланировать запуск агента моментальных снимков для этой секции в следующее время**.</span><span class="sxs-lookup"><span data-stu-id="18498-134">Select **Schedule the Snapshot Agent for this partition to run at the following time(s)**</span></span>  
  
    2.  <span data-ttu-id="18498-135">Примите используемое по умолчанию расписание обновления моментальных снимков или щелкните **Изменить** , чтобы указать другое расписание.</span><span class="sxs-lookup"><span data-stu-id="18498-135">Accept the default schedule for refreshing snapshots, or click **Change** to specify a different schedule.</span></span>  
  
4.  <span data-ttu-id="18498-136">Нажмите кнопку **OK**, чтобы вернуться в диалоговое окно **Свойства публикации — \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="18498-136">Click **OK**, which returns you to the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
5.  <span data-ttu-id="18498-137">Выберите секцию в сетке свойств, затем щелкните **Создать выбранные моментальные снимки**.</span><span class="sxs-lookup"><span data-stu-id="18498-137">Select the partition in the property grid, and then click **Generate the selected snapshots now**.</span></span>  
  
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="18498-138">Использование Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="18498-138">Using Transact-SQL</span></span>  
 <span data-ttu-id="18498-139">С помощью хранимых процедур и агента моментальных снимков можно выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="18498-139">Using stored procedures and the Snapshot Agent, you can perform the following:</span></span>  
  
-   <span data-ttu-id="18498-140">Разрешите подписчикам запрашивать создание моментального снимка и его применение при первоначальной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="18498-140">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="18498-141">Предварительное создание моментальных снимков для каждой секции.</span><span class="sxs-lookup"><span data-stu-id="18498-141">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="18498-142">создать вручную моментальный снимок для каждого подписчика.</span><span class="sxs-lookup"><span data-stu-id="18498-142">Manually generate a snapshot for each Subscriber.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="18498-143">По возможности предлагайте пользователям вводить учетные данные системы безопасности во время выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="18498-143">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="18498-144">В случае необходимости хранения учетных данных в файле скрипта этот файл следует защищать во избежание несанкционированного доступа.</span><span class="sxs-lookup"><span data-stu-id="18498-144">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="18498-145">Создание публикации, которая позволяет подписчикам инициировать формирование и доставку моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="18498-145">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="18498-146">На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergepublication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-146">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="18498-147">Укажите значения следующих параметров.</span><span class="sxs-lookup"><span data-stu-id="18498-147">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="18498-148">имя публикации в качестве значения параметра **\@publication**;</span><span class="sxs-lookup"><span data-stu-id="18498-148">The name of the publication for **\@publication**.</span></span>  
  
    -   <span data-ttu-id="18498-149">Значение `true` для \*\* \@ allow_subscriber_initiated_snapshot\*\*, которое позволяет подписчикам инициировать процесс создания моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="18498-149">A value of `true` for **\@allow_subscriber_initiated_snapshot**, which enables Subscribers to initiate the snapshot process.</span></span>  
  
    -   <span data-ttu-id="18498-150">допустимое число параллельно выполняемых процессов динамических моментальных снимков в качестве значения параметра **\@max_concurrent_dynamic_snapshots** (необязательно).</span><span class="sxs-lookup"><span data-stu-id="18498-150">(Optional) The number of dynamic snapshot processes that can run concurrently for **\@max_concurrent_dynamic_snapshots**.</span></span> <span data-ttu-id="18498-151">Если выполняется максимальное число процессов и подписчик пытается создать моментальный снимок, то процесс помещается в очередь.</span><span class="sxs-lookup"><span data-stu-id="18498-151">If the maximum number of processes is running and a Subscriber attempts to generate a snapshot, the process is placed in a queue.</span></span> <span data-ttu-id="18498-152">По умолчанию число параллельных процессов не ограничено.</span><span class="sxs-lookup"><span data-stu-id="18498-152">By default there is no limit to the number of concurrent processes.</span></span>  
  
2.  <span data-ttu-id="18498-153">На издателе выполните процедуру [sp_addpublication_snapshot (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-153">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="18498-154">Укажите имя публикации, используемое на шаге 1 для \*\* \@ публикации\*\* , и [!INCLUDE[msCoName](../../includes/msconame-md.md)] учетные данные Windows, с которыми [репликация агент моментальных снимков](agents/replication-snapshot-agent.md) проверку подлинности при соединении с издателем, необходимо также указать значение **0** для \*\* \@ publisher_security_mode\*\* и [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] сведения об имени входа для \*\* \@ publisher_login\*\* и \*\* \@ publisher_password\*\*.</span><span class="sxs-lookup"><span data-stu-id="18498-154">Specify the publication name used in step 1 for **\@publication** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="18498-155">Будет создано задание агента моментальных снимков для публикации.</span><span class="sxs-lookup"><span data-stu-id="18498-155">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="18498-156">Дополнительные сведения о формировании исходного моментального снимка и определении пользовательского расписания для агента моментальных снимков см. в разделе [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="18498-156">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="18498-157">Если издатель настраивается с удаленным распространителем, то значения, передаваемые для всех аргументов, включая *job_login* и *job_password*, передаются распространителю в формате обычного (незашифрованного) текста.</span><span class="sxs-lookup"><span data-stu-id="18498-157">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="18498-158">Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="18498-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="18498-159">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="18498-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="18498-160">Выполните хранимую процедуру [sp_addmergearticle (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), чтобы добавить статьи в публикацию.</span><span class="sxs-lookup"><span data-stu-id="18498-160">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="18498-161">Эту хранимую процедуру необходимо выполнить один раз для каждой статьи в публикации.</span><span class="sxs-lookup"><span data-stu-id="18498-161">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="18498-162">При использовании параметризованных фильтров необходимо указать параметризованный фильтр строк для одной или нескольких статей в параметре **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="18498-162">When using parameterized filters, you must specify a parameterized row filter for one or more articles using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="18498-163">Дополнительные сведения см. в статье [Определение и изменение параметризованного фильтра строк для статьи публикации слиянием](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="18498-163">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="18498-164">Если другие статьи будут фильтроваться на основании параметризованного фильтра строк, выполните хранимую процедуру [sp_addmergefilter (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql), чтобы определить между статьями соединение или связь логических записей.</span><span class="sxs-lookup"><span data-stu-id="18498-164">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="18498-165">Эту хранимую процедуру необходимо выполнить один раз для каждой определяемой связи.</span><span class="sxs-lookup"><span data-stu-id="18498-165">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="18498-166">Дополнительные сведения см. в статье [Определение и изменение фильтра соединения между статьями публикации слиянием](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="18498-166">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="18498-167">Если агент слияния запрашивает инициализацию подписчика моментальным снимком, то автоматически создается моментальный снимок для секции запрашивающей подписки.</span><span class="sxs-lookup"><span data-stu-id="18498-167">When the Merge Agent requests the snapshot to initialize the Subscriber, the snapshot for the requesting subscription's partition is automatically generated.</span></span>  
  
#### <a name="to-create-a-publication-and-pre-generate-or-automatically-refresh-snapshots"></a><span data-ttu-id="18498-168">Создание публикации и предварительное создание или автоматическое обновление моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="18498-168">To create a publication and pre-generate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="18498-169">Чтобы создать публикацию, выполните хранимую процедуру [sp_addmergepublication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-169">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="18498-170">Дополнительные сведения см. в разделе [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="18498-170">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="18498-171">На издателе выполните процедуру [sp_addpublication_snapshot (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-171">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="18498-172">Укажите имя публикации, использовавшееся в шаге 1, в параметре **\@publication**, а учетные данные Windows, с которыми работает агент моментальных снимков, — в параметрах **\@job_login** и **\@password**.</span><span class="sxs-lookup"><span data-stu-id="18498-172">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="18498-173">Если агент при соединении с издателем будет использовать проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], то необходимо также присвоить значение **0** параметру **\@publisher_security_mode** и передать сведения об имени входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в качестве значений параметров **\@publisher_login** и **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="18498-173">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="18498-174">Будет создано задание агента моментальных снимков для публикации.</span><span class="sxs-lookup"><span data-stu-id="18498-174">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="18498-175">Дополнительные сведения о формировании исходного моментального снимка и определении пользовательского расписания для агента моментальных снимков см. в разделе [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="18498-175">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="18498-176">Если издатель настраивается с удаленным распространителем, то значения, передаваемые для всех аргументов, включая *job_login* и *job_password*, передаются распространителю в формате обычного (незашифрованного) текста.</span><span class="sxs-lookup"><span data-stu-id="18498-176">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="18498-177">Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="18498-177">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="18498-178">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="18498-178">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="18498-179">Выполните хранимую процедуру [sp_addmergearticle (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), чтобы добавить статьи в публикацию.</span><span class="sxs-lookup"><span data-stu-id="18498-179">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="18498-180">Эту хранимую процедуру необходимо выполнить один раз для каждой статьи в публикации.</span><span class="sxs-lookup"><span data-stu-id="18498-180">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="18498-181">При использовании параметризованных фильтров необходимо указать параметризованный фильтр строк для одной статьи в параметре **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="18498-181">When using parameterized filters, you must specify a parameterized row filter for one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="18498-182">Дополнительные сведения см. в статье [Определение и изменение параметризованного фильтра строк для статьи публикации слиянием](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="18498-182">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="18498-183">Если другие статьи будут фильтроваться на основании параметризованного фильтра строк, выполните хранимую процедуру [sp_addmergefilter (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql), чтобы определить между статьями соединение или связь логических записей.</span><span class="sxs-lookup"><span data-stu-id="18498-183">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="18498-184">Эту хранимую процедуру необходимо выполнить один раз для каждой определяемой связи.</span><span class="sxs-lookup"><span data-stu-id="18498-184">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="18498-185">Дополнительные сведения см. в статье [Определение и изменение фильтра соединения между статьями публикации слиянием](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="18498-185">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="18498-186">В издателе в базе данных публикации выполните хранимую процедуру [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), указав в параметре **\@publication** значение из шага 1.</span><span class="sxs-lookup"><span data-stu-id="18498-186">At the Publisher on the publication database, execute [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specifying the value of **\@publication** from step 1.</span></span> <span data-ttu-id="18498-187">Запомните значение параметра **snapshot_jobid** в результирующем наборе.</span><span class="sxs-lookup"><span data-stu-id="18498-187">Note the value of the **snapshot_jobid** in the result set.</span></span>  
  
6.  <span data-ttu-id="18498-188">Преобразуйте значение параметра **snapshot_jobid** , полученное в шаге 5, в тип **uniqueidentifier**.</span><span class="sxs-lookup"><span data-stu-id="18498-188">Convert the value of the **snapshot_jobid** obtained in step 5 to **uniqueidentifier**.</span></span>  
  
7.  <span data-ttu-id="18498-189">В издателе в базе данных **msdb** выполните хранимую процедуру [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), указав преобразованное значение, полученное в шаге 6, в параметре **\@job_id**.</span><span class="sxs-lookup"><span data-stu-id="18498-189">At the Publisher on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the converted value obtained in step 6 for **\@job_id**.</span></span>  
  
8.  <span data-ttu-id="18498-190">На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergepartition (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-190">At the Publisher on the publication database, execute [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span></span> <span data-ttu-id="18498-191">Укажите имя публикации из шага 1 в качестве значения параметра **\@publication**, а также значение, определяющее секцию, в качестве значения параметра **\@suser_sname**, если в предложении фильтра используется функция [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), либо параметра **\@host_name**, если в предложении фильтра используется функция [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-191">Specify the name of the publication from step 1 for **\@publication** and the value used to define the partition for **\@suser_sname** if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used in the filter clause or for **\@host_name** if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used in the filter clause.</span></span>  
  
9. <span data-ttu-id="18498-192">На издателе в базе данных публикации выполните хранимую процедуру [sp_adddynamicsnapshot_job (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-192">At the publisher on the publication database, execute [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span></span> <span data-ttu-id="18498-193">Укажите имя публикации из шага 1 в качестве значения параметра **\@publication**, значение параметра **\@suser_sname** или **\@host_name** из шага 8, а также расписание для этого задания.</span><span class="sxs-lookup"><span data-stu-id="18498-193">Specify the name of the publication from step 1 for **\@publication**, the value of **\@suser_sname** or **\@host_name** from step 8, and a schedule for the job.</span></span> <span data-ttu-id="18498-194">Будет создано задание, создающее параметризованный моментальный снимок для указанной секции.</span><span class="sxs-lookup"><span data-stu-id="18498-194">This creates the job that generates the parameterized snapshot for the specified partition.</span></span> <span data-ttu-id="18498-195">Дополнительные сведения см. в статье [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="18498-195">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="18498-196">Это задание выполняется в той же учетной записи Windows, что и задание исходного моментального снимка в шаге 2.</span><span class="sxs-lookup"><span data-stu-id="18498-196">This job runs using the same Windows account as the initial snapshot job defined in step 2.</span></span> <span data-ttu-id="18498-197">Чтобы удалить задание параметризованного моментального снимка и связанную с ним секцию данных, выполните хранимую процедуру [sp_dropdynamicsnapshot_job (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-197">To remove the parameterized snapshot job and its related data partition, execute [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span></span>  
  
10. <span data-ttu-id="18498-198">В издателе в базе данных публикации выполните хранимую процедуру [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql), указав значение параметра **\@publication** из шага 1 и значение параметра **\@suser_sname** или **\@host_name** из шага 8.</span><span class="sxs-lookup"><span data-stu-id="18498-198">At the Publisher on the publication database, execute [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql), specifying the value of **\@publication** from step 1 and the value of **\@suser_sname** or **\@host_name** from step 8.</span></span> <span data-ttu-id="18498-199">Запомните значение параметра **dynamic_snapshot_jobid** в результирующем наборе.</span><span class="sxs-lookup"><span data-stu-id="18498-199">Note the value of the **dynamic_snapshot_jobid** in the result set.</span></span>  
  
11. <span data-ttu-id="18498-200">В распространителе в базе данных **msdb** выполните хранимую процедуру [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), присвоив значение, полученное в шаге 9, параметру **\@job_id**.</span><span class="sxs-lookup"><span data-stu-id="18498-200">At the Distributor on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the value obtained in step 9 for **\@job_id**.</span></span> <span data-ttu-id="18498-201">Будет запущено задание параметризованного моментального снимка для данной секции.</span><span class="sxs-lookup"><span data-stu-id="18498-201">This starts the parameterized snapshot job for the partition.</span></span>  
  
12. <span data-ttu-id="18498-202">Чтобы создать секционированный снимок для каждой подписки, повторите шаги 8–11.</span><span class="sxs-lookup"><span data-stu-id="18498-202">Repeat steps 8-11 to generate a partitioned snapshot for each subscription.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="18498-203">Создание публикации и моментальных снимков для каждой секции вручную</span><span class="sxs-lookup"><span data-stu-id="18498-203">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="18498-204">Чтобы создать публикацию, выполните хранимую процедуру [sp_addmergepublication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-204">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="18498-205">Дополнительные сведения см. в разделе [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="18498-205">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="18498-206">На издателе выполните процедуру [sp_addpublication_snapshot (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-206">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="18498-207">Укажите имя публикации, использовавшееся в шаге 1, в параметре **\@publication**, а учетные данные Windows, с которыми работает агент моментальных снимков, — в параметрах **\@job_login** и **\@password**.</span><span class="sxs-lookup"><span data-stu-id="18498-207">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="18498-208">Если агент при соединении с издателем будет использовать проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], то необходимо также присвоить значение **0** параметру **\@publisher_security_mode** и передать сведения об имени входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в качестве значений параметров **\@publisher_login** и **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="18498-208">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="18498-209">Будет создано задание агента моментальных снимков для публикации.</span><span class="sxs-lookup"><span data-stu-id="18498-209">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="18498-210">Дополнительные сведения о формировании исходного моментального снимка и определении пользовательского расписания для агента моментальных снимков см. в разделе [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="18498-210">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="18498-211">Если издатель настраивается с удаленным распространителем, то значения, передаваемые для всех аргументов, включая *job_login* и *job_password*, передаются распространителю в формате обычного (незашифрованного) текста.</span><span class="sxs-lookup"><span data-stu-id="18498-211">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="18498-212">Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="18498-212">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="18498-213">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="18498-213">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="18498-214">Выполните хранимую процедуру [sp_addmergearticle (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), чтобы добавить статьи в публикацию.</span><span class="sxs-lookup"><span data-stu-id="18498-214">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="18498-215">Эту хранимую процедуру необходимо выполнить один раз для каждой статьи в публикации.</span><span class="sxs-lookup"><span data-stu-id="18498-215">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="18498-216">При использовании параметризованных фильтров необходимо указать параметризованный фильтр строк хотя бы для одной статьи в параметре **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="18498-216">When using parameterized filters, you must specify a parameterized row filter for at least one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="18498-217">Дополнительные сведения см. в статье [Определение и изменение параметризованного фильтра строк для статьи публикации слиянием](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="18498-217">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="18498-218">Если другие статьи будут фильтроваться на основании параметризованного фильтра строк, выполните хранимую процедуру [sp_addmergefilter (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql), чтобы определить между статьями соединение или связь логических записей.</span><span class="sxs-lookup"><span data-stu-id="18498-218">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="18498-219">Эту хранимую процедуру необходимо выполнить один раз для каждой определяемой связи.</span><span class="sxs-lookup"><span data-stu-id="18498-219">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="18498-220">Дополнительные сведения см. в статье [Определение и изменение фильтра соединения между статьями публикации слиянием](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="18498-220">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="18498-221">Чтобы создать стандартную схему моментального снимка и другие файлы, запустите задание моментального снимка или агент моментальных снимков репликации из командной строки.</span><span class="sxs-lookup"><span data-stu-id="18498-221">Start the snapshot job or run the Replication Snapshot Agent from the command prompt to generate the standard snapshot schema and other files.</span></span> <span data-ttu-id="18498-222">Дополнительные сведения см. в разделе [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="18498-222">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
6.  <span data-ttu-id="18498-223">Запустите агент моментальных снимков репликации из командной строки еще раз, чтобы создать файлы массового копирования (BCP-файл); при этом укажите расположение секционированного снимка в качестве значения параметра **-DynamicSnapshotLocation** , а также одно или оба приведенные ниже свойства, определяющие секцию:</span><span class="sxs-lookup"><span data-stu-id="18498-223">Run the Replication Snapshot Agent again from the command prompt to generate bulk copy (.bcp) files, specifying the location of the partitioned snapshot for **-DynamicSnapshotLocation** and one or both of the following properties that defines the partition:</span></span>  
  
    -   <span data-ttu-id="18498-224">**-DynamicFilterHostName** — если используется функция [HOST_NAME (Transact-SQL)](/sql/t-sql/functions/host-name-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-224">**-DynamicFilterHostName** - the value if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used.</span></span>  
  
    -   <span data-ttu-id="18498-225">**-DynamicFilterLogin** — если используется функция [SUSER_SNAME (Transact-SQL)](/sql/t-sql/functions/suser-sname-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="18498-225">**-DynamicFilterLogin** - the value if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used.</span></span>  
  
7.  <span data-ttu-id="18498-226">Чтобы создать секционированный снимок для каждой подписки, повторите шаг 6.</span><span class="sxs-lookup"><span data-stu-id="18498-226">Repeat step 6 to generate a partitioned snapshot for each subscription.</span></span>  
  
8.  <span data-ttu-id="18498-227">Чтобы применить исходный секционированный снимок на подписчиках, запустите агент слияния для каждой подписки; при этом укажите следующие свойства:</span><span class="sxs-lookup"><span data-stu-id="18498-227">Run the Merge Agent for each subscription to apply the initial partitioned snapshot at the Subscribers, specifying the following properties:</span></span>  
  
    -   <span data-ttu-id="18498-228">**-Hostname** — значение, с помощью которого определяется секция, если реальное значение параметра HOST_NAME переопределяется;</span><span class="sxs-lookup"><span data-stu-id="18498-228">**-Hostname** - the value used to define the partition if the actual value of HOST_NAME is being overridden.</span></span>  
  
    -   <span data-ttu-id="18498-229">**-DynamicSnapshotLocation** — расположение динамического моментального снимка для этой секции.</span><span class="sxs-lookup"><span data-stu-id="18498-229">**-DynamicSnapshotLocation** - the location of the dynamic snapshot for this partition.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="18498-230">Дополнительные сведения о программировании агентов репликации см. в статье [Основные понятия исполняемых файлов агента репликации](concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="18498-230">For more information about programming replication agents, see [Replication Agent Executables Concepts](concepts/replication-agent-executables-concepts.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="18498-231">Примеры (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="18498-231">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="18498-232">В этом примере создается публикация слиянием с параметризованными фильтрами, где подписчики запускают процесс создания моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="18498-232">This example creates a merge publication with parameterized filters where Subscribers initiate the snapshot generation process.</span></span> <span data-ttu-id="18498-233">Значения для параметров **\@job_login** и **\@job_password** передаются с использованием переменных скрипта.</span><span class="sxs-lookup"><span data-stu-id="18498-233">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic1.sql#sp_mergedynamicpub1)]  
  
 <span data-ttu-id="18498-234">В этом примере публикация создается с помощью параметризованного фильтра, где для каждого подписчика с помощью хранимой процедуры [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) определена своя секция, а также путем выполнения хранимой процедуры [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) , передающей сведения о секционировании, создано фильтруемое задание моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="18498-234">This example creates a publication using a parameterized filter where each Subscriber has its partition defined by executing [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) and the filtered snapshot job created by executing [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) passing the partitioning information.</span></span> <span data-ttu-id="18498-235">Значения для параметров **\@job_login** и **\@job_password** передаются с использованием переменных скрипта.</span><span class="sxs-lookup"><span data-stu-id="18498-235">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPlusPartition](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic2.sql#sp_mergedynamicpubpluspartition)]  
  
 <span data-ttu-id="18498-236">В этом примере публикация создается с помощью параметризованного фильтра, где путем передачи сведений о секционировании для подписчика должна создаваться своя секция данных и фильтруемое задание моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="18498-236">This example creates a publication using a parameterized filter where each Subscriber must have its data partition and filtered snapshot job created by supplying the partitioning information.</span></span> <span data-ttu-id="18498-237">Подписчик передает сведения о секционировании с помощью параметров командной строки, если агенты репликации запускаются вручную.</span><span class="sxs-lookup"><span data-stu-id="18498-237">A Subscriber supplies partitioning information using command-line parameters when manually running the replication agents.</span></span> <span data-ttu-id="18498-238">В этом примере предполагается, что также уже создана подписка на публикацию.</span><span class="sxs-lookup"><span data-stu-id="18498-238">This example assumes that a subscription to the publication has also been created.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPartitionManual](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic3.sql#sp_mergedynamicpubpartitionmanual)]  
  
 
```
REM Line breaks are added to improve readability.   
REM In a batch file, commands must be made in a single line.  
REM Run the Snapshot agent from the command line to generate the standard snapshot   
REM schema and other files.   
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub% -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  
  
PAUSE  
```

```
REM Run the Snapshot agent from the command line, this time to generate   
REM the bulk copy (.bcp) data for each Subscriber partition.    
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
MD %SnapshotDir%  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub%  -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  -DynamicFilterHostName "adventure-works\Fernando"    
-DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE  
```

```
REM Run the Merge Agent for each subscription to apply the partitioned   
REM snapshot for each Subscriber.    
SET Publisher = %computername%  
SET Subscriber = %computername%  
SET PubDB = AdventureWorks2012   
SET SubDB = AdventureWorks2012Replica   
SET PubName = AdvWorksSalesPersonMerge   
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
"C:\Program Files\Microsoft SQL Server\120\COM\REPLMERG.EXE" -Publisher  %Publisher%    
-Subscriber  %Subscriber%  -Distributor %Publisher%  -PublisherDB %PubDB%    
-SubscriberDB %SubDB% -Publication %PubName%  -PublisherSecurityMode 1  -OutputVerboseLevel 3    
-Output -SubscriberSecurityMode 1  -SubscriptionType 3 -DistributorSecurityMode 1    
-Hostname "adventure-works\Fernando"  -DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE
```
  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="18498-239">При помощи объектов RMO</span><span class="sxs-lookup"><span data-stu-id="18498-239">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="18498-240">Для программного создания секционированных снимков можно использовать объекты RMO следующими способами.</span><span class="sxs-lookup"><span data-stu-id="18498-240">You can use Replication Management Objects (RMO) to generate partitioned snapshots programmatically in the following ways:</span></span>  
  
-   <span data-ttu-id="18498-241">Разрешите подписчикам запрашивать создание моментального снимка и его применение при первоначальной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="18498-241">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="18498-242">Предварительное создание моментальных снимков для каждой секции.</span><span class="sxs-lookup"><span data-stu-id="18498-242">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="18498-243">Создайте моментальный снимок вручную для каждого подписчика при помощи агента моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="18498-243">Manually generate a snapshot for each Subscriber by running the Snapshot Agent.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="18498-244">Если фильтрация статьи приводит к образованию неперекрывающихся секций, уникальных для каждой подписки (если указано значение <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> для <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> при создании статьи публикации слиянием), метаданные очищаются при запуске агента слияния.</span><span class="sxs-lookup"><span data-stu-id="18498-244">When filtering for an article yields non-overlapping partitions that are unique for each subscription (by specifying a value of <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> for <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> when creating a merge article), metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="18498-245">Это означает, что срок действия секционированного снимка истекает быстрее.</span><span class="sxs-lookup"><span data-stu-id="18498-245">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="18498-246">Если выбран этот режим, рекомендуется рассмотреть возможность разрешения подписчикам создания моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="18498-246">When you use this option, you should consider allowing Subscribers to request snapshot generation.</span></span> <span data-ttu-id="18498-247">Дополнительные сведения см. в подразделе «Использование соответствующих параметров фильтрации» раздела [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="18498-247">For more information, see the section Using the Appropriate Filtering Options in the topic [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="18498-248">По возможности предлагайте пользователям вводить учетные данные системы безопасности во время выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="18498-248">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="18498-249">Если необходимо хранить учетные данные, используйте [службы шифрования](https://go.microsoft.com/fwlink/?LinkId=34733) , предоставляемые платформой [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="18498-249">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="18498-250">Создание публикации, которая позволяет подписчикам инициировать формирование и доставку моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="18498-250">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="18498-251">Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="18498-251">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="18498-252">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> для базы данных публикации, установите в качестве значения свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> экземпляр соединения <xref:Microsoft.SqlServer.Management.Common.ServerConnection> , созданный на шаге 1, и вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="18498-252">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="18498-253">Если <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> возвращает значение `false`, убедитесь, что база данных существует.</span><span class="sxs-lookup"><span data-stu-id="18498-253">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, confirm that the database exists.</span></span>  
  
3.  <span data-ttu-id="18498-254">Если свойству <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> присвоено значение `false`, укажите значение `true` и вызовите <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-254">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> property is `false`, set it to `true` and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="18498-255">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePublication> и укажите для него следующие свойства:</span><span class="sxs-lookup"><span data-stu-id="18498-255">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="18498-256">Соединение <xref:Microsoft.SqlServer.Management.Common.ServerConnection> , созданное на шаге 1, в качестве значения свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-256">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="18498-257">имя опубликованной базы данных в свойстве <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>;</span><span class="sxs-lookup"><span data-stu-id="18498-257">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="18498-258">имя публикации в качестве значения свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>;</span><span class="sxs-lookup"><span data-stu-id="18498-258">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="18498-259">Максимальное количество заданий динамических моментальных снимков, которые должны быть выполнены <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-259">The maximum number of dynamic snapshot jobs to run for <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span></span> <span data-ttu-id="18498-260">Поскольку инициированные подписчиком запросы на моментальные снимки могут возникнуть в любое время, это свойство ограничивает количество заданий агента моментальных снимков, которые могут выполняться одновременно, когда несколько подписчиков запрашивают секционированные снимки в одно и то же время.</span><span class="sxs-lookup"><span data-stu-id="18498-260">Because Subscriber initiated snapshot requests can occur at any time, this property limits the number of Snapshot Agent jobs that can run simultaneously when multiple Subscribers request their partitioned snapshot at the same time.</span></span> <span data-ttu-id="18498-261">Если выполняется максимальное количество заданий, дополнительные запросы на секционированные моментальные снимки помещаются в очередь, пока одно из выполняющихся заданий не будет завершено.</span><span class="sxs-lookup"><span data-stu-id="18498-261">When the maximum number of jobs are running, additional partitioned snapshot requests are queued until one of the running jobs is completed.</span></span>  
  
    -   <span data-ttu-id="18498-262">Используйте оператор побитового логического ИЛИ (`|` в Visual C# и `Or` в Visual Basic), чтобы добавить значение <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> в <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-262">Use the bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) operator to add the value <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> to <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span></span>  
  
    -   <span data-ttu-id="18498-263">Поля <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> и <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> свойства <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> содержат учетные данные учетной записи [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows, от имени которой выполняются задания агента моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="18498-263">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Snapshot Agent job runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="18498-264">Рекомендуется указывать свойство <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, если публикация создается членом предопределенной роли сервера `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="18498-264">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is recommended when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="18498-265">Дополнительные сведения см. в статье [Модель безопасности агента репликации](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="18498-265">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
5.  <span data-ttu-id="18498-266">Чтобы создать публикацию, вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="18498-266">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="18498-267">При настройке издателя с удаленным распространителем значения, передаваемые для всех свойств, включая <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, отправляются распространителю в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="18498-267">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="18498-268">Перед вызовом метода <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> следует зашифровать подключение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="18498-268">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="18498-269">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="18498-269">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="18498-270">Чтобы добавить статьи к публикации, используйте свойство <xref:Microsoft.SqlServer.Replication.MergeArticle> .</span><span class="sxs-lookup"><span data-stu-id="18498-270">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="18498-271">Укажите свойство <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> хотя бы для одной статьи, определяющей параметризованный фильтр.</span><span class="sxs-lookup"><span data-stu-id="18498-271">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter.</span></span> <span data-ttu-id="18498-272">(Необязательно) Создайте объекты <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> , определяющие фильтры соединения между статьями.</span><span class="sxs-lookup"><span data-stu-id="18498-272">(Optional) Create <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="18498-273">Дополнительные сведения см. в статье [определить статью](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="18498-273">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
7.  <span data-ttu-id="18498-274">Если для свойства <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> указано значение `false`, вызовите <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A>, чтобы создать исходное задание агента моментального снимка для этой публикации.</span><span class="sxs-lookup"><span data-stu-id="18498-274">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the initial Snapshot Agent job for this publication.</span></span>  
  
8.  <span data-ttu-id="18498-275">Вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> объекта <xref:Microsoft.SqlServer.Replication.MergePublication> , созданного на шаге 4.</span><span class="sxs-lookup"><span data-stu-id="18498-275">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 4.</span></span> <span data-ttu-id="18498-276">Запустится задание агента по созданию исходного моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="18498-276">This starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="18498-277">Дополнительные сведения о формировании исходного моментального снимка и определении пользовательского расписания для агента моментальных снимков см. в разделе [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="18498-277">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
9. <span data-ttu-id="18498-278">(Необязательно) Проверьте, указано ли значение `true` для свойства <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A>, чтобы определить, когда исходный моментальный снимок будет готов к использованию.</span><span class="sxs-lookup"><span data-stu-id="18498-278">(Optional) Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
10. <span data-ttu-id="18498-279">Когда агент слияния для подписчика подключается в первый раз, секционированный моментальный снимок создается автоматически.</span><span class="sxs-lookup"><span data-stu-id="18498-279">When the Merge Agent for a Subscriber connects for the first time, a partitioned snapshot is generated automatically.</span></span>  
  
#### <a name="to-create-a-publication-and-pregenerate-or-automatically-refresh-snapshots"></a><span data-ttu-id="18498-280">Создание публикации и предварительное создание или автоматическое обновление моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="18498-280">To create a publication and pregenerate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="18498-281">Чтобы определить публикацию слиянием, используйте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePublication> .</span><span class="sxs-lookup"><span data-stu-id="18498-281">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="18498-282">Дополнительные сведения см. в разделе [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="18498-282">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="18498-283">Чтобы добавить статьи к публикации, используйте свойство <xref:Microsoft.SqlServer.Replication.MergeArticle> .</span><span class="sxs-lookup"><span data-stu-id="18498-283">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="18498-284">Укажите свойство <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> хотя бы для одной статьи, определяющей параметризованный фильтр, и создайте любые объекты <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> , определяющие фильтры соединения между статьями.</span><span class="sxs-lookup"><span data-stu-id="18498-284">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="18498-285">Дополнительные сведения см. в статье [определить статью](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="18498-285">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="18498-286">Если значение <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> равно `false`, то для создания задания агента моментальных снимков для этой публикации вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-286">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
4.  <span data-ttu-id="18498-287">Вызовите метод <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> объекта <xref:Microsoft.SqlServer.Replication.MergePublication> , созданного в шаге 1.</span><span class="sxs-lookup"><span data-stu-id="18498-287">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 1.</span></span> <span data-ttu-id="18498-288">Этот метод запускает задание агента по созданию исходного моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="18498-288">This method starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="18498-289">Дополнительные сведения о создании исходного моментального снимка и определении пользовательского расписания для агента моментальных снимков см. в разделе [Создание и применение исходного моментального снимка](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="18498-289">For more information on generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
5.  <span data-ttu-id="18498-290">Проверьте, указано ли значение `true` для свойства <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A>, чтобы определить, когда исходный моментальный снимок будет готов к использованию.</span><span class="sxs-lookup"><span data-stu-id="18498-290">Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
6.  <span data-ttu-id="18498-291">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePartition> и укажите критерии параметризованного фильтра для подписчика, используя одно или оба следующих свойства.</span><span class="sxs-lookup"><span data-stu-id="18498-291">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePartition> class, and set the parameterized filtering criteria for the Subscriber by using one or both of the following properties:</span></span>  
  
    -   <span data-ttu-id="18498-292">Если секция подписчика определена результатом функции [SUSER_SNAME (Transact-SQL)](/sql/t-sql/functions/suser-sname-transact-sql), используйте <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-292">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="18498-293">Если секция подписчика определена результатом функции [HOST_NAME (Transact-SQL)](/sql/t-sql/functions/host-name-transact-sql) или перегружающей ее функции, используйте <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-293">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="18498-294">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> и укажите то же свойство, что и в шаге 6.</span><span class="sxs-lookup"><span data-stu-id="18498-294">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> class, and set the same property as in step 6.</span></span>  
  
8.  <span data-ttu-id="18498-295">Используйте класс <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> , чтобы определить расписание создания фильтрованных моментальных снимков для секции подписчика.</span><span class="sxs-lookup"><span data-stu-id="18498-295">Use the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> class to define a schedule for generating the filtered snapshot for the Subscriber partition.</span></span>  
  
9. <span data-ttu-id="18498-296">Используя экземпляр <xref:Microsoft.SqlServer.Replication.MergePublication> из шага 1, вызовите метод <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-296">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span></span> <span data-ttu-id="18498-297">Передайте объект <xref:Microsoft.SqlServer.Replication.MergePartition> , созданный на шаге 6.</span><span class="sxs-lookup"><span data-stu-id="18498-297">Pass the <xref:Microsoft.SqlServer.Replication.MergePartition> object from step 6.</span></span>  
  
10. <span data-ttu-id="18498-298">Используя экземпляр <xref:Microsoft.SqlServer.Replication.MergePublication> из шага 1, вызовите метод <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> .</span><span class="sxs-lookup"><span data-stu-id="18498-298">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call the <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> method.</span></span> <span data-ttu-id="18498-299">Передайте объект <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> из шага 7 и объект <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> из шага 8.</span><span class="sxs-lookup"><span data-stu-id="18498-299">Pass the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object from step 7 and the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> object from step 8.</span></span>  
  
11. <span data-ttu-id="18498-300">Вызовите метод <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>и найдите объект <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> для вновь добавленного задания секционированного моментального снимка в возвращенном массиве.</span><span class="sxs-lookup"><span data-stu-id="18498-300">Call <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>, and locate the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object for the newly added partitioned snapshot job in the returned array.</span></span>  
  
12. <span data-ttu-id="18498-301">Получите свойство <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> для этого задания.</span><span class="sxs-lookup"><span data-stu-id="18498-301">Get the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> property for the job.</span></span>  
  
13. <span data-ttu-id="18498-302">Создайте соединение с распространителем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="18498-302">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
14. <span data-ttu-id="18498-303">Создайте экземпляр класса <xref:Microsoft.SqlServer.Management.Smo.Server> управляющих объектов SQL Server, передав объект <xref:Microsoft.SqlServer.Management.Common.ServerConnection> из шага 13.</span><span class="sxs-lookup"><span data-stu-id="18498-303">Create an instance of the SQL Server Management Objects (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> class, passing the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> object from step 13.</span></span>  
  
15. <span data-ttu-id="18498-304">Создайте экземпляр класса <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> , передав свойство <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> объекта <xref:Microsoft.SqlServer.Management.Smo.Server> из шага 14 и имя задания из шага 12.</span><span class="sxs-lookup"><span data-stu-id="18498-304">Create an instance of the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> class, passing the <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> property of the <xref:Microsoft.SqlServer.Management.Smo.Server> object from step 14 and the job name from step 12.</span></span>  
  
16. <span data-ttu-id="18498-305">Вызовите метод <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> , чтобы запустить задание секционированного моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="18498-305">Call the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> method to start the partitioned snapshot job.</span></span>  
  
17. <span data-ttu-id="18498-306">Повторите шаги 6 — 16 для каждого подписчика.</span><span class="sxs-lookup"><span data-stu-id="18498-306">Repeat steps 6-16 for each Subscriber.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="18498-307">Создание публикации и моментальных снимков для каждой секции вручную</span><span class="sxs-lookup"><span data-stu-id="18498-307">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="18498-308">Чтобы определить публикацию слиянием, используйте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePublication> .</span><span class="sxs-lookup"><span data-stu-id="18498-308">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="18498-309">Дополнительные сведения см. в разделе [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="18498-309">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="18498-310">Чтобы добавить статьи в публикацию, используйте свойство <xref:Microsoft.SqlServer.Replication.MergeArticle> . Укажите свойство <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> хотя бы для одной статьи, определяющей параметризованный фильтр, и создайте любые объекты <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> , определяющие фильтры соединения между статьями.</span><span class="sxs-lookup"><span data-stu-id="18498-310">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="18498-311">Дополнительные сведения см. в статье [определить статью](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="18498-311">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="18498-312">Создайте исходный моментальный снимок.</span><span class="sxs-lookup"><span data-stu-id="18498-312">Generate the initial snapshot.</span></span> <span data-ttu-id="18498-313">Дополнительные сведения см. в разделе [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="18498-313">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
4.  <span data-ttu-id="18498-314">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> и укажите следующие необходимые свойства.</span><span class="sxs-lookup"><span data-stu-id="18498-314">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="18498-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> — имя издателя.</span><span class="sxs-lookup"><span data-stu-id="18498-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="18498-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> — имя базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="18498-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="18498-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> — имя публикации.</span><span class="sxs-lookup"><span data-stu-id="18498-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="18498-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> — имя распространителя.</span><span class="sxs-lookup"><span data-stu-id="18498-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="18498-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> — значение <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> для использования встроенной проверки подлинности Windows или значение <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> для использования проверки подлинности SQL Server.</span><span class="sxs-lookup"><span data-stu-id="18498-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
    -   <span data-ttu-id="18498-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> — значение <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> для использования встроенной проверки подлинности Windows или значение <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> для использования проверки подлинности SQL Server.</span><span class="sxs-lookup"><span data-stu-id="18498-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
5.  <span data-ttu-id="18498-321">Укажите значение <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> в параметре <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-321">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
6.  <span data-ttu-id="18498-322">Задайте одно или несколько следующих свойств, чтобы определить параметры секционирования.</span><span class="sxs-lookup"><span data-stu-id="18498-322">Set one or more of the following properties to define the partitioning parameters:</span></span>  
  
    -   <span data-ttu-id="18498-323">Если секция подписчика определена результатом функции [SUSER_SNAME (Transact-SQL)](/sql/t-sql/functions/suser-sname-transact-sql), используйте <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-323">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="18498-324">Если секция подписчика определена результатом функции [HOST_NAME (Transact-SQL)](/sql/t-sql/functions/host-name-transact-sql) или перегружающей ее функции, используйте <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span><span class="sxs-lookup"><span data-stu-id="18498-324">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="18498-325">Вызовите метод <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> .</span><span class="sxs-lookup"><span data-stu-id="18498-325">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
8.  <span data-ttu-id="18498-326">Повторите шаги 4–7 для каждого подписчика.</span><span class="sxs-lookup"><span data-stu-id="18498-326">Repeat steps 4-7 for each Subscriber.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="18498-327">Примеры (объекты RMO)</span><span class="sxs-lookup"><span data-stu-id="18498-327">Examples (RMO)</span></span>  
 <span data-ttu-id="18498-328">В этом примере создается публикация слиянием, позволяющая подписчикам запрашивать создание моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="18498-328">This example creates a merge publication that allows Subscribers to requested snapshot generation.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
 <span data-ttu-id="18498-329">В этом примере вручную создается секция подписчика и фильтрованный моментальный снимок для публикации слиянием с параметризованными фильтрами строк.</span><span class="sxs-lookup"><span data-stu-id="18498-329">This example manually creates the Subscriber partition and the filtered snapshot for a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePartition](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepartition)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePartition](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepartition)]  
  
 <span data-ttu-id="18498-330">В этом примере вручную запускается агент моментальных снимков для создания фильтрованного моментального снимка данных для подписчика на публикацию слиянием с параметризованными фильтрами строк.</span><span class="sxs-lookup"><span data-stu-id="18498-330">This example manually starts the Snapshot Agent to generate the filtered data snapshot for a Subscriber to a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateFilteredSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatefilteredsnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateFilteredSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatefilteredsnapshot)]  
  
## <a name="see-also"></a><span data-ttu-id="18498-331">См. также:</span><span class="sxs-lookup"><span data-stu-id="18498-331">See Also</span></span>  
 <span data-ttu-id="18498-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span><span class="sxs-lookup"><span data-stu-id="18498-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span></span>  
 <span data-ttu-id="18498-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="18498-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="18498-334">[Моментальные снимки для публикаций слиянием с параметризованными фильтрами](snapshots-for-merge-publications-with-parameterized-filters.md) </span><span class="sxs-lookup"><span data-stu-id="18498-334">[Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md) </span></span>  
 [<span data-ttu-id="18498-335">Рекомендации по защите репликации</span><span class="sxs-lookup"><span data-stu-id="18498-335">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
