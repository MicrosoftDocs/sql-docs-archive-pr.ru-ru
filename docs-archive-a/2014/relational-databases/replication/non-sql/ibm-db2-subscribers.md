---
title: Подписчики IBM DB2 | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- non-SQL Server Subscribers, IBM DB2
- data types [SQL Server replication], non-SQL Server Subscribers
- IBM DB2 Subscribers
- mapping data types [SQL Server replication]
- heterogeneous Subscribers, IBM DB2
ms.assetid: a1a27b1e-45dd-4d7d-b6c0-2b608ed175f6
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 54263e75c0f4c7da7c6d9c24ea499c202372aa64
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87733950"
---
# <a name="ibm-db2-subscribers"></a>IBM DB2 Subscribers
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] поддерживает принудительные подписки на IBM DB2/AS 400, DB2/MVS и DB2/Universal Database через поставщики OLE DB, включенные в состав [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Host Integration Server.  
  
## <a name="configuring-an-ibm-db2-subscriber"></a>Настройка подписчика IBM DB2  
 Чтобы настроить подписчик IBM DB2, выполните следующие шаги:  
  
1.  Установите последнюю версию поставщика [!INCLUDE[msCoName](../../../includes/msconame-md.md)] OLE DB для DB2 на распространитель:  
  
    -   Если используется выпуск [!INCLUDE[ssEnterpriseEd11](../../../includes/ssenterpriseed11-md.md)], на веб-странице [Загрузки SQL Server 2008](https://go.microsoft.com/fwlink/?LinkId=149256) в разделе **Загружаемые файлы, относящиеся к CTP-версии** щелкните ссылку на последнюю версию пакета дополнительных компонентов Microsoft SQL Server 2008. На веб-странице **Пакет дополнительных компонентов Microsoft SQL Server 2008** найдите раздел **Поставщик данных OLE DB для DB2 (Майкрософт)**.  
  
    -   При использовании выпуска [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] Standard установите последнюю версию сервера служб [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Host [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] (HIS), содержащего этот поставщик.  
  
     В дополнение к установке поставщика рекомендуется установить инструмент доступа к данным, который применяется на следующем шаге (он устанавливается по умолчанию вместе с загрузкой [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] Enterprise). Дополнительные сведения об установке и использовании инструмента доступа к данным см. в документации поставщика или в документации по HIS.  
  
2.  Создайте строку соединения для подписчика. Строку соединения можно создавать в любом текстовом редакторе, однако рекомендуется использовать средство доступа к данным. Чтобы создать строку с помощью средства доступа к данным, выполните следующие действия:  
  
    1.  Нажмите кнопку **Пуск**, последовательно выберите **Программы**, **Поставщик Microsoft OLE DB для DB2**, а затем выберите **Средство доступа к данным**.  
  
    2.  В диалоговом окне **Средство доступа к данным**выполните шаги, чтобы указать сведения о сервере DB2. После завершения работы с средством доступа к данным создается универсальная связь данных (UDL, universal data link) со связанной строкой соединения (в отличие от строки соединения, UDL не используется репликацией).  
  
    3.  Доступ к строке подключения: щелкните узел UDL правой кнопкой мыши в инструменте доступа к данным и выберите **Показать строку подключения**.  
  
     Строка соединения будет аналогична следующей строке (разрывы строк добавлены для удобочитаемости):  
  
    ```  
    Provider=DB2OLEDB;Initial Catalog=MY_SUBSCRIBER_DB;Network Transport Library=TCP;Host CCSID=1252;  
    PC Code Page=1252;Network Address=MY_SUBSCRIBER;Network Port=50000;Package Collection=MY_PKGCOL;  
    Default Schema=MY_SCHEMA;Process Binary as Character=False;Units of Work=RUW;DBMS Platform=DB2/NT;  
    Persist Security Info=False;Connection Pooling=True;  
    ```  
  
     Большинство параметров в строке зависит от настраиваемого сервера DB2, но параметр `Process Binary as Character` всегда должен иметь значение `False`. Параметр `Initial Catalog` должен иметь значение для идентификации базы данных подписки. Если создается подписка, строка соединения вводится в мастер создания подписки.  
  
3.  Создайте публикацию моментальных снимков или публикацию транзакций, активируйте ее для подписчиков, отличных от[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , а затем создайте принудительную подписку для подписчика. Дополнительные сведения см. в статье [Создание подписки для подписчика, отличного от подписчика SQL Server](../create-a-subscription-for-a-non-sql-server-subscriber.md).  
  
4.  При желании можно указать пользовательский скрипт создания для одной или более статей. При публикации таблицы для нее создается скрипт CREATE TABLE. Для подписчиков, отличных от[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , скрипт создается на разновидности языка [!INCLUDE[tsql](../../../includes/tsql-md.md)] , а затем перед применением к подписчику преобразуется агентом распространителя в более универсальную разновидность SQL. Чтобы указать пользовательский скрипт создания, измените существующий скрипт [!INCLUDE[tsql](../../../includes/tsql-md.md)] или создайте полный скрипт, который использует разновидность языка DB2 SQL. Если создается скрипт DB2, используйте директиву **bypass_translation** , чтобы агент распространителя применил скрипт к подписчику без трансляции.  
  
     Сценарии могут изменяться по множеству причин, но наиболее распространенной причиной является изменение сопоставлений типов данных. Дополнительные сведения см. в подразделе «Вопросы сопоставления типов данных» этого раздела. При изменении скрипта [!INCLUDE[tsql](../../../includes/tsql-md.md)] изменения следует ограничивать сопоставлениями типов данных (кроме того, скрипт не должен содержать никаких комментариев). Если требуются более существенные изменения, создайте скрипт DB2.  
  
     **Изменение скрипта статьи и предоставление его в качестве пользовательского скрипта создания**  
  
    1.  После создания моментального снимка для публикации перейдите к папке моментальных снимков для публикации.  
  
    2.  Найдите файл .sch с тем же именем, что и у статьи, например MyArticle.sch.  
  
    3.  Откройте этот файл в Блокноте или в другом текстовом редакторе.  
  
    4.  Измените файл и сохраните его в другом каталоге.  
  
    5.  Выполните хранимую процедуру sp_changearticle, указав путь к файлу и имя свойства *creation_script*. Дополнительные сведения см. в статье [sp_changearticle (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql).  
  
     **Создание скрипта статьи и предоставление его в качестве пользовательского скрипта создания**  
  
    1.  Создайте скрипт статьи, используя разновидность языка DB2 SQL. Убедитесь, что первой строкой файла является **bypass_translation**, и строка не содержит больше ничего, кроме этого.  
  
    2.  Выполните хранимую процедуру sp_changearticle, указав путь к файлу и имя свойства *creation_script*.  
  
## <a name="considerations-for-ibm-db2-subscribers"></a>Рекомендации для подписчиков IBM DB2  
 В дополнение к рекомендациям, приведенным в разделе [Non-SQL Server Subscribers](non-sql-server-subscribers.md), при репликации на подписчики DB2 рассмотрите следующие вопросы:  
  
-   Данные и индексы для каждой реплицированной таблицы назначаются табличному пространству DB2. Размер страницы табличного пространства DB2 управляет максимальным количеством столбцов и максимальным размером строк таблиц, принадлежащих табличному пространству. Основываясь на количестве реплицированных столбцов и максимальном размере строк таблиц, убедитесь, что используется подходящее табличное пространство, связанное с реплицированными таблицами.  
  
-   Не публикуйте таблицы для подписчиков DB2 с использованием репликации транзакций, если один или более первичных ключевых столбцов в таблице относится к типу данных DECIMAL(32-38, 0-38) или NUMERIC(32-38, 0-38). Репликация транзакций идентифицирует строки, используя первичный ключ, что может привести к сбою, так как эти типы данных сопоставлены с VARCHAR(41) на подписчике. Таблицы с первичными ключами, которые используют эти типы данных, могут публиковаться с помощью репликации моментальных снимков.  
  
-   Если хотите предварительно создать таблицы на подписчике вместо того, чтобы они были созданы репликацией, используйте параметр только поддержка репликации. Дополнительные сведения см. в статье [Инициализация подписки на публикацию транзакций без моментального снимка](../initialize-a-transactional-subscription-without-a-snapshot.md).  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] допускает наличие более длинных имен таблиц и столбцов, чем DB2:  
  
    -   Если база данных публикации содержит таблицы с именами длиннее, чем имена, поддерживаемые на подписчике версией DB2, укажите альтернативное имя для свойства статьи destination_table. Дополнительные сведения об установке свойств во время создания публикации см. в статье, посвященной [созданию публикации на SQL Server 2016](../publish/create-a-publication.md), а также в статье об [определении статьи](../publish/define-an-article.md).  
  
    -   Невозможно указать альтернативные имена столбцов. Обязательно убедитесь, что опубликованные таблицы не содержат имена столбцов более длинные, чем имена, поддерживаемые на подписчике версией DB2.  
  
## <a name="mapping-data-types-from-sql-server-to-ibm-db2"></a>Сопоставление типов данных SQL Server с типами данных IBM DB2  
 Следующая таблица показывает сопоставления типов данных, применяемых во время репликации данных на подписчик, использующий IBM DB2.  
  
|Тип данных SQL Server|Тип данных IBM DB2|  
|--------------------------|-----------------------|  
|`bigint`|DECIMAL(19,0)|  
|`binary(1-254)`|CHAR(1-254) FOR BIT DATA|  
|`binary(255-8000)`|VARCHAR(255-8000) FOR BIT DATA|  
|`bit`|SMALLINT|  
|`char(1-254)`|CHAR(1-254)|  
|`char(255-8000)`|VARCHAR(255-8000)|  
|`date`|DATE|  
|`datetime`|timestamp|  
|`datetime2(0-7)`|VARCHAR(27)|  
|`datetimeoffset(0-7)`|VARCHAR(34)|  
|`decimal(1-31, 0-31)`|DECIMAL(1-31, 0-31)|  
|`decimal(32-38, 0-38)`|VARCHAR(41)|  
|`float(53)`|DOUBLE|  
|`float`|FLOAT|  
|`geography`|ИЗОБРАЖЕНИЕ|  
|`geometry`|ИЗОБРАЖЕНИЕ|  
|`hierarchyid`|ИЗОБРАЖЕНИЕ|  
|`image`|VARCHAR (0) для БИТОВых данных<sup>1</sup>|  
|`into`|INT|  
|`money`|DECIMAL(19,4)|  
|`nchar(1-4000)`|VARCHAR(1-4000)|  
|`ntext`|VARCHAR (0)<sup>1</sup>|  
|`numeric(1-31, 0-31)`|DECIMAL(1-31,0-31)|  
|`numeric(32-38, 0-38)`|VARCHAR(41)|  
|`nvarchar(1-4000)`|VARCHAR(1-4000)|  
|`nvarchar(max)`|VARCHAR (0)<sup>1</sup>|  
|`real`|ВЕЩЕСТВЕННОЕ ЧИСЛО|  
|`smalldatetime`|timestamp|  
|`smallint`|SMALLINT|  
|`smallmoney`|DECIMAL(10,4)|  
|`sql_variant`|Недоступно|  
|`sysname`|VARCHAR(128)|  
|`text`|VARCHAR (0)<sup>1</sup>|  
|`time(0-7)`|VARCHAR(16)|  
|`timestamp`|CHAR(8) FOR BIT DATA|  
|`tinyint`|SMALLINT|  
|`uniqueidentifier`|CHAR(38)|  
|`varbinary(1-8000)`|VARCHAR(1-8000) FOR BIT DATA|  
|`varchar(1-8000)`|VARCHAR(1-8000)|  
|`varbinary(max)`|VARCHAR (0) для БИТОВых данных<sup>1</sup>|  
|`varchar(max)`|VARCHAR (0)<sup>1</sup>|  
|`xml`|VARCHAR (0)<sup>1</sup>|  
  
 <sup>1</sup> дополнительные сведения о сопоставлениях с varchar (0) см. в следующем разделе.  
  
### <a name="data-type-mapping-considerations"></a>Вопросы сопоставления типов данных  
 При репликации на подписчики DB2 учтите следующие вопросы сопоставления типов данных:  
  
-   При сопоставлении [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `char` , `varchar` `binary` и `varbinary` в DB2 char, varchar, char для битовых данных и varchar для битовых данных соответственно, репликация задает длину типа данных DB2, совпадающую с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] типом.  
  
     Это позволяет успешно создавать таблицы на подписчике до тех пор, пока ограничение размера страницы DB2 достаточно велико, чтобы вместить максимальный размер строки. Убедитесь, что имя входа, используемое для доступа к базе данных DB2, имеет разрешения на доступ к табличным пространствам достаточного размера для таблиц, реплицируемых в DB2.  
  
-   DB2 может поддерживать столбцы типа VARCHAR размером до 32 килобайт (КБ), поэтому некоторые столбцы больших объектов [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] могут соответствующим образом сопоставляться со столбцами DB2 типа VARCHAR. Однако поставщик OLE DB, используемый репликацией для DB2, не поддерживает сопоставление больших объектов [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] с большими объектами DB2. По этой причине [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `text` столбцы, `varchar(max)` , `ntext` и `nvarchar(max)` сопоставляются с varchar (0) в создаваемых скриптах создания. Значение длины 0 должно меняться на соответствующее значение до применения скрипта к подписчику. Если длина типа данных не изменяется, то при попытке создания таблицы на подписчике DB2 возникает ошибка 604 (ошибка 604 указывает на недопустимую точность или длину атрибута типа данных).  
  
     На основе своих знаний исходной реплицируемой таблицы определите, подходит ли она для сопоставления большого объекта [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] с элементом DB2 переменной длины, и укажите соответствующую максимальную длину в пользовательском скрипте создания. Сведения об указании пользовательского скрипта создания см. в описании шага 5 в подразделе «Настройка подписчика IBM DB2» данного раздела.  
  
    > [!NOTE]  
    >  Длина, указанная для типа DB2, при объединении с другими длинами столбцов не может превышать максимальный размер строки, основанный на табличном пространстве DB2, которому назначены табличные данные.  
  
     Если не существует соответствующего сопоставления для столбца больших объектов, рассмотрите возможность использования фильтрации для статьи, чтобы столбец не реплицировался. Дополнительные сведения см. в статье [Фильтрация опубликованных данных](../publish/filter-published-data.md).  
  
-   При [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nchar` `nvarchar` репликации и в DB2 char и varchar репликация использует тот же описатель длины для типа DB2, что и для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] типа. Однако длина типа данных может быть слишком мала для созданной таблицы DB2.  
  
     В некоторых средах DB2 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `char` элемент данных не ограничивается однобайтовыми символами; Длина элемента типа char или varchar должна учитывать это. Следует также принять во внимание символы *shift in* (сдвиг внутрь) и *shift out* (сдвиг наружу), если в них есть необходимость. При репликации таблиц со `nchar` `nvarchar` столбцами и может потребоваться указать более большую максимальную длину для типа данных в пользовательском скрипте создания. Сведения об указании пользовательского скрипта создания см. в описании шага 5 в подразделе «Настройка подписчика IBM DB2» данного раздела.  
  
## <a name="see-also"></a>См. также:  
 [Non-SQL Server Subscribers](non-sql-server-subscribers.md)   
 [Подписка на публикации](../subscribe-to-publications.md)  
  
  
