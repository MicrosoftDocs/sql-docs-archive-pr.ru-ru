---
title: Создание подписки по запросу | Документация Майкрософт
ms.custom: ''
ms.date: 05/24/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- pull subscriptions [SQL Server replication], creating
- merge replication subscribing [SQL Server replication], pull subscriptions
- subscriptions [SQL Server replication], pull
- snapshot replication [SQL Server], subscribing
- transactional replication, subscribing
ms.assetid: 41d1886d-59c9-41fc-9bd6-a59b40e0af6e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 12ef7d658496c0fb7281827259e8e46f0c5fac64
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669391"
---
# <a name="create-a-pull-subscription"></a><span data-ttu-id="f23f0-102">Создание подписки по запросу</span><span class="sxs-lookup"><span data-stu-id="f23f0-102">Create a Pull Subscription</span></span>
  <span data-ttu-id="f23f0-103">В данном разделе описывается процесс создания подписки по запросу в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)]или объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="f23f0-103">This topic describes how create a pull subscription in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
 <span data-ttu-id="f23f0-104">Настроить подписку по запросу для репликации P2P возможно с помощью скрипта, но не с помощью мастера.</span><span class="sxs-lookup"><span data-stu-id="f23f0-104">Setting up a pull subscription for P2P replication is possible by script, but is not available through the wizard.</span></span>  
  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="f23f0-105">Использование среды SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="f23f0-105">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="f23f0-106">Создайте подписку по запросу на издателе или подписчике с помощью мастера создания подписки.</span><span class="sxs-lookup"><span data-stu-id="f23f0-106">Create a pull subscription at the Publisher or the Subscriber using the New Subscription Wizard.</span></span> <span data-ttu-id="f23f0-107">Следуйте инструкциям на страницах мастера, чтобы выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="f23f0-107">Follow the pages in the wizard to:</span></span>  
  
-   <span data-ttu-id="f23f0-108">Указать издателя и публикацию.</span><span class="sxs-lookup"><span data-stu-id="f23f0-108">Specify the Publisher and publication.</span></span>  
  
-   <span data-ttu-id="f23f0-109">Выбрать, где будут выполняться агенты репликации.</span><span class="sxs-lookup"><span data-stu-id="f23f0-109">Select where replication agents will run.</span></span> <span data-ttu-id="f23f0-110">Для подписки по запросу выберите **Выполнять каждый агент на своем подписчике (подписки по запросу)** на странице **Расположение агента распространителя** или на странице **Расположение агента слияния** в зависимости от типа публикации.</span><span class="sxs-lookup"><span data-stu-id="f23f0-110">For a pull subscription, select **Run each agent at its Subscriber (pull subscriptions)** on the **Distribution Agent Location** page or **Merge Agent Location** page, depending on the type of publication.</span></span>  
  
-   <span data-ttu-id="f23f0-111">Указать подписчиков и базы данных подписок.</span><span class="sxs-lookup"><span data-stu-id="f23f0-111">Specify Subscribers and subscription databases.</span></span>  
  
-   <span data-ttu-id="f23f0-112">Указать имена входов и пароли, используемые агентами репликации для подключений:</span><span class="sxs-lookup"><span data-stu-id="f23f0-112">Specify the logins and passwords used for connections made by replication agents:</span></span>  
  
    -   <span data-ttu-id="f23f0-113">Для подписок на публикации моментальных снимков и публикации транзакций укажите учетные данные на странице **Безопасность агента распространителя** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-113">For subscriptions to snapshot and transactional publications, specify credentials on the **Distribution Agent Security** page.</span></span>  
  
    -   <span data-ttu-id="f23f0-114">Для подписок на публикации слиянием укажите учетные данные на странице **Безопасность агента слияния** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-114">For subscriptions to merge publications, specify credentials on the **Merge Agent Security** page.</span></span>  
  
     <span data-ttu-id="f23f0-115">Дополнительные сведения о разрешениях, необходимых каждому агенту, см. в разделе [Модель безопасности агента репликации](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-115">For information about the permissions required by each agent, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="f23f0-116">Указать расписание синхронизации и время, когда подписчик должен быть инициализирован.</span><span class="sxs-lookup"><span data-stu-id="f23f0-116">Specify a synchronization schedule and when the Subscriber should be initialized.</span></span>  
  
-   <span data-ttu-id="f23f0-117">Укажите дополнительные параметры для публикаций слиянием: тип подписки, значения параметризированного фильтра и сведения для синхронизации по протоколу HTTPS, если для публикации используется веб-синхронизация.</span><span class="sxs-lookup"><span data-stu-id="f23f0-117">Specify additional options for merge publications: subscription type; values for parameterized filtering; and information for synchronization through HTTPS if the publication is enabled for Web synchronization.</span></span>  
  
-   <span data-ttu-id="f23f0-118">Укажите дополнительные параметры для публикаций транзакций, позволяющих использовать обновляемые подписки: должны ли подписчики фиксировать изменения на издателе немедленно или записывать их в очередь; учетные данные, используемые для подключения подписчика к издателю.</span><span class="sxs-lookup"><span data-stu-id="f23f0-118">Specify additional options for transactional publications that allow updating subscriptions: whether Subscribers should commit changes at the Publisher immediately or write them to a queue; credentials used to connect from the Subscriber to the Publisher.</span></span>  
  
-   <span data-ttu-id="f23f0-119">При необходимости создайте скрипт для подписки.</span><span class="sxs-lookup"><span data-stu-id="f23f0-119">Optionally script the subscription.</span></span>  
  
#### <a name="to-create-a-pull-subscription-from-the-publisher"></a><span data-ttu-id="f23f0-120">Создание подписки по запросу с издателя</span><span class="sxs-lookup"><span data-stu-id="f23f0-120">To create a pull subscription from the Publisher</span></span>  
  
1.  <span data-ttu-id="f23f0-121">Подключитесь к издателю в среде [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], а затем раскройте узел сервера.</span><span class="sxs-lookup"><span data-stu-id="f23f0-121">Connect to the Publisher in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="f23f0-122">Раскройте папку **Репликация** , а затем папку **Локальные публикации** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-122">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="f23f0-123">Щелкните правой кнопкой мыши публикацию, для которой хотите создать одну или более подписок, затем щелкните **Создать подписку**.</span><span class="sxs-lookup"><span data-stu-id="f23f0-123">Right-click the publication for which you want to create one or more subscriptions, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="f23f0-124">Выполните инструкции на страницах мастера создания подписки.</span><span class="sxs-lookup"><span data-stu-id="f23f0-124">Complete the pages in the New Subscription Wizard.</span></span>  
  
#### <a name="to-create-a-pull-subscription-from-the-subscriber"></a><span data-ttu-id="f23f0-125">Создание подписки по запросу с подписчика</span><span class="sxs-lookup"><span data-stu-id="f23f0-125">To create a pull subscription from the Subscriber</span></span>  
  
1.  <span data-ttu-id="f23f0-126">Подключитесь к подписчику в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]и раскройте узел сервера.</span><span class="sxs-lookup"><span data-stu-id="f23f0-126">Connect to the Subscriber in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="f23f0-127">Раскройте папку **Репликация** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-127">Expand the **Replication** folder.</span></span>  
  
3.  <span data-ttu-id="f23f0-128">Щелкните правой кнопкой мыши папку **Локальные подписки** , затем щелкните **Создать подписку**.</span><span class="sxs-lookup"><span data-stu-id="f23f0-128">Right-click the **Local Subscriptions** folder, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="f23f0-129">На странице **Публикация** мастера создания подписки выберите **\<Find SQL Server Publisher>** или **\<Find Oracle Publisher>** из раскрывающегося списка **Издатель**.</span><span class="sxs-lookup"><span data-stu-id="f23f0-129">On the **Publication** page of the New Subscription Wizard, select **\<Find SQL Server Publisher>** or **\<Find Oracle Publisher>** from the **Publisher** drop-down list.</span></span>  
  
5.  <span data-ttu-id="f23f0-130">Соединитесь с издателем в диалоговом окне **Соединение с сервером** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-130">Connect to the Publisher in the **Connect to Server** dialog box.</span></span>  
  
6.  <span data-ttu-id="f23f0-131">Выберите публикацию на странице **Публикация** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-131">Select a publication on the **Publication** page.</span></span>  
  
7.  <span data-ttu-id="f23f0-132">Выполните инструкции на страницах мастера создания подписки.</span><span class="sxs-lookup"><span data-stu-id="f23f0-132">Complete the pages in the New Subscription Wizard.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="f23f0-133">Использование Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="f23f0-133">Using Transact-SQL</span></span>  
 <span data-ttu-id="f23f0-134">Подписки по запросу можно создавать программно с помощью хранимых процедур репликации.</span><span class="sxs-lookup"><span data-stu-id="f23f0-134">Pull subscriptions can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="f23f0-135">Какие именно хранимые процедуры будут при этом применяться, зависит от типа публикации, к которой относится подписка.</span><span class="sxs-lookup"><span data-stu-id="f23f0-135">The stored procedures used will depend on the type of publication to which the subscription belongs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="f23f0-136">Создание подписки по запросу на публикацию моментальных снимков или транзакций</span><span class="sxs-lookup"><span data-stu-id="f23f0-136">To create a pull subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="f23f0-137">Проверьте на издателе, поддерживает ли публикация подписки по запросу. Для этого выполните процедуру [sp_helppublication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f23f0-137">At the Publisher, verify that the publication supports pull subscriptions by executing [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="f23f0-138">Если в результирующем наборе значение параметра **allow_pull** равно **1**, подписки по запросу поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="f23f0-138">If the value of **allow_pull** in the result set is **1**, then the publication supports pull subscriptions.</span></span>  
  
    -   <span data-ttu-id="f23f0-139">Если значение **allow_pull** равно **0**, выполните [sp_changepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql), указав **allow_pull** для **@property** и `true` **@value** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-139">If the value of **allow_pull** is **0**, execute [sp_changepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql), specifying **allow_pull** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="f23f0-140">На подписчике выполните процедуру [sp_addpullsubscription (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f23f0-140">At the Subscriber, execute [sp_addpullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span></span> <span data-ttu-id="f23f0-141">Укажите **@publisher** и **@publication** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-141">Specify **@publisher** and **@publication**.</span></span> <span data-ttu-id="f23f0-142">Сведения об обновлении подписок см. в разделе [Создание обновляемых подписок для публикаций транзакций](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-142">For information about updating subscriptions, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span></span>  
  
3.  <span data-ttu-id="f23f0-143">На подписчике выполните процедуру [sp_addpullsubscription_agent (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f23f0-143">At the Subscriber, execute [sp_addpullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="f23f0-144">Укажите следующее.</span><span class="sxs-lookup"><span data-stu-id="f23f0-144">Specify the following:</span></span>  
  
    -   <span data-ttu-id="f23f0-145">**@publisher**Параметры, **@publisher_db** и **@publication** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-145">The **@publisher**, **@publisher_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="f23f0-146">[!INCLUDE[msCoName](../../includes/msconame-md.md)]Учетные данные Windows, с которыми работает агент распространения на подписчике, для **@job_login** и **@job_password** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-146">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="f23f0-147">Соединения, выполняемые с помощью встроенной проверки подлинности Windows, всегда используют учетные данные Windows, указанные в **@job_login** и **@job_password** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-147">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="f23f0-148">Агент распространителя всегда создает локальное соединение с подписчиком с использованием встроенной проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f23f0-148">The Distribution Agent always makes the local connection to the Subscriber using Windows Integrated Authentication.</span></span> <span data-ttu-id="f23f0-149">По умолчанию агент установит соединение с распространителем с помощью встроенной проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f23f0-149">By default, the agent will connect to the Distributor using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="f23f0-150">(Необязательно.) Значение **0** в качестве значения параметра **@distributor_security_mode** и данные входа [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для параметров **@distributor_login** и **@distributor_password**, если для соединения с распространителем нужно использовать проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f23f0-150">(Optional) A value of **0** for **@distributor_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@distributor_login** and **@distributor_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="f23f0-151">Расписание задания агента распространителя для этой подписки.</span><span class="sxs-lookup"><span data-stu-id="f23f0-151">A schedule for the Distribution Agent job for this subscription.</span></span> <span data-ttu-id="f23f0-152">Дополнительные сведения см. в статье [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-152">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
4.  <span data-ttu-id="f23f0-153">Чтобы зарегистрировать подписку по запросу, выполните на издателе хранимую процедуру [sp_addsubscription (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f23f0-153">At the Publisher, execute [sp_addsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="f23f0-154">Укажите **@publication** , **@subscriber** и **@destination_db** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-154">Specify **@publication**, **@subscriber**, and **@destination_db**.</span></span> <span data-ttu-id="f23f0-155">В качестве значения параметра **@subscription_type** в качестве значения параметра **@subscription_type**.</span><span class="sxs-lookup"><span data-stu-id="f23f0-155">Specify a value of **pull** for **@subscription_type**.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication"></a><span data-ttu-id="f23f0-156">Создание подписки по запросу на публикацию слиянием</span><span class="sxs-lookup"><span data-stu-id="f23f0-156">To create a pull subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="f23f0-157">Проверьте на издателе, поддерживает ли публикация подписки по запросу. Для этого выполните процедуру [sp_helpmergepublication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f23f0-157">At the Publisher, verify that the publication supports pull subscriptions by executing [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="f23f0-158">Если в результирующем наборе значение параметра **allow_pull** равно **1**, подписки по запросу поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="f23f0-158">If the value of **allow_pull** in the result set is **1**, then the publication supports pull subscriptions.</span></span>  
  
    -   <span data-ttu-id="f23f0-159">Если значение **allow_pull** равно **0**, выполните [sp_changemergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql), указав **allow_pull** для **@property** и `true` **@value** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-159">If the value of **allow_pull** is **0**, execute [sp_changemergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql), specifying **allow_pull** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="f23f0-160">На подписчике выполните процедуру [sp_addmergepullsubscription (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f23f0-160">At the Subscriber, execute [sp_addmergepullsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="f23f0-161">Укажите **@publisher** , **@publisher_db** , **@publication** и следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="f23f0-161">Specify **@publisher**, **@publisher_db**, **@publication**, and the following parameters:</span></span>  
  
    -   <span data-ttu-id="f23f0-162">**@subscriber_type**— Укажите **локальную** для клиентской подписки и **глобальную** для серверной подписки.</span><span class="sxs-lookup"><span data-stu-id="f23f0-162">**@subscriber_type** - specify **local** for a client subscription and **global** for a server subscription.</span></span>  
  
    -   <span data-ttu-id="f23f0-163">**@subscription_priority**— Укажите приоритет подписки (**0,00** – **99,99**).</span><span class="sxs-lookup"><span data-stu-id="f23f0-163">**@subscription_priority** - Specify a priority for the subscription (**0.00** to **99.99**).</span></span> <span data-ttu-id="f23f0-164">Это значение необходимо указывать только для серверной подписки.</span><span class="sxs-lookup"><span data-stu-id="f23f0-164">This is only required for a server subscription.</span></span>  
  
         <span data-ttu-id="f23f0-165">Дополнительные сведения см. в разделе [Advanced Merge Replication Conflict Detection and Resolution](merge/advanced-merge-replication-conflict-detection-and-resolution.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-165">For more information, see [Advanced Merge Replication Conflict Detection and Resolution](merge/advanced-merge-replication-conflict-detection-and-resolution.md).</span></span>  
  
3.  <span data-ttu-id="f23f0-166">На подписчике выполните процедуру [sp_addmergepullsubscription_agent (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f23f0-166">At the Subscriber, execute [sp_addmergepullsubscription_agent &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="f23f0-167">Укажите значения следующих параметров.</span><span class="sxs-lookup"><span data-stu-id="f23f0-167">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="f23f0-168">**@publisher**, **@publisher_db** и **@publication** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-168">**@publisher**, **@publisher_db**, and **@publication**.</span></span>  
  
    -   <span data-ttu-id="f23f0-169">Учетные данные Windows, с которыми работает агент слияния на подписчике, для **@job_login** и **@job_password** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-169">The Windows credentials under which the Merge Agent at the Subscriber runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="f23f0-170">Соединения, выполняемые с помощью встроенной проверки подлинности Windows, всегда используют учетные данные Windows, указанные в **@job_login** и **@job_password** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-170">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="f23f0-171">Агент слияния всегда создает локальное соединение с подписчиком с использованием встроенной проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f23f0-171">The Merge Agent always makes the local connection to the Subscriber using Windows Integrated Authentication.</span></span> <span data-ttu-id="f23f0-172">По умолчанию агент установит соединение с распространителем и издателем с помощью встроенной проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f23f0-172">By default, the agent will connect to the Distributor and Publisher using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="f23f0-173">(Необязательно.) Значение **0** в качестве значения параметра **@distributor_security_mode** и данные входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для параметров **@distributor_login** и **@distributor_password**, если для соединения с распространителем нужно использовать проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f23f0-173">(Optional) A value of **0** for **@distributor_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@distributor_login** and **@distributor_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="f23f0-174">(Необязательно.) Значение **0** в качестве значения параметра **@publisher_security_mode** и данные входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для параметров **@publisher_login** и **@publisher_password**, если для соединения с распространителем нужно использовать проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f23f0-174">(Optional) A value of **0** for **@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@publisher_login** and **@publisher_password**, if you need to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher.</span></span>  
  
    -   <span data-ttu-id="f23f0-175">Расписание агента слияния для данной подписки.</span><span class="sxs-lookup"><span data-stu-id="f23f0-175">A schedule for the Merge Agent job for this subscription.</span></span> <span data-ttu-id="f23f0-176">Дополнительные сведения см. в разделе [Создание обновляемых подписок для публикаций транзакций](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-176">For more information, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md).</span></span>  
  
4.  <span data-ttu-id="f23f0-177">На издателе выполните процедуру [sp_addmergesubscription (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f23f0-177">At the Publisher, execute [sp_addmergesubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql).</span></span> <span data-ttu-id="f23f0-178">Укажите **@publication** **@subscriber** значения,, **@subscriber_db** и значение **Pull** для **@subscription_type** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-178">Specify **@publication**, **@subscriber**, **@subscriber_db**, and a value of **pull** for **@subscription_type**.</span></span> <span data-ttu-id="f23f0-179">После этого подписка по запросу будет зарегистрирована.</span><span class="sxs-lookup"><span data-stu-id="f23f0-179">This registers the pull subscription.</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="f23f0-180">Примеры (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f23f0-180">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="f23f0-181">В следующем примере создается подписка по запросу на публикацию транзакций.</span><span class="sxs-lookup"><span data-stu-id="f23f0-181">The following example creates a pull subscription to a transactional publication.</span></span> <span data-ttu-id="f23f0-182">Первый пакет выполняется на подписчике, а второй — на издателе.</span><span class="sxs-lookup"><span data-stu-id="f23f0-182">The first batch is executed at the Subscriber, and the second batch is executed at the Publisher.</span></span> <span data-ttu-id="f23f0-183">Имя входа и пароль предоставляются во время выполнения переменными сценария sqlcmd.</span><span class="sxs-lookup"><span data-stu-id="f23f0-183">Login and password values are supplied at runtime using sqlcmd scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addtranpullsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpullsub.sql#sp_addtranpullsubscriptionagent)]  
  
 [!code-sql[HowTo#sp_addtranpullsubscription](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpullsub.sql#sp_addtranpullsubscription)]  
  
 <span data-ttu-id="f23f0-184">В следующем примере создается подписка по запросу на публикацию слиянием.</span><span class="sxs-lookup"><span data-stu-id="f23f0-184">The following example creates a pull subscription to a merge publication.</span></span> <span data-ttu-id="f23f0-185">Первый пакет выполняется на подписчике, а второй — на издателе.</span><span class="sxs-lookup"><span data-stu-id="f23f0-185">The first batch is executed at the Subscriber, and the second batch is executed at the Publisher.</span></span> <span data-ttu-id="f23f0-186">Значения имени входа и пароля задаются во время выполнения с помощью переменных скриптов **sqlcmd** .</span><span class="sxs-lookup"><span data-stu-id="f23f0-186">Login and password values are supplied at runtime using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addmergepullsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsub.sql#sp_addmergepullsubscriptionagent)]  
  
 [!code-sql[HowTo#sp_addmergepullsubscription](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsub.sql#sp_addmergepullsubscription)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="f23f0-187">При помощи объектов RMO</span><span class="sxs-lookup"><span data-stu-id="f23f0-187">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="f23f0-188">Конкретные классы RMO, используемые для этого, зависят от типа репликации, к которой относится подписка.</span><span class="sxs-lookup"><span data-stu-id="f23f0-188">The RMO classes used to create a pull subscription depend on the type of publication to which the subscription belongs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="f23f0-189">Создание подписки по запросу на публикацию моментальных снимков или транзакций</span><span class="sxs-lookup"><span data-stu-id="f23f0-189">To create a pull subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="f23f0-190">Создайте соединения с подписчиком и издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-190">Create connections to both the Subscriber and Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> Class.</span></span>  
  
2.  <span data-ttu-id="f23f0-191">На основе соединения с издателем, созданного на шаге 1, создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.TransPublication> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-191">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="f23f0-192">Задайте свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> и <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-192">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="f23f0-193">Вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-193">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="f23f0-194">Если метод возвращает значение `false`, то либо неверно определены свойства, указанные на шаге 2, либо публикация не существует на сервере.</span><span class="sxs-lookup"><span data-stu-id="f23f0-194">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exist on the server.</span></span>  
  
4.  <span data-ttu-id="f23f0-195">Выполните операцию «поразрядное логическое И» (`&` в Visual C# и `And` в Visual Basic) над свойством <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> и флагом <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-195">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="f23f0-196">Если результат равен <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, присвойте свойству <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> результат операции «поразрядное логическое ИЛИ» (`|` в Visual C# и `Or` в Visual Basic) над свойством <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> и флагом <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-196">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="f23f0-197">Затем вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> , чтобы включить подписку по запросу.</span><span class="sxs-lookup"><span data-stu-id="f23f0-197">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable pull subscriptions.</span></span>  
  
5.  <span data-ttu-id="f23f0-198">Если база данных подписки не существует, создайте ее с помощью класса <xref:Microsoft.SqlServer.Management.Smo.Database> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-198">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="f23f0-199">Дополнительные сведения см. в статье [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md) (Создание, изменение и удаление баз данных).</span><span class="sxs-lookup"><span data-stu-id="f23f0-199">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="f23f0-200">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.TransPullSubscription>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-200">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPullSubscription> class.</span></span>  
  
7.  <span data-ttu-id="f23f0-201">Укажите следующие свойства подписки:</span><span class="sxs-lookup"><span data-stu-id="f23f0-201">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="f23f0-202">соединение ( <xref:Microsoft.SqlServer.Management.Common.ServerConnection> ) с подписчиком, созданное на шаге 1, в свойстве <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>;</span><span class="sxs-lookup"><span data-stu-id="f23f0-202">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Subscriber created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="f23f0-203">имя базы данных подписки в свойстве <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f23f0-203">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="f23f0-204">Имя издателя в свойстве <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-204">Name of the Publisher for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>.</span></span>  
  
    -   <span data-ttu-id="f23f0-205">имя базы данных публикации в свойстве <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f23f0-205">Name of the publication database for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="f23f0-206">имя публикации в свойстве <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f23f0-206">Name of the publication for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="f23f0-207">данные учетной записи пользователя [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows, от имени которого на подписчике будет запущен агент распространителя, в свойствах <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A>, <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> или <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> объекта <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-207">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Distribution Agent runs at the Subscriber.</span></span> <span data-ttu-id="f23f0-208">Эта учетная запись будет использоваться для создания локальных соединений с подписчиком, а также для удаленных соединений с использованием проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f23f0-208">This account is used to make local connections to the Subscriber and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="f23f0-209">Указывать свойство <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> необязательно, если подписка создается членом предопределенной роли сервера `sysadmin`, однако рекомендуется это сделать.</span><span class="sxs-lookup"><span data-stu-id="f23f0-209">Setting <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="f23f0-210">В этом случае агент будет выполнять олицетворение учетную запись агента SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f23f0-210">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="f23f0-211">Дополнительные сведения см. в статье [Модель безопасности агента репликации](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-211">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="f23f0-212">(необязательно) значение `true` в свойстве <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A>, чтобы создать задание агента, используемое для синхронизации подписки.</span><span class="sxs-lookup"><span data-stu-id="f23f0-212">(Optional) A value of `true` for <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="f23f0-213">Если указано значение `false` (значение по умолчанию), подписку можно синхронизировать только программно, и поэтому придется указывать дополнительные свойства <xref:Microsoft.SqlServer.Replication.TransSynchronizationAgent> при доступе к этому объекту из <xref:Microsoft.SqlServer.Replication.TransPullSubscription.SynchronizationAgent%2A>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-213">If you specify `false` (the default), the subscription can only be synchronized programmatically and you must specify additional properties of <xref:Microsoft.SqlServer.Replication.TransSynchronizationAgent> when you access this object from the <xref:Microsoft.SqlServer.Replication.TransPullSubscription.SynchronizationAgent%2A> property.</span></span> <span data-ttu-id="f23f0-214">Дополнительные сведения см. в статье [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-214">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="f23f0-215">Агент SQL Server доступен не во всех выпусках [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f23f0-215">SQL Server Agent is not available in every edition of [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f23f0-216">Перечень функций, поддерживаемых в разных выпусках [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], см. в разделе [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-216">For a list of features that are supported by the editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span> <span data-ttu-id="f23f0-217">При указании значения `true` для подписчиков выпуска Express задание агента не создается.</span><span class="sxs-lookup"><span data-stu-id="f23f0-217">When you specify a value of `true` for Express Subscribers, the agent job is not created.</span></span> <span data-ttu-id="f23f0-218">Однако метаданные, существенные для работы подписки, сохраняются на подписчике.</span><span class="sxs-lookup"><span data-stu-id="f23f0-218">However, important subscription-related metadata is stored at the Subscriber.</span></span>  
  
    -   <span data-ttu-id="f23f0-219">(необязательно) при соединении с распространителем с проверкой подлинности SQL Server укажите значения свойств <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> и <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> или <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> объекта <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> ;</span><span class="sxs-lookup"><span data-stu-id="f23f0-219">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> when using SQL Server Authentication to connect to the Distributor.</span></span>  
  
8.  <span data-ttu-id="f23f0-220">Вызовите метод <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-220">Call the <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="f23f0-221">Используя экземпляр класса <xref:Microsoft.SqlServer.Replication.TransPublication> , созданный на шаге 2, вызовите метод <xref:Microsoft.SqlServer.Replication.TransPublication.MakePullSubscriptionWellKnown%2A> , чтобы зарегистрировать подписку по запросу для данного издателя.</span><span class="sxs-lookup"><span data-stu-id="f23f0-221">Using the instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class from step 2, call the <xref:Microsoft.SqlServer.Replication.TransPublication.MakePullSubscriptionWellKnown%2A> method to register the pull subscription with the Publisher.</span></span> <span data-ttu-id="f23f0-222">Если данная регистрация уже существует, возникнет исключение.</span><span class="sxs-lookup"><span data-stu-id="f23f0-222">If this registration already exists, an exception occurs.</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication"></a><span data-ttu-id="f23f0-223">Создание подписки по запросу на публикацию слиянием</span><span class="sxs-lookup"><span data-stu-id="f23f0-223">To create a pull subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="f23f0-224">Создайте соединения с подписчиком и издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-224">Create connections to both the Subscriber and Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="f23f0-225">На основе соединения с издателем, созданного на шаге 1, создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePublication> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-225">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="f23f0-226">Задайте свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>и <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-226">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="f23f0-227">Вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-227">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="f23f0-228">Если метод возвращает значение `false`, то либо неверно определены свойства, указанные на шаге 2, либо публикация не существует на сервере.</span><span class="sxs-lookup"><span data-stu-id="f23f0-228">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exist on the server.</span></span>  
  
4.  <span data-ttu-id="f23f0-229">Выполните операцию «поразрядное логическое И» (`&` в Visual C# и `And` в Visual Basic) над свойством <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> и флагом <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-229">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="f23f0-230">Если результат равен <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, присвойте свойству <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> результат операции «поразрядное логическое ИЛИ» (`|` в Visual C# и `Or` в Visual Basic) над свойством <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> и флагом <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-230">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPull>.</span></span> <span data-ttu-id="f23f0-231">Затем вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> , чтобы включить подписку по запросу.</span><span class="sxs-lookup"><span data-stu-id="f23f0-231">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable pull subscriptions.</span></span>  
  
5.  <span data-ttu-id="f23f0-232">Если база данных подписки не существует, создайте ее с помощью класса <xref:Microsoft.SqlServer.Management.Smo.Database> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-232">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="f23f0-233">Дополнительные сведения см. в статье [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md) (Создание, изменение и удаление баз данных).</span><span class="sxs-lookup"><span data-stu-id="f23f0-233">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="f23f0-234">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePullSubscription>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-234">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePullSubscription> class.</span></span>  
  
7.  <span data-ttu-id="f23f0-235">Укажите следующие свойства подписки:</span><span class="sxs-lookup"><span data-stu-id="f23f0-235">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="f23f0-236">соединение ( <xref:Microsoft.SqlServer.Management.Common.ServerConnection> ) с подписчиком, созданное на шаге 1, в свойстве <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>;</span><span class="sxs-lookup"><span data-stu-id="f23f0-236">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Subscriber created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="f23f0-237">имя базы данных подписки в свойстве <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f23f0-237">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="f23f0-238">Имя издателя в свойстве <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-238">Name of the Publisher for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>.</span></span>  
  
    -   <span data-ttu-id="f23f0-239">имя базы данных публикации в свойстве <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f23f0-239">Name of the publication database for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="f23f0-240">имя публикации в свойстве <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f23f0-240">Name of the publication for <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="f23f0-241">данные учетной записи пользователя [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows, от имени которого на подписчике будет запущен агент слияния, в свойствах <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A>, <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> или <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> объекта <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-241">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Merge Agent runs at the Subscriber.</span></span> <span data-ttu-id="f23f0-242">Эта учетная запись будет использоваться для создания локальных соединений с подписчиком, а также для удаленных соединений с использованием проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f23f0-242">This account is used to make local connections to the Subscriber and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="f23f0-243">Указывать свойство <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> необязательно, если подписка создается членом предопределенной роли сервера `sysadmin`, однако рекомендуется это сделать.</span><span class="sxs-lookup"><span data-stu-id="f23f0-243">Setting <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="f23f0-244">В этом случае агент будет выполнять олицетворение учетную запись агента SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f23f0-244">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="f23f0-245">Дополнительные сведения см. в статье [Модель безопасности агента репликации](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-245">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="f23f0-246">(необязательно) значение `true` в свойстве <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A>, чтобы создать задание агента, используемое для синхронизации подписки.</span><span class="sxs-lookup"><span data-stu-id="f23f0-246">(Optional) A value of `true` for <xref:Microsoft.SqlServer.Replication.PullSubscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="f23f0-247">Если указано значение `false` (значение по умолчанию), подписку можно синхронизировать только программно, и поэтому придется указывать дополнительные свойства <xref:Microsoft.SqlServer.Replication.MergeSynchronizationAgent> при доступе к этому объекту из <xref:Microsoft.SqlServer.Replication.MergePullSubscription.SynchronizationAgent%2A>.</span><span class="sxs-lookup"><span data-stu-id="f23f0-247">If you specify `false` (the default), the subscription can only be synchronized programmatically and you must specify additional properties of <xref:Microsoft.SqlServer.Replication.MergeSynchronizationAgent> when you access this object from the <xref:Microsoft.SqlServer.Replication.MergePullSubscription.SynchronizationAgent%2A> property.</span></span> <span data-ttu-id="f23f0-248">Дополнительные сведения см. в статье [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-248">For more information, see [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).</span></span>  
  
    -   <span data-ttu-id="f23f0-249">(необязательно) при соединении с распространителем с проверкой подлинности SQL Server укажите значения свойств <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> и <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> или <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> объекта <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> ;</span><span class="sxs-lookup"><span data-stu-id="f23f0-249">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> when using SQL Server Authentication to connect to the Distributor.</span></span>  
  
    -   <span data-ttu-id="f23f0-250">(необязательно) при соединении с издателем с проверкой подлинности SQL Server укажите значения свойств <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> и <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> или <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> объекта <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-250">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
8.  <span data-ttu-id="f23f0-251">Вызовите метод <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="f23f0-251">Call the <xref:Microsoft.SqlServer.Replication.PullSubscription.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="f23f0-252">Используя экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePublication> , созданный на шаге 2, вызовите метод <xref:Microsoft.SqlServer.Replication.MergePublication.MakePullSubscriptionWellKnown%2A> , чтобы зарегистрировать подписку по запросу для данного издателя.</span><span class="sxs-lookup"><span data-stu-id="f23f0-252">Using the instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class from step 2, call the <xref:Microsoft.SqlServer.Replication.MergePublication.MakePullSubscriptionWellKnown%2A> method to register the pull subscription with the Publisher.</span></span> <span data-ttu-id="f23f0-253">Если данная регистрация уже существует, возникнет исключение.</span><span class="sxs-lookup"><span data-stu-id="f23f0-253">If this registration already exists, an exception occurs.</span></span>  
  
###  <a name="example-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="f23f0-254">Пример (объекты RMO)</span><span class="sxs-lookup"><span data-stu-id="f23f0-254">Example (RMO)</span></span>  
 <span data-ttu-id="f23f0-255">В следующем примере создается подписка по запросу на публикацию транзакций.</span><span class="sxs-lookup"><span data-stu-id="f23f0-255">This example creates a pull subscription to a transactional publication.</span></span> <span data-ttu-id="f23f0-256">Данные учетной записи [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows для задания агента распространителя предоставляются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f23f0-256">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account credentials used to create the Distribution Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPullSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpullsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPullSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpullsub)]  
  
 <span data-ttu-id="f23f0-257">В следующем примере создается подписка по запросу на публикацию слиянием.</span><span class="sxs-lookup"><span data-stu-id="f23f0-257">This example creates a pull subscription to a merge publication.</span></span> <span data-ttu-id="f23f0-258">Данные учетной записи  Windows для задания агента слияния предоставляются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f23f0-258">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub)]  
  
 <span data-ttu-id="f23f0-259">В следующем примере создается подписка по запросу на публикацию слиянием без создания соответствующего задания агента и метаданных подписки в таблице [MSsubscription_properties](/sql/relational-databases/system-tables/mssubscription-properties-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f23f0-259">This example creates a pull subscription to a merge publication without creating an associated agent job and subscription metadata in [MSsubscription_properties](/sql/relational-databases/system-tables/mssubscription-properties-transact-sql).</span></span> <span data-ttu-id="f23f0-260">Данные учетной записи  Windows для задания агента слияния предоставляются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f23f0-260">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub_NoJob](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub_nojob)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub_NoJob](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub_nojob)]  
  
 <span data-ttu-id="f23f0-261">В следующем примере создается подписка по запросу на публикацию слиянием, которую можно синхронизировать через Интернет при помощи веб-синхронизации.</span><span class="sxs-lookup"><span data-stu-id="f23f0-261">This example creates a pull subscription to a merge publication that can be synchronized over the Internet using Web synchronization.</span></span> <span data-ttu-id="f23f0-262">Данные учетной записи  Windows для задания агента слияния предоставляются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f23f0-262">The Windows account credentials used to create the Merge Agent job are passed at runtime.</span></span> <span data-ttu-id="f23f0-263">Дополнительные сведения см. в разделе [Configure Web Synchronization](configure-web-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="f23f0-263">For more information, see [Configure Web Synchronization](configure-web-synchronization.md).</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePullSub_WebSync](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepullsub_websync)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePullSub_WebSync](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepullsub_websync)]  
  
## <a name="see-also"></a><span data-ttu-id="f23f0-264">См. также:</span><span class="sxs-lookup"><span data-stu-id="f23f0-264">See Also</span></span>  
 <span data-ttu-id="f23f0-265">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="f23f0-265">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="f23f0-266">[Просмотр и изменение свойств подписки по запросу](view-and-modify-pull-subscription-properties.md) </span><span class="sxs-lookup"><span data-stu-id="f23f0-266">[View and Modify Pull Subscription Properties](view-and-modify-pull-subscription-properties.md) </span></span>  
 <span data-ttu-id="f23f0-267">[Configure Web Synchronization](configure-web-synchronization.md) </span><span class="sxs-lookup"><span data-stu-id="f23f0-267">[Configure Web Synchronization](configure-web-synchronization.md) </span></span>  
 <span data-ttu-id="f23f0-268">[Subscribe to Publications](subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="f23f0-268">[Subscribe to Publications](subscribe-to-publications.md) </span></span>  
 [<span data-ttu-id="f23f0-269">Рекомендации по защите репликации</span><span class="sxs-lookup"><span data-stu-id="f23f0-269">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
