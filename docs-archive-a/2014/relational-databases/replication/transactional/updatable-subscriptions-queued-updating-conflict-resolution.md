---
title: Обнаружение и разрешение конфликтов обновлений посредством очередей | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- conflict resolution [SQL Server replication], queued updating subscriptions
- viewing queued updating conflicts
- conflict resolution [SQL Server replication]
- queued updating subscriptions [SQL Server replication]
- articles [SQL Server replication], conflict resolution
ms.assetid: 084ac587-25e7-4bd0-a385-556bbe07d02f
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8c4608347ab119e25caa45b0ee4a592a953e34a4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87668753"
---
# <a name="queued-updating-conflict-detection-and-resolution"></a>Queued Updating Conflict Detection and Resolution
  Поскольку подписки, обновляемые посредством очередей, допускают изменения одних и тех же данных в различных местоположениях, при синхронизации данных у издателя могут возникать конфликты. Системой репликации обнаруживаются любые конфликты, возникающие при синхронизации изменений с издателем, которые затем разрешаются с помощью политики разрешения конфликтов, выбранной при создании публикации. Могут возникнуть следующие конфликты.  
  
-   Конфликты обновления и вставки. Этот конфликт происходит, когда одни и те же данные изменяются в разных местах. Одно изменение вступает в силу, а другое нет. При этом говорят о выигрыше одного изменения относительно другого.  
  
-   Конфликты при удалении данных. Данный конфликт происходит, когда одна и та же строка удаляется в одном месте и изменяется в другом.  
  
 Процесс обнаружения и разрешения конфликтов может потребовать много времени и ресурсов, поэтому рекомендуется минимизировать количество конфликтов приложения, создавая секции данных таким образом, чтобы разные подписчики изменяли разные подмножества данных.  
  
## <a name="detecting-conflicts"></a>Обнаружение конфликтов  
 При создании публикации и включении обновления посредством очередей система репликации добавляет в базовую таблицу столбец **uniqueidentifier** (**msrepl_tran_version**) со значением по умолчанию **newid()** . Когда опубликованные данные изменяются у издателя или подписчика, строка получает новый глобально уникальный идентификатор (GUID), указывающий на существование новой версии строки. Этот столбец используется агентом чтения очереди во время синхронизации для обнаружения конфликтов.  
  
 Транзакция в очереди содержит и старое, и новое значение версии строки. При применении транзакции у издателя осуществляется сравнение значений GUID из транзакции и значения GUID в публикации. Если старое значение GUID, хранимое в транзакции, совпадает со значением GUID в публикации, то публикация обновляется, и строке назначается новое значение GUID, созданное подписчиком. Благодаря обновлению публикации значением GUID из транзакции обеспечивается совпадение версий строк в публикации и в транзакции.  
  
 Если старое значение GUID, хранимое в транзакции, не совпадает со значением GUID в публикации, обнаруживается конфликт. Новое значение идентификатора GUID в публикации указывает на существование двух разных версий строки: одной в транзакции, предоставленной подписчиком, и более новой версии, существующей у издателя. Это означает, что другой подписчик или издатель обновил ту же самую строку в публикации перед тем, как была синхронизирована данная транзакция подписчика.  
  
 В отличие от репликации слиянием столбец GUID используется не для идентификации самой строки, а для проверки факта ее изменения.  
  
## <a name="resolving-conflicts"></a>Разрешение конфликтов  
 При создании публикации, обновляемой посредством очередей, выбирается сопоставитель конфликтов для использования при обнаружении конфликтов. Сопоставитель конфликтов определяет, как агент чтения очереди обрабатывает разные версии одной и той же строки, обнаруженные при синхронизации. Политику устранения конфликтов можно изменить после создания публикации до тех пор, пока отсутствуют подписки на публикацию. У сопоставителя конфликтов имеются следующие варианты выбора:  
  
-   Побеждает издатель (по умолчанию)  
  
-   Побеждает издатель, и подписка повторно инициализируется  
  
-   Побеждает подписчик  
  
 Записи о конфликтах сохраняются и их можно просмотреть при помощи средства просмотра конфликтов.  
  
 **Установка политики устранения конфликтов обновления посредством очередей**  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]: [Настройка параметров разрешения конфликтов для обновления посредством очередей (среда SQL Server Management Studio)](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)  
  
-   Программирование репликации на Transact-SQL: [Enable Updating Subscriptions for Transactional Publications](../publish/enable-updating-subscriptions-for-transactional-publications.md)  
  
 **Просмотр конфликтов данных**  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]: [Просмотр конфликтов данных для публикаций транзакций (среда SQL Server Management Studio)](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)  
  
### <a name="publisher-wins"></a>Побеждает издатель  
 Когда параметр устранения конфликтов имеет значение «Побеждает издатель», согласованность транзакций поддерживается на основании данных издателя. Происходит откат конфликтной транзакции у инициировавшего ее подписчика.  
  
 Агент чтения очереди обнаруживает конфликт, после чего создаются компенсирующие команды, которые передаются подписчику путем внесения их в базу данных распространителя. Затем агент распространителя применяет компенсирующие команды в отношении подписчика, инициировавшего конфликтную транзакцию. Компенсирующие операции обновляют строки у подписчика для соответствия строкам у издателя.  
  
 До применения компенсирующих команд можно считать результаты транзакции, откат которой в конечном итоге будет выполнен на подписчике. Это эквивалентно «грязному» чтению (уровень изоляции незафиксированной операции чтения). Компенсация последующих зависимых транзакций, которые могут произойти, отсутствует. Однако при этом соблюдаются границы транзакций, и все действия в пределах транзакции либо завершаются, либо, в случае конфликта, выполняется их откат.  
  
### <a name="publisher-wins-and-the-subscription-is-reinitialized"></a>Побеждает издатель, и подписка повторно инициализируется  
 Повторная инициализация подписчика с целью разрешения конфликтов поддерживает строгую согласованность транзакций на подписчике, но она может занимать много времени, если публикация содержит большое количество данных.  
  
 Когда агент чтения очереди обнаруживает конфликт, все остальные транзакции в очереди (включая конфликтные транзакции) отклоняются, а подписчик помечается для повторной инициализации. Следующий моментальный снимок, создаваемый для публикации, применяется агентом распространителя к подписчику.  
  
### <a name="subscriber-wins"></a>Побеждает подписчик  
 Обнаружение конфликтов в соответствии с политикой «Побеждает подписчик» означает, что побеждает последняя транзакция подписчика, обновляющая издателя. В этом случае при обнаружении конфликта продолжает использоваться транзакция, отправленная подписчиком, а издатель обновляется. Эта политика подходит для приложений, в которых подобные изменения не нарушают целостность данных.  
  
## <a name="see-also"></a>См. также:  
 [Updatable Subscriptions for Transactional Replication](updatable-subscriptions-for-transactional-replication.md)  
  
  
