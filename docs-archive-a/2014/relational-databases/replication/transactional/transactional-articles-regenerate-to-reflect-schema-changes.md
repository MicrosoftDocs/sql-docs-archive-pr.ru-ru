---
title: Повторное создание пользовательских процедур транзакций с учетом изменений в схеме | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- custom procedures [SQL Server replication]
- transactional replication, replicating schema changes
- schemas [SQL Server replication], replicating changes
ms.assetid: ccf68a13-e748-4455-8168-90e6d2868098
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 7b41b5309816e037ce3619e880b796e0653c7506
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87738189"
---
# <a name="regenerate-custom-transactional-procedures-to-reflect-schema-changes"></a><span data-ttu-id="238d5-102">Повторное создание пользовательских процедур транзакций для отражения изменений схем</span><span class="sxs-lookup"><span data-stu-id="238d5-102">Regenerate Custom Transactional Procedures to Reflect Schema Changes</span></span>
  <span data-ttu-id="238d5-103">По умолчанию репликация транзакций выполняет изменение всех данных подписчика через хранимые процедуры, сформированные внутренними процедурами для каждой статьи таблицы в публикации.</span><span class="sxs-lookup"><span data-stu-id="238d5-103">By default transactional replication makes all data changes at Subscribers through stored procedures that are generated by internal procedures for each table article in the publication.</span></span> <span data-ttu-id="238d5-104">Эти три процедуры (по одной для вставок, обновлений и удалений) копируются на подписчик и выполняются при репликации вставки, обновления или удаления на подписчик.</span><span class="sxs-lookup"><span data-stu-id="238d5-104">The three procedures (one each for inserts, updates, and deletes) are copied to the Subscriber and execute when an insert, update, or delete is replicated to the Subscriber.</span></span> <span data-ttu-id="238d5-105">Если изменение схемы вносится в таблицу на издателе [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , репликация автоматически заново формирует эти процедуры, вызывая тот же набор внутренних процедур сценария, чтобы новые процедуры соответствовали новой схеме (репликация изменений схемы не поддерживается для издателей Oracle).</span><span class="sxs-lookup"><span data-stu-id="238d5-105">When a schema change is made to a table on a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publisher, replication regenerates these procedures automatically by calling the same set of internal scripting procedures so that the new procedures match the new schema (replication of schema changes is not supported for Oracle Publishers).</span></span>  
  
 <span data-ttu-id="238d5-106">Также можно задать пользовательские процедуры для замены одной или нескольких процедур по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="238d5-106">It is also possible to specify custom procedures to replace one or more of the default procedures.</span></span> <span data-ttu-id="238d5-107">Пользовательские процедуры должны изменяться, если на них влияет изменение схемы.</span><span class="sxs-lookup"><span data-stu-id="238d5-107">The custom procedures should be changed if the schema change will affect the procedure.</span></span> <span data-ttu-id="238d5-108">Например если процедура ссылается на столбец, удаленный при изменении схемы, то ссылки на этот столбец должны быть удалены из пользовательской процедуры.</span><span class="sxs-lookup"><span data-stu-id="238d5-108">For example, if a procedure references a column that is dropped in a schema change, references to the column should be removed from the procedure.</span></span> <span data-ttu-id="238d5-109">Имеется два способа, которыми репликация может передавать новую пользовательскую процедуру подписчикам:</span><span class="sxs-lookup"><span data-stu-id="238d5-109">There are two ways for replication to propagate a new custom procedure to Subscribers:</span></span>  
  
-   <span data-ttu-id="238d5-110">Первый — это использовать пользовательскую процедуру сценария для замены процедур репликации.</span><span class="sxs-lookup"><span data-stu-id="238d5-110">The first option is to use a custom scripting procedure to replace the defaults used by replication:</span></span>  
  
    1.  <span data-ttu-id="238d5-111">При выполнении [sp_addarticle &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql)убедитесь, что **@schema_option** бит 0x02 имеет **значение true**.</span><span class="sxs-lookup"><span data-stu-id="238d5-111">When executing [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), ensure the **@schema_option** 0x02 bit is to **true**.</span></span>  
  
    2.  <span data-ttu-id="238d5-112">Выполните [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql) и укажите значение "Insert", "Update" или "Delete" для параметра **@type** и имя пользовательской процедуры создания скрипта для параметра **@value** .</span><span class="sxs-lookup"><span data-stu-id="238d5-112">Execute [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql) and specify a value of 'insert', 'update', or 'delete' for the parameter **@type** and the name of the custom scripting procedure for the parameter **@value**.</span></span>  
  
     <span data-ttu-id="238d5-113">При следующем изменении схемы репликация вызывает эту хранимую процедуру, чтобы создать скрипт определения для новой пользовательской хранимой процедуры, а затем передает ее всем подписчикам.</span><span class="sxs-lookup"><span data-stu-id="238d5-113">The next time a schema change is made, replication calls this stored procedure to script out the definition for the new user defined custom stored procedure, and then propagates the procedure to each Subscriber.</span></span>  
  
-   <span data-ttu-id="238d5-114">Второй способ состоит в использовании скрипта, содержащего определение новой пользовательской процедуры:</span><span class="sxs-lookup"><span data-stu-id="238d5-114">The second option is to use a script that contains a new custom procedure definition:</span></span>  
  
    1.  <span data-ttu-id="238d5-115">При выполнении [sp_addarticle &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql)установите **@schema_option** бит 0x02 в **значение false** , чтобы репликация не создавала автоматически пользовательские процедуры на подписчике.</span><span class="sxs-lookup"><span data-stu-id="238d5-115">When executing [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), set the **@schema_option** 0x02 bit to **false** so replication does not automatically generate custom procedures at the Subscriber.</span></span>  
  
    2.  <span data-ttu-id="238d5-116">Перед каждым изменением схемы создавайте новый файл скрипта и регистрируйте скрипт в репликации, выполняя процедуру [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="238d5-116">Before each schema change, create a new script file and register the script with replication by executing [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql).</span></span> <span data-ttu-id="238d5-117">Укажите значение "custom_script" для параметра **@type** и путь к скрипту на издателе для параметра **@value** .</span><span class="sxs-lookup"><span data-stu-id="238d5-117">Specify a value of 'custom_script' for the parameter **@type** and the path to the script on the Publisher for the parameter **@value**.</span></span>  
  
     <span data-ttu-id="238d5-118">При следующем изменении соответствующей схемы этот скрипт выполняется у каждого подписчика в той же транзакции, что и команда DDL.</span><span class="sxs-lookup"><span data-stu-id="238d5-118">The next time a relevant schema change is made, this script executes on each Subscriber within the same transaction as the DDL command.</span></span> <span data-ttu-id="238d5-119">После завершения изменений схемы регистрация скрипта отменяется.</span><span class="sxs-lookup"><span data-stu-id="238d5-119">After the schema change is made, the script is unregistered.</span></span> <span data-ttu-id="238d5-120">Чтобы этот скрипт выполнялся при последующем изменении схемы, его необходимо повторно зарегистрировать.</span><span class="sxs-lookup"><span data-stu-id="238d5-120">You must re-register the script to have it executed after a subsequent schema change.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="238d5-121">См. также:</span><span class="sxs-lookup"><span data-stu-id="238d5-121">See Also</span></span>  
 <span data-ttu-id="238d5-122">[Указание способа распространения изменений для статей транзакций](transactional-articles-specify-how-changes-are-propagated.md) </span><span class="sxs-lookup"><span data-stu-id="238d5-122">[Specify How Changes Are Propagated for Transactional Articles](transactional-articles-specify-how-changes-are-propagated.md) </span></span>  
 [<span data-ttu-id="238d5-123">Внесение изменений в схемы баз данных публикации</span><span class="sxs-lookup"><span data-stu-id="238d5-123">Make Schema Changes on Publication Databases</span></span>](../publish/make-schema-changes-on-publication-databases.md)  
  
  
