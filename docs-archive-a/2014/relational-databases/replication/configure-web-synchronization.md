---
title: Настройка веб-синхронизации | Документация Майкрософт
ms.custom: ''
ms.date: 01/10/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
f1_keywords:
- SQL10.REP.CONFIGWEBSYNCWIZARD.SUBTYPE.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.CLIENTAUTH.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.WEBSERV.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.DIRACCESS.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.VIRDIRINFO.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.AUTHACCESS.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.COMPLETEWIZ.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.ANONACCESS.F1
- SQL10.REP.CONFIGWEBSYNCWIZARD.SNAPSHARE.F1
helpviewer_keywords:
- Web synchronization, security best practices
- Web synchronization, configuring
ms.assetid: 21f8e4d4-cd07-4856-98f0-9c9890ebbc82
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 406175533b92d13dce8c14b91b654fbb6099dc22
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655091"
---
# <a name="configure-web-synchronization"></a><span data-ttu-id="ddb08-102">Настроить веб-синхронизацию</span><span class="sxs-lookup"><span data-stu-id="ddb08-102">Configure Web Synchronization</span></span>
  <span data-ttu-id="ddb08-103">Поддержка веб-синхронизации для репликации слиянием [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] позволяет производить репликацию данных по протоколу HTTPS через Интернет.</span><span class="sxs-lookup"><span data-stu-id="ddb08-103">The Web synchronization option for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Merge Replication enables data replication using the HTTPS protocol over the Internet.</span></span> <span data-ttu-id="ddb08-104">Чтобы использовать веб-синхронизацию, сначала необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="ddb08-104">To use Web synchronization, you first need to perform the following configuration actions:</span></span>  
  
1.  <span data-ttu-id="ddb08-105">Создать новые учетные записи домена и сопоставить им имена входов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ddb08-105">Create new domain accounts and map [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] logins.</span></span>  
  
2.  <span data-ttu-id="ddb08-106">Для синхронизации подписок настройте сервер служб [!INCLUDE[msCoName](../../includes/msconame-md.md)] IIS.</span><span class="sxs-lookup"><span data-stu-id="ddb08-106">Configure the computer that is running [!INCLUDE[msCoName](../../includes/msconame-md.md)] Internet Information Services (IIS) to synchronize subscriptions.</span></span>  
  
3.  <span data-ttu-id="ddb08-107">Настроить публикацию слиянием для включения веб-синхронизации.</span><span class="sxs-lookup"><span data-stu-id="ddb08-107">Configure a merge publication to allow Web synchronization.</span></span>  
  
4.  <span data-ttu-id="ddb08-108">Настройте одну или несколько подписок для использования веб-синхронизации.</span><span class="sxs-lookup"><span data-stu-id="ddb08-108">Configure one or more subscriptions to use Web synchronization.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ddb08-109">Если планируется реплицировать большие объемы данных или использовать типы данных больших значений, например `varchar(max)`, прочтите подраздел «Реплицирование больших объемов данных» в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="ddb08-109">If you plan to replicate large volumes of data or use large data types such as `varchar(max)`, read the section "Replicating Large Volumes of Data" in this topic.</span></span>  
  
 <span data-ttu-id="ddb08-110">Для успешной настройки веб-синхронизации необходимо выбрать настройки безопасности в соответствии с используемыми требованиями и политиками.</span><span class="sxs-lookup"><span data-stu-id="ddb08-110">To successfully set up Web synchronization, you must decide how you will configure security to meet your particular requirements and policies.</span></span> <span data-ttu-id="ddb08-111">Лучше выполнить эти настройки и создать необходимые учетные записи до начала настройки служб IIS, публикаций и подписок.</span><span class="sxs-lookup"><span data-stu-id="ddb08-111">It is best to make these decisions and create the necessary accounts before you attempt to configure IIS, the publication, and subscriptions.</span></span>  
  
 <span data-ttu-id="ddb08-112">Для краткости в процедуре ниже описывается упрощенная конфигурация безопасности, выполненная с использованием локальных учетных записей.</span><span class="sxs-lookup"><span data-stu-id="ddb08-112">In the procedures that follow, a simplified security configuration using local accounts is described, for brevity.</span></span> <span data-ttu-id="ddb08-113">Эта упрощенная конфигурация может использоваться для установок, в которых службы IIS, издатель и распространитель [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] запущены на одном компьютере, хотя, вероятнее всего, при установке продукта будет использоваться топология с несколькими серверами (рекомендуется использовать именно такой вариант).</span><span class="sxs-lookup"><span data-stu-id="ddb08-113">This simplified configuration is suitable for installations where both IIS and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Publisher and Distributor are running on the same computer, even though it is much more likely (and recommended) that you will use a multiple-server topology for a production installation.</span></span> <span data-ttu-id="ddb08-114">В этих процедурах локальные учетные записи домена можно заменить на учетные записи домена.</span><span class="sxs-lookup"><span data-stu-id="ddb08-114">You can substitute domain accounts for the local accounts in the procedures.</span></span>  
  
## <a name="creating-new-accounts-and-mapping-sql-server-logins"></a><span data-ttu-id="ddb08-115">Создание новых учетных записей и сопоставление имен входа SQL Server</span><span class="sxs-lookup"><span data-stu-id="ddb08-115">Creating New Accounts and Mapping SQL Server Logins</span></span>  
 <span data-ttu-id="ddb08-116">Средство прослушивания репликации [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (replisapi.dll) соединяется с издателем с помощью олицетворения учетной записи, указанной для пула приложений, связанного с веб-сайтом репликации.</span><span class="sxs-lookup"><span data-stu-id="ddb08-116">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener (replisapi.dll) connects to the Publisher by impersonating the account specified for the application pool that is associated with the replication web site.</span></span>  
  
 <span data-ttu-id="ddb08-117">Для учетной записи, используемой средством прослушивания репликации [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , необходимы разрешения, описанные в разделе [Merge Agent Security](merge-agent-security.md), в подразделе «Соединение с издателем и распространителем».</span><span class="sxs-lookup"><span data-stu-id="ddb08-117">The account used for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener must have permissions as described in [Merge Agent Security](merge-agent-security.md), under the section "Connect to the Publisher or Distributor."</span></span> <span data-ttu-id="ddb08-118">В нескольких словах, учетная запись должна отвечать следующим требованиям.</span><span class="sxs-lookup"><span data-stu-id="ddb08-118">In summary, the account must:</span></span>  
  
-   <span data-ttu-id="ddb08-119">Она должна входить в список доступа к публикации (PAL).</span><span class="sxs-lookup"><span data-stu-id="ddb08-119">Be a member of the Publication Access List (PAL).</span></span>  
  
-   <span data-ttu-id="ddb08-120">Она должна быть сопоставлена с именем входа, связанным с пользователем в базе данных публикации.</span><span class="sxs-lookup"><span data-stu-id="ddb08-120">Be mapped to a login associated with a user in the publication database.</span></span>  
  
-   <span data-ttu-id="ddb08-121">Она должна быть сопоставлена с именем входа, связанным с пользователем в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="ddb08-121">Be mapped to a login associated with a user in the distribution database.</span></span>  
  
-   <span data-ttu-id="ddb08-122">Она должна иметь разрешение на чтение в хранилище моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ddb08-122">Have Read permissions on the snapshot share.</span></span>  
  
 <span data-ttu-id="ddb08-123">При первом использовании репликации [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] также необходимо создать учетные записи и имена входов для агентов репликации.</span><span class="sxs-lookup"><span data-stu-id="ddb08-123">If this is the first time you are using [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication, you will also need to create accounts and logins for the replication agents.</span></span> <span data-ttu-id="ddb08-124">Дополнительные сведения см. в подразделах «Настройка публикации» и «Настройка подписки» данного раздела.</span><span class="sxs-lookup"><span data-stu-id="ddb08-124">For more information, see the "Configuring the Publication" and "Configuring the Subscription" sections in this topic.</span></span>  
  
 <span data-ttu-id="ddb08-125">Прежде чем настраивать веб-синхронизацию, рекомендуется прочитать приведенный ниже раздел «Лучшие методики обеспечения безопасности для веб-синхронизации».</span><span class="sxs-lookup"><span data-stu-id="ddb08-125">Before you configure Web synchronization, we recommend that you read the "Security Best Practices for Web Synchronization" section in this topic.</span></span> <span data-ttu-id="ddb08-126">Дополнительные сведения о безопасности при веб-синхронизации см. в разделе [Security Architecture for Web Synchronization](security/security-architecture-for-web-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="ddb08-126">For more information about Web synchronization security, see [Security Architecture for Web Synchronization](security/security-architecture-for-web-synchronization.md).</span></span>  
  
## <a name="configuring-the-computer-that-is-running-iis"></a><span data-ttu-id="ddb08-127">Настройка компьютера, на котором работают службы IIS</span><span class="sxs-lookup"><span data-stu-id="ddb08-127">Configuring the Computer That Is Running IIS</span></span>  
 <span data-ttu-id="ddb08-128">Для выполнения веб-синхронизации требуется установить и настроить службы IIS.</span><span class="sxs-lookup"><span data-stu-id="ddb08-128">Web synchronization requires that you install and configure IIS.</span></span> <span data-ttu-id="ddb08-129">Для настройки публикации для использования веб-синхронизации необходим URL-адрес веб-сайта репликации.</span><span class="sxs-lookup"><span data-stu-id="ddb08-129">You will need the URL to the replication Web site before you can configure a publication to use Web synchronization.</span></span>  
  
<span data-ttu-id="ddb08-130">Веб-синхронизация поддерживается в IIS, начиная с версии 5.0.</span><span class="sxs-lookup"><span data-stu-id="ddb08-130">Web synchronization is supported on IIS beginning with version 5.0.</span></span> <span data-ttu-id="ddb08-131">Мастер настройки веб-синхронизации не поддерживается в версии служб IIS 7.0.</span><span class="sxs-lookup"><span data-stu-id="ddb08-131">The Configure Web Synchronization Wizard is not supported on IIS version 7.0.</span></span> <span data-ttu-id="ddb08-132">Начиная с SQL Server 2012 мы рекомендуем устанавливать SQL Server с поддержкой репликации, если нужно использовать компонент веб-синхронизации на сервере IIS.</span><span class="sxs-lookup"><span data-stu-id="ddb08-132">Beginning with SQL Server 2012, to use the web sync component on IIS server, we recommend users install SQL Server with replication.</span></span> <span data-ttu-id="ddb08-133">Это может быть бесплатный выпуск SQL Server Express.</span><span class="sxs-lookup"><span data-stu-id="ddb08-133">This can be the free SQL Server Express edition.</span></span>  
  
 <span data-ttu-id="ddb08-134">При веб-синхронизации используется протокол SSL.</span><span class="sxs-lookup"><span data-stu-id="ddb08-134">SSL is required for Web synchronization.</span></span> <span data-ttu-id="ddb08-135">Также необходим сертификат безопасности, выпущенный центром сертификации.</span><span class="sxs-lookup"><span data-stu-id="ddb08-135">You will need a security certificate issued by a certification authority.</span></span> <span data-ttu-id="ddb08-136">Для отладки можно использовать собственный сертификат безопасности.</span><span class="sxs-lookup"><span data-stu-id="ddb08-136">For testing purposes only, you can use a self-issued security certificate.</span></span>  
  
  
 <span data-ttu-id="ddb08-137">**Настройка служб IIS для веб-синхронизации**</span><span class="sxs-lookup"><span data-stu-id="ddb08-137">**To configure IIS for Web synchronization**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="ddb08-138">: [Настройка сервера IIS для веб-синхронизации](configure-iis-for-web-synchronization.md)</span><span class="sxs-lookup"><span data-stu-id="ddb08-138">: [Configure IIS for Web Synchronization](configure-iis-for-web-synchronization.md)</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="ddb08-139">: [Настройка сервера IIS 7 для веб-синхронизации](configure-iis-7-for-web-synchronization.md)</span><span class="sxs-lookup"><span data-stu-id="ddb08-139">: [Configure IIS 7 for Web Synchronization](configure-iis-7-for-web-synchronization.md)</span></span>  
  
## <a name="creating-a-web-garden"></a><span data-ttu-id="ddb08-140">Создание веб-сада</span><span class="sxs-lookup"><span data-stu-id="ddb08-140">Creating a Web Garden</span></span>  
 <span data-ttu-id="ddb08-141">Средство прослушивания репликации [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает две параллельные операции синхронизации в каждом потоке.</span><span class="sxs-lookup"><span data-stu-id="ddb08-141">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener supports two concurrent synchronization operations per thread.</span></span> <span data-ttu-id="ddb08-142">При превышении этого ограничения средство прослушивания репликации может перестать отвечать на запросы.</span><span class="sxs-lookup"><span data-stu-id="ddb08-142">Exceeding this limit may cause the Replication Listener to stop responding.</span></span> <span data-ttu-id="ddb08-143">Количество потоков, выделенных replisapi.dll, определяется свойством пула приложения «Максимальное число рабочих процессов».</span><span class="sxs-lookup"><span data-stu-id="ddb08-143">The number of threads allocated to replisapi.dll is determined by the application pool Maximum Worker Processes property.</span></span> <span data-ttu-id="ddb08-144">Значением этого свойства по умолчанию является 1.</span><span class="sxs-lookup"><span data-stu-id="ddb08-144">By default, this property is set at 1.</span></span>  
  
 <span data-ttu-id="ddb08-145">Количество параллельных операций синхронизации, приходящихся на один ЦП, можно увеличить, увеличив значение свойства «Максимальное число рабочих процессов».</span><span class="sxs-lookup"><span data-stu-id="ddb08-145">You can support a greater number of concurrent synchronization operations per CPU by increasing the Maximum Worker Process property value.</span></span> <span data-ttu-id="ddb08-146">Масштабирование путем увеличения количества рабочих процессов на ЦП называется созданием веб-сада.</span><span class="sxs-lookup"><span data-stu-id="ddb08-146">Scaling out by increasing the number of worker processes per CPU is known as creating a "Web garden."</span></span>  
  
 <span data-ttu-id="ddb08-147">Создание веб-сада позволит выполнять одновременную синхронизацию более двух подписчиков.</span><span class="sxs-lookup"><span data-stu-id="ddb08-147">Web gardening will allow more than two Subscribers to synchronize at the same time.</span></span> <span data-ttu-id="ddb08-148">Также при этом будет увеличена нагрузка replisapi.dll на ЦП, что может отрицательно повлиять на производительность сервера.</span><span class="sxs-lookup"><span data-stu-id="ddb08-148">It will also increase CPU utilization by replisapi.dll, which can negatively impact overall server performance.</span></span> <span data-ttu-id="ddb08-149">При выборе значения для свойства «Максимальное число рабочих процессов» необходимо учитывать все описанное выше.</span><span class="sxs-lookup"><span data-stu-id="ddb08-149">It is important to balance these considerations when you choose a value for Maximum Worker Processes.</span></span>  
  
#### <a name="to-increase-maximum-worker-processes-in-iis-7"></a><span data-ttu-id="ddb08-150">Увеличение максимального числа рабочих процессов в IIS 7</span><span class="sxs-lookup"><span data-stu-id="ddb08-150">To increase Maximum Worker Processes in IIS 7</span></span>  
  
1.  <span data-ttu-id="ddb08-151">В **диспетчере служб IIS**разверните узел локального сервера, затем выберите узел **Пул приложений** .</span><span class="sxs-lookup"><span data-stu-id="ddb08-151">In **Internet Information Services (IIS) Manager**, expand the local server node, and then click on the **Application Pool** node.</span></span>  
  
2.  <span data-ttu-id="ddb08-152">Выберите пул приложений, связанный с веб-сайтом синхронизации, и выберите **Дополнительные параметры** на панели **Действия** .</span><span class="sxs-lookup"><span data-stu-id="ddb08-152">Select the application pool associated with the Web synchronization site, and then click **Advanced Settings** on the **Actions** pane.</span></span>  
  
3.  <span data-ttu-id="ddb08-153">В диалоговом окне «Дополнительные параметры» под заголовком **Модель процесса** выберите строку с именем **Максимальное число рабочих процессов**.</span><span class="sxs-lookup"><span data-stu-id="ddb08-153">On the Advanced Settings dialog, under the **Process Model** heading, click the row labeled **Maximum Worker Processes**.</span></span> <span data-ttu-id="ddb08-154">Измените значение этого свойства и нажмите **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ddb08-154">Change the property value, and then click **OK**.</span></span>  
  
## <a name="configuring-the-publication"></a><span data-ttu-id="ddb08-155">Настройка публикации</span><span class="sxs-lookup"><span data-stu-id="ddb08-155">Configuring the Publication</span></span>  
 <span data-ttu-id="ddb08-156">Чтобы использовать веб-синхронизацию, создайте публикацию аналогично созданию стандартной топологии слияния.</span><span class="sxs-lookup"><span data-stu-id="ddb08-156">To use Web synchronization, create a publication in the same way that you would for a standard merge topology.</span></span> <span data-ttu-id="ddb08-157">Дополнительные сведения см. в статье [Публикация данных и объектов базы данных](publish/publish-data-and-database-objects.md).</span><span class="sxs-lookup"><span data-stu-id="ddb08-157">For more information, see [Publish Data and Database Objects](publish/publish-data-and-database-objects.md).</span></span>  
  
 <span data-ttu-id="ddb08-158">После создания публикации используйте этот параметр для включения веб-синхронизации одним из следующих методов: [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)]или объекты Replication Management Objects (RMO).</span><span class="sxs-lookup"><span data-stu-id="ddb08-158">After the publication is created, enable the option to allow for Web synchronization by using one of the following methods: [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="ddb08-159">Чтобы включить веб-синхронизацию, необходимо указать адрес веб-сервера для соединений подписчика.</span><span class="sxs-lookup"><span data-stu-id="ddb08-159">To enable Web synchronization, you will need to supply the Web server address for Subscriber connections.</span></span>  
  
 <span data-ttu-id="ddb08-160">Если издатель используется впервые, необходимо также настроить распространитель и хранилище моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ddb08-160">If you are using a Publisher for the first time, you must also configure a Distributor and a snapshot share.</span></span> <span data-ttu-id="ddb08-161">Агент слияния на каждом подписчике должен иметь разрешения на чтение данных из хранилища моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ddb08-161">The Merge Agent at each Subscriber must have read permissions on the snapshot share.</span></span> <span data-ttu-id="ddb08-162">Дополнительные сведения см. в статьях [Настройка распространения](configure-distribution.md) и [Организация безопасности папки моментальных снимков](security/secure-the-snapshot-folder.md).</span><span class="sxs-lookup"><span data-stu-id="ddb08-162">For more information, see [Configure Distribution](configure-distribution.md) and [Secure the Snapshot Folder](security/secure-the-snapshot-folder.md).</span></span>  
  
 <span data-ttu-id="ddb08-163">`gen` является зарезервированным словом в XML-файлах websync.</span><span class="sxs-lookup"><span data-stu-id="ddb08-163">`gen` is a reserved word in websync xml files.</span></span> <span data-ttu-id="ddb08-164">Не пытайтесь публиковать таблицы, содержащие столбцы с именем `gen`.</span><span class="sxs-lookup"><span data-stu-id="ddb08-164">Do not attempt to publish tables containing columns named `gen`.</span></span>  
  
## <a name="configuring-the-subscription"></a><span data-ttu-id="ddb08-165">Настройка подписки</span><span class="sxs-lookup"><span data-stu-id="ddb08-165">Configuring the Subscription</span></span>  
 <span data-ttu-id="ddb08-166">После включения публикации и настройки служб IIS создайте подписку по запросу и укажите, что она должна синхронизироваться с помощью служб IIS.</span><span class="sxs-lookup"><span data-stu-id="ddb08-166">After you enable a publication and configure IIS, create a pull subscription and specify that the pull subscription should synchronize by using IIS.</span></span> <span data-ttu-id="ddb08-167">(Веб-синхронизация поддерживается только для подписок по запросу.)</span><span class="sxs-lookup"><span data-stu-id="ddb08-167">(Web synchronization is supported only for pull subscriptions.)</span></span>  
  
## <a name="upgrading-from-an-earlier-version-of-sql-server"></a><span data-ttu-id="ddb08-168">Обновление с более ранней версии SQL Server</span><span class="sxs-lookup"><span data-stu-id="ddb08-168">Upgrading from an Earlier Version of SQL Server</span></span>  
 <span data-ttu-id="ddb08-169">Если существует готовая топология веб-синхронизации, после обновления [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]необходимо убедиться, что в виртуальный каталог, используемый веб-синхронизацией, скопирована последняя версия библиотеки Replisapi.dll.</span><span class="sxs-lookup"><span data-stu-id="ddb08-169">If you have an existing Web synchronization topology configured and you upgrade [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you must ensure that the latest version of Replisapi.dll is copied to the virtual directory used by Web synchronization.</span></span> <span data-ttu-id="ddb08-170">По умолчанию последняя версия библиотеки Replisapi.dll располагается в папке "C:\Program Files\Microsoft SQL Server\\\<nnn\>\COM".</span><span class="sxs-lookup"><span data-stu-id="ddb08-170">By default, the latest version of Replisapi.dll is located in C:\Program Files\Microsoft SQL Server\\<nnn\>\COM.</span></span>  
  
## <a name="replicating-large-volumes-of-data"></a><span data-ttu-id="ddb08-171">Реплицирование больших объемов данных</span><span class="sxs-lookup"><span data-stu-id="ddb08-171">Replicating Large Volumes of Data</span></span>  
 <span data-ttu-id="ddb08-172">Чтобы избежать потенциальных проблем с памятью на компьютерах подписчиков, веб-синхронизация использует максимальный размер по умолчанию — 100 МБ для XML-файла, применяемого для передачи изменений.</span><span class="sxs-lookup"><span data-stu-id="ddb08-172">To help avoid potential memory problems on Subscriber computers Web synchronization uses a default maximum size of 100 MB for the XML file used to transfer changes.</span></span> <span data-ttu-id="ddb08-173">Этот предел может быть повышен путем установки следующего раздела реестра.</span><span class="sxs-lookup"><span data-stu-id="ddb08-173">The limit can be raised by setting the following registry key:</span></span>  
  
 <span data-ttu-id="ddb08-174">**HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\100\Replication**</span><span class="sxs-lookup"><span data-stu-id="ddb08-174">**HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\100\Replication**</span></span>  
  
 <span data-ttu-id="ddb08-175">**WebSyncMaxXmlSize DWORD 2000000**</span><span class="sxs-lookup"><span data-stu-id="ddb08-175">**WebSyncMaxXmlSize DWORD 2000000**</span></span>  
  
 <span data-ttu-id="ddb08-176">Диапазон допустимых значений для этого раздела составляет от 100 МБ до 4 ГБ.</span><span class="sxs-lookup"><span data-stu-id="ddb08-176">The range of acceptable values for this key is 100 MB to 4GB.</span></span> <span data-ttu-id="ddb08-177">Значение указывается в КБ.</span><span class="sxs-lookup"><span data-stu-id="ddb08-177">The value is specified in KB.</span></span> <span data-ttu-id="ddb08-178">Установка большого значения для этого параметра не гарантирует, что удастся синхронизировать такой объем данных.</span><span class="sxs-lookup"><span data-stu-id="ddb08-178">Setting this parameter to a high value does not guarantee that you can synchronize that amount of data.</span></span> <span data-ttu-id="ddb08-179">Эффективный предел ограничивается размером непрерывной памяти, доступной на компьютере подписчика.</span><span class="sxs-lookup"><span data-stu-id="ddb08-179">The effective limit is constrained by how much contiguous memory is available on the Subscriber computer.</span></span> <span data-ttu-id="ddb08-180">Если необходимо значение больше 100 МБ, рекомендуется увеличивать его постепенно и проверять потребление памяти с использованием типичной рабочей нагрузки на подписчике.</span><span class="sxs-lookup"><span data-stu-id="ddb08-180">If you must have a value larger than 100 MB, we recommend that you increase the value incrementally and test memory consumption with a typical workload on the Subscriber.</span></span>  
  
 <span data-ttu-id="ddb08-181">Максимальный размер XML-файла составляет 4 ГБ, но репликация синхронизирует изменения из этого файла пакетами.</span><span class="sxs-lookup"><span data-stu-id="ddb08-181">The maximum size for the XML file is 4 GB, but replication synchronizes the changes from that file in batches.</span></span> <span data-ttu-id="ddb08-182">Максимальный размер пакета данных и метаданных составляет 25 МБ.</span><span class="sxs-lookup"><span data-stu-id="ddb08-182">The maximum batch size of data and metadata is 25 MB.</span></span> <span data-ttu-id="ddb08-183">Необходимо гарантировать, что объем данных в каждом пакете не будет превышать уровень 20 МБ, чтобы сохранить место для метаданных и других служебных данных.</span><span class="sxs-lookup"><span data-stu-id="ddb08-183">You must ensure that the data in each batch does not exceed approximately 20 MB, which allows for metadata and any other overhead.</span></span> <span data-ttu-id="ddb08-184">Это ограничение влечет за собой такие последствия:</span><span class="sxs-lookup"><span data-stu-id="ddb08-184">This limit has the following implications:</span></span>  
  
-   <span data-ttu-id="ddb08-185">невозможна репликация столбца, содержимое которого приводит к превышению объемом данных и метаданных порогового значения в 25 МБ.</span><span class="sxs-lookup"><span data-stu-id="ddb08-185">You cannot replicate any column that causes the data and metadata to exceed 25 MB.</span></span> <span data-ttu-id="ddb08-186">В результате могут возникнуть проблемы, если выполняется репликация строк, содержащих типы данных с большими значениями, например `varchar(max)`;</span><span class="sxs-lookup"><span data-stu-id="ddb08-186">This might be an issue when you are replicating rows that contain large data types, such as `varchar(max)`.</span></span>  
  
-   <span data-ttu-id="ddb08-187">в случае репликации больших объемов данных может возникнуть необходимость в корректировке размера пакета агента слияния.</span><span class="sxs-lookup"><span data-stu-id="ddb08-187">If you replicate large volumes of data, you might have to adjust the Merge Agent batch size.</span></span>  
  
 <span data-ttu-id="ddb08-188">Размер пакета для репликации слиянием измеряется в *поколениях*, которые представляют собой коллекции изменений для статьи.</span><span class="sxs-lookup"><span data-stu-id="ddb08-188">Batch size for merge replication is measured in *generations*, which are collections of changes per article.</span></span> <span data-ttu-id="ddb08-189">Число поколений в пакете задается с помощью `DownloadGenerationsPerBatch` `UploadGenerationsPerBatch` параметров агент слияния.</span><span class="sxs-lookup"><span data-stu-id="ddb08-189">The number of generations in a batch is specified by using the-`DownloadGenerationsPerBatch` and -`UploadGenerationsPerBatch` parameters of the Merge Agent.</span></span> <span data-ttu-id="ddb08-190">Дополнительные сведения см. в статье [Replication Merge Agent](agents/replication-merge-agent.md).</span><span class="sxs-lookup"><span data-stu-id="ddb08-190">For more information, see [Replication Merge Agent](agents/replication-merge-agent.md).</span></span>  
  
 <span data-ttu-id="ddb08-191">При работе с большими объемами данных рекомендуется указывать небольшие значения для этих параметров пакетов.</span><span class="sxs-lookup"><span data-stu-id="ddb08-191">For large volumes of data, specify a small number for each of the batching parameters.</span></span> <span data-ttu-id="ddb08-192">Рекомендуем начинать со значения, равного 10, и затем корректировать его с учетом потребностей приложений, а также производительности.</span><span class="sxs-lookup"><span data-stu-id="ddb08-192">We recommend that you start with a value of 10, and then tune based on application needs and performance.</span></span> <span data-ttu-id="ddb08-193">Обычно эти параметры задаются в профиле агента.</span><span class="sxs-lookup"><span data-stu-id="ddb08-193">Typically, these parameters are specified in an agent profile.</span></span> <span data-ttu-id="ddb08-194">Дополнительные сведения о профилях см. в разделе [Replication Agent Profiles](agents/replication-agent-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="ddb08-194">For more information about profiles, see [Replication Agent Profiles](agents/replication-agent-profiles.md).</span></span>  
  
## <a name="security-best-practices-for-web-synchronization"></a><span data-ttu-id="ddb08-195">Рекомендации по безопасности для веб-синхронизации</span><span class="sxs-lookup"><span data-stu-id="ddb08-195">Security Best Practices for Web Synchronization</span></span>  
 <span data-ttu-id="ddb08-196">Существует множество вариантов настроек безопасности при выполнении веб-синхронизации.</span><span class="sxs-lookup"><span data-stu-id="ddb08-196">There are many choices for security-related settings in Web synchronization.</span></span> <span data-ttu-id="ddb08-197">Рекомендуется следующий подход:</span><span class="sxs-lookup"><span data-stu-id="ddb08-197">We recommend the following approach:</span></span>  
  
-   <span data-ttu-id="ddb08-198">Издатель и распространитель [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] могут работать на одном компьютере. Такая установка является обычной для репликации слиянием.</span><span class="sxs-lookup"><span data-stu-id="ddb08-198">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Distributor and Publisher can be on the same computer (a typical setup for merge replication).</span></span> <span data-ttu-id="ddb08-199">Однако службы IIS необходимо установить на отдельном компьютере.</span><span class="sxs-lookup"><span data-stu-id="ddb08-199">However, IIS should be installedon a separate computer.</span></span>  
  
-   <span data-ttu-id="ddb08-200">Для шифрования соединения подписчика с компьютером, на котором работают службы IIS, используйте протокол Secure Sockets Layer (SSL).</span><span class="sxs-lookup"><span data-stu-id="ddb08-200">Use Secure Sockets Layer (SSL) to encrypt the connection between the Subscriber and the computer running IIS.</span></span> <span data-ttu-id="ddb08-201">Это необходимо для выполнения веб-синхронизации.</span><span class="sxs-lookup"><span data-stu-id="ddb08-201">This is required for Web synchronization.</span></span>  
  
-   <span data-ttu-id="ddb08-202">Используйте обычную проверку подлинности для соединений между подписчиком и сервером IIS.</span><span class="sxs-lookup"><span data-stu-id="ddb08-202">Use Basic Authentication for connections from the Subscriber to IIS.</span></span> <span data-ttu-id="ddb08-203">Если используется обычная проверка подлинности, службы IIS могут подключаться к издателю и распространителю от лица подписчика без делегирования полномочий.</span><span class="sxs-lookup"><span data-stu-id="ddb08-203">Using Basic Authentication, IIS can make connections to the Publisher/Distributor on behalf of the Subscriber without requiring delegation.</span></span> <span data-ttu-id="ddb08-204">При использовании встроенной проверки подлинности требуется делегирование.</span><span class="sxs-lookup"><span data-stu-id="ddb08-204">Delegation is required if you use Integrated Authentication.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="ddb08-205">Обычная проверка подлинности — это метод, с помощью которого учетные данные передаются службам IIS.</span><span class="sxs-lookup"><span data-stu-id="ddb08-205">Basic Authentication is the method by which credentials are passed to IIS.</span></span> <span data-ttu-id="ddb08-206">Обычная проверка подлинности не исключает указания учетных записей домена Windows для подключения к службам IIS.</span><span class="sxs-lookup"><span data-stu-id="ddb08-206">Basic Authentication does not prevent specifying Windows domain accounts for connections that are made to IIS.</span></span>  
  
-   <span data-ttu-id="ddb08-207">Укажите, что агент моментальных снимков должен запускаться и подключаться под учетной записью домена Windows.</span><span class="sxs-lookup"><span data-stu-id="ddb08-207">Specify that the Snapshot Agent should run under a Windows domain account, and specify that the agent should make connections as that account.</span></span> <span data-ttu-id="ddb08-208">(Это конфигурация по умолчанию.) Укажите, что каждый агент слияния должен запускаться под учетной записью домена того пользователя, который использует компьютер подписчика, а также укажите, что агент должен подключаться под этой учетной записью.</span><span class="sxs-lookup"><span data-stu-id="ddb08-208">(This is the default configuration.) Specify that each Merge Agent should run under the domain account of the user that uses the Subscriber computer, and specify that the agent should make connections as that account.</span></span>  
  
     <span data-ttu-id="ddb08-209">Дополнительные сведения о разрешениях, необходимых для агентов, см. в разделе [Replication Agent Security Model](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="ddb08-209">For more information about the permissions that are required by agents, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="ddb08-210">Укажите ту же учетную запись домена, которая используется агент слияния при указании учетной записи и пароля на странице **сведения о веб-сервере** мастера создания подписки или при указании значений для **@internet_url** параметров и **@internet_login** [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="ddb08-210">Specify the same domain account as the one the Merge Agent uses when you specify an account and password on the **Web Server Information** page of the New Subscription Wizard or when you specify values for the **@internet_url** and **@internet_login** parameters of [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="ddb08-211">Для данной учетной записи должно быть предоставлено разрешение на чтение хранилища моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ddb08-211">This account must have read permissions for the snapshot share.</span></span>  
  
-   <span data-ttu-id="ddb08-212">Для каждой публикации следует использовать отдельный виртуальный каталог на сервере IIS.</span><span class="sxs-lookup"><span data-stu-id="ddb08-212">Each publication should use a separate virtual directory for IIS.</span></span>  
  
-   <span data-ttu-id="ddb08-213">Учетная запись, под которой запускается средство прослушивания репликации [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (Replisapi.dll), также является учетной записью, которая будет использоваться для соединения с издателем и распространителем во время синхронизации.</span><span class="sxs-lookup"><span data-stu-id="ddb08-213">The account under which the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener (Replisapi.dll) runs is also the account that will connect to the Publisher and Distributor during synchronization.</span></span> <span data-ttu-id="ddb08-214">Эта учетная запись должна быть сопоставлена с учетной записью входа SQL на издателе и распространителе.</span><span class="sxs-lookup"><span data-stu-id="ddb08-214">This account must be mapped to a SQL Login account on the Publisher and Distributor.</span></span> <span data-ttu-id="ddb08-215">Дополнительные сведения см. в разделе "Установка разрешений для средства прослушивания репликации SQL Server" статьи [Настройка служб IIS для веб-синхронизации](configure-iis-for-web-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="ddb08-215">For more information, see the "Setting Permissions for the SQL Server Replication Listener" section in the [Configure IIS for Web Synchronization](configure-iis-for-web-synchronization.md).</span></span>  
  
-   <span data-ttu-id="ddb08-216">Для доставки моментального снимка от издателя на компьютер, на котором работают службы IIS, можно использовать протокол FTP.</span><span class="sxs-lookup"><span data-stu-id="ddb08-216">You can use FTP to deliver the snapshot from the Publisher to the computer that is running IIS.</span></span> <span data-ttu-id="ddb08-217">Моментальный снимок всегда доставляется подписчику с компьютера, на котором работают службы IIS, по протоколу HTTPS.</span><span class="sxs-lookup"><span data-stu-id="ddb08-217">The snapshot is always delivered from the computer that is running IIS to the Subscriber by using HTTPS.</span></span> <span data-ttu-id="ddb08-218">Дополнительные сведения см. в статье [Передача моментальных снимков через FTP](transfer-snapshots-through-ftp.md).</span><span class="sxs-lookup"><span data-stu-id="ddb08-218">For more information, see [Transfer Snapshots Through FTP](transfer-snapshots-through-ftp.md).</span></span>  
  
-   <span data-ttu-id="ddb08-219">Если серверы топологии репликации защищены брандмауэром, то для использования веб-синхронизации может потребоваться открыть порты брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="ddb08-219">If servers in the replication topology are behind a firewall, you might need to open ports in the firewall to enable Web synchronization.</span></span>  
  
    -   <span data-ttu-id="ddb08-220">Компьютер подписчика соединяется с компьютером, на котором запущены службы IIS через протокол HTTPS с использованием SSL, обычно настроенного для использования порта 443.</span><span class="sxs-lookup"><span data-stu-id="ddb08-220">The Subscriber computer connects to the computer that is running IIS over HTTPS using SSL, which is typically configured to use port 443.</span></span> <span data-ttu-id="ddb08-221">Подписчики[!INCLUDE[ssEW](../../includes/ssew-md.md)] также могут использовать соединение через протокол HTTP, для которого обычно настраивается использование порта 80.</span><span class="sxs-lookup"><span data-stu-id="ddb08-221">[!INCLUDE[ssEW](../../includes/ssew-md.md)] Subscribers can also connect over HTTP, which is typically configured to use port 80.</span></span>  
  
    -   <span data-ttu-id="ddb08-222">Компьютер, на котором запущены службы IIS, обычно соединяется с издателем или распространителем через порт 1433 (экземпляр по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="ddb08-222">The computer that is running IIS typically connects to the Publisher or Distributor using port 1433 (default instance).</span></span> <span data-ttu-id="ddb08-223">Если издатель или распространитель является именованным экземпляром на сервере с другим экземпляром по умолчанию, для соединения с этим именованным экземпляром обычно используется порт 1500.</span><span class="sxs-lookup"><span data-stu-id="ddb08-223">When the Publisher or Distributor is a named instance on a server with another default instance, port 1500 is typically used to connect to the named instance.</span></span>  
  
    -   <span data-ttu-id="ddb08-224">Если компьютер, на котором запущены службы IIS, отделен от распространителя брандмауэром, а для доставки моментального снимка используется протокол FTP, должны быть открыты порты, необходимые для работы этого протокола.</span><span class="sxs-lookup"><span data-stu-id="ddb08-224">If the computer running IIS is separated from the Distributor by a firewall and an FTP share is used for snapshot delivery, the ports used for FTP must be opened.</span></span> <span data-ttu-id="ddb08-225">Дополнительные сведения см. в статье [Передача моментальных снимков через FTP](transfer-snapshots-through-ftp.md).</span><span class="sxs-lookup"><span data-stu-id="ddb08-225">For more information, see [Transfer Snapshots Through FTP](transfer-snapshots-through-ftp.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ddb08-226">Открытие портов на брандмауэре может привести к незащищенности сервера от вредоносных атак.</span><span class="sxs-lookup"><span data-stu-id="ddb08-226">Opening ports in your firewall can leave your server exposed to malicious attacks.</span></span> <span data-ttu-id="ddb08-227">Перед открытием портов убедитесь в том, что знаете принципы работы брандмауэров.</span><span class="sxs-lookup"><span data-stu-id="ddb08-227">Make sure that you understand firewall systems before you open ports.</span></span> <span data-ttu-id="ddb08-228">Дополнительные сведения см. в разделе [Security Considerations for a SQL Server Installation](../../sql-server/install/security-considerations-for-a-sql-server-installation.md).</span><span class="sxs-lookup"><span data-stu-id="ddb08-228">For more information, see [Security Considerations for a SQL Server Installation](../../sql-server/install/security-considerations-for-a-sql-server-installation.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ddb08-229">См. также:</span><span class="sxs-lookup"><span data-stu-id="ddb08-229">See Also</span></span>  
 [<span data-ttu-id="ddb08-230">Web Synchronization for Merge Replication</span><span class="sxs-lookup"><span data-stu-id="ddb08-230">Web Synchronization for Merge Replication</span></span>](web-synchronization-for-merge-replication.md)  
  
  
