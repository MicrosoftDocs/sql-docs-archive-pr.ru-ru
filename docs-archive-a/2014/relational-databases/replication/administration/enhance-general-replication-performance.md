---
title: Повышение общей производительности репликации | Документация Майкрософт
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], design and performance
- designing databases [SQL Server], replication performance
- Snapshot Agent, performance
- snapshots [SQL Server replication], performance considerations
- merge replication performance [SQL Server replication]
- snapshot replication [SQL Server], performance
- subscriptions [SQL Server replication], performance considerations
- agents [SQL Server replication], performance
- performance [SQL Server replication], general considerations
- transactional replication, performance
ms.assetid: 895b1ad7-ffb9-4a5c-bda6-e1dfbd56d9bf
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 0a85519a947e7d5d03f324b71984d2ffb40bcefe
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750776"
---
# <a name="enhance-general-replication-performance"></a><span data-ttu-id="f0381-102">Повышение общей производительности репликации</span><span class="sxs-lookup"><span data-stu-id="f0381-102">Enhance General Replication Performance</span></span>
  <span data-ttu-id="f0381-103">Используя рекомендации, приведенные в этом разделе, можно повысить общую производительность всех типов репликации, выполняющихся в приложении и сети.</span><span class="sxs-lookup"><span data-stu-id="f0381-103">You can enhance the general performance for all types of replication in your application and on your network by using the guidelines described in this topic.</span></span>  
  
## <a name="server-and-network"></a><span data-ttu-id="f0381-104">Сервер и сеть</span><span class="sxs-lookup"><span data-stu-id="f0381-104">Server and Network</span></span>  
  
-   <span data-ttu-id="f0381-105">Установите минимальное и максимальное количество памяти, выделенное для [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssDEnoversion](../../../includes/ssdenoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f0381-105">Set the minimum and maximum amount of memory allocated to [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssDEnoversion](../../../includes/ssdenoversion-md.md)].</span></span>  
  
     <span data-ttu-id="f0381-106">По умолчанию компонент [!INCLUDE[ssDE](../../../includes/ssde-md.md)] изменяет свои требования к памяти динамически, исходя из доступных ресурсов системы.</span><span class="sxs-lookup"><span data-stu-id="f0381-106">By default, the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] changes its memory requirements dynamically based on available system resources.</span></span> <span data-ttu-id="f0381-107">Чтобы исключить случаи отсутствия доступной памяти во время выполнения операций репликации, используйте параметр **min server memory** для установки минимально доступной памяти.</span><span class="sxs-lookup"><span data-stu-id="f0381-107">To avoid low memory availability during replication activities, use the **min server memory** option to set the minimum available memory.</span></span> <span data-ttu-id="f0381-108">Во избежание размещения на диске страниц системной памяти можно также установить максимальный объем памяти с помощью параметра **max server memory** .</span><span class="sxs-lookup"><span data-stu-id="f0381-108">To avoid having the operating system page to disc for memory, you can also set a maximum amount of memory with the **max server memory** option.</span></span> <span data-ttu-id="f0381-109">Дополнительные сведения см. в статье [Параметры конфигурации сервера "Server Memory"](../../../database-engine/configure-windows/server-memory-server-configuration-options.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-109">For more information, see [Server Memory Server Configuration Options](../../../database-engine/configure-windows/server-memory-server-configuration-options.md).</span></span>  
  
-   <span data-ttu-id="f0381-110">Обеспечьте надлежащее размещение файлов базы данных и файлов журналов.</span><span class="sxs-lookup"><span data-stu-id="f0381-110">Ensure proper allocation of database data files and log files.</span></span> <span data-ttu-id="f0381-111">Используйте отдельный диск для журнала транзакций всех баз данных, задействованных в репликации.</span><span class="sxs-lookup"><span data-stu-id="f0381-111">Use a separate disk drive for the transaction log for all databases involved in replication.</span></span>  
  
     <span data-ttu-id="f0381-112">Можно уменьшить время, требуемое для записи транзакций, посредством сохранения файлов журналов на дисковом накопителе, отличном от того, который используется для хранения базы данных.</span><span class="sxs-lookup"><span data-stu-id="f0381-112">You can decrease the time it takes to write transactions by storing the log files on a disk drive different than the one used to store the database.</span></span> <span data-ttu-id="f0381-113">Если необходимо обеспечить отказоустойчивость, можно создать зеркало такого диска, применяя технологию RAID-1 (Redundant Array of Inexpensive Disks).</span><span class="sxs-lookup"><span data-stu-id="f0381-113">You can mirror that drive, using a Redundant Array of Inexpensive Disks (RAID)-1, if you require fault tolerance.</span></span> <span data-ttu-id="f0381-114">Используйте RAID 0 или 0+1 (в зависимости от требований к отказоустойчивости) для хранения других файлов базы данных.</span><span class="sxs-lookup"><span data-stu-id="f0381-114">Use RAID 0 or 0+1 (depending on your need for fault tolerance) for other database files.</span></span> <span data-ttu-id="f0381-115">Матрицы независимых дисковых накопителей (RAID) рекомендуется применять независимо от того, используется репликация или нет.</span><span class="sxs-lookup"><span data-stu-id="f0381-115">This is a good practice regardless of whether or not replication is being used.</span></span>  
  
-   <span data-ttu-id="f0381-116">Рассмотрите возможность добавления памяти на серверы, участвующие в репликации, особенно на сервер распространителя.</span><span class="sxs-lookup"><span data-stu-id="f0381-116">Consider adding memory to servers used in replication, particularly the Distributor.</span></span>  
  
-   <span data-ttu-id="f0381-117">Используйте многопроцессорные компьютеры.</span><span class="sxs-lookup"><span data-stu-id="f0381-117">Use multiprocessor computers.</span></span>  
  
     <span data-ttu-id="f0381-118">Агенты репликации могут также воспользоваться преимуществами дополнительных процессоров сервера.</span><span class="sxs-lookup"><span data-stu-id="f0381-118">Replication agents can take advantage of additional processors on the server.</span></span> <span data-ttu-id="f0381-119">Если вы запускаете приложение при высокой загрузке центрального процессора, рассмотрите возможность установки более быстрого процессора или нескольких процессоров.</span><span class="sxs-lookup"><span data-stu-id="f0381-119">If you are running at high CPU usage, consider installing a faster CPU or multiple CPUs.</span></span>  
  
-   <span data-ttu-id="f0381-120">Используйте сеть с высокой пропускной способностью.</span><span class="sxs-lookup"><span data-stu-id="f0381-120">Use a fast network.</span></span>  
  
     <span data-ttu-id="f0381-121">Скорость работы сети может быть критическим фактором производительности, особенно для репликации транзакций.</span><span class="sxs-lookup"><span data-stu-id="f0381-121">The network can be a significant performance bottleneck, particularly for transactional replication.</span></span> <span data-ttu-id="f0381-122">Распространение изменений на подписчики может быть ускорено при использовании высокоскоростной сети со скоростью 100 мегабит/с (Mbps) или более быстрой сети.</span><span class="sxs-lookup"><span data-stu-id="f0381-122">The propagation of changes to Subscribers can be significantly enhanced by using a fast network of 100 megabits per second (Mbps) or faster.</span></span> <span data-ttu-id="f0381-123">Если у сети низкая пропускная способность, установите подходящие настройки сети и параметры агента.</span><span class="sxs-lookup"><span data-stu-id="f0381-123">If the network is slow, specify appropriate network settings and agent parameters.</span></span>  
  
## <a name="database-design"></a><span data-ttu-id="f0381-124">Структура базы данных</span><span class="sxs-lookup"><span data-stu-id="f0381-124">Database Design</span></span>  
  
-   <span data-ttu-id="f0381-125">Следуйте рекомендациям по разработке баз данных.</span><span class="sxs-lookup"><span data-stu-id="f0381-125">Follow best practices for database design.</span></span>  
  
     <span data-ttu-id="f0381-126">Оптимизация производительности обычно положительно сказывается на работе как нереплицированной базы данных, так и реплицированной базы данных.</span><span class="sxs-lookup"><span data-stu-id="f0381-126">A replicated database generally benefits from the same performance optimizations as a non-replicated database.</span></span> <span data-ttu-id="f0381-127">Однако индексы следует использовать на подписчике аккуратно: первичный ключевой столбец на подписчике должен быть индексирован, однако дополнительные индексы могут негативно повлиять на производительность работы при операциях вставки, обновления и удаления.</span><span class="sxs-lookup"><span data-stu-id="f0381-127">However, indexes should be used with caution at the Subscriber: the primary key column at the Subscriber should be indexed, but additional indexes can affect insert, update, and delete performance.</span></span>  
  
-   <span data-ttu-id="f0381-128">Рассмотрите возможность установки параметра READ_COMMITTED_SNAPSHOT базы данных.</span><span class="sxs-lookup"><span data-stu-id="f0381-128">Consider setting the READ_COMMITTED_SNAPSHOT database option.</span></span>  
  
     <span data-ttu-id="f0381-129">С целью сокращения вероятности возникновения состязаний между действиями пользователя и действиями агента репликации установите для баз данных публикации и подписки этот параметр:</span><span class="sxs-lookup"><span data-stu-id="f0381-129">To help reduce contention between user activity and replication agent activity, set this option for the publication and subscription databases:</span></span>  
  
    ```  
    ALTER DATABASE AdventureWorks  
    SET READ_COMMITTED_SNAPSHOT ON  
    ```  
  
     <span data-ttu-id="f0381-130">Дополнительные сведения см. в разделе [ALTER DATABASE (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f0381-130">For more information, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
-   <span data-ttu-id="f0381-131">Осмотрительно используйте логику приложения в триггерах.</span><span class="sxs-lookup"><span data-stu-id="f0381-131">Be cautious with application logic in triggers.</span></span>  
  
     <span data-ttu-id="f0381-132">Использование бизнес-логики в пользовательских триггерах на подписчике может замедлить репликацию изменений на подписчик.</span><span class="sxs-lookup"><span data-stu-id="f0381-132">Business logic in user-defined triggers at the Subscriber can slow down the replication of changes to the Subscriber:</span></span>  
  
    -   <span data-ttu-id="f0381-133">Для репликации транзакций может быть более эффективным включение этой логики в отдельные хранимые процедуры, используемые для применения реплицированных команд.</span><span class="sxs-lookup"><span data-stu-id="f0381-133">For transactional replication, it can be more efficient to include this logic in custom stored procedures used to apply the replicated commands.</span></span> <span data-ttu-id="f0381-134">Дополнительные сведения см. в статье [Указание способа распространения изменений для статей транзакций](../transactional/transactional-articles-specify-how-changes-are-propagated.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-134">For more information, see [Specify How Changes Are Propagated for Transactional Articles](../transactional/transactional-articles-specify-how-changes-are-propagated.md).</span></span>  
  
    -   <span data-ttu-id="f0381-135">Для репликации слиянием может быть эффективнее использовать обработчики бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="f0381-135">For merge replication, it can be more efficient to use business logic handlers.</span></span> <span data-ttu-id="f0381-136">Дополнительные сведения см. в статье [Выполнение бизнес-логики при синхронизации слиянием](../merge/execute-business-logic-during-merge-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-136">For more information, see [Execute Business Logic During Merge Synchronization](../merge/execute-business-logic-during-merge-synchronization.md).</span></span>  
  
     <span data-ttu-id="f0381-137">Если используются триггеры для поддержки ссылочной целостности таблиц, опубликованных для репликации слиянием, укажите порядок обработки таблиц, чтобы уменьшить количества повторных попыток, выполняемых агентом слияния.</span><span class="sxs-lookup"><span data-stu-id="f0381-137">If you use triggers to maintain referential integrity in tables published for merge replication, specify the processing order of tables to reduce the number of retries required for the Merge Agent.</span></span> <span data-ttu-id="f0381-138">Дополнительные сведения см. в разделе [Указание свойств репликации слиянием](../publish/specify-merge-replication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-138">For more information, see [Specify Merge Replication properties](../publish/specify-merge-replication-properties.md).</span></span>  
  
-   <span data-ttu-id="f0381-139">Ограничьте использование типов данных больших объектов.</span><span class="sxs-lookup"><span data-stu-id="f0381-139">Limit the use of Large Object (LOB) data types.</span></span>  
  
     <span data-ttu-id="f0381-140">По сравнению с другими типами данных столбцов для хранения и обработки типа данных больших объектов требуется больше места и времени.</span><span class="sxs-lookup"><span data-stu-id="f0381-140">LOBs require more storage space and processing than other column data types.</span></span> <span data-ttu-id="f0381-141">Эти столбцы следует включать в статьи только в том случае, если они необходимы для работы приложения.</span><span class="sxs-lookup"><span data-stu-id="f0381-141">Do not include these columns in articles unless necessary for your application.</span></span> <span data-ttu-id="f0381-142">Не рекомендуется использовать типы данных `text`, `ntext` и `image`.</span><span class="sxs-lookup"><span data-stu-id="f0381-142">The data types `text`, `ntext`, and `image` are deprecated.</span></span> <span data-ttu-id="f0381-143">При включении больших объектов (LOB) рекомендуется использовать типы данных `varchar(max)`, `nvarchar(max)`, `varbinary(max)`, соответственно.</span><span class="sxs-lookup"><span data-stu-id="f0381-143">If you do include LOBs, we recommend that you use the data types `varchar(max)`, `nvarchar(max)`, `varbinary(max)`, respectively.</span></span>  
  
     <span data-ttu-id="f0381-144">Для репликации транзакций рассмотрите возможность использования профиля агента распространителя, именуемого **Профиль распространения для потока OLEDB**.</span><span class="sxs-lookup"><span data-stu-id="f0381-144">For transactional replication, consider using the Distribution Agent profile called **Distribution Profile for OLEDB streaming**.</span></span> <span data-ttu-id="f0381-145">Дополнительные сведения см. в статье [Replication Agent Profiles](../agents/replication-agent-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-145">For more information, see [Replication Agent Profiles](../agents/replication-agent-profiles.md).</span></span>  
  
## <a name="publication-design"></a><span data-ttu-id="f0381-146">Разработка публикации</span><span class="sxs-lookup"><span data-stu-id="f0381-146">Publication Design</span></span>  
  
-   <span data-ttu-id="f0381-147">Публикуйте только нужные данные.</span><span class="sxs-lookup"><span data-stu-id="f0381-147">Publish only the data required.</span></span>  
  
     <span data-ttu-id="f0381-148">В связи с тем, что настройка репликации достаточно проста, существует тенденция публиковать больше данных, чем требуется фактически.</span><span class="sxs-lookup"><span data-stu-id="f0381-148">Because replication is easy to set up, there is a tendency to publish more data than is actually required.</span></span> <span data-ttu-id="f0381-149">Это может привести к использованию дополнительных ресурсов баз данных распространителя и файлов моментальных снимков, а также понизить пропускную способность при работе с необходимыми данными.</span><span class="sxs-lookup"><span data-stu-id="f0381-149">This can consume additional resources within the distribution databases and snapshot files, and can lower the throughput for required data.</span></span> <span data-ttu-id="f0381-150">Избегайте публикации ненужных таблиц и рассмотрите возможность более редкого обновления публикаций.</span><span class="sxs-lookup"><span data-stu-id="f0381-150">Avoid publishing unnecessary tables and consider updating publications less frequently.</span></span>  
  
-   <span data-ttu-id="f0381-151">Минимизируйте конфликты посредством использования надлежащей структуры публикации и верного алгоритма приложения.</span><span class="sxs-lookup"><span data-stu-id="f0381-151">Minimize conflicts through publication design and application behavior.</span></span>  
  
     <span data-ttu-id="f0381-152">Изменения данных на подписчиках допускают следующие типы репликации: репликация слиянием, репликация транзакций с обновляемыми подписками и одноранговая репликация транзакций.</span><span class="sxs-lookup"><span data-stu-id="f0381-152">The following types of replication allow data to be changed at Subscribers: merge replication, transactional replication with updatable subscriptions, and peer-to-peer transactional replication.</span></span> <span data-ttu-id="f0381-153">Репликация слиянием и репликация транзакций с обновляемыми подписками поддерживают конфликты данных, если данная строка обновляется более чем в одном узле между синхронизациями.</span><span class="sxs-lookup"><span data-stu-id="f0381-153">Merge replication and transactional replication with updatable subscriptions support data conflicts if a given row is updated at more than one node between synchronizations.</span></span> <span data-ttu-id="f0381-154">Одноранговая репликация не поддерживает конфликты данных. Изменения данных должны быть секционированы.</span><span class="sxs-lookup"><span data-stu-id="f0381-154">Peer-to-peer replication does not support data conflicts; data changes must be partitioned.</span></span> <span data-ttu-id="f0381-155">Независимо от типа используемой репликации рекомендуется использовать секционирование изменений везде, где это возможно, так как это сокращает обработку, выполняемую в целях обнаружения и разрешения конфликтов.</span><span class="sxs-lookup"><span data-stu-id="f0381-155">Regardless of the type of replication used, we recommend that you partition changes whenever possible, because this reduces the processing required for conflict detection and resolution.</span></span>  
  
     <span data-ttu-id="f0381-156">Изменения могут секционироваться путем публикации подмножеств данных на каждом подписчике или посредством прямого внесения приложением изменений заданной строки на указанном узле.</span><span class="sxs-lookup"><span data-stu-id="f0381-156">Changes can be partitioned by publishing subsets of data to each Subscriber or by having an application direct changes for a given row to a given node:</span></span>  
  
    -   <span data-ttu-id="f0381-157">Репликация слиянием поддерживает публикацию подмножеств данных с помощью параметризованных фильтров с одиночной публикацией.</span><span class="sxs-lookup"><span data-stu-id="f0381-157">Merge replication supports publishing subsets of data using parameterized filters with a single publication.</span></span> <span data-ttu-id="f0381-158">Дополнительные сведения см. в разделе [Параметризованные фильтры строк](../merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-158">For more information, see [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
    -   <span data-ttu-id="f0381-159">Репликация транзакций поддерживает публикацию подмножеств данных с помощью статических фильтров с несколькими публикациями.</span><span class="sxs-lookup"><span data-stu-id="f0381-159">Transactional replication supports publishing subsets of data using static filters with multiple publications.</span></span> <span data-ttu-id="f0381-160">Дополнительные сведения см. в статье [Фильтрация опубликованных данных](../publish/filter-published-data.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-160">For more information, see [Filter Published Data](../publish/filter-published-data.md).</span></span>  
  
-   <span data-ttu-id="f0381-161">Используйте фильтры обдуманно.</span><span class="sxs-lookup"><span data-stu-id="f0381-161">Use row filters judiciously.</span></span>  
  
     <span data-ttu-id="f0381-162">Когда публикация транзакций включает одну или более статей, использующих фильтры строк, агент чтения журнала должен применять фильтр к каждой строке, измененной обновлением таблицы, по мере сканирования журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="f0381-162">When a transactional publication includes one or more articles that use row filters, the Log Reader Agent must apply the filter to each row affected by an update to the table as it scans the transaction log.</span></span> <span data-ttu-id="f0381-163">Это влияет на производительность агента чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="f0381-163">The throughput of the Log Reader Agent is therefore affected.</span></span>  
  
     <span data-ttu-id="f0381-164">Аналогично репликация слиянием должна оценивать измененные или удаленные строки для определения тех подписчиков, которые должны получить эти строки.</span><span class="sxs-lookup"><span data-stu-id="f0381-164">Similarly, merge replication must evaluate changed or deleted rows to determine which Subscribers should receive those rows.</span></span> <span data-ttu-id="f0381-165">При использовании фильтров строк для уменьшения данных, востребованных на подписчике, следует учитывать, что эта обработка является более сложной и может потребовать больше времени, чем публикация всех строк таблицы.</span><span class="sxs-lookup"><span data-stu-id="f0381-165">When row filters are employed to reduce the data required at a Subscriber, this processing is more complex and can be slower than when you publish all rows in a table.</span></span> <span data-ttu-id="f0381-166">Рассмотрите возможность компромисса между сокращением требований к пространству для хранения на каждом подписчике и необходимостью достижения максимальной производительности.</span><span class="sxs-lookup"><span data-stu-id="f0381-166">Consider carefully the tradeoff between reduced storage requirements at each Subscriber and the need for achieving maximum throughput.</span></span> <span data-ttu-id="f0381-167">Дополнительные сведения о фильтрации см. в статье [Фильтрация опубликованных данных](../publish/filter-published-data.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-167">For more information on filtering, see [Filter Published Data](../publish/filter-published-data.md).</span></span>  
  
## <a name="subscription-considerations"></a><span data-ttu-id="f0381-168">Вопросы использования подписок</span><span class="sxs-lookup"><span data-stu-id="f0381-168">Subscription Considerations</span></span>  
  
-   <span data-ttu-id="f0381-169">Если имеется большое число подписчиков, используйте подписки по запросу.</span><span class="sxs-lookup"><span data-stu-id="f0381-169">Use pull subscriptions when there are a large number of Subscribers.</span></span>  
  
     <span data-ttu-id="f0381-170">Агент распространителя и агент слияния выполняются на распространителе для принудительных подписок и на подписчиках для подписок по запросу.</span><span class="sxs-lookup"><span data-stu-id="f0381-170">The Distribution Agent and Merge Agent run at the Distributor for push subscriptions, and at Subscribers for pull subscriptions.</span></span> <span data-ttu-id="f0381-171">Использование подписок по запросу может повысить производительность за счет перемещения процесса обработки агента с распространителя на подписчики.</span><span class="sxs-lookup"><span data-stu-id="f0381-171">Using pull subscriptions can improve performance by moving agent processing from the Distributor to Subscribers.</span></span> <span data-ttu-id="f0381-172">Дополнительные сведения см. в статье [Подписка на публикации](../subscribe-to-publications.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-172">For more information, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
-   <span data-ttu-id="f0381-173">Рассмотрите возможность повторной инициализации подписки, если данные у подписчиков чрезмерно устарели.</span><span class="sxs-lookup"><span data-stu-id="f0381-173">Consider reinitialization of the subscription if Subscribers are too far behind.</span></span>  
  
     <span data-ttu-id="f0381-174">При необходимости отправки подписчикам большого количества изменений их повторная инициализация с помощью нового моментального снимка может оказаться быстрее, чем применение репликации для перемещения отдельных изменений.</span><span class="sxs-lookup"><span data-stu-id="f0381-174">When large amounts of changes need to be sent to Subscribers, reinitializing them with a new snapshot might be faster than using replication to move the individual changes.</span></span> <span data-ttu-id="f0381-175">Дополнительные сведения см. в статье [Повторная инициализация подписок](../reinitialize-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-175">For more information, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
     <span data-ttu-id="f0381-176">Для репликации транзакций монитор репликации отображает на вкладке **Нераспределенные команды** информацию о количестве транзакций в базе данных распространителя, которые еще не были переданы на подписчик, и предполагаемое время, затрачиваемое на распространение этих транзакций.</span><span class="sxs-lookup"><span data-stu-id="f0381-176">For transactional replication, Replication Monitor displays on the **Undistributed Commands** tab information about: the number of transactions in the distribution database that have not yet been distributed to a Subscriber; and the estimated time for distributing these transactions.</span></span> <span data-ttu-id="f0381-177">Дополнительные сведения см. в статье [Просмотр сведений и выполнение задач с помощью монитора репликации](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-177">For more information, see [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
## <a name="snapshot-considerations"></a><span data-ttu-id="f0381-178">Вопросы использования моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="f0381-178">Snapshot Considerations</span></span>  
  
-   <span data-ttu-id="f0381-179">Запускайте агент моментальных снимков только в том случае, когда необходимо, и в периоды, когда отсутствует пиковая нагрузка.</span><span class="sxs-lookup"><span data-stu-id="f0381-179">Run the Snapshot Agent only when necessary and at off-peak times.</span></span>  
  
     <span data-ttu-id="f0381-180">Агент моментальных снимков выполняет массовое копирование данных из опубликованной таблицы издателя в файл каталога моментальных снимков на распространителе.</span><span class="sxs-lookup"><span data-stu-id="f0381-180">The Snapshot Agent bulk copies data from the published table on the Publisher to a file in the snapshot folder on the Distributor.</span></span> <span data-ttu-id="f0381-181">Создание моментального снимка может быть ресурсоемким процессом, и его лучше планировать на время отсутствия пиковой нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f0381-181">Generating a snapshot can be a resource intensive process and is best scheduled during off-peak times.</span></span>  
  
-   <span data-ttu-id="f0381-182">Если не требуется моментальный снимок в символьном формате, используйте моментальный снимок в собственном формате.</span><span class="sxs-lookup"><span data-stu-id="f0381-182">Use a native mode snapshot unless a character mode snapshot is required.</span></span>  
  
     <span data-ttu-id="f0381-183">Для всех подписчиков по умолчанию используется собственный формат моментального снимка, за исключением подписчиков, отличных от[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , и подписчиков, на которых выполняется [!INCLUDE[ssEW](../../../includes/ssew-md.md)]. Для них требуется моментальный снимок в символьном формате.</span><span class="sxs-lookup"><span data-stu-id="f0381-183">Use the default native mode snapshot for all Subscribers except non-[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Subscribers and Subscribers running [!INCLUDE[ssEW](../../../includes/ssew-md.md)], which require a character mode snapshot.</span></span>  
  
-   <span data-ttu-id="f0381-184">Используйте для публикации одну папку моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="f0381-184">Use a single snapshot folder for a publication.</span></span>  
  
     <span data-ttu-id="f0381-185">Определяя свойства публикации, связанные с расположением моментального снимка, можно выбрать создание файлов моментальных снимков в папке моментальных снимков по умолчанию, или в альтернативной папке моментальных снимков, или в обеих папках.</span><span class="sxs-lookup"><span data-stu-id="f0381-185">When specifying the publication properties related to snapshot location, you can choose to generate snapshot files to the default snapshot folder, to an alternate snapshot folder, or to both.</span></span> <span data-ttu-id="f0381-186">Создание файлов моментальных снимков в обеих папках требует дополнительного дискового пространства и большего объема обработки при работе агента моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="f0381-186">Generating snapshot files in both locations requires additional disk space and more processing when the Snapshot Agent runs.</span></span>  
  
-   <span data-ttu-id="f0381-187">Поместите папку моментальных снимков на диск, который является локальным для распространителя и не используется для хранения файлов баз данных или журналов.</span><span class="sxs-lookup"><span data-stu-id="f0381-187">Place the snapshot folder on a drive local to the Distributor that is not used to store database or log files.</span></span>  
  
     <span data-ttu-id="f0381-188">Агент моментальных снимков выполняет последовательную запись данных в папку моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="f0381-188">The Snapshot Agent performs a sequential write of data to the snapshot folder.</span></span> <span data-ttu-id="f0381-189">Размещение папки моментальных снимков на отдельном диске, где нет баз данных или файлов журнала, уменьшает вероятность конфликтов дисков и ускоряет процесс создания и записи моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="f0381-189">Placing the snapshot folder on a separate drive from any database or log files reduces contention among the disks and helps the snapshot process complete faster.</span></span>  
  
-   <span data-ttu-id="f0381-190">При создании базы данных подписки на подписчике рассмотрите возможность задания простой модели восстановления или модели восстановления с неполным протоколированием.</span><span class="sxs-lookup"><span data-stu-id="f0381-190">When you create the subscription database at the Subscriber, consider specifying a recovery model of simple or bulk-logged.</span></span> <span data-ttu-id="f0381-191">Это позволяет минимизировать запись в журнал массовых вставок, выполняемых во время применения моментального снимка на подписчике.</span><span class="sxs-lookup"><span data-stu-id="f0381-191">This allows minimal logging of the bulk inserts performed during the application of the snapshot at the Subscriber.</span></span> <span data-ttu-id="f0381-192">После того, как моментальный снимок применен к базе данных подписки, можно при необходимости включить другую модель восстановления (реплицированные базы данных могут использовать любую модель восстановления).</span><span class="sxs-lookup"><span data-stu-id="f0381-192">After the snapshot has been applied to the subscription database, you can change to a different recovery model if necessary (replicated databases can use any of the recovery models).</span></span> <span data-ttu-id="f0381-193">Дополнительные сведения о выборе модели восстановления см. в статье [Обзор процессов восстановления (SQL Server)](../../backup-restore/restore-and-recovery-overview-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-193">For more information about selecting a recovery model, see [Restore and Recovery Overview &#40;SQL Server&#41;](../../backup-restore/restore-and-recovery-overview-sql-server.md).</span></span>  
  
-   <span data-ttu-id="f0381-194">Рассмотрите возможность использования альтернативной папки моментальных снимков и хранения сжатых моментальных снимков на сменных носителях при работе в сетях с низкой пропускной способностью.</span><span class="sxs-lookup"><span data-stu-id="f0381-194">Consider using the alternate snapshot folder and compressed snapshots on removable media for low-bandwidth networks.</span></span>  
  
     <span data-ttu-id="f0381-195">Сжатие файлов моментальных снимков в альтернативной папке моментальных снимков может снизить требования к размеру места для хранения моментальных снимков на диске и облегчить перенос файлов моментальных снимков на сменных носителях.</span><span class="sxs-lookup"><span data-stu-id="f0381-195">Compressing snapshot files in the alternate snapshot folder can reduce snapshot disk storage requirements and make it easier to transfer snapshot files on removable media.</span></span>  
  
     <span data-ttu-id="f0381-196">В некоторых случаях сжатые моментальные снимки повышают производительность передачи файлов моментальных снимков по сети.</span><span class="sxs-lookup"><span data-stu-id="f0381-196">Compressed snapshots can, in some cases, improve the performance of transferring snapshot files across the network.</span></span> <span data-ttu-id="f0381-197">Однако сжатие моментального снимка требует дополнительной обработки, выполняемой агентом моментальных снимков при создании файлов моментальных снимков и агентом распространителя или агентом слияния при применении файлов моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="f0381-197">However, compressing the snapshot requires additional processing by the Snapshot Agent when generating the snapshot files, and by the Distribution Agent or Merge Agent when applying the snapshot files.</span></span> <span data-ttu-id="f0381-198">Это может замедлить создание моментального снимка и в некоторых случаях увеличить время, необходимое для применения моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="f0381-198">This may slow down snapshot generation and increase the time it takes to apply a snapshot in some cases.</span></span> <span data-ttu-id="f0381-199">Кроме того, сжатые моментальные снимки не могут быть возобновлены в случае сбоя в сети, поэтому они непригодны для ненадежных сетей.</span><span class="sxs-lookup"><span data-stu-id="f0381-199">Additionally, compressed snapshots cannot be resumed if a network failure occurs; therefore they are not suitable for unreliable networks.</span></span> <span data-ttu-id="f0381-200">Внимательно рассмотрите перечисленные достоинства и недостатки, если планируете применять сжатые моментальные снимки в сети.</span><span class="sxs-lookup"><span data-stu-id="f0381-200">Consider these tradeoffs carefully when using compressed snapshots across a network.</span></span> <span data-ttu-id="f0381-201">Дополнительные сведения см. в разделах [Alternate Snapshot Folder Locations](../alternate-snapshot-folder-locations.md) и [Compressed Snapshots](../compressed-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-201">For more information, see [Alternate Snapshot Folder Locations](../alternate-snapshot-folder-locations.md) and [Compressed Snapshots](../compressed-snapshots.md).</span></span>  
  
-   <span data-ttu-id="f0381-202">Рассмотрите возможность инициализации подписки вручную.</span><span class="sxs-lookup"><span data-stu-id="f0381-202">Consider initializing a subscription manually.</span></span>  
  
     <span data-ttu-id="f0381-203">В некоторых случаях, например при больших объемах начальных наборов данных, предпочтительнее инициализировать подписку методами, отличными от инициализации с помощью моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="f0381-203">In some scenarios, such as those involving large initial datasets, it is preferable to initialize a subscription using a method other than a snapshot.</span></span> <span data-ttu-id="f0381-204">Дополнительные сведения см. в статье [Инициализация подписки на публикацию транзакций без моментального снимка](../initialize-a-transactional-subscription-without-a-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-204">For more information, see [Initialize a Transactional Subscription Without a Snapshot](../initialize-a-transactional-subscription-without-a-snapshot.md).</span></span>  
  
## <a name="agent-parameters"></a><span data-ttu-id="f0381-205">Параметры агента</span><span class="sxs-lookup"><span data-stu-id="f0381-205">Agent Parameters</span></span>  
  
-   <span data-ttu-id="f0381-206">Уменьшите уровни детализации агентов репликации за исключением начального периода проверки, наблюдения или отладки.</span><span class="sxs-lookup"><span data-stu-id="f0381-206">Reduce the verbose levels of replication agents except during initial testing, monitoring, or debugging.</span></span>  
  
     <span data-ttu-id="f0381-207">Уменьшите значение параметра **-HistoryVerboseLevel** и параметра **-OutputVerboseLevel** для агентов распространителя или слияния.</span><span class="sxs-lookup"><span data-stu-id="f0381-207">Reduce the **-HistoryVerboseLevel** parameter and the **-OutputVerboseLevel** parameter of the Distribution Agents or Merge Agents.</span></span> <span data-ttu-id="f0381-208">Это сократит число новых строк, вставляемых для отслеживания действий агента и выходных данных.</span><span class="sxs-lookup"><span data-stu-id="f0381-208">This reduces the number of new rows inserted to track agent history and output.</span></span> <span data-ttu-id="f0381-209">Вместо этого предыдущие журнальные сообщения с тем же статусом будут обновляться новой информацией.</span><span class="sxs-lookup"><span data-stu-id="f0381-209">Instead, previous history messages with the same status are updated to the new history information.</span></span> <span data-ttu-id="f0381-210">Увеличьте уровень детализации для проверки, наблюдения и отладки, чтобы получить как можно больше информации о деятельности агента.</span><span class="sxs-lookup"><span data-stu-id="f0381-210">Increase the verbose levels for testing, monitoring, and debugging so that you have as much information about agent activity as possible.</span></span>  
  
-   <span data-ttu-id="f0381-211">Используйте параметр **-MaxBCPThreads** агентов моментальных снимков, слияния и распространения (количество указанных потоков не должно превышать количество процессоров компьютера).</span><span class="sxs-lookup"><span data-stu-id="f0381-211">Use the **-MaxBCPThreads** parameter of the Snapshot Agent, Merge Agent, and Distribution Agent (the number of threads specified should not exceed the number of processors on the computer).</span></span> <span data-ttu-id="f0381-212">Этот параметр определяет количество операций массового копирования, которые могут выполняться одновременно при создании и применении моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="f0381-212">This parameter specifies the number of bulk copy operations that can be performed in parallel when the snapshot is created and applied.</span></span>  
  
-   <span data-ttu-id="f0381-213">Используйте параметр **-UseInprocLoader** агентов распространения и слияния (этот параметр не может быть использован, если опубликованные таблицы содержат XML-столбцы).</span><span class="sxs-lookup"><span data-stu-id="f0381-213">Use the **-UseInprocLoader** parameter of the Distribution Agent and the Merge Agent (this parameter cannot be used if published tables include XML columns).</span></span> <span data-ttu-id="f0381-214">Этот параметр вызывает использование агентом команды BULK INSERT при применении моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="f0381-214">This parameter causes the agent to use the BULK INSERT command when the snapshot is applied.</span></span>  
  
 <span data-ttu-id="f0381-215">Параметры агента могут задаваться в профилях агента или в командной строке.</span><span class="sxs-lookup"><span data-stu-id="f0381-215">Agent parameters can be specified in agent profiles and on the command line.</span></span> <span data-ttu-id="f0381-216">Дополнительные сведения см. в разделе:</span><span class="sxs-lookup"><span data-stu-id="f0381-216">For more information, see:</span></span>  
  
-   [<span data-ttu-id="f0381-217">Работа с профилями агента репликации</span><span class="sxs-lookup"><span data-stu-id="f0381-217">Work with Replication Agent Profiles</span></span>](../agents/work-with-replication-agent-profiles.md)  
  
-   [<span data-ttu-id="f0381-218">Просмотр и изменение параметров командной строки агента репликации (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="f0381-218">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
-   <span data-ttu-id="f0381-219">[Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="f0381-219">[Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
  
