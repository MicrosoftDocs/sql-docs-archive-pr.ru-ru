---
title: Повышение производительности репликации транзакций | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], design and performance
- performance [SQL Server replication], transactional replication
- designing databases [SQL Server], replication performance
- performance [SQL Server replication], snapshot replication
- snapshot replication [SQL Server], performance
- subscriptions [SQL Server replication], performance considerations
- agents [SQL Server replication], performance
- Distribution Agent, performance
- transactional replication, performance
- Log Reader Agent, performance
ms.assetid: 67084a67-43ff-4065-987a-3b16d1841565
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: fe802796b129ff9bdb50e5dea13e1fe98beee269
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750771"
---
# <a name="enhance-transactional-replication-performance"></a><span data-ttu-id="b675d-102">Повышение производительности репликации транзакций</span><span class="sxs-lookup"><span data-stu-id="b675d-102">Enhance Transactional Replication Performance</span></span>
  <span data-ttu-id="b675d-103">После рассмотрения общих рекомендаций в отношении производительности, описываемых в разделе [Повышение общей производительности репликации](enhance-general-replication-performance.md), необходимо проанализировать следующие дополнительные области, относящиеся к репликации транзакций.</span><span class="sxs-lookup"><span data-stu-id="b675d-103">After considering the general performance tips described in [Enhancing General Replication Performance](enhance-general-replication-performance.md), consider these additional areas specific to transactional replication.</span></span>  
  
## <a name="database-design"></a><span data-ttu-id="b675d-104">Структура базы данных</span><span class="sxs-lookup"><span data-stu-id="b675d-104">Database Design</span></span>  
  
-   <span data-ttu-id="b675d-105">Минимизируйте размер транзакций в структуре приложения.</span><span class="sxs-lookup"><span data-stu-id="b675d-105">Minimize transaction size in your application design.</span></span>  
  
     <span data-ttu-id="b675d-106">По умолчанию репликация транзакций распространяет изменения в соответствии с границами транзакций.</span><span class="sxs-lookup"><span data-stu-id="b675d-106">By default, transactional replication propagates changes according to transaction boundaries.</span></span> <span data-ttu-id="b675d-107">Если транзакции имеют небольшой размер, то маловероятно, что агенту распространителя придется повторно пересылать транзакцию вследствие перебоев в сети.</span><span class="sxs-lookup"><span data-stu-id="b675d-107">If transactions are smaller, it is less likely that the Distribution Agent will have to resend a transaction due to network issues.</span></span> <span data-ttu-id="b675d-108">Если агенту потребуется переслать транзакцию, то количество отсылаемых данных будет меньшим.</span><span class="sxs-lookup"><span data-stu-id="b675d-108">If the agent is required to resend a transaction, the amount of data sent is smaller.</span></span>  
  
## <a name="distributor-configuration"></a><span data-ttu-id="b675d-109">Настройка распространителя</span><span class="sxs-lookup"><span data-stu-id="b675d-109">Distributor Configuration</span></span>  
  
-   <span data-ttu-id="b675d-110">Настройте распространитель на выделенном сервере.</span><span class="sxs-lookup"><span data-stu-id="b675d-110">Configure the Distributor on a dedicated server.</span></span>  
  
     <span data-ttu-id="b675d-111">Нагрузку, связанную с обработкой на издателе, можно снизить, настроив удаленный распространитель.</span><span class="sxs-lookup"><span data-stu-id="b675d-111">You can reduce processing overhead on the Publisher by configuring a remote Distributor.</span></span> <span data-ttu-id="b675d-112">Дополнительные сведения см. в разделе [Configure Distribution](../configure-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="b675d-112">For more information, see [Configure Distribution](../configure-distribution.md).</span></span>  
  
-   <span data-ttu-id="b675d-113">Установите надлежащий размер для базы данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="b675d-113">Size the distribution database appropriately.</span></span>  
  
     <span data-ttu-id="b675d-114">Проверьте репликацию с типовой нагрузкой системы, чтобы определить пространство, необходимое для хранения команд.</span><span class="sxs-lookup"><span data-stu-id="b675d-114">Test replication with a typical load for your system to determine how much space is required to store commands.</span></span> <span data-ttu-id="b675d-115">Убедитесь в том, что база данных имеет достаточный размер для хранения команд без частого автоматического увеличения размера.</span><span class="sxs-lookup"><span data-stu-id="b675d-115">Ensure the database is large enough to store commands without having to auto-grow frequently.</span></span> <span data-ttu-id="b675d-116">Дополнительные сведения об изменении размера базы данных см. в разделе [ALTER DATABASE (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b675d-116">For more information about changing the size of a database, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
## <a name="publication-design"></a><span data-ttu-id="b675d-117">Разработка публикации</span><span class="sxs-lookup"><span data-stu-id="b675d-117">Publication Design</span></span>  
  
-   <span data-ttu-id="b675d-118">Реплицируйте выполнение хранимых процедур при выполнении пакетных обновлений опубликованных таблиц.</span><span class="sxs-lookup"><span data-stu-id="b675d-118">Replicate stored procedure execution when making batch updates to published tables.</span></span>  
  
     <span data-ttu-id="b675d-119">При наличии пакетов обновлений, которые эпизодически воздействуют на большое количество строк на подписчике, следует рассмотреть возможность обновления опубликованной таблицы с использованием хранимой процедуры и опубликовать результаты выполнения этой хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="b675d-119">If you have batch updates that occasionally affect a large number of rows at the Subscriber, you should consider updating the published table using a stored procedure and publish the execution of the stored procedure.</span></span> <span data-ttu-id="b675d-120">Вместо отправки обновления или удаления для каждой изменяемой строки агент распространителя выполняет эту процедуру на подписчике с теми же значениями параметров.</span><span class="sxs-lookup"><span data-stu-id="b675d-120">Instead of sending an update or delete for every row affected, the Distribution Agent executes the same procedure at the Subscriber with the same parameter values.</span></span> <span data-ttu-id="b675d-121">Дополнительные сведения см. в статье [Publishing Stored Procedure Execution in Transactional Replication](../transactional/publishing-stored-procedure-execution-in-transactional-replication.md).</span><span class="sxs-lookup"><span data-stu-id="b675d-121">For more information, see [Publishing Stored Procedure Execution in Transactional Replication](../transactional/publishing-stored-procedure-execution-in-transactional-replication.md).</span></span>  
  
-   <span data-ttu-id="b675d-122">Распределение статей по нескольким публикациям.</span><span class="sxs-lookup"><span data-stu-id="b675d-122">Spread articles across multiple publications.</span></span>  
  
     <span data-ttu-id="b675d-123">Если невозможно использовать параметр **-SubscriptionStreams** (описываемый далее в данном разделе), необходимо рассмотреть возможность создания нескольких публикаций.</span><span class="sxs-lookup"><span data-stu-id="b675d-123">If you cannot use the **-SubscriptionStreams** parameter (described later in this topic), consider creating multiple publications.</span></span> <span data-ttu-id="b675d-124">Распределение статей между этими публикациями позволяет репликации параллельно применять изменения на подписчиках.</span><span class="sxs-lookup"><span data-stu-id="b675d-124">Spreading articles across these publications allows replication to apply changes in parallel to Subscribers.</span></span>  
  
## <a name="subscription-considerations"></a><span data-ttu-id="b675d-125">Вопросы использования подписок</span><span class="sxs-lookup"><span data-stu-id="b675d-125">Subscription Considerations</span></span>  
  
-   <span data-ttu-id="b675d-126">Если на одном и том же издателе имеется несколько публикаций, используйте независимые агенты вместо общих агентов (эта конфигурация устанавливается по умолчанию в мастере создания публикаций).</span><span class="sxs-lookup"><span data-stu-id="b675d-126">Use independent agents rather than shared agents if you have multiple publications on the same Publisher (this is the default for the New Publication Wizard).</span></span>  
  
-   <span data-ttu-id="b675d-127">Выполняйте агенты в непрерывном режиме вместо запуска по часто повторяющимся расписаниям.</span><span class="sxs-lookup"><span data-stu-id="b675d-127">Run agents continuously instead of on very frequent schedules.</span></span>  
  
     <span data-ttu-id="b675d-128">Настройка агентов на непрерывное выполнение вместо создания часто выполняемых расписаний (например, ежеминутных) позволяет повысить производительность репликации за счет экономии времени на запусках и остановках агента.</span><span class="sxs-lookup"><span data-stu-id="b675d-128">Setting the agents to run continuously rather than creating frequent schedules (such as every minute) improves replication performance, because the agent does not have to start and stop.</span></span> <span data-ttu-id="b675d-129">Если агент распространителя настроен на непрерывную работу, изменения пересылаются на другие серверы, соединенные в топологии, с малой задержкой.</span><span class="sxs-lookup"><span data-stu-id="b675d-129">When you set the Distribution Agent to run continuously, changes are propagated with low latency to the other servers that are connected in the topology.</span></span> <span data-ttu-id="b675d-130">Дополнительные сведения см. в разделе:</span><span class="sxs-lookup"><span data-stu-id="b675d-130">For more information, see:</span></span>  
  
    -   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="b675d-131">: [Указание расписаний синхронизации](../specify-synchronization-schedules.md)</span><span class="sxs-lookup"><span data-stu-id="b675d-131">: [Specify Synchronization Schedules](../specify-synchronization-schedules.md)</span></span>  
  
## <a name="distribution-agent-and-log-reader-agent-parameters"></a><span data-ttu-id="b675d-132">Параметры агента распространителя и агента чтения журнала</span><span class="sxs-lookup"><span data-stu-id="b675d-132">Distribution Agent and Log Reader Agent Parameters</span></span>  
  
-   <span data-ttu-id="b675d-133">Чтобы устранить случайную неоднократную узкие места, используйте параметр **-MaxCmdsInTran** для агент чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="b675d-133">To resolve accidental, one-time bottlenecks use the **-MaxCmdsInTran** parameter for the Log Reader Agent.</span></span>  
  
     <span data-ttu-id="b675d-134">Параметр **-MaxCmdsInTran** указывает максимальное количество инструкций, сгруппированных в транзакцию, когда читатель журнала записывает команды в базу данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="b675d-134">The **-MaxCmdsInTran** parameter specifies the maximum number of statements grouped into a transaction as the Log Reader writes commands to the distribution database.</span></span> <span data-ttu-id="b675d-135">Использование этого параметра позволяет агенту чтения журнала и агенту распространителя разделять большие транзакции (состоящие из множества команд) на издателе на несколько меньших транзакций при применении команд на подписчике.</span><span class="sxs-lookup"><span data-stu-id="b675d-135">Using this parameter allows the Log Reader Agent and Distribution Agent to divide large transactions (consisting of many commands) at the Publisher into several smaller transactions when applying commands at the Subscriber.</span></span> <span data-ttu-id="b675d-136">Задание этого параметра может снизить вероятность состязаний на распространителе и уменьшить задержку при передаче данных между издателем и подписчиком.</span><span class="sxs-lookup"><span data-stu-id="b675d-136">Specifying this parameter can reduce contention at the Distributor and reduce latency between the Publisher and Subscriber.</span></span> <span data-ttu-id="b675d-137">Поскольку исходная транзакция применяется меньшими по размеру блоками, подписчик может получить доступ к строкам большой логической транзакции издателя до завершения исходной транзакции, разбивая строгую атомарность транзакции.</span><span class="sxs-lookup"><span data-stu-id="b675d-137">Because the original transaction is applied in smaller units, the Subscriber can access rows of a large logical Publisher transaction prior to the end of the original transaction, breaking strict transactional atomicity.</span></span> <span data-ttu-id="b675d-138">По умолчанию установлено значение **0**, сохраняющее границы транзакции издателя.</span><span class="sxs-lookup"><span data-stu-id="b675d-138">The default is **0**, which preserves the transaction boundaries of the Publisher.</span></span> <span data-ttu-id="b675d-139">Этот параметр не применим для издателей Oracle.</span><span class="sxs-lookup"><span data-stu-id="b675d-139">This parameter does not apply to Oracle Publishers.</span></span>  
  
    > [!WARNING]  
    >  <span data-ttu-id="b675d-140">Параметр `MaxCmdsInTran` не предназначен для постоянного использования.</span><span class="sxs-lookup"><span data-stu-id="b675d-140">`MaxCmdsInTran` was not designed to be always turned on.</span></span> <span data-ttu-id="b675d-141">Он существует для разрешения ситуаций, в которых случайно было запущено большое количество операций DML в рамках одной транзакции (из-за чего возникают задержки при распределении команд до тех пор, пока вся транзакция не будет находиться в базе данных распространителя, поскольку удерживаются блокировки и т. д.).</span><span class="sxs-lookup"><span data-stu-id="b675d-141">It exists to work around cases where someone accidentally performed a large number of DML operations in a single transaction (causing delay in distribution of commands until the entire transaction is in distribution database, locks being held, etc.).</span></span> <span data-ttu-id="b675d-142">Если такая ситуация возникает регулярно, следует проанализировать приложения и найти пути уменьшения размера транзакции.</span><span class="sxs-lookup"><span data-stu-id="b675d-142">If you routinely fall into this situation, you should review your applications and find ways to reduce the transaction size.</span></span>  
  
-   <span data-ttu-id="b675d-143">Используйте параметр **-SubscriptionStreams** для агент распространения.</span><span class="sxs-lookup"><span data-stu-id="b675d-143">Use the **-SubscriptionStreams** parameter for the Distribution Agent.</span></span>  
  
     <span data-ttu-id="b675d-144">Параметр **-SubscriptionStreams** может значительно увеличить общую пропускную способность репликации.</span><span class="sxs-lookup"><span data-stu-id="b675d-144">The **-SubscriptionStreams** parameter can greatly improve aggregate replication throughput.</span></span> <span data-ttu-id="b675d-145">Он позволяет нескольким соединениям с подписчиком параллельно применять пакеты изменений, при этом сохраняя многие свойства транзакций, характерные для использования одиночного потока.</span><span class="sxs-lookup"><span data-stu-id="b675d-145">It allows multiple connections to a Subscriber to apply batches of changes in parallel, while maintaining many of the transactional characteristics present when using a single thread.</span></span> <span data-ttu-id="b675d-146">Если одному из соединений не удается осуществить выполнение или фиксацию, все подключения прекратят выполнение текущего пакета, и агент будет использовать одиночный поток для повторных попыток выполнения поврежденных пакетов.</span><span class="sxs-lookup"><span data-stu-id="b675d-146">If one of the connections fails to execute or commit, all connections will abort the current batch, and the agent will use a single stream to retry the failed batches.</span></span> <span data-ttu-id="b675d-147">Перед завершением фазы выполнения повторной попытки могут существовать временные несоответствия транзакций на подписчике.</span><span class="sxs-lookup"><span data-stu-id="b675d-147">Before this retry phase completes, there can be temporary transactional inconsistencies at the Subscriber.</span></span> <span data-ttu-id="b675d-148">После успешной фиксации всех поврежденных пакетов подписчик возвращается в состояние согласованности транзакций.</span><span class="sxs-lookup"><span data-stu-id="b675d-148">After the failed batches are successfully committed, the Subscriber is brought back to a state of transactional consistency.</span></span>  
  
     <span data-ttu-id="b675d-149">Значение для этого параметра агента можно указать с помощью \*\* \@ subscriptionstreams\*\* [SP_ADDSUBSCRIPTION &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b675d-149">A value for this agent parameter can be specified using the **\@subscriptionstreams** of [sp_addsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span></span>  
  
-   <span data-ttu-id="b675d-150">Увеличьте значение параметра **-ReadBatchSize** для агента чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="b675d-150">Increase the value of the **-ReadBatchSize** parameter for the Log Reader Agent.</span></span>  
  
     <span data-ttu-id="b675d-151">Агент чтения журнала и агент распространителя поддерживают разные размеры пакетов для операций чтения и фиксации транзакций.</span><span class="sxs-lookup"><span data-stu-id="b675d-151">The Log Reader Agent and Distribution Agent support batch sizes for transaction read and commit operations.</span></span> <span data-ttu-id="b675d-152">По умолчанию размер пакетов составляет 500 транзакций.</span><span class="sxs-lookup"><span data-stu-id="b675d-152">Batch sizes default to 500 transactions.</span></span> <span data-ttu-id="b675d-153">Агент чтения журнала считывает заданное количество транзакций из журнала независимо от того, отмечены они для репликации или нет.</span><span class="sxs-lookup"><span data-stu-id="b675d-153">The Log Reader Agent reads the specific number of transactions from the log, whether or not they are marked for replication.</span></span> <span data-ttu-id="b675d-154">Когда в базу данных публикации записано большое количество транзакций и только небольшое подмножество этих транзакций помечено для репликации, следует использовать параметр **-ReadBatchSize** для увеличения размера пакета, считываемого агентом чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="b675d-154">When a large number of transactions is written to a publication database, but only a small subset of those are marked for replication, you should use the **-ReadBatchSize** parameter to increase the read batch size of the Log Reader Agent.</span></span> <span data-ttu-id="b675d-155">Этот параметр не применим для издателей Oracle.</span><span class="sxs-lookup"><span data-stu-id="b675d-155">This parameter does not apply to Oracle Publishers.</span></span>  
  
-   <span data-ttu-id="b675d-156">Увеличьте значение параметра **-CommitBatchSize** для агента распространителя.</span><span class="sxs-lookup"><span data-stu-id="b675d-156">Increase the value of the **-CommitBatchSize** parameter for the Distribution Agent.</span></span>  
  
     <span data-ttu-id="b675d-157">Фиксация набора транзакций требует постоянного объема служебных операций. При выполнении менее частых фиксаций большего количества транзакций постоянный объем служебных операций приходится на больший объем данных.</span><span class="sxs-lookup"><span data-stu-id="b675d-157">Committing a set of transactions has a fixed overhead; by committing a larger number of transactions less frequently, the overhead is spread across a larger volume of data.</span></span> <span data-ttu-id="b675d-158">Однако выгода от увеличения значения этого параметра невелика, поскольку затраты на применение изменений управляются другими факторами, например максимальной пропускной способностью системы ввода-вывода диска, на котором хранится журнал.</span><span class="sxs-lookup"><span data-stu-id="b675d-158">However, the benefit of increasing this parameter drops off as the cost of applying changes is gated by other factors, such as the maximum I/O of the disk that contains the log.</span></span> <span data-ttu-id="b675d-159">Кроме того, необходимо найти баланс между преимуществами и недостатками: в случае любого сбоя, приводящего к перезапуску агента распространителя, необходимо выполнить откат и повторное применение большого количества транзакций.</span><span class="sxs-lookup"><span data-stu-id="b675d-159">Additionally, there is a trade off to be considered: any failure that causes the Distribution Agent to start over must rollback and reapply a larger number of transactions.</span></span> <span data-ttu-id="b675d-160">В сетях с низкой надежностью более низкое значение параметра может уменьшить количество сбоев и число транзакций, для которых необходимо выполнить откат и повторное применение в случае сбоя.</span><span class="sxs-lookup"><span data-stu-id="b675d-160">For unreliable networks, a lower value can result in less failures and a smaller number of transactions to rollback and reapply if a failure occurs.</span></span>  
  
-   <span data-ttu-id="b675d-161">Уменьшите значение параметра **-PollingInterval** для агента чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="b675d-161">Decrease the value of the **-PollingInterval** parameter for the Log Reader Agent.</span></span>  
  
     <span data-ttu-id="b675d-162">Параметр **-PollingInterval** задает частоту опроса журнала транзакций опубликованной базы данных для определения транзакций, подлежащих репликации.</span><span class="sxs-lookup"><span data-stu-id="b675d-162">The **-PollingInterval** parameter specifies how often the transaction log of a published database is queried for transactions to replicate.</span></span> <span data-ttu-id="b675d-163">Значение по умолчанию — 5 секунд.</span><span class="sxs-lookup"><span data-stu-id="b675d-163">The default is 5 seconds.</span></span> <span data-ttu-id="b675d-164">При уменьшении этого значения журнал опрашивается чаще, что может привести к меньшей задержке доставки транзакций из базы данных публикации в базу данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="b675d-164">If you decrease this value, the log is polled more frequently, which can result in lower latency for the delivery of transactions from the publication database to the distribution database.</span></span> <span data-ttu-id="b675d-165">Однако необходимо найти баланс между уменьшением задержки и ростом нагрузки на сервер с увеличением частоты опросов.</span><span class="sxs-lookup"><span data-stu-id="b675d-165">However, you should balance the need for lower latency against the increased load on the server from polling more frequently.</span></span>  
  
 <span data-ttu-id="b675d-166">Параметры агента могут задаваться в профилях агента или в командной строке.</span><span class="sxs-lookup"><span data-stu-id="b675d-166">Agent parameters can be specified in agent profiles and on the command line.</span></span> <span data-ttu-id="b675d-167">Дополнительные сведения см. в разделе:</span><span class="sxs-lookup"><span data-stu-id="b675d-167">For more information, see:</span></span>  
  
-   [<span data-ttu-id="b675d-168">Работа с профилями агента репликации</span><span class="sxs-lookup"><span data-stu-id="b675d-168">Work with Replication Agent Profiles</span></span>](../agents/replication-agent-profiles.md)  
  
-   [<span data-ttu-id="b675d-169">Просмотр и изменение параметров командной строки агента репликации (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="b675d-169">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
-   [<span data-ttu-id="b675d-170">Replication Agent Executables Concepts</span><span class="sxs-lookup"><span data-stu-id="b675d-170">Replication Agent Executables Concepts</span></span>](../concepts/replication-agent-executables-concepts.md)  
  
  
