---
title: Стратегии резервного копирования и восстановления из копии репликации моментальных снимков и репликации транзакций | Документация Майкрософт
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- backups [SQL Server replication], snapshot replication
- restoring [SQL Server replication], transactional replication
- snapshot replication [SQL Server], backup and restore
- restoring [SQL Server replication], snapshot replication
- recovery [SQL Server replication], transactional replication
- transactional replication, backup and restore
- recovery [SQL Server replication], snapshot replication
- sync with backup [SQL Server replication]
- backups [SQL Server replication], transactional replication
ms.assetid: a8afcdbc-55db-4916-a219-19454f561f9e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e26f6cf1a61e4df9db79bc5fd90429f86d70a99f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669398"
---
# <a name="strategies-for-backing-up-and-restoring-snapshot-and-transactional-replication"></a><span data-ttu-id="08658-102">Стратегии резервного копирования и восстановления из копии репликации моментальных снимков и репликации транзакций</span><span class="sxs-lookup"><span data-stu-id="08658-102">Strategies for Backing Up and Restoring Snapshot and Transactional Replication</span></span>
  <span data-ttu-id="08658-103">При разработке стратегии резервного копирования и восстановления для репликации моментальных снимков и репликации транзакций необходимо учитывать три аспекта.</span><span class="sxs-lookup"><span data-stu-id="08658-103">When you design a backup and restore strategy for snapshot and transactional replication, there are three areas to consider:</span></span>  
  
-   <span data-ttu-id="08658-104">Какие базы данных будут подвергаться резервному копированию.</span><span class="sxs-lookup"><span data-stu-id="08658-104">Which databases to back up.</span></span>  
  
-   <span data-ttu-id="08658-105">Настройки резервного копирования для репликации транзакций.</span><span class="sxs-lookup"><span data-stu-id="08658-105">Backup settings for transactional replication.</span></span>  
  
-   <span data-ttu-id="08658-106">Шаги, необходимые для восстановления базы данных.</span><span class="sxs-lookup"><span data-stu-id="08658-106">The steps that are required to restore a database.</span></span> <span data-ttu-id="08658-107">Они зависят от типа репликации и выбранных параметров.</span><span class="sxs-lookup"><span data-stu-id="08658-107">These depend on the type of replication and options chosen.</span></span>  
  
 <span data-ttu-id="08658-108">Эта тема охватывает данные группы вопросов в следующих трех разделах.</span><span class="sxs-lookup"><span data-stu-id="08658-108">This topic covers each of these areas in the next three sections.</span></span> <span data-ttu-id="08658-109">Сведения о резервном копировании и восстановлении для публикации Oracle см. в статье [Резервное копирование и восстановление для издателей Oracle](../non-sql/backup-and-restore-for-oracle-publishers.md).</span><span class="sxs-lookup"><span data-stu-id="08658-109">For information about backup and restore for Oracle publishing, see [Backup and Restore for Oracle Publishers](../non-sql/backup-and-restore-for-oracle-publishers.md).</span></span>  
  
## <a name="backing-up-databases"></a><span data-ttu-id="08658-110">Резервное копирование баз данных</span><span class="sxs-lookup"><span data-stu-id="08658-110">Backing up Databases</span></span>  
 <span data-ttu-id="08658-111">Для репликации моментальных снимков и репликации транзакций необходимо регулярно выполнять резервное копирование следующих баз данных:</span><span class="sxs-lookup"><span data-stu-id="08658-111">For snapshot and transactional replication, you should regularly back up the following databases:</span></span>  
  
-   <span data-ttu-id="08658-112">База данных публикации на издателе.</span><span class="sxs-lookup"><span data-stu-id="08658-112">The publication database at the Publisher.</span></span>  
  
-   <span data-ttu-id="08658-113">База данных распространителя на распространителе.</span><span class="sxs-lookup"><span data-stu-id="08658-113">The distribution database at the Distributor.</span></span>  
  
-   <span data-ttu-id="08658-114">База данных подписки на подписчике.</span><span class="sxs-lookup"><span data-stu-id="08658-114">The subscription database at each Subscriber.</span></span>  
  
-   <span data-ttu-id="08658-115">Системные базы данных **master** и **msdb** на издателе, распространителе и на всех подписчиках.</span><span class="sxs-lookup"><span data-stu-id="08658-115">The **master** and **msdb** system databases at the Publisher, Distributor and all Subscribers.</span></span> <span data-ttu-id="08658-116">Резервные копии этих баз данных и копия соответствующей базы данных репликации должны быть сделаны одновременно.</span><span class="sxs-lookup"><span data-stu-id="08658-116">These databases should be backed up at the same time as each other and the relevant replication database.</span></span> <span data-ttu-id="08658-117">Например, создайте резервную копию баз данных **master** и **msdb** на издателе одновременно с резервной копией базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="08658-117">For example, back up the **master** and **msdb** databases at the Publisher at the same time that you back up the publication database.</span></span> <span data-ttu-id="08658-118">Если база данных публикации восстановлена, убедитесь, что базы данных **master** и **msdb** согласованы с базой данных публикации по параметрам и конфигурации репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-118">If the publication database is restored, make sure that the **master** and **msdb** databases are consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
 <span data-ttu-id="08658-119">Если резервное копирование журналов выполняется регулярно, любые изменения, касающиеся репликации, будут заноситься в резервные копии журнала.</span><span class="sxs-lookup"><span data-stu-id="08658-119">If you perform regular log backups, any replication-related changes should be captured in the log backups.</span></span> <span data-ttu-id="08658-120">Если не выполняется резервное копирование журналов, то необходимо выполнить это резервное копирование при каждом изменении настройки, относящейся к репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-120">If you do not perform log backups, a backup should be performed whenever a setting relevant to replication is changed.</span></span> <span data-ttu-id="08658-121">Дополнительные сведения см. в статье [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span><span class="sxs-lookup"><span data-stu-id="08658-121">For more information, see [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span></span>  
  
## <a name="backup-settings-for-transactional-replication"></a><span data-ttu-id="08658-122">Настройки резервного копирования для репликации транзакций</span><span class="sxs-lookup"><span data-stu-id="08658-122">Backup Settings for Transactional Replication</span></span>  
 <span data-ttu-id="08658-123">Репликация транзакций включает параметр **sync with backup** , который может быть установлен для базы данных распространителя и для базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="08658-123">Transactional replication includes using the **sync with backup** option, which can be set on the distribution database and the publication database:</span></span>  
  
-   <span data-ttu-id="08658-124">Рекомендуется устанавливать этот параметр в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-124">We recommend that you always set this option on the distribution database.</span></span>  
  
     <span data-ttu-id="08658-125">Установка этого параметра для базы данных распространителя гарантирует, что транзакции в журнале базы данных публикации не будут усечены до тех пор, пока не будет создана их резервная копия в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-125">Setting this option on the distribution database ensures that transactions in the log of the publication database will not be truncated until they have been backed up at the distribution database.</span></span> <span data-ttu-id="08658-126">Базу данных распространителя можно восстановить до последней резервной копии, а все потерянные транзакции будут доставлены из базы данных публикации в базу данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-126">The distribution database can be restored to the last backup, and any missing transactions are delivered from the publication database to the distribution database.</span></span> <span data-ttu-id="08658-127">Репликация не затрагивается.</span><span class="sxs-lookup"><span data-stu-id="08658-127">Replication continues unaffected.</span></span>  
  
     <span data-ttu-id="08658-128">Установка этого параметра для базы данных распространителя не влияет на задержку репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-128">Setting this option on the distribution database does not affect replication latency.</span></span> <span data-ttu-id="08658-129">Тем не менее этот параметр откладывает усечение журнала в базе данных публикации до того момента, пока не завершится резервное копирование соответствующих транзакций в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-129">However, the option will delay the truncation of the log on the publication database until the corresponding transactions in the distribution database have been backed up.</span></span> <span data-ttu-id="08658-130">(Это может привести к увеличению размера журнала транзакций в базе данных публикации.)</span><span class="sxs-lookup"><span data-stu-id="08658-130">(This can create a larger transaction log in the publication database.)</span></span>  
  
-   <span data-ttu-id="08658-131">Рекомендуется установить этот параметр для базы данных публикации, если приложение допускает дополнительную задержку.</span><span class="sxs-lookup"><span data-stu-id="08658-131">We recommend that you set this option on the publication database if your application can tolerate additional latency.</span></span>  
  
     <span data-ttu-id="08658-132">Установка этого параметра для базы данных публикации гарантирует, что транзакции не будут доставлены в базу данных распространителя до тех пор, пока не будет создана их резервная копия в базе данных публикации.</span><span class="sxs-lookup"><span data-stu-id="08658-132">Setting this option on the publication database ensures that transactions are not delivered to the distribution database until they are backed up at the publication database.</span></span> <span data-ttu-id="08658-133">Последняя резервная копия базы данных публикации может быть затем восстановлена на издателе, при этом в базе данных распространителя не будет транзакций, которых нет в восстановленной базе данных публикации.</span><span class="sxs-lookup"><span data-stu-id="08658-133">The last publication database backup can then be restored at the Publisher without any chance of the distribution database having transactions that the restored publication database does not have.</span></span>  
  
     <span data-ttu-id="08658-134">Задержка и пропускная способность изменяются, так как транзакции не могут быть доставлены в базу данных распространителя до тех пор, пока не будут созданы их резервные копии на издателе.</span><span class="sxs-lookup"><span data-stu-id="08658-134">Latency and throughput are affected because transactions cannot be delivered to the distribution database until they have been backed up at the Publisher.</span></span> <span data-ttu-id="08658-135">Например, если резервная копия журнала транзакций создается каждые пять минут, потребуются дополнительные пять минут задержки между фиксацией транзакции на издателе и доставкой транзакции сначала в базу данных распространителя, а затем подписчику.</span><span class="sxs-lookup"><span data-stu-id="08658-135">For example, if the transaction log is backed up every five minutes, there is an additional five minutes of latency between when a transaction is committed at the Publisher and when the transaction is delivered to the distribution database, and subsequently the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="08658-136">Параметр **sync with backup** обеспечивает согласованность базы данных публикации и базы данных распространителя, но он не гарантирует отсутствия потерь данных.</span><span class="sxs-lookup"><span data-stu-id="08658-136">The **sync with backup** option ensures consistency between the publication database and the distribution database, but the option does not guarantee against data loss.</span></span> <span data-ttu-id="08658-137">Например, если журнал транзакций потерян, транзакции, зафиксированные после последнего резервного копирования журнала транзакций, не будут доступны в базе данных публикации или базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-137">For example, if the transaction log is lost, transactions that have been committed since the last transaction log backup will not be available in the publication database or the distribution database.</span></span> <span data-ttu-id="08658-138">Точно так же ведет себя нереплицируемая база данных.</span><span class="sxs-lookup"><span data-stu-id="08658-138">This is the same behavior as a nonreplicated database.</span></span>  
  
 <span data-ttu-id="08658-139">**Установка параметра «sync with backup»**</span><span class="sxs-lookup"><span data-stu-id="08658-139">**To set the sync with backup option**</span></span>  
  
-   <span data-ttu-id="08658-140">Программирование репликации на языке [!INCLUDE[tsql](../../../includes/tsql-md.md)]: [Enable Coordinated Backups for Transactional Replication](enable-coordinated-backups-for-transactional-replication.md) (Включение скоординированной архивации для репликации транзакций)</span><span class="sxs-lookup"><span data-stu-id="08658-140">Replication [!INCLUDE[tsql](../../../includes/tsql-md.md)] programming: [Enable Coordinated Backups for Transactional Replication &#40;Replication Transact-SQL Programming&#41;](enable-coordinated-backups-for-transactional-replication.md)</span></span>  
  
## <a name="restoring-databases-involved-in-replication"></a><span data-ttu-id="08658-141">Восстановление баз данных, участвующих в репликации</span><span class="sxs-lookup"><span data-stu-id="08658-141">Restoring Databases Involved in Replication</span></span>  
 <span data-ttu-id="08658-142">Если имеются последние резервные копии и выполнены соответствующие шаги, можно восстановить все базы данных в топологии репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-142">You can restore all databases in a replication topology if recent backups are available and the appropriate steps are followed.</span></span> <span data-ttu-id="08658-143">Действия по восстановлению базы данных публикации зависят от типа репликации и от используемых параметров, однако действия по восстановлению всех других баз данных не зависят от типа репликации и параметров.</span><span class="sxs-lookup"><span data-stu-id="08658-143">The restore steps for the publication database depend on the type of replication and options that are used; however, the restore steps for all other databases are independent of the type and options.</span></span>  
  
 <span data-ttu-id="08658-144">Служба репликации поддерживает восстановление реплицированной базы данных на том же сервере и в той же базе данных, где была создана ее резервная копия.</span><span class="sxs-lookup"><span data-stu-id="08658-144">Replication supports restoring replicated databases to the same server and database from which the backup was created.</span></span> <span data-ttu-id="08658-145">Если восстановить резервную копию реплицированной базы данных на другом сервере или в другой базе данных, то станет невозможным сохранение настроек репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-145">If you restore a backup of a replicated database to another server or database, replication settings cannot be preserved.</span></span> <span data-ttu-id="08658-146">В этом случае после восстановления из резервной копии потребуется повторно создать все публикации и подписки.</span><span class="sxs-lookup"><span data-stu-id="08658-146">In this case, you must re-create all publications and subscriptions after backups are restored.</span></span>  
  
### <a name="publisher"></a><span data-ttu-id="08658-147">Издатель</span><span class="sxs-lookup"><span data-stu-id="08658-147">Publisher</span></span>  
 <span data-ttu-id="08658-148">Последовательность шагов по восстановлению предлагается для следующих типов репликации:</span><span class="sxs-lookup"><span data-stu-id="08658-148">There are restore steps provided for the following types of replication:</span></span>  
  
-   <span data-ttu-id="08658-149">репликация моментальных снимков;</span><span class="sxs-lookup"><span data-stu-id="08658-149">Snapshot replication</span></span>  
  
-   <span data-ttu-id="08658-150">репликация транзакций, доступная только для чтения;</span><span class="sxs-lookup"><span data-stu-id="08658-150">Read-only transactional replication</span></span>  
  
-   <span data-ttu-id="08658-151">репликация транзакций с обновляемыми подписками;</span><span class="sxs-lookup"><span data-stu-id="08658-151">Transactional replication with updating subscriptions</span></span>  
  
-   <span data-ttu-id="08658-152">одноранговая репликация транзакций.</span><span class="sxs-lookup"><span data-stu-id="08658-152">Peer-to-peer transactional replication</span></span>  
  
 <span data-ttu-id="08658-153">Восстановление баз данных **msdb** и **master** , о котором также рассказывается в этом разделе, одинаково для всех четырех типов репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-153">The restore of the **msdb** and **master** databases, which are also covered in this section, is the same for all four types.</span></span>  
  
#### <a name="publication-database-snapshot-replication"></a><span data-ttu-id="08658-154">База данных публикации: Репликация моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="08658-154">Publication Database: Snapshot Replication</span></span>  
  
1.  <span data-ttu-id="08658-155">Восстановите последнюю резервную копию базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="08658-155">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="08658-156">Перейдите к шагу 2.</span><span class="sxs-lookup"><span data-stu-id="08658-156">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="08658-157">Содержит ли резервная копия базы данных публикации последнюю конфигурацию всех публикаций и подписок?</span><span class="sxs-lookup"><span data-stu-id="08658-157">Does the publication database backup contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="08658-158">Если да, восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-158">If yes, the restore is completed.</span></span> <span data-ttu-id="08658-159">Если нет, перейдите к шагу 3.</span><span class="sxs-lookup"><span data-stu-id="08658-159">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="08658-160">Удалите конфигурацию репликации с издателя, распространителя и подписчиков, затем создайте конфигурацию заново.</span><span class="sxs-lookup"><span data-stu-id="08658-160">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="08658-161">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-161">Restore is completed.</span></span>  
  
     <span data-ttu-id="08658-162">Дополнительные сведения об удалении репликации см. в статье [sp_removedbreplication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="08658-162">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
#### <a name="publication-database-read-only-transactional-replication"></a><span data-ttu-id="08658-163">База данных публикации: репликация транзакций, доступная только для чтения</span><span class="sxs-lookup"><span data-stu-id="08658-163">Publication Database: Read-Only Transactional Replication</span></span>  
  
1.  <span data-ttu-id="08658-164">Восстановите последнюю резервную копию базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="08658-164">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="08658-165">Перейдите к шагу 2.</span><span class="sxs-lookup"><span data-stu-id="08658-165">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="08658-166">Был ли перед сбоем включен параметр **sync with backup** для базы данных публикации?</span><span class="sxs-lookup"><span data-stu-id="08658-166">Was the **sync with backup** setting enabled on the publication database before the failure?</span></span> <span data-ttu-id="08658-167">Если да, перейдите к шагу 3, если нет — к шагу 5.</span><span class="sxs-lookup"><span data-stu-id="08658-167">If yes, go to step 3; if no, go to step 5.</span></span>  
  
     <span data-ttu-id="08658-168">Если параметр включен, запрос `SELECT DATABASEPROPERTYEX('<PublicationDatabaseName>', 'IsSyncWithBackup')` возвращает '1'.</span><span class="sxs-lookup"><span data-stu-id="08658-168">If the setting is enabled, the query `SELECT DATABASEPROPERTYEX('<PublicationDatabaseName>', 'IsSyncWithBackup')` returns '1'.</span></span>  
  
3.  <span data-ttu-id="08658-169">Является ли восстановленная резервная копия полной и содержащей последние данные?</span><span class="sxs-lookup"><span data-stu-id="08658-169">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="08658-170">Содержит ли она последнюю конфигурацию всех публикаций и подписок?</span><span class="sxs-lookup"><span data-stu-id="08658-170">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="08658-171">Если да, восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-171">If yes, the restore is completed.</span></span> <span data-ttu-id="08658-172">Если нет, перейдите к шагу 4.</span><span class="sxs-lookup"><span data-stu-id="08658-172">If no, go to step 4.</span></span>  
  
4.  <span data-ttu-id="08658-173">Сведения о конфигурации восстановленной базы данных публикации устарели.</span><span class="sxs-lookup"><span data-stu-id="08658-173">The configuration information in the restored publication database is not up-to-date.</span></span> <span data-ttu-id="08658-174">Необходимо убедиться, что у подписчиков имеются все команды, ожидающие выполнения в базе данных распространителя, а затем удалить и повторно создать конфигурацию репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-174">Therefore, you must make sure that the Subscribers have all outstanding commands in the distribution database, and then drop and re-create the replication configuration.</span></span>  
  
    1.  <span data-ttu-id="08658-175">Запускайте агент распространителя до полной синхронизации подписчиков с ожидающими выполнения командами в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-175">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="08658-176">Убедитесь в том, что все команды доставлены подписчикам. Для этого используйте вкладку **Нераспространенные команды** в мониторе репликации либо запросите представление [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-176">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="08658-177">Перейдите к шагу b.</span><span class="sxs-lookup"><span data-stu-id="08658-177">Go to step b.</span></span>  
  
         <span data-ttu-id="08658-178">Дополнительные сведения о запуске агента распространителя см. в статьях [Запуск и остановка агента репликации (среда SQL Server Management Studio)](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) и [Основные понятия исполняемых файлов агента репликации](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="08658-178">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
         <span data-ttu-id="08658-179">Дополнительные сведения о проверке команд см. в статьях [Просмотр реплицированных команд и другие сведения в базе данных распространителя &#40;программирование репликации на языке Transact-SQL&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) и [Просмотр сведений и выполнение задач с помощью монитора репликации](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="08658-179">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
    2.  <span data-ttu-id="08658-180">Удалите конфигурацию репликации с издателя, распространителя и подписчиков, затем создайте конфигурацию заново.</span><span class="sxs-lookup"><span data-stu-id="08658-180">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="08658-181">При повторном создании подписок укажите, что подписчик уже содержит данные.</span><span class="sxs-lookup"><span data-stu-id="08658-181">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="08658-182">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-182">The restore is completed.</span></span>  
  
         <span data-ttu-id="08658-183">Дополнительные сведения об удалении репликации см. в статье [sp_removedbreplication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="08658-183">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="08658-184">Дополнительные сведения о том, как указать, что у подписчика уже есть данные, см. в разделе [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="08658-184">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
5.  <span data-ttu-id="08658-185">Параметр **sync with backup** не установлен в базе данных публикации.</span><span class="sxs-lookup"><span data-stu-id="08658-185">The **sync with backup** option was not set on the publication database.</span></span> <span data-ttu-id="08658-186">Следовательно, транзакции, не включенные в восстановленную резервную копию, могли быть переданы распространителю и подписчикам.</span><span class="sxs-lookup"><span data-stu-id="08658-186">Therefore, transactions that were not included in the restored backup might have been delivered to the Distributor and Subscribers.</span></span> <span data-ttu-id="08658-187">Необходимо убедиться, что в базе данных распространителя у подписчиков есть все команды, ожидающие обработки, затем вручную применить к базе данных публикации все транзакции, отсутствующие в восстановленной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="08658-187">You must now make sure that Subscribers have all outstanding commands in the distribution database, and then manually apply to the publication database any transactions that are not included in the restored backup.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="08658-188">В результате этих действий опубликованные таблицы могут быть восстановлены до более современных версий, чем версии неопубликованных таблиц, восстановленных из резервной копии.</span><span class="sxs-lookup"><span data-stu-id="08658-188">Performing this process can cause published tables to be restored to a point in time that is more recent than the point in time of other nonpublished tables that are restored from the backup.</span></span>  
  
    1.  <span data-ttu-id="08658-189">Запускайте агент распространителя до полной синхронизации подписчиков с ожидающими выполнения командами в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-189">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="08658-190">Убедитесь в том, что все команды доставлены подписчикам. Для этого используйте вкладку **Нераспространенные команды** в мониторе репликации либо запросите представление [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-190">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="08658-191">Перейдите к шагу b.</span><span class="sxs-lookup"><span data-stu-id="08658-191">Go to step b.</span></span>  
  
         <span data-ttu-id="08658-192">Дополнительные сведения о запуске агента распространителя см. в статьях [Запуск и остановка агента репликации (среда SQL Server Management Studio)](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) и [Основные понятия исполняемых файлов агента репликации](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="08658-192">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
         <span data-ttu-id="08658-193">Дополнительные сведения о проверке команд см. в статьях [Просмотр реплицированных команд и другие сведения в базе данных распространителя &#40;программирование репликации на языке Transact-SQL&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) и [Просмотр сведений и выполнение задач с помощью монитора репликации](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="08658-193">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
    2.  <span data-ttu-id="08658-194">Для ручной синхронизации издателя с подписчиками используется [программа tablediff](../../../tools/tablediff-utility.md) или другое средство.</span><span class="sxs-lookup"><span data-stu-id="08658-194">Use the [tablediff utility](../../../tools/tablediff-utility.md) or another tool to manually synchronize the Publisher with the Subscriber.</span></span> <span data-ttu-id="08658-195">Это позволяет восстанавливать данные из базы данных подписчика, которая не содержалась в резервной копии базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="08658-195">This enables you to recover data from the subscription database that was not contained in the publication database backup.</span></span> <span data-ttu-id="08658-196">Перейдите к шагу c.</span><span class="sxs-lookup"><span data-stu-id="08658-196">Go to step c.</span></span>  
  
         <span data-ttu-id="08658-197">Дополнительные сведения об использовании служебной программы **tablediff** см. в статье [Сравнение реплицируемых таблиц на предмет различий (программирование репликации)](compare-replicated-tables-for-differences-replication-programming.md).</span><span class="sxs-lookup"><span data-stu-id="08658-197">For more information about the **tablediff** utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    3.  <span data-ttu-id="08658-198">Является ли восстановленная резервная копия полной и содержащей последние данные?</span><span class="sxs-lookup"><span data-stu-id="08658-198">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="08658-199">Содержит ли она последнюю конфигурацию всех публикаций и подписок?</span><span class="sxs-lookup"><span data-stu-id="08658-199">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="08658-200">Если да, синхронизируйте повторно метаданные издателя и распространителя с помощью хранимой процедуры [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="08658-200">If yes, execute the [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) stored procedure to resynchronize the Publisher metadata with the Distributor metadata.</span></span> <span data-ttu-id="08658-201">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-201">The restore is completed.</span></span> <span data-ttu-id="08658-202">Если нет, перейдите к шагу d.</span><span class="sxs-lookup"><span data-stu-id="08658-202">If no, go to step d.</span></span>  
  
    4.  <span data-ttu-id="08658-203">Удалите конфигурацию репликации с издателя, распространителя и подписчиков, затем создайте конфигурацию заново.</span><span class="sxs-lookup"><span data-stu-id="08658-203">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="08658-204">При повторном создании подписок укажите, что подписчик уже содержит данные.</span><span class="sxs-lookup"><span data-stu-id="08658-204">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="08658-205">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-205">The restore is completed.</span></span>  
  
         <span data-ttu-id="08658-206">Дополнительные сведения об удалении репликации см. в статье [sp_removedbreplication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="08658-206">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="08658-207">Дополнительные сведения о том, как указать, что у подписчика уже есть данные, см. в разделе [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="08658-207">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="publication-database-transactional-replication-with-updating-subscriptions"></a><span data-ttu-id="08658-208">База данных публикации: репликация транзакций с обновляемыми подписками</span><span class="sxs-lookup"><span data-stu-id="08658-208">Publication Database: Transactional Replication with Updating Subscriptions</span></span>  
  
1.  <span data-ttu-id="08658-209">Восстановите последнюю резервную копию базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="08658-209">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="08658-210">Перейдите к шагу 2.</span><span class="sxs-lookup"><span data-stu-id="08658-210">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="08658-211">Запускайте агент распространителя до полной синхронизации подписчиков с ожидающими выполнения командами в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-211">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="08658-212">Убедитесь в том, что все команды доставлены подписчикам. Для этого используйте вкладку **Нераспространенные команды** в мониторе репликации либо запросите представление [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-212">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor, or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="08658-213">Перейдите к шагу 3.</span><span class="sxs-lookup"><span data-stu-id="08658-213">Go to step 3.</span></span>  
  
     <span data-ttu-id="08658-214">Дополнительные сведения о запуске агента распространителя см. в статьях [Запуск и остановка агента репликации (среда SQL Server Management Studio)](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) и [Основные понятия исполняемых файлов агента репликации](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="08658-214">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
     <span data-ttu-id="08658-215">Дополнительные сведения о проверке команд см. в статьях [Просмотр реплицированных команд и другие сведения в базе данных распространителя &#40;программирование репликации на языке Transact-SQL&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) и [Просмотр сведений и выполнение задач с помощью монитора репликации](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="08658-215">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
3.  <span data-ttu-id="08658-216">Если используются обновляемые посредством очередей подписки, подключитесь к каждому подписчику и удалите все строки из таблицы [MSreplication_queue (Transact-SQL)](/sql/relational-databases/system-tables/msreplication-queue-transact-sql) в базе данных подписки.</span><span class="sxs-lookup"><span data-stu-id="08658-216">If you are using queued updating subscriptions, connect to each Subscriber and delete all rows from the [MSreplication_queue &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/msreplication-queue-transact-sql) table in the subscription database.</span></span> <span data-ttu-id="08658-217">Перейдите к шагу 4.</span><span class="sxs-lookup"><span data-stu-id="08658-217">Go to step 4.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="08658-218">Если используются обновляемые посредством очередей подписки и какие-либо таблицы содержат столбцы идентификаторов, следует убедиться, что после восстановления назначены правильные диапазоны идентификаторов.</span><span class="sxs-lookup"><span data-stu-id="08658-218">If you are using queued updating subscriptions and any tables contain identity columns, you must make sure that the correct identity ranges are assigned after a restore.</span></span> <span data-ttu-id="08658-219">Дополнительные сведения см. в статье [Репликация столбцов идентификаторов](../publish/replicate-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="08658-219">For more information, see [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
4.  <span data-ttu-id="08658-220">Необходимо убедиться, что в базе данных распространителя у подписчиков есть все команды, ожидающие обработки, затем вручную применить к базе данных публикации все транзакции, отсутствующие в восстановленной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="08658-220">You must now make sure that Subscribers have all outstanding commands in the distribution database, and then manually apply to the publication database any transactions that are not included in the restored backup.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="08658-221">В результате этих действий опубликованные таблицы могут быть восстановлены до более современных версий, чем версии неопубликованных таблиц, восстановленных из резервной копии.</span><span class="sxs-lookup"><span data-stu-id="08658-221">Performing this process can cause published tables to be restored to a point in time that is more recent than the point in time of other nonpublished tables that are restored from the backup.</span></span>  
  
    1.  <span data-ttu-id="08658-222">Запускайте агент распространителя до полной синхронизации подписчиков с ожидающими выполнения командами в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-222">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="08658-223">Используя монитор репликации или запросив представление [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) в базе данных распространителя, убедитесь, что все команды доставлены подписчикам.</span><span class="sxs-lookup"><span data-stu-id="08658-223">Verify that all commands are delivered to Subscribers by using Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="08658-224">Перейдите к шагу b.</span><span class="sxs-lookup"><span data-stu-id="08658-224">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="08658-225">Для ручной синхронизации издателя с подписчиками используется [tablediff Utility](../../../tools/tablediff-utility.md) или другое средство.</span><span class="sxs-lookup"><span data-stu-id="08658-225">Use the [tablediff Utility](../../../tools/tablediff-utility.md) or another tool to manually synchronize the Publisher with the Subscriber.</span></span> <span data-ttu-id="08658-226">Это позволяет восстанавливать данные из базы данных подписчика, которая не содержалась в резервной копии базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="08658-226">This enables you to recover data from the subscription database that was not contained in the publication database backup.</span></span> <span data-ttu-id="08658-227">Перейдите к шагу c.</span><span class="sxs-lookup"><span data-stu-id="08658-227">Go to step c.</span></span>  
  
         <span data-ttu-id="08658-228">Дополнительные сведения об использовании служебной программы **tablediff** см. в статье [Сравнение реплицируемых таблиц на предмет различий (программирование репликации)](compare-replicated-tables-for-differences-replication-programming.md).</span><span class="sxs-lookup"><span data-stu-id="08658-228">For more information about the **tablediff** utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    3.  <span data-ttu-id="08658-229">Является ли восстановленная резервная копия полной и содержащей последние данные?</span><span class="sxs-lookup"><span data-stu-id="08658-229">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="08658-230">Содержит ли она последнюю конфигурацию всех публикаций и подписок?</span><span class="sxs-lookup"><span data-stu-id="08658-230">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="08658-231">Если да, синхронизируйте повторно метаданные издателя и распространителя с помощью хранимой процедуры [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="08658-231">If yes, execute the [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) stored procedure to resynchronize the Publisher metadata with the Distributor metadata.</span></span> <span data-ttu-id="08658-232">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-232">The restore is completed.</span></span> <span data-ttu-id="08658-233">Если нет, перейдите к шагу d.</span><span class="sxs-lookup"><span data-stu-id="08658-233">If no, go to step d.</span></span>  
  
    4.  <span data-ttu-id="08658-234">Удалите конфигурацию репликации с издателя, распространителя и подписчиков, затем создайте конфигурацию заново.</span><span class="sxs-lookup"><span data-stu-id="08658-234">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="08658-235">При повторном создании подписок укажите, что подписчик уже содержит данные.</span><span class="sxs-lookup"><span data-stu-id="08658-235">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="08658-236">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-236">The restore is completed.</span></span>  
  
         <span data-ttu-id="08658-237">Дополнительные сведения об удалении репликации см. в статье [sp_removedbreplication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="08658-237">For more information about how to remove replication, see and [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="08658-238">Дополнительные сведения о том, как указать, что у подписчика уже есть данные, см. в разделе [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="08658-238">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="publication-database-peer-to-peer-transactional-replication"></a><span data-ttu-id="08658-239">База данных публикации: Peer-to-Peer Transactional Replication</span><span class="sxs-lookup"><span data-stu-id="08658-239">Publication Database: Peer-to-Peer Transactional Replication</span></span>  
 <span data-ttu-id="08658-240">В следующих шагах базы данных публикаций **A**, **B**и **C** находятся в топологии одноранговой репликации транзакций.</span><span class="sxs-lookup"><span data-stu-id="08658-240">In the following steps, publication databases **A**, **B**, and **C** are in a peer-to-peer transactional replication topology.</span></span> <span data-ttu-id="08658-241">Базы данных **A** и **C** находятся в режиме  «в сети» и функционируют правильно; база данных **B** — восстанавливаемая база данных.</span><span class="sxs-lookup"><span data-stu-id="08658-241">Databases **A** and **C** are online and functioning properly; database **B** is the database to be restored.</span></span> <span data-ttu-id="08658-242">Описанные здесь действия, особенно шаги 7, 10 и 11, очень похожи на процесс добавления узла к одноранговой топологии.</span><span class="sxs-lookup"><span data-stu-id="08658-242">The process described here, especially steps 7, 10, and 11, is very similar to the process required to add a node to a peer-to-peer topology.</span></span> <span data-ttu-id="08658-243">Самый простой путь выполнения этих шагов — использование мастера настройки одноранговой топологии, однако можно использовать и хранимые процедуры.</span><span class="sxs-lookup"><span data-stu-id="08658-243">The most straightforward way to perform these steps is to use the Configure Peer-to-Peer Topology Wizard, but you can also use stored procedures.</span></span>  
  
1.  <span data-ttu-id="08658-244">Запустите агент распространителя для синхронизации подписок в базах данных **A** и **C**. Перейдите к шагу 2.</span><span class="sxs-lookup"><span data-stu-id="08658-244">Run the Distribution Agents to synchronize the subscriptions at databases **A** and **C**. Go to step 2.</span></span>  
  
     <span data-ttu-id="08658-245">Дополнительные сведения о запуске агента распространителя см. в статьях [Запуск и остановка агента репликации (среда SQL Server Management Studio)](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) и [Основные понятия исполняемых файлов агента репликации](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="08658-245">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
2.  <span data-ttu-id="08658-246">Если база данных распространителя, которую использует база данных **B**, все еще доступна, запустите агенты распространителя для синхронизации подписок между базами данных **B** и **A**, а также между базами данных B и **C**. Перейдите к шагу 3.</span><span class="sxs-lookup"><span data-stu-id="08658-246">If the distribution database that **B** uses is still available, run Distribution Agents to synchronize subscriptions between databases **B** and **A** and databases and B and **C**. Go to step 3.</span></span>  
  
3.  <span data-ttu-id="08658-247">Удалите метаданные из базы данных распространителя, которую использует база данных **B**, выполнив хранимую процедуру [sp_removedistpublisherdbreplication](/sql/relational-databases/system-stored-procedures/sp-removedistpublisherdbreplication-transact-sql) в базе данных распространителя для базы данных **B**. Перейдите к шагу 4.</span><span class="sxs-lookup"><span data-stu-id="08658-247">Remove metadata from the distribution database that **B** uses by executing [sp_removedistpublisherdbreplication](/sql/relational-databases/system-stored-procedures/sp-removedistpublisherdbreplication-transact-sql) at the distribution database for **B**. Go to step 4.</span></span>  
  
4.  <span data-ttu-id="08658-248">В базах данных **A** и **C** удалите подписки на публикации из базы данных **B**. Перейдите к шагу 5.</span><span class="sxs-lookup"><span data-stu-id="08658-248">At databases **A** and **C**, drop the subscriptions to the publication at database **B**. Go to step 5.</span></span>  
  
     <span data-ttu-id="08658-249">Дополнительные сведения об удалении подписок см. в разделе [Subscribe to Publications](../subscribe-to-publications.md).</span><span class="sxs-lookup"><span data-stu-id="08658-249">For more information about how to drop subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
5.  <span data-ttu-id="08658-250">Выполните резервное копирование журналов или полное резервное копирование базы данных **A**. Перейдите к шагу 6.</span><span class="sxs-lookup"><span data-stu-id="08658-250">Perform a log backup or full backup of database **A**. Go to step 6.</span></span>  
  
6.  <span data-ttu-id="08658-251">Восстановите резервную копию базы данных **A** в базе данных **B**. Теперь в базе данных **B** имеются данные из базы данных **A**, но отсутствует конфигурация репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-251">Restore the backup of database **A** at database **B**. Database **B** now has the data from database **A**, but not the replication configuration.</span></span> <span data-ttu-id="08658-252">При восстановлении резервной копии на другом сервере репликация удаляется, поэтому репликация была удалена из базы данных **B**. Перейдите к шагу 7.</span><span class="sxs-lookup"><span data-stu-id="08658-252">When you restore a backup to another server, replication is removed; therefore, replication has been removed from database **B**. Go to step 7.</span></span>  
  
7.  <span data-ttu-id="08658-253">Вновь создайте публикацию в базе данных **B** и подписки между базами данных **A** и **B**. (Подписки, затрагивающие базу данных **C**, будут обработаны позже.)</span><span class="sxs-lookup"><span data-stu-id="08658-253">Re-create the publication at database **B**, and then re-create subscriptions between databases **A** and **B**. (Subscriptions that involve database **C** are handled at a later stage.).</span></span>  
  
    1.  <span data-ttu-id="08658-254">Заново создайте публикацию в базе данных **B**. Перейдите к шагу b.</span><span class="sxs-lookup"><span data-stu-id="08658-254">Re-create the publication at database **B**. Go to step b.</span></span>  
  
    2.  <span data-ttu-id="08658-255">Повторно создайте подписку в базе данных **B** на публикацию в базе данных **а**, указав, что подписка должна быть инициализирована с помощью резервной копии (значение **инициализации с резервной копией** для **@sync_type** параметра [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="08658-255">Re-create the subscription at database **B** to the publication at database **A**, specifying that the subscription should be initialized with a backup (a value of **initialize with backup** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="08658-256">Перейдите к шагу c.</span><span class="sxs-lookup"><span data-stu-id="08658-256">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="08658-257">Повторно создайте подписку в базе данных **A** на публикацию в базе данных **B**, указав, что подписчик уже имеет данные (значение **поддержка репликации только** для **@sync_type** параметра [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="08658-257">Re-create the subscription at database **A** to the publication at database **B**, specifying that the Subscriber already has the data (a value of **replication support only** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="08658-258">Перейдите к шагу 8.</span><span class="sxs-lookup"><span data-stu-id="08658-258">Go to step 8.</span></span>  
  
8.  <span data-ttu-id="08658-259">Запустите агент распространителя для синхронизации подписок в базах данных **A** и **B**. Если в публикуемых таблицах имеются столбцы идентификаторов, перейдите к шагу 9.</span><span class="sxs-lookup"><span data-stu-id="08658-259">Run the Distribution Agents to synchronize the subscriptions at databases **A** and **B**. If there are any identity columns in published tables, go to step 9.</span></span> <span data-ttu-id="08658-260">Если нет, перейдите к шагу 10.</span><span class="sxs-lookup"><span data-stu-id="08658-260">If not, go to step 10.</span></span>  
  
9. <span data-ttu-id="08658-261">После восстановления диапазон идентификаторов, присвоенный каждой таблице в базе данных **A**, будет также использоваться в базе данных **B**. Убедитесь, что восстановленная база данных **B** получила все изменения из поврежденной базы данных **B**, которые были переданы в базы данных **A** и **C**, затем обновите начальные значения диапазона идентификаторов для каждой таблицы.</span><span class="sxs-lookup"><span data-stu-id="08658-261">After the restore, the identity range that you assigned for each table in database **A** would also be used in database **B**. Make sure that the restored database **B** has received all changes from the failed database **B** that were propagated to database **A** and database **C**; and then reseed the identity range for each table.</span></span>  
  
    1.  <span data-ttu-id="08658-262">Выполните [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) в базе данных **B** и извлеките выходной параметр **@request_id** .</span><span class="sxs-lookup"><span data-stu-id="08658-262">Execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) at database **B** and retrieve the output parameter **@request_id**.</span></span> <span data-ttu-id="08658-263">Перейдите к шагу b.</span><span class="sxs-lookup"><span data-stu-id="08658-263">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="08658-264">По умолчанию агент распространителя работает непрерывно, поэтому токены отправляются на все узлы автоматически.</span><span class="sxs-lookup"><span data-stu-id="08658-264">By default, the Distribution Agent is set to run continuously; therefore, tokens should be sent to all nodes automatically.</span></span> <span data-ttu-id="08658-265">Если агент распространителя не выполняется в непрерывном режиме, запустите его.</span><span class="sxs-lookup"><span data-stu-id="08658-265">If the Distribution Agent is not running in continuous mode, run the agent.</span></span> <span data-ttu-id="08658-266">Дополнительные сведения см. в разделах [Основные понятия исполняемых файлов агента репликации](../concepts/replication-agent-executables-concepts.md) и [Запуск и остановка агента репликации (среда SQL Server Management Studio)](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="08658-266">For more information, see [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md) or [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span></span> <span data-ttu-id="08658-267">Перейдите к шагу c.</span><span class="sxs-lookup"><span data-stu-id="08658-267">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="08658-268">Выполните [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), указав **@request_id** значение, полученное на шаге b.</span><span class="sxs-lookup"><span data-stu-id="08658-268">Execute [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), providing the **@request_id** value retrieved in step b.</span></span> <span data-ttu-id="08658-269">Подождите, пока все узлы сообщат о получении однорангового запроса.</span><span class="sxs-lookup"><span data-stu-id="08658-269">Wait until all nodes indicate they have received the peer request.</span></span> <span data-ttu-id="08658-270">Перейдите к шагу d.</span><span class="sxs-lookup"><span data-stu-id="08658-270">Go to step d.</span></span>  
  
    4.  <span data-ttu-id="08658-271">Выполните инструкцию [DBCC CHECKIDENT](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) для обновления начальных значений каждой таблицы в базе данных **B** , чтобы убедиться, что используется соответствующий диапазон.</span><span class="sxs-lookup"><span data-stu-id="08658-271">Use [DBCC CHECKIDENT](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) to reseed each table in database **B** to make sure that an appropriate range is used.</span></span> <span data-ttu-id="08658-272">Перейдите к шагу 10.</span><span class="sxs-lookup"><span data-stu-id="08658-272">Go to step 10.</span></span>  
  
     <span data-ttu-id="08658-273">Дополнительные сведения об управлении диапазонами идентификаторов см. в подразделе "Назначение диапазонов для ручного управления диапазонами идентификаторов" статьи [Репликация столбцов идентификаторов](../publish/replicate-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="08658-273">For more information about how to manage identity ranges, see the "Assigning ranges for manual identity range management" section of [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
10. <span data-ttu-id="08658-274">В этот момент базы данных **B** и **C** не связаны напрямую, но они будут получать изменения через базу данных **A**. Если топология содержит узлы, на которых выполняется [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], перейдите к шагу 11, в противном случае перейдите к шагу 12.</span><span class="sxs-lookup"><span data-stu-id="08658-274">At this point, database **B** and database **C** are not directly connected, but they will receive changes through database **A**. If the topology contains any nodes that are running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], go to step 11; otherwise, go to step 12.</span></span>  
  
11. <span data-ttu-id="08658-275">Приостановите систему и заново создайте подписки между базами данных **B** и **C**. Приостановка системы подразумевает остановку действий в опубликованных таблицах на всех узлах и проверку получения изменений на каждом узле.</span><span class="sxs-lookup"><span data-stu-id="08658-275">Quiesce the system, and then re-create the subscription between databases **B** and **C**. Quiescing a system involves stopping activity on published tables at all nodes and making sure of that each node has received all changes from all other nodes.</span></span>  
  
    1.  <span data-ttu-id="08658-276">Остановите все действия в опубликованных таблицах в одноранговой топологии.</span><span class="sxs-lookup"><span data-stu-id="08658-276">Stop all activity on published tables in the peer-to-peer topology.</span></span> <span data-ttu-id="08658-277">Перейдите к шагу b.</span><span class="sxs-lookup"><span data-stu-id="08658-277">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="08658-278">Выполните [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) в базе данных **B** и извлеките выходной параметр **@request_id** .</span><span class="sxs-lookup"><span data-stu-id="08658-278">Execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) at database **B** and retrieve the output parameter **@request_id**.</span></span> <span data-ttu-id="08658-279">Перейдите к шагу c.</span><span class="sxs-lookup"><span data-stu-id="08658-279">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="08658-280">По умолчанию агент распространителя работает непрерывно, поэтому токены отправляются на все узлы автоматически.</span><span class="sxs-lookup"><span data-stu-id="08658-280">By default, the Distribution Agent is set to run continuously; therefore, tokens should be sent to all nodes automatically.</span></span> <span data-ttu-id="08658-281">Если агент распространителя не выполняется в непрерывном режиме, запустите его.</span><span class="sxs-lookup"><span data-stu-id="08658-281">If the Distribution Agent is not running in continuous mode, run the agent.</span></span> <span data-ttu-id="08658-282">Перейдите к шагу d.</span><span class="sxs-lookup"><span data-stu-id="08658-282">Go to step d.</span></span>  
  
    4.  <span data-ttu-id="08658-283">Выполните [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), указав **@request_id** значение, полученное на шаге b.</span><span class="sxs-lookup"><span data-stu-id="08658-283">Execute [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), providing the **@request_id** value retrieved in step b.</span></span> <span data-ttu-id="08658-284">Подождите, пока все узлы сообщат о получении однорангового запроса.</span><span class="sxs-lookup"><span data-stu-id="08658-284">Wait until all nodes indicate they have received the peer request.</span></span> <span data-ttu-id="08658-285">Перейдите к шагу e.</span><span class="sxs-lookup"><span data-stu-id="08658-285">Go to step e.</span></span>  
  
    5.  <span data-ttu-id="08658-286">Создайте заново подписку в базе данных **B** на публикацию в базе данных **C**, указав, что подписчик уже содержит данные.</span><span class="sxs-lookup"><span data-stu-id="08658-286">Re-create the subscription at database **B** to the publication at database **C**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="08658-287">Перейдите к шагу b.</span><span class="sxs-lookup"><span data-stu-id="08658-287">Go to step b.</span></span>  
  
    6.  <span data-ttu-id="08658-288">Создайте заново подписку в базе данных **C** на публикацию в базе данных **B**, указав, что подписчик уже содержит данные.</span><span class="sxs-lookup"><span data-stu-id="08658-288">Re-create the subscription at database **C** to the publication at database **B**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="08658-289">Перейдите к шагу 13.</span><span class="sxs-lookup"><span data-stu-id="08658-289">Go to step 13.</span></span>  
  
12. <span data-ttu-id="08658-290">Создайте заново подписку между базами данных **B** и **C**.</span><span class="sxs-lookup"><span data-stu-id="08658-290">Re-create the subscription between databases **B** and **C**:</span></span>  
  
    1.  <span data-ttu-id="08658-291">В базе данных **B**выполните запрос к таблице [MSpeer_lsns](/sql/relational-databases/system-tables/mspeer-lsns-transact-sql) , чтобы получить номер LSN последней транзакции, которая была передана в базу данных **B** из базы данных **C**.</span><span class="sxs-lookup"><span data-stu-id="08658-291">At database **B**, query the [MSpeer_lsns](/sql/relational-databases/system-tables/mspeer-lsns-transact-sql) table to retrieve the log sequence number (LSN) of the most recent transaction that database **B** has received from database **C**.</span></span>  
  
    2.  <span data-ttu-id="08658-292">Повторно создайте подписку в базе данных **B** на публикацию в базе данных **C**, указав, что подписка должна быть ИНИЦИАЛИЗИРОВАНА на основе номера LSN (значение **Initialize из номера LSN** для **@sync_type** параметра [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="08658-292">Re-create the subscription at database **B** to the publication at database **C**, specifying that the subscription should be initialized based on LSN (a value of **initialize from lsn** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="08658-293">Перейдите к шагу b.</span><span class="sxs-lookup"><span data-stu-id="08658-293">Go to step b.</span></span>  
  
    3.  <span data-ttu-id="08658-294">Создайте заново подписку в базе данных **C** на публикацию в базе данных **B**, указав, что подписчик уже содержит данные.</span><span class="sxs-lookup"><span data-stu-id="08658-294">Re-create the subscription at database **C** to the publication at database **B**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="08658-295">Перейдите к шагу 13.</span><span class="sxs-lookup"><span data-stu-id="08658-295">Go to step 13.</span></span>  
  
13. <span data-ttu-id="08658-296">Запустите агент распространителя для синхронизации подписок в базах данных **B** и **C**. Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-296">Run the Distribution Agents to synchronize the subscriptions at databases **B** and **C**. The restore is completed.</span></span>  
  
#### <a name="msdb-database-publisher"></a><span data-ttu-id="08658-297">База данных msdb (Издатель)</span><span class="sxs-lookup"><span data-stu-id="08658-297">msdb Database (Publisher)</span></span>  
  
1.  <span data-ttu-id="08658-298">Восстановите последнюю резервную копию базы данных **msdb** .</span><span class="sxs-lookup"><span data-stu-id="08658-298">Restore the latest backup of the **msdb** database.</span></span>  
  
2.  <span data-ttu-id="08658-299">Является ли восстановленная резервная копия полной и содержащей последние данные?</span><span class="sxs-lookup"><span data-stu-id="08658-299">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="08658-300">Содержит ли она последнюю конфигурацию всех публикаций и подписок?</span><span class="sxs-lookup"><span data-stu-id="08658-300">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="08658-301">Если да, восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-301">If yes, recovery is completed.</span></span> <span data-ttu-id="08658-302">Если нет, перейдите к шагу 3.</span><span class="sxs-lookup"><span data-stu-id="08658-302">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="08658-303">Создайте заново задание очистки подписки из скриптов репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-303">Re-create the subscription cleanup job from your replication scripts.</span></span> <span data-ttu-id="08658-304">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-304">Recovery is completed.</span></span>  
  
#### <a name="master-database-publisher"></a><span data-ttu-id="08658-305">База данных master (Издатель)</span><span class="sxs-lookup"><span data-stu-id="08658-305">master Database (Publisher)</span></span>  
  
1.  <span data-ttu-id="08658-306">Восстановите последнюю резервную копию базы данных **master** .</span><span class="sxs-lookup"><span data-stu-id="08658-306">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="08658-307">Убедитесь, что база данных согласована с базой данных публикации по конфигурации и параметрам репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-307">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
### <a name="databases-at-the-distributor"></a><span data-ttu-id="08658-308">Базы данных на распространителе</span><span class="sxs-lookup"><span data-stu-id="08658-308">Databases at the Distributor</span></span>  
  
#### <a name="distribution-database"></a><span data-ttu-id="08658-309">База данных распространителя</span><span class="sxs-lookup"><span data-stu-id="08658-309">Distribution Database</span></span>  
  
1.  <span data-ttu-id="08658-310">Восстановите последнюю резервную копию базы данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-310">Restore the latest backup of the distribution database.</span></span>  
  
2.  <span data-ttu-id="08658-311">Был ли перед сбоем включен параметр **sync with backup** для базы данных распространителя?</span><span class="sxs-lookup"><span data-stu-id="08658-311">Was the **sync with backup** setting enabled on the distribution database before the failure?</span></span> <span data-ttu-id="08658-312">Если да, перейдите к шагу 3, если нет — к шагу 4.</span><span class="sxs-lookup"><span data-stu-id="08658-312">If yes, go to step 3; if no, go to step 4.</span></span>  
  
     <span data-ttu-id="08658-313">Если параметр включен, запрос `SELECT DATABASEPROPERTYEX('<DistributionDatabaseName>', 'IsSyncWithBackup')` возвращает '1'.</span><span class="sxs-lookup"><span data-stu-id="08658-313">If the setting is enabled, the query `SELECT DATABASEPROPERTYEX('<DistributionDatabaseName>', 'IsSyncWithBackup')` returns '1'.</span></span>  
  
3.  <span data-ttu-id="08658-314">Является ли восстановленная резервная копия полной и содержащей последние данные?</span><span class="sxs-lookup"><span data-stu-id="08658-314">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="08658-315">Содержит ли она последнюю конфигурацию всех публикаций и подписок?</span><span class="sxs-lookup"><span data-stu-id="08658-315">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="08658-316">Если да, восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-316">If yes, recovery is completed.</span></span> <span data-ttu-id="08658-317">Если нет, перейдите к шагу 4.</span><span class="sxs-lookup"><span data-stu-id="08658-317">If no, go to step 4.</span></span>  
  
4.  <span data-ttu-id="08658-318">Либо сведения о конфигурации в восстановленной базе данных распространителя устарели, либо в базе данных распространителя не был установлен параметр **sync with backup** .</span><span class="sxs-lookup"><span data-stu-id="08658-318">Either the configuration information in the restored distribution database is not up-to-date, or the **sync with backup** option was not set on the distribution database.</span></span> <span data-ttu-id="08658-319">(После восстановления в базе данных распространителя могут иметься потерянные транзакции, зафиксированные на издателе, но не переданные подписчикам.) Удалите и создайте заново репликацию, а затем выполните проверку.</span><span class="sxs-lookup"><span data-stu-id="08658-319">(After the restore, the distribution database might be missing transactions that were committed at the Publisher but have not yet been delivered to Subscribers.) Drop and re-create replication, and then run validation.</span></span>  
  
    1.  <span data-ttu-id="08658-320">Удалите конфигурацию репликации с издателя, распространителя и подписчиков, затем создайте конфигурацию заново.</span><span class="sxs-lookup"><span data-stu-id="08658-320">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="08658-321">При повторном создании подписок укажите, что подписчик уже содержит данные.</span><span class="sxs-lookup"><span data-stu-id="08658-321">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="08658-322">Перейдите к шагу b.</span><span class="sxs-lookup"><span data-stu-id="08658-322">Go to step b.</span></span>  
  
         <span data-ttu-id="08658-323">Дополнительные сведения об удалении репликации см. в статье [sp_removedbreplication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="08658-323">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="08658-324">Дополнительные сведения о том, как указать, что у подписчика уже есть данные, см. в разделе [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="08658-324">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
    2.  <span data-ttu-id="08658-325">Отметьте все публикации для проверки.</span><span class="sxs-lookup"><span data-stu-id="08658-325">Mark all publications for validation.</span></span> <span data-ttu-id="08658-326">Повторно инициализируйте все подписки, не прошедшие проверку.</span><span class="sxs-lookup"><span data-stu-id="08658-326">Reinitialize any subscriptions that fail validation.</span></span> <span data-ttu-id="08658-327">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-327">Recovery is completed.</span></span>  
  
         <span data-ttu-id="08658-328">Дополнительные сведения о проверке см. в разделе [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span><span class="sxs-lookup"><span data-stu-id="08658-328">For more information about validation, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="08658-329">Дополнительные сведения о повторной инициализации см. в статье [Повторная инициализация подписок](../reinitialize-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="08658-329">For more information about reinitialization, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
#### <a name="msdb-database-distributor"></a><span data-ttu-id="08658-330">База данных msdb (Распространитель)</span><span class="sxs-lookup"><span data-stu-id="08658-330">msdb Database (Distributor)</span></span>  
  
1.  <span data-ttu-id="08658-331">Восстановите последнюю резервную копию базы данных **msdb** .</span><span class="sxs-lookup"><span data-stu-id="08658-331">Restore the latest backup of the **msdb** database.</span></span>  
  
2.  <span data-ttu-id="08658-332">Является ли восстановленная резервная копия полной и содержащей последние данные?</span><span class="sxs-lookup"><span data-stu-id="08658-332">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="08658-333">Содержит ли она последнюю конфигурацию всех публикаций и подписок?</span><span class="sxs-lookup"><span data-stu-id="08658-333">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="08658-334">Если да, восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-334">If yes, recovery is completed.</span></span> <span data-ttu-id="08658-335">Если нет, перейдите к шагу 3.</span><span class="sxs-lookup"><span data-stu-id="08658-335">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="08658-336">Удалите конфигурацию репликации с издателя, распространителя и подписчиков, затем создайте конфигурацию заново.</span><span class="sxs-lookup"><span data-stu-id="08658-336">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="08658-337">При повторном создании подписок укажите, что подписчик уже содержит данные.</span><span class="sxs-lookup"><span data-stu-id="08658-337">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="08658-338">Перейдите к шагу 4.</span><span class="sxs-lookup"><span data-stu-id="08658-338">Go to step 4.</span></span>  
  
     <span data-ttu-id="08658-339">Дополнительные сведения об удалении репликации см. в статье [sp_removedbreplication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="08658-339">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
     <span data-ttu-id="08658-340">Дополнительные сведения о том, как указать, что у подписчика уже есть данные, см. в разделе [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="08658-340">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
4.  <span data-ttu-id="08658-341">Отметьте все публикации для проверки.</span><span class="sxs-lookup"><span data-stu-id="08658-341">Mark all publications for validation.</span></span> <span data-ttu-id="08658-342">Повторно инициализируйте все подписки, не прошедшие проверку.</span><span class="sxs-lookup"><span data-stu-id="08658-342">Reinitialize any subscriptions that fail validation.</span></span> <span data-ttu-id="08658-343">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-343">Recovery is completed.</span></span>  
  
     <span data-ttu-id="08658-344">Дополнительные сведения о проверке см. в разделе [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span><span class="sxs-lookup"><span data-stu-id="08658-344">For more information about validation, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="08658-345">Дополнительные сведения о повторной инициализации см. в статье [Повторная инициализация подписок](../reinitialize-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="08658-345">For more information about reinitialization, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
#### <a name="master-database-distributor"></a><span data-ttu-id="08658-346">База данных master (Распространитель)</span><span class="sxs-lookup"><span data-stu-id="08658-346">master Database (Distributor)</span></span>  
  
1.  <span data-ttu-id="08658-347">Восстановите последнюю резервную копию базы данных **master** .</span><span class="sxs-lookup"><span data-stu-id="08658-347">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="08658-348">Убедитесь, что база данных согласована с базой данных публикации по конфигурации и параметрам репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-348">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
### <a name="databases-at-the-subscriber"></a><span data-ttu-id="08658-349">Базы данных на подписчике</span><span class="sxs-lookup"><span data-stu-id="08658-349">Databases at the Subscriber</span></span>  
  
#### <a name="subscription-database"></a><span data-ttu-id="08658-350">База данных подписки</span><span class="sxs-lookup"><span data-stu-id="08658-350">Subscription Database</span></span>  
  
1.  <span data-ttu-id="08658-351">Является ли последняя резервная копия базы данных подписки более поздней, чем значение параметра минимального срока хранения распространения в базе данных распространителя?</span><span class="sxs-lookup"><span data-stu-id="08658-351">Is the latest subscription database backup more recent than the minimum distribution retention setting on the distribution database?</span></span> <span data-ttu-id="08658-352">(Этим определяется, имеются ли у распространителя все команды, необходимые для обновления подписчика.) Если да, перейдите к шагу 2.</span><span class="sxs-lookup"><span data-stu-id="08658-352">(This determines whether the Distributor still has all the commands that are required to bring the Subscriber up-to-date.) If yes, go to step 2.</span></span> <span data-ttu-id="08658-353">Если нет, выполните повторную инициализацию подписки.</span><span class="sxs-lookup"><span data-stu-id="08658-353">If no, reinitialize the subscription.</span></span> <span data-ttu-id="08658-354">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-354">Recovery is completed.</span></span>  
  
     <span data-ttu-id="08658-355">Чтобы определить значение параметра срока хранения распространителя, выполните хранимую процедуру [sp_helpdistributiondb](/sql/relational-databases/system-stored-procedures/sp-helpdistributiondb-transact-sql) и получите значение из столбца **max_distretention** (значение в часах).</span><span class="sxs-lookup"><span data-stu-id="08658-355">To determine the maximum distribution retention setting, execute [sp_helpdistributiondb](/sql/relational-databases/system-stored-procedures/sp-helpdistributiondb-transact-sql) and retrieve the value from the **max_distretention** column (this value is in hours).</span></span>  
  
     <span data-ttu-id="08658-356">Дополнительные сведения о повторной инициализации подписки см. в разделе [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="08658-356">For more information about how to reinitialize a subscription, see [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span></span>  
  
2.  <span data-ttu-id="08658-357">Восстановите последнюю резервную копию базы данных подписки.</span><span class="sxs-lookup"><span data-stu-id="08658-357">Restore the latest subscription database backup.</span></span> <span data-ttu-id="08658-358">Перейдите к шагу 3.</span><span class="sxs-lookup"><span data-stu-id="08658-358">Go to step 3.</span></span>  
  
3.  <span data-ttu-id="08658-359">Если база данных подписки содержит только принудительные подписки, перейдите к шагу 4.</span><span class="sxs-lookup"><span data-stu-id="08658-359">If the subscription database contains only push subscriptions, go to step 4.</span></span> <span data-ttu-id="08658-360">Если база данных подписки содержит любые подписки по запросу, задайте указанные ниже вопросы. Являются ли сведения о подписке актуальными?</span><span class="sxs-lookup"><span data-stu-id="08658-360">If the subscription database contains any pull subscriptions, ask the following questions: Is the subscription information current?</span></span> <span data-ttu-id="08658-361">Включает ли база данных все таблицы и параметры, которые были установлены на момент сбоя.</span><span class="sxs-lookup"><span data-stu-id="08658-361">Does the database include all tables and options that were set at the time of failure.</span></span> <span data-ttu-id="08658-362">Если да, перейдите к шагу 4.</span><span class="sxs-lookup"><span data-stu-id="08658-362">If yes, go to step 4.</span></span> <span data-ttu-id="08658-363">Если нет, выполните повторную инициализацию подписки.</span><span class="sxs-lookup"><span data-stu-id="08658-363">If no, reinitialize the subscription.</span></span> <span data-ttu-id="08658-364">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-364">Recovery is completed.</span></span>  
  
4.  <span data-ttu-id="08658-365">Для синхронизации подписчика запустите агент распространителя.</span><span class="sxs-lookup"><span data-stu-id="08658-365">To synchronize the Subscriber, run the Distribution Agent.</span></span> <span data-ttu-id="08658-366">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-366">Recovery is completed.</span></span>  
  
     <span data-ttu-id="08658-367">Дополнительные сведения о запуске агента распространителя см. в статьях [Запуск и остановка агента репликации (среда SQL Server Management Studio)](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) и [Основные понятия исполняемых файлов агента репликации](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="08658-367">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
#### <a name="msdb-database-subscriber"></a><span data-ttu-id="08658-368">База данных msdb (Подписчик)</span><span class="sxs-lookup"><span data-stu-id="08658-368">msdb Database (Subscriber)</span></span>  
  
1.  <span data-ttu-id="08658-369">Восстановите последнюю резервную копию базы данных **msdb** .</span><span class="sxs-lookup"><span data-stu-id="08658-369">Restore the latest backup of the **msdb** database.</span></span> <span data-ttu-id="08658-370">Используются ли на этом подписчике подписки по запросу?</span><span class="sxs-lookup"><span data-stu-id="08658-370">Are pull subscriptions used at this Subscriber?</span></span> <span data-ttu-id="08658-371">Если нет, восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-371">If no, the restore is completed.</span></span> <span data-ttu-id="08658-372">Если да, перейдите к шагу 2.</span><span class="sxs-lookup"><span data-stu-id="08658-372">If yes, go to step 2.</span></span>  
  
2.  <span data-ttu-id="08658-373">Является ли восстановленная резервная копия полной и содержащей последние данные?</span><span class="sxs-lookup"><span data-stu-id="08658-373">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="08658-374">Содержит ли она последнюю конфигурацию всех подписок по запросу?</span><span class="sxs-lookup"><span data-stu-id="08658-374">Does it contain the latest configuration for all pull subscriptions?</span></span> <span data-ttu-id="08658-375">Если да, восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-375">If yes, recovery is completed.</span></span> <span data-ttu-id="08658-376">Если нет, перейдите к шагу 3.</span><span class="sxs-lookup"><span data-stu-id="08658-376">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="08658-377">Удалите и создайте заново подписки по запросу.</span><span class="sxs-lookup"><span data-stu-id="08658-377">Drop and re-create the pull subscriptions.</span></span> <span data-ttu-id="08658-378">При повторном создании подписок укажите, что подписчик уже содержит данные.</span><span class="sxs-lookup"><span data-stu-id="08658-378">When you re-create the subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="08658-379">Восстановление завершено.</span><span class="sxs-lookup"><span data-stu-id="08658-379">The restore is completed.</span></span>  
  
     <span data-ttu-id="08658-380">Дополнительные сведения об удалении подписок см. в разделе [Subscribe to Publications](../subscribe-to-publications.md).</span><span class="sxs-lookup"><span data-stu-id="08658-380">For more information about how to drop subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
     <span data-ttu-id="08658-381">Дополнительные сведения о том, как указать, что у подписчика уже есть данные, см. в разделе [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="08658-381">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="master-database-subscriber"></a><span data-ttu-id="08658-382">База данных master (Подписчик)</span><span class="sxs-lookup"><span data-stu-id="08658-382">master Database (Subscriber)</span></span>  
  
1.  <span data-ttu-id="08658-383">Восстановите последнюю резервную копию базы данных **master** .</span><span class="sxs-lookup"><span data-stu-id="08658-383">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="08658-384">Убедитесь, что база данных согласована с базой данных публикации по конфигурации и параметрам репликации.</span><span class="sxs-lookup"><span data-stu-id="08658-384">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="08658-385">См. также:</span><span class="sxs-lookup"><span data-stu-id="08658-385">See Also</span></span>  
 <span data-ttu-id="08658-386">[Резервное копирование и восстановление баз данных SQL Server](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="08658-386">[Back Up and Restore of SQL Server Databases](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span></span>  
 <span data-ttu-id="08658-387">[Создание резервной копии и восстановление из копий реплицируемых баз данных](back-up-and-restore-replicated-databases.md) </span><span class="sxs-lookup"><span data-stu-id="08658-387">[Back Up and Restore Replicated Databases](back-up-and-restore-replicated-databases.md) </span></span>  
 <span data-ttu-id="08658-388">[Настройка распространения](../configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="08658-388">[Configure Distribution](../configure-distribution.md) </span></span>  
 <span data-ttu-id="08658-389">[Публикация данных и объектов базы данных](../publish/publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="08658-389">[Publish Data and Database Objects](../publish/publish-data-and-database-objects.md) </span></span>  
 <span data-ttu-id="08658-390">[Subscribe to Publications](../subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="08658-390">[Subscribe to Publications](../subscribe-to-publications.md) </span></span>  
 <span data-ttu-id="08658-391">[Инициализация подписки](../initialize-a-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="08658-391">[Initialize a Subscription](../initialize-a-subscription.md) </span></span>  
 [<span data-ttu-id="08658-392">Синхронизация данных</span><span class="sxs-lookup"><span data-stu-id="08658-392">Synchronize Data</span></span>](../synchronize-data.md)  
  
  
