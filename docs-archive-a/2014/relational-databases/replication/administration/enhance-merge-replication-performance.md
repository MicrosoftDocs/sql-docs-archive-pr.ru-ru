---
title: Повышение производительности репликации слиянием | Документация Майкрософт
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], design and performance
- designing databases [SQL Server], replication performance
- Merge Agent, performance
- snapshots [SQL Server replication], performance considerations
- merge replication performance [SQL Server replication]
- subscriptions [SQL Server replication], performance considerations
- performance [SQL Server replication], merge replication
- agents [SQL Server replication], performance
ms.assetid: f929226f-b83d-4900-a07c-a62f64527c7f
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 41dc258e9b45e9839ad142e73cb145999d02986c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750779"
---
# <a name="enhance-merge-replication-performance"></a><span data-ttu-id="6a6f0-102">Повышение производительности репликации слиянием</span><span class="sxs-lookup"><span data-stu-id="6a6f0-102">Enhance Merge Replication Performance</span></span>
  <span data-ttu-id="6a6f0-103">После рассмотрения советов по повышению общей производительности, описанных в разделе [Увеличение общей производительности репликации](enhance-general-replication-performance.md), ознакомьтесь с этими дополнительными сведениями, относящимися к репликации слиянием.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-103">After considering the general performance tips described in [Enhancing General Replication Performance](enhance-general-replication-performance.md), consider these additional areas specific to merge replication.</span></span>  
  
## <a name="database-design"></a><span data-ttu-id="6a6f0-104">Структура базы данных</span><span class="sxs-lookup"><span data-stu-id="6a6f0-104">Database Design</span></span>  
  
-   <span data-ttu-id="6a6f0-105">Столбцы индекса, применяемые в фильтрах строк и фильтрах соединения.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-105">Index columns used in row filters and join filters.</span></span>  
  
     <span data-ttu-id="6a6f0-106">При использовании фильтра строк для опубликованной статьи создайте индекс для каждого столбца, используемого в предложении WHERE фильтра.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-106">When you use a row filter on a published article, create an index on each of the columns that is used in the filter's WHERE clause.</span></span> <span data-ttu-id="6a6f0-107">Если индекс отсутствует, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] должен читать каждую строку таблицы, чтобы определить, следует ли включить строку в секцию.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-107">Without an index, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] has to read each row in the table to determine whether the row should be included in the partition.</span></span> <span data-ttu-id="6a6f0-108">При наличии индекса [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] может быстро найти нужные строки.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-108">With an index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can quickly locate which rows should be included.</span></span> <span data-ttu-id="6a6f0-109">Производительность будет наилучшей, если репликация может полностью разрешить предложение WHERE фильтра, используя только лишь индекс.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-109">The fastest processing takes place if replication can fully resolve the WHERE clause of the filter from the index alone.</span></span>  
  
     <span data-ttu-id="6a6f0-110">Важно также индексирование всех столбцов, используемых в фильтре соединения.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-110">Indexing all the columns used in join filters is also important.</span></span> <span data-ttu-id="6a6f0-111">При каждом запуске агент слияния просматривает базовую таблицу, чтобы выяснить, какие строки в родительской таблице и какие строки в связанных таблицах включены в секцию.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-111">Each time the Merge Agent runs, it searches the base table to determine which rows in a parent table and which rows in related tables are included in a partition.</span></span> <span data-ttu-id="6a6f0-112">Благодаря созданию индекса для объединяемых столбцов, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не требуется считывать каждую строку таблицы при каждом запуске агента слияния.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-112">Creating an index on the joined columns avoids having [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] read each row in the table every time the Merge Agent runs.</span></span>  
  
     <span data-ttu-id="6a6f0-113">Дополнительные сведения о фильтрации см. в статье [Фильтрация опубликованных данных для репликации слиянием](../merge/filter-published-data-for-merge-replication.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-113">For more information on filtering, see [Filter Published Data for Merge Replication](../merge/filter-published-data-for-merge-replication.md).</span></span>  
  
-   <span data-ttu-id="6a6f0-114">Рассмотрим чрезмерную нормализацию таблиц, включающих данные с типом «большие объекты» (LOB).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-114">Consider overnormalizing tables that include Large Object (LOB) data types.</span></span>  
  
     <span data-ttu-id="6a6f0-115">При синхронизации агенту слияния может потребоваться считать и передать целую строку данных от издателя или подписчика.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-115">When synchronization occurs, the Merge Agent might need to read and transfer the entire data row from a Publisher or Subscriber.</span></span> <span data-ttu-id="6a6f0-116">Если строка содержит столбцы, использующие большие объекты (LOB), то этот процесс может потребовать выделения дополнительной памяти, и негативно скажется на производительности, хотя эти столбцы могут еще даже не быть обновленными.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-116">If the row contains columns that use LOBs, this process can require additional memory allocation and negatively impact performance even though these columns may not have been updated.</span></span> <span data-ttu-id="6a6f0-117">Чтобы уменьшить вероятность такого влияния на производительность, рассмотрите возможность помещения LOB-столбцов в отдельную таблицу, используя отношение «один к одному» для остальных данных в строке.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-117">To reduce the likelihood that this performance impact occurs, consider putting LOB columns in a separate table using a one-to-one relationship to the rest of the row data.</span></span> <span data-ttu-id="6a6f0-118">Не рекомендуется использовать типы данных `text`, `ntext` и `image`.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-118">The data types `text`, `ntext`, and `image` are deprecated.</span></span> <span data-ttu-id="6a6f0-119">При включении больших объектов (LOB) рекомендуется использовать типы данных `varchar(max)`, `nvarchar(max)`, `varbinary(max)`, соответственно.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-119">If you do include LOBs, we recommend that you use the data types `varchar(max)`, `nvarchar(max)`, `varbinary(max)`, respectively.</span></span>  
  
## <a name="publication-design"></a><span data-ttu-id="6a6f0-120">Разработка публикации</span><span class="sxs-lookup"><span data-stu-id="6a6f0-120">Publication Design</span></span>  
  
-   <span data-ttu-id="6a6f0-121">Используйте публикации с уровнем совместимости 90RTM ([!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] и более поздние версии).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-121">Use a publication compatibility level of 90RTM ([!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version).</span></span>  
  
     <span data-ttu-id="6a6f0-122">Укажите, что публикация должна поддерживать только [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]или более поздние версии, если только один подписчик (или более) не использует версию [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="6a6f0-122">Unless one or more Subscribers use a different version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], specify that the publication must support only [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version.</span></span> <span data-ttu-id="6a6f0-123">Это позволит публикации использовать преимущества новых возможностей и оптимизации производительности.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-123">This allows the publication to take advantage of new features and performance optimizations.</span></span>  
  
-   <span data-ttu-id="6a6f0-124">Используйте соответствующие параметры хранения публикации.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-124">Use appropriate publication retention settings.</span></span>  
  
     <span data-ttu-id="6a6f0-125">Срок хранения публикации, то есть максимальное время до обязательной синхронизации подписки, определяет, как долго сохраняются метаданные отслеживания.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-125">The publication retention period, which is the maximum amount of time before a subscription must be synchronized, determines how long tracking metadata is stored.</span></span> <span data-ttu-id="6a6f0-126">Большое значение может влиять на хранение и производительность.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-126">A high value can affect storage and processing performance.</span></span> <span data-ttu-id="6a6f0-127">Дополнительные сведения о настройке публикации см. в разделе [Subscription Expiration and Deactivation](../subscription-expiration-and-deactivation.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-127">For more information about setting the publication retention period, see [Subscription Expiration and Deactivation](../subscription-expiration-and-deactivation.md).</span></span>  
  
-   <span data-ttu-id="6a6f0-128">При работе с таблицами, которые изменяются только на издателе, используйте статьи, доступные только для загрузки.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-128">Use download-only articles on those tables that are only changed at the Publisher.</span></span> <span data-ttu-id="6a6f0-129">Дополнительные сведения см. в статье [Оптимизация производительности репликации слиянием при работе со статьями, доступными только для загрузки](../merge/optimize-merge-replication-performance-with-download-only-articles.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-129">For more information, see [Optimize Merge Replication Performance with Download-Only Articles](../merge/optimize-merge-replication-performance-with-download-only-articles.md).</span></span>  
  
### <a name="filter-design-and-use"></a><span data-ttu-id="6a6f0-130">Создание и использование фильтров</span><span class="sxs-lookup"><span data-stu-id="6a6f0-130">Filter Design and Use</span></span>  
  
-   <span data-ttu-id="6a6f0-131">Ограничьте сложность предложений в фильтрах строк.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-131">Limit the complexity of row filter clauses.</span></span>  
  
     <span data-ttu-id="6a6f0-132">Ограничение сложности критериев фильтрации способствует повышению производительности, когда агент слияния оценивает изменения строк для отправки подписчикам.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-132">Limiting the complexity of the filtering criteria helps improve performance when the Merge Agent is evaluating row changes to send to Subscribers.</span></span> <span data-ttu-id="6a6f0-133">Избегайте использования вложенных запросов SELECT в предложениях фильтров строк слияния.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-133">Avoid using sub-selects within merge row filter clauses.</span></span> <span data-ttu-id="6a6f0-134">Вместо этого рассмотрите возможность использования фильтров соединения, которые в целом более эффективны для секционирования данных в одной таблице на основе предложения фильтра строк из другой таблицы.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-134">Instead, consider using join filters, which are generally more efficient when used to partition data in one table based on the row filter clause in another table.</span></span> <span data-ttu-id="6a6f0-135">Дополнительные сведения о фильтрации см. в статье [Фильтрация опубликованных данных для репликации слиянием](../merge/filter-published-data-for-merge-replication.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-135">For more information about filtering, see [Filter Published Data for Merge Replication](../merge/filter-published-data-for-merge-replication.md).</span></span>  
  
-   <span data-ttu-id="6a6f0-136">Используйте предварительно вычисляемые секции с параметризованными фильтрами (применяются по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-136">Use precomputed partitions with parameterized filters (this feature is used by default).</span></span> <span data-ttu-id="6a6f0-137">Дополнительные сведения см. в статье [Оптимизация производительности параметризованного фильтра с помощью предварительно вычисляемых секций](../merge/parameterized-filters-optimize-for-precomputed-partitions.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-137">For more information, see [Optimize Parameterized Filter Performance with Precomputed Partitions](../merge/parameterized-filters-optimize-for-precomputed-partitions.md).</span></span>  
  
     <span data-ttu-id="6a6f0-138">Предварительно вычисляемые секции накладывают ряд ограничений на поведение фильтра.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-138">Precomputed partitions impose a number of limits on filtering behavior.</span></span> <span data-ttu-id="6a6f0-139">Если для приложения невозможно соблюдение этих ограничений, установите для параметр **keep_partition_changes** значение **True**, что обеспечит выигрыш в производительности.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-139">If your application cannot adhere to these limitations, set the **keep_partition_changes** option to **True**, which provides a performance benefit.</span></span> <span data-ttu-id="6a6f0-140">Дополнительные сведения см. в разделе [Параметризованные фильтры строк](../merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-140">For more information, see [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="6a6f0-141">Используйте неперекрывающиеся секции, если данные фильтруются, но не являются общими для пользователей.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-141">Use nonoverlapping partitions if data is filtered but not shared among users.</span></span>  
  
     <span data-ttu-id="6a6f0-142">Репликация может оптимизировать производительность для данных, не разделяемых между секциями или подписками.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-142">Replication can optimize performance for data that is not shared between partitions or subscriptions.</span></span> <span data-ttu-id="6a6f0-143">Дополнительные сведения см. в разделе [Параметризованные фильтры строк](../merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-143">For more information, see [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="6a6f0-144">Не создавайте сложные иерархии фильтров соединения.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-144">Do not create complex join filter hierarchies.</span></span>  
  
     <span data-ttu-id="6a6f0-145">Фильтры соединения с пятью и более таблицами могут негативно повлиять на производительность во время процесса слияния.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-145">Join filters with five or more tables can significantly impact performance during merge processing.</span></span> <span data-ttu-id="6a6f0-146">Если создаются фильтры соединения для пяти и более таблиц, рекомендуется рассмотреть другие решения.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-146">We recommend that if you are generating join filters of five or more tables that you consider other solutions:</span></span>  
  
    -   <span data-ttu-id="6a6f0-147">Избегайте фильтрации таблиц, являющихся в основном поисковыми таблицами, небольшими таблицами и таблицами, не подлежащими изменению.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-147">Avoid filtering tables that are primarily lookup tables, smaller tables, and tables that are not subject to change.</span></span> <span data-ttu-id="6a6f0-148">Сделайте эти таблицы все вместе частью публикации.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-148">Make those tables part of the publication in their entirety.</span></span> <span data-ttu-id="6a6f0-149">Рекомендуется использовать фильтры соединения только между теми таблицами, которые должны быть секционированы среди подписчиков.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-149">We recommend that you use join filters only between tables that must be partitioned among Subscribers.</span></span> <span data-ttu-id="6a6f0-150">Дополнительные сведения см. в статье [Join Filters](../merge/join-filters.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-150">For more information, see [Join Filters](../merge/join-filters.md).</span></span>  
  
    -   <span data-ttu-id="6a6f0-151">Рассмотрите возможность денормализации структуры базы данных или использования таблицы сопоставлений, если в соединении присутствует большое число таблиц.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-151">Consider denormalizing the database design or using a mapping table if there are a large number of tables in a join.</span></span> <span data-ttu-id="6a6f0-152">Например, если менеджеру по продажам нужны данные только по его клиентам, но требуется шесть соединений, чтобы связать клиента с продавцом, рассмотрите возможность добавления в таблицу пользователей столбца, идентифицирующего продавца.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-152">For example, if a sales person needs only the data for her customers, but it requires six joins to associate a customer with a sales person, consider adding a column to the customer table that identifies the sales person.</span></span> <span data-ttu-id="6a6f0-153">Данные менеджера по продажам будут избыточны, но затраты на денормализацию таблиц отчасти могут быть компенсированы выигрышем в производительности при секционировании репликации.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-153">The sales person data is redundant, but the costs of denormalizing the tables somewhat might be outweighed by the performance benefits for replication partitioning.</span></span>  
  
    -   <span data-ttu-id="6a6f0-154">Внимательно разрабатывайте приложения для того, чтобы улучшить производительность предварительно вычисляемых секций, когда пакеты содержат много изменяемых данных.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-154">To improve the performance of precomputed partitions when batches contain lots of data changes, design your application with care.</span></span> <span data-ttu-id="6a6f0-155">Убедитесь в том, что изменения данных в фильтре соединения родительской таблицы выполняются перед соответствующими изменениями в дочерних таблицах.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-155">Make sure that changes to data in the parent table in a join filter are made before corresponding changes in the child tables.</span></span>  
  
-   <span data-ttu-id="6a6f0-156">Присвойте параметру **join_unique_key** значение **1** , если это допустимо логически.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-156">Set the **join_unique_key** option to **1** if logic allows.</span></span>  
  
     <span data-ttu-id="6a6f0-157">Установка этого параметра в значение **1** указывает, что связь между дочерней и родительской таблицами в фильтре соединения — «один к одному» или «один ко многим».</span><span class="sxs-lookup"><span data-stu-id="6a6f0-157">Setting this parameter to **1** indicates that the relationship between the child and parent tables in a join filter is one to one or one to many.</span></span> <span data-ttu-id="6a6f0-158">Установите этот параметр в значение **1** , только если на соединяющий столбец в дочерней таблице наложено ограничение, гарантирующее уникальность.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-158">Only set this parameter to **1** if you have a constraint on the joining column in the child table that guarantees uniqueness.</span></span> <span data-ttu-id="6a6f0-159">Если параметр установлен в значение **1** неправильно, конвергенции данных может не произойти.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-159">If the parameter is set to **1** incorrectly, non-convergence of data can occur.</span></span> <span data-ttu-id="6a6f0-160">Дополнительные сведения см. в статье [Join Filters](../merge/join-filters.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-160">For more information, see [Join Filters](../merge/join-filters.md).</span></span>  
  
-   <span data-ttu-id="6a6f0-161">Избегайте выполнения пакетов со многими изменениями при использовании предварительно вычисляемых секций.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-161">Avoid executing batches with lots of changes when you use precomputed partitions.</span></span>  
  
     <span data-ttu-id="6a6f0-162">При выполнении агента слияния после запуска пакета, выполняющего большое количество изменений данных, этот агент пытается разделить большой пакет на более мелкие.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-162">When the Merge Agent is run after you run a batch that contains lots of data changes, the agent tries to divide the large batch into smaller batches.</span></span> <span data-ttu-id="6a6f0-163">Во время этого другие процессы агента слияния могут быть заблокированы.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-163">During this time, other Merge Agent processes may be blocked.</span></span> <span data-ttu-id="6a6f0-164">Рассмотрите возможность уменьшения количества изменений и запускайте агент слияния между обработкой пакетов.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-164">Consider reducing the number of changes in a batch and run the Merge Agent between batches.</span></span> <span data-ttu-id="6a6f0-165">Если это невозможно, увеличьте значение параметра **generation_leveling_threshold** для этой публикации.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-165">If this cannot be done, increase the value of **generation_leveling_threshold** for the publication.</span></span>  
  
## <a name="subscription-considerations"></a><span data-ttu-id="6a6f0-166">Вопросы использования подписок</span><span class="sxs-lookup"><span data-stu-id="6a6f0-166">Subscription Considerations</span></span>  
  
-   <span data-ttu-id="6a6f0-167">Разнесите расписания синхронизации подписок.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-167">Stagger subscription synchronization schedules.</span></span>  
  
     <span data-ttu-id="6a6f0-168">Если с издателем синхронизируется большое число подписчиков, рассмотрите возможность разнесения расписаний так, чтобы агенты слияния запускались в разное время.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-168">If a large number of Subscribers synchronize with a Publisher, consider staggering the schedules so that Merge Agents run at different times.</span></span> <span data-ttu-id="6a6f0-169">Дополнительные сведения см. в статье [Specify Synchronization Schedules](../specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-169">For more information, see [Specify Synchronization Schedules](../specify-synchronization-schedules.md).</span></span>  
  
## <a name="merge-agent-parameters"></a><span data-ttu-id="6a6f0-170">Параметры агента слияния</span><span class="sxs-lookup"><span data-stu-id="6a6f0-170">Merge Agent Parameters</span></span>  
 <span data-ttu-id="6a6f0-171">Дополнительные сведения об агенте слияния и его параметрах см. в разделе [Replication Merge Agent](../agents/replication-merge-agent.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-171">For information about the Merge Agent and its parameters, see [Replication Merge Agent](../agents/replication-merge-agent.md).</span></span>  
  
-   <span data-ttu-id="6a6f0-172">Обновите все подписчики с подписками по запросу до версии [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] или более поздней.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-172">Upgrade all Subscribers for pull subscriptions to [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version.</span></span>  
  
     <span data-ttu-id="6a6f0-173">При обновлении подписчика до [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] или более поздней версии обновляется агент слияния, используемый подписками на подписчике.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-173">Upgrading the Subscriber to [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version upgrades the Merge Agent used by the subscriptions at that Subscriber.</span></span> <span data-ttu-id="6a6f0-174">Чтобы воспользоваться преимуществами множества новых возможностей и оптимизации производительности, необходим агент слияния [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-174">To take advantage of many of the new features and performance optimizations, the Merge Agent from [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version is required.</span></span>  
  
-   <span data-ttu-id="6a6f0-175">Если подписка синхронизируется через быстрое соединение и изменения отправляются с издателя и подписчика, используйте для агента слияния параметр **-ParallelUploadDownload**.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-175">If a subscription is synchronized over a fast connection and changes are sent from the Publisher and Subscriber, use the **-ParallelUploadDownload** parameter for the Merge Agent.</span></span>  
  
     <span data-ttu-id="6a6f0-176">В[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] появился новый параметр агента слияния — **-ParallelUploadDownload**.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-176">[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] introduced a new Merge Agent parameter: **-ParallelUploadDownload**.</span></span> <span data-ttu-id="6a6f0-177">Установка этого параметра позволит агенту слияния одновременно обрабатывать изменения, передаваемые на издатель, и изменения, загружаемые на подписчик.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-177">Setting this parameter allows the Merge Agent to process in parallel the changes uploaded to the Publisher and those downloaded to the Subscriber.</span></span> <span data-ttu-id="6a6f0-178">Это полезно в средах с большими объемами данных и высокой пропускной способностью сети.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-178">This is useful in high volume environments with high network bandwidth.</span></span> <span data-ttu-id="6a6f0-179">Параметры агента могут задаваться в профилях агента или в командной строке.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-179">Agent parameters can be specified in agent profiles and on the command line.</span></span> <span data-ttu-id="6a6f0-180">Дополнительные сведения см. в разделе:</span><span class="sxs-lookup"><span data-stu-id="6a6f0-180">For more information, see:</span></span>  
  
    -   [<span data-ttu-id="6a6f0-181">Работа с профилями агента репликации</span><span class="sxs-lookup"><span data-stu-id="6a6f0-181">Work with Replication Agent Profiles</span></span>](../agents/replication-agent-profiles.md)  
  
    -   [<span data-ttu-id="6a6f0-182">Просмотр и изменение параметров командной строки агента репликации (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="6a6f0-182">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
    -   [<span data-ttu-id="6a6f0-183">Replication Agent Executables Concepts</span><span class="sxs-lookup"><span data-stu-id="6a6f0-183">Replication Agent Executables Concepts</span></span>](../concepts/replication-agent-executables-concepts.md)  
  
-   <span data-ttu-id="6a6f0-184">Попробуйте увеличить значение параметра **-MakeGenerationInterval** , особенно если при синхронизации чаще происходят передачи с подписчиков, нежели загрузки на подписчики.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-184">Consider increasing the value of the **-MakeGenerationInterval** parameter, especially if synchronization involves more uploads from Subscribers than downloads to Subscribers.</span></span>  
  
-   <span data-ttu-id="6a6f0-185">При синхронизации строк данных с большим объемом данных, например со столбцами больших объектов, веб-синхронизация может потребовать дополнительной памяти и привести к снижению производительности.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-185">When you synchronize data rows with a large amount of data, such as rows with LOB columns, Web synchronization can require additional memory allocation and hurt performance.</span></span> <span data-ttu-id="6a6f0-186">Это происходит, когда агент слияния создает XML-сообщение, в котором содержится слишком много строк и большой объем данных.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-186">This occurs when the Merge Agent generates an XML message that contains too many data rows with large amounts of data.</span></span> <span data-ttu-id="6a6f0-187">Если агент слияния потребляет при веб-синхронизации слишком много ресурсов, следует уменьшить число строк, посылаемых в одном сообщении, одним из следующих способов.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-187">If the Merge Agent is consuming too many resources during Web synchronization, reduce the number of rows sent in a single message in one of the following ways:</span></span>  
  
    -   <span data-ttu-id="6a6f0-188">Используйте для агента слияния профиль медленного канала связи.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-188">Use the slow link agent profile for the Merge Agent.</span></span> <span data-ttu-id="6a6f0-189">Дополнительные сведения см. в статье [Replication Agent Profiles](../agents/replication-agent-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-189">For more information, see [Replication Agent Profiles](../agents/replication-agent-profiles.md).</span></span>  
  
    -   <span data-ttu-id="6a6f0-190">Установите для параметров агента слияния **-DownloadGenerationsPerBatch** и **-UploadGenerationsPerBatch** значение 10 или меньше.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-190">Decrease the **-DownloadGenerationsPerBatch** and **-UploadGenerationsPerBatch** parameters for the Merge Agent to a value of 10 or less.</span></span> <span data-ttu-id="6a6f0-191">По умолчанию они равны 50.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-191">The default value of these parameters is 50.</span></span>  
  
## <a name="snapshot-considerations"></a><span data-ttu-id="6a6f0-192">Вопросы использования моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="6a6f0-192">Snapshot Considerations</span></span>  
  
-   <span data-ttu-id="6a6f0-193">Создайте столбец ROWGUIDCOL в больших таблицах до того, как будет создаваться исходный моментальный снимок.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-193">Create a ROWGUIDCOL column on large tables prior to generating the initial snapshot.</span></span>  
  
     <span data-ttu-id="6a6f0-194">Репликация слиянием требует, чтобы у всякой опубликованной таблицы был столбец ROWGUIDCOL.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-194">Merge replication requires that each published table have a ROWGUIDCOL column.</span></span> <span data-ttu-id="6a6f0-195">Если столбца ROWGUIDCOL нет в таблице до того, как агент моментальных снимков создаст файлы исходного моментального снимка, агент должен сначала добавить и заполнить столбец ROWGUIDCOL.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-195">If a ROWGUIDCOL column does not exist in the table before the Snapshot Agent creates the initial snapshot files, the agent must first add and populate the ROWGUIDCOL column.</span></span> <span data-ttu-id="6a6f0-196">Чтобы получить преимущество в производительности при создании моментальных снимков во время репликации слиянием, создайте столбец ROWGUIDCOL для каждой таблицы до выполнения публикации.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-196">To gain a performance advantage when generating snapshots during merge replication, create the ROWGUIDCOL column on each table before publishing.</span></span> <span data-ttu-id="6a6f0-197">У столбца может быть любое имя (**rowguid** используется агентом моментальных снимков по умолчанию), но должны быть следующие характеристики типа данных.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-197">The column can have any name (**rowguid** is used by the Snapshot Agent by default), but must have the following data type characteristics:</span></span>  
  
    -   <span data-ttu-id="6a6f0-198">Тип данных UNIQUEIDENTIFIER.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-198">A data type of UNIQUEIDENTIFIER.</span></span>  
  
    -   <span data-ttu-id="6a6f0-199">Применяется по умолчанию для NEWSEQUENTIALID() или NEWID().</span><span class="sxs-lookup"><span data-stu-id="6a6f0-199">A default of NEWSEQUENTIALID() or NEWID().</span></span> <span data-ttu-id="6a6f0-200">Рекомендуется использовать NEWSEQUENTIALID(), так как эта функция может обеспечить повышенную производительность при внесении и отслеживании изменений.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-200">NEWSEQUENTIALID() is recommended because it can provide increased performance when making and tracking changes.</span></span>  
  
    -   <span data-ttu-id="6a6f0-201">Установлено свойство ROWGUIDCOL.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-201">The ROWGUIDCOL property set.</span></span>  
  
    -   <span data-ttu-id="6a6f0-202">Уникальный индекс столбца.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-202">A unique index on the column.</span></span>  
  
-   <span data-ttu-id="6a6f0-203">Выполните предварительное создание моментальных снимков и/или разрешите подписчикам запрашивать создание и применение моментального снимка при первоначальной синхронизации.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-203">Pre-generate snapshots and/or allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
     <span data-ttu-id="6a6f0-204">Используйте один или оба этих параметра, чтобы предоставить моментальные снимки публикациям, использующим параметризованные фильтры.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-204">Use one or both of these options to provide snapshots for publications that use parameterized filters.</span></span> <span data-ttu-id="6a6f0-205">Если не указать один из этих параметров, подписки будут инициализированы с помощью серии инструкций SELECT и INSERT, а не с использованием программы **bcp** . Этот процесс — гораздо более медленный.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-205">If you do not specify one of these options, subscriptions are initialized using a series of SELECT and INSERT statements, rather than using the **bcp** utility; this process is much slower.</span></span> <span data-ttu-id="6a6f0-206">Дополнительные сведения см. в статье [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-206">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
## <a name="maintenance-and-monitoring-considerations"></a><span data-ttu-id="6a6f0-207">Советы по обслуживанию и наблюдению</span><span class="sxs-lookup"><span data-stu-id="6a6f0-207">Maintenance and Monitoring Considerations</span></span>  
  
-   <span data-ttu-id="6a6f0-208">Выполняйте время от времени повторную индексацию системных таблиц репликации слиянием.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-208">Occasionally re-index merge replication system tables.</span></span>  
  
     <span data-ttu-id="6a6f0-209">Обслуживая репликацию слиянием, иногда проверяйте увеличение размера системных таблиц, связанных с репликацией слиянием: **MSmerge_contents**, **MSmerge_genhistory**, **MSmerge_tombstone**, **MSmerge_current_partition_mappings**и **MSmerge_past_partition_mappings**.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-209">As part of maintenance for merge replication, occasionally check the growth of the system tables associated with merge replication: **MSmerge_contents**, **MSmerge_genhistory**, and **MSmerge_tombstone**, **MSmerge_current_partition_mappings**, and **MSmerge_past_partition_mappings**.</span></span> <span data-ttu-id="6a6f0-210">Время от времени проводите повторную индексацию этих таблиц.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-210">Periodically re-index these tables.</span></span> <span data-ttu-id="6a6f0-211">Дополнительные сведения см. в статье [Реорганизация и перестроение индексов](../../indexes/reorganize-and-rebuild-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-211">For more information, see [Reorganize and Rebuild Indexes](../../indexes/reorganize-and-rebuild-indexes.md).</span></span>  
  
-   <span data-ttu-id="6a6f0-212">Наблюдайте за производительностью синхронизации с помощью вкладки **Журнал синхронизации** монитора репликации.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-212">Monitor synchronization performance using the **Synchronization History** tab in Replication Monitor.</span></span>  
  
     <span data-ttu-id="6a6f0-213">Для репликации слиянием монитор репликации отображает подробную статистику на вкладке **Журнал синхронизации** для каждой статьи, обработанной в процессе синхронизации, включая время, затраченное на каждую стадию обработки (передача изменений, загрузка изменений и т. д.).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-213">For merge replication, Replication Monitor displays detailed statistics in the **Synchronization History** tab for each article processed during synchronization, including the amount of time spent in each processing phase (uploading changes, downloading changes, and so on).</span></span> <span data-ttu-id="6a6f0-214">С помощью монитора репликации можно обнаружить особые таблицы, вызывающие замедление, к тому же, в мониторе репликации удобно устранять проблемы, связанные с производительностью подписок на публикацию слиянием.</span><span class="sxs-lookup"><span data-stu-id="6a6f0-214">It can help pinpoint specific tables that are causing slow downs and is the best place to troubleshoot performance issues with merge subscriptions.</span></span> <span data-ttu-id="6a6f0-215">Дополнительные сведения о просмотре подробной статистики см. в статье [Просмотр сведений и выполнение задач с помощью монитора репликации](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="6a6f0-215">For more information on viewing detailed statistics, see [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
  
