---
title: Создание принудительной подписки | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- push subscriptions [SQL Server replication], creating
- merge replication subscribing [SQL Server replication], push subscriptions
- subscriptions [SQL Server replication], push
- snapshot replication [SQL Server], subscribing
- transactional replication, subscribing
ms.assetid: adfbbc61-58d1-4330-9ad6-b14ab1142e2b
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2195d96f4337cc60ba213deb5e3cc2831d27da76
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669390"
---
# <a name="create-a-push-subscription"></a><span data-ttu-id="f672b-102">Создание принудительной подписки</span><span class="sxs-lookup"><span data-stu-id="f672b-102">Create a Push Subscription</span></span>
  <span data-ttu-id="f672b-103">В данном разделе описывается процесс создания принудительной подписки в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)]или объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="f672b-103">This topic describes how to create a push subscription in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="f672b-104">Дополнительные сведения о создании принудительной подписки для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] подписчиков, отличных от, см. [в статье Создание подписки для подписчика, не являющегося SQL Server](create-a-subscription-for-a-non-sql-server-subscriber.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-104">For information about creating a push subscription for a non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Subscriber, see [Create a Subscription for a Non-SQL Server Subscriber](create-a-subscription-for-a-non-sql-server-subscriber.md).</span></span>  
  
  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="f672b-105">Использование среды SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="f672b-105">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="f672b-106">Для создания принудительной подписки на издателе или подписчике используется мастера создания подписки.</span><span class="sxs-lookup"><span data-stu-id="f672b-106">Create a push subscription at the Publisher or the Subscriber using the New Subscription Wizard.</span></span> <span data-ttu-id="f672b-107">Следуйте инструкциям на страницах мастера, чтобы выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="f672b-107">Follow the pages in the wizard to:</span></span>  
  
-   <span data-ttu-id="f672b-108">Указать издателя и публикацию.</span><span class="sxs-lookup"><span data-stu-id="f672b-108">Specify the Publisher and publication.</span></span>  
  
-   <span data-ttu-id="f672b-109">Выбрать, где будут выполняться агенты репликации.</span><span class="sxs-lookup"><span data-stu-id="f672b-109">Select where replication agents will run.</span></span> <span data-ttu-id="f672b-110">Для принудительной подписки выберите **Выполнять все агенты на распространителе (принудительные подписки)** на странице **Расположение агента распространителя** или на странице **Расположение агента слияния** в зависимости от типа публикации.</span><span class="sxs-lookup"><span data-stu-id="f672b-110">For a push subscription, select **Run all agents at the Distributor (push subscriptions)** on the **Distribution Agent Location** page or **Merge Agent Location** page, depending on the type of publication.</span></span>  
  
-   <span data-ttu-id="f672b-111">Указать подписчиков и базы данных подписок.</span><span class="sxs-lookup"><span data-stu-id="f672b-111">Specify Subscribers and subscription databases.</span></span>  
  
-   <span data-ttu-id="f672b-112">Указать имена входов и пароли, используемые агентами репликации для подключений:</span><span class="sxs-lookup"><span data-stu-id="f672b-112">Specify the logins and passwords used for connections made by replication agents:</span></span>  
  
    -   <span data-ttu-id="f672b-113">Для подписок на публикации моментальных снимков и публикации транзакций укажите учетные данные на странице **Безопасность агента распространителя** .</span><span class="sxs-lookup"><span data-stu-id="f672b-113">For subscriptions to snapshot and transactional publications, specify credentials on the **Distribution Agent Security** page.</span></span>  
  
    -   <span data-ttu-id="f672b-114">Для подписок на публикации слиянием укажите учетные данные на странице **Безопасность агента слияния** .</span><span class="sxs-lookup"><span data-stu-id="f672b-114">For subscriptions to merge publications, specify credentials on the **Merge Agent Security** page.</span></span>  
  
     <span data-ttu-id="f672b-115">Дополнительные сведения о разрешениях, необходимых каждому агенту, см. в разделе [Модель безопасности агента репликации](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-115">For information about the permissions required by each agent, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
-   <span data-ttu-id="f672b-116">Указать расписание синхронизации и время, когда подписчик должен быть инициализирован.</span><span class="sxs-lookup"><span data-stu-id="f672b-116">Specify a synchronization schedule and when the Subscriber should be initialized.</span></span>  
  
-   <span data-ttu-id="f672b-117">Указать дополнительные параметры для публикаций слиянием (тип подписки) и значения для параметризованного фильтра.</span><span class="sxs-lookup"><span data-stu-id="f672b-117">Specify additional options for merge publications: subscription type; and values for parameterized filtering.</span></span>  
  
-   <span data-ttu-id="f672b-118">Укажите дополнительные параметры для публикаций транзакций, позволяющих использовать обновляемые подписки: должны ли подписчики фиксировать изменения на издателе немедленно или записывать их в очередь; учетные данные, используемые для подключения подписчика к издателю.</span><span class="sxs-lookup"><span data-stu-id="f672b-118">Specify additional options for transactional publications that allow updating subscriptions: whether Subscribers should commit changes at the Publisher immediately or write them to a queue; credentials used to connect from the Subscriber to the Publisher.</span></span>  
  
-   <span data-ttu-id="f672b-119">При необходимости создайте скрипт для подписки.</span><span class="sxs-lookup"><span data-stu-id="f672b-119">Optionally script the subscription.</span></span>  
  
#### <a name="to-create-a-push-subscription-from-the-publisher"></a><span data-ttu-id="f672b-120">Создание принудительной подписки с издателя.</span><span class="sxs-lookup"><span data-stu-id="f672b-120">To create a push subscription from the Publisher</span></span>  
  
1.  <span data-ttu-id="f672b-121">Подключитесь к издателю в среде [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], а затем раскройте узел сервера.</span><span class="sxs-lookup"><span data-stu-id="f672b-121">Connect to the Publisher in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="f672b-122">Раскройте папку **Репликация** , а затем папку **Локальные публикации** .</span><span class="sxs-lookup"><span data-stu-id="f672b-122">Expand the **Replication** folder, and then expand the **Local Publications** folder.</span></span>  
  
3.  <span data-ttu-id="f672b-123">Щелкните правой кнопкой мыши публикацию, для которой хотите создать одну или более подписок, затем щелкните **Создать подписку**.</span><span class="sxs-lookup"><span data-stu-id="f672b-123">Right-click the publication for which you want to create one or more subscriptions, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="f672b-124">Выполните инструкции на страницах мастера создания подписки.</span><span class="sxs-lookup"><span data-stu-id="f672b-124">Complete the pages in the New Subscription Wizard.</span></span>  
  
#### <a name="to-create-a-push-subscription-from-the-subscriber"></a><span data-ttu-id="f672b-125">Создание принудительной подписки с подписчика</span><span class="sxs-lookup"><span data-stu-id="f672b-125">To create a push subscription from the Subscriber</span></span>  
  
1.  <span data-ttu-id="f672b-126">Подключитесь к подписчику в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]и раскройте узел сервера.</span><span class="sxs-lookup"><span data-stu-id="f672b-126">Connect to the Subscriber in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="f672b-127">Раскройте папку **Репликация** .</span><span class="sxs-lookup"><span data-stu-id="f672b-127">Expand the **Replication** folder.</span></span>  
  
3.  <span data-ttu-id="f672b-128">Щелкните правой кнопкой мыши папку **Локальные подписки** , затем щелкните **Создать подписку**.</span><span class="sxs-lookup"><span data-stu-id="f672b-128">Right-click the **Local Subscriptions** folder, and then click **New Subscriptions**.</span></span>  
  
4.  <span data-ttu-id="f672b-129">На странице **Публикация** мастера создания подписки выберите **\<Find SQL Server Publisher>** или **\<Find Oracle Publisher>** из раскрывающегося списка **Издатель**.</span><span class="sxs-lookup"><span data-stu-id="f672b-129">On the **Publication** page of the New Subscription Wizard, select **\<Find SQL Server Publisher>** or **\<Find Oracle Publisher>** from the **Publisher** drop-down list.</span></span>  
  
5.  <span data-ttu-id="f672b-130">Соединитесь с издателем в диалоговом окне **Соединение с сервером** .</span><span class="sxs-lookup"><span data-stu-id="f672b-130">Connect to the Publisher in the **Connect to Server** dialog box.</span></span>  
  
6.  <span data-ttu-id="f672b-131">Выберите публикацию на странице **Публикация** .</span><span class="sxs-lookup"><span data-stu-id="f672b-131">Select a publication on the **Publication** page.</span></span>  
  
7.  <span data-ttu-id="f672b-132">Выполните инструкции на страницах мастера создания подписки.</span><span class="sxs-lookup"><span data-stu-id="f672b-132">Complete the pages in the New Subscription Wizard.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="f672b-133">Использование Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="f672b-133">Using Transact-SQL</span></span>  
 <span data-ttu-id="f672b-134">Принудительные подписки могут быть созданы программно, с помощью хранимых процедур репликации.</span><span class="sxs-lookup"><span data-stu-id="f672b-134">Push subscriptions can be created programmatically using replication stored procedures.</span></span> <span data-ttu-id="f672b-135">Какие именно хранимые процедуры будут при этом применяться, зависит от типа публикации, к которой относится подписка.</span><span class="sxs-lookup"><span data-stu-id="f672b-135">The stored procedures used will depend on the type of publication to which the subscription belongs.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="f672b-136">По возможности следует предлагать пользователям вводить учетные данные безопасности во время выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="f672b-136">When possible, prompt users to enter security credentials at run time.</span></span> <span data-ttu-id="f672b-137">В случае необходимости хранения учетных данных в файле скрипта этот файл следует защищать во избежание несанкционированного доступа.</span><span class="sxs-lookup"><span data-stu-id="f672b-137">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="f672b-138">Создание принудительной подписки на публикацию моментальных снимков или транзакций</span><span class="sxs-lookup"><span data-stu-id="f672b-138">To create a push subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="f672b-139">На издателе в базе данных публикации с помощью процедуры [sp_helppublication](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql)проверьте, поддерживает ли публикация принудительные подписки.</span><span class="sxs-lookup"><span data-stu-id="f672b-139">At the Publisher on the publication database, verify that the publication supports push subscriptions by executing [sp_helppublication](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="f672b-140">Если значение **allow_push** равно **1**, то принудительная подписка поддерживается.</span><span class="sxs-lookup"><span data-stu-id="f672b-140">If the value of **allow_push** is **1**, push subscriptions are supported.</span></span>  
  
    -   <span data-ttu-id="f672b-141">Если значение **allow_push** равно **0**, выполните [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql), указав **allow_push** для **@property** и `true` для **@value** .</span><span class="sxs-lookup"><span data-stu-id="f672b-141">If the value of **allow_push** is **0**, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql), specifying **allow_push** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="f672b-142">На издателе в базе данных публикации выполните хранимую процедуру [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f672b-142">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span></span> <span data-ttu-id="f672b-143">Укажите **@publication** , **@subscriber** и **@destination_db** .</span><span class="sxs-lookup"><span data-stu-id="f672b-143">Specify **@publication**, **@subscriber** and **@destination_db**.</span></span> <span data-ttu-id="f672b-144">Укажите значение **push** в **@subscription_type**.</span><span class="sxs-lookup"><span data-stu-id="f672b-144">Specify a value of **push** for **@subscription_type**.</span></span> <span data-ttu-id="f672b-145">Дополнительные сведения об обновлении подписок см. в разделе [Создание обновляемой подписки для публикации транзакций](publish/create-an-updatable-subscription-to-a-transactional-publication.md) .</span><span class="sxs-lookup"><span data-stu-id="f672b-145">For information about how to update subscriptions, see [Create an Updatable Subscription to a Transactional Publication](publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span></span>  
  
3.  <span data-ttu-id="f672b-146">На издателе в базе данных публикации выполните хранимую процедуру [sp_addpushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpushsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f672b-146">At the Publisher on the publication database, execute [sp_addpushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpushsubscription-agent-transact-sql).</span></span> <span data-ttu-id="f672b-147">Укажите следующее.</span><span class="sxs-lookup"><span data-stu-id="f672b-147">Specify the following:</span></span>  
  
    -   <span data-ttu-id="f672b-148">**@subscriber**Параметры, **@subscriber_db** и **@publication** .</span><span class="sxs-lookup"><span data-stu-id="f672b-148">The **@subscriber**, **@subscriber_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="f672b-149">[!INCLUDE[msCoName](../../includes/msconame-md.md)]Учетные данные Windows, с которыми работает агент распространения на распространителе **@job_login** , для и **@job_password** .</span><span class="sxs-lookup"><span data-stu-id="f672b-149">The [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Distributor runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="f672b-150">Соединения, выполняемые с помощью встроенной проверки подлинности Windows, всегда используют учетные данные Windows, указанные в **@job_login** и **@job_password** .</span><span class="sxs-lookup"><span data-stu-id="f672b-150">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="f672b-151">Агент распространителя всегда создает локальные соединения с распространителем через встроенную систему проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f672b-151">The Distribution Agent always makes the local connection to the Distributor using Windows Integrated Authentication.</span></span> <span data-ttu-id="f672b-152">По умолчанию агент подключается к подписчику через встроенную систему проверки подлинности Windows;</span><span class="sxs-lookup"><span data-stu-id="f672b-152">By default, the agent will connect to the Subscriber using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="f672b-153">(необязательно) Значение **0** в **@subscriber_security_mode** и сведения об имени входа [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в параметрах **@subscriber_login** и значение **@subscriber_password**.</span><span class="sxs-lookup"><span data-stu-id="f672b-153">(Optional) A value of **0** for **@subscriber_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@subscriber_login** and **@subscriber_password**.</span></span> <span data-ttu-id="f672b-154">Эти параметры указываются в том случае, если при соединении с подписчиком необходимо использовать проверку подлинности SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f672b-154">Specify these parameters if you need to use SQL Server Authentication when connecting to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="f672b-155">Расписание задания агента распространителя для этой подписки.</span><span class="sxs-lookup"><span data-stu-id="f672b-155">A schedule for the Distribution Agent job for this subscription.</span></span> <span data-ttu-id="f672b-156">Дополнительные сведения см. в статье [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-156">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="f672b-157">При создании принудительной подписки на издателе с удаленным распространителем значения, указываемые для всех параметров, включая *job_login* и *job_password*, передаются распространителю в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="f672b-157">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="f672b-158">Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="f672b-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="f672b-159">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-merge-publication"></a><span data-ttu-id="f672b-160">Создание принудительной подписки на публикацию слиянием</span><span class="sxs-lookup"><span data-stu-id="f672b-160">To create a push subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="f672b-161">На издателе в базе данных публикации при помощи процедуры [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql)проверьте, поддерживает ли публикация принудительные подписки.</span><span class="sxs-lookup"><span data-stu-id="f672b-161">At the Publisher on the publication database, verify that the publication supports push subscriptions by executing [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="f672b-162">Если значение **allow_push** равно **1**, то публикацией принудительные подписки поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="f672b-162">If the value of **allow_push** is **1**, the publication supports push subscriptions.</span></span>  
  
    -   <span data-ttu-id="f672b-163">Если значение **allow_push** не равно **1**, выполните [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql), указав **allow_push** для **@property** и `true` для **@value** .</span><span class="sxs-lookup"><span data-stu-id="f672b-163">If the value of **allow_push** is not **1**, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql), specifying **allow_push** for **@property** and `true` for **@value**.</span></span>  
  
2.  <span data-ttu-id="f672b-164">На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql), указав следующие параметры.</span><span class="sxs-lookup"><span data-stu-id="f672b-164">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql), specifying the following parameters:</span></span>  
  
    -   <span data-ttu-id="f672b-165">**@publication**.</span><span class="sxs-lookup"><span data-stu-id="f672b-165">**@publication**.</span></span> <span data-ttu-id="f672b-166">Имя публикации.</span><span class="sxs-lookup"><span data-stu-id="f672b-166">This is the name of the publication.</span></span>  
  
    -   <span data-ttu-id="f672b-167">**@subscriber_type**.</span><span class="sxs-lookup"><span data-stu-id="f672b-167">**@subscriber_type**.</span></span> <span data-ttu-id="f672b-168">Для клиентской подписки укажите **local** , а для серверной — **global**.</span><span class="sxs-lookup"><span data-stu-id="f672b-168">For a client subscription, specify **local** and for a server subscription, specify **global**.</span></span>  
  
    -   <span data-ttu-id="f672b-169">**@subscription_priority**.</span><span class="sxs-lookup"><span data-stu-id="f672b-169">**@subscription_priority**.</span></span> <span data-ttu-id="f672b-170">Для серверной подписки укажите приоритет подписки (в диапазоне от**0.00** до **99.99**).</span><span class="sxs-lookup"><span data-stu-id="f672b-170">For a server subscription, specify a priority for the subscription (**0.00** to **99.99**).</span></span>  
  
         <span data-ttu-id="f672b-171">Дополнительные сведения см. в разделе [Advanced Merge Replication Conflict Detection and Resolution](merge/advanced-merge-replication-conflict-detection-and-resolution.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-171">For more information, see [Advanced Merge Replication Conflict Detection and Resolution](merge/advanced-merge-replication-conflict-detection-and-resolution.md).</span></span>  
  
3.  <span data-ttu-id="f672b-172">На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepushsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f672b-172">At the Publisher on the publication database, execute [sp_addmergepushsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepushsubscription-agent-transact-sql).</span></span> <span data-ttu-id="f672b-173">Укажите следующее.</span><span class="sxs-lookup"><span data-stu-id="f672b-173">Specify the following:</span></span>  
  
    -   <span data-ttu-id="f672b-174">**@subscriber**Параметры, **@subscriber_db** и **@publication** .</span><span class="sxs-lookup"><span data-stu-id="f672b-174">The **@subscriber**, **@subscriber_db**, and **@publication** parameters.</span></span>  
  
    -   <span data-ttu-id="f672b-175">Учетные данные Windows, с которыми работает агент слияния на распространителе **@job_login** , для и **@job_password** .</span><span class="sxs-lookup"><span data-stu-id="f672b-175">The Windows credentials under which the Merge Agent at the Distributor runs for **@job_login** and **@job_password**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="f672b-176">Соединения, выполняемые с помощью встроенной проверки подлинности Windows, всегда используют учетные данные Windows, указанные в **@job_login** и **@job_password** .</span><span class="sxs-lookup"><span data-stu-id="f672b-176">Connections made using Windows Integrated Authentication always use the Windows credentials specified by **@job_login** and **@job_password**.</span></span> <span data-ttu-id="f672b-177">Агент слияния всегда создает локальные соединения с распространителем через встроенную систему проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f672b-177">The Merge Agent always makes the local connection to the Distributor using Windows Integrated Authentication.</span></span> <span data-ttu-id="f672b-178">По умолчанию агент подключается к подписчику через встроенную систему проверки подлинности Windows;</span><span class="sxs-lookup"><span data-stu-id="f672b-178">By default, the agent will connect to the Subscriber using Windows Integrated Authentication.</span></span>  
  
    -   <span data-ttu-id="f672b-179">(необязательно) Значение **0** в **@subscriber_security_mode** и сведения об имени входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в параметрах **@subscriber_login** и значение **@subscriber_password**.</span><span class="sxs-lookup"><span data-stu-id="f672b-179">(Optional) A value of **0** for **@subscriber_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@subscriber_login** and **@subscriber_password**.</span></span> <span data-ttu-id="f672b-180">Эти параметры указываются в том случае, если при соединении с подписчиком необходимо использовать проверку подлинности SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f672b-180">Specify these parameters if you need to use SQL Server Authentication when connecting to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="f672b-181">(необязательно) Значение **0** в **@publisher_security_mode** и сведения об имени входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в параметрах **@publisher_login** и значение **@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="f672b-181">(Optional) A value of **0** for **@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **@publisher_login** and **@publisher_password**.</span></span> <span data-ttu-id="f672b-182">Эти параметры указываются в том случае, если при соединении с издателем необходимо использовать проверку подлинности SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f672b-182">Specify these values if you need to use SQL Server Authentication when connecting to the Publisher.</span></span>  
  
    -   <span data-ttu-id="f672b-183">Расписание агента слияния для данной подписки.</span><span class="sxs-lookup"><span data-stu-id="f672b-183">A schedule for the Merge Agent job for this subscription.</span></span> <span data-ttu-id="f672b-184">Дополнительные сведения см. в статье [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-184">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="f672b-185">При создании принудительной подписки на издателе с удаленным распространителем значения, указываемые для всех параметров, включая *job_login* и *job_password*, передаются распространителю в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="f672b-185">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="f672b-186">Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="f672b-186">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="f672b-187">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-187">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="f672b-188">Примеры (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f672b-188">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="f672b-189">В следующем примере создается принудительная подписка на публикацию транзакций.</span><span class="sxs-lookup"><span data-stu-id="f672b-189">The following example creates a push subscription to a transactional publication.</span></span> <span data-ttu-id="f672b-190">Значения для имени входа и пароля передаются во время выполнения в переменных скрипта **sqlcmd** .</span><span class="sxs-lookup"><span data-stu-id="f672b-190">Login and password values are supplied at run time by using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addtranpushsubscription_agent](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpushsub.sql#sp_addtranpushsubscription_agent)]  
  
 <span data-ttu-id="f672b-191">В следующем примере создается принудительная подписка на публикацию слиянием.</span><span class="sxs-lookup"><span data-stu-id="f672b-191">The following example creates a push subscription to a merge publication.</span></span> <span data-ttu-id="f672b-192">Значения для имени входа и пароля передаются во время выполнения в переменных скрипта **sqlcmd** .</span><span class="sxs-lookup"><span data-stu-id="f672b-192">Login and password values are supplied at run time by using **sqlcmd** scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_addmergepushsubscriptionagent](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepushsub.sql#sp_addmergepushsubscriptionagent)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="f672b-193">При помощи объектов RMO</span><span class="sxs-lookup"><span data-stu-id="f672b-193">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="f672b-194">Принудительные подписки можно создавать программно с помощью объектов RMO.</span><span class="sxs-lookup"><span data-stu-id="f672b-194">You can create push subscriptions programmatically by using Replication Management Objects (RMO).</span></span> <span data-ttu-id="f672b-195">Конкретные классы объектов RMO, используемые для этого, зависят от типа публикации, для которой создается подписка.</span><span class="sxs-lookup"><span data-stu-id="f672b-195">The RMO classes you use to create a push subscription depend on the type of publication to which the subscription is created.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="f672b-196">По возможности предлагайте пользователям вводить учетные данные системы безопасности во время выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="f672b-196">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="f672b-197">Если необходимо хранить учетные данные, используйте [службы шифрования](https://go.microsoft.com/fwlink/?LinkId=34733) , предоставляемые платформой [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f672b-197">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-snapshot-or-transactional-publication"></a><span data-ttu-id="f672b-198">Создание принудительной подписки на публикацию моментальных снимков или транзакций</span><span class="sxs-lookup"><span data-stu-id="f672b-198">To create a push subscription to a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="f672b-199">Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="f672b-199">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="f672b-200">На основе соединения с издателем, созданного на шаге 1, создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.TransPublication> .</span><span class="sxs-lookup"><span data-stu-id="f672b-200">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="f672b-201">Задайте свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>и <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="f672b-201">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="f672b-202">Вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="f672b-202">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="f672b-203">Если этот метод возвращает значение `false`, то на шаге 2 свойствам были присвоены неверные значения, или публикация на сервере не существует.</span><span class="sxs-lookup"><span data-stu-id="f672b-203">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exists on the server.</span></span>  
  
4.  <span data-ttu-id="f672b-204">Выполните операцию «поразрядное логическое И» (`&` в Visual C# и `And` в Visual Basic) над свойством <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> и флагом <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span><span class="sxs-lookup"><span data-stu-id="f672b-204">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="f672b-205">Если результат равен <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, присвойте свойству <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> результат операции «поразрядное логическое ИЛИ» (`|` в Visual C# и `Or` в Visual Basic) над свойством <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> и флагом <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span><span class="sxs-lookup"><span data-stu-id="f672b-205">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="f672b-206">Затем вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> , чтобы включить принудительные подписки.</span><span class="sxs-lookup"><span data-stu-id="f672b-206">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable push subscriptions.</span></span>  
  
5.  <span data-ttu-id="f672b-207">Если база данных подписки не существует, создайте ее с помощью класса <xref:Microsoft.SqlServer.Management.Smo.Database> .</span><span class="sxs-lookup"><span data-stu-id="f672b-207">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="f672b-208">Дополнительные сведения см. в статье [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md) (Создание, изменение и удаление баз данных).</span><span class="sxs-lookup"><span data-stu-id="f672b-208">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="f672b-209">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.TransSubscription>.</span><span class="sxs-lookup"><span data-stu-id="f672b-209">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransSubscription> class.</span></span>  
  
7.  <span data-ttu-id="f672b-210">Укажите следующие свойства подписки:</span><span class="sxs-lookup"><span data-stu-id="f672b-210">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="f672b-211">соединение ( <xref:Microsoft.SqlServer.Management.Common.ServerConnection> ) с издателем, созданное на шаге 1, в свойстве <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>;</span><span class="sxs-lookup"><span data-stu-id="f672b-211">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Publisher created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="f672b-212">имя базы данных подписки в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f672b-212">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="f672b-213">имя подписчика в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f672b-213">Name of the Subscriber for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>.</span></span>  
  
    -   <span data-ttu-id="f672b-214">имя базы данных публикации в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f672b-214">Name of the publication database for <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="f672b-215">имя публикации в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f672b-215">Name of the publication for <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="f672b-216">данные учетной записи пользователя [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows, от имени которого на распространителе будет запущен агент распространителя, в свойствах <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A>, <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> или <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> объекта <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>.</span><span class="sxs-lookup"><span data-stu-id="f672b-216">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Distribution Agent runs at the Distributor.</span></span> <span data-ttu-id="f672b-217">Эта учетная запись будет использоваться для создания локальных соединений с распространителем и удаленных с использованием проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f672b-217">This account is used to make local connections to the Distributor and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="f672b-218">Указывать свойство <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> необязательно, если подписка создается членом предопределенной роли сервера `sysadmin`, однако рекомендуется это сделать.</span><span class="sxs-lookup"><span data-stu-id="f672b-218">Setting <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="f672b-219">В этом случае агент будет выполнять олицетворение учетную запись агента SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f672b-219">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="f672b-220">Дополнительные сведения см. в статье [Модель безопасности агента репликации](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-220">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="f672b-221">(необязательно) значение `true` в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> (задано по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="f672b-221">(Optional) A value of `true` (the default) for <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="f672b-222">Если будет присвоено значение `false`, подписку можно будет синхронизировать только программно.</span><span class="sxs-lookup"><span data-stu-id="f672b-222">If you specify `false`, the subscription can only be synchronized programmatically.</span></span>  
  
    -   <span data-ttu-id="f672b-223">(необязательно) при соединении с подписчиком с проверкой подлинности SQL Server укажите значения свойств <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> и <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> или <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> объекта <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> .</span><span class="sxs-lookup"><span data-stu-id="f672b-223">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> when using SQL Server Authentication to connect to the Subscriber.</span></span>  
  
8.  <span data-ttu-id="f672b-224">Вызовите метод <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="f672b-224">Call the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="f672b-225">При создании принудительной подписки на издателе с удаленным распространителем значения, заданные для всех свойств, включая <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>, отправляются распространителю в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="f672b-225">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="f672b-226">Перед вызовом метода <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> следует зашифровать подключение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="f672b-226">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span> <span data-ttu-id="f672b-227">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-227">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
#### <a name="to-create-a-push-subscription-to-a-merge-publication"></a><span data-ttu-id="f672b-228">Создание принудительной подписки на публикацию слиянием</span><span class="sxs-lookup"><span data-stu-id="f672b-228">To create a push subscription to a merge publication</span></span>  
  
1.  <span data-ttu-id="f672b-229">Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="f672b-229">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="f672b-230">На основе соединения с издателем, созданного на шаге 1, создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePublication> .</span><span class="sxs-lookup"><span data-stu-id="f672b-230">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class by using the Publisher connection from step 1.</span></span> <span data-ttu-id="f672b-231">Задайте свойства <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>и <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="f672b-231">Specify <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>, <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>, and <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
3.  <span data-ttu-id="f672b-232">Вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="f672b-232">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="f672b-233">Если этот метод возвращает значение `false`, то на шаге 2 свойствам были присвоены неверные значения, или публикация на сервере не существует.</span><span class="sxs-lookup"><span data-stu-id="f672b-233">If this method returns `false`, either the properties specified in step 2 are incorrect or the publication does not exists on the server.</span></span>  
  
4.  <span data-ttu-id="f672b-234">Выполните операцию «поразрядное логическое И» (`&` в Visual C# и `And` в Visual Basic) над свойством <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> и флагом <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span><span class="sxs-lookup"><span data-stu-id="f672b-234">Perform a bitwise logical AND (`&` in Visual C# and `And` in Visual Basic) between the <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> property and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="f672b-235">Если результат равен <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, присвойте свойству <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> результат операции «поразрядное логическое ИЛИ» (`|` в Visual C# и `Or` в Visual Basic) над свойством <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> и флагом <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span><span class="sxs-lookup"><span data-stu-id="f672b-235">If the result is <xref:Microsoft.SqlServer.Replication.PublicationAttributes.None>, set <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> to the result of a bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) between <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A> and <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowPush>.</span></span> <span data-ttu-id="f672b-236">Затем вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> , чтобы включить принудительные подписки.</span><span class="sxs-lookup"><span data-stu-id="f672b-236">Then, call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> to enable push subscriptions.</span></span>  
  
5.  <span data-ttu-id="f672b-237">Если база данных подписки не существует, создайте ее с помощью класса <xref:Microsoft.SqlServer.Management.Smo.Database> .</span><span class="sxs-lookup"><span data-stu-id="f672b-237">If the subscription database does not exist, create it by using the <xref:Microsoft.SqlServer.Management.Smo.Database> class.</span></span> <span data-ttu-id="f672b-238">Дополнительные сведения см. в статье [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md) (Создание, изменение и удаление баз данных).</span><span class="sxs-lookup"><span data-stu-id="f672b-238">For more information, see [Creating, Altering, and Removing Databases](../server-management-objects-smo/tasks/creating-altering-and-removing-databases.md).</span></span>  
  
6.  <span data-ttu-id="f672b-239">Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergeSubscription>.</span><span class="sxs-lookup"><span data-stu-id="f672b-239">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeSubscription> class.</span></span>  
  
7.  <span data-ttu-id="f672b-240">Укажите следующие свойства подписки:</span><span class="sxs-lookup"><span data-stu-id="f672b-240">Set the following subscription properties:</span></span>  
  
    -   <span data-ttu-id="f672b-241">соединение ( <xref:Microsoft.SqlServer.Management.Common.ServerConnection> ) с издателем, созданное на шаге 1, в свойстве <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>;</span><span class="sxs-lookup"><span data-stu-id="f672b-241">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> to the Publisher created in step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="f672b-242">имя базы данных подписки в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f672b-242">Name of the subscription database for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A>.</span></span>  
  
    -   <span data-ttu-id="f672b-243">имя подписчика в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f672b-243">Name of the Subscriber for <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>.</span></span>  
  
    -   <span data-ttu-id="f672b-244">имя базы данных публикации в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f672b-244">Name of the publication database for <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="f672b-245">имя публикации в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>;</span><span class="sxs-lookup"><span data-stu-id="f672b-245">Name of the publication for <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="f672b-246">данные учетной записи пользователя [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows, от имени которого на распространителе будет запущен агент слияния, в свойствах <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A>, <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> или <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> объекта <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>.</span><span class="sxs-lookup"><span data-stu-id="f672b-246">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> or <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.SecurePassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Merge Agent runs at the Distributor.</span></span> <span data-ttu-id="f672b-247">Эта учетная запись будет использоваться для создания локальных соединений с распространителем и удаленных с использованием проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f672b-247">This account is used to make local connections to the Distributor and to make remote connections using Windows Authentication.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="f672b-248">Указывать свойство <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> необязательно, если подписка создается членом предопределенной роли сервера `sysadmin`, однако рекомендуется это сделать.</span><span class="sxs-lookup"><span data-stu-id="f672b-248">Setting <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A> is not required when the subscription is created by a member of the `sysadmin` fixed server role, however it is recommended.</span></span> <span data-ttu-id="f672b-249">В этом случае агент будет выполнять олицетворение учетную запись агента SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f672b-249">In this case, the agent will impersonate the SQL Server Agent account.</span></span> <span data-ttu-id="f672b-250">Дополнительные сведения см. в статье [Модель безопасности агента репликации](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-250">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
    -   <span data-ttu-id="f672b-251">(необязательно) значение `true` в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> (задано по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="f672b-251">(Optional) A value of `true` (the default) for <xref:Microsoft.SqlServer.Replication.Subscription.CreateSyncAgentByDefault%2A> to create an agent job that is used to synchronize the subscription.</span></span> <span data-ttu-id="f672b-252">Если будет присвоено значение `false`, подписку можно будет синхронизировать только программно.</span><span class="sxs-lookup"><span data-stu-id="f672b-252">If you specify `false`, the subscription can only be synchronized programmatically.</span></span>  
  
    -   <span data-ttu-id="f672b-253">(необязательно) при соединении с подписчиком с проверкой подлинности SQL Server укажите значения свойств <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> и <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> или <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> объекта <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> .</span><span class="sxs-lookup"><span data-stu-id="f672b-253">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> when using SQL Server Authentication to connect to the Subscriber.</span></span>  
  
    -   <span data-ttu-id="f672b-254">(необязательно) при соединении с издателем с проверкой подлинности SQL Server укажите значения свойств <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> и <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> или <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> объекта <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> .</span><span class="sxs-lookup"><span data-stu-id="f672b-254">(Optional) Set the <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> and <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> or <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SecureSqlStandardPassword%2A> fields of <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> when using SQL Server Authentication to connect to the Publisher.</span></span>  
  
8.  <span data-ttu-id="f672b-255">Вызовите метод <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="f672b-255">Call the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="f672b-256">При создании принудительной подписки на издателе с удаленным распространителем значения, заданные для всех свойств, включая <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>, отправляются распространителю в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="f672b-256">When creating a push subscription at a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="f672b-257">Перед вызовом метода <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> следует зашифровать подключение между издателем и его удаленным распространителем.</span><span class="sxs-lookup"><span data-stu-id="f672b-257">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Subscription.Create%2A> method.</span></span> <span data-ttu-id="f672b-258">Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="f672b-258">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="f672b-259">Примеры (объекты RMO)</span><span class="sxs-lookup"><span data-stu-id="f672b-259">Examples (RMO)</span></span>  
 <span data-ttu-id="f672b-260">В следующем примере создается принудительная подписка на публикацию транзакций.</span><span class="sxs-lookup"><span data-stu-id="f672b-260">This example creates a new push subscription to a transactional publication.</span></span> <span data-ttu-id="f672b-261">Данные учетной записи Windows для задания агента распространителя предоставляются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f672b-261">The Windows account credentials you use to run the Distribution Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateTranPushSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createtranpushsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateTranPushSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createtranpushsub)]  
  
 <span data-ttu-id="f672b-262">В следующем примере создается принудительная подписка на публикацию слиянием.</span><span class="sxs-lookup"><span data-stu-id="f672b-262">This example creates a new push subscription to a merge publication.</span></span> <span data-ttu-id="f672b-263">Данные учетной записи Windows для задания агента слияния предоставляются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="f672b-263">The Windows account credentials you use to run the Merge Agent job are passed at runtime.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePushSub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepushsub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePushSub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepushsub)]  
  
## <a name="see-also"></a><span data-ttu-id="f672b-264">См. также:</span><span class="sxs-lookup"><span data-stu-id="f672b-264">See Also</span></span>  
 <span data-ttu-id="f672b-265">[Просмотр и изменение свойств принудительной подписки](view-and-modify-push-subscription-properties.md) </span><span class="sxs-lookup"><span data-stu-id="f672b-265">[View and Modify Push Subscription Properties](view-and-modify-push-subscription-properties.md) </span></span>  
 <span data-ttu-id="f672b-266">[Replication Security Best Practices](security/replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="f672b-266">[Replication Security Best Practices](security/replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="f672b-267">[Create a Publication](publish/create-a-publication.md) </span><span class="sxs-lookup"><span data-stu-id="f672b-267">[Create a Publication](publish/create-a-publication.md) </span></span>  
 <span data-ttu-id="f672b-268">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="f672b-268">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 <span data-ttu-id="f672b-269">[Синхронизация принудительной подписки](synchronize-a-push-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="f672b-269">[Synchronize a Push Subscription](synchronize-a-push-subscription.md) </span></span>  
 <span data-ttu-id="f672b-270">[Subscribe to Publications](subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="f672b-270">[Subscribe to Publications](subscribe-to-publications.md) </span></span>  
 [<span data-ttu-id="f672b-271">Использование программы sqlcmd с переменными скрипта</span><span class="sxs-lookup"><span data-stu-id="f672b-271">Use sqlcmd with Scripting Variables</span></span>](../scripting/sqlcmd-use-with-scripting-variables.md)  
  
  
