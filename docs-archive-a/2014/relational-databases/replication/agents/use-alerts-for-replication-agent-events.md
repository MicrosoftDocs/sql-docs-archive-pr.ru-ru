---
title: Использование предупреждений для событий агента репликации | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- viewing alerts
- Queue Reader Agent, alerts
- alerts [SQL Server replication]
- predefined replication alerts [SQL Server replication]
- Log Reader Agent, alerts
- Distribution Agent, alerts
- Merge Agent, alerts
- agents [SQL Server replication], alerts
- displaying alerts
- Snapshot Agent, alerts
ms.assetid: 8c42e523-7020-471d-8977-a0bd044b9471
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 9d3e30c0a8768a872dc86745ef986faec509c3c6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655660"
---
# <a name="use-alerts-for-replication-agent-events"></a><span data-ttu-id="99fdd-102">Используйте предупреждения для событий агента репликации</span><span class="sxs-lookup"><span data-stu-id="99fdd-102">Use Alerts for Replication Agent Events</span></span>
  <span data-ttu-id="99fdd-103">Среда [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] и агент [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предоставляют способ наблюдения за событиями (например, событиями агента репликации) с использованием предупреждений.</span><span class="sxs-lookup"><span data-stu-id="99fdd-103">[!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] and [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent provide a way to monitor events, such as replication agent events, using alerts.</span></span> <span data-ttu-id="99fdd-104">Агент[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] отслеживает в журнале приложений Windows события, связанные с предупреждениями.</span><span class="sxs-lookup"><span data-stu-id="99fdd-104">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent monitors the Windows application log for events that are associated with alerts.</span></span> <span data-ttu-id="99fdd-105">При наступлении события агент [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] автоматически реагирует на него, выполняя определенную пользователем задачу или отправляя сообщения на электронную почту или на пейджер указанного оператора.</span><span class="sxs-lookup"><span data-stu-id="99fdd-105">If such an event occurs, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent responds automatically, by executing a task that you have defined and/or sending e-mail or a pager message to a specified operator.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="99fdd-106">содержит набор стандартных предупреждений для агентов репликации, которые можно настроить для выполнения задачи или уведомления оператора.</span><span class="sxs-lookup"><span data-stu-id="99fdd-106">includes a set of predefined alerts for replication agents that you can configure to execute a task and/or notify an operator.</span></span> <span data-ttu-id="99fdd-107">Дополнительные сведения об определении выполняемых задач см. в подразделе «Автоматизация отклика на предупреждение» этого раздела.</span><span class="sxs-lookup"><span data-stu-id="99fdd-107">For more information about defining a task to execute, see the section "Automating a Response to an Alert" in this topic.</span></span>  
  
 <span data-ttu-id="99fdd-108">При настройке компьютера в качестве распространителя производится установка следующих предупреждений.</span><span class="sxs-lookup"><span data-stu-id="99fdd-108">The following alerts are installed when a computer is configured as a Distributor:</span></span>  
  
|<span data-ttu-id="99fdd-109">Идентификатор сообщения</span><span class="sxs-lookup"><span data-stu-id="99fdd-109">Message ID</span></span>|<span data-ttu-id="99fdd-110">Стандартное предупреждение</span><span class="sxs-lookup"><span data-stu-id="99fdd-110">Predefined alert</span></span>|<span data-ttu-id="99fdd-111">Условие, вызывающее предупреждение</span><span class="sxs-lookup"><span data-stu-id="99fdd-111">Condition causing the alert to fire</span></span>|<span data-ttu-id="99fdd-112">Наличие дополнительных сведений в msdb..sysreplicationalerts</span><span class="sxs-lookup"><span data-stu-id="99fdd-112">Enters additional information in msdb..sysreplicationalerts</span></span>|  
|----------------|----------------------|-----------------------------------------|-----------------------------------------------------------------|  
|<span data-ttu-id="99fdd-113">14150</span><span class="sxs-lookup"><span data-stu-id="99fdd-113">14150</span></span>|<span data-ttu-id="99fdd-114">**Репликация: успех агента**</span><span class="sxs-lookup"><span data-stu-id="99fdd-114">**Replication: agent success**</span></span>|<span data-ttu-id="99fdd-115">Успешное завершение работы агента.</span><span class="sxs-lookup"><span data-stu-id="99fdd-115">Agent shuts down successfully.</span></span>|<span data-ttu-id="99fdd-116">Да</span><span class="sxs-lookup"><span data-stu-id="99fdd-116">Yes</span></span>|  
|<span data-ttu-id="99fdd-117">14151</span><span class="sxs-lookup"><span data-stu-id="99fdd-117">14151</span></span>|<span data-ttu-id="99fdd-118">**Репликация: неудача агента**</span><span class="sxs-lookup"><span data-stu-id="99fdd-118">**Replication: agent failure**</span></span>|<span data-ttu-id="99fdd-119">Работа агента завершена с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="99fdd-119">Agent shuts down with an error.</span></span>|<span data-ttu-id="99fdd-120">Да</span><span class="sxs-lookup"><span data-stu-id="99fdd-120">Yes</span></span>|  
|<span data-ttu-id="99fdd-121">14152</span><span class="sxs-lookup"><span data-stu-id="99fdd-121">14152</span></span>|<span data-ttu-id="99fdd-122">**Репликация: повторная попытка агента**</span><span class="sxs-lookup"><span data-stu-id="99fdd-122">**Replication: agent retry**</span></span>|<span data-ttu-id="99fdd-123">Агент завершает работу после неудачной повторной попытки выполнения операции (агент обнаружил ошибку: например, сервер недоступен, взаимоблокировка, сбой подключения, ошибка времени ожидания).</span><span class="sxs-lookup"><span data-stu-id="99fdd-123">Agent shuts down after unsuccessfully retrying an operation (agent encounters an error such as server not available, deadlock, connection failure, or time-out failure).</span></span>|<span data-ttu-id="99fdd-124">Да</span><span class="sxs-lookup"><span data-stu-id="99fdd-124">Yes</span></span>|  
|<span data-ttu-id="99fdd-125">14157</span><span class="sxs-lookup"><span data-stu-id="99fdd-125">14157</span></span>|<span data-ttu-id="99fdd-126">**Репликация: истекшая подписка удалена**</span><span class="sxs-lookup"><span data-stu-id="99fdd-126">**Replication: expired subscription dropped**</span></span>|<span data-ttu-id="99fdd-127">Подписка с истекшим сроком удалена.</span><span class="sxs-lookup"><span data-stu-id="99fdd-127">Expired subscription was dropped.</span></span>|<span data-ttu-id="99fdd-128">нет</span><span class="sxs-lookup"><span data-stu-id="99fdd-128">No</span></span>|  
|<span data-ttu-id="99fdd-129">20572</span><span class="sxs-lookup"><span data-stu-id="99fdd-129">20572</span></span>|<span data-ttu-id="99fdd-130">**Репликация: подписка повторно инициализирована после ошибки проверки достоверности**</span><span class="sxs-lookup"><span data-stu-id="99fdd-130">**Replication: Subscription reinitialized after validation failure**</span></span>|<span data-ttu-id="99fdd-131">Повторная инициализация подписки с помощью ответного задания «Повторная инициализация подписки при ошибке проверки данных» выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="99fdd-131">Response job 'Reinitialize subscriptions on data validation failure' reinitializes a subscription successfully.</span></span>|<span data-ttu-id="99fdd-132">нет</span><span class="sxs-lookup"><span data-stu-id="99fdd-132">No</span></span>|  
|<span data-ttu-id="99fdd-133">20574</span><span class="sxs-lookup"><span data-stu-id="99fdd-133">20574</span></span>|<span data-ttu-id="99fdd-134">**Репликация: ошибка проверки данных подписчиком**</span><span class="sxs-lookup"><span data-stu-id="99fdd-134">**Replication: Subscriber has failed data validation**</span></span>|<span data-ttu-id="99fdd-135">Ошибка проверки данных агентом распространителя или агентом слияния.</span><span class="sxs-lookup"><span data-stu-id="99fdd-135">Distribution or Merge Agent fails data validation.</span></span>|<span data-ttu-id="99fdd-136">Да</span><span class="sxs-lookup"><span data-stu-id="99fdd-136">Yes</span></span>|  
|<span data-ttu-id="99fdd-137">20575</span><span class="sxs-lookup"><span data-stu-id="99fdd-137">20575</span></span>|<span data-ttu-id="99fdd-138">**Репликация: прошла проверку данных подписчиком**</span><span class="sxs-lookup"><span data-stu-id="99fdd-138">**Replication: Subscriber has passed data validation**</span></span>|<span data-ttu-id="99fdd-139">Проверка данных агентом распространителя или агентом слияния проведена успешно.</span><span class="sxs-lookup"><span data-stu-id="99fdd-139">Distribution or Merge Agent passes data validation.</span></span>|<span data-ttu-id="99fdd-140">Да</span><span class="sxs-lookup"><span data-stu-id="99fdd-140">Yes</span></span>|  
|<span data-ttu-id="99fdd-141">20578</span><span class="sxs-lookup"><span data-stu-id="99fdd-141">20578</span></span>|<span data-ttu-id="99fdd-142">**Репликация: нестандартное завершение работы агента**</span><span class="sxs-lookup"><span data-stu-id="99fdd-142">**Replication: agent custom shutdown**</span></span>|||  
|<span data-ttu-id="99fdd-143">22815</span><span class="sxs-lookup"><span data-stu-id="99fdd-143">22815</span></span>|<span data-ttu-id="99fdd-144">**Предупреждение об обнаружении конфликта в одноранговой топологии**</span><span class="sxs-lookup"><span data-stu-id="99fdd-144">**Peer-to-peer conflict detection alert**</span></span>|<span data-ttu-id="99fdd-145">Агент распространителя обнаружил конфликт при попытке применения изменений на одноранговом узле.</span><span class="sxs-lookup"><span data-stu-id="99fdd-145">Distribution Agent detected a conflict when it tries to apply a change at a peer-to-peer node.</span></span>|<span data-ttu-id="99fdd-146">Да</span><span class="sxs-lookup"><span data-stu-id="99fdd-146">Yes</span></span>|  
  
 <span data-ttu-id="99fdd-147">Наряду с этими предупреждениями монитор репликации предоставляет набор предупреждений и оповещений, относящихся к состоянию и производительности.</span><span class="sxs-lookup"><span data-stu-id="99fdd-147">In addition to these alerts, Replication Monitor provides a set of warnings and alerts related to status and performance.</span></span> <span data-ttu-id="99fdd-148">Дополнительные сведения см. [в разделе Установка пороговых значений и предупреждений в](../monitor/set-thresholds-and-warnings-in-replication-monitor.md) инфраструктуре предупреждений монитора репликации.</span><span class="sxs-lookup"><span data-stu-id="99fdd-148">For more information, see [Set Thresholds and Warnings in Replication Monitor](../monitor/set-thresholds-and-warnings-in-replication-monitor.md) alerts infrastructure.</span></span> <span data-ttu-id="99fdd-149">Дополнительные сведения см. в статье [Создание пользовательского события](../../../ssms/agent/create-a-user-defined-event.md).</span><span class="sxs-lookup"><span data-stu-id="99fdd-149">For more information, see [Create a User-Defined Event](../../../ssms/agent/create-a-user-defined-event.md).</span></span>  
  
 <span data-ttu-id="99fdd-150">**Настройка стандартных предупреждений репликации**</span><span class="sxs-lookup"><span data-stu-id="99fdd-150">**To configure predefined replication alerts**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="99fdd-151">: [Настройка стандартных предупреждений репликации (среда SQL Server Management Studio)](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md)</span><span class="sxs-lookup"><span data-stu-id="99fdd-151">: [Configure Predefined Replication Alerts &#40;SQL Server Management Studio&#41;](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md)</span></span>  
  
## <a name="viewing-the-application-log-directly"></a><span data-ttu-id="99fdd-152">Непосредственный просмотр журнала приложений</span><span class="sxs-lookup"><span data-stu-id="99fdd-152">Viewing the Application Log Directly</span></span>  
 <span data-ttu-id="99fdd-153">Для просмотра журнала приложений Windows используйте средство просмотра событий [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows.</span><span class="sxs-lookup"><span data-stu-id="99fdd-153">To view the Windows application log, use the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows Event Viewer.</span></span> <span data-ttu-id="99fdd-154">Журнал приложений содержит сообщения об ошибках [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , а также сообщения о многих других действиях на компьютере.</span><span class="sxs-lookup"><span data-stu-id="99fdd-154">The application log contains [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error messages as well as messages for many other activities on the computer.</span></span> <span data-ttu-id="99fdd-155">В отличие от журнала ошибок [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , новый журнал приложений не создается при каждом запуске [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (в каждом сеансе [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] новые события записываются в существующий журнал приложений), однако можно указать время хранения записанных в журнал событий.</span><span class="sxs-lookup"><span data-stu-id="99fdd-155">Unlike the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error log, a new application log is not created each time you start [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (each [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] session writes new events to an existing application log); however, you can specify how long logged events will be retained.</span></span> <span data-ttu-id="99fdd-156">При просмотре журнала приложений Windows можно отфильтровать журнал для поиска определенных событий.</span><span class="sxs-lookup"><span data-stu-id="99fdd-156">When you view the Windows application log, you can filter the log for specific events.</span></span> <span data-ttu-id="99fdd-157">Дополнительные сведения см. в документации по Windows.</span><span class="sxs-lookup"><span data-stu-id="99fdd-157">For more information, see the Windows documentation.</span></span>  
  
## <a name="automating-a-response-to-an-alert"></a><span data-ttu-id="99fdd-158">Автоматизация отклика на предупреждения</span><span class="sxs-lookup"><span data-stu-id="99fdd-158">Automating a Response to an Alert</span></span>  
 <span data-ttu-id="99fdd-159">Репликация обеспечивает выполнение ответного задания для подписок, которые не прошли проверку данных, а также предоставляет платформу для создания дополнительных автоматизированных ответов на предупреждения.</span><span class="sxs-lookup"><span data-stu-id="99fdd-159">Replication provides a response job for subscriptions that fail data validation, and also provides a framework for creating additional automated responses to alerts.</span></span> <span data-ttu-id="99fdd-160">Ответное задание называется **Повторная инициализация подписок при ошибке проверки** и хранится в папке [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Задания **агента** в среде [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="99fdd-160">The response job is titled **Reinitialize subscriptions on data validation failure** and is stored in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent **Jobs** folder in [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="99fdd-161">Дополнительные сведения о включении этого ответного задания см. в статье [Настройка стандартных предупреждений репликации (среда SQL Server Management Studio)](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="99fdd-161">For information about enabling this response job, see [Configure Predefined Replication Alerts &#40;SQL Server Management Studio&#41;](../administration/configure-predefined-replication-alerts-sql-server-management-studio.md).</span></span> <span data-ttu-id="99fdd-162">Если статьи в публикации транзакций не проходят проверку, ответное задание проводит повторную инициализацию только тех статей, которые не прошли проверку.</span><span class="sxs-lookup"><span data-stu-id="99fdd-162">If articles in a transactional publication fail validation, the response job reinitializes only those articles that failed.</span></span> <span data-ttu-id="99fdd-163">Если статьи в публикации слиянием не проходят проверку, ответное задание повторно инициализирует все статьи публикации.</span><span class="sxs-lookup"><span data-stu-id="99fdd-163">If articles in a merge publication fail validation, the response job reinitializes all articles in the publication.</span></span>  
  
### <a name="framework-for-automating-responses"></a><span data-ttu-id="99fdd-164">Платформа для автоматизации ответов</span><span class="sxs-lookup"><span data-stu-id="99fdd-164">Framework for Automating Responses</span></span>  
 <span data-ttu-id="99fdd-165">Обычно при возникновении предупреждения информация, позволяющая понять причину появления предупреждения и предпринять необходимые действия, содержится исключительно в самом предупреждающем сообщении.</span><span class="sxs-lookup"><span data-stu-id="99fdd-165">Usually, when an alert occurs, the only information you have to help you understand what caused the alert and the appropriate action to take is contained in the alert message itself.</span></span> <span data-ttu-id="99fdd-166">Анализ этой информации подвержен ошибкам и занимает немало времени.</span><span class="sxs-lookup"><span data-stu-id="99fdd-166">Parsing this information can be error-prone and time-consuming.</span></span> <span data-ttu-id="99fdd-167">Репликация облегчает автоматическое реагирование, предоставляя дополнительную информацию о предупреждении в системной таблице **sysreplicationalerts** ; эта информация уже представлена в форме, которая может быть легко использована пользовательскими программами.</span><span class="sxs-lookup"><span data-stu-id="99fdd-167">Replication makes automating responses easier by providing additional information about the alert in the **sysreplicationalerts** system table; the information provided is already parsed in a form easily used by customized programs.</span></span>  
  
 <span data-ttu-id="99fdd-168">Например, если данные в таблице **Sales.SalesOrderHeader** у подписчика «A» не прошли проверку, то [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] может выдать сообщение 20574, извещающее об этой ошибке.</span><span class="sxs-lookup"><span data-stu-id="99fdd-168">For example, if the data in the **Sales.SalesOrderHeader** table at Subscriber A fails validation, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can trigger message 20574, notifying you of that failure.</span></span> <span data-ttu-id="99fdd-169">Выводится следующее сообщение: «Ошибка проверки данных подписки подписчика A на статью SalesOrderHeader в публикации MyPublication».</span><span class="sxs-lookup"><span data-stu-id="99fdd-169">The message you receive will be: "Subscriber 'A', subscription to article 'SalesOrderHeader' in publication 'MyPublication' failed data validation."</span></span>  
  
 <span data-ttu-id="99fdd-170">Если ответ создается на основе этого сообщения, необходимо вручную выделить из сообщения имя подписчика, имя статьи, имя публикации и ошибку.</span><span class="sxs-lookup"><span data-stu-id="99fdd-170">If you create a response based on the message, you must manually parse the Subscriber name, article name, publication name, and error from the message.</span></span> <span data-ttu-id="99fdd-171">Однако поскольку агент распространителя и агент слияния записывают ту же информацию в таблицу **sysreplicationalerts** (вместе с подробными сведениями, такими как тип агента, время вывода предупреждения, база данных публикации, база данных подписчика и тип публикации), ответное задание может запросить соответствующую информацию непосредственно из таблицы.</span><span class="sxs-lookup"><span data-stu-id="99fdd-171">However, because the Distribution Agent and Merge Agent write that same information to **sysreplicationalerts** (along with details such as the type of agent, time of the alert, publication database, Subscriber database, and type of publication) the response job can directly query the relevant information from the table.</span></span> <span data-ttu-id="99fdd-172">Хотя конкретную строку нельзя связать с определенным экземпляром предупреждения, в таблице имеется столбец **status** , который можно использовать для отслеживания тех записей, которые были обработаны.</span><span class="sxs-lookup"><span data-stu-id="99fdd-172">Although the exact row cannot be associated with a specific instance of the alert, the table has a **status** column, which can be used to keep track of serviced entries.</span></span> <span data-ttu-id="99fdd-173">Записи этой таблицы сохраняются в течение срока хранения журнала.</span><span class="sxs-lookup"><span data-stu-id="99fdd-173">The entries in this table are maintained for the history retention period.</span></span>  
  
 <span data-ttu-id="99fdd-174">Например, если бы нужно было создать в [!INCLUDE[tsql](../../../includes/tsql-md.md)] ответное задание на предупреждение 20574, можно было бы использовать следующую логику:</span><span class="sxs-lookup"><span data-stu-id="99fdd-174">For example, if you were to create a response job in [!INCLUDE[tsql](../../../includes/tsql-md.md)] that services alert message 20574, you might use the following logic:</span></span>  
  
```  
declare @publisher sysname, @publisher_db sysname, @publication sysname, @publication_type int, @article sysname, @subscriber sysname, @subscriber_db sysname, @alert_id int  
declare hc cursor local for select publisher, publisher_db, publication, publication_type, article, subscriber,   
  subscriber_db, alert_id from   
  msdb..sysreplicationalerts where  
  alert_error_code = 20574 and status = 0  
  for read only  
open hc  
fetch hc into  @publisher, @publisher_db, @publication, @publication_type, @article, @subscriber, @subscriber_db, @alert_id  
while (@@fetch_status <> -1)  
begin  
/* Do custom work  */  
/* Update status to 1, which means the alert has been serviced. This prevents subsequent runs of this job from doing this again */  
update msdb..sysreplicationalerts set status = 1 where alert_id = @alert_id  
 fetch hc into  @publisher, @publisher_db, @publication, @publication_type, @article, @subscriber, @subscriber_db, @alert_id  
end  
close hc  
deallocate hc  
```  
  
## <a name="see-also"></a><span data-ttu-id="99fdd-175">См. также:</span><span class="sxs-lookup"><span data-stu-id="99fdd-175">See Also</span></span>  
 <span data-ttu-id="99fdd-176">[Администрирование агента репликации](replication-agent-administration.md) </span><span class="sxs-lookup"><span data-stu-id="99fdd-176">[Replication Agent Administration](replication-agent-administration.md) </span></span>  
 <span data-ttu-id="99fdd-177">[Рекомендации по администрированию репликации](../administration/best-practices-for-replication-administration.md) </span><span class="sxs-lookup"><span data-stu-id="99fdd-177">[Best Practices for Replication Administration](../administration/best-practices-for-replication-administration.md) </span></span>  
 [<span data-ttu-id="99fdd-178">Наблюдение за репликацией</span><span class="sxs-lookup"><span data-stu-id="99fdd-178">Monitoring &#40;Replication&#41;</span></span>](../monitoring-replication.md)  
  
  
