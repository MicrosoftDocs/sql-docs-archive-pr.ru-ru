---
title: Организация безопасности папки моментальных снимков | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], security
ms.assetid: 3cd877d1-ffb8-48fd-a72b-98eb948aad27
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: c977936ad2aca6e5a98ee685a15662a00b625494
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87666489"
---
# <a name="secure-the-snapshot-folder"></a><span data-ttu-id="d9eca-102">Организация безопасности папки моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="d9eca-102">Secure the Snapshot Folder</span></span>
  <span data-ttu-id="d9eca-103">Папка моментальных снимков представляет собой каталог, в котором хранятся файлы моментальных снимков. Рекомендуется выделить папку для хранения моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="d9eca-103">The snapshot folder is a directory that stores snapshot files; it is recommended that you dedicate the directory for snapshot storage.</span></span> <span data-ttu-id="d9eca-104">Предоставьте агенту моментальных снимков разрешение на запись в данную папку и убедитесь, что разрешение на чтение предоставлено только учетной записи Windows, которая используется агентом слияния или агентом распространителя при обращении к данной папке.</span><span class="sxs-lookup"><span data-stu-id="d9eca-104">Grant the Snapshot Agent write permission to the folder, and ensure that read permission is granted only to the Windows account that the Merge Agent or Distribution agent uses when accessing the folder.</span></span> <span data-ttu-id="d9eca-105">Чтобы обеспечить доступ к папке моментальных снимков, расположенной на удаленном компьютере, учетная запись Windows, связанная с агентом, должна быть учетной записью домена.</span><span class="sxs-lookup"><span data-stu-id="d9eca-105">The Windows account associated with the agent must be a domain account to access a snapshot folder that is located on a remote computer.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d9eca-106">Средство «Контроль учетных записей» (UAC) помогает администраторам управлять своими повышенными пользовательскими разрешениями (иногда называемыми *правами доступа*).</span><span class="sxs-lookup"><span data-stu-id="d9eca-106">User Account Control (UAC)  helps administrators manage their elevated user rights (sometimes called *privileges*).</span></span> <span data-ttu-id="d9eca-107">В операционной системе с включенным контроль учетных записей, администраторы не пользуются своими административными правами,</span><span class="sxs-lookup"><span data-stu-id="d9eca-107">When running on operating systems that have UAC enabled, administrators do not use their administrative rights.</span></span> <span data-ttu-id="d9eca-108">Вместо этого они выполняют большинство операций от имени обычных пользователей (не администраторов) и используют административные права только по необходимости.</span><span class="sxs-lookup"><span data-stu-id="d9eca-108">Instead, they perform most actions as standard (non-administrative) users, temporarily assuming their administrative rights only when it is required.</span></span> <span data-ttu-id="d9eca-109">С помощью средства «Управление учетными записями пользователя» можно запретить административный доступ к хранилищу моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="d9eca-109">UAC can prevent administrative access to the snapshot share.</span></span> <span data-ttu-id="d9eca-110">Поэтому необходимо явно предоставить разрешения на доступ к хранилищу моментального снимка учетным записям Windows, которые используются агентом моментальных снимков, агентом распространителя и агентом слияния.</span><span class="sxs-lookup"><span data-stu-id="d9eca-110">You must therefore explicitly grant snapshot share permissions to the Windows accounts that are used by the Snapshot Agent, Distribution Agent, and Merge Agent.</span></span> <span data-ttu-id="d9eca-111">Это необходимо делать даже в том случае, если эти учетные записи Windows являются членами группы «Администраторы».</span><span class="sxs-lookup"><span data-stu-id="d9eca-111">You must do this even if the Windows accounts are members of the Administrators group.</span></span>  
  
 <span data-ttu-id="d9eca-112">При настройке распространителя с помощью мастера настройки распространителя или мастера создания публикаций папке моментального снимка назначается по умолчанию следующее местоположение: X:\Program Files\Microsoft SQL Server\\ *\<instance>* \MSSQL\ReplData.</span><span class="sxs-lookup"><span data-stu-id="d9eca-112">When configuring a Distributor through the Configure Distribution Wizard or the New Publication Wizard, the snapshot folder defaults to a local path: X:\Program Files\Microsoft SQL Server\\*\<instance>* \MSSQL\ReplData.</span></span> <span data-ttu-id="d9eca-113">Если вы используете удаленный распространитель или подписки по запросу, необходимо указывать не локальный путь, а путь к общей сетевой папке в формате UNC (например, \\\\<*имя_компьютера>* \snapshot).</span><span class="sxs-lookup"><span data-stu-id="d9eca-113">If you are using a remote Distributor or pull subscriptions, you must specify a UNC network share (such as \\\\<*computername>* \snapshot) rather than a local path.</span></span>  
  
 <span data-ttu-id="d9eca-114">Предоставлять разрешения на доступ к папке моментальных снимков необходимо в соответствии со способом доступа к данной папке.</span><span class="sxs-lookup"><span data-stu-id="d9eca-114">When granting permissions to access the snapshot folder, you must grant them according to the way in which the folder is accessed.</span></span> <span data-ttu-id="d9eca-115">В [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows 2003 используются следующие вкладки диалогового окна:</span><span class="sxs-lookup"><span data-stu-id="d9eca-115">The following dialog box tabs are used in [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows 2003:</span></span>  
  
-   <span data-ttu-id="d9eca-116">Если указывается локальный путь, предоставляйте разрешения на работу с папкой на вкладке **Безопасность** диалогового окна **Свойства** .</span><span class="sxs-lookup"><span data-stu-id="d9eca-116">If you specify a local path, grant permissions through the **Security** tab of the **Properties** dialog box for the folder.</span></span>  
  
-   <span data-ttu-id="d9eca-117">Если указывается сетевой ресурс, предоставляйте разрешения на работу с папкой на вкладке **Общий ресурс** диалогового окна **Свойства** .</span><span class="sxs-lookup"><span data-stu-id="d9eca-117">If you specify a network share, grant permissions through the **Sharing** tab of the **Properties** dialog box for the folder.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d9eca-118">Если агент репликации запущен на распространителе, то в диалоговом окне **Свойства** этой папки на вкладке **Безопасность** необходимо предоставить учетной записи Windows разрешение на запуск агента.</span><span class="sxs-lookup"><span data-stu-id="d9eca-118">If the replication agent runs on the Distributor, use the **Security** tab of the **Properties** dialog box for the folder to grant permissions to the Windows account used to run the agent.</span></span> <span data-ttu-id="d9eca-119">Это необходимо делать даже в том случае, если используется общая сетевая папка.</span><span class="sxs-lookup"><span data-stu-id="d9eca-119">Do this even when a network share is used.</span></span> <span data-ttu-id="d9eca-120">Это относится к агенту слияния и агенту распространителя для принудительных подписок и к агенту моментальных снимков, когда издатель и распространитель располагаются на одном и том же компьютере.</span><span class="sxs-lookup"><span data-stu-id="d9eca-120">This applies to the Merge Agent and Distribution Agent for a push subscription and to the Snapshot Agent when the Publisher and Distributor are on the same computer.</span></span>  
  
 <span data-ttu-id="d9eca-121">Дополнительные сведения о предоставлении разрешений для локальных путей и общих сетевых ресурсов см. в документации по Windows.</span><span class="sxs-lookup"><span data-stu-id="d9eca-121">For more information about setting permissions for local paths and network shares, see the Windows documentation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d9eca-122">При удалении публикации репликация согласно контексту безопасности учетной записи службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] пытается удалить папку моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="d9eca-122">If a publication is dropped, replication attempts to remove the snapshot folder under the security context of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] service account.</span></span> <span data-ttu-id="d9eca-123">Если у этой учетной записи нет достаточных прав доступа, войдите в систему под другой учетной записью с необходимыми разрешениями и удалите папку вручную.</span><span class="sxs-lookup"><span data-stu-id="d9eca-123">If this account does not have sufficient privileges, log in with an account that does have sufficient privileges and remove the folder manually.</span></span> <span data-ttu-id="d9eca-124">Чтобы удалить папку, необходимо право доступа **Изменение** , если папка расположена по локальному пути, или разрешение **Полный доступ** , если папка является сетевым ресурсом.</span><span class="sxs-lookup"><span data-stu-id="d9eca-124">Removing a folder requires the **Modify** privilege if the folder is a local path or the **Full Control** privilege if the folder is a network path.</span></span>  
  
## <a name="delivering-snapshots-through-ftp"></a><span data-ttu-id="d9eca-125">Доставка моментальных снимков по FTP-протоколу</span><span class="sxs-lookup"><span data-stu-id="d9eca-125">Delivering Snapshots Through FTP</span></span>  
 <span data-ttu-id="d9eca-126">В соответствии с оптимальными методами обеспечения безопасности рекомендуется хранить моментальные снимки в общем UNC-ресурсе, хотя снимки можно хранить и в общем FTP-ресурсе, а затем доставлять их подписчику по протоколу FTP.</span><span class="sxs-lookup"><span data-stu-id="d9eca-126">It is recommended as a security best practice that snapshots be stored in a UNC share, but snapshots can be stored in an FTP share and then delivered to a Subscriber through FTP.</span></span> <span data-ttu-id="d9eca-127">При настройке FTP-сервера убедитесь, что виртуальный каталог предоставляет основной общий UNC-ресурс, и агент моментальных снимков обладает разрешением на запись для публикации.</span><span class="sxs-lookup"><span data-stu-id="d9eca-127">When configuring the FTP server, ensure that the virtual directory exposes an underlying UNC share that permits write access by the Snapshot Agent for the publication.</span></span>  
  
 <span data-ttu-id="d9eca-128">Чтобы настроить подписчик на получение моментальных снимков по FTP, сначала установите FTP-сервер с именем для входа и паролем, предоставляющими подписчику доступ на чтение (или «получение»), который необходим для загрузки файлов моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="d9eca-128">To configure a Subscriber to retrieve the Snapshot via FTP, first set up an FTP server with an FTP login and password that allows Subscribers read (or "get") access to allow the snapshot files to be downloaded.</span></span>  
  
 <span data-ttu-id="d9eca-129">Сведения о доставке моментальных снимков по протоколу FTP см. в статье [Доставка моментальных снимков по FTP](../publish/deliver-a-snapshot-through-ftp.md).</span><span class="sxs-lookup"><span data-stu-id="d9eca-129">To deliver snapshots through FTP, see [Deliver a Snapshot Through FTP](../publish/deliver-a-snapshot-through-ftp.md).</span></span>  
  
 <span data-ttu-id="d9eca-130">Сведения о задании и изменении пароля для доступа к моментальным снимкам по FTP см. в подразделе «Доставка моментальных снимков по FTP» раздела [Secure the Publisher](secure-the-publisher.md).</span><span class="sxs-lookup"><span data-stu-id="d9eca-130">For information about setting and changing the password for access to snapshots through FTP, see the section "FTP Snapshot Delivery" in the topic [Secure the Publisher](secure-the-publisher.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d9eca-131">См. также:</span><span class="sxs-lookup"><span data-stu-id="d9eca-131">See Also</span></span>  
 <span data-ttu-id="d9eca-132">[Альтернативные расположения папки моментальных снимков](../alternate-snapshot-folder-locations.md) </span><span class="sxs-lookup"><span data-stu-id="d9eca-132">[Alternate Snapshot Folder Locations](../alternate-snapshot-folder-locations.md) </span></span>  
 <span data-ttu-id="d9eca-133">[Инициализация подписки с помощью моментального снимка](../initialize-a-subscription-with-a-snapshot.md) </span><span class="sxs-lookup"><span data-stu-id="d9eca-133">[Initialize a Subscription with a Snapshot](../initialize-a-subscription-with-a-snapshot.md) </span></span>  
 <span data-ttu-id="d9eca-134">[Replication Security Best Practices](replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="d9eca-134">[Replication Security Best Practices](replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="d9eca-135">[Безопасность Репликация SQL Server](view-and-modify-replication-security-settings.md) </span><span class="sxs-lookup"><span data-stu-id="d9eca-135">[SQL Server Replication Security](view-and-modify-replication-security-settings.md) </span></span>  
 [<span data-ttu-id="d9eca-136">Передача моментальных снимков через FTP</span><span class="sxs-lookup"><span data-stu-id="d9eca-136">Transfer Snapshots Through FTP</span></span>](../transfer-snapshots-through-ftp.md)  
  
  
