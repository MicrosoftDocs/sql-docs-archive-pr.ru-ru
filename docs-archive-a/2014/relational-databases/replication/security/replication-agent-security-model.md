---
title: Модель безопасности агента репликации | Документация Майкрософт
ms.custom: ''
ms.date: 10/07/2015
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Snapshot Agent, security
- agents [SQL Server replication], security
- Distribution Agent, security
- logins [SQL Server replication], permissions for agents
- security [SQL Server replication], agent security model
- Log Reader Agent, security
- Queue Reader Agent, security
- Merge Agent, security
- replication [SQL Server], agents and profiles
ms.assetid: 6d09fc8d-843a-4a7a-9812-f093d99d8192
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: da597bf97422f5a0960062b385bc0b67338edfe1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87654153"
---
# <a name="replication-agent-security-model"></a><span data-ttu-id="dbd36-102">Модель безопасности агента репликации</span><span class="sxs-lookup"><span data-stu-id="dbd36-102">Replication Agent Security Model</span></span>
  <span data-ttu-id="dbd36-103">Модель безопасности агента репликации предоставляет возможность точного управления учетными записями, с которыми агенты репликации выполняются и устанавливают соединения: для каждого агента может быть задана своя учетная запись.</span><span class="sxs-lookup"><span data-stu-id="dbd36-103">The replication agent security model allows for fine-grained control over the accounts under which replication agents run and make connections: A different account can be specified for each agent.</span></span> <span data-ttu-id="dbd36-104">Дополнительные сведения об определении учетных записей см. в статье [Управление именами входа и паролями в репликации](identity-and-access-control-replication.md#manage-logins-and-passwords-in-replication).</span><span class="sxs-lookup"><span data-stu-id="dbd36-104">For more information about how to specify accounts, see [Manage Logins and Passwords in Replication](identity-and-access-control-replication.md#manage-logins-and-passwords-in-replication).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="dbd36-105">Если репликацию настраивает член предопределенной роли сервера **sysadmin** , агенты репликации можно настроить для олицетворения учетной записи агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="dbd36-105">When a member of the **sysadmin** fixed server role configures replication, replication agents can be configured to impersonate the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent account.</span></span> <span data-ttu-id="dbd36-106">Это можно сделать, если не задавать имя входа и пароль для агента репликации, однако такой подход не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="dbd36-106">This is done by not specifying a login and password for a replication agent; however, we do not recommend this approach.</span></span> <span data-ttu-id="dbd36-107">Вместо этого для обеспечения надежной защиты рекомендуется задать учетную запись для каждого агента с минимальными разрешениями, описанными в подразделе «Разрешения, необходимые для агентов» ниже в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="dbd36-107">Instead, as a security best practice, we recommend that you specify an account for each agent that has the minimum permissions that are described in the section "Permissions That Are Required by Agents" later in this topic.</span></span>  
  
 <span data-ttu-id="dbd36-108">Агенты репликации, как и все исполняемые объекты, запускаются в контексте учетной записи Windows.</span><span class="sxs-lookup"><span data-stu-id="dbd36-108">Replication agents, like all executables, run under the context of a Windows account.</span></span> <span data-ttu-id="dbd36-109">Агенты выполняют соединения встроенной безопасности Windows, используя эту учетную запись.</span><span class="sxs-lookup"><span data-stu-id="dbd36-109">The agents make Windows Integrated Security connections by using this account.</span></span> <span data-ttu-id="dbd36-110">Учетная запись, под которой выполняется агент, зависит от того, как он был запущен:</span><span class="sxs-lookup"><span data-stu-id="dbd36-110">The account under which the agent runs depends on how the agent is started:</span></span>  
  
-   <span data-ttu-id="dbd36-111">Запуск агента из задания агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (по умолчанию): Когда для запуска агента репликации используется задание агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], агент репликации выполняется в контексте учетной записи, указанной при настройке репликации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-111">Starting the agent from a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent job, the default: When a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent job is used to start a replication agent, the agent runs under the context of an account that you specify when you configure replication.</span></span> <span data-ttu-id="dbd36-112">Дополнительные сведения об агенте [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и репликации см. в подразделе «Безопасность агентов под управлением агента SQL Server» ниже в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="dbd36-112">For more information about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent and replication, see the section "Agent Security under SQL Server Agent" later in this topic.</span></span> <span data-ttu-id="dbd36-113">Сведения о разрешениях, необходимых для учетной записи, от имени которой выполняется агент [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], см. в статье [Настройка агента SQL Server](../../../ssms/agent/configure-sql-server-agent.md).</span><span class="sxs-lookup"><span data-stu-id="dbd36-113">For information about the permissions that are required for the account under which [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent runs, see [Configure SQL Server Agent](../../../ssms/agent/configure-sql-server-agent.md).</span></span>  
  
-   <span data-ttu-id="dbd36-114">Запуск агента из командной строки MS-DOS или непосредственно, или с помощью скрипта: агент выполняется в контексте учетной записи пользователя, запустившего его из командной строки.</span><span class="sxs-lookup"><span data-stu-id="dbd36-114">Starting the agent from an MS-DOS command line, either directly or through a script: The agent runs under the context of the account of the user that is running the agent at the command line.</span></span>  
  
-   <span data-ttu-id="dbd36-115">Запуск агента из приложения, использующего объекты RMO или элемент ActiveX: агент выполняется в контексте приложения, которое вызывает объект RMO или элемент ActiveX.</span><span class="sxs-lookup"><span data-stu-id="dbd36-115">Starting the agent from an application that uses Replication Management Objects (RMO) or an ActiveX control: The agent runs under the context of the application that is calling RMO or the ActiveX control.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="dbd36-116">Элементы управления ActiveX являются устаревшими.</span><span class="sxs-lookup"><span data-stu-id="dbd36-116">ActiveX controls are deprecated.</span></span>  
  
 <span data-ttu-id="dbd36-117">Рекомендуется выполнять соединение в контексте встроенной безопасности Windows.</span><span class="sxs-lookup"><span data-stu-id="dbd36-117">We recommend that connections be made under the context of Windows Integrated Security.</span></span> <span data-ttu-id="dbd36-118">В целях обратной совместимости также можно использовать безопасность [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="dbd36-118">For backward compatibility, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Security can also be used.</span></span> <span data-ttu-id="dbd36-119">Дополнительные сведения о рекомендуемых подходах см. в разделе [Replication Security Best Practices](replication-security-best-practices.md).</span><span class="sxs-lookup"><span data-stu-id="dbd36-119">For more information about best practices, see [Replication Security Best Practices](replication-security-best-practices.md).</span></span>  
  
## <a name="permissions-that-are-required-by-agents"></a><span data-ttu-id="dbd36-120">Разрешения, необходимые для агентов</span><span class="sxs-lookup"><span data-stu-id="dbd36-120">Permissions That Are Required by Agents</span></span>  
 <span data-ttu-id="dbd36-121">Учетные записи, под которыми выполняются и устанавливают соединения агенты, требуют различных разрешений.</span><span class="sxs-lookup"><span data-stu-id="dbd36-121">The accounts under which agents run and make connections require a variety of permissions.</span></span> <span data-ttu-id="dbd36-122">Описание этих разрешений приводится в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="dbd36-122">These permissions are described in the following table.</span></span> <span data-ttu-id="dbd36-123">Рекомендуется выполнять каждый агент под отдельной учетной записью Windows, которым следует предоставлять только необходимые разрешения.</span><span class="sxs-lookup"><span data-stu-id="dbd36-123">We recommend that each agent run under a different Windows account and the account should be granted only the required permissions.</span></span> <span data-ttu-id="dbd36-124">Сведения о списке доступа к публикации (PAL), относящемся к нескольким агентам, см. в разделе [Защита издателя](secure-the-publisher.md).</span><span class="sxs-lookup"><span data-stu-id="dbd36-124">For information about the publication access list (PAL), which is relevant for a number of agents, see [Secure the Publisher](secure-the-publisher.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="dbd36-125">В некоторых операционных системах Windows с помощью средства «Контроль учетных записей» можно запретить административный доступ к хранилищу моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="dbd36-125">User Account Control (UAC) in some Windows operating systems can prevent administrative access to the snapshot share.</span></span> <span data-ttu-id="dbd36-126">Поэтому необходимо явно предоставить разрешения на доступ к хранилищу моментального снимка учетным записям Windows, которые используются агентом моментальных снимков, агентом распространителя и агентом слияния.</span><span class="sxs-lookup"><span data-stu-id="dbd36-126">You must therefore explicitly grant snapshot share permissions to the Windows accounts that are used by the Snapshot Agent, Distribution Agent, and Merge Agent.</span></span> <span data-ttu-id="dbd36-127">Это необходимо делать даже в том случае, если эти учетные записи Windows являются членами группы «Администраторы».</span><span class="sxs-lookup"><span data-stu-id="dbd36-127">You must do this even if the Windows accounts are members of the Administrators group.</span></span> <span data-ttu-id="dbd36-128">Дополнительные сведения см. в статье [Организация безопасности папки моментальных снимков](secure-the-snapshot-folder.md).</span><span class="sxs-lookup"><span data-stu-id="dbd36-128">For more information, see [Secure the Snapshot Folder](secure-the-snapshot-folder.md).</span></span>  
  
|<span data-ttu-id="dbd36-129">Агент</span><span class="sxs-lookup"><span data-stu-id="dbd36-129">Agent</span></span>|<span data-ttu-id="dbd36-130">Разрешения</span><span class="sxs-lookup"><span data-stu-id="dbd36-130">Permissions</span></span>|  
|-----------|-----------------|  
|<span data-ttu-id="dbd36-131">агент моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="dbd36-131">Snapshot Agent</span></span>|<span data-ttu-id="dbd36-132">При соединении с распространителем используется учетная запись Windows, под которой выполняется агент.</span><span class="sxs-lookup"><span data-stu-id="dbd36-132">The Windows account under which the agent runs is used when it makes connections to the Distributor.</span></span> <span data-ttu-id="dbd36-133">Эта учетная запись должна удовлетворять следующим требованиям:</span><span class="sxs-lookup"><span data-stu-id="dbd36-133">This account must:</span></span><br /><br /> <span data-ttu-id="dbd36-134">Она должна быть как минимум участником предопределенной роли базы данных **db_owner** в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="dbd36-134">-At minimum, be a member of the **db_owner** fixed database role in the distribution database.</span></span><br /><br /> <span data-ttu-id="dbd36-135">Она должна обладать разрешениями на чтение, запись и изменение в хранилище моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="dbd36-135">-Have read, write, and modify permissions on the snapshot share.</span></span><br /><br /> <br /><br /> <span data-ttu-id="dbd36-136">Учетная запись, используемая для соединения с издателем, должна быть как минимум членом предопределенной роли базы данных **db_owner** публикации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-136">The account that is used to connect to the Publisher must at minimum be a member of the **db_owner** fixed database role in the publication database.</span></span>|  
|<span data-ttu-id="dbd36-137">Агент чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="dbd36-137">Log Reader Agent</span></span>|<span data-ttu-id="dbd36-138">При соединении с распространителем используется учетная запись Windows, под которой выполняется агент.</span><span class="sxs-lookup"><span data-stu-id="dbd36-138">The Windows account under which the agent runs is used when it makes connections to the Distributor.</span></span> <span data-ttu-id="dbd36-139">Эта учетная запись должна быть как минимум членом предопределенной роли базы данных **db_owner** распространителя.</span><span class="sxs-lookup"><span data-stu-id="dbd36-139">This account must at minimum be a member of the **db_owner** fixed database role in the distribution database.</span></span><br /><br /> <span data-ttu-id="dbd36-140">Учетная запись, используемая для соединения с издателем, должна быть как минимум членом предопределенной роли базы данных **db_owner** публикации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-140">The account that is used to connect to the Publisher must at minimum be a member of the **db_owner** fixed database role in the publication database.</span></span><br /><br /> <span data-ttu-id="dbd36-141">При выборе `sync_type` параметров *только поддержка репликации*, *инициализации с помощью резервного копирования*или *инициализации из LSN*агент чтения журнала должен запускаться после выполнения `sp_addsubscription` , чтобы скрипты установки записывались в базу данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="dbd36-141">When selecting the `sync_type` options *replication support only*, *initialize with backup*, or *initialize from lsn*, the log reader agent must run after executing `sp_addsubscription`, so that the set-up scripts are written to the distribution database.</span></span> <span data-ttu-id="dbd36-142">Агент чтения журнала должен работать под учетной записью, которая является членом предопределенной роли сервера **sysadmin** .</span><span class="sxs-lookup"><span data-stu-id="dbd36-142">The log reader agent must be running under an account that is a member of the **sysadmin** fixed server role.</span></span> <span data-ttu-id="dbd36-143">Если `sync_type` для параметра задано значение *автоматически*, специальные действия агента чтения журнала не требуются.</span><span class="sxs-lookup"><span data-stu-id="dbd36-143">When the `sync_type` option is set to *Automatic*, no special log reader agent actions are required.</span></span>|  
|<span data-ttu-id="dbd36-144">Агент распространителя для принудительной подписки</span><span class="sxs-lookup"><span data-stu-id="dbd36-144">Distribution Agent for a push subscription</span></span>|<span data-ttu-id="dbd36-145">При соединении с распространителем используется учетная запись Windows, под которой выполняется агент.</span><span class="sxs-lookup"><span data-stu-id="dbd36-145">The Windows account under which the agent runs is used when it makes connections to the Distributor.</span></span> <span data-ttu-id="dbd36-146">Эта учетная запись должна удовлетворять следующим требованиям:</span><span class="sxs-lookup"><span data-stu-id="dbd36-146">This account must:</span></span><br /><br /> <span data-ttu-id="dbd36-147">Она должна быть как минимум участником предопределенной роли базы данных **db_owner** в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="dbd36-147">-At minimum be a member of the **db_owner** fixed database role in the distribution database.</span></span><br /><br /> <span data-ttu-id="dbd36-148">Она должна входить в список доступа к публикации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-148">-Be a member of the PAL.</span></span><br /><br /> <span data-ttu-id="dbd36-149">Она должна иметь разрешение на чтение хранилища моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="dbd36-149">-Have read permissions on the snapshot share.</span></span><br /><br /> <span data-ttu-id="dbd36-150">Иметь разрешения на чтение из каталога, в который был установлен поставщик OLE DB для подписчика, если подписка предназначена для подписчика, отличного от подписчика SQL Server.</span><span class="sxs-lookup"><span data-stu-id="dbd36-150">-Have read permissions on the installation directory of the OLE DB provider for the Subscriber if the subscription is for a non-SQL Server Subscriber.</span></span><br /><br /> <span data-ttu-id="dbd36-151">При репликации бизнес-данных агент распространения должен иметь разрешения на репликацию **C:\Program Files\Microsoft SQL Server\XX\COMfolder** , где XX — идентификатор экземпляра.</span><span class="sxs-lookup"><span data-stu-id="dbd36-151">-When replicating LOB data, the distribution agent must have write permissions on the replication **C:\Program Files\Microsoft SQL Server\XX\COMfolder** where XX represents the instanceID.</span></span><br /><br /> <br /><br /> <span data-ttu-id="dbd36-152">Учетная запись, используемая для соединения с подписчиком, должна быть как минимум членом предопределенной роли базы данных **db_owner** подписки или иметь равнозначные права, если подписка предназначена для подписчика, отличного от подписчика SQL Server.</span><span class="sxs-lookup"><span data-stu-id="dbd36-152">The account that is used to connect to the Subscriber must at minimum be a member of the **db_owner** fixed database role in the subscription database, or have equivalent permissions if the subscription is for a non-SQL Server Subscriber.</span></span><br /><br /> <span data-ttu-id="dbd36-153">Примечание. при использовании `-subscriptionstreams >= 2` в агенте распространителя необходимо также предоставить `View Server State` разрешение на подписчики для обнаружения взаимоблокировок.</span><span class="sxs-lookup"><span data-stu-id="dbd36-153">Note: When using `-subscriptionstreams >= 2` on the distribution agent you must also grant the `View Server State` permission on the subscribers to detect deadlocks.</span></span>|  
|<span data-ttu-id="dbd36-154">Агент распространителя для подписки по запросу</span><span class="sxs-lookup"><span data-stu-id="dbd36-154">Distribution Agent for a pull subscription</span></span>|<span data-ttu-id="dbd36-155">При соединении с подписчиком используется учетная запись Windows, под которой выполняется агент.</span><span class="sxs-lookup"><span data-stu-id="dbd36-155">The Windows account under which the agent runs is used when it makes connections to the Subscriber.</span></span> <span data-ttu-id="dbd36-156">Эта учетная запись должна быть как минимум членом предопределенной роли базы данных **db_owner** подписки.</span><span class="sxs-lookup"><span data-stu-id="dbd36-156">This account must at minimum be a member of the **db_owner** fixed database role in the subscription database.</span></span> <span data-ttu-id="dbd36-157">Учетная запись, используемая для соединения с распространителем, должна удовлетворять следующим требованиям:</span><span class="sxs-lookup"><span data-stu-id="dbd36-157">The account that is used to connect to the Distributor must:</span></span><br /><br /> <span data-ttu-id="dbd36-158">Она должна входить в список доступа к публикации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-158">-Be a member of the PAL.</span></span><br /><br /> <span data-ttu-id="dbd36-159">Она должна иметь разрешение на чтение хранилища моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="dbd36-159">-Have read permissions on the snapshot share.</span></span><br /><br /> <span data-ttu-id="dbd36-160">При репликации бизнес-данных агент распространения должен иметь разрешения на репликацию **C:\Program Files\Microsoft SQL Server\XX\COMfolder** , где XX — идентификатор экземпляра.</span><span class="sxs-lookup"><span data-stu-id="dbd36-160">-When replicating LOB data, the distribution agent must have write permissions on the replication **C:\Program Files\Microsoft SQL Server\XX\COMfolder** where XX represents the instanceID.</span></span><br /><br /> <br /><br /> <span data-ttu-id="dbd36-161">Примечание. при использовании `-subscriptionstreams >= 2` в агенте распространителя необходимо также предоставить `View Server State` разрешение на подписчики для обнаружения взаимоблокировок.</span><span class="sxs-lookup"><span data-stu-id="dbd36-161">Note: When using `-subscriptionstreams >= 2` on the distribution agent you must also grant the `View Server State` permission on the subscribers to detect deadlocks.</span></span>|  
|<span data-ttu-id="dbd36-162">Агент слияния для принудительной подписки</span><span class="sxs-lookup"><span data-stu-id="dbd36-162">Merge Agent for a push subscription</span></span>|<span data-ttu-id="dbd36-163">При подключениях к издателю и распространителю используется та учетная запись Windows, под которой выполняется агент.</span><span class="sxs-lookup"><span data-stu-id="dbd36-163">The Windows account under which the agent runs is used when it makes connections to the Publisher and Distributor.</span></span> <span data-ttu-id="dbd36-164">Эта учетная запись должна удовлетворять следующим требованиям:</span><span class="sxs-lookup"><span data-stu-id="dbd36-164">This account must:</span></span><br /><br /> <span data-ttu-id="dbd36-165">Она должна быть как минимум участником предопределенной роли базы данных **db_owner** в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="dbd36-165">-At minimum be a member of the **db_owner** fixed database role in the distribution database.</span></span><br /><br /> <span data-ttu-id="dbd36-166">Она должна входить в список доступа к публикации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-166">-Be a member of the PAL.</span></span><br /><br /> <span data-ttu-id="dbd36-167">Он должна иметь имя для входа, связанное с пользователем в базе данных публикации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-167">-Be a login that is associated with a user in the publication database.</span></span><br /><br /> <span data-ttu-id="dbd36-168">Она должна иметь разрешение на чтение хранилища моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="dbd36-168">-Have read permissions on the snapshot share.</span></span><br /><br /> <br /><br /> <span data-ttu-id="dbd36-169">Учетная запись, используемая для соединения с подписчиком, должна быть как минимум членом предопределенной роли базы данных **db_owner** подписки.</span><span class="sxs-lookup"><span data-stu-id="dbd36-169">The account used to connect to the Subscriber must at minimum be a member of the **db_owner** fixed database role in the subscription database.</span></span>|  
|<span data-ttu-id="dbd36-170">Агент слияния для подписки по запросу</span><span class="sxs-lookup"><span data-stu-id="dbd36-170">Merge Agent for a pull subscription</span></span>|<span data-ttu-id="dbd36-171">При соединении с подписчиком используется учетная запись Windows, под которой выполняется агент.</span><span class="sxs-lookup"><span data-stu-id="dbd36-171">The Windows account under which the agent runs is used when it makes connections to the Subscriber.</span></span> <span data-ttu-id="dbd36-172">Эта учетная запись должна быть как минимум членом предопределенной роли базы данных **db_owner** подписки.</span><span class="sxs-lookup"><span data-stu-id="dbd36-172">This account must at minimum be a member of the **db_owner** fixed database role in the subscription database.</span></span> <span data-ttu-id="dbd36-173">Учетная запись, используемая для соединения с издателем и распространителем, должна удовлетворять следующим требованиям:</span><span class="sxs-lookup"><span data-stu-id="dbd36-173">The account that is used to connect to the Publisher and Distributor must:</span></span><br /><br /> <span data-ttu-id="dbd36-174">Она должна входить в список доступа к публикации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-174">-Be a member of the PAL.</span></span><br /><br /> <span data-ttu-id="dbd36-175">Она должна иметь имя для входа, связанное с пользователем в базе данных публикации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-175">-Be a login associated with a user in the publication database.</span></span><br /><br /> <span data-ttu-id="dbd36-176">Она должна иметь имя для входа, связанное с пользователем в базе данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="dbd36-176">-Be a login associated with a user in the distribution database.</span></span> <span data-ttu-id="dbd36-177">Пользователь может иметь учетную запись `Guest`.</span><span class="sxs-lookup"><span data-stu-id="dbd36-177">The user can be the `Guest` user.</span></span><br /><br /> <span data-ttu-id="dbd36-178">Она должна иметь разрешение на чтение хранилища моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="dbd36-178">-Have read permissions on the snapshot share.</span></span>|  
|<span data-ttu-id="dbd36-179">Агент чтения очереди.</span><span class="sxs-lookup"><span data-stu-id="dbd36-179">Queue Reader Agent</span></span>|<span data-ttu-id="dbd36-180">При соединении с распространителем используется учетная запись Windows, под которой выполняется агент.</span><span class="sxs-lookup"><span data-stu-id="dbd36-180">The Windows account under which the agent runs is used when it makes connections to the Distributor.</span></span> <span data-ttu-id="dbd36-181">Эта учетная запись должна быть как минимум членом предопределенной роли базы данных **db_owner** распространителя.</span><span class="sxs-lookup"><span data-stu-id="dbd36-181">This account must at minimum be a member of the **db_owner** fixed database role in the distribution database.</span></span><br /><br /> <span data-ttu-id="dbd36-182">Учетная запись, используемая для соединения с издателем, должна быть как минимум членом предопределенной роли базы данных **db_owner** публикации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-182">The account that is used to connect to the Publisher must at minimum be a member of the **db_owner** fixed database role in the publication database.</span></span><br /><br /> <span data-ttu-id="dbd36-183">Учетная запись, используемая для соединения с подписчиком, должна быть как минимум членом предопределенной роли базы данных **db_owner** публикации.</span><span class="sxs-lookup"><span data-stu-id="dbd36-183">The account that is used to connect to the Subscriber must at minimum be a member of the **db_owner** fixed database role in the subscription database.</span></span>|  
  
## <a name="agent-security-under-sql-server-agent"></a><span data-ttu-id="dbd36-184">Безопасность агентов под управлением агента SQL Server</span><span class="sxs-lookup"><span data-stu-id="dbd36-184">Agent Security Under SQL Server Agent</span></span>  
 <span data-ttu-id="dbd36-185">При настройке репликации с помощью среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], процедур [!INCLUDE[tsql](../../../includes/tsql-md.md)] или объектов RMO по умолчанию для каждого агента создается задание агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="dbd36-185">When you configure replication by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)] procedures, or RMO, a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent job is created by default for each agent.</span></span> <span data-ttu-id="dbd36-186">Затем агенты выполняются в контексте соответствующего шага задания, вне зависимости от того, выполняются ли они постоянно, по расписанию или по запросу.</span><span class="sxs-lookup"><span data-stu-id="dbd36-186">Agents then run under the context of a job step, regardless of whether they run continuously, on a schedule, or on demand.</span></span> <span data-ttu-id="dbd36-187">Эти задания можно просмотреть в папке **Задания** в среде [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="dbd36-187">You can view these jobs under the **Jobs** folder in [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="dbd36-188">В следующей таблице перечислены имена заданий.</span><span class="sxs-lookup"><span data-stu-id="dbd36-188">The following table lists the job names.</span></span>  
  
|<span data-ttu-id="dbd36-189">Агент</span><span class="sxs-lookup"><span data-stu-id="dbd36-189">Agent</span></span>|<span data-ttu-id="dbd36-190">Имя задания</span><span class="sxs-lookup"><span data-stu-id="dbd36-190">Job name</span></span>|  
|-----------|--------------|  
|<span data-ttu-id="dbd36-191">агент моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="dbd36-191">Snapshot Agent</span></span>|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<integer>**|  
|<span data-ttu-id="dbd36-192">Агент моментальных снимков для секции публикации слиянием</span><span class="sxs-lookup"><span data-stu-id="dbd36-192">Snapshot Agent for a merge publication partition</span></span>|<span data-ttu-id="dbd36-193">**Dyn_\<Publisher>-\<PublicationDatabase>-\<Publication>-\<GUID>**</span><span class="sxs-lookup"><span data-stu-id="dbd36-193">**Dyn_\<Publisher>-\<PublicationDatabase>-\<Publication>-\<GUID>**</span></span>|  
|<span data-ttu-id="dbd36-194">Агент чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="dbd36-194">Log Reader Agent</span></span>|**\<Publisher>-\<PublicationDatabase>-\<integer>**|  
|<span data-ttu-id="dbd36-195">Агент слияния для подписок по запросу</span><span class="sxs-lookup"><span data-stu-id="dbd36-195">Merge Agent for pull subscriptions</span></span>|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<SubscriptionDatabase>-\<integer>**|  
|<span data-ttu-id="dbd36-196">Агент слияния для принудительных подписок</span><span class="sxs-lookup"><span data-stu-id="dbd36-196">Merge Agent for push subscriptions</span></span>|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>**|  
|<span data-ttu-id="dbd36-197">Агент распространителя для принудительных подписок</span><span class="sxs-lookup"><span data-stu-id="dbd36-197">Distribution Agent for push subscriptions</span></span>|<span data-ttu-id="dbd36-198">**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>** <sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="dbd36-198">**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>** <sup>1</sup></span></span>|  
|<span data-ttu-id="dbd36-199">Агент распространителя для подписок по запросу</span><span class="sxs-lookup"><span data-stu-id="dbd36-199">Distribution Agent for pull subscriptions</span></span>|<span data-ttu-id="dbd36-200">**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<SubscriptionDatabase>-\<GUID>** <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="dbd36-200">**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<SubscriptionDatabase>-\<GUID>** <sup>2</sup></span></span>|  
|<span data-ttu-id="dbd36-201">Агент распространителя для принудительных подписок подписчиков серверов, отличных от подписчиков SQL Server</span><span class="sxs-lookup"><span data-stu-id="dbd36-201">Distribution Agent for push subscriptions to non-SQL Server Subscribers</span></span>|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>**|  
|<span data-ttu-id="dbd36-202">Агент чтения очереди.</span><span class="sxs-lookup"><span data-stu-id="dbd36-202">Queue Reader Agent</span></span>|<span data-ttu-id="dbd36-203">**[\<Distributor>].\<integer>**</span><span class="sxs-lookup"><span data-stu-id="dbd36-203">**[\<Distributor>].\<integer>**</span></span>|  
  
 <span data-ttu-id="dbd36-204"><sup>1</sup> для принудительных подписок на публикации Oracle имя задания — \* \*, \<Publisher> - \<Publisher**> а не **\<Publisher>-\<PublicationDatabase>** .</span><span class="sxs-lookup"><span data-stu-id="dbd36-204"><sup>1</sup> For push subscriptions to Oracle publications, the job name is \*\*\<Publisher>-\<Publisher**> instead of **\<Publisher>-\<PublicationDatabase>**.</span></span>  
  
 <span data-ttu-id="dbd36-205"><sup>2</sup> для подписок по запросу на публикации Oracle имя задания — \* \*, \<Publisher> - \<DistributionDatabase**> а не **\<Publisher>-\<PublicationDatabase>** .</span><span class="sxs-lookup"><span data-stu-id="dbd36-205"><sup>2</sup> For pull subscriptions to Oracle publications, the job name is \*\*\<Publisher>-\<DistributionDatabase**> instead of **\<Publisher>-\<PublicationDatabase>**.</span></span>  
  
 <span data-ttu-id="dbd36-206">При настройке репликации задаются учетные записи, под которыми должны выполняться агенты.</span><span class="sxs-lookup"><span data-stu-id="dbd36-206">When you configure replication, you specify accounts under which agents should run.</span></span> <span data-ttu-id="dbd36-207">Однако все шаги заданий выполняются в контексте безопасности *учетной записи-посредника*, поэтому репликация осуществляет для указанных учетных записей агентов следующие внутренние сопоставления:</span><span class="sxs-lookup"><span data-stu-id="dbd36-207">However, all job steps run under the security context of a *proxy*; therefore, replication performs the following mappings internally for the agent accounts that you specify:</span></span>  
  
-   <span data-ttu-id="dbd36-208">Сначала учетная запись сопоставляется с учетными данными с помощью инструкции [!INCLUDE[tsql](../../../includes/tsql-md.md)] [CREATE CREDENTIAL](/sql/t-sql/statements/create-credential-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="dbd36-208">The account is first mapped to a credential by using the [!INCLUDE[tsql](../../../includes/tsql-md.md)] [CREATE CREDENTIAL](/sql/t-sql/statements/create-credential-transact-sql) statement.</span></span> <span data-ttu-id="dbd36-209">Учетные записи-посредники агента[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] используют учетные данные для хранения сведений об учетных записях пользователей Windows.</span><span class="sxs-lookup"><span data-stu-id="dbd36-209">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent proxies use credentials to store information about Windows user accounts.</span></span>  
  
-   <span data-ttu-id="dbd36-210">Вызывается хранимая процедура [sp_add_proxy](/sql/relational-databases/system-stored-procedures/sp-add-proxy-transact-sql) , а учетные данные используются для создания учетной записи-посредника.</span><span class="sxs-lookup"><span data-stu-id="dbd36-210">The [sp_add_proxy](/sql/relational-databases/system-stored-procedures/sp-add-proxy-transact-sql) stored procedure is called, and the credential is used to create a proxy..</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="dbd36-211">Эти сведения предоставляются для понимания, что происходит при запуске агентов в соответствующих контекстах безопасности.</span><span class="sxs-lookup"><span data-stu-id="dbd36-211">This information is provided to help you understand what is involved in running agents with the appropriate security context.</span></span> <span data-ttu-id="dbd36-212">Необязательно взаимодействовать непосредственно с учетными данными или созданными учетными записями-посредниками.</span><span class="sxs-lookup"><span data-stu-id="dbd36-212">You should not have to interact directly with the credentials or proxies that have been created.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dbd36-213">См. также:</span><span class="sxs-lookup"><span data-stu-id="dbd36-213">See Also</span></span>  
 <span data-ttu-id="dbd36-214">[Replication Security Best Practices](replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="dbd36-214">[Replication Security Best Practices](replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="dbd36-215">[Безопасность Репликация SQL Server](view-and-modify-replication-security-settings.md) </span><span class="sxs-lookup"><span data-stu-id="dbd36-215">[SQL Server Replication Security](view-and-modify-replication-security-settings.md) </span></span>  
 [<span data-ttu-id="dbd36-216">Защита папки моментальных снимков</span><span class="sxs-lookup"><span data-stu-id="dbd36-216">Secure the Snapshot Folder</span></span>](secure-the-snapshot-folder.md)  
  
  
