---
title: Модель безопасности агента репликации | Документация Майкрософт
ms.custom: ''
ms.date: 10/07/2015
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Snapshot Agent, security
- agents [SQL Server replication], security
- Distribution Agent, security
- logins [SQL Server replication], permissions for agents
- security [SQL Server replication], agent security model
- Log Reader Agent, security
- Queue Reader Agent, security
- Merge Agent, security
- replication [SQL Server], agents and profiles
ms.assetid: 6d09fc8d-843a-4a7a-9812-f093d99d8192
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: da597bf97422f5a0960062b385bc0b67338edfe1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87654153"
---
# <a name="replication-agent-security-model"></a>Модель безопасности агента репликации
  Модель безопасности агента репликации предоставляет возможность точного управления учетными записями, с которыми агенты репликации выполняются и устанавливают соединения: для каждого агента может быть задана своя учетная запись. Дополнительные сведения об определении учетных записей см. в статье [Управление именами входа и паролями в репликации](identity-and-access-control-replication.md#manage-logins-and-passwords-in-replication).  
  
> [!IMPORTANT]  
>  Если репликацию настраивает член предопределенной роли сервера **sysadmin** , агенты репликации можно настроить для олицетворения учетной записи агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . Это можно сделать, если не задавать имя входа и пароль для агента репликации, однако такой подход не рекомендуется. Вместо этого для обеспечения надежной защиты рекомендуется задать учетную запись для каждого агента с минимальными разрешениями, описанными в подразделе «Разрешения, необходимые для агентов» ниже в этом разделе.  
  
 Агенты репликации, как и все исполняемые объекты, запускаются в контексте учетной записи Windows. Агенты выполняют соединения встроенной безопасности Windows, используя эту учетную запись. Учетная запись, под которой выполняется агент, зависит от того, как он был запущен:  
  
-   Запуск агента из задания агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (по умолчанию): Когда для запуска агента репликации используется задание агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], агент репликации выполняется в контексте учетной записи, указанной при настройке репликации. Дополнительные сведения об агенте [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и репликации см. в подразделе «Безопасность агентов под управлением агента SQL Server» ниже в этом разделе. Сведения о разрешениях, необходимых для учетной записи, от имени которой выполняется агент [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], см. в статье [Настройка агента SQL Server](../../../ssms/agent/configure-sql-server-agent.md).  
  
-   Запуск агента из командной строки MS-DOS или непосредственно, или с помощью скрипта: агент выполняется в контексте учетной записи пользователя, запустившего его из командной строки.  
  
-   Запуск агента из приложения, использующего объекты RMO или элемент ActiveX: агент выполняется в контексте приложения, которое вызывает объект RMO или элемент ActiveX.  
  
    > [!NOTE]  
    >  Элементы управления ActiveX являются устаревшими.  
  
 Рекомендуется выполнять соединение в контексте встроенной безопасности Windows. В целях обратной совместимости также можно использовать безопасность [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . Дополнительные сведения о рекомендуемых подходах см. в разделе [Replication Security Best Practices](replication-security-best-practices.md).  
  
## <a name="permissions-that-are-required-by-agents"></a>Разрешения, необходимые для агентов  
 Учетные записи, под которыми выполняются и устанавливают соединения агенты, требуют различных разрешений. Описание этих разрешений приводится в следующей таблице. Рекомендуется выполнять каждый агент под отдельной учетной записью Windows, которым следует предоставлять только необходимые разрешения. Сведения о списке доступа к публикации (PAL), относящемся к нескольким агентам, см. в разделе [Защита издателя](secure-the-publisher.md).  
  
> [!NOTE]  
>  В некоторых операционных системах Windows с помощью средства «Контроль учетных записей» можно запретить административный доступ к хранилищу моментального снимка. Поэтому необходимо явно предоставить разрешения на доступ к хранилищу моментального снимка учетным записям Windows, которые используются агентом моментальных снимков, агентом распространителя и агентом слияния. Это необходимо делать даже в том случае, если эти учетные записи Windows являются членами группы «Администраторы». Дополнительные сведения см. в статье [Организация безопасности папки моментальных снимков](secure-the-snapshot-folder.md).  
  
|Агент|Разрешения|  
|-----------|-----------------|  
|агент моментальных снимков|При соединении с распространителем используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна удовлетворять следующим требованиям:<br /><br /> Она должна быть как минимум участником предопределенной роли базы данных **db_owner** в базе данных распространителя.<br /><br /> Она должна обладать разрешениями на чтение, запись и изменение в хранилище моментальных снимков.<br /><br /> <br /><br /> Учетная запись, используемая для соединения с издателем, должна быть как минимум членом предопределенной роли базы данных **db_owner** публикации.|  
|Агент чтения журнала.|При соединении с распространителем используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна быть как минимум членом предопределенной роли базы данных **db_owner** распространителя.<br /><br /> Учетная запись, используемая для соединения с издателем, должна быть как минимум членом предопределенной роли базы данных **db_owner** публикации.<br /><br /> При выборе `sync_type` параметров *только поддержка репликации*, *инициализации с помощью резервного копирования*или *инициализации из LSN*агент чтения журнала должен запускаться после выполнения `sp_addsubscription` , чтобы скрипты установки записывались в базу данных распространителя. Агент чтения журнала должен работать под учетной записью, которая является членом предопределенной роли сервера **sysadmin** . Если `sync_type` для параметра задано значение *автоматически*, специальные действия агента чтения журнала не требуются.|  
|Агент распространителя для принудительной подписки|При соединении с распространителем используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна удовлетворять следующим требованиям:<br /><br /> Она должна быть как минимум участником предопределенной роли базы данных **db_owner** в базе данных распространителя.<br /><br /> Она должна входить в список доступа к публикации.<br /><br /> Она должна иметь разрешение на чтение хранилища моментальных снимков.<br /><br /> Иметь разрешения на чтение из каталога, в который был установлен поставщик OLE DB для подписчика, если подписка предназначена для подписчика, отличного от подписчика SQL Server.<br /><br /> При репликации бизнес-данных агент распространения должен иметь разрешения на репликацию **C:\Program Files\Microsoft SQL Server\XX\COMfolder** , где XX — идентификатор экземпляра.<br /><br /> <br /><br /> Учетная запись, используемая для соединения с подписчиком, должна быть как минимум членом предопределенной роли базы данных **db_owner** подписки или иметь равнозначные права, если подписка предназначена для подписчика, отличного от подписчика SQL Server.<br /><br /> Примечание. при использовании `-subscriptionstreams >= 2` в агенте распространителя необходимо также предоставить `View Server State` разрешение на подписчики для обнаружения взаимоблокировок.|  
|Агент распространителя для подписки по запросу|При соединении с подписчиком используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна быть как минимум членом предопределенной роли базы данных **db_owner** подписки. Учетная запись, используемая для соединения с распространителем, должна удовлетворять следующим требованиям:<br /><br /> Она должна входить в список доступа к публикации.<br /><br /> Она должна иметь разрешение на чтение хранилища моментальных снимков.<br /><br /> При репликации бизнес-данных агент распространения должен иметь разрешения на репликацию **C:\Program Files\Microsoft SQL Server\XX\COMfolder** , где XX — идентификатор экземпляра.<br /><br /> <br /><br /> Примечание. при использовании `-subscriptionstreams >= 2` в агенте распространителя необходимо также предоставить `View Server State` разрешение на подписчики для обнаружения взаимоблокировок.|  
|Агент слияния для принудительной подписки|При подключениях к издателю и распространителю используется та учетная запись Windows, под которой выполняется агент. Эта учетная запись должна удовлетворять следующим требованиям:<br /><br /> Она должна быть как минимум участником предопределенной роли базы данных **db_owner** в базе данных распространителя.<br /><br /> Она должна входить в список доступа к публикации.<br /><br /> Он должна иметь имя для входа, связанное с пользователем в базе данных публикации.<br /><br /> Она должна иметь разрешение на чтение хранилища моментальных снимков.<br /><br /> <br /><br /> Учетная запись, используемая для соединения с подписчиком, должна быть как минимум членом предопределенной роли базы данных **db_owner** подписки.|  
|Агент слияния для подписки по запросу|При соединении с подписчиком используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна быть как минимум членом предопределенной роли базы данных **db_owner** подписки. Учетная запись, используемая для соединения с издателем и распространителем, должна удовлетворять следующим требованиям:<br /><br /> Она должна входить в список доступа к публикации.<br /><br /> Она должна иметь имя для входа, связанное с пользователем в базе данных публикации.<br /><br /> Она должна иметь имя для входа, связанное с пользователем в базе данных распространителя. Пользователь может иметь учетную запись `Guest`.<br /><br /> Она должна иметь разрешение на чтение хранилища моментальных снимков.|  
|Агент чтения очереди.|При соединении с распространителем используется учетная запись Windows, под которой выполняется агент. Эта учетная запись должна быть как минимум членом предопределенной роли базы данных **db_owner** распространителя.<br /><br /> Учетная запись, используемая для соединения с издателем, должна быть как минимум членом предопределенной роли базы данных **db_owner** публикации.<br /><br /> Учетная запись, используемая для соединения с подписчиком, должна быть как минимум членом предопределенной роли базы данных **db_owner** публикации.|  
  
## <a name="agent-security-under-sql-server-agent"></a>Безопасность агентов под управлением агента SQL Server  
 При настройке репликации с помощью среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], процедур [!INCLUDE[tsql](../../../includes/tsql-md.md)] или объектов RMO по умолчанию для каждого агента создается задание агента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . Затем агенты выполняются в контексте соответствующего шага задания, вне зависимости от того, выполняются ли они постоянно, по расписанию или по запросу. Эти задания можно просмотреть в папке **Задания** в среде [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]. В следующей таблице перечислены имена заданий.  
  
|Агент|Имя задания|  
|-----------|--------------|  
|агент моментальных снимков|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<integer>**|  
|Агент моментальных снимков для секции публикации слиянием|**Dyn_\<Publisher>-\<PublicationDatabase>-\<Publication>-\<GUID>**|  
|Агент чтения журнала.|**\<Publisher>-\<PublicationDatabase>-\<integer>**|  
|Агент слияния для подписок по запросу|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<SubscriptionDatabase>-\<integer>**|  
|Агент слияния для принудительных подписок|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>**|  
|Агент распространителя для принудительных подписок|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>** <sup>1</sup>|  
|Агент распространителя для подписок по запросу|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<SubscriptionDatabase>-\<GUID>** <sup>2</sup>|  
|Агент распространителя для принудительных подписок подписчиков серверов, отличных от подписчиков SQL Server|**\<Publisher>-\<PublicationDatabase>-\<Publication>-\<Subscriber>-\<integer>**|  
|Агент чтения очереди.|**[\<Distributor>].\<integer>**|  
  
 <sup>1</sup> для принудительных подписок на публикации Oracle имя задания — * *, \<Publisher> - \<Publisher**> а не **\<Publisher>-\<PublicationDatabase>** .  
  
 <sup>2</sup> для подписок по запросу на публикации Oracle имя задания — * *, \<Publisher> - \<DistributionDatabase**> а не **\<Publisher>-\<PublicationDatabase>** .  
  
 При настройке репликации задаются учетные записи, под которыми должны выполняться агенты. Однако все шаги заданий выполняются в контексте безопасности *учетной записи-посредника*, поэтому репликация осуществляет для указанных учетных записей агентов следующие внутренние сопоставления:  
  
-   Сначала учетная запись сопоставляется с учетными данными с помощью инструкции [!INCLUDE[tsql](../../../includes/tsql-md.md)] [CREATE CREDENTIAL](/sql/t-sql/statements/create-credential-transact-sql). Учетные записи-посредники агента[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] используют учетные данные для хранения сведений об учетных записях пользователей Windows.  
  
-   Вызывается хранимая процедура [sp_add_proxy](/sql/relational-databases/system-stored-procedures/sp-add-proxy-transact-sql) , а учетные данные используются для создания учетной записи-посредника.  
  
> [!NOTE]  
>  Эти сведения предоставляются для понимания, что происходит при запуске агентов в соответствующих контекстах безопасности. Необязательно взаимодействовать непосредственно с учетными данными или созданными учетными записями-посредниками.  
  
## <a name="see-also"></a>См. также:  
 [Replication Security Best Practices](replication-security-best-practices.md)   
 [Безопасность Репликация SQL Server](view-and-modify-replication-security-settings.md)   
 [Защита папки моментальных снимков](secure-the-snapshot-folder.md)  
  
  
