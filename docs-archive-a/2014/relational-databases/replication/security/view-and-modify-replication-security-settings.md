---
title: Просмотр и изменение параметров безопасности репликации | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- modifying replication security settings
- replication [SQL Server], security
- security [SQL Server replication], viewing settings
- viewing replication security settings
- security [SQL Server replication], modifying settings
ms.assetid: 67d79532-1482-4de1-ac9f-4a23d162c85e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8da4a6e8093c6f04e06b68448660e4096e9e5c22
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87668768"
---
# <a name="view-and-modify-replication-security-settings"></a>Просмотр и изменение параметров безопасности репликации
  В данном разделе описывается процесс просмотра и изменения параметров безопасности репликации в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] при помощи среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)]или объектов RMO. Например, может потребоваться изменение подключения агента чтения журнала к издателю для использования проверки подлинности SQL Server вместо встроенной проверки подлинности Windows, или может потребоваться изменение учетных данных для запуска задания агента при изменении пароля учетной записи Windows. Дополнительные сведения о разрешениях, необходимых каждому агенту, см. в разделе [Модель безопасности агента репликации](replication-agent-security-model.md).  
  
 **В этом разделе**  
  
-   **Перед началом работы**  
  
     [Ограничения](#Restrictions)  
  
     [Безопасность](#Security)  
  
-   **Для просмотра и изменения параметров безопасности репликации используется:**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
     [объекты RMO;](#RMOProcedure)  
  
-   **Дальнейшие действия.**  [После изменения параметров безопасности репликации](#FollowUp)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> Ограничения  
  
-   Какие именно хранимые процедуры для этого применяются, зависит от типа агента и соединения с сервером.  
  
-   Используемые классы и свойства RMO зависят от типа агента и типа соединения с сервером.  
  
###  <a name="security"></a><a name="Security"></a> безопасность  
 В целях безопасности пароли, возвращаемые хранимыми процедурами репликации в результирующих наборах, будут замаскированы.  
  
####  <a name="permissions"></a><a name="Permissions"></a> Permissions  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
 Просмотр и изменение настроек безопасности осуществляется в следующих диалоговых окнах:  
  
1.  В диалоговом окне **Обновление паролей репликации** , которое доступно из папки **Репликация** в среде [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]. При изменении пароля для учетной записи [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] или учетной записи Windows на сервере в топологии репликации, нужно использовать это диалоговое окно, а не обновлять пароль для каждого агента, использующего эту учетную запись. Если агенты на нескольких серверах используют одну и ту же учетную запись, то нужно подключиться к каждому из этих серверов и изменить пароль. Обновление пароля осуществляется везде, где его использует репликация. В других местах, например на связанных серверах, обновление пароля не происходит.  
  
2.  Страница **Безопасность агентов** диалогового окна **Свойства публикации — \<Publication>** . Дополнительные сведения о доступе к этому диалоговому окну см. в разделе [Просмотр и изменение свойств публикации](../publish/view-and-modify-publication-properties.md).  
  
3.  Диалоговое окно **Свойства подписки — \<Subscription>** . Дополнительные сведения о доступе к этому диалоговому окну см. в разделах [Просмотр и изменение свойств принудительной подписки](../view-and-modify-push-subscription-properties.md) и [Просмотр и изменение свойств подписки по запросу](../view-and-modify-pull-subscription-properties.md).  
  
4.  Диалоговые окна **Свойства распространителя — \<Distributor>** и **Свойства базы данных распространителя — \<Database>** . Дополнительные сведения о доступе к этим диалоговым окнам см. в разделе [Просмотр и изменение свойств издателя и распространителя](../view-and-modify-distributor-and-publisher-properties.md).  
  
5.  Диалоговое окно **Свойства издателя — \<Publisher>** . Дополнительные сведения о доступе к этому диалоговому окну см. в разделе [Просмотр и изменение свойств издателя и распространителя](../view-and-modify-distributor-and-publisher-properties.md).  
  
#### <a name="to-change-the-password-for-an-account-used-by-one-or-more-agents"></a>Изменение пароля для учетной записи, используемой одним или несколькими агентами  
  
1.  Если учетная запись является учетной записью SQL Server, то это диалоговое окно также изменит пароль для учетной записи SQL Server. Если учетная запись является учетной записью Windows, то нужно вначале изменить пароль в Windows. Дополнительные сведения см. в документации по Windows.  
  
    > [!NOTE]  
    >  После изменения пароля репликации необходимо остановить и перезапустить каждый агент, пользующийся этим паролем, прежде чем изменение вступит в силу для этого агента.  
  
2.  Подключитесь к серверу в среде [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], а затем раскройте узел сервера.  
  
3.  Щелкните правой кнопкой мыши папку **Репликация** , а затем щелкните **Обновить пароли репликации**.  
  
4.  В диалоговом окне **Обновление паролей репликации** укажите учетную запись и новый пароль.  
  
5.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### <a name="to-change-security-settings-for-the-snapshot-agent"></a>Изменение настроек безопасности для агента моментальных снимков  
  
1.  На странице **Безопасность агентов** диалогового окна **Свойства публикации — \<Publication>** нажмите кнопку **Настройки безопасности** рядом с текстовым полем **Агент моментальных снимков**.  
  
2.  В диалоговом окне **Безопасность агента моментальных снимков** укажите учетную запись, под которой должен запускаться агент:  
  
    -   Введите новую учетную запись Windows в текстовое поле **Учетная запись агента** .  
  
    -   Введите новый надежный пароль в текстовые поля **Пароль** и **Подтверждение пароля** .  
  
3.  Укажите контекст, в условиях которого агент должен подключаться с распространителя к издателю. Если вы выбрали **С использованием следующего имени входа SQL Server**, то вы также должны задать имя входа:  
  
    -   Введите имя входа в текстовое поле **Имя входа** .  
  
    -   Введите новый надежный пароль в текстовые поля **Пароль** и **Подтверждение пароля** .  
  
    > [!NOTE]  
    >  Если издатель является издателем Oracle, то в диалоговом окне **Свойства распространителя —\<Distributor>** задается контекст соединения. Процедура изменения контекста приведена ниже.  
  
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### <a name="to-change-security-settings-for-the-log-reader-agent"></a>Изменение настроек безопасности для агента чтения журнала  
  
1.  На странице **Безопасность агентов** диалогового окна **Свойства публикации — \<Publication>** нажмите кнопку **Настройки безопасности** рядом с текстовым полем **Агент чтения журнала**.  
  
2.  В диалоговом окне **Безопасность агента чтения журнала** задайте учетную запись, под которой должен запускаться агент:  
  
    -   Введите новую учетную запись Windows в текстовое поле **Учетная запись агента** .  
  
    -   Введите новый надежный пароль в текстовые поля **Пароль** и **Подтверждение пароля** .  
  
3.  Укажите контекст, в условиях которого агент должен подключаться с распространителя к издателю. Если вы выбрали **С использованием следующего имени входа SQL Server**, то вы также должны задать имя входа:  
  
    -   Введите имя входа в текстовое поле **Имя входа** .  
  
    -   Введите новый надежный пароль в текстовые поля **Пароль** и **Подтверждение пароля** .  
  
    > [!NOTE]  
    >  Если издатель является издателем Oracle, то в диалоговом окне **Свойства распространителя —\<Distributor>** задается контекст соединения. Измените контекст с использованием следующей процедуры.  
  
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
    > [!NOTE]  
    >  Для каждой публикуемой базы данных существует только один агент чтения журнала. Изменение настроек безопасности для этого агента в одной публикации влияет на настройки всех публикаций в базе данных публикации.  
  
#### <a name="to-change-the-context-under-which-the-snapshot-agent-and-log-reader-agent-for-an-oracle-publication-make-connections-to-the-publisher"></a>Изменение контекста, под которым агент моментальных снимков и агент чтения журнала для публикации Oracle осуществляют соединения с издателем  
  
1.  На странице **Издатели** диалогового окна **Свойства распространителя — \<Distributor>** нажмите кнопку свойств ( **...** ) рядом с издателем.  
  
2.  В разделе **Соединение агента с издателем** задайте имя входа и пароль, используемые настроенной вами схемой административного пользователя репликации. Дополнительные сведения см. в статье [Настройка издателя Oracle](../non-sql/configure-an-oracle-publisher.md).  
  
3.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### <a name="to-change-security-settings-for-the-distribution-agent-for-a-push-subscription"></a>Изменение настроек безопасности агента распространителя для принудительной подписки  
  
1.  В диалоговом окне **Свойства подписки —\<Subscription>** на издателе можно внести следующие изменения.  
  
    -   Чтобы изменить учетную запись, от имени которой агент распространителя запускается и устанавливает соединение с распространителем, щелкните строку **Учетная запись процесса агента**, а затем нажмите кнопку свойств ( **...** ) в строке. Задайте учетную запись и пароль в диалоговом окне **Безопасность агента распространителя** .  
  
    -   Чтобы изменить контекст, в котором агент распространителя подключается к подписчику, щелкните строку **Соединение с подписчиком**, а затем нажмите кнопку свойств ( **...** ) в строке. Задайте контекст в диалоговом окне **Ввод сведений о соединении** .  
  
         При использовании подписок, обновляемых посредством очередей, заданный здесь контекст используется также агентом чтения очереди для подключений к подписчику.  
  
2.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### <a name="to-change-security-settings-for-the-distribution-agent-for-a-pull-subscription"></a>Изменение настроек безопасности агента распространителя для подписки по запросу  
  
1.  В диалоговом окне **Свойства подписки —\<Subscription>** на подписчике можно внести следующие изменения.  
  
    -   Чтобы изменить учетную запись, от имени которой агент распространителя запускается и устанавливает соединения с подписчиком, щелкните строку **Учетная запись процесса агента**, а затем нажмите кнопку свойств ( **...** ) в строке. Задайте учетную запись и пароль в диалоговом окне **Безопасность агента распространителя** .  
  
         При использовании подписок, обновляемых посредством очередей, заданный здесь контекст используется также агентом чтения очереди для подключений к подписчику.  
  
    -   Чтобы изменить контекст, в котором агент распространителя соединяется с распространителем, щелкните строку **Соединение с распространителем**, а затем нажмите кнопку свойств ( **...** ) в строке. Задайте контекст в диалоговом окне **Ввод сведений о соединении** .  
  
2.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### <a name="to-change-security-settings-for-the-merge-agent-for-a-push-subscription"></a>Изменение настроек безопасности агента слияния для принудительной подписки  
  
1.  В диалоговом окне **Свойства подписки —\<Subscription>** на издателе можно внести следующие изменения.  
  
    -   Чтобы изменить учетную запись, от имени которой агент слияния запускается и устанавливает соединения с издателем и распространителем, щелкните строку **Учетная запись процесса агента**, а затем нажмите кнопку свойств ( **...** ) в строке. Задайте учетную запись и пароль в диалоговом окне **Безопасность агента слияния** .  
  
    -   Чтобы изменить контекст, в котором агент слияния соединяется с подписчиком, щелкните строку **Соединение с подписчиком**, а затем нажмите кнопку свойств ( **...** ) в строке. Задайте контекст в диалоговом окне **Ввод сведений о соединении** .  
  
2.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### <a name="to-change-security-settings-for-the-merge-agent-for-a-pull-subscription"></a>Изменение настроек безопасности агента слияния для подписки по запросу  
  
1.  В диалоговом окне **Свойства подписки —\<Subscription>** на подписчике можно внести следующие изменения.  
  
    -   Чтобы изменить учетную запись, от имени которой агент слияния запускается и устанавливает соединения с подписчиком, щелкните строку **Учетная запись процесса агента**, а затем нажмите кнопку свойств ( **...** ) в строке. Задайте учетную запись и пароль в диалоговом окне **Безопасность агента слияния** .  
  
    -   Чтобы изменить контекст, в котором агент слияния подключается к издателю и распространителю, щелкните строку **Соединение с издателем**, а затем нажмите кнопку свойств ( **...** ) в строке. Задайте контекст в диалоговом окне **Ввод сведений о соединении** .  
  
2.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### <a name="to-change-the-account-under-which-the-queue-reader-agent-runs"></a>Изменение учетной записи, под которой запускается агент чтения очереди  
  
1.  На странице **Общие** диалогового окна **Свойства распространителя — \<Distributor>** нажмите кнопку свойств ( **...** ) возле базы данных распространителя.  
  
2.  В диалоговом окне **Свойства базы данных распространителя —\<Database>** нажмите кнопку **Настройки безопасности** рядом с текстовым полем **Учетная запись процесса агента**.  
  
3.  В диалоговом окне **Безопасность агента чтения очереди** задайте учетную запись, под которой агент запускается и устанавливает соединение с распространителем:  
  
    -   Введите новую учетную запись Windows в текстовое поле **Учетная запись процесса**  
  
    -   Введите новый надежный пароль в текстовые поля **Пароль** и **Подтверждение пароля** .  
  
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
    > [!NOTE]  
    >  Для каждой базы распространителя существует только один агент чтения очереди. Изменение настроек безопасности агента оказывает влияние на параметры всех публикаций на всех издателях, использующих эту базу данных распространителя.  
  
#### <a name="to-change-the-context-under-which-the-queue-reader-agent-makes-connections-to-the-publisher"></a>Изменение контекста, под которым агент чтения очереди устанавливает соединения с издателем  
  
1.  На странице **Издатели** диалогового окна **Свойства распространителя — \<Distributor>** нажмите кнопку свойств ( **...** ) рядом с издателем.  
  
2.  В разделе **Соединение агента с издателем** задайте значение **Выполнять олицетворение учетной записи процесса агента** или **Проверка подлинности SQL Server** для параметра **Режим соединения агента** . Если вы задали **Проверка подлинности SQL Server**, то также введите значения для **Имя входа** и **Пароль**.  
  
3.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
    > [!NOTE]  
    >  Для каждой базы распространителя существует только один агент чтения очереди. Изменение настроек безопасности агента оказывает влияние на параметры всех публикаций на всех издателях, использующих эту базу данных распространителя.  
  
#### <a name="to-change-the-context-under-which-the-queue-reader-agent-makes-connections-to-the-subscriber"></a>Изменение контекста, под которым агент чтения очереди устанавливает соединения с подписчиком  
  
-   Агент чтения очереди использует тот же контекст соединения, который используется агентом распространителя для подписки. Дополнительные сведения см. выше в описании процедуры для агента распространителя.  
  
#### <a name="to-change-security-settings-for-an-immediate-updating-pull-subscription"></a>Изменение настроек безопасности для подписки по запросу, обновляемой немедленно  
  
1.  В диалоговом окне **свойства \<Subscription> подписки —** на подписчике щелкните строку **соединение с издателем** , а затем нажмите кнопку свойств (**...**) в строке.  
  
2.  В диалоговом окне **Ввод сведений о соединении** выберите один из следующих параметров:  
  
    -   **Использовать имя входа со связанного или удаленного сервера**. Выберите этот параметр, если вы определили удаленный сервер или связанный сервер между подписчиком и издателем с помощью [sp_addserver (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addserver-transact-sql),[sp_addlinkedserver (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addlinkedserver-transact-sql), [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] или другого метода.  
  
    -   **Использовать проверку подлинности SQL Server со следующим именем входа и паролем**. Выберите этот параметр, если вы не определили удаленный сервер или связанный сервер между подписчиком и издателем. Репликация создаст связанный сервер. Указанная учетная запись уже должна существовать на издателе.  
  
3.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
> [!NOTE]  
>  Данная процедура изменяет метод, используемый триггерами репликации для соединения между подписчиком и издателем при внесении изменений на подписчике. Также можно изменить настройки, связанные с агентом распространителя, для подписки, обновляемой немедленно. Дополнительные сведения см. в описании процедуры, приведенном выше в данном разделе.  
>   
>  Данная процедура применяется только к подпискам по запросу. Для принудительных подписок нужно использовать хранимую процедуру [sp_link_publication (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-link-publication-transact-sql).  
  
#### <a name="to-change-the-password-for-the-administrative-connection-from-the-publisher-to-the-distributor"></a>Изменение пароля для административного соединения между издателем и распространителем  
  
1.  На странице **Издатели** диалогового окна **Свойства распространителя — \<Distributor>** введите надежный пароль в текстовые поля **Пароль** и **Подтверждение пароля**.  
  
2.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
3.  На странице **Общие** диалогового окна **Свойства издателя — \<Publisher>** введите надежный пароль в текстовые поля **Пароль** и **Подтверждение пароля**.  
  
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> Использование Transact-SQL  
  
> [!IMPORTANT]  
>  При выполнении всех следующих процедур, если это возможно, предлагайте пользователю вводить учетные данные безопасности во время выполнения. При хранении учетных данных в файле скрипта необходимо защитить этот файл во избежание несанкционированного доступа.  
  
#### <a name="to-change-all-instances-of-a-stored-password-at-a-replication-server"></a>Изменение всех экземпляров сохраненного пароля на сервере репликации  
  
1.  На сервере базы данных master в топологии репликации выполните хранимую процедуру [sp_changereplicationserverpasswords](/sql/relational-databases/system-stored-procedures/sp-changereplicationserverpasswords-transact-sql). Укажите [!INCLUDE[msCoName](../../../includes/msconame-md.md)] учетную запись Windows или [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] имя входа, чей пароль изменяется для ** \@ имени входа** , и новый пароль для учетной записи или имя входа для ** \@ пароля**. В результате выполнения этой операции производится изменение всех экземпляров пароля, используемого всеми агентами сервера для соединения с другими серверами топологии.  
  
    > [!NOTE]  
    >  Чтобы изменить имя входа и пароль для подключения к определенному серверу в топологии (например, распространителю или подписчику), укажите сервер в качестве имени ** \@ сервера**.  
  
2.  Повторите шаг 1 на каждом из серверов в топологии репликации, где необходимо изменить пароль.  
  
    > [!NOTE]  
    >  После изменения пароля репликации необходимо остановить и перезапустить каждый агент, пользующийся этим паролем, прежде чем изменение вступит в силу для этого агента.  
  
#### <a name="to-change-security-settings-for-the-snapshot-agent"></a>Изменение настроек безопасности для агента моментальных снимков  
  
1.  На издателе выполните [sp_helppublication_snapshot](/sql/relational-databases/system-stored-procedures/sp-helppublication-snapshot-transact-sql), указав ** \@ publication**. Она возвращает текущие параметры безопасности агента моментальных снимков.  
  
2.  На издателе выполните [sp_changepublication_snapshot](/sql/relational-databases/system-stored-procedures/sp-changepublication-snapshot-transact-sql), указав ** \@ публикацию** и одну или несколько следующих параметров безопасности для изменения:  
  
    -   Чтобы изменить учетную запись Windows, от имени которой запускается агент, или просто пароль для этой учетной записи, укажите ** \@ job_login** и ** \@ job_password**.  
  
    -   Чтобы изменить режим безопасности, используемый при соединении с издателем, укажите значение **1** или **0** для ** \@ publisher_security_mode**.  
  
    -   При изменении режима безопасности, используемого при соединении с издателем от **1** до **0** или при изменении [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] имени входа, используемого для этого соединения, укажите ** \@ publisher_login** и ** \@ publisher_password**.  
  
    > [!IMPORTANT]  
    >  Если издатель настраивается с удаленным распространителем, то значения, передаваемые для всех аргументов, включая *job_login* и *job_password*, передаются распространителю в формате обычного (незашифрованного) текста. Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем. Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).  
  
#### <a name="to-change-security-settings-for-the-log-reader-agent"></a>Изменение настроек безопасности для агента чтения журнала  
  
1.  На издателе выполните [sp_helplogreader_agent](/sql/relational-databases/system-stored-procedures/sp-helplogreader-agent-transact-sql), указав ** \@ Издатель**. Она возвращает текущие параметры безопасности агента чтения журнала.  
  
2.  На издателе выполните [sp_changelogreader_agent](/sql/relational-databases/system-stored-procedures/sp-changelogreader-agent-transact-sql), указав ** \@ публикацию** и одну или несколько следующих параметров безопасности для изменения:  
  
    -   Чтобы изменить учетную запись Windows, от имени которой запускается агент, или просто пароль для этой учетной записи, укажите ** \@ job_login** и ** \@ job_password**.  
  
    -   Чтобы изменить режим безопасности, используемый при соединении с издателем, укажите значение **1** или **0** для ** \@ publisher_security_mode**.  
  
    -   При изменении режима безопасности, используемого при соединении с издателем от **1** до **0** или при изменении [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] имени входа, используемого для этого соединения, укажите ** \@ publisher_login** и ** \@ publisher_password**.  
  
    > [!NOTE]  
    >  После изменения имени входа и пароля агента необходимо остановить и повторно запустить агент, чтобы изменения вступили в силу.  
  
    > [!IMPORTANT]  
    >  Если издатель настраивается с удаленным распространителем, то значения, передаваемые для всех аргументов, включая *job_login* и *job_password*, передаются распространителю в формате обычного (незашифрованного) текста. Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем. Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).  
  
#### <a name="to-change-security-settings-for-the-distribution-agent-for-a-push-subscription"></a>Изменение настроек безопасности агента распространителя для принудительной подписки  
  
1.  На издателе в базе данных публикации выполните [sp_helpsubscription](/sql/relational-databases/system-stored-procedures/sp-helpsubscription-transact-sql), указав ** \@ публикацию** и ** \@ подписчика**. Она возвращает свойства подписки, включая параметры безопасности агента распространителя на распространителе.  
  
2.  На издателе в базе данных публикации выполните [sp_changesubscription](/sql/relational-databases/system-stored-procedures/sp-changesubscription-transact-sql), указав ** \@ публикацию**, ** \@ подписчик**, ** \@ subscriber_db**, значение **ALL** для ** \@ статьи**, имя свойства безопасности для ** \@ Свойства**и новое значение свойства для ** \@ value**.  
  
3.  Повторите шаг 2 для каждого из следующих свойств безопасности, которые подвергаются изменениям.  
  
    -   Чтобы изменить учетную запись Windows, под которой запускается агент, или только пароль для этой учетной записи, укажите значение **distrib_job_password** для ** \@ Свойства** и новый пароль для ** \@ параметра значение**. При изменении самой учетной записи повторите шаг 2, указав значение **distrib_job_login** для ** \@ Свойства** , а для новой учетной записи Windows — ** \@ значение**.  
  
    -   Чтобы изменить режим безопасности, используемый при соединении с подписчиком, укажите значение **subscriber_security_mode** для ** \@ Свойства** и значение **1** (встроенная проверка подлинности Windows) или **0** (проверка подлинности SQL Server) для ** \@ параметра значение**.  
  
    -   При изменении режима безопасности подписчика на SQL Serverную проверку подлинности или при изменении данных входа для SQL Server проверки подлинности укажите значение **subscriber_password** для ** \@ Свойства** и новый пароль для ** \@ параметра значение**. Повторите шаг 2, указав значение **subscriber_login** для ** \@ Свойства** и новое имя входа для ** \@ параметра значение**.  
  
    > [!NOTE]  
    >  После изменения имени входа и пароля агента необходимо остановить и повторно запустить агент, чтобы изменения вступили в силу.  
  
    > [!IMPORTANT]  
    >  При настройке издателя с удаленным распространителем значения, передаваемые для всех аргументов, включая **distrib_job_login** и **distrib_job_password**, передаются распространителю в виде обычного текста. Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем. Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).  
  
#### <a name="to-change-security-settings-for-the-distribution-agent-for-a-pull-subscription"></a>Изменение настроек безопасности агента распространителя для подписки по запросу  
  
1.  На подписчике выполните [sp_helppullsubscription](/sql/relational-databases/system-stored-procedures/sp-helppullsubscription-transact-sql), указав ** \@ publication**. Она возвращает список свойств подписки, включая параметры безопасности агента распространителя на подписчике.  
  
2.  На подписчике в базе данных подписки выполните [sp_change_subscription_properties](/sql/relational-databases/system-stored-procedures/sp-change-subscription-properties-transact-sql), указав ** \@ Publisher**, ** \@ publisher_db**, ** \@ publication**, имя свойства безопасности для ** \@ Свойства**и новое значение свойства для ** \@ value**.  
  
3.  Повторите шаг 2 для каждого из следующих свойств безопасности, которые подвергаются изменениям.  
  
    -   Чтобы изменить учетную запись Windows, под которой запускается агент, или только пароль для этой учетной записи, укажите значение **distrib_job_password** для ** \@ Свойства** и новый пароль для ** \@ параметра значение**. При изменении самой учетной записи повторите шаг 2, указав значение **distrib_job_login** для ** \@ Свойства** , а для новой учетной записи Windows — ** \@ значение**.  
  
    -   Чтобы изменить режим безопасности, используемый при соединении с распространителем, укажите значение **distributor_security_mode** для ** \@ Свойства** и значение **1** (встроенная проверка подлинности Windows) или **0** (проверка подлинности SQL Server ** \@ ).**  
  
    -   При изменении режима безопасности распространителя на SQL Server проверку подлинности или при изменении данных входа для SQL Server проверки подлинности укажите значение **distributor_password** для ** \@ Свойства** и новый пароль для ** \@ параметра значение**. Повторите шаг 2, указав значение **distributor_login** для ** \@ Свойства** и новое имя входа для ** \@ параметра значение**.  
  
    > [!NOTE]  
    >  После изменения имени входа и пароля агента необходимо остановить и повторно запустить агент, чтобы изменения вступили в силу.  
  
#### <a name="to-change-security-settings-for-the-merge-agent-for-a-push-subscription"></a>Изменение настроек безопасности агента слияния для принудительной подписки  
  
1.  На издателе в базе данных публикации выполните [sp_helpmergesubscription](/sql/relational-databases/system-stored-procedures/sp-helpmergesubscription-transact-sql), указав ** \@ публикацию**, ** \@ подписчик**и ** \@ subscriber_db**. Она возвращает свойства подписки, включая параметры безопасности агента слияния на распространителе.  
  
2.  На издателе в базе данных публикации выполните [sp_changemergesubscription](/sql/relational-databases/system-stored-procedures/sp-changemergesubscription-transact-sql), указав ** \@ публикацию**, ** \@ подписчик**, ** \@ subscriber_db**, имя свойства безопасности для ** \@ Свойства**и новое значение свойства в поле ** \@ значение**.  
  
3.  Повторите шаг 2 для каждого из следующих свойств безопасности, которые подвергаются изменениям.  
  
    -   Чтобы изменить учетную запись Windows, под которой запускается агент, или только пароль для этой учетной записи, укажите значение **merge_job_password** для ** \@ Свойства** и новый пароль для ** \@ параметра значение**. При изменении самой учетной записи повторите шаг 2, указав значение **merge_job_login** для ** \@ Свойства** , а для новой учетной записи Windows — ** \@ значение**.  
  
    -   Чтобы изменить режим безопасности, используемый при соединении с подписчиком, укажите значение **subscriber_security_mode** для ** \@ Свойства** и значение **1** (встроенная проверка подлинности Windows) или **0** (проверка подлинности SQL Server) для ** \@ параметра значение**.  
  
    -   При изменении режима безопасности подписчика на SQL Serverную проверку подлинности или при изменении данных входа для SQL Server проверки подлинности укажите значение **subscriber_password** для ** \@ Свойства** и новый пароль для ** \@ параметра значение**. Повторите шаг 2, указав значение **subscriber_login** для ** \@ Свойства** и новое имя входа для ** \@ параметра значение**.  
  
    -   Чтобы изменить режим безопасности, используемый при соединении с издателем, укажите значение **publisher_security_mode** для ** \@ Свойства** и значение **1** (встроенная проверка подлинности Windows) или **0** (проверка подлинности SQL Server ** \@ ).**  
  
    -   При изменении режима безопасности издателя на SQL Server проверку подлинности или при изменении данных входа для SQL Server проверки подлинности укажите значение **publisher_password** для ** \@ Свойства** и новый пароль для ** \@ параметра значение**. Повторите шаг 2, указав значение **publisher_login** для ** \@ Свойства** и новое имя входа для ** \@ параметра значение**.  
  
    > [!NOTE]  
    >  После изменения имени входа и пароля агента необходимо остановить и повторно запустить агент, чтобы изменения вступили в силу.  
  
    > [!IMPORTANT]  
    >  При настройке издателя для работы с удаленным распространителем все передаваемые значения свойств, включая **merge_job_login** и **merge_job_password**, передаются распространителю в виде обычного текста. Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем. Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).  
  
#### <a name="to-change-security-settings-for-the-merge-agent-for-a-pull-subscription"></a>Изменение настроек безопасности агента слияния для подписки по запросу  
  
1.  На подписчике выполните [sp_helpmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-helpmergepullsubscription-transact-sql), указав ** \@ publication**. Она возвращает свойства подписки, включая параметры безопасности агента слияния на подписчике.  
  
2.  На подписчике в базе данных подписки выполните [sp_change_subscription_properties](/sql/relational-databases/system-stored-procedures/sp-change-subscription-properties-transact-sql), указав ** \@ Publisher**, ** \@ publisher_db**, ** \@ publication**, имя свойства безопасности для ** \@ Свойства**и новое значение свойства для ** \@ value**.  
  
3.  Повторите шаг 2 для каждого из следующих свойств безопасности, которые подвергаются изменениям.  
  
    -   Чтобы изменить учетную запись Windows, под которой запускается агент, или только пароль для этой учетной записи, укажите значение **merge_job_password** для ** \@ Свойства** и новый пароль в поле ** \@ значение**. При изменении самой учетной записи повторите шаг 2, указав значение **merge_job_login** для ** \@ Свойства** , а для новой учетной записи Windows — ** \@ значение**.  
  
    -   Чтобы изменить режим безопасности, используемый при соединении с распространителем, укажите значение **distributor_security_mode** для ** \@ Свойства** и значение **1** (встроенная проверка подлинности Windows) или **0** (проверка подлинности SQL Server ** \@ ).**  
  
    -   При изменении режима безопасности распространителя на SQL Server проверку подлинности или при изменении данных входа для SQL Server проверки подлинности укажите значение **distributor_password** для ** \@ Свойства** и новый пароль для ** \@ параметра значение**. Повторите шаг 2, указав значение **distributor_login** для ** \@ Свойства** и новое имя входа для ** \@ параметра значение**.  
  
    -   Чтобы изменить режим безопасности, используемый при соединении с издателем, укажите значение **publisher_security_mode** для ** \@ Свойства** и значение **1** (встроенная проверка подлинности Windows) или **0** (проверка подлинности SQL Server ** \@ ).**  
  
    -   При изменении режима безопасности издателя на SQL Server проверку подлинности или при изменении данных входа для SQL Server проверки подлинности укажите значение **publisher_password** для ** \@ Свойства** и новый пароль для ** \@ параметра значение**. Повторите шаг 2, указав значение **publisher_login** для ** \@ Свойства** и новое имя входа для ** \@ параметра значение**.  
  
    > [!NOTE]  
    >  После изменения имени входа и пароля агента необходимо остановить и повторно запустить агент, чтобы изменения вступили в силу.  
  
#### <a name="to-change-security-settings-for-the-snapshot-agent-to-generate-a-filtered-snapshot-for-a-subscriber"></a>Изменение параметров безопасности агента моментальных снимков для создания моментального снимка с фильтрацией для подписчика  
  
1.  На издателе выполните [sp_helpdynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-helpdynamicsnapshot-job-transact-sql), указав ** \@ publication**. В результирующем наборе запомните значение параметра **job_name** , соответствующее которому задание будет изменять секцию подписчика.  
  
2.  На издателе выполните [sp_changedynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-changedynamicsnapshot-job-transact-sql), указав ** \@ публикацию**, значение, полученное на шаге 1 для ** \@ dynamic_snapshot_jobname**, и новый пароль для ** \@ Job_password** или имя входа и пароль для учетной записи Windows, под которой агент выполняется для ** \@ job_login** и ** \@ job_password**.  
  
    > [!IMPORTANT]  
    >  Если издатель настраивается с удаленным распространителем, то значения, передаваемые для всех аргументов, включая *job_login* и *job_password*, передаются распространителю в формате обычного (незашифрованного) текста. Прежде чем выполнять эту хранимую процедуру, необходимо зашифровать соединение между издателем и его удаленным распространителем. Дополнительные сведения см. в разделе [Включение шифрования соединений в компоненте Database Engine (диспетчер конфигураций SQL Server)](../../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).  
  
#### <a name="to-change-security-settings-for-the-queue-reader-agent"></a>Изменение параметров безопасности для агента чтения очереди  
  
1.  На распространителе выполните хранимую процедуру [sp_helpqreader_agent](/sql/relational-databases/system-stored-procedures/sp-helpqreader-agent-transact-sql). Она возвращает текущую учетную запись Windows, от которой запускается агент чтения очереди.  
  
    -   На распространителе выполните [sp_changeqreader_agent](/sql/relational-databases/system-stored-procedures/sp-changeqreader-agent-transact-sql), указав параметры учетной записи Windows для ** \@ job_login** и ** \@ job_passwsord**.  
  
    > [!NOTE]  
    >  После изменения имени входа и пароля агента необходимо остановить и повторно запустить агент, чтобы изменения вступили в силу. Для каждой базы распространителя существует только один агент чтения очереди. Изменение настроек безопасности агента оказывает влияние на параметры всех публикаций на всех издателях, использующих эту базу данных распространителя.  
  
2.  Агент чтения очереди подключается к подписчику с тем же контекстом соединения, который используется агентом распространителя для подписки.  
  
#### <a name="to-change-security-mode-used-by-an-immediate-updating-subscriber-when-connecting-to-the-publisher"></a>Смена текущего режима безопасности, используемого при немедленном обновлении подписчика при соединении с издателем  
  
1.  В базе данных подписки на подписчике выполните процедуру [sp_link_publication](/sql/relational-databases/system-stored-procedures/sp-link-publication-transact-sql). Укажите ** \@ издателя**, ** \@ публикацию**, имя базы данных публикации для ** \@ publisher_db**и одно из следующих значений для ** \@ security_mode**.  
  
    -   **0** — использовать проверку подлинности SQL Server при выполнении обновлений на издателе. При выборе этого параметра необходимо указать допустимое имя входа на издателе для ** \@ имени входа** и ** \@ пароля**.  
  
    -   **1** — при соединении с издателем использовать контекст безопасности пользователя, вносящего изменения на подписчике. Связанные с этим режимом безопасности ограничения см. в разделе [sp_link_publication](/sql/relational-databases/system-stored-procedures/sp-link-publication-transact-sql) .  
  
    -   **2** — использовать существующее определенное пользователем имя входа на связанный сервер, созданное с помощью процедуры [sp_addlinkedserver (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addlinkedserver-transact-sql).  
  
#### <a name="to-change-the-password-for-a-remote-distributor"></a>Смена пароля для удаленного распространителя  
  
1.  На распространителе в базе данных распространителя выполните [sp_changedistributor_password](/sql/relational-databases/system-stored-procedures/sp-changedistributor-password-transact-sql), указав новый пароль для этого имени входа в поле ** \@ пароль**.  
  
    > [!IMPORTANT]  
    >  Напрямую менять пароль для имени входа **distributor_admin** не рекомендуется.  
  
2.  На каждом издателе, использующем этот удаленный распространитель, выполните [sp_changedistributor_password](/sql/relational-databases/system-stored-procedures/sp-changedistributor-password-transact-sql), указав пароль из шага 1 для ** \@ пароля**.  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> При помощи объектов RMO  
  
> [!IMPORTANT]  
>  По возможности предлагайте пользователям вводить учетные данные системы безопасности во время выполнения приложения. Если необходимо хранить учетные данные, используйте [службы шифрования](https://go.microsoft.com/fwlink/?LinkId=34733) , предоставляемые платформой [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows .NET Framework.  
  
#### <a name="to-change-all-instances-of-a-password-stored-on-a-replication-server"></a>Изменение всех экземпляров пароля, хранящихся на сервере репликации  
  
1.  Создайте соединение с сервером репликации с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .  
  
2.  Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.ReplicationServer> , используя соединение, созданное на шаге 1.  
  
3.  Вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationServer.ChangeReplicationServerPasswords%2A> . Укажите значения следующих параметров.  
  
    -   *security_mode* — значение типа <xref:Microsoft.SqlServer.Replication.ReplicationSecurityMode> , указывающее тип проверки подлинности, для которой изменяются все экземпляры пароля.  
  
    -   *login* — имя входа, для которого меняются все экземпляры пароля.  
  
    -   *password* — новое значение пароля.  
  
        > [!IMPORTANT]  
        >  По возможности предлагайте пользователям вводить учетные данные системы безопасности во время выполнения приложения. Если необходимо хранить учетные данные, используйте [службы шифрования](https://go.microsoft.com/fwlink/?LinkId=34733) , предоставляемые платформой Windows .NET Framework.  
  
        > [!NOTE]  
        >  Только члены предопределенной роли сервера `sysadmin` могут вызвать этот метод.  
  
4.  Повторите шаги 1 — 3 для каждого сервера в топологии репликации, на котором необходимо обновить пароли.  
  
#### <a name="to-change-security-settings-for-the-distribution-agent-for-a-push-subscription-to-a-transactional-publication"></a>Изменение параметров безопасности агента распространителя для принудительной подписки на публикацию транзакций  
  
1.  Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .  
  
2.  Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.TransSubscription>.  
  
3.  Установите для подписки свойства <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>, <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>, <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>и <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A> , а в качестве значения для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> укажите соединение, созданное на шаге 1.  
  
4.  Чтобы получить свойства объекта, вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> . Если этот метод возвращает значение `false`, то либо на шаге 3 были неверно определены свойства подписки, либо подписка не существует.  
  
5.  В экземпляре <xref:Microsoft.SqlServer.Replication.TransSubscription>задайте одно или несколько из следующих свойств безопасности.  
  
    -   Чтобы изменить учетные данные для учетной записи Windows, с которой запускается агент, установите поля <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> и <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> свойства <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>.  
  
    -   Чтобы при соединении агента с подписчиком использовать встроенную проверку подлинности Windows, установите в поле <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> свойства <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> значение `true`.  
  
    -   Чтобы указать проверку подлинности SQL Server в качестве типа проверки подлинности, используемой агентом при соединении с подписчиком, установите <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> поле <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> свойства в значение `false` и укажите учетные данные входа подписчика для <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> полей и.  
  
        > [!NOTE]  
        >  Агент всегда соединяется с распространителем с учетными данными Windows, указанными в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>. Эта учетная запись также используется для установления удаленных соединений с проверкой подлинности Windows.  
  
6.  Если для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.CachePropertyChanges%2A> указать значение `true`, то для фиксирования изменений на сервере необходимо вызвать метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> (необязательно). Если для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.CachePropertyChanges%2A> указать значение `false` (по умолчанию), изменения будут отправлены на сервер немедленно.  
  
#### <a name="to-change-security-settings-for-the-distribution-agent-for-a-pull-subscription-to-a-transactional-publication"></a>Изменение параметров безопасности агента распространителя для подписки по запросу на публикацию транзакций  
  
1.  Создайте соединение с подписчиком с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .  
  
2.  Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.TransPullSubscription>.  
  
3.  Установите для подписки свойства <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>, <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>, <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>и <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A> , а в качестве значения для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> укажите соединение, созданное на шаге 1.  
  
4.  Чтобы получить свойства объекта, вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> . Если этот метод возвращает значение `false`, то либо на шаге 3 были неверно определены свойства подписки, либо подписка не существует.  
  
5.  В экземпляре <xref:Microsoft.SqlServer.Replication.TransPullSubscription>задайте одно или несколько из следующих свойств безопасности.  
  
    -   Чтобы изменить учетные данные для учетной записи Windows, с которой запускается агент, установите поля <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> и <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> свойства <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>.  
  
    -   Чтобы при соединении агента с распространителем использовать встроенную проверку подлинности Windows, установите в поле <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> свойства <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> значение `true`.  
  
    -   Чтобы указать проверку подлинности SQL Server в качестве типа проверки подлинности, используемой агентом при соединении с распространителем, установите <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> поле <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> свойства в значение `false` и укажите учетные данные входа распространителя для <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> полей и.  
  
        > [!NOTE]  
        >  Агент всегда соединяется с подписчиком с учетными данными Windows, указанными в <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>. Эта учетная запись также используется для установления удаленных соединений с проверкой подлинности Windows.  
  
6.  Если для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.CachePropertyChanges%2A> указать значение `true`, то для фиксирования изменений на сервере необходимо вызвать метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> (необязательно). Если для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.CachePropertyChanges%2A> указать значение `false` (по умолчанию), изменения будут отправлены на сервер немедленно.  
  
#### <a name="to-change-security-settings-for-the-merge-agent-for-a-pull-subscription-to-a-merge-publication"></a>Изменение параметров безопасности агента слияния для подписки по запросу на публикацию слиянием  
  
1.  Создайте соединение с подписчиком с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .  
  
2.  Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergePullSubscription>.  
  
3.  Установите для подписки свойства <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationName%2A>, <xref:Microsoft.SqlServer.Replication.PullSubscription.DatabaseName%2A>, <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherName%2A>и <xref:Microsoft.SqlServer.Replication.PullSubscription.PublicationDBName%2A> , а в качестве значения для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> укажите соединение, созданное на шаге 1.  
  
4.  Чтобы получить свойства объекта, вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> . Если этот метод возвращает значение `false`, то либо на шаге 3 были неверно определены свойства подписки, либо подписка не существует.  
  
5.  В экземпляре <xref:Microsoft.SqlServer.Replication.MergePullSubscription>задайте одно или несколько из следующих свойств безопасности.  
  
    -   Чтобы изменить учетные данные для учетной записи Windows, с которой запускается агент, установите поля <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> и <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> свойства <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>.  
  
    -   Чтобы при соединении агента с распространителем использовать встроенную проверку подлинности Windows, установите в поле <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> свойства <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> значение `true`.  
  
    -   Чтобы указать проверку подлинности SQL Server в качестве типа проверки подлинности, используемой агентом при соединении с распространителем, установите <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> поле <xref:Microsoft.SqlServer.Replication.PullSubscription.DistributorSecurity%2A> свойства в значение `false` и укажите учетные данные входа распространителя для <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> полей и.  
  
    -   Чтобы при соединении агента с издателем использовать встроенную проверку подлинности Windows, установите в поле <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> свойства <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> значение `true`.  
  
    -   Чтобы указать проверку подлинности SQL Server в качестве типа проверки подлинности, используемой агентом при соединении с издателем, установите <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> поле <xref:Microsoft.SqlServer.Replication.PullSubscription.PublisherSecurity%2A> свойства в значение `false` и укажите учетные данные входа издателя для <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> полей и.  
  
        > [!NOTE]  
        >  Агент всегда соединяется с подписчиком с учетными данными Windows, указанными в <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>. Эта учетная запись также используется для установления удаленных соединений с проверкой подлинности Windows.  
  
6.  Если для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.CachePropertyChanges%2A> указать значение `true`, то для фиксирования изменений на сервере необходимо вызвать метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> (необязательно). Если для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.CachePropertyChanges%2A> указать значение `false` (по умолчанию), изменения будут отправлены на сервер немедленно.  
  
#### <a name="to-change-security-settings-for-the-merge-agent-for-a-push-subscription-to-a-merge-publication"></a>Изменение параметров безопасности агента слияния для принудительной подписки на публикацию слиянием  
  
1.  Создайте соединение с издателем с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .  
  
2.  Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.MergeSubscription>.  
  
3.  Установите для подписки свойства <xref:Microsoft.SqlServer.Replication.Subscription.PublicationName%2A>, <xref:Microsoft.SqlServer.Replication.Subscription.DatabaseName%2A>, <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberName%2A>и <xref:Microsoft.SqlServer.Replication.Subscription.SubscriptionDBName%2A> , а в качестве значения для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> укажите соединение, созданное на шаге 1.  
  
4.  Чтобы получить свойства объекта, вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> . Если этот метод возвращает значение `false`, то либо на шаге 3 были неверно определены свойства подписки, либо подписка не существует.  
  
5.  В экземпляре <xref:Microsoft.SqlServer.Replication.MergeSubscription>задайте одно или несколько из следующих свойств безопасности.  
  
    -   Чтобы изменить учетные данные для учетной записи Windows, с которой запускается агент, установите поля <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> и <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> свойства <xref:Microsoft.SqlServer.Replication.PullSubscription.SynchronizationAgentProcessSecurity%2A>.  
  
    -   Чтобы при соединении агента с подписчиком использовать встроенную проверку подлинности Windows, установите в поле <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> свойства <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> значение `true`.  
  
    -   Чтобы указать проверку подлинности SQL Server в качестве типа проверки подлинности, используемой агентом при соединении с подписчиком, установите <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> поле <xref:Microsoft.SqlServer.Replication.Subscription.SubscriberSecurity%2A> свойства в значение `false` и укажите учетные данные входа подписчика для <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardLogin%2A> <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.SqlStandardPassword%2A> полей и.  
  
    -   Чтобы при соединении агента с издателем использовать встроенную проверку подлинности Windows, установите в поле <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> свойства <xref:Microsoft.SqlServer.Replication.MergeSubscription.PublisherSecurity%2A> значение `true`.  
  
    -   Чтобы указать проверку подлинности SQL Server в качестве типа проверки подлинности, используемой агентом при соединении с издателем, установите <xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> поле <xref:Microsoft.SqlServer.Replication.MergeSubscription.PublisherSecurity%2A> свойства в значение `false` и укажите учетные данные входа издателя для <xref:Microsoft.SqlServer.Replication.PublisherConnectionSecurityContext.SqlStandardLogin%2A> <xref:Microsoft.SqlServer.Replication.PublisherConnectionSecurityContext.SqlStandardPassword%2A> полей и.  
  
        > [!NOTE]  
        >  Агент всегда соединяется с распространителем с учетными данными Windows, указанными в свойстве <xref:Microsoft.SqlServer.Replication.Subscription.SynchronizationAgentProcessSecurity%2A>. Эта учетная запись также используется для установления удаленных соединений с проверкой подлинности Windows.  
  
6.  Если для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.CachePropertyChanges%2A> указать значение `true`, то для фиксирования изменений на сервере необходимо вызвать метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A> (необязательно). Если для свойства <xref:Microsoft.SqlServer.Replication.ReplicationObject.CachePropertyChanges%2A> указать значение `false` (по умолчанию), изменения будут отправлены на сервер немедленно.  
  
#### <a name="to-change-the-login-information-used-by-an-immediate-updating-subscriber-when-it-connects-to-the-transactional-publisher"></a>Изменение сведений об имени входа, используемых немедленно обновляемым подписчиком при подключении к издателю транзакций  
  
1.  Создайте соединение с подписчиком с помощью класса <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .  
  
2.  Создайте экземпляр класса <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> для базы данных подписки. Укажите значения <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.Name%2A> и <xref:Microsoft.SqlServer.Management.Common.ServerConnection> из шага 1 в параметре <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.  
  
3.  Чтобы получить свойства объекта, вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> . Если этот метод возвращает значение `false`, значит, в шаге 2 были неправильно определены свойства базы данных либо база данных подписки не существует.  
  
4.  Вызовите метод <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.LinkPublicationForUpdateableSubscription%2A> , передав следующие параметры.  
  
    -   *Publisher* — имя издателя.  
  
    -   *PublisherDB* — имя базы данных публикации.  
  
    -   *Publication* — имя публикации, на которую подписан немедленно обновляемый подписчик.  
  
    -   *Distributor* — имя  распространителя.  
  
    -   *PublisherSecurity* - A <xref:Microsoft.SqlServer.Replication.PublisherConnectionSecurityContext> , указывающий тип режима безопасности, используемого немедленно обновляемым подписчиком при соединении с издателем, и учетные данные входа для этого соединения.  
  
###  <a name="example-rmo"></a><a name="PShellExample"></a> Пример (объекты RMO)  
 В этом примере проверяется указанное значение имени входа и изменяются все пароли для указанного имени входа в Windows или имени входа в SQL Server, хранимые репликацией на сервере.  
  
 [!code-csharp[HowTo#rmo_ChangeServerPasswords](../../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_changeserverpasswords)]  
  
 [!code-vb[HowTo#rmo_vb_ChangeServerPasswords](../../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_changeserverpasswords)]  
  
##  <a name="follow-up-after-you-modify-replication-security-settings"></a><a name="FollowUp"></a> Дальнейшие действия. После изменения параметров безопасности репликации  
 После изменения имени входа и пароля агента необходимо остановить и повторно запустить агент, чтобы изменения вступили в силу.  
  
## <a name="see-also"></a>См. также:  
 [Replication Management Objects Concepts](../concepts/replication-management-objects-concepts.md)   
 [Обновление скриптов репликации (программирование репликации на языке Transact-SQL)](../administration/upgrade-replication-scripts-replication-transact-sql-programming.md)   
 [Управление именами для входа и паролями при репликации](identity-and-access-control-replication.md#manage-logins-and-passwords-in-replication)   
 [Replication Agent Security Model](replication-agent-security-model.md)  (Модель безопасности агента репликации)  
 [Replication Security Best Practices](replication-security-best-practices.md)   
 [Безопасность Репликация SQL Server](view-and-modify-replication-security-settings.md)   
 [Replication System Stored Procedures Concepts](../concepts/replication-system-stored-procedures-concepts.md)  
  
  
