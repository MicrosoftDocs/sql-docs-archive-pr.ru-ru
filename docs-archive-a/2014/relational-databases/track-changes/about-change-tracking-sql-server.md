---
title: Об отслеживании изменений (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- data changes [SQL Server]
- tracking data changes [SQL Server]
- change tracking [SQL Server], about change tracking
- change tracking [SQL Server]
- data [SQL Server], changing
ms.assetid: 5e0ef05a-8317-4c98-be20-b19d4cd78f12
author: rothja
ms.author: jroth
ms.openlocfilehash: 4e8a817421aeca7906d31e4a70c25a12b6af7c0d
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87665912"
---
# <a name="about-change-tracking-sql-server"></a><span data-ttu-id="e1603-102">Об отслеживании изменений (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e1603-102">About Change Tracking (SQL Server)</span></span>
  <span data-ttu-id="e1603-103">Отслеживание изменений — это простое решение, обеспечивающее эффективный механизм отслеживания изменений для приложений.</span><span class="sxs-lookup"><span data-stu-id="e1603-103">Change tracking is a lightweight solution that provides an efficient change tracking mechanism for applications.</span></span> <span data-ttu-id="e1603-104">Обычно, чтобы позволить приложениям направлять запросы об изменениях данных в базе данных и получить доступ к сведениям об изменениях, разработчикам приложений приходится реализовывать специальные механизмы отслеживания изменений.</span><span class="sxs-lookup"><span data-stu-id="e1603-104">Typically, to enable applications to query for changes to data in a database and access information that is related to the changes, application developers had to implement custom change tracking mechanisms.</span></span> <span data-ttu-id="e1603-105">Создание этих механизмов обычно включало много усилий и часто участвует в использовании сочетания триггеров, `timestamp` столбцов, новых таблиц для хранения данных отслеживания и пользовательских процессов очистки.</span><span class="sxs-lookup"><span data-stu-id="e1603-105">Creating these mechanisms usually involved a lot of work and frequently involved using a combination of triggers, `timestamp` columns, new tables to store tracking information, and custom cleanup processes.</span></span>  
  
 <span data-ttu-id="e1603-106">У различных типов приложений разные требования к уровню детализации необходимых им сведений об изменениях.</span><span class="sxs-lookup"><span data-stu-id="e1603-106">Different types of applications have different requirements for how much information they need about the changes.</span></span> <span data-ttu-id="e1603-107">Отслеживая изменения, приложения могут отвечать на следующие вопросы об изменениях, сделанных в пользовательской таблице.</span><span class="sxs-lookup"><span data-stu-id="e1603-107">Applications can use change tracking to answer the following questions about the changes that have been made to a user table:</span></span>  
  
-   <span data-ttu-id="e1603-108">Какие строки изменены в пользовательской таблице?</span><span class="sxs-lookup"><span data-stu-id="e1603-108">What rows have changed for a user table?</span></span>  
  
    -   <span data-ttu-id="e1603-109">Требуется только факт изменения строки, но не число изменений строки или значения промежуточных изменений.</span><span class="sxs-lookup"><span data-stu-id="e1603-109">Only the fact that a row has changed is required, not how many times the row has changed or the values of any intermediate changes.</span></span>  
  
    -   <span data-ttu-id="e1603-110">Можно получить последние данные непосредственно из отслеживаемой таблицы.</span><span class="sxs-lookup"><span data-stu-id="e1603-110">The latest data can be obtained directly from the table that is being tracked.</span></span>  
  
-   <span data-ttu-id="e1603-111">Изменилась ли строка?</span><span class="sxs-lookup"><span data-stu-id="e1603-111">Has a row changed?</span></span>  
  
    -   <span data-ttu-id="e1603-112">Факт изменения строки и сведения об изменении должны быть доступны и записаны при внесении изменения в той же транзакции.</span><span class="sxs-lookup"><span data-stu-id="e1603-112">The fact that a row has changed and information about the change must be available and recorded at the time that the change was made in the same transaction.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e1603-113">Если приложению необходимы данные обо всех произведенных изменениях и все промежуточные значения, следует воспользоваться методом записи данных изменений вместо отслеживания изменений.</span><span class="sxs-lookup"><span data-stu-id="e1603-113">If an application requires information about all the changes that were made and the intermediate values of the changed data, using change data capture, instead of change tracking, might be appropriate.</span></span> <span data-ttu-id="e1603-114">Дополнительные сведения см. в статье [О системе отслеживания измененных данных (SQL Server)](../track-changes/about-change-data-capture-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="e1603-114">For more information, see [About Change Data Capture &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md).</span></span>  
  
## <a name="one-way-and-two-way-synchronization-applications"></a><span data-ttu-id="e1603-115">Приложения односторонней и двусторонней синхронизации</span><span class="sxs-lookup"><span data-stu-id="e1603-115">One-Way and Two-Way Synchronization Applications</span></span>  
 <span data-ttu-id="e1603-116">Приложения, которым требуется синхронизировать данные с экземпляром компонента [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] , должны иметь возможность направлять запрос об изменениях.</span><span class="sxs-lookup"><span data-stu-id="e1603-116">Applications that have to synchronize data with an instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] must be able to query for changes.</span></span> <span data-ttu-id="e1603-117">Отслеживание изменений может послужить основой для односторонней и двусторонней синхронизации приложений.</span><span class="sxs-lookup"><span data-stu-id="e1603-117">Change tracking can be used as a foundation for both one-way and two-way synchronization applications.</span></span>  
  
### <a name="one-way-synchronization-applications"></a><span data-ttu-id="e1603-118">Приложения односторонней синхронизации</span><span class="sxs-lookup"><span data-stu-id="e1603-118">One-Way Synchronization Applications</span></span>  
 <span data-ttu-id="e1603-119">Приложения односторонней синхронизации, такие как клиентское или приложение кэширования промежуточного уровня, можно построить с использованием отслеживания изменений.</span><span class="sxs-lookup"><span data-stu-id="e1603-119">One-way synchronization applications, such as a client or mid-tier caching application, can be built that use change tracking.</span></span> <span data-ttu-id="e1603-120">Как показано на следующей иллюстрации, приложение кэширования требует, чтобы данные хранились в компоненте [!INCLUDE[ssDE](../../includes/ssde-md.md)] и кэшировались в других хранилищах.</span><span class="sxs-lookup"><span data-stu-id="e1603-120">As shown in the following illustration, a caching application requires data to be stored in the [!INCLUDE[ssDE](../../includes/ssde-md.md)] and to be cached in other data stores.</span></span> <span data-ttu-id="e1603-121">Приложение должно иметь возможность своевременно помещать в кэш любые изменения, внесенные в таблицы базы данных.</span><span class="sxs-lookup"><span data-stu-id="e1603-121">The application must be able to keep the cache up-to-date with any changes that have been made to the database tables.</span></span> <span data-ttu-id="e1603-122">Изменения в компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)]не передаются.</span><span class="sxs-lookup"><span data-stu-id="e1603-122">There are no changes to pass back to the [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span></span>  
  
 <span data-ttu-id="e1603-123">![Показывает применение односторонней синхронизации](../../database-engine/media/one-waysync.gif "Показывает применение односторонней синхронизации")</span><span class="sxs-lookup"><span data-stu-id="e1603-123">![Shows one-way synchronization applications](../../database-engine/media/one-waysync.gif "Shows one-way synchronization applications")</span></span>  
  
### <a name="two-way-synchronization-applications"></a><span data-ttu-id="e1603-124">Приложения двусторонней синхронизации</span><span class="sxs-lookup"><span data-stu-id="e1603-124">Two-Way Synchronization Applications</span></span>  
 <span data-ttu-id="e1603-125">С помощью отслеживания изменений можно также построить и приложения двусторонней синхронизации.</span><span class="sxs-lookup"><span data-stu-id="e1603-125">Two-way synchronization applications can also be built that use change tracking.</span></span> <span data-ttu-id="e1603-126">В этом случае данные в экземпляре компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] синхронизируется с одним или несколькими хранилищами данных.</span><span class="sxs-lookup"><span data-stu-id="e1603-126">In this scenario, the data in an instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] is synchronized with one or more data stores.</span></span> <span data-ttu-id="e1603-127">Данные в этих хранилищах могут быть обновлены, а изменения должны быть синхронизированы с компонентом [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e1603-127">The data in those stores can be updated and the changes must be synchronized back to the [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span></span>  
  
 <span data-ttu-id="e1603-128">![Показывает применение двусторонней синхронизации](../../database-engine/media/two-waysync.gif "Показывает применение двусторонней синхронизации")</span><span class="sxs-lookup"><span data-stu-id="e1603-128">![Shows two-way synchronization applications](../../database-engine/media/two-waysync.gif "Shows two-way synchronization applications")</span></span>  
  
 <span data-ttu-id="e1603-129">Хороший пример приложения двусторонней синхронизации — периодически подключаемое приложение.</span><span class="sxs-lookup"><span data-stu-id="e1603-129">A good example of two-way synchronization application is an occasionally connected application.</span></span> <span data-ttu-id="e1603-130">В приложении такого типа клиентское приложение направляет запрос и обновляет локальное хранилище.</span><span class="sxs-lookup"><span data-stu-id="e1603-130">In this type of application, a client application queries and updates a local store.</span></span> <span data-ttu-id="e1603-131">Если существует соединение между клиентом и сервером, приложение выполняет синхронизацию с сервером, а измененные данные передаются в обоих направлениях.</span><span class="sxs-lookup"><span data-stu-id="e1603-131">When a connection is available between a client and server, the application will synchronize with a server, and changed data flows in both directions.</span></span>  
  
 <span data-ttu-id="e1603-132">Приложения двусторонней синхронизации должны уметь распознавать конфликты.</span><span class="sxs-lookup"><span data-stu-id="e1603-132">The two-way synchronization applications must be able to detect conflicts.</span></span> <span data-ttu-id="e1603-133">Конфликт возникнет, если одни и те же данные были изменены в обоих хранилищах в период времени между сеансами синхронизации.</span><span class="sxs-lookup"><span data-stu-id="e1603-133">A conflict would occur if the same data was changed in both data stores in the time between synchronizations.</span></span> <span data-ttu-id="e1603-134">Благодаря возможности обнаруживать конфликты приложение может избежать потери изменений.</span><span class="sxs-lookup"><span data-stu-id="e1603-134">With the ability to detect conflicts, an application can make sure that changes are not lost.</span></span>  
  
## <a name="how-change-tracking-works"></a><span data-ttu-id="e1603-135">Принципы работы отслеживания изменений</span><span class="sxs-lookup"><span data-stu-id="e1603-135">How Change Tracking Works</span></span>  
 <span data-ttu-id="e1603-136">Чтобы настроить отслеживание изменений, можно использовать инструкции DDL или среду [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e1603-136">To configure change tracking, you can use DDL statements or [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="e1603-137">Дополнительные сведения см. в статье [Включение и отключение отслеживания изменений (SQL Server)](../track-changes/enable-and-disable-change-tracking-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="e1603-137">For more information, see [Enable and Disable Change Tracking &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-tracking-sql-server.md).</span></span> <span data-ttu-id="e1603-138">Чтобы разрешить отслеживание изменений, необходимо включить эту функцию сначала на уровне базы данных, а затем для всех таблиц базы данных, изменения в которых необходимо отслеживать.</span><span class="sxs-lookup"><span data-stu-id="e1603-138">To track changes, change tracking must first be enabled for the database and then enabled for the tables that you want to track within that database.</span></span> <span data-ttu-id="e1603-139">Вносить какие-либо изменения в определение таблицы необязательно, триггеры не создаются.</span><span class="sxs-lookup"><span data-stu-id="e1603-139">The table definition does not have to be changed in any way, and no triggers are created.</span></span>  
  
 <span data-ttu-id="e1603-140">После настройки отслеживания изменений для таблицы любая DML-инструкция, затрагивающая строку в таблице, вызовет запись данных отслеживания изменений об измененной строке.</span><span class="sxs-lookup"><span data-stu-id="e1603-140">After change tracking is configured for a table, any DML statement that affects rows in the table will cause change tracking information for each modified row to be recorded.</span></span> <span data-ttu-id="e1603-141">При помощи [функций отслеживания изменений](/sql/relational-databases/system-functions/change-tracking-functions-transact-sql)можно запросить, какие строки были изменены, и получить сведения об этих изменениях.</span><span class="sxs-lookup"><span data-stu-id="e1603-141">To query for the rows that have changed and to obtain information about the changes, you can use [change tracking functions](/sql/relational-databases/system-functions/change-tracking-functions-transact-sql).</span></span>  
  
 <span data-ttu-id="e1603-142">Из отслеживаемой таблицы вместе со сведениями об изменениях записываются лишь данные о значениях в первичном ключевом столбце.</span><span class="sxs-lookup"><span data-stu-id="e1603-142">The values of the primary key column is only information from the tracked table that is recorded with the change information.</span></span> <span data-ttu-id="e1603-143">Эти значения идентифицируют измененные строки.</span><span class="sxs-lookup"><span data-stu-id="e1603-143">These values identify the rows that have been changed.</span></span> <span data-ttu-id="e1603-144">Приложение может произвести соединение исходной таблицы с отслеживаемой таблицей по значениям первичного ключевого столбца, чтобы извлечь для этих строк новые значения данных.</span><span class="sxs-lookup"><span data-stu-id="e1603-144">To obtain the latest data for those rows, an application can use the primary key column values to join the source table with the tracked table.</span></span>  
  
 <span data-ttu-id="e1603-145">Сведения об изменении, внесенном в каждую строку, могут быть получены с помощью отслеживания изменений.</span><span class="sxs-lookup"><span data-stu-id="e1603-145">Information about the change that was made to each row can also be obtained by using change tracking.</span></span> <span data-ttu-id="e1603-146">Например, тип операции DML, который вызвал изменение (вставку, обновление или удаление), или столбцы, измененные в ходе операции обновления.</span><span class="sxs-lookup"><span data-stu-id="e1603-146">For example, the type of DML operation that caused the change (insert, update, or delete) or the columns that were changed as part of an update operation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e1603-147">См. также:</span><span class="sxs-lookup"><span data-stu-id="e1603-147">See Also</span></span>  
 <span data-ttu-id="e1603-148">[Включение и отключение Отслеживание изменений &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-tracking-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e1603-148">[Enable and Disable Change Tracking &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-tracking-sql-server.md) </span></span>  
 <span data-ttu-id="e1603-149">[Работа с Отслеживание изменений &#40;SQL Server&#41;](../track-changes/work-with-change-tracking-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e1603-149">[Work with Change Tracking &#40;SQL Server&#41;](../track-changes/work-with-change-tracking-sql-server.md) </span></span>  
 <span data-ttu-id="e1603-150">[Управление Отслеживание изменений &#40;SQL Server&#41;](../track-changes/manage-change-tracking-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e1603-150">[Manage Change Tracking &#40;SQL Server&#41;](../track-changes/manage-change-tracking-sql-server.md) </span></span>  
 [<span data-ttu-id="e1603-151">Отслеживание измененных данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e1603-151">Track Data Changes &#40;SQL Server&#41;</span></span>](../track-changes/track-data-changes-sql-server.md)  
  
  
