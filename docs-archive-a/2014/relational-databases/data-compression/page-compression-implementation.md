---
title: Реализация сжатия страниц | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- page compression [Database Engine]
- compression [SQL Server], page
ms.assetid: 78c83277-1dbb-4e07-95bd-47b14d2b5cd4
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: e6edba79d1548d68e60f406d370abd5354a62fcb
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87667215"
---
# <a name="page-compression-implementation"></a><span data-ttu-id="35f3d-102">Реализация сжатия страниц</span><span class="sxs-lookup"><span data-stu-id="35f3d-102">Page Compression Implementation</span></span>
  <span data-ttu-id="35f3d-103">Этот раздел содержит описание того, как компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] реализует сжатие страниц.</span><span class="sxs-lookup"><span data-stu-id="35f3d-103">This topic summarizes how the [!INCLUDE[ssDE](../../includes/ssde-md.md)] implements page compression.</span></span> <span data-ttu-id="35f3d-104">В этой сводке представлены основные сведения, которые помогут при планировании объема хранения.</span><span class="sxs-lookup"><span data-stu-id="35f3d-104">This summary provides basic information to help you plan the storage space that you need for your data.</span></span>  
  
 <span data-ttu-id="35f3d-105">Сжатие страницы похоже на сжатие таблиц, табличных секций, индексов и индексных секций.</span><span class="sxs-lookup"><span data-stu-id="35f3d-105">Page compression is similar for tables, table partitions, indexes, and index partitions.</span></span> <span data-ttu-id="35f3d-106">Последующее описание сжатия страницы для таблицы одинаково применимо для сжатия страницы для объектов всех типов.</span><span class="sxs-lookup"><span data-stu-id="35f3d-106">The following description of page compression for a table applies equally to page compression for all object types.</span></span> <span data-ttu-id="35f3d-107">В следующих примерах сжимаются символьные строки, но при сжатии префикса и словаря применяются те же принципы, что и для других типов данных.</span><span class="sxs-lookup"><span data-stu-id="35f3d-107">The following examples compress character strings, but both prefix and dictionary compression apply the same principles to other data types.</span></span>  
  
 <span data-ttu-id="35f3d-108">Сжатие конечного уровня таблиц и индексов вместе со сжатием страницы состоит из трех операций в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="35f3d-108">Compressing the leaf level of tables and indexes with page compression consists of three operations in the following order:</span></span>  
  
1.  <span data-ttu-id="35f3d-109">сжатие строк;</span><span class="sxs-lookup"><span data-stu-id="35f3d-109">Row compression</span></span>  
  
2.  <span data-ttu-id="35f3d-110">сжатие префикса;</span><span class="sxs-lookup"><span data-stu-id="35f3d-110">Prefix compression</span></span>  
  
3.  <span data-ttu-id="35f3d-111">сжатие словаря.</span><span class="sxs-lookup"><span data-stu-id="35f3d-111">Dictionary compression</span></span>  
  
 <span data-ttu-id="35f3d-112">При сжатии страницы неконечные страницы индексов сжимаются с использованием только сжатия строк.</span><span class="sxs-lookup"><span data-stu-id="35f3d-112">When you use page compression, non-leaf-level pages of indexes are compressed by using only row compression.</span></span> <span data-ttu-id="35f3d-113">Дополнительные сведения о сжатии строк см. в разделе [Row Compression Implementation](../data-compression/row-compression-implementation.md).</span><span class="sxs-lookup"><span data-stu-id="35f3d-113">For more information about row compression, see [Row Compression Implementation](../data-compression/row-compression-implementation.md).</span></span>  
  
## <a name="prefix-compression"></a><span data-ttu-id="35f3d-114">сжатие префикса;</span><span class="sxs-lookup"><span data-stu-id="35f3d-114">Prefix Compression</span></span>  
 <span data-ttu-id="35f3d-115">Для каждой сжимаемой страницы сжатие префикса состоит из следующих шагов.</span><span class="sxs-lookup"><span data-stu-id="35f3d-115">For each page that is being compressed, prefix compression uses the following steps:</span></span>  
  
1.  <span data-ttu-id="35f3d-116">Для каждого столбца определяется значение, которое может использоваться для уменьшения места хранения значений в каждом столбце.</span><span class="sxs-lookup"><span data-stu-id="35f3d-116">For each column, a value is identified that can be used to reduce the storage space for the values in each column.</span></span>  
  
2.  <span data-ttu-id="35f3d-117">Строка, представляющая префиксные значения для каждого столбца, создается и хранится в структуре сжатой информации (CI), следующей за заголовком страницы.</span><span class="sxs-lookup"><span data-stu-id="35f3d-117">A row that represents the prefix values for each column is created and stored in the compression information (CI) structure that immediately follows the page header.</span></span>  
  
3.  <span data-ttu-id="35f3d-118">Повторяющиеся префиксные значения в данном столбце заменяются ссылкой на соответствующий префикс.</span><span class="sxs-lookup"><span data-stu-id="35f3d-118">The repeated prefix values in the column are replaced by a reference to the corresponding prefix.</span></span> <span data-ttu-id="35f3d-119">Если значение строки совпадает с выбранным префиксным значением не полностью, то частичные совпадения все еще могут быть отражены.</span><span class="sxs-lookup"><span data-stu-id="35f3d-119">If the value in a row does not exactly match the selected prefix value, a partial match can still be indicated.</span></span>  
  
 <span data-ttu-id="35f3d-120">Следующая иллюстрация показывает образец страницы таблицы перед сжатием префикса.</span><span class="sxs-lookup"><span data-stu-id="35f3d-120">The following illustration shows a sample page of a table before prefix compression.</span></span>  
  
 <span data-ttu-id="35f3d-121">![Страница до префиксного сжатия](../media/skt-tblcompression1c.gif "Страница до префиксного сжатия")</span><span class="sxs-lookup"><span data-stu-id="35f3d-121">![Page before prefix compression](../media/skt-tblcompression1c.gif "Page before prefix compression")</span></span>  
  
 <span data-ttu-id="35f3d-122">Следующая иллюстрация содержит эту же страницу после сжатия префикса.</span><span class="sxs-lookup"><span data-stu-id="35f3d-122">The following illustration shows the same page after prefix compression.</span></span> <span data-ttu-id="35f3d-123">Префикс перемещается к заголовку, а значения столбца изменяются ссылками на данный префикс.</span><span class="sxs-lookup"><span data-stu-id="35f3d-123">The prefix is moved to the header, and the column values are changed to references to the prefix.</span></span>  
  
 <span data-ttu-id="35f3d-124">![Страница после префиксного сжатия](../media/tblcompression2.gif "Страница после префиксного сжатия")</span><span class="sxs-lookup"><span data-stu-id="35f3d-124">![Page after prefix compression](../media/tblcompression2.gif "Page after prefix compression")</span></span>  
  
 <span data-ttu-id="35f3d-125">В первом столбце первой строки значение 4b указывает, что первые четыре символа префикса (aaab) присутствуют для этой строки вместе с символом b.</span><span class="sxs-lookup"><span data-stu-id="35f3d-125">In the first column of the first row, the value 4b indicates that the first four characters of the prefix (aaab) are present for that row, and also the character b.</span></span> <span data-ttu-id="35f3d-126">Это делает результирующим значение aaabb, которое представляет собой исходное значение.</span><span class="sxs-lookup"><span data-stu-id="35f3d-126">This makes the resultant value aaabb, which is the original value.</span></span>  
  
## <a name="dictionary-compression"></a><span data-ttu-id="35f3d-127">сжатие словаря.</span><span class="sxs-lookup"><span data-stu-id="35f3d-127">Dictionary Compression</span></span>  
 <span data-ttu-id="35f3d-128">После завершения сжатия префикса применяется сжатие словаря.</span><span class="sxs-lookup"><span data-stu-id="35f3d-128">After prefix compression has been completed, dictionary compression is applied.</span></span> <span data-ttu-id="35f3d-129">При сжатии словаря выполняется поиск на странице повторяющихся значений и сохранение их в области CI.</span><span class="sxs-lookup"><span data-stu-id="35f3d-129">Dictionary compression searches for repeated values anywhere on the page, and stores them in the CI area.</span></span> <span data-ttu-id="35f3d-130">В отличие от сжатия префикса, сжатие словаря не ограничено одним столбцом.</span><span class="sxs-lookup"><span data-stu-id="35f3d-130">Unlike prefix compression, dictionary compression is not restricted to one column.</span></span> <span data-ttu-id="35f3d-131">При сжатии словаря можно заменить повторяющиеся значения, встречающиеся в любом месте страницы.</span><span class="sxs-lookup"><span data-stu-id="35f3d-131">Dictionary compression can replace repeated values that occur anywhere on a page.</span></span> <span data-ttu-id="35f3d-132">Следующая иллюстрация содержит эту же страницу после сжатия словаря.</span><span class="sxs-lookup"><span data-stu-id="35f3d-132">The following illustration shows the same page after dictionary compression.</span></span>  
  
 <span data-ttu-id="35f3d-133">![Страница после словарного сжатия](../media/tblcompression3.gif "Страница после словарного сжатия")</span><span class="sxs-lookup"><span data-stu-id="35f3d-133">![Page after dictionary compression](../media/tblcompression3.gif "Page after dictionary compression")</span></span>  
  
 <span data-ttu-id="35f3d-134">Обратите внимание, что ссылки на значение 4b существуют в различных столбцах страницы.</span><span class="sxs-lookup"><span data-stu-id="35f3d-134">Note that the value 4b has been referenced from different columns of the page.</span></span>  
  
## <a name="when-page-compression-occurs"></a><span data-ttu-id="35f3d-135">Когда происходит сжатие страницы</span><span class="sxs-lookup"><span data-stu-id="35f3d-135">When Page Compression Occurs</span></span>  
 <span data-ttu-id="35f3d-136">При создании новой таблицы, имеющей сжатие страницы, сжатия не происходит.</span><span class="sxs-lookup"><span data-stu-id="35f3d-136">When a new table is created that has page compression, no compression occurs.</span></span> <span data-ttu-id="35f3d-137">Однако табличные метаданные указывают на то, что сжатие страницы должно быть использовано.</span><span class="sxs-lookup"><span data-stu-id="35f3d-137">However, the metadata for the table indicates that page compression should be used.</span></span> <span data-ttu-id="35f3d-138">Так как данные добавляются на первую страницу данных, они имеют сжатие строк.</span><span class="sxs-lookup"><span data-stu-id="35f3d-138">As data is added to the first data page, data is row-compressed.</span></span> <span data-ttu-id="35f3d-139">Поскольку страница не является полной, преимуществ сжатие страницы не дает.</span><span class="sxs-lookup"><span data-stu-id="35f3d-139">Because the page is not full, no benefit is gained from page compression.</span></span> <span data-ttu-id="35f3d-140">После того как страница заполнена, добавление следующей строки вызывает операцию ее сжатия.</span><span class="sxs-lookup"><span data-stu-id="35f3d-140">When the page is full, the next row to be added initiates the page compression operation.</span></span> <span data-ttu-id="35f3d-141">Вся страница просматривается; каждый столбец оценивается для сжатия префикса, а затем оцениваются все столбцы для сжатия словаря.</span><span class="sxs-lookup"><span data-stu-id="35f3d-141">The whole page is reviewed; each column is evaluated for prefix compression, and then all columns are evaluated for dictionary compression.</span></span> <span data-ttu-id="35f3d-142">Если при сжатии на странице освободилось достаточно места для дополнительной строки, то добавляется строка и в обоих случаях данные являются сжатыми по строкам и по страницам.</span><span class="sxs-lookup"><span data-stu-id="35f3d-142">If page compression has created enough room on the page for an additional row, the row is added, and the data is both row- and page-compressed.</span></span> <span data-ttu-id="35f3d-143">Если пространство на странице сжатия минус пространство, указанное для структуры CI, увеличилось незначительно, сжатие страницы не используется для данной страницы.</span><span class="sxs-lookup"><span data-stu-id="35f3d-143">If the space gained by page compression minus the space that is required for the CI structure is not significant, page compression is not used for that page.</span></span> <span data-ttu-id="35f3d-144">Любые будущие строки помещаются на другой странице, или, если они там не помещаются, в таблицу включается новая страница.</span><span class="sxs-lookup"><span data-stu-id="35f3d-144">Future rows either fit onto the new page or, if they do not fit, a new page is added to the table.</span></span> <span data-ttu-id="35f3d-145">Аналогично первой странице новая страница не является сразу сжатой постранично.</span><span class="sxs-lookup"><span data-stu-id="35f3d-145">Similar to the first page, the new page is not at first page-compressed.</span></span>  
  
 <span data-ttu-id="35f3d-146">Если существующая таблица, содержащая данные, преобразуется для сжатия страниц, каждая страница перестраивается и оценивается.</span><span class="sxs-lookup"><span data-stu-id="35f3d-146">When an existing table that contains data is converted to page compression, each page is rebuilt and evaluated.</span></span> <span data-ttu-id="35f3d-147">Перестроение всех страниц приводит к перестроению таблицы, индекса или секции.</span><span class="sxs-lookup"><span data-stu-id="35f3d-147">Rebuilding all the pages causes the rebuilding of the table, index, or partition.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="35f3d-148">См. также:</span><span class="sxs-lookup"><span data-stu-id="35f3d-148">See Also</span></span>  
 <span data-ttu-id="35f3d-149">[Сжатие данных](data-compression.md) </span><span class="sxs-lookup"><span data-stu-id="35f3d-149">[Data Compression](data-compression.md) </span></span>  
 [<span data-ttu-id="35f3d-150">Row Compression Implementation</span><span class="sxs-lookup"><span data-stu-id="35f3d-150">Row Compression Implementation</span></span>](row-compression-implementation.md)  
  
  
