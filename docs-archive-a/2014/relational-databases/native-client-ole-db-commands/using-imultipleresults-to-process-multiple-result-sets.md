---
title: Обработка нескольких результирующих наборов с помощью интерфейса IMultipleResults | Документы Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- multiple rowsets
- rowsets [OLE DB], multiple
- IMultipleResults interface
- multiple-rowset results
ms.assetid: 754d3f30-7d94-4b67-8dac-baf2699ce9c6
author: rothja
ms.author: jroth
ms.openlocfilehash: c7acac7e6ce75189e522b503707e101c0a13c345
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87749783"
---
# <a name="using-imultipleresults-to-process-multiple-result-sets"></a><span data-ttu-id="41e09-102">Обработка нескольких результирующих наборов при помощи интерфейса IMultipleResults</span><span class="sxs-lookup"><span data-stu-id="41e09-102">Using IMultipleResults to Process Multiple Result Sets</span></span>
  <span data-ttu-id="41e09-103">Потребители используют интерфейс **IMultipleResults** для обработки результатов, возвращаемых [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] выполнением команды поставщика OLE DB собственного клиента.</span><span class="sxs-lookup"><span data-stu-id="41e09-103">Consumers use the **IMultipleResults** interface to process results returned by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider command execution.</span></span> <span data-ttu-id="41e09-104">Когда [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поставщик OLE DB собственного клиента отправляет команду для выполнения, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] выполняет инструкции и возвращает все результаты.</span><span class="sxs-lookup"><span data-stu-id="41e09-104">When the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider submits a command for execution, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] executes the statements and returns any results.</span></span>  
  
 <span data-ttu-id="41e09-105">Клиент должен обработать все результаты выполнения команды.</span><span class="sxs-lookup"><span data-stu-id="41e09-105">A client must process all results from command execution.</span></span> <span data-ttu-id="41e09-106">Так как [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] выполнение команды поставщика OLE DB собственного клиента может создавать объекты с несколькими наборами строк в качестве результатов, используйте интерфейс **IMultipleResults** , чтобы убедиться, что получение данных приложением завершает циклическое обращение, инициированное клиентом.</span><span class="sxs-lookup"><span data-stu-id="41e09-106">Because the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider command execution can generate multiple-rowset objects as results, use the **IMultipleResults** interface to ensure that application data retrieval completes the client-initiated round trip.</span></span>  
  
 <span data-ttu-id="41e09-107">Следующая инструкция [!INCLUDE[tsql](../../includes/tsql-md.md)] формирует несколько наборов строк, при этом некоторые содержат данные строк из таблицы **OrderDetails**, а некоторые — результаты предложения COMPUTE BY:</span><span class="sxs-lookup"><span data-stu-id="41e09-107">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement generates multiple rowsets, some containing row data from the **OrderDetails** table and some containing results of the COMPUTE BY clause:</span></span>  
  
```  
SELECT OrderID, FullPrice = (UnitPrice * Quantity), Discount,  
    Discounted = UnitPrice * (1 - Discount) * Quantity  
FROM OrderDetails  
ORDER BY OrderID  
COMPUTE  
    SUM(UnitPrice * Quantity), SUM(UnitPrice * (1 - Discount) * Quantity)  
    BY OrderID  
```  
  
 <span data-ttu-id="41e09-108">Если потребитель выполняет команду, содержащую этот текст, и запрашивает набор строк в качестве интерфейса возвращаемых результатов, возвращается только первый набор строк.</span><span class="sxs-lookup"><span data-stu-id="41e09-108">If a consumer executes a command containing this text and requests a rowset as the returned results interface, only the first set of rows is returned.</span></span> <span data-ttu-id="41e09-109">Потребитель может обработать все строки в возвращенном наборе строк.</span><span class="sxs-lookup"><span data-stu-id="41e09-109">The consumer may process all rows in the rowset returned.</span></span> <span data-ttu-id="41e09-110">Но если свойство источника данных DBPROP_MULTIPLECONNECTIONS имеет значение VARIANT_FALSE, а для соединения не включен режим MARS, никакие другие команды не могут быть выполнены в объекте сеанса ( [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поставщик собственного клиента OLE DB не будет создавать другое подключение), пока команда не будет отменена.</span><span class="sxs-lookup"><span data-stu-id="41e09-110">But, if the DBPROP_MULTIPLECONNECTIONS data source property is set to VARIANT_FALSE, and MARS is not enabled on the connection, no other commands can be executed on the session object (the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider will not create another connection) until the command is canceled.</span></span> <span data-ttu-id="41e09-111">Если режим MARS не включен для соединения, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поставщик собственного клиента OLE DB возвращает ошибку DB_E_OBJECTOPEN, если DBPROP_MULTIPLECONNECTIONS VARIANT_FALSE и возвращает E_FAIL при наличии активной транзакции.</span><span class="sxs-lookup"><span data-stu-id="41e09-111">If MARS is not enabled on the connection, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider returns a DB_E_OBJECTOPEN error if DBPROP_MULTIPLECONNECTIONS is VARIANT_FALSE and returns E_FAIL if there is an active transaction.</span></span>  
  
 <span data-ttu-id="41e09-112">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]Поставщик OLE DB собственного клиента также возвращает DB_E_OBJECTOPEN при использовании потоковых выходных параметров, и приложение не потребляет все возвращенные значения выходного параметра перед вызовом **IMultipleResults::** GetNext для получения следующего результирующего набора.</span><span class="sxs-lookup"><span data-stu-id="41e09-112">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider will also return DB_E_OBJECTOPEN when using streamed output parameters and the application has not consumed all the returned output parameter values before calling **IMultipleResults::GetResults** to get the next result set.</span></span> <span data-ttu-id="41e09-113">Если режим MARS не включен и соединение занято выполнением команды, которая не создает набор строк, или если свойство источника данных DBPROP_MULTIPLECONNECTIONS имеет значение VARIANT_TRUE, то [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поставщик OLE DB собственного клиента создает дополнительные соединения для поддержки параллельных объектов команд, если только транзакция не активна, и в этом случае возвращается ошибка.</span><span class="sxs-lookup"><span data-stu-id="41e09-113">If MARS is not enabled and the connection is busy running a command that does not produce a rowset or that produces a rowset that is not a server cursor, and if the DBPROP_MULTIPLECONNECTIONS data source property is set to VARIANT_TRUE, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider creates additional connections to support concurrent command objects, unless a transaction is active, in which case it returns an error.</span></span> <span data-ttu-id="41e09-114">Управление транзакциями и блокировками [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] производит отдельно для каждого соединения.</span><span class="sxs-lookup"><span data-stu-id="41e09-114">Transactions and locking are managed by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] on a per connection basis.</span></span> <span data-ttu-id="41e09-115">Если создано второе соединение, команда в отдельном соединении не использует общие блокировки.</span><span class="sxs-lookup"><span data-stu-id="41e09-115">If a second connection is generated, the command on the separate connections does not share locks.</span></span> <span data-ttu-id="41e09-116">Необходимо соблюдать осторожность и убедиться, что одна команда не блокирует другую, удерживая блокировки строк, запрошенных другой командой.</span><span class="sxs-lookup"><span data-stu-id="41e09-116">Care must be taken to ensure that one command does not block another by holding locks on rows requested by the other command.</span></span> <span data-ttu-id="41e09-117">Если включен режим MARS, в одном соединении могут быть активными несколько команд, а если выполняются явные транзакции, все команды совместно используют общую транзакцию.</span><span class="sxs-lookup"><span data-stu-id="41e09-117">If MARS is enabled, multiple commands can be active on the connections and if explicit transactions are being used, the commands all share a common transaction.</span></span>  
  
 <span data-ttu-id="41e09-118">Потребитель может отменить команду с помощью метода [ISSAbort::Abort](../native-client-ole-db-interfaces/issabort-abort-ole-db.md) или освободив все удерживаемые ссылки на объект команды и производный набор строк.</span><span class="sxs-lookup"><span data-stu-id="41e09-118">The consumer can cancel the command either by using [ISSAbort::Abort](../native-client-ole-db-interfaces/issabort-abort-ole-db.md) or by releasing all references held on the command object and the derived rowset.</span></span>  
  
 <span data-ttu-id="41e09-119">Использование интерфейса **IMultipleResults** во всех экземплярах позволяет потребителю получить все наборы строк, сформированные командой, и соответствующим образом определить, когда нужно отменить выполнение команды, чтобы освободить объект сеанса для других команд.</span><span class="sxs-lookup"><span data-stu-id="41e09-119">Using **IMultipleResults** in all instances allows the consumer to get all rowsets generated by command execution and allows consumers to appropriately determine when to cancel command execution and free a session object for use by other commands.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="41e09-120">При использовании курсоров [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] выполнение команды создает курсор</span><span class="sxs-lookup"><span data-stu-id="41e09-120">When you use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cursors, command execution creates the cursor.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="41e09-121">возвращает успех или ошибку создания курсора, поэтому обмен данными с экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] завершается по выполнении команды.</span><span class="sxs-lookup"><span data-stu-id="41e09-121">returns success or failure on the cursor creation; therefore, the round trip to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is complete upon the return from command execution.</span></span> <span data-ttu-id="41e09-122">Следовательно, каждый вызов **GetNextRows** становится обменом данными.</span><span class="sxs-lookup"><span data-stu-id="41e09-122">Each **GetNextRows** call then becomes a round trip.</span></span> <span data-ttu-id="41e09-123">Таким образом, могут существовать несколько активных объектов команд, каждая из которых обрабатывает набор строк, являющийся результатом выборки из серверного курсора.</span><span class="sxs-lookup"><span data-stu-id="41e09-123">In this way, multiple active command objects can exist, each processing a rowset that is the result of a fetch from the server cursor.</span></span> <span data-ttu-id="41e09-124">Дополнительные сведения см. в статье [Наборы строк и курсоры SQL Server](../native-client-ole-db-rowsets/rowsets-and-sql-server-cursors.md).</span><span class="sxs-lookup"><span data-stu-id="41e09-124">For more information, see [Rowsets and SQL Server Cursors](../native-client-ole-db-rowsets/rowsets-and-sql-server-cursors.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="41e09-125">См. также:</span><span class="sxs-lookup"><span data-stu-id="41e09-125">See Also</span></span>  
 [<span data-ttu-id="41e09-126">Команды</span><span class="sxs-lookup"><span data-stu-id="41e09-126">Commands</span></span>](commands.md)  
  
  
