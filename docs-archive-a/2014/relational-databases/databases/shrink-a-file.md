---
title: Сжатие файла | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
f1_keywords:
- sql12.swb.shrinkfile.f1
helpviewer_keywords:
- shrinking files
- decreasing file size
- databases [SQL Server], shrinking
- reducing file size
- size [SQL Server], files
- file size [SQL Server]
ms.assetid: ce5c8798-c039-4ab2-81e7-90a8d688b893
author: stevestein
ms.author: sstein
ms.openlocfilehash: ac69e4bd2db3ef7fe0815d235dd1de7d3396b302
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87728329"
---
# <a name="shrink-a-file"></a>Сжатие файла
  В этом подразделе описывается сжатие данных или файла журнала в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] при помощи среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../includes/tsql-md.md)].  
  
 Сжатие файлов данных позволяет освободить неиспользуемое пространство путем перемещения страниц данных с конца файла в незанятое пространство ближе к началу файла. Когда в конце файла образуется достаточно свободного места, страницы данных в конце файла могут быть освобождены и возвращены в файловую систему.  
  
 **В этом разделе**  
  
-   **Перед началом работы**  
  
     [Ограничения](#Restrictions)  
  
     [Рекомендации](#Recommendations)  
  
     [Безопасность](#Security)  
  
-   **Сжатие файла данных или журнала с помощью различных средств.**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> Ограничения  
  
-   Первичный файл данных не может быть сделан меньше, чем размер первичного файла в базе данных model.  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> Рекомендации  
  
-   Данные, перемещаемые в процессе сжатия файла, могут быть разбросаны по любым доступным местам в файле. Это вызывает фрагментацию индекса и может увеличить время выполнения запросов, выполняющих поиск в диапазоне индекса. Чтобы устранить фрагментацию, предусмотрите возможность перестроения индексов файла после сжатия.  
  
###  <a name="security"></a><a name="Security"></a> безопасность  
  
####  <a name="permissions"></a><a name="Permissions"></a> Permissions  
 Необходимо быть членом предопределенной роли сервера **sysadmin** или предопределенной роли базы данных **db_owner** .  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
  
#### <a name="to-shrink-a-data-or-log-file"></a>Сжатие файла данных или журнала  
  
1.  В обозревателе объектов подключитесь к экземпляру компонента [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] и разверните его.  
  
2.  Разверните узел **Базы данных** и щелкните правой кнопкой мыши базу данных, которую нужно сжать.  
  
3.  Укажите пункты **Задачи**и **Сжать**, затем выберите пункт **Файлы**.  
  
     **База данных**  
     Отображает имя выбранной базы данных.  
  
     **Тип файла**  
     Выберите тип файла. Доступны следующие возможности: **Данные** и **Журнал** . Значение по умолчанию: **Данные**. Выбор другого типа файловой группы соответственным образом изменяет выбор в других полях.  
  
     **Файловая группа**  
     Выберите файловую группу из списка файловых групп, связанных с выбранным ранее **типом файлов** . Выбор другой файловой группы соответственным образом изменяет выбор в других полях.  
  
     **Имя файла**  
     Выберите файл из списка имеющихся файлов выбранной файловой группы и типа.  
  
     **Расположение**  
     Отображает полный путь к текущему выбранному файлу. Путь нельзя редактировать, но можно скопировать в буфер обмена.  
  
     **Выделенное в данный момент место**  
     Для файлов данных отображает выделенное в данный момент место. Для файлов журнала отображается выделенное в данный момент пространство, вычисленное на основании результата процедуры SQLPERF(LOGSPACE) модуля DBCC.  
  
     **Доступное свободное место**  
     Для файлов данных отображается имеющееся в данный момент доступное свободное место, вычисленное на основании результата процедуры SHOWFILESTATS(идентификатор_файла) модуля DBCC. Для файлов журнала отображается имеющиеся в данный момент доступное свободное место, вычисленное на основании результата процедуры SQLPERF(LOGSPACE) модуля DBCC.  
  
     **Освободить неиспользуемое место**  
     Все неиспользуемое пространство, выделенное для файлов, освобождается для нужд операционной системы, а файл сжимается в последний выделенный экстент, тем самым размер файла уменьшается без перемещения данных. Не производится попыток перемещения строк на нераспределенные страницы.  
  
     **Реорганизовать страницы, перед тем как освободить неиспользуемое место**  
     Эквивалентно выполнению процедуры SHRINKFILE модуля DBCC, определяющей размер целевого файла. При выборе этого параметра необходимо указать размер целевого файла в поле **Сжать файл до** .  
  
     **Сжать файл до**  
     Определяет размер целевого файла для операции сжатия. Размер не должен быть меньше текущего выделенного пространства или больше общего количества экстентов, выделенных файлу. Если вводимое значение выходит за допустимые границы, оно будет преобразовано к минимальному или максимальному значению при изменении фокуса ввода или при нажатии на любую кнопку панели инструментов.  
  
     **Очистить файл путем переноса данных в другие файлы той же файловой группы**  
     Выполняется перенос всех данных из указанного файла. Этот параметр позволяет удалить файл при помощи инструкции ALTER DATABASE. Эта возможность эквивалентна выполнению процедуры SHRINKFILE модуля DBCC с параметром EMPTYFILE.  
  
4.  Выберите тип файла и имя файла.  
  
5.  Дополнительно можно установить флажок **Освободить неиспользуемое место** .  
  
     Выбор этого параметра приводит к освобождению всего неиспользуемого пространства файла для ОС и уменьшению размера файла до последнего размещенного экстента. Это уменьшает размер файла без перемещения каких-либо данных.  
  
6.  Дополнительно можно установить флажок **Реорганизовать файлы перед освобождением неиспользуемого места** . При выборе этого режима необходимо указать значение **Сжать файл до** . По умолчанию этот флажок снят.  
  
     Выбор этого параметра приводит к освобождению всего неиспользуемого пространства файла для ОС и попытке перемещения строк в неразмещенные страницы.  
  
7.  При необходимости введите максимальный процент свободного пространства, которое должно остаться в базе данных после ее сжатия. Допустимы значения от 0 до 99. Этот параметр доступен только в том случае, если установлен флажок **Реорганизовать файлы перед освобождением неиспользуемого места** .  
  
8.  При необходимости установите флажок **Очистить файл путем переноса данных в другие файлы той же файловой группы** .  
  
     Выбор этого режима перемещает все данные из указанного файла в другие файлы данной файловой группы. Пустой файл удалить нельзя. Этот режим эквивалентен выполнению процедуры DBCC SHRINKFILE с параметром EMPTYFILE.  
  
9. Нажмите кнопку **ОК**.  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> Использование Transact-SQL  
  
#### <a name="to-shrink-a-data-or-log-file"></a>Сжатие файла данных или журнала  
  
1.  Установите соединение с компонентом [!INCLUDE[ssDE](../../includes/ssde-md.md)].  
  
2.  На панели «Стандартная» нажмите **Создать запрос**.  
  
3.  Скопируйте следующий пример в окно запроса и нажмите кнопку **Выполнить**. В следующем примере для сжатия файла [в базе данных](/sql/t-sql/database-console-commands/dbcc-shrinkfile-transact-sql) до 7 МБ используется функция `DataFile1` DBCC SHRINKFILE `UserDB` .  
  
 [!code-sql[DBCC#DBCC_SHRINKFILE1](../../snippets/tsql/SQL14/tsql/dbcc/transact-sql/dbcc_other.sql#dbcc_shrinkfile1)]  
  
## <a name="see-also"></a>См. также:  
 [DBCC SHRINKDATABASE (Transact-SQL)](/sql/t-sql/database-console-commands/dbcc-shrinkdatabase-transact-sql)   
 [Сжатие базы данных](shrink-a-database.md)   
 [Удаление файлов данных или журнала из базы данных](delete-data-or-log-files-from-a-database.md)   
 [sys.databases (Transact-SQL)](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql)   
 [sys.database_files (Transact-SQL)](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql)  
  
  
