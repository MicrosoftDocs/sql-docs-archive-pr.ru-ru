---
title: Копирование баз данных путем создания и восстановления резервных копий | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- full-text search [SQL Server], back up and restore
- restoring databases [SQL Server], previous SQL Server versions
- database restores [SQL Server], copying databases
- restoring databases [SQL Server], onto another server instance
- restoring [SQL Server], onto another server instance
- backing up databases [SQL Server], copying databases
- database backups [SQL Server], copying databases
ms.assetid: b93e9701-72a0-408e-958c-dc196872c040
author: stevestein
ms.author: sstein
ms.openlocfilehash: a8ffed36767f961f7482aa0dccf755118c80c019
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87731717"
---
# <a name="copy-databases-with-backup-and-restore"></a>Копирование баз данных путем создания и восстановления резервных копий
  В [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]можно создать новую базу данных, восстановив резервную копию пользовательской базы данных, созданной в [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] или более поздней версии. Однако резервные копии баз данных **master**, **model** и **msdb** , созданных в более ранней версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , восстановить на [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]невозможно. Кроме того, резервные копии, созданные в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] , невозможно восстановить в более ранних версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] используется путь по умолчанию, отличный от пути, использованного в предыдущих версиях. Поэтому для восстановления резервной копии базы данных, созданной в месте расположения по умолчанию для ранних версий, необходимо использовать параметр MOVE. Сведения о новом пути по умолчанию см. в разделе [Расположение файлов для экземпляра по умолчанию и именованных экземпляров SQL Server](../../sql-server/install/file-locations-for-default-and-named-instances-of-sql-server.md). Дополнительные сведения о перемещении файлов баз данных см. в статье «Перемещение файлов баз данных» далее в этом подразделе.  
  
## <a name="general-steps-for-using-backup-and-restore-to-copy-a-database"></a>Основные этапы копирования базы данных, используя функции резервного копирования и восстановления  
 При использовании резервного копирования и восстановления для копирования базы данных на другой экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]компьютер-источник и целевой компьютер могут быть любой платформой, на которой запускается [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
 Основные этапы.  
  
1.  Создайте резервную копию базы данных-источника, которая может находиться на экземпляре [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] или более поздней версии. Компьютер, на котором запущен этот экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , называется *компьютером-источником*.  
  
2.  На компьютере, на который необходимо скопировать базу данных ( *конечный компьютер*), подключитесь к экземпляру, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на котором планируется восстановить базу данных. При необходимости создайте те же устройства резервного копирования на целевом экземпляре сервера, что использовались для резервного копирования баз данных-источников.  
  
3.  Восстановите резервную копию базы данных-источника на целевом компьютере. При восстановлении базы данных автоматически создаются все ее файлы.  
  
 В следующих разделах рассматриваются дополнительные вопросы, которые могут повлиять на процесс копирования.  
  
## <a name="before-you-restore-database-files"></a>Перед восстановлением файлов базы данных  
 При восстановлении базы данных необходимые файлы базы данных создаются автоматически. По умолчанию у файлов, созданных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в процессе восстановления, те же имена и пути, что и у файлов резервной копии исходной базы данных на компьютере-источнике.  
  
 Также при восстановлении базы данных, если это необходимо, можно указать сопоставление дисков, имена файлов или путь для восстановления. Это может быть необходимо в следующих ситуациях.  
  
-   Нужная структура каталогов или сопоставление дисков, используемые на исходном компьютере, могут отсутствовать на другом компьютере. Например, возможно, резервная копия содержит файл, который нужно восстановить на диск E, но на целевом компьютере диска E — нет.  
  
-   на целевом диске может быть недостаточно свободного места;  
  
-   Если используется имя базы данных, которое уже существует на целевом сервере восстановления, а имя каждого из ее файлов совпадает с именем файла базы данных в резервном наборе данных, происходит одно из следующих действий.  
  
    -   Если существующий файл базы данных может быть перезаписан, он будет перезаписан (это не затронет файл, относящийся к базе данных с другим именем).  
  
    -   Если существующий файл не может быть перезаписан, возникнет ошибка восстановления.  
  
 Во избежание ошибок и непредвиденных последствий, перед операцией восстановления можно использовать таблицы журнала [backupfile](/sql/relational-databases/system-tables/backupfile-transact-sql) , чтобы найти в резервной копии файлы базы данных и журнала, которые планируется восстановить.  
  
## <a name="moving-the-database-files"></a>Перемещение файлов баз данных  
 Если файлы резервной копии базы данных нельзя восстановить на целевом компьютере по причинам, перечисленным выше, необходимо переместить файлы в новое место назначения, где они могут быть восстановлены. Пример:  
  
-   Нужно восстановить базу данных из резервных копий, созданных в месте расположения по умолчанию для предыдущей версии.  
  
-   Может оказаться необходимым восстановить некоторые файлы базы данных из резервной копии на другой диск из-за нехватки места на диске по умолчанию. Такое случается довольно часто, потому что у большинства компьютеров в организациях разное число и параметры дисковых накопителей и различные конфигурации программного обеспечения.  
  
-   Может оказаться необходимым создать копию существующей базы данных на том же компьютере для тестирования. В этом случае файлы исходной базы данных уже существуют, поэтому при создании копии базы данных во время операции восстановления надо указать другие имена файлов.  
  
 Дополнительные сведения см. в подразделе «Восстановление файлов и файловых групп в новое место назначения» далее в этом разделе.  
  
## <a name="changing-the-database-name"></a>Смена имени базы данных  
 Можно изменить имя базы данных при восстановлении на целевом компьютере без восстановления файлов с последующим изменением имени базы вручную. Например, нужно изменить имя базы данных с **Sales** на **SalesCopy** , чтобы указать на то, что это копия базы данных.  
  
 Имя базы данных, явно задаваемое при ее восстановлении, автоматически используется в качестве нового имени базы данных. Так как такой базы данных еще не существует, новая база данных создается из файлов резервной копии.  
  
## <a name="when-upgrading-a-database-by-using-restore"></a>Обновление базы данных с помощью восстановления  
 При восстановлении резервных копий из предыдущей версии желательно заранее знать, существует ли на целевом компьютере путь (диск и каталог) для каждого полнотекстового каталога резервной копии. Чтобы получить список всех логических и физических имен — пути и имени файла — всех файлов резервной копии, включая файлы каталогов, выполните инструкцию RESTORE FILELISTONLY FROM *<устройство_резервного копирования>* Дополнительные сведения см. в разделе [Инструкция RESTORE FILELISTONLY (Transact-SQL)](/sql/t-sql/statements/restore-statements-filelistonly-transact-sql).  
  
 Если нужный путь на целевом компьютере не существует, есть два варианта.  
  
-   Создать нужное сопоставление дисков или структуру каталогов на целевом компьютере.  
  
-   Переместить файлы каталогов на новое место назначения во время операции восстановления с помощью предложения WITH MOVE инструкции RESTORE DATABASE. Дополнительные сведения см. в разделе [RESTORE (Transact-SQL)](/sql/t-sql/statements/restore-statements-transact-sql)невозможно.  
  
 Дополнительные сведения об альтернативных параметров обновления полнотекстовых индексов см. в разделе [Обновление полнотекстового поиска](../search/upgrade-full-text-search.md).  
  
## <a name="database-ownership"></a>Владелец базы данных  
 При восстановлении базы данных на другом компьютере имя входа пользователя [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows, начавшего процесс восстановления, автоматически становится именем владельца базы данных. При восстановлении базы данных системный администратор или владелец новой базы данных могут сменить ее владельца. Для предотвращения несанкционированного восстановления базы данных устанавливайте пароли на носители или сами резервные копии.  
  
## <a name="managing-metadata-when-restoring-to-another-server-instance"></a>Управление метаданными при восстановлении базы данных на другой экземпляр сервера  
 Чтобы обеспечить целостность работы пользователей и приложений при восстановлении базы данных на другой экземпляр сервера, на новом экземпляре необходимо повторно создать некоторые или все метаданные, например имена входа и задания. Дополнительные сведения см. в статье [Управление метаданными при обеспечении доступности базы данных на другом экземпляре сервера (SQL Server)](manage-metadata-when-making-a-database-available-on-another-server.md).  
  
 **Просмотр файлов данных и журналов в резервном наборе данных**  
  
-   [RESTORE FILELISTONLY (Transact-SQL)](/sql/t-sql/statements/restore-statements-filelistonly-transact-sql)  
  
 **Восстановление файлов и файловых групп в новое место**  
  
-   [Восстановление файлов в новое место (SQL Server)](../backup-restore/restore-files-to-a-new-location-sql-server.md)  
  
-   [Восстановление резервной копии базы данных &#40;SQL Server Management Studio&#41;](../backup-restore/restore-a-database-backup-using-ssms.md)  
  
 **Восстановление файлов и файловых групп поверх существующих файлов**  
  
-   [Восстановление файлов и файловых групп поверх существующих файлов (SQL Server)](../backup-restore/restore-files-and-filegroups-over-existing-files-sql-server.md)  
  
 **Восстановление базы данных с новым именем**  
  
-   [Восстановление резервной копии базы данных &#40;SQL Server Management Studio&#41;](../backup-restore/restore-a-database-backup-using-ssms.md)  
  
 **Перезапуск прерванной операции восстановления**  
  
-   [Перезапуск прерванной операции восстановления (Transact-SQL)](../backup-restore/restart-an-interrupted-restore-operation-transact-sql.md)  
  
 **Изменение владельца базы данных**  
  
-   [sp_changedbowner (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-changedbowner-transact-sql)  
  
 **Копирование базы данных с помощью управляющих объектов SQL Server (SMO)**  
  
-   <xref:Microsoft.SqlServer.Management.Smo.Restore.ReadFileList%2A>  
  
-   <xref:Microsoft.SqlServer.Management.Smo.Restore.RelocateFiles%2A>  
  
-   <xref:Microsoft.SqlServer.Management.Smo.Restore.ReplaceDatabase%2A>  
  
-   <xref:Microsoft.SqlServer.Management.Smo.Restore>  
  
## <a name="see-also"></a>См. также:  
 [Копирование баз данных на другие серверы](copy-databases-to-other-servers.md)   
 [Расположение файлов для экземпляра по умолчанию и именованных экземпляров SQL Server](../../sql-server/install/file-locations-for-default-and-named-instances-of-sql-server.md)   
 [Инструкция RESTORE FILELISTONLY (Transact-SQL)](/sql/t-sql/statements/restore-statements-filelistonly-transact-sql)   
 [RESTORE (Transact-SQL)](/sql/t-sql/statements/restore-statements-transact-sql)  
  
  
