---
title: Состояния файла | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- restoring file state [SQL Server]
- verifying file states
- current file states
- verifying filegroup states
- file states [SQL Server]
- online file state
- offline file state [SQL Server]
- viewing filegroup states
- viewing file states
- suspect file state
- recovering file state [SQL Server]
- current filegroup state
- recovery pending file state [SQL Server]
- displaying file states
- states [SQL Server], files
- displaying filegroup states
- defunct file state
ms.assetid: b426474d-8954-4df0-b78b-887becfbe8d6
author: stevestein
ms.author: sstein
ms.openlocfilehash: b7cad94527d9191609a6920b5dfa200a98cd8bbd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87667204"
---
# <a name="file-states"></a><span data-ttu-id="bb6e5-102">Состояния файла</span><span class="sxs-lookup"><span data-stu-id="bb6e5-102">File States</span></span>
  <span data-ttu-id="bb6e5-103">В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]состояние файла базы данных поддерживается независимо от состояния базы данных.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-103">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the state of a database file is maintained independently from the state of the database.</span></span> <span data-ttu-id="bb6e5-104">Файл всегда находится в одном определенном состоянии, таком как ONLINE или OFFLINE.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-104">A file is always in one specific state, such as ONLINE or OFFLINE.</span></span> <span data-ttu-id="bb6e5-105">Чтобы просмотреть текущее состояние файла, используйте представление каталога [sys.master_files](/sql/relational-databases/system-catalog-views/sys-master-files-transact-sql) или [sys.database_files](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="bb6e5-105">To view the current state of a file, use the [sys.master_files](/sql/relational-databases/system-catalog-views/sys-master-files-transact-sql) or [sys.database_files](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql) catalog view.</span></span> <span data-ttu-id="bb6e5-106">Если база данных находится в состоянии вне сети, то состояние файлов можно просмотреть в представлении каталога [sys.master_files](/sql/relational-databases/system-catalog-views/sys-master-files-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="bb6e5-106">If the database is offline, the state of the files can be viewed from the [sys.master_files](/sql/relational-databases/system-catalog-views/sys-master-files-transact-sql) catalog view.</span></span>  
  
 <span data-ttu-id="bb6e5-107">Состояние файлов в файловой группе определяет доступность всей файловой группы.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-107">The state of the files in a filegroup determines the availability of the whole filegroup.</span></span> <span data-ttu-id="bb6e5-108">Чтобы файловая группа была доступна, необходимо, чтобы все файлы в файловой группе находились в режиме в сети.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-108">For a filegroup to be available, all files within the filegroup must be online.</span></span> <span data-ttu-id="bb6e5-109">Чтобы просмотреть текущее состояние файловой группы, используйте представление каталога [sys.filegroups](/sql/relational-databases/system-catalog-views/sys-filegroups-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="bb6e5-109">To view the current state of a filegroup, use the [sys.filegroups](/sql/relational-databases/system-catalog-views/sys-filegroups-transact-sql) catalog view.</span></span> <span data-ttu-id="bb6e5-110">Попытка получить доступ к файловой группе, которая находится в режиме вне  сети, с помощью инструкции языка [!INCLUDE[tsql](../../includes/tsql-md.md)] приводит к ошибке.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-110">If a filegroup is offline and you try to access the filegroup by a [!INCLUDE[tsql](../../includes/tsql-md.md)] statement, it will fail with an error.</span></span> <span data-ttu-id="bb6e5-111">При построении планов запросов для инструкций SELECT оптимизатор запросов избегает некластеризованных индексов и индексированных представлений, принадлежащих файловым группам вне сети, чтобы разрешить успешное выполнение инструкций.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-111">When the query optimizer builds query plans for SELECT statements, it avoids nonclustered indexes and indexed views that reside in offline filegroups, letting these statements to succeed.</span></span> <span data-ttu-id="bb6e5-112">Однако если файловая группа, находящаяся в режиме вне сети, содержит кучу или кластеризованный индекс целевой таблицы, инструкция SELECT не будет выполнена.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-112">However, if the offline filegroup contains the heap or clustered index of the target table, the SELECT statements fail.</span></span> <span data-ttu-id="bb6e5-113">Кроме того, любая инструкция INSERT, UPDATE или DELETE, изменяющая таблицу с любым индексом в файловой группе, находящихся в режиме вне сети, также не будет выполнена.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-113">Additionally, any INSERT, UPDATE, or DELETE statement that modifies a table with any index in an offline filegroup will fail.</span></span>  
  
## <a name="file-state-definitions"></a><span data-ttu-id="bb6e5-114">Определения состояний файлов</span><span class="sxs-lookup"><span data-stu-id="bb6e5-114">File State Definitions</span></span>  
 <span data-ttu-id="bb6e5-115">Состояния файлов определяются в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-115">The following table defines the file states.</span></span>  
  
|<span data-ttu-id="bb6e5-116">Штат</span><span class="sxs-lookup"><span data-stu-id="bb6e5-116">State</span></span>|<span data-ttu-id="bb6e5-117">Определение</span><span class="sxs-lookup"><span data-stu-id="bb6e5-117">Definition</span></span>|  
|-----------|----------------|  
|<span data-ttu-id="bb6e5-118">ONLINE</span><span class="sxs-lookup"><span data-stu-id="bb6e5-118">ONLINE</span></span>|<span data-ttu-id="bb6e5-119">Файл доступен для всех операций.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-119">The file is available for all operations.</span></span> <span data-ttu-id="bb6e5-120">Если база данных находится в режиме в сети, то файлы первичной файловой группы всегда находятся в режиме в сети.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-120">Files in the primary filegroup are always online if the database itself is online.</span></span> <span data-ttu-id="bb6e5-121">Если файл первичной файловой группы не находится в режиме в сети, то база данных тоже не находится в режиме в сети, и состояния файлов во вторичной файловой группе не определены.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-121">If a file in the primary filegroup is not online, the database is not online and the states of the secondary files are undefined.</span></span>|  
|<span data-ttu-id="bb6e5-122">OFFLINE</span><span class="sxs-lookup"><span data-stu-id="bb6e5-122">OFFLINE</span></span>|<span data-ttu-id="bb6e5-123">Файл недоступен и, возможно, отсутствует на диске.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-123">The file is not available for access and may not be present on the disk.</span></span> <span data-ttu-id="bb6e5-124">Файлы переходят в режим вне сети с помощью явного указания пользователя и остаются в режиме вне  сети до тех пор, пока пользователем не будет предпринято дополнительное действие.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-124">Files become offline by explicit user action and remain offline until additional user action is taken.</span></span><br /><br /> <span data-ttu-id="bb6e5-125">\*\* \* \* Внимание \* ! \* \*\* файл должен быть установлен в автономном режиме только в том случае, если файл поврежден, но его можно восстановить.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-125">**\*\* Caution \*\*** A file should only be set offline when the file is corrupted, but it can be restored.</span></span> <span data-ttu-id="bb6e5-126">Файл, который установлен в режим вне сети, может быть установлен в режим в сети только путем восстановления файла из резервной копии.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-126">A file set to offline can only be set online by restoring the file from backup.</span></span> <span data-ttu-id="bb6e5-127">Дополнительные сведения о восстановлении одного файла см. в разделе [RESTORE (Transact-SQL)](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="bb6e5-127">For more information about restoring a single file, see [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>|  
|<span data-ttu-id="bb6e5-128">RESTORING</span><span class="sxs-lookup"><span data-stu-id="bb6e5-128">RESTORING</span></span>|<span data-ttu-id="bb6e5-129">Файл восстанавливается.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-129">The file is being restored.</span></span> <span data-ttu-id="bb6e5-130">Файлы переходят в состояние восстановления в результате команды восстановления, воздействующей на весь файл, а не на отдельную страницу; файлы остаются в состоянии восстановления до окончания процесса восстановления файла.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-130">Files enter the restoring state because of a restore command affecting the whole file, not just a page restore, and remain in this state until the restore is completed and the file is recovered.</span></span>|  
|<span data-ttu-id="bb6e5-131">RECOVERY PENDING</span><span class="sxs-lookup"><span data-stu-id="bb6e5-131">RECOVERY PENDING</span></span>|<span data-ttu-id="bb6e5-132">Восстановление файла было отложено.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-132">The recovery of the file has been postponed.</span></span> <span data-ttu-id="bb6e5-133">Файл переходит в это состояние автоматически в результате частичного восстановления, при котором файл еще не восстановлен.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-133">A file enters this state automatically because of a piecemeal restore process in which the file is not restored and recovered.</span></span> <span data-ttu-id="bb6e5-134">Со стороны пользователя требуется дополнительное действие, чтобы исправить ошибку и разрешить завершение процесса восстановления.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-134">Additional action by the user is required to resolve the error and allow for the recovery process to be completed.</span></span> <span data-ttu-id="bb6e5-135">Дополнительные сведения см. в разделе [Поэтапное восстановление (SQL Server)](../backup-restore/piecemeal-restores-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="bb6e5-135">For more information, see [Piecemeal Restores &#40;SQL Server&#41;](../backup-restore/piecemeal-restores-sql-server.md).</span></span>|  
|<span data-ttu-id="bb6e5-136">SUSPECT</span><span class="sxs-lookup"><span data-stu-id="bb6e5-136">SUSPECT</span></span>|<span data-ttu-id="bb6e5-137">Не удалось восстановить файл в процессе восстановления файла в сети.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-137">Recovery of the file failed during an online restore process.</span></span> <span data-ttu-id="bb6e5-138">Если файл находится в первичной файловой группе, база данных тоже помечается как подозрительная.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-138">If the file is in the primary filegroup, the database is also marked as suspect.</span></span> <span data-ttu-id="bb6e5-139">Иначе база данных остается в режиме в сети, и в подозрительном состоянии находится только файл.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-139">Otherwise, only the file is suspect and the database is still online.</span></span><br /><br /> <span data-ttu-id="bb6e5-140">Файл остается в подозрительном состоянии до тех пор, пока он не становится доступным в результате одного из следующих методов.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-140">The file will remain in the suspect state until it is made available by one of the following methods:</span></span><br /><br /> <span data-ttu-id="bb6e5-141">Восстановление из резервной копии или по журналу транзакций</span><span class="sxs-lookup"><span data-stu-id="bb6e5-141">Restore and recovery</span></span><br /><br /> <span data-ttu-id="bb6e5-142">Инструкцией DBCC CHECKDB c параметром REPAIR_ALLOW_DATA_LOSS</span><span class="sxs-lookup"><span data-stu-id="bb6e5-142">DBCC CHECKDB with REPAIR_ALLOW_DATA_LOSS</span></span>|  
|<span data-ttu-id="bb6e5-143">DEFUNCT</span><span class="sxs-lookup"><span data-stu-id="bb6e5-143">DEFUNCT</span></span>|<span data-ttu-id="bb6e5-144">Файл был удален, пока находился не в сети.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-144">The file was dropped when it was not online.</span></span> <span data-ttu-id="bb6e5-145">При удалении файловой группы вне сети все файлы группы помечаются удаленными.</span><span class="sxs-lookup"><span data-stu-id="bb6e5-145">All files in a filegroup become defunct when an offline filegroup is removed.</span></span>|  
  
## <a name="related-content"></a><span data-ttu-id="bb6e5-146">См. также</span><span class="sxs-lookup"><span data-stu-id="bb6e5-146">Related Content</span></span>  
 [<span data-ttu-id="bb6e5-147">ALTER DATABASE (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="bb6e5-147">ALTER DATABASE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-database-transact-sql)  
  
 [<span data-ttu-id="bb6e5-148">Состояния базы данных</span><span class="sxs-lookup"><span data-stu-id="bb6e5-148">Database States</span></span>](database-states.md)  
  
 [<span data-ttu-id="bb6e5-149">Состояния зеркального отображения (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="bb6e5-149">Mirroring States &#40;SQL Server&#41;</span></span>](../../database-engine/database-mirroring/mirroring-states-sql-server.md)  
  
 [<span data-ttu-id="bb6e5-150">DBCC CHECKDB (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="bb6e5-150">DBCC CHECKDB &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql)  
  
 [<span data-ttu-id="bb6e5-151">Файлы и файловые группы базы данных</span><span class="sxs-lookup"><span data-stu-id="bb6e5-151">Database Files and Filegroups</span></span>](database-files-and-filegroups.md)  
  
  
