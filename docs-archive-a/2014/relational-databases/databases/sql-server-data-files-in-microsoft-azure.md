---
title: SQL Server файлы данных в Azure | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
ms.assetid: 38ffd9c2-18a5-43d2-b674-e425addec4e4
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 21f960a50ed48ff2b146d96b73a1609d73b35c32
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87728322"
---
# <a name="sql-server-data-files-in-azure"></a><span data-ttu-id="7983e-102">Файлы данных SQL Server в Azure</span><span class="sxs-lookup"><span data-stu-id="7983e-102">SQL Server Data Files in Azure</span></span>
  <span data-ttu-id="7983e-103">SQL Server файлы данных в Azure обеспечивает встроенную поддержку файлов базы данных SQL Server, хранящихся в виде больших двоичных объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-103">SQL Server Data Files in Azure enables native support for SQL Server database files stored as Azure Blobs.</span></span> <span data-ttu-id="7983e-104">Она позволяет создавать базы данных в SQL Server, выполняющихся локально или на виртуальной машине в Azure, с выделенным местом хранения для данных в хранилище BLOB-объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-104">It allows you to create a database in SQL Server running in on-premises or in a virtual machine in Azure with a dedicated storage location for your data in Azure Blob Storage.</span></span> <span data-ttu-id="7983e-105">Это усовершенствование значительно упрощает перемещение баз данных между компьютерами с помощью операций отсоединения и присоединения.</span><span class="sxs-lookup"><span data-stu-id="7983e-105">This enhancement especially simplifies to move databases between machines by using detach and attach operations.</span></span> <span data-ttu-id="7983e-106">Кроме того, он предоставляет альтернативное место хранения для файлов резервной копии базы данных, позволяя выполнять восстановление из службы хранилища Azure или из нее.</span><span class="sxs-lookup"><span data-stu-id="7983e-106">In addition, it provides an alternative storage location for your database backup files by allowing you to restore from or to Azure Storage.</span></span> <span data-ttu-id="7983e-107">Поэтому он обеспечивает возможность реализации нескольких гибридных решений, предоставляя ряд преимуществ для виртуализации данных, перемещения данных, безопасности и доступности, а также достижения снижения затрат и обслуживания для высокого уровня доступности и эластичного масштабирования.</span><span class="sxs-lookup"><span data-stu-id="7983e-107">Therefore, it enables several hybrid solutions by providing several benefits for data virtualization, data movement, security and availability, and any easy low costs and maintenance for high-availability and elastic scaling.</span></span>  
  
 <span data-ttu-id="7983e-108">В этом разделе рассматриваются основные понятия и рекомендации по хранению файлов данных SQL Server в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-108">This topic introduces concepts and considerations that are central to storing SQL Server data files in Azure Storage Service.</span></span>  
  
 <span data-ttu-id="7983e-109">Практические практические советы по использованию этой новой функции см. в разделе [учебник. SQL Server файлы данных в службе хранилища Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="7983e-109">For a practical hands-on experience on how to use this new feature, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="7983e-110">На следующей схеме показано, что это расширение позволяет хранить SQL Server файлы базы данных в виде больших двоичных объектов Azure в службе хранилища Azure независимо от того, где находится сервер.</span><span class="sxs-lookup"><span data-stu-id="7983e-110">The following diagram demonstrates that this enhancement enables you to store SQL Server database files as Azure blobs in Azure Storage regardless of where your server resides.</span></span>  
  
 <span data-ttu-id="7983e-111">![Интеграция SQL Server с хранилищем Azure](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "Интеграция SQL Server с хранилищем Azure")</span><span class="sxs-lookup"><span data-stu-id="7983e-111">![SQL Server Integration with Azure Storage](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "SQL Server Integration with Azure Storage")</span></span>  
  
## <a name="benefits-of-using-sql-server-data-files-in-azure"></a><span data-ttu-id="7983e-112">Преимущества использования файлов данных SQL Server в Azure</span><span class="sxs-lookup"><span data-stu-id="7983e-112">Benefits of using SQL Server Data Files in Azure</span></span>  
  
-   <span data-ttu-id="7983e-113">**Преимущества простой и быстрой миграции.** Эта функция упрощает процесс миграции, перемещая одну базу данных за один раз между локальными компьютерами и между локальной и облачной средой без внесения каких-либо изменений в приложения.</span><span class="sxs-lookup"><span data-stu-id="7983e-113">**Easy and fast migration benefits:** This feature simplifies the migration process by moving one database at a time between machines in on-premises as well as between on-premises and cloud environments without any application changes.</span></span> <span data-ttu-id="7983e-114">Поэтому он поддерживает добавочную миграцию, сохраняя при этом без изменений существующую локальную инфраструктуру.</span><span class="sxs-lookup"><span data-stu-id="7983e-114">Therefore, it supports an incremental migration while maintaining your existing on-premises infrastructure in place.</span></span> <span data-ttu-id="7983e-115">Кроме того, наличие доступа к централизованному хранилищу данных позволяет упростить логику приложения, когда приложение необходимо выполнять в нескольких местах в локальной среде.</span><span class="sxs-lookup"><span data-stu-id="7983e-115">In addition, having access to a centralized data storage simplifies the application logic when an application needs to run in multiple locations in an on-premises environment.</span></span> <span data-ttu-id="7983e-116">В некоторых случаях может потребоваться быстро настроить вычислительные центры, которые собирают данные из множества различных источников, в географически удаленных друг от друга местах.</span><span class="sxs-lookup"><span data-stu-id="7983e-116">In some cases, you may need to rapidly setup computer centers in geographically dispersed locations, which gather data from many different sources.</span></span> <span data-ttu-id="7983e-117">С помощью этого нового расширения вместо перемещения данных из одного расположения в другое можно хранить множество баз данных в качестве больших двоичных объектов Azure, а затем выполнять сценарии Transact-SQL для создания баз данных на локальных компьютерах или виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="7983e-117">By using this new enhancement, instead of moving data from one location to another, you can store many databases as Azure blobs, and then run Transact-SQL scripts to create databases on the local machines or virtual machines.</span></span>  
  
-   <span data-ttu-id="7983e-118">**Преимущества для хранения с учетом затрат и неограниченного объема:** Эта функция позволяет иметь неограниченное хранилище неограниченного объема в Azure при использовании локальных ресурсов вычислений.</span><span class="sxs-lookup"><span data-stu-id="7983e-118">**Cost and limitless storage benefits:** This feature enables you to have limitless off-site storage in Azure while leveraging on-premises compute resources.</span></span> <span data-ttu-id="7983e-119">При использовании Azure в качестве места хранения можно легко сосредоточиться на логике приложения без дополнительных затрат на управление оборудованием.</span><span class="sxs-lookup"><span data-stu-id="7983e-119">When you use Azure as a storage location, you can easily focus on the application logic without the overhead of hardware management.</span></span> <span data-ttu-id="7983e-120">Если любой локальный вычислительный узел выходит из строя, можно настроить новый без перемещения каких-либо данных.</span><span class="sxs-lookup"><span data-stu-id="7983e-120">If you lose a computation node on-premises, you can set up a new one without any data movement.</span></span>  
  
-   <span data-ttu-id="7983e-121">**Преимущества высокого уровня доступности и аварийного восстановления:** Использование SQL Server файлов данных в Azure может упростить решения высокого уровня доступности и аварийного восстановления.</span><span class="sxs-lookup"><span data-stu-id="7983e-121">**High availability and disaster recovery benefits:** Using SQL Server Data Files in Azure feature might simplify the high availability and disaster recovery solutions.</span></span> <span data-ttu-id="7983e-122">Например, если виртуальная машина в Azure или экземпляр SQL Server аварийно завершает работу, вы можете повторно создать базы данных на новом компьютере, просто повторно установив ссылки на большие двоичные объекты Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-122">For example, if a virtual machine in Azure or an instance of SQL Server crashes, you can re-create your databases in a new machine by just re-establishing links to Azure Blobs.</span></span>  
  
-   <span data-ttu-id="7983e-123">**Преимущества для безопасности.** Этот новый компонент позволяет вам разделять вычислительный экземпляр от экземпляра хранилища.</span><span class="sxs-lookup"><span data-stu-id="7983e-123">**Security benefits:** This new enhancement allows you to separate a compute instance from a storage instance.</span></span> <span data-ttu-id="7983e-124">Кроме того, можно настроить полностью зашифрованную базу данных, расшифровка которой будет происходить только в вычислительном экземпляре, а не в экземпляре хранилища.</span><span class="sxs-lookup"><span data-stu-id="7983e-124">You can have a fully encrypted database with decryption only occurring on compute instance but not in a storage instance.</span></span> <span data-ttu-id="7983e-125">Другими словами, с помощью этого нового компонента можно шифровать все данные в общедоступном облаке с использованием сертификатов TDE (Transparent Data Encryption), которые физически отделены от данных.</span><span class="sxs-lookup"><span data-stu-id="7983e-125">In other words, using this new enhancement, you can encrypt all data in public cloud using Transparent Data Encryption (TDE)  certificates, which are physically separated from the data.</span></span> <span data-ttu-id="7983e-126">Ключи шифрования TDE могут храниться в базе данных master, которая размещена локально на физически безопасном локальном компьютере с локальным резервным копированием.</span><span class="sxs-lookup"><span data-stu-id="7983e-126">The TDE keys can be stored in the master database, which is stored locally in your physically secure on-premises machine and backed up locally.</span></span> <span data-ttu-id="7983e-127">Эти локальные ключи можно использовать для шифрования данных, которые находятся в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-127">You can use these local keys to encrypt the data, which resides in Azure Storage.</span></span> <span data-ttu-id="7983e-128">Если учетные данные учетной записи облачного хранилища украдены, данные останутся защищенными, поскольку сертификаты TDE всегда находятся на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="7983e-128">If your cloud storage account credentials are stolen, your data still stays secure as the TDE certificates always reside in on-premises.</span></span>  
  
## <a name="concepts-and-requirements"></a><span data-ttu-id="7983e-129">Основные понятия и требования</span><span class="sxs-lookup"><span data-stu-id="7983e-129">Concepts and Requirements</span></span>  
  
### <a name="azure-storage-concepts"></a><span data-ttu-id="7983e-130">Основные понятия хранения</span><span class="sxs-lookup"><span data-stu-id="7983e-130">Azure Storage Concepts</span></span>  
 <span data-ttu-id="7983e-131">При использовании компонента SQL Server Data Files в Azure необходимо создать учетную запись хранения и контейнер в Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-131">When using SQL Server Data Files in Azure feature, you need to create a storage account and a container in Azure.</span></span> <span data-ttu-id="7983e-132">Затем необходимо создать учетные данные SQL Server, которые включают сведения о политике контейнера, а также подпись общего доступа, необходимую для доступа к контейнеру.</span><span class="sxs-lookup"><span data-stu-id="7983e-132">Then, you need to create a SQL Server credential, which includes information on the policy of the container as well as a shared access signature that is necessary to access the container.</span></span>  
  
 <span data-ttu-id="7983e-133">В Azure учетная запись хранения представляет самый высокий уровень пространства имен для доступа к большим двоичным объектам.</span><span class="sxs-lookup"><span data-stu-id="7983e-133">In Azure, a storage account represents the highest level of the namespace for accessing Blobs.</span></span> <span data-ttu-id="7983e-134">Учетная запись хранилища может содержать неограниченное количество контейнеров при условии, что их общий размер не превышает 500 ТБ.</span><span class="sxs-lookup"><span data-stu-id="7983e-134">A storage account can contain an unlimited number of containers, as long as their total size is under 500 TB.</span></span> <span data-ttu-id="7983e-135">Последнюю информацию относительно ограничений хранилища смотрите в [Подписка и Ограничения Хранилища Azure, Квоты и Ограничения](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span><span class="sxs-lookup"><span data-stu-id="7983e-135">For the latest information on storage limits, see [Azure Subscription and Service Limits, Quotas, and Constraints](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span></span> <span data-ttu-id="7983e-136">Контейнер группирует набор больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="7983e-136">A container provides a grouping of a set of Blobs.</span></span> <span data-ttu-id="7983e-137">Все большие двоичные объекты должны находиться в контейнере.</span><span class="sxs-lookup"><span data-stu-id="7983e-137">All Blobs must be in a container.</span></span> <span data-ttu-id="7983e-138">Учетная запись может содержать неограниченное число контейнеров.</span><span class="sxs-lookup"><span data-stu-id="7983e-138">An account can contain an unlimited number of containers.</span></span> <span data-ttu-id="7983e-139">В контейнере также может храниться неограниченное количество больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="7983e-139">Similarly, a container can store an unlimited number of Blobs as well.</span></span> <span data-ttu-id="7983e-140">Существует два типа BLOB-объектов, которые могут храниться в хранилище Azure: блочные и страничные.</span><span class="sxs-lookup"><span data-stu-id="7983e-140">There are two types of blobs that can be stored in Azure Storage: block and page blobs.</span></span> <span data-ttu-id="7983e-141">Этот новый компонент использует страничные большие двоичные объекты, размер которых может быть до 1 ТБ и которые являются более эффективными в тех случаях, когда диапазоны байтов в файле часто изменяются.</span><span class="sxs-lookup"><span data-stu-id="7983e-141">This new feature uses Page blobs, which can be up to 1TB in size, and are more efficient when ranges of bytes in a file are modified frequently.</span></span> <span data-ttu-id="7983e-142">К большим двоичным объектам можно обращаться по URL-адресам в следующем формате: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span><span class="sxs-lookup"><span data-stu-id="7983e-142">You can access Blobs using the following URL format: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span></span>  
  
### <a name="azure-billing-considerations"></a><span data-ttu-id="7983e-143">Вопросы оплаты Azure</span><span class="sxs-lookup"><span data-stu-id="7983e-143">Azure Billing Considerations</span></span>  
 <span data-ttu-id="7983e-144">Оценка затрат на использование служб Azure — это важный вопрос, который необходимо учитывать в процессе принятия решения и планирования.</span><span class="sxs-lookup"><span data-stu-id="7983e-144">Estimating the cost of using Azure Services is an important matter in the decision making and planning process.</span></span> <span data-ttu-id="7983e-145">При хранении файлов данных SQL Server в хранилище Azure оплачивается стоимость использования хранилища и выполнения транзакций.</span><span class="sxs-lookup"><span data-stu-id="7983e-145">When storing SQL Server data files in Azure Storage, you need to pay costs associated with storage and transactions.</span></span> <span data-ttu-id="7983e-146">Кроме того, реализация компонента SQL Server Data Files в службе хранилища Azure требует неявного возобновления аренды большого двоичного объекта каждые 45–60 секунд.</span><span class="sxs-lookup"><span data-stu-id="7983e-146">In addition, the implementation of SQL Server Data Files in Azure Storage feature requires a renewal of Blob lease every 45 to 60 seconds implicitly.</span></span> <span data-ttu-id="7983e-147">При этом также возникают затраты на транзакции для каждого файла базы данных, например, MDF или LDF.</span><span class="sxs-lookup"><span data-stu-id="7983e-147">This also results in transaction costs per database file, such as .mdf or .ldf.</span></span> <span data-ttu-id="7983e-148">По нашим оценкам в соответствии с текущей моделью расценок стоимость продления аренды для двух файлов базы данных (MDF и LDF) составит около двух центов в месяц.</span><span class="sxs-lookup"><span data-stu-id="7983e-148">Based on our estimations, the cost of renewing leases for two database files (.mdf and .ldf) would be about 2 cents per month according to the current pricing model.</span></span> <span data-ttu-id="7983e-149">Рекомендуется использовать информацию на странице [Тарифы Azure](https://azure.microsoft.com/pricing/) для оценки ежемесячных затрат, связанных с использованием службы хранилища Azure и виртуальных машин Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-149">We recommend that you use the information on the [Azure Pricing](https://azure.microsoft.com/pricing/) page to help estimate the monthly costs associated with the use of Azure Storage and Azure Virtual Machines.</span></span>  
  
### <a name="sql-server-concepts"></a><span data-ttu-id="7983e-150">Основные понятия SQL Server</span><span class="sxs-lookup"><span data-stu-id="7983e-150">SQL Server Concepts</span></span>  
 <span data-ttu-id="7983e-151">При использовании этого нового компонента необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="7983e-151">When using this new enhancement, you are required to do the followings:</span></span>  
  
-   <span data-ttu-id="7983e-152">Необходимо создать политику для контейнера, а также сформировать ключ подписи общего доступа.</span><span class="sxs-lookup"><span data-stu-id="7983e-152">You must create a policy on a container and also generate a shared access signature (SAS) key.</span></span>  
  
-   <span data-ttu-id="7983e-153">Для каждого контейнера, используемого файлом данных или журнала, необходимо создать учетные данные SQL Server, имя которых соответствует пути контейнера.</span><span class="sxs-lookup"><span data-stu-id="7983e-153">For each container used by a data or a log file, you must create a SQL Server Credential whose name matches the container path.</span></span>  
  
-   <span data-ttu-id="7983e-154">Необходимо хранить сведения о контейнере службы хранилища Azure, связанную с ним политику и ключ SAS в хранилище учетных данных SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7983e-154">You must store the information regarding Azure Storage container, its associated policy name, and SAS key in the SQL Server credential store.</span></span>  
  
 <span data-ttu-id="7983e-155">В следующем примере предполагается, что контейнер хранилища Azure создан, а политика создана с помощью операций чтения, записи, списка и прав.</span><span class="sxs-lookup"><span data-stu-id="7983e-155">The following example assumes that an Azure Storage container has been created, and a policy has been created with read, write, list, rights.</span></span> <span data-ttu-id="7983e-156">При создании политики для контейнера формируется ключ SAS, который безопасно размещать в памяти в незашифрованном виде. SQL Server использует этот ключ для доступа к файлам больших двоичных объектов в контейнере.</span><span class="sxs-lookup"><span data-stu-id="7983e-156">Creating a policy on a container generates a SAS key which is safe to keep unencrypted in memory and needed by SQL Server to access the blob files in the container.</span></span> <span data-ttu-id="7983e-157">В следующем фрагменте кода замените `'your SAS key'` на запись следующего вида: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span><span class="sxs-lookup"><span data-stu-id="7983e-157">In the following code snippet, replace `'your SAS key'` with an entry similar to the following: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span></span> <span data-ttu-id="7983e-158">Дополнительные сведения см. [в разделе Создание и использование подписанного URL-доступа](https://msdn.microsoft.com/library/azure/jj721951.aspx) .</span><span class="sxs-lookup"><span data-stu-id="7983e-158">For more information, see [Create and Use a Shared Access Signature](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span></span>  
  
```sql
-- Create a credential  
CREATE CREDENTIAL [https://testdb.blob.core.windows.net/data]  
WITH IDENTITY='SHARED ACCESS SIGNATURE',  
SECRET = 'your SAS key'  
  
-- Create database with data and log files in Azure container.  
CREATE DATABASE testdb   
ON  
( NAME = testdb_dat,  
    FILENAME = 'https://testdb.blob.core.windows.net/data/TestData.mdf' )  
 LOG ON  
( NAME = testdb_log,  
    FILENAME =  'https://testdb.blob.core.windows.net/data/TestLog.ldf')
```  
  
> [!IMPORTANT]
> <span data-ttu-id="7983e-159">Если в контейнере имеются любые активные ссылки на файлы данных, попытки удаления соответствующих учетных данных SQL Server заканчиваются сбоем.</span><span class="sxs-lookup"><span data-stu-id="7983e-159">If there are any active references to data files in a container, attempts to delete the corresponding SQL Server credential fails.</span></span>  
  
### <a name="security"></a><span data-ttu-id="7983e-160">Безопасность</span><span class="sxs-lookup"><span data-stu-id="7983e-160">Security</span></span>  
 <span data-ttu-id="7983e-161">При хранении файлов данных SQL Server в службе хранилища Azure необходимо учитывать следующие требования и вопросы безопасности.</span><span class="sxs-lookup"><span data-stu-id="7983e-161">The following are security considerations and requirements when storing SQL Server Data Files in Azure Storage.</span></span>  
  
-   <span data-ttu-id="7983e-162">При создании контейнера для службы хранилища больших двоичных объектов Azure рекомендуется установить для него закрытые права доступа.</span><span class="sxs-lookup"><span data-stu-id="7983e-162">When creating a container for the Azure Blob storage service, we recommend that you set the access to private.</span></span> <span data-ttu-id="7983e-163">При выборе частного типа доступа данные контейнера и больших двоичных объектов могут быть прочитаны только владельцем учетной записи Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-163">When you set the access to private, container and blob data can be read by the Azure account owner only.</span></span>  
  
-   <span data-ttu-id="7983e-164">При хранении файлов базы данных SQL Server в службе хранилища Azure необходимо использовать подписанный URL-адрес (URI, который предоставляет ограниченные права доступа к контейнерам, большим двоичным объектам, очередям и таблицам).</span><span class="sxs-lookup"><span data-stu-id="7983e-164">When storing SQL Server database files in Azure Storage, you need to use a shared access signature, a URI that grants restricted access rights to containers, blobs, queues, and tables.</span></span> <span data-ttu-id="7983e-165">С помощью подписанного URL-адреса можно обеспечить SQL Server возможность доступа к ресурсам из учетной записи без предоставления доступа к ключу учетной записи службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-165">By using a shared access signature, you can enable SQL Server to access resources in your storage account without sharing your Azure storage account key.</span></span>  
  
-   <span data-ttu-id="7983e-166">Кроме того, рекомендуется продолжать использовать стандартные методы обеспечения безопасности локальных баз данных.</span><span class="sxs-lookup"><span data-stu-id="7983e-166">In addition, we recommend that you continue implementing the traditional on-premises security practices for your databases.</span></span>  
  
### <a name="installation-prerequisites"></a><span data-ttu-id="7983e-167">Предварительные требования для установки</span><span class="sxs-lookup"><span data-stu-id="7983e-167">Installation Prerequisites</span></span>  
 <span data-ttu-id="7983e-168">Ниже приведены предварительные требования к установке при хранении файлов данных SQL Server в Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-168">The followings are installation prerequisites when storing SQL Server Data Files in Azuree.</span></span>  
  
-   <span data-ttu-id="7983e-169">**Локальный SQL Server**. Версия SQL Server 2014 включает этот компонент.</span><span class="sxs-lookup"><span data-stu-id="7983e-169">**SQL Server on-premises:** SQL Server 2014 version includes this feature.</span></span> <span data-ttu-id="7983e-170">Чтобы узнать, как загрузить SQL Server 2014, см. раздел [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span><span class="sxs-lookup"><span data-stu-id="7983e-170">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
-   <span data-ttu-id="7983e-171">SQL Server, выполняемый на виртуальной машине Azure. Если вы устанавливаете SQL Server на виртуальную машину Azure, установите SQL Server 2014 или обновите существующий экземпляр.</span><span class="sxs-lookup"><span data-stu-id="7983e-171">SQL Server running in an Azure virtual machine: If you are installing SQL Server on an Azure Virtual Machine, install SQL Server 2014, or update your existing instance.</span></span> <span data-ttu-id="7983e-172">Аналогичным образом Вы также можете создать новую виртуальную машину в Azure с помощью образа платформы SQL Server 2014.</span><span class="sxs-lookup"><span data-stu-id="7983e-172">Similarly, you can also create a new virtual machine in Azure using SQL Server 2014 platform image.</span></span> <span data-ttu-id="7983e-173">Чтобы узнать, как загрузить SQL Server 2014, см. раздел [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span><span class="sxs-lookup"><span data-stu-id="7983e-173">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
###  <a name="limitations"></a><a name="bkmk_Limitations"></a> <span data-ttu-id="7983e-174">Ограничения</span><span class="sxs-lookup"><span data-stu-id="7983e-174">Limitations</span></span>  
  
-   <span data-ttu-id="7983e-175">В текущем выпуске этой функции хранение `FileStream` данных в службе хранилища Azure не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="7983e-175">In the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span> <span data-ttu-id="7983e-176">Данные можно хранить `Filestream` в интегрированной локальной базе данных службы хранилища Azure, но нельзя перемещать данные FILESTREAM между компьютерами с помощью службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-176">You can store `Filestream` data in an Azure Storage integrated local database but you cannot move Filestream data between machines using Azure Storage.</span></span> <span data-ttu-id="7983e-177">Для данных типа `FileStream` рекомендуется продолжать использовать стандартные методы переноса файлов MDF и LDF, связанных с Filestream, между разными компьютерами.</span><span class="sxs-lookup"><span data-stu-id="7983e-177">For `FileStream` data, we recommend that you continue using the traditional techniques to move the files (.mdf, .ldf) associated with Filestream between different machines.</span></span>  
  
-   <span data-ttu-id="7983e-178">Сейчас этот новый модуль не поддерживает одновременный доступ нескольких экземпляров SQL Server к одним и тем же файлам базы данных в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-178">Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="7983e-179">Если ServerA находится в сети с активным файлом базы данных, а ServerB будет случайно запущен и при этом на нем тоже есть база данных, указывающая на тот же файл данных, второй сервер не сможет запустить базу данных и вернет код ошибки **5120. Не удается открыть физический файл "%.\*ls". Ошибка операционной системы %d: "%ls"** .</span><span class="sxs-lookup"><span data-stu-id="7983e-179">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error code **5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"**.</span></span>  
  
-   <span data-ttu-id="7983e-180">Только MDF-, LDF- и NDF-файлы могут храниться в службе хранилища Azure с использованием компонента SQL Server Data Files в Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-180">Only .mdf, .ldf, and .ndf files can be stored in Azure Storage by using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="7983e-181">При использовании компонента SQL Server Data Files в Azure георепликация для учетной записи не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="7983e-181">When using the SQL Server Data Files in Azure feature, geo-replication for your storage account is not supported.</span></span> <span data-ttu-id="7983e-182">Если в учетной записи работает георепликация и была выполнена географическая отработка отказа, может произойти повреждение базы данных.</span><span class="sxs-lookup"><span data-stu-id="7983e-182">If a storage account is geo-replicated and a geo-failover happened, database corruption could occur.</span></span>  
  
-   <span data-ttu-id="7983e-183">Размер каждого большого двоичного объекта может быть вплоть до 1 ТБ.</span><span class="sxs-lookup"><span data-stu-id="7983e-183">Each Blob can be up to maximum 1 TB in size.</span></span> <span data-ttu-id="7983e-184">Это значение формирует верхний предел для отдельных файлов данных и файлов журнала базы данных, которые могут храниться в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-184">This creates an upper limit on individual database data and log files that can be stored in Azure Storage.</span></span>  
  
-   <span data-ttu-id="7983e-185">Невозможно сохранить данные выполняющейся в памяти OLTP в большом двоичном объекте Azure с помощью компонента SQL Server Data Files в Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-185">It is not possible to store In-Memory OLTP data in Azure Blob using the SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="7983e-186">Это связано с тем, что выполняющаяся в памяти OLTP зависит от `FileStream` и, в текущем выпуске этой функции хранение `FileStream` данных в службе хранилища Azure не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="7983e-186">This is because In-Memory OLTP has a dependency on `FileStream` and, in the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span>  
  
-   <span data-ttu-id="7983e-187">При использовании SQL Server Data Files в Azure SQL Server выполняет все сравнения URL-адресов или путей к файлам, используя параметры сортировки, заданные в `master` базе данных.</span><span class="sxs-lookup"><span data-stu-id="7983e-187">When using SQL Server Data Files in Azure feature, SQL Server performs all URL or file path comparisons using the Collation set in the `master` database.</span></span>  
  
-   <span data-ttu-id="7983e-188">`AlwaysOn Availability Groups` поддерживается до тех пор, пока в основную базу данных не будут добавлены новые файлы базы данных.</span><span class="sxs-lookup"><span data-stu-id="7983e-188">`AlwaysOn Availability Groups` are supported as long as you do not add new database files to the primary database.</span></span> <span data-ttu-id="7983e-189">Если для выполнения операции базы данных требуется создание нового файла в базе данных-источнике, сначала отключите группы доступности AlwaysOn на вторичном узле.</span><span class="sxs-lookup"><span data-stu-id="7983e-189">If a database operation requires a new file to be created in the primary database, first disable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="7983e-190">Затем выполните операцию базы данных в базе данных-источнике и создайте резервную копию базы данных на основном узле.</span><span class="sxs-lookup"><span data-stu-id="7983e-190">Then, perform the database operation on the primary database and backup the database in the primary node.</span></span> <span data-ttu-id="7983e-191">Затем восстановите базу данных на вторичный узел и включите группы доступности AlwaysOn на вторичном узле.</span><span class="sxs-lookup"><span data-stu-id="7983e-191">Next, restore the database to the secondary node, and enable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="7983e-192">Обратите внимание, что экземпляры отказоустойчивого кластера AlwaysOn не поддерживаются при использовании компонента SQL Server Data Files в Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-192">Note that AlwaysOn Failover Cluster Instances is not supported when using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="7983e-193">При обычной работе SQL Server использует временные аренды, чтобы зарезервировать большие двоичные объекты для хранения с возобновлением аренды каждого большого двоичного объекта каждые 45–60 секунд.</span><span class="sxs-lookup"><span data-stu-id="7983e-193">During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="7983e-194">Если происходит сбой сервера и запускается другой экземпляр SQL Server, который настроен для использования тех же больших двоичных объектов, новый экземпляр будет ждать окончания аренды для большого двоичного объекта вплоть до 60 секунд.</span><span class="sxs-lookup"><span data-stu-id="7983e-194">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="7983e-195">Если необходимо присоединить базу данных к другому экземпляру и ждать окончания срока аренды в течение 60 секунд невозможно, то можно явно прервать аренду большого двоичного объекта, чтобы избежать сбоев операций присоединения.</span><span class="sxs-lookup"><span data-stu-id="7983e-195">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
## <a name="tools-and-programming-reference-support"></a><span data-ttu-id="7983e-196">Средства и справочник по программированию</span><span class="sxs-lookup"><span data-stu-id="7983e-196">Tools and programming reference support</span></span>  
 <span data-ttu-id="7983e-197">В этом разделе описаны средства и библиотеки справочных материалов по программированию, которые можно использовать при хранении файлов данных SQL Server в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-197">This section describes which tools and programming reference libraries can be used when storing SQL Server data files in Azure Storage.</span></span>  
  
### <a name="powershell-support"></a><span data-ttu-id="7983e-198">Поддержка PowerShell</span><span class="sxs-lookup"><span data-stu-id="7983e-198">PowerShell support</span></span>  
 <span data-ttu-id="7983e-199">В SQL Server 2014 можно использовать командлеты PowerShell для хранения файлов данных SQL Server в службе хранилища больших двоичных объектов Azure, ссылаясь на путь URL-адреса хранилища больших двоичных объектов вместо пути к файлу.</span><span class="sxs-lookup"><span data-stu-id="7983e-199">In SQL Server 2014, you can use PowerShell cmdlets to store SQL Server data files in Azure Blob Storage service by referencing a Blob Storage URL path instead of a file path.</span></span> <span data-ttu-id="7983e-200">К большим двоичным объектам можно обращаться по URL-адресам в следующем формате`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span><span class="sxs-lookup"><span data-stu-id="7983e-200">You can access Blobs using the following URL format`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span></span>  
  
### <a name="sql-server-object-and-performance-counters-support"></a><span data-ttu-id="7983e-201">Объект SQL Server и поддержка счетчиков производительности</span><span class="sxs-lookup"><span data-stu-id="7983e-201">SQL Server Object and performance counters support</span></span>  
 <span data-ttu-id="7983e-202">Начиная с SQL Server 2014, добавлен новый объект SQL Server для использования с компонентом SQL Server Data Files в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-202">Starting with SQL Server 2014, a new SQL Server object has been added to be used with SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="7983e-203">Новый объект SQL Server вызывается как [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) и может использоваться системным монитором для отслеживания действий, выполняемых при работе SQL Server со службой хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-203">The new SQL Server object is called as [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) and it can be used by System Monitor to monitor activity when running SQL Server with Azure Storage.</span></span>  
  
### <a name="sql-server-management-studio-support"></a><span data-ttu-id="7983e-204">Поддержка среды SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="7983e-204">SQL Server Management Studio support</span></span>  
 <span data-ttu-id="7983e-205">Среда SQL Server Management Studio позволяет использовать этот компонент с помощью нескольких диалоговых окон.</span><span class="sxs-lookup"><span data-stu-id="7983e-205">SQL Server Management Studio allows you to use this feature via several dialog windows.</span></span> <span data-ttu-id="7983e-206">Например, можно ввести URL-адрес контейнера хранилища, скажем, `https://teststorageaccnt.blob.core.windows.net/testcontainer/` в поле **Путь** в нескольких разных диалоговых окнах ( **Создание базы данных**, **Присоединение базы данных**и **Восстановление базы данных**).</span><span class="sxs-lookup"><span data-stu-id="7983e-206">For example, you can type the URL path of the storage container, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/` as a **Path** in several dialog windows, such as **New Database**, **Attach Database**, and **Restore Database**.</span></span> <span data-ttu-id="7983e-207">Дополнительные сведения см. [в разделе Учебник. SQL Server файлы данных в службе хранилища Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="7983e-207">For more information, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
### <a name="sql-server-management-objects-support"></a><span data-ttu-id="7983e-208">Поддержка управляющих объектов SQL Server</span><span class="sxs-lookup"><span data-stu-id="7983e-208">SQL Server Management Objects support</span></span>  
 <span data-ttu-id="7983e-209">При использовании компонента SQL Server Data Files в Azure поддерживаются все управляющие объекты SQL Server (SMO).</span><span class="sxs-lookup"><span data-stu-id="7983e-209">When using the SQL Server Data Files in Azure feature, all SQL Server Management Objects (SMO) are supported.</span></span> <span data-ttu-id="7983e-210">Если объект SMO требует пути к файлам, вместо локального пути используйте формат URL-адреса большого двоичного объекта, например `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span><span class="sxs-lookup"><span data-stu-id="7983e-210">If an SMO object requires a file path, use the BLOB URL format instead of a local file path, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span></span> <span data-ttu-id="7983e-211">Дополнительные сведения об управляющих объектах SQL Server (SMO) см. в разделе [Учебник по программированию управляющих объектов SQL Server (SMO)](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) электронной документации по SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7983e-211">For more information about SQL Server Management Objects (SMO), see [SQL Server Management Objects &#40;SMO&#41; Programming Guide](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) in SQL Server Books Online.</span></span>  
  
### <a name="transact-sql-support"></a><span data-ttu-id="7983e-212">Поддержка Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="7983e-212">Transact-SQL support</span></span>  
 <span data-ttu-id="7983e-213">Этот новый компонент внес следующие изменения в контактную зону Transact-SQL:</span><span class="sxs-lookup"><span data-stu-id="7983e-213">This new feature has introduced the following change in the Transact-SQL surface area:</span></span>  
  
-   <span data-ttu-id="7983e-214">Новый столбец **int** , **credential_id**, в системном представлении **sys.master_files** .</span><span class="sxs-lookup"><span data-stu-id="7983e-214">A new **int** column, **credential_id**, in the **sys.master_files** system view.</span></span> <span data-ttu-id="7983e-215">Столбец **credential_id** используется для обеспечения указания перекрестных ссылок на файлы данных из хранилища Azure назад в представление sys.credentials для учетных данных, созданных для них.</span><span class="sxs-lookup"><span data-stu-id="7983e-215">The **credential_id** column is used to enable Azure Storage enabled data files to be cross-referenced back to sys.credentials for the credentials created for them.</span></span> <span data-ttu-id="7983e-216">Это можно использовать для устранения неполадок, например, когда невозможно удалить учетные данные при наличии файла базы данных, который использует их.</span><span class="sxs-lookup"><span data-stu-id="7983e-216">You can use it for troubleshooting, such as a credential cannot be deleted when there is a database file which uses it.</span></span>  
  
##  <a name="troubleshooting-for-sql-server-data-files-in-azure"></a><a name="bkmk_Troubleshooting"></a><span data-ttu-id="7983e-217">Устранение неполадок в файлах данных SQL Server в Azure</span><span class="sxs-lookup"><span data-stu-id="7983e-217">Troubleshooting for SQL Server Data Files in Azure</span></span>  
 <span data-ttu-id="7983e-218">Для избежания ошибок в связи с не поддерживаемыми функциями или ограничениями, обратитесь сначала к [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span><span class="sxs-lookup"><span data-stu-id="7983e-218">To avoid errors due to unsupported features or limitations, first review [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span></span>  
  
 <span data-ttu-id="7983e-219">Далее приведен список ошибок, которые могут быть получены при использовании SQL Server Data Files в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-219">The list of errors that you might get when using the SQL Server Data Files in Azure Storage feature are as follows.</span></span>  
  
 <span data-ttu-id="7983e-220">**Ошибки проверки подлинности**</span><span class="sxs-lookup"><span data-stu-id="7983e-220">**Authentication errors**</span></span>  
  
-   <span data-ttu-id="7983e-221">*Невозможно удалить учетные данные "%.\*ls", так как они используются активным файлом базы данных.*  </span><span class="sxs-lookup"><span data-stu-id="7983e-221">*Cannot drop the credential '%.\*ls' because it is used by an active database file.* </span></span>  
    <span data-ttu-id="7983e-222">Способы устранения: Эта ошибка отображается при попытке удалить учетные данные, которые используются активным файлом базы данных в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-222">Resolution: You may see this error when you try to drop a credential that is still being used by an active database file in Azure Storage.</span></span> <span data-ttu-id="7983e-223">Чтобы удалить учетные данные, необходимо сначала удалить сопоставленный большой двоичный объект, которому принадлежит этот файл базы данных.</span><span class="sxs-lookup"><span data-stu-id="7983e-223">To drop the credential, first you must delete the associated blob that has this database file.</span></span> <span data-ttu-id="7983e-224">Чтобы удалить большой двоичный объект с активной арендой, сначала необходимо прервать аренду.</span><span class="sxs-lookup"><span data-stu-id="7983e-224">To delete a blob that has an active lease, you must first break the lease.</span></span>  
  
-   <span data-ttu-id="7983e-225">*Подписанный URL-адрес был создан в контейнере неправильно.*  </span><span class="sxs-lookup"><span data-stu-id="7983e-225">*Shared Access Signature has not been created on the container correctly.* </span></span>  
     <span data-ttu-id="7983e-226">Способы устранения: Убедитесь, что вы создали подпись общего доступа для контейнера правильно.</span><span class="sxs-lookup"><span data-stu-id="7983e-226">Resolution: Make sure that you have created a Shared Access Signature on the container correctly.</span></span> <span data-ttu-id="7983e-227">Ознакомьтесь с инструкциями, приведенными в занятии 2 в разделе [учебник. SQL Server файлы данных в службе хранилища Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="7983e-227">Review the instructions given in Lesson 2 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
-   <span data-ttu-id="7983e-228">*Учетные данные SQL Server созданы неправильно.*  </span><span class="sxs-lookup"><span data-stu-id="7983e-228">*SQL Server credential has not been not created correctly.* </span></span>  
    <span data-ttu-id="7983e-229">Способы устранения: Убедитесь, что в поле **Идентификатор** указано значение "Подписанный URL-адрес" и секрет сформирован правильно.</span><span class="sxs-lookup"><span data-stu-id="7983e-229">Resolution: Make sure that you have used 'Shared Access Signature' for the **Identity** field and created a secret correctly.</span></span> <span data-ttu-id="7983e-230">Ознакомьтесь с инструкциями, приведенными в занятии 3 раздела [учебник. SQL Server Data Files в службе хранилища Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="7983e-230">Review the instructions given in Lesson 3 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="7983e-231">**Ошибки аренды больших двоичных объектов**</span><span class="sxs-lookup"><span data-stu-id="7983e-231">**Lease blob errors:**</span></span>  
  
-   <span data-ttu-id="7983e-232">Ошибка при попытке запустить SQL Server после сбоя другого экземпляра, использующего те же файлы больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="7983e-232">Error when trying to start SQL Server after another instance using the same blob files has crashed.</span></span> <span data-ttu-id="7983e-233">Решение. При обычной работе SQL Server использует временные аренды, чтобы зарезервировать большие двоичные объекты для хранения с возобновлением аренды каждого большого двоичного объекта каждые 45–60 секунд.</span><span class="sxs-lookup"><span data-stu-id="7983e-233">Resolution: During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="7983e-234">Если происходит сбой сервера и запускается другой экземпляр SQL Server, который настроен для использования тех же больших двоичных объектов, новый экземпляр будет ждать окончания аренды для большого двоичного объекта вплоть до 60 секунд.</span><span class="sxs-lookup"><span data-stu-id="7983e-234">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="7983e-235">Если необходимо присоединить базу данных к другому экземпляру и ждать окончания срока аренды в течение 60 секунд невозможно, то можно явно прервать аренду большого двоичного объекта, чтобы избежать сбоев операций присоединения.</span><span class="sxs-lookup"><span data-stu-id="7983e-235">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
 <span data-ttu-id="7983e-236">**Ошибки базы данных**</span><span class="sxs-lookup"><span data-stu-id="7983e-236">**Database errors**</span></span>  
  
1.  <span data-ttu-id="7983e-237">*Ошибка создания базы данных* </span><span class="sxs-lookup"><span data-stu-id="7983e-237">*Errors when creating a database* </span></span>  
    <span data-ttu-id="7983e-238">Решение. Ознакомьтесь с инструкциями, приведенными в занятии 4 [руководства по SQL Server файлов данных в службе хранилища Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="7983e-238">Resolution: Review the instructions given in Lesson 4 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
2.  <span data-ttu-id="7983e-239">*Ошибки при выполнении инструкции Alter* </span><span class="sxs-lookup"><span data-stu-id="7983e-239">*Errors when running the Alter statement* </span></span>  
    <span data-ttu-id="7983e-240">Способы устранения: Инструкцию Alter необходимо выполнять, когда база данных находится в режиме "в сети".</span><span class="sxs-lookup"><span data-stu-id="7983e-240">Resolution: Make sure to execute the Alter Database statement when the database is online.</span></span> <span data-ttu-id="7983e-241">При копировании файлов данных в службу хранилища Azure всегда создавайте страничный, а не блочный большой двоичный объект.</span><span class="sxs-lookup"><span data-stu-id="7983e-241">When copying the data files to Azure Storage, always create a page blob not a block blob.</span></span> <span data-ttu-id="7983e-242">В противном случае инструкция ALTER для базы данных завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="7983e-242">Otherwise, ALTER Database will fail.</span></span> <span data-ttu-id="7983e-243">Ознакомьтесь с инструкциями, приведенными в занятии 7 в разделе [учебник. SQL Server файлы данных в службе хранилища Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="7983e-243">Review the instructions given in Lesson 7 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
3.  <span data-ttu-id="7983e-244">*Код ошибки 5120: не удалось открыть физический файл "%. \* Ls». Ошибка операционной системы% d: "% ls"* </span><span class="sxs-lookup"><span data-stu-id="7983e-244">*Error code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"* </span></span>  
    <span data-ttu-id="7983e-245">Способы устранения: Сейчас этот новый модуль не поддерживает одновременный доступ нескольких экземпляров SQL Server к одним и тем же файлам базы данных в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-245">Resolution: Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="7983e-246">Если ServerA находится в сети с активным файлом базы данных, а ServerB будет случайно запущен и при этом на нем тоже есть база данных, указывающая на тот же файл данных, второй сервер не сможет запустить базу данных и вернет код ошибки *5120. Не удается открыть физический файл "%.\*ls". Ошибка операционной системы %d: "%ls"* .</span><span class="sxs-lookup"><span data-stu-id="7983e-246">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error *code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"*.</span></span>  
  
     <span data-ttu-id="7983e-247">Чтобы устранить эту проблему, необходимо сначала определить, есть ли у ServerA доступ к файлу базы данных, который находится в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-247">To resolve this issue, first determine if you need ServerA to access the database file in Azure Storage or not.</span></span> <span data-ttu-id="7983e-248">Если нет, просто удалите все связи между ServerA и файлами базы данных из службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="7983e-248">If not, simply remove any connection between ServerA and the database files in Azure Storage.</span></span> <span data-ttu-id="7983e-249">Для этого выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="7983e-249">To do this, follow these steps:</span></span>  
  
    1.  <span data-ttu-id="7983e-250">С помощью инструкции ALTER установите для ServerA пути к файлам из локальных папок.</span><span class="sxs-lookup"><span data-stu-id="7983e-250">Set the file path of Server A to a local folder by using the ALTER Database statement.</span></span>  
  
    2.  <span data-ttu-id="7983e-251">Переведите базу данных на ServerA в режим «вне сети».</span><span class="sxs-lookup"><span data-stu-id="7983e-251">Set the database offline in Server A.</span></span>  
  
    3.  <span data-ttu-id="7983e-252">Затем скопируйте файлы базы данных из службы хранилища Azure в локальную папку на ServerA. Это гарантирует, что ServerA по-прежнему будет иметь локальную копию базы данных.</span><span class="sxs-lookup"><span data-stu-id="7983e-252">Then, copy database files from Azure Storage to the local folder in Server A. This ensures that ServerA still has a copy of the database locally.</span></span>  
  
    4.  <span data-ttu-id="7983e-253">Переведите базу данных в режим «в сети».</span><span class="sxs-lookup"><span data-stu-id="7983e-253">Set the database online.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7983e-254">См. также:</span><span class="sxs-lookup"><span data-stu-id="7983e-254">See Also</span></span>  
 [<span data-ttu-id="7983e-255">Руководство по Файлы данных SQL Server в службе хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="7983e-255">Tutorial: SQL Server Data Files in Azure Storage service</span></span>](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)  
