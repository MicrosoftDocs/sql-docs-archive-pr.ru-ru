---
title: Перестроение системных баз данных | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- master database [SQL Server], rebuilding
- REBUILDDATABASE parameter
- rebuilding databases, master
- system databases [SQL Server], rebuilding
ms.assetid: af457ecd-523e-4809-9652-bdf2e81bd876
author: stevestein
ms.author: sstein
ms.openlocfilehash: 5f695589fa0fc1b86d4433d36afa1bc6357aabd6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87658810"
---
# <a name="rebuild-system-databases"></a><span data-ttu-id="ca1dd-102">Перестроение системных баз данных</span><span class="sxs-lookup"><span data-stu-id="ca1dd-102">Rebuild System Databases</span></span>
  <span data-ttu-id="ca1dd-103">Системные базы данных необходимо перестроить, чтобы устранить повреждения данных в системных базах данных [master](master-database.md), [model](model-database.md), [msdb](msdb-database.md)и [resource](resource-database.md) или изменить параметры сортировки по умолчанию на уровне сервера.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-103">System databases must be rebuilt to fix corruption problems in the [master](master-database.md), [model](model-database.md), [msdb](msdb-database.md), or [resource](resource-database.md) system databases or to modify the default server-level collation.</span></span> <span data-ttu-id="ca1dd-104">В этом разделе приводятся пошаговые инструкции по перестроению системных баз данных в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ca1dd-104">This topic provides step-by-step instructions to rebuild system databases in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>  
  
 <span data-ttu-id="ca1dd-105">**В этом разделе**</span><span class="sxs-lookup"><span data-stu-id="ca1dd-105">**In This Topic**</span></span>  
  
-   <span data-ttu-id="ca1dd-106">**Перед началом работы**</span><span class="sxs-lookup"><span data-stu-id="ca1dd-106">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="ca1dd-107">Ограничения</span><span class="sxs-lookup"><span data-stu-id="ca1dd-107">Limitations and Restrictions</span></span>](#Restrictions)  
  
     [<span data-ttu-id="ca1dd-108">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="ca1dd-108">Prerequisites</span></span>](#Prerequisites)  
  
-   <span data-ttu-id="ca1dd-109">**Процедуры**</span><span class="sxs-lookup"><span data-stu-id="ca1dd-109">**Procedures:**</span></span>  
  
     [<span data-ttu-id="ca1dd-110">Перестроение системных баз данных</span><span class="sxs-lookup"><span data-stu-id="ca1dd-110">Rebuild System Databases</span></span>](#RebuildProcedure)  
  
     [<span data-ttu-id="ca1dd-111">Перестроение базы данных Resource</span><span class="sxs-lookup"><span data-stu-id="ca1dd-111">Rebuild the resource Database</span></span>](#Resource)  
  
     [<span data-ttu-id="ca1dd-112">Создание новой базы данных msdb</span><span class="sxs-lookup"><span data-stu-id="ca1dd-112">Create a New msdb Database</span></span>](#CreateMSDB)  
  
-   <span data-ttu-id="ca1dd-113">**Дальнейшие действия.**</span><span class="sxs-lookup"><span data-stu-id="ca1dd-113">**Follow Up:**</span></span>  
  
     [<span data-ttu-id="ca1dd-114">Устранение ошибок перестроения</span><span class="sxs-lookup"><span data-stu-id="ca1dd-114">Troubleshoot Rebuild Errors</span></span>](#Troubleshoot)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="ca1dd-115">Перед началом</span><span class="sxs-lookup"><span data-stu-id="ca1dd-115">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="ca1dd-116">Ограничения</span><span class="sxs-lookup"><span data-stu-id="ca1dd-116">Limitations and Restrictions</span></span>  
 <span data-ttu-id="ca1dd-117">При перестроении системных баз данных master, model, msdb и tempdb эти базы данных удаляются и создаются повторно в исходном расположении.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-117">When the master, model, msdb, and tempdb system databases are rebuilt, the databases are dropped and re-created in their original location.</span></span> <span data-ttu-id="ca1dd-118">Если в инструкции перестроения заданы новые параметры сортировки, системные базы данных создаются с этими параметрами.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-118">If a new collation is specified in the rebuild statement, the system databases are created using that collation setting.</span></span> <span data-ttu-id="ca1dd-119">Все пользовательские изменения этих баз данных будут потеряны.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-119">Any user modifications to these databases are lost.</span></span> <span data-ttu-id="ca1dd-120">Например, в базе данных master могут содержаться пользовательские объекты, в базе данных msdb — запланированные задания, а в базе данных model — изменения исходных параметров баз данных.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-120">For example, you may have user-defined objects in the master database, scheduled jobs in msdb, or changes to the default database settings in the model database.</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="ca1dd-121">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="ca1dd-121">Prerequisites</span></span>  
 <span data-ttu-id="ca1dd-122">Перед перестроением системных баз данных выполните следующие задачи, чтобы иметь возможность восстановить текущие параметры системных баз данных.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-122">Perform the following tasks before you rebuild the system databases to ensure that you can restore the system databases to their current settings.</span></span>  
  
1.  <span data-ttu-id="ca1dd-123">Зарегистрируйте все значения конфигурации на уровне сервера.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-123">Record all server-wide configuration values.</span></span>  
  
    ```  
    SELECT * FROM sys.configurations;  
    ```  
  
2.  <span data-ttu-id="ca1dd-124">Зарегистрируйте все пакеты обновления и исправления, примененные к экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , и текущие параметры сортировки.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-124">Record all service packs and hotfixes applied to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and the current collation.</span></span> <span data-ttu-id="ca1dd-125">Эти обновления необходимо применить после перестроения системных баз данных.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-125">You must reapply these updates after rebuilding the system databases.</span></span>  
  
    ```  
    SELECT  
    SERVERPROPERTY('ProductVersion ') AS ProductVersion,  
    SERVERPROPERTY('ProductLevel') AS ProductLevel,  
    SERVERPROPERTY('ResourceVersion') AS ResourceVersion,  
    SERVERPROPERTY('ResourceLastUpdateDateTime') AS ResourceLastUpdateDateTime,  
    SERVERPROPERTY('Collation') AS Collation;  
    ```  
  
3.  <span data-ttu-id="ca1dd-126">Зарегистрируйте текущее расположение всех файлов данных и журналов для системных баз данных.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-126">Record the current location of all data and log files for the system databases.</span></span> <span data-ttu-id="ca1dd-127">При перестроении системных баз данных они устанавливаются в исходное расположение.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-127">Rebuilding the system databases installs all system databases to their original location.</span></span> <span data-ttu-id="ca1dd-128">Если системные файлы данных и журналов были перемещены в другие расположения, необходимо вернуть их в исходное место.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-128">If you have moved system database data or log files to a different location, you must move the files again.</span></span>  
  
    ```  
    SELECT name, physical_name AS current_file_location  
    FROM sys.master_files  
    WHERE database_id IN (DB_ID('master'), DB_ID('model'), DB_ID('msdb'), DB_ID('tempdb'));  
    ```  
  
4.  <span data-ttu-id="ca1dd-129">Найдите текущую резервную копию баз данных master, model и msdb.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-129">Locate the current backup of the master, model, and msdb databases.</span></span>  
  
5.  <span data-ttu-id="ca1dd-130">Если экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] настроен как распространитель репликации, найдите текущую резервную копию базы данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-130">If the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is configured as a replication Distributor, locate the current backup of the distribution database.</span></span>  
  
6.  <span data-ttu-id="ca1dd-131">Убедитесь, что имеются соответствующие разрешения для перестроения системных баз данных.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-131">Ensure you have appropriate permissions to rebuild the system databases.</span></span> <span data-ttu-id="ca1dd-132">Чтобы выполнить эту операцию, необходимо быть членом предопределенной роли сервера `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-132">To perform this operation, you must be a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="ca1dd-133">Дополнительные сведения см. в статье [Роли уровня сервера](../security/authentication-access/server-level-roles.md).</span><span class="sxs-lookup"><span data-stu-id="ca1dd-133">For more information, see [Server-Level Roles](../security/authentication-access/server-level-roles.md).</span></span>  
  
7.  <span data-ttu-id="ca1dd-134">Проверьте, имеются ли на локальном сервере копии шаблонов для файлов данных и файлов журналов баз данных master, model и msdb.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-134">Verify that copies of the master, model, msdb data and log template files exist on the local server.</span></span> <span data-ttu-id="ca1dd-135">Расположение по умолчанию для файлов шаблонов — C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\Binn\Templates.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-135">The default location for the template files is C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\Binn\Templates.</span></span> <span data-ttu-id="ca1dd-136">Эти файлы используются во время перестроения и должны присутствовать для успешного завершения программы установки.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-136">These files are used during the rebuild process and must be present for Setup to succeed.</span></span> <span data-ttu-id="ca1dd-137">Если они отсутствуют, используйте функцию исправления программы установки или вручную скопируйте их с установочного носителя.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-137">If they are missing, run the Repair feature of Setup, or manually copy the files from your installation media.</span></span> <span data-ttu-id="ca1dd-138">Чтобы найти эти файлы на установочном носителе, перейдите в каталог, соответствующий платформе (x86 или x64), а затем в папку setup\sql_engine_core_inst_msi\Pfiles\SqlServr\MSSQL.X\MSSQL\Binn\Templates.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-138">To locate the files on the installation media, navigate to the appropriate platform directory (x86 or x64) and then navigate to setup\sql_engine_core_inst_msi\Pfiles\SqlServr\MSSQL.X\MSSQL\Binn\Templates.</span></span>  
  
##  <a name="rebuild-system-databases"></a><a name="RebuildProcedure"></a> <span data-ttu-id="ca1dd-139">Перестроение системных баз данных</span><span class="sxs-lookup"><span data-stu-id="ca1dd-139">Rebuild System Databases</span></span>  
 <span data-ttu-id="ca1dd-140">Следующая процедура перестраивает системные базы данных master, model, msdb и tempdb.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-140">The following procedure rebuilds the master, model, msdb, and tempdb system databases.</span></span> <span data-ttu-id="ca1dd-141">Нельзя выбрать, какие системные базы данных будут перестраиваться.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-141">You cannot specify the system databases to be rebuilt.</span></span> <span data-ttu-id="ca1dd-142">Для кластеризованных экземпляров эту процедуру необходимо выполнить на активном узле, а ресурс [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в соответствующей группе приложений кластера перед ее выполнением должен быть переведен в состояние «вне сети».</span><span class="sxs-lookup"><span data-stu-id="ca1dd-142">For clustered instances, this procedure must be performed on the active node and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] resource in the corresponding cluster application group must be taken offline before performing the procedure.</span></span>  
  
 <span data-ttu-id="ca1dd-143">Эта процедура не перестраивает базу данных resource.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-143">This procedure does not rebuild the resource database.</span></span> <span data-ttu-id="ca1dd-144">См. раздел «Процедура перестроения базы данных resource» ниже.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-144">See the section, "Rebuild the resource Database Procedure" later in this topic.</span></span>  
  
#### <a name="to-rebuild-system-databases-for-an-instance-of-sql-server"></a><span data-ttu-id="ca1dd-145">Перестроение системных баз данных для экземпляра SQL Server:</span><span class="sxs-lookup"><span data-stu-id="ca1dd-145">To rebuild system databases for an instance of SQL Server:</span></span>  
  
1.  <span data-ttu-id="ca1dd-146">Вставьте в дисковод установочный носитель [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] или введите в командной строке путь к файлу setup.exe на локальном сервере.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-146">Insert the [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] installation media into the disk drive, or, from a command prompt, change directories to the location of the setup.exe file on the local server.</span></span> <span data-ttu-id="ca1dd-147">По умолчанию он расположен на сервере в каталоге C:\Program Files\Microsoft SQL Server\120\Setup Bootstrap\Release.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-147">The default location on the server is C:\Program Files\Microsoft SQL Server\120\Setup Bootstrap\Release.</span></span>  
  
2.  <span data-ttu-id="ca1dd-148">В командной строке введите следующую команду.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-148">From a command prompt window, enter the following command.</span></span> <span data-ttu-id="ca1dd-149">Квадратные скобки указывают, что параметр необязателен.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-149">Square brackets are used to indicate optional parameters.</span></span> <span data-ttu-id="ca1dd-150">Квадратные скобки не вводятся.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-150">Do not enter the brackets.</span></span> <span data-ttu-id="ca1dd-151">В операционной системе Windows с включенным контролем учетных записей (UAC) запуск программы установки требует повышенных прав доступа.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-151">When using a Windows operating system that has User Account Control (UAC) enabled, running Setup requires elevated privileges.</span></span> <span data-ttu-id="ca1dd-152">Команда в командной строке должна выполняться от имени администратора.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-152">The command prompt must be run as Administrator.</span></span>  
  
     `Setup /QUIET /ACTION=REBUILDDATABASE /INSTANCENAME=InstanceName /SQLSYSADMINACCOUNTS=accounts [ /SAPWD= StrongPassword ] [ /SQLCOLLATION=CollationName]`  
  
    |<span data-ttu-id="ca1dd-153">Имя параметра</span><span class="sxs-lookup"><span data-stu-id="ca1dd-153">Parameter name</span></span>|<span data-ttu-id="ca1dd-154">Описание</span><span class="sxs-lookup"><span data-stu-id="ca1dd-154">Description</span></span>|  
    |--------------------|-----------------|  
    |<span data-ttu-id="ca1dd-155">/QUIET или /Q</span><span class="sxs-lookup"><span data-stu-id="ca1dd-155">/QUIET or /Q</span></span>|<span data-ttu-id="ca1dd-156">Указывает, что программа установки будет работать без пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-156">Specifies that Setup run without any user interface.</span></span>|  
    |<span data-ttu-id="ca1dd-157">/ACTION=REBUILDDATABASE</span><span class="sxs-lookup"><span data-stu-id="ca1dd-157">/ACTION=REBUILDDATABASE</span></span>|<span data-ttu-id="ca1dd-158">Указывает, что программа установки создает системные базы данных заново.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-158">Specifies that Setup re-create the system databases.</span></span>|  
    |<span data-ttu-id="ca1dd-159">/INSTANCENAME=*имя_экземпляра*</span><span class="sxs-lookup"><span data-stu-id="ca1dd-159">/INSTANCENAME=*InstanceName*</span></span>|<span data-ttu-id="ca1dd-160">Имя экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ca1dd-160">Is the name of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="ca1dd-161">Для экземпляра по умолчанию введите MSSQLSERVER.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-161">For the default instance, enter MSSQLSERVER.</span></span>|  
    |<span data-ttu-id="ca1dd-162">/SQLSYSADMINACCOUNTS=*учетные_записи*</span><span class="sxs-lookup"><span data-stu-id="ca1dd-162">/SQLSYSADMINACCOUNTS=*accounts*</span></span>|<span data-ttu-id="ca1dd-163">Задает учетные записи групп Windows или индивидуальные учетные записи, которые следует добавить к предопределенной роли сервера `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-163">Specifies the Windows groups or individual accounts to add to the `sysadmin` fixed server role.</span></span> <span data-ttu-id="ca1dd-164">При указании нескольких учетных записей их нужно разделять пробелами.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-164">When specifying more than one account, separate the accounts with a blank space.</span></span> <span data-ttu-id="ca1dd-165">Например, введите **BUILTIN\Administrators MyDomain\MyUser**.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-165">For example, enter **BUILTIN\Administrators MyDomain\MyUser**.</span></span> <span data-ttu-id="ca1dd-166">Если учетная запись содержит в своем имени пробелы, заключайте ее имя в двойные кавычки.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-166">When you are specifying an account that contains a blank space within the account name, enclose the account in double quotation marks.</span></span> <span data-ttu-id="ca1dd-167">Например, введите `NT AUTHORITY\SYSTEM`.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-167">For example, enter `NT AUTHORITY\SYSTEM`.</span></span>|  
    |<span data-ttu-id="ca1dd-168">[ /SAPWD=*надежный_пароль* ]</span><span class="sxs-lookup"><span data-stu-id="ca1dd-168">[ /SAPWD=*StrongPassword* ]</span></span>|<span data-ttu-id="ca1dd-169">Указывает пароль для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] `sa` учетной записи.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-169">Specifies the password for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] `sa` account.</span></span> <span data-ttu-id="ca1dd-170">Этот параметр обязателен, если экземпляр использует смешанный режим проверки подлинности (проверка подлинности[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и Windows).</span><span class="sxs-lookup"><span data-stu-id="ca1dd-170">This parameter is required if the instance uses Mixed Authentication ([!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and Windows Authentication) mode.</span></span><br /><br /> <span data-ttu-id="ca1dd-171">\*\* \* \* Примечание о безопасности. учетная запись — это хорошо известная учетная запись, и она часто предназначена для пользователей-злоумышленников. \* \* \*\* `sa` [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]</span><span class="sxs-lookup"><span data-stu-id="ca1dd-171">**\*\* Security Note \*\*** The `sa` account is a well-known [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] account and it is often targeted by malicious users.</span></span> <span data-ttu-id="ca1dd-172">Для имени входа `sa` очень важно использовать надежный пароль.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-172">It is very important that you use a strong password for the `sa` login.</span></span><br /><br /> <span data-ttu-id="ca1dd-173">Для режима проверки подлинности Windows этот параметр не указывается.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-173">Do not specify this parameter for Windows Authentication mode.</span></span>|  
    |<span data-ttu-id="ca1dd-174">[/SQLCOLLATION=*имя_параметров_сортировки* ]</span><span class="sxs-lookup"><span data-stu-id="ca1dd-174">[ /SQLCOLLATION=*CollationName* ]</span></span>|<span data-ttu-id="ca1dd-175">Указывает новые параметры сортировки на уровне сервера.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-175">Specifies a new server-level collation.</span></span> <span data-ttu-id="ca1dd-176">Это необязательный параметр.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-176">This parameter is optional.</span></span> <span data-ttu-id="ca1dd-177">При его отсутствии используются текущие параметры сортировки сервера.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-177">When not specified, the current collation of the server is used.</span></span><br /><br /> <span data-ttu-id="ca1dd-178">**\*\* Важно! \*\*** Изменение параметров сортировки на уровне сервера не меняет параметры сортировки существующих баз данных.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-178">**\*\* Important \*\*** Changing the server-level collation does not change the collation of existing user databases.</span></span> <span data-ttu-id="ca1dd-179">Вновь созданный пользователь по умолчанию будет использовать новые параметры сортировки.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-179">All newly created user databases will use the new collation by default.</span></span><br /><br /> <span data-ttu-id="ca1dd-180">Дополнительные сведения см. в разделе [Задание или изменение параметров сортировки сервера](../collations/set-or-change-the-server-collation.md).</span><span class="sxs-lookup"><span data-stu-id="ca1dd-180">For more information, see [Set or Change the Server Collation](../collations/set-or-change-the-server-collation.md).</span></span>|  
  
3.  <span data-ttu-id="ca1dd-181">Когда программа установки завершает перестроение системных баз данных, она возвращается в командную строку без сообщений.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-181">When Setup has completed rebuilding the system databases, it returns to the command prompt with no messages.</span></span> <span data-ttu-id="ca1dd-182">Просмотрите файл журнала Summary.txt, чтобы убедиться, что процесс завершился успешно.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-182">Examine the Summary.txt log file to verify that the process completed successfully.</span></span> <span data-ttu-id="ca1dd-183">Этот файл расположен в папке C:\Program Files\Microsoft SQL Server\120\Setup Bootstrap\Logs.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-183">This file is located at C:\Program Files\Microsoft SQL Server\120\Setup Bootstrap\Logs.</span></span>  
  
## <a name="post-rebuild-tasks"></a><span data-ttu-id="ca1dd-184">Задачи, выполняемые после перестроения</span><span class="sxs-lookup"><span data-stu-id="ca1dd-184">Post-Rebuild Tasks</span></span>  
 <span data-ttu-id="ca1dd-185">После перестроения базы данных, возможно, придется выполнить следующие дополнительные задачи.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-185">After rebuilding the database you may need to perform the following additional tasks:</span></span>  
  
-   <span data-ttu-id="ca1dd-186">Восстановить наиболее поздние полные резервные копии баз данных master, model и msdb.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-186">Restore your most recent full backups of the master, model, and msdb databases.</span></span> <span data-ttu-id="ca1dd-187">Дополнительные сведения см. в статье [Резервное копирование и восстановление системных баз данных (SQL Server)](../backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="ca1dd-187">For more information, see [Back Up and Restore of System Databases &#40;SQL Server&#41;](../backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="ca1dd-188">Если изменены параметры сортировки сервера, не следует восстанавливать системные базы данных.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-188">If you have changed the server collation, do not restore the system databases.</span></span> <span data-ttu-id="ca1dd-189">В противном случае новые параметры сортировки будут заменены старыми.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-189">Doing so will replace the new collation with the previous collation setting.</span></span>  
  
     <span data-ttu-id="ca1dd-190">Если резервная копия недоступна или не является копией текущей базы данных, повторно создайте все отсутствующие записи.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-190">If a backup is not available or if the restored backup is not current, re-create any missing entries.</span></span> <span data-ttu-id="ca1dd-191">Например, повторно создайте все недостающие записи для пользовательских баз данных, устройств резервного копирования, имен входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , конечных точек и так далее.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-191">For example, re-create all missing entries for your user databases, backup devices, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] logins, end points, and so on.</span></span> <span data-ttu-id="ca1dd-192">Лучшим способом повторного создания записей является запуск создавшего их исходного скрипта.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-192">The best way to re-create entries is to run the original scripts that created them.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ca1dd-193">Рекомендуется защитить применяемые скрипты, чтобы предотвратить их изменение неавторизированными пользователями.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-193">We recommend that you secure your scripts to prevent their being altered by unauthorized by individuals.</span></span>  
  
-   <span data-ttu-id="ca1dd-194">Если экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] настроен как распространитель репликации, необходимо восстановить базу данных distribution.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-194">If the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is configured as a replication Distributor, you must restore the distribution database.</span></span> <span data-ttu-id="ca1dd-195">Дополнительные сведения см. в разделе [Резервное копирование и восстановление реплицируемых баз данных](../replication/administration/back-up-and-restore-replicated-databases.md).</span><span class="sxs-lookup"><span data-stu-id="ca1dd-195">For more information, see [Back Up and Restore Replicated Databases](../replication/administration/back-up-and-restore-replicated-databases.md).</span></span>  
  
-   <span data-ttu-id="ca1dd-196">Переместить системные базы данных в зарегистрированное ранее расположение.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-196">Move the system databases to the locations you recorded previously.</span></span> <span data-ttu-id="ca1dd-197">Дополнительные сведения см. в статье [Перемещение системных баз данных](system-databases.md).</span><span class="sxs-lookup"><span data-stu-id="ca1dd-197">For more information, see [Move System Databases](system-databases.md).</span></span>  
  
-   <span data-ttu-id="ca1dd-198">Проверить, соответствуют ли значения конфигурации на уровне сервера зарегистрированным ранее значениям.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-198">Verify the server-wide configuration values match the values you recorded previously.</span></span>  
  
##  <a name="rebuild-the-resource-database"></a><a name="Resource"></a> <span data-ttu-id="ca1dd-199">Перестроение базы данных Resource</span><span class="sxs-lookup"><span data-stu-id="ca1dd-199">Rebuild the resource Database</span></span>  
 <span data-ttu-id="ca1dd-200">Приведенная ниже процедура перестраивает системную базу данных resource.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-200">The following procedure rebuilds the resource system database.</span></span> <span data-ttu-id="ca1dd-201">После перестроения базы данных resource все исправления и пакеты обновления теряются, поэтому их следует применить заново.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-201">When you rebuild the resource database, all service packs and hot fixes are lost, and therefore must be reapplied.</span></span>  
  
#### <a name="to-rebuild-the-resource-system-database"></a><span data-ttu-id="ca1dd-202">Перестроение базы данных resource</span><span class="sxs-lookup"><span data-stu-id="ca1dd-202">To rebuild the resource system database:</span></span>  
  
1.  <span data-ttu-id="ca1dd-203">Запустите программу установки [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] (setup.exe), расположенную на установочном носителе.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-203">Launch the [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] Setup program (setup.exe) from the distribution media.</span></span>  
  
2.  <span data-ttu-id="ca1dd-204">В левой части области переходов нажмите кнопку **Обслуживание**и выберите **Исправить**.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-204">In the left navigation area, click **Maintenance**, and then click **Repair**.</span></span>  
  
3.  <span data-ttu-id="ca1dd-205">Будут запущены правило поддержки установки и файлы подпрограмм для того, чтобы удостовериться, что в системе установлены необходимые компоненты и компьютер отвечает правилам проверки.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-205">Setup support rule and file routines run to ensure that your system has prerequisites installed and that the computer passes Setup validation rules.</span></span> <span data-ttu-id="ca1dd-206">Для продолжения нажмите кнопку **ОК** или **Установить** .</span><span class="sxs-lookup"><span data-stu-id="ca1dd-206">Click **OK** or **Install** to continue.</span></span>  
  
4.  <span data-ttu-id="ca1dd-207">На странице «Выбор экземпляра» выберите экземпляр для исправления и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-207">On the Select Instance page, select the instance to repair, and then click **Next**.</span></span>  
  
5.  <span data-ttu-id="ca1dd-208">Будут запущены правила исправления для проверки операции.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-208">The repair rules will run to validate the operation.</span></span> <span data-ttu-id="ca1dd-209">Чтобы продолжить, нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-209">To continue, click **Next**.</span></span>  
  
6.  <span data-ttu-id="ca1dd-210">На странице **Все готово для восстановления** нажмите кнопку **Исправить**.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-210">From the **Ready to Repair** page, click **Repair**.</span></span> <span data-ttu-id="ca1dd-211">Страница «Готово» показывает, что операция завершена.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-211">The Complete page indicates that the operation is finished.</span></span>  
  
##  <a name="create-a-new-msdb-database"></a><a name="CreateMSDB"></a> <span data-ttu-id="ca1dd-212">Создание новой базы данных msdb</span><span class="sxs-lookup"><span data-stu-id="ca1dd-212">Create a New msdb Database</span></span>  
 <span data-ttu-id="ca1dd-213">Если `msdb` база данных повреждена и у вас нет резервной копии `msdb` базы данных, можно создать новую `msdb` с помощью скрипта **instmsdb** .</span><span class="sxs-lookup"><span data-stu-id="ca1dd-213">If the `msdb` database is damaged and you do not have a backup of the `msdb` database, you can create a new `msdb` by using the **instmsdb** script.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="ca1dd-214">При перестроении `msdb` базы данных с помощью скрипта **instmsdb** будут исключены все данные, хранящиеся в таких случаях, `msdb` как задания, предупреждения, операторы, планы обслуживания, журнал резервного копирования, параметры управления на основе политик, Database Mail, хранилище данных производительности и т. д.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-214">Rebuilding the `msdb` database using the **instmsdb** script will eliminate all the information stored in `msdb` such as jobs, alert, operators, maintenance plans, backup history, Policy-Based Management settings, Database Mail, Performance Data Warehouse, etc.</span></span>  
  
1.  <span data-ttu-id="ca1dd-215">Остановите все службы, подключающиеся к компоненту [!INCLUDE[ssDE](../../includes/ssde-md.md)], включая агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , службы [!INCLUDE[ssRS](../../includes/ssrs.md)], службы [!INCLUDE[ssIS](../../includes/ssis-md.md)]и все приложения, использующие [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] как хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-215">Stop all services connecting to the [!INCLUDE[ssDE](../../includes/ssde-md.md)], including [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent, [!INCLUDE[ssRS](../../includes/ssrs.md)], [!INCLUDE[ssIS](../../includes/ssis-md.md)], and all applications using [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] as data store.</span></span>  
  
2.  <span data-ttu-id="ca1dd-216">Запустите [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] из командной строки с помощью команды: `NET START MSSQLSERVER /T3608`</span><span class="sxs-lookup"><span data-stu-id="ca1dd-216">Start [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] from the command line using the command: `NET START MSSQLSERVER /T3608`</span></span>  
  
     <span data-ttu-id="ca1dd-217">Дополнительные сведения см. в статье [Iniciar, parar, pausar, retomar e reiniciar os serviços SQL Server](../../database-engine/configure-windows/start-stop-pause-resume-restart-sql-server-services.md).</span><span class="sxs-lookup"><span data-stu-id="ca1dd-217">For more information, see [Start, Stop, Pause, Resume, Restart the Database Engine, SQL Server Agent, or SQL Server Browser Service](../../database-engine/configure-windows/start-stop-pause-resume-restart-sql-server-services.md).</span></span>  
  
3.  <span data-ttu-id="ca1dd-218">В другом окне командной строки отсоедините `msdb` базу данных, выполнив следующую команду, заменив на *\<servername>* экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] :`SQLCMD -E -S<servername> -dmaster -Q"EXEC sp_detach_db msdb"`</span><span class="sxs-lookup"><span data-stu-id="ca1dd-218">In another command line window, detach the `msdb` database by executing the following command, replacing *\<servername>* with the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]: `SQLCMD -E -S<servername> -dmaster -Q"EXEC sp_detach_db msdb"`</span></span>  
  
4.  <span data-ttu-id="ca1dd-219">В проводнике Windows переименуйте `msdb` файлы базы данных.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-219">Using the Windows Explorer, rename the `msdb` database files.</span></span> <span data-ttu-id="ca1dd-220">По умолчанию они находятся в папке DATA соответствующего экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ca1dd-220">By default these are in the DATA sub-folder for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
5.  <span data-ttu-id="ca1dd-221">С помощью диспетчера конфигурации [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] остановите и перезапустите службу компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] , как обычно.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-221">Using [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Configuration Manager, stop and restart the [!INCLUDE[ssDE](../../includes/ssde-md.md)] service normally.</span></span>  
  
6.  <span data-ttu-id="ca1dd-222">В окне командной строки подключитесь к серверу [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и выполните следующую команду: `SQLCMD -E -S<servername> -i"C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\Install\instmsdb.sql" -o" C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\Install\instmsdb.out"`</span><span class="sxs-lookup"><span data-stu-id="ca1dd-222">In a command line window, connect to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and execute the command: `SQLCMD -E -S<servername> -i"C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\Install\instmsdb.sql" -o" C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\Install\instmsdb.out"`</span></span>  
  
     <span data-ttu-id="ca1dd-223">Замените *\<servername>* на экземпляр компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ca1dd-223">Replace *\<servername>* with the instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span></span> <span data-ttu-id="ca1dd-224">Укажите путь к экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-224">Use the file system path of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
7.  <span data-ttu-id="ca1dd-225">Откройте в Блокноте файл **instmsdb.out** и проверьте выходные данные на наличие ошибок.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-225">Using the Windows Notepad, open the **instmsdb.out** file and check the output for any errors.</span></span>  
  
8.  <span data-ttu-id="ca1dd-226">Примените заново все пакеты обновления и пакеты исправлений, которые были установлены на экземпляре.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-226">Re-apply any service packs or hotfix installed on the instance.</span></span>  
  
9. <span data-ttu-id="ca1dd-227">Повторное создание пользовательского содержимого, хранящегося в `msdb` базе данных, например заданий, предупреждений и т. д.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-227">Recreate the user content stored in the `msdb` database, such as jobs, alert, etc.</span></span>  
  
10. <span data-ttu-id="ca1dd-228">Создайте резервную копию базы данных `msdb`.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-228">Backup the `msdb` database.</span></span>  
  
##  <a name="troubleshoot-rebuild-errors"></a><a name="Troubleshoot"></a> <span data-ttu-id="ca1dd-229">Устранение ошибок перестроения</span><span class="sxs-lookup"><span data-stu-id="ca1dd-229">Troubleshoot Rebuild Errors</span></span>  
 <span data-ttu-id="ca1dd-230">Ошибки синтаксиса и ошибки времени выполнения отображаются в окне командной строки.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-230">Syntax and other run-time errors are displayed in the command prompt window.</span></span> <span data-ttu-id="ca1dd-231">Проверьте инструкцию установки на наличие следующих синтаксических ошибок:</span><span class="sxs-lookup"><span data-stu-id="ca1dd-231">Examine the Setup statement for the following syntax errors:</span></span>  
  
-   <span data-ttu-id="ca1dd-232">отсутствие символа косой черты (/) перед именем параметра;</span><span class="sxs-lookup"><span data-stu-id="ca1dd-232">Missing slash mark (/) in front of each parameter name.</span></span>  
  
-   <span data-ttu-id="ca1dd-233">отсутствие знака равенства (=) между именем и значением параметра;</span><span class="sxs-lookup"><span data-stu-id="ca1dd-233">Missing equal sign (=) between the parameter name and the parameter value.</span></span>  
  
-   <span data-ttu-id="ca1dd-234">наличие пробелов между именем параметра и знаком равенства;</span><span class="sxs-lookup"><span data-stu-id="ca1dd-234">Presence of blank spaces between the parameter name and the equal sign.</span></span>  
  
-   <span data-ttu-id="ca1dd-235">наличие запятых (,) или других символов, не предусмотренных синтаксисом.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-235">Presence of commas (,) or other characters that are not specified in the syntax.</span></span>  
  
 <span data-ttu-id="ca1dd-236">По завершении процедуры перестроения проверьте журналы [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на наличие ошибок.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-236">After the rebuild operation is complete, examine the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] logs for any errors.</span></span> <span data-ttu-id="ca1dd-237">По умолчанию журналы расположены в папке C:\Program Files\Microsoft SQL Server\120\Setup Bootstrap\Logs.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-237">The default log location is C:\Program Files\Microsoft SQL Server\120\Setup Bootstrap\Logs.</span></span> <span data-ttu-id="ca1dd-238">Чтобы найти файл журнала, который содержит результаты перестроения, в командной строке перейдите в папку журналов и запустите команду `findstr /s RebuildDatabase summary*.*`.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-238">To locate the log file that contains the results of the rebuild process, change directories to the Logs folder from a command prompt, and then run `findstr /s RebuildDatabase summary*.*`.</span></span> <span data-ttu-id="ca1dd-239">Будут возвращены все файлы журналов, в которых содержатся результаты перестроения системных баз данных.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-239">This search will point you to any log files that contain the results of rebuilding system databases.</span></span> <span data-ttu-id="ca1dd-240">Откройте эти файлы журналов и внимательно просмотрите, имеются ли в них соответствующие сообщения об ошибках.</span><span class="sxs-lookup"><span data-stu-id="ca1dd-240">Open the log files and examine them for relevant error messages.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ca1dd-241">См. также:</span><span class="sxs-lookup"><span data-stu-id="ca1dd-241">See Also</span></span>  
 [<span data-ttu-id="ca1dd-242">Системные базы данных</span><span class="sxs-lookup"><span data-stu-id="ca1dd-242">System Databases</span></span>](system-databases.md)  
  
  
