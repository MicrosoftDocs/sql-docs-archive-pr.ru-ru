---
title: Рекомендации по защите автономных баз данных | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- contained database, threats
ms.assetid: 026ca5fc-95da-46b6-b882-fa20f765b51d
author: stevestein
ms.author: sstein
ms.openlocfilehash: 8a4a933b99090d29f38156c56c9efa56b73af5a1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87728338"
---
# <a name="security-best-practices-with-contained-databases"></a><span data-ttu-id="031ed-102">Рекомендации по обеспечению безопасности автономных баз данных</span><span class="sxs-lookup"><span data-stu-id="031ed-102">Security Best Practices with Contained Databases</span></span>
  <span data-ttu-id="031ed-103">С автономными базами данных связаны некоторые уникальные угрозы, о которых администраторы [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] должны знать (и принимать меры по их устранению).</span><span class="sxs-lookup"><span data-stu-id="031ed-103">Contained databases have some unique threats that should be understood and mitigated by [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] administrators.</span></span> <span data-ttu-id="031ed-104">Большая часть угроз связана с процессом проверки подлинности `USER WITH PASSWORD`, который перемещает границу проверки подлинности с уровня компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] на уровень базы данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-104">Most of the threats are related to the `USER WITH PASSWORD` authentication process, which moves the authentication boundary from the [!INCLUDE[ssDE](../../includes/ssde-md.md)] level to the database level.</span></span>  
  
## <a name="threats-related-to-users"></a><span data-ttu-id="031ed-105">Угрозы, связанные с пользователями</span><span class="sxs-lookup"><span data-stu-id="031ed-105">Threats Related to Users</span></span>  
 <span data-ttu-id="031ed-106">Пользователи в автономной базе данных с `ALTER ANY USER` разрешением, например члены **db_owner** и **db_securityadmin** предопределенных ролей базы данных, могут предоставлять доступ к базе данных без ведома или разрешения, если [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] администратор.</span><span class="sxs-lookup"><span data-stu-id="031ed-106">Users in a contained database that have the `ALTER ANY USER` permission, such as members of the **db_owner** and **db_securityadmin** fixed database roles, can grant access to the database without the knowledge or permission if the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] administrator.</span></span> <span data-ttu-id="031ed-107">Предоставление пользователям доступа к автономной базе данных увеличивает контактную зону возможной атаки на всем экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="031ed-107">Granting users access to a contained database increases the potential attack surface area against the whole [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="031ed-108">Администраторы должны понимать это делегирования контроля доступа и должны быть очень осторожными при предоставлении пользователям в автономной базе данных разрешения `ALTER ANY USER`.</span><span class="sxs-lookup"><span data-stu-id="031ed-108">Administrators should understand this delegation of access control, and be very careful about granting users in the contained database the `ALTER ANY USER` permission.</span></span> <span data-ttu-id="031ed-109">Все владельцы базы данных обладают разрешением `ALTER ANY USER`.</span><span class="sxs-lookup"><span data-stu-id="031ed-109">All database owners have the `ALTER ANY USER` permission.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="031ed-110">должны периодически проводить аудит пользователей в автономной базе данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-110">administrators should periodically audit the users in a contained database.</span></span>  
  
### <a name="accessing-other-databases-using-the-guest-account"></a><span data-ttu-id="031ed-111">Доступ к другим базам данных с использованием гостевой учетной записи</span><span class="sxs-lookup"><span data-stu-id="031ed-111">Accessing Other Databases Using the guest Account</span></span>  
 <span data-ttu-id="031ed-112">Владельцы и пользователи базы данных, имеющие разрешение `ALTER ANY USER`, могут создавать пользователей автономной базы данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-112">Database owners and database users with the `ALTER ANY USER` permission can create contained database users.</span></span> <span data-ttu-id="031ed-113">После соединения с автономной базой данных в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]пользователь автономной базы данных имеет доступ к другим базам данных в [!INCLUDE[ssDE](../../includes/ssde-md.md)], если в других базах данных включена **гостевая** учетная запись.</span><span class="sxs-lookup"><span data-stu-id="031ed-113">After connecting to a contained database on an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a contained database user can access other databases on the [!INCLUDE[ssDE](../../includes/ssde-md.md)], if the other databases have enabled the **guest** account.</span></span>  
  
### <a name="creating-a-duplicate-user-in-another-database"></a><span data-ttu-id="031ed-114">Создание повторяющегося пользователя в другой базе данных</span><span class="sxs-lookup"><span data-stu-id="031ed-114">Creating a Duplicate User in Another Database</span></span>  
 <span data-ttu-id="031ed-115">Для некоторых приложений может оказаться необходимым, чтобы пользователь имел доступ к более чем одной базе данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-115">Some applications might require that a user to have access to more than one database.</span></span> <span data-ttu-id="031ed-116">Это можно сделать путем создания идентичных пользователей автономной базы данных в каждой базе данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-116">This can be done by creating identical contained database users in each database.</span></span> <span data-ttu-id="031ed-117">При создании второй учетной записи пользователя, защищенной паролем, используйте параметр идентификатора безопасности.</span><span class="sxs-lookup"><span data-stu-id="031ed-117">Use the SID option when creating the second user with password.</span></span> <span data-ttu-id="031ed-118">В следующем примере создается два идентичных пользователя в двух базах данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-118">The following example creates two identical users in two databases.</span></span>  
  
```  
USE DB1;  
GO  
CREATE USER Carlo WITH PASSWORD = '<strong password>';   
-- Return the SID of the user  
SELECT SID FROM sys.database_principals WHERE name = 'Carlo';  
  
-- Change to the second database  
USE DB2;  
GO  
CREATE USER Carlo WITH PASSWORD = '<same password>', SID = <SID from DB1>;  
GO  
```  
  
 <span data-ttu-id="031ed-119">Для выполнения межбазового запроса необходимо установить параметр `TRUSTWORTHY` в вызывающей базе данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-119">To execute a cross-database query, you must set the `TRUSTWORTHY` option on the calling database.</span></span> <span data-ttu-id="031ed-120">Например, если заданный выше пользователь (Carlo) находится в DB1 для выполнения запроса `SELECT * FROM db2.dbo.Table1;`, то параметр `TRUSTWORTHY` должен быть включен для базы данных DB1.</span><span class="sxs-lookup"><span data-stu-id="031ed-120">For example if the user (Carlo) defined above is in DB1, to execute `SELECT * FROM db2.dbo.Table1;` then the `TRUSTWORTHY` setting must be on for database DB1.</span></span> <span data-ttu-id="031ed-121">Чтобы включить параметр `TRUSTWORHTY`, выполните следующий код:</span><span class="sxs-lookup"><span data-stu-id="031ed-121">Execute the following code to set the `TRUSTWORHTY` setting on.</span></span>  
  
```  
ALTER DATABASE DB1 SET TRUSTWORTHY ON;  
```  
  
### <a name="creating-a-user-that-duplicates-a-login"></a><span data-ttu-id="031ed-122">Создание пользователя с повторяющимся именем входа</span><span class="sxs-lookup"><span data-stu-id="031ed-122">Creating a User that Duplicates a Login</span></span>  
 <span data-ttu-id="031ed-123">Если при создании пользователя автономной базы данных с паролем в качестве имени пользователя было использовано имя входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и пользователь с именем входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в запросе на подключение указывает автономную базу данных в качестве исходного каталога, то пользователь с именем входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] подключиться не сможет.</span><span class="sxs-lookup"><span data-stu-id="031ed-123">If a contained database user with password is created, using the same name as a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login, and if the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login connects specifying the contained database as the initial catalog, then the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login will be unable to connect.</span></span> <span data-ttu-id="031ed-124">Соединение будет оцениваться как пользователь (участник) автономной базы данных с паролем автономной базы данных, а не пользователь на основе имени входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="031ed-124">The connection will be evaluated as the contained database user with password principal on the contained database instead of as a user based on the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login.</span></span> <span data-ttu-id="031ed-125">Это может вызвать намеренный или случайный отказ в обслуживании для имени входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="031ed-125">This could cause an intentional or accidental denial of service for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login.</span></span>  
  
-   <span data-ttu-id="031ed-126">Согласно рекомендациям, члены предопределенной роли сервера **sysadmin** должны всегда рассматривать соединение без использования параметра исходного каталога.</span><span class="sxs-lookup"><span data-stu-id="031ed-126">As a best practice, members of the **sysadmin** fixed server role should consider always connecting without using the initial catalog option.</span></span> <span data-ttu-id="031ed-127">Это вызывает подключение имени входа к базе данных master и предотвращает попытки владельца базы данных неправильно использовать попытку входа.</span><span class="sxs-lookup"><span data-stu-id="031ed-127">This connects the login to the master database and avoids any attempts by a database owner to misuse the login attempt.</span></span> <span data-ttu-id="031ed-128">Затем администратор может перейти к автономной базе данных с помощью `USE` *\<database>* инструкции.</span><span class="sxs-lookup"><span data-stu-id="031ed-128">Then the administrator can change to the contained database by using the `USE`*\<database>* statement.</span></span> <span data-ttu-id="031ed-129">Можно также установить в качестве базы данных по умолчанию автономную базу данных, которая выполняет вход в базу данных **master**, а затем переносит вход на автономную базу данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-129">You can also set the default database of the login to the contained database, which completes the login to **master**, and then transfers the login to the contained database.</span></span>  
  
-   <span data-ttu-id="031ed-130">Рекомендуется не создавать пользователей автономной базы данных с паролями, имена которых совпадают с именами входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="031ed-130">As a best practice, do not create contained database users with passwords who have the same name as [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] logins.</span></span>  
  
-   <span data-ttu-id="031ed-131">Если повторяющееся имя входа существует, подключитесь к базе данных **master** без указания начального каталога, а затем выполните `USE` команду, чтобы перейти к автономной базе данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-131">If the duplicate login exists, connect to the **master** database without specifying an initial catalog, and then execute the `USE` command to change to the contained database.</span></span>  
  
-   <span data-ttu-id="031ed-132">При наличии автономных баз данных пользователи баз данных, не являющихся автономными, должны подключаться к [!INCLUDE[ssDE](../../includes/ssde-md.md)] , указывая в качестве исходного каталога имя неавтономной базы данных или вообще не указывая исходный каталог.</span><span class="sxs-lookup"><span data-stu-id="031ed-132">When contained databases are present, users of databases that are not contained databases should connect to the [!INCLUDE[ssDE](../../includes/ssde-md.md)] without using an initial catalog or by specifying the database name of a non-contained database as the initial catalog.</span></span> <span data-ttu-id="031ed-133">Это предотвращает соединение с автономной базой данных, которая находится под меньшим контролем администратора компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="031ed-133">This avoids connecting to the contained database which is under less direct control by the [!INCLUDE[ssDE](../../includes/ssde-md.md)] administrators.</span></span>  
  
### <a name="increasing-access-by-changing-the-containment-status-of-a-database"></a><span data-ttu-id="031ed-134">Увеличение доступа путем изменения состояния включения базы данных</span><span class="sxs-lookup"><span data-stu-id="031ed-134">Increasing Access by Changing the Containment Status of a Database</span></span>  
 <span data-ttu-id="031ed-135">Имена входа, имеющие `ALTER ANY DATABASE` разрешение, например члены предопределенной роли сервера **dbcreator** , и пользователи в неавтономной базе данных, имеющие `CONTROL DATABASE` разрешение, например члены предопределенной роли базы данных **db_owner** , могут изменять параметр включения базы данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-135">Logins that have the `ALTER ANY DATABASE` permission, such as members of the **dbcreator** fixed server role, and users in a non-contained database that have the `CONTROL DATABASE` permission, such as members of the **db_owner** fixed database role, can change the containment setting of a database.</span></span> <span data-ttu-id="031ed-136">При изменении параметра включения базы данных с `NONE` на `PARTIAL` или `FULL` пользователю может быть предоставлен доступ путем создания пользователей автономной базы данных с паролями.</span><span class="sxs-lookup"><span data-stu-id="031ed-136">If the containment setting of a database is changed from `NONE` to either `PARTIAL` or `FULL`, then user access can be granted by creating contained database users with passwords.</span></span> <span data-ttu-id="031ed-137">В результате можно предоставить доступ без ведома или согласия администраторов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="031ed-137">This could provide access without the knowledge or consent of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] administrators.</span></span> <span data-ttu-id="031ed-138">Чтобы предотвратить автономность баз данных, установите [!INCLUDE[ssDE](../../includes/ssde-md.md)] `contained database authentication` параметр в значение 0.</span><span class="sxs-lookup"><span data-stu-id="031ed-138">To prevent any databases from being contained, set the [!INCLUDE[ssDE](../../includes/ssde-md.md)]`contained database authentication` option to 0.</span></span> <span data-ttu-id="031ed-139">Для предотвращения подключения пользователей автономной базы данных с паролями к выбранным автономным базам данных, используйте триггеры входа для отмены попыток входа пользователей автономной базы данных с паролями.</span><span class="sxs-lookup"><span data-stu-id="031ed-139">To prevent connections by contained database users with passwords on selected contained databases, use login triggers to cancel login attempts by contained database users with passwords.</span></span>  
  
### <a name="attaching-a-contained-database"></a><span data-ttu-id="031ed-140">Присоединение автономной базы данных</span><span class="sxs-lookup"><span data-stu-id="031ed-140">Attaching a Contained Database</span></span>  
 <span data-ttu-id="031ed-141">При присоединении автономной базы данных администратор может предоставить нежелательным пользователям доступ к экземпляру компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span><span class="sxs-lookup"><span data-stu-id="031ed-141">By attaching a contained database, an administrator could give unwanted users access to the instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span></span> <span data-ttu-id="031ed-142">Для предотвращения такого риска администратор может перевести базу данных в состояние «в сети» в режиме `RESTRICTED_USER`, в результате чего пользователи автономной базы данных с паролями не смогут пройти проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="031ed-142">An administrator concerned about this risk can bring the database online in `RESTRICTED_USER` mode, which prevents authentication for contained database users with passwords.</span></span> <span data-ttu-id="031ed-143">Доступ к компоненту [!INCLUDE[ssDE](../../includes/ssde-md.md)]смогут получить только участники, авторизованные через имена входа.</span><span class="sxs-lookup"><span data-stu-id="031ed-143">Only principals authorized through logins will be able to access the [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span></span>  
  
 <span data-ttu-id="031ed-144">Пользователи создаются с учетом требований к паролю, действительных в момент их создания, и при присоединении базы данных повторная проверка паролей не производится.</span><span class="sxs-lookup"><span data-stu-id="031ed-144">Users are created using the password requirements in effect at the time that they are created and passwords are not rechecked when a database is attached.</span></span> <span data-ttu-id="031ed-145">При присоединении автономной базы данных, допускающей простые пароли к системе с более строгой политикой паролей, администратор может разрешить пароли, которые не соответствуют текущей политике паролей присоединяемого компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span><span class="sxs-lookup"><span data-stu-id="031ed-145">By attaching a contained database which allowed weak passwords to a system with a stricter password policy, an administrator could permit passwords that do not meet the current password policy on the attaching [!INCLUDE[ssDE](../../includes/ssde-md.md)].</span></span> <span data-ttu-id="031ed-146">Администраторы могут запретить сохранение простых паролей с помощью требования переустановки всех паролей в присоединенной базе данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-146">Administrators can avoid retaining the weak passwords by requiring that all passwords be reset for the attached database.</span></span>  
  
### <a name="password-policies"></a><span data-ttu-id="031ed-147">Политики паролей</span><span class="sxs-lookup"><span data-stu-id="031ed-147">Password Policies</span></span>  
 <span data-ttu-id="031ed-148">Можно потребовать, чтобы пароли в базе данных были надежными, но защитить их надежными политиками паролей нельзя.</span><span class="sxs-lookup"><span data-stu-id="031ed-148">Passwords in a database can be required to be strong passwords, but cannot be protected by robust password policies.</span></span> <span data-ttu-id="031ed-149">По возможности используйте проверку подлинности Windows, чтобы использовать преимущества более сложных политик паролей, доступных в Windows.</span><span class="sxs-lookup"><span data-stu-id="031ed-149">Use Windows Authentication whenever possible to take advantage of the more extensive password policies available from Windows.</span></span>  
  
### <a name="kerberos-authentication"></a><span data-ttu-id="031ed-150">Проверка подлинности Kerberos</span><span class="sxs-lookup"><span data-stu-id="031ed-150">Kerberos Authentication</span></span>  
 <span data-ttu-id="031ed-151">Пользователи автономной базы данных с паролями не могут использовать проверку подлинности Kerberos.</span><span class="sxs-lookup"><span data-stu-id="031ed-151">Contained database users with passwords cannot use Kerberos Authentication.</span></span> <span data-ttu-id="031ed-152">По возможности используйте проверку подлинности Windows, чтобы использовать преимущества таких возможностей Windows, как Kerberos.</span><span class="sxs-lookup"><span data-stu-id="031ed-152">When possible, use Windows Authentication to take advantage of Windows features such as Kerberos.</span></span>  
  
### <a name="offline-dictionary-attack"></a><span data-ttu-id="031ed-153">Атака вне сети перебором по словарю</span><span class="sxs-lookup"><span data-stu-id="031ed-153">Offline Dictionary Attack</span></span>  
 <span data-ttu-id="031ed-154">Хэши паролей для пользователей автономной базы данных с паролями хранятся в автономной базе данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-154">The password hashes for contained database users with passwords are stored in the contained database.</span></span> <span data-ttu-id="031ed-155">Любое лицо с доступом к базе данных может выполнить атаку перебором по словарю против пользователей автономной базы данных с паролями в системе без аудита.</span><span class="sxs-lookup"><span data-stu-id="031ed-155">Anyone with access to the database files could perform a dictionary attack against the contained database users with passwords on an unaudited system.</span></span> <span data-ttu-id="031ed-156">Чтобы устранить эту угрозу, ограничьте доступ к файлам базы данных или разрешите подключение к автономным базам данных только с использованием проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="031ed-156">To mitigate this threat, restrict access to the database files, or only permit connections to contained databases by using Windows Authentication.</span></span>  
  
## <a name="escaping-a-contained-database"></a><span data-ttu-id="031ed-157">Экранирование автономной базы данных</span><span class="sxs-lookup"><span data-stu-id="031ed-157">Escaping a Contained Database</span></span>  
 <span data-ttu-id="031ed-158">Если база данных является частично автономной, то администраторы [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должны периодически выполнять аудит возможностей пользователей и модулей в автономных базах данных.</span><span class="sxs-lookup"><span data-stu-id="031ed-158">If a database is partially contained, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] administrators should periodically audit the capabilities of the users and modules in contained databases.</span></span>  
  
## <a name="denial-of-service-through-auto_close"></a><span data-ttu-id="031ed-159">Отказ в обслуживании через параметр AUTO_CLOSE</span><span class="sxs-lookup"><span data-stu-id="031ed-159">Denial of Service Through AUTO_CLOSE</span></span>  
 <span data-ttu-id="031ed-160">Не настраивайте автономную базу данных на автоматическое закрытие.</span><span class="sxs-lookup"><span data-stu-id="031ed-160">Do not configure contained databases to auto close.</span></span> <span data-ttu-id="031ed-161">Если закрыть базу данных, ее открытие для проверки подлинности пользователя будет связано с потреблением дополнительных ресурсов, что может стать объектом атаки типа «отказ в обслуживании».</span><span class="sxs-lookup"><span data-stu-id="031ed-161">If closed, opening the database to authenticate a user consumes additional resources and could contribute to a denial of service attack.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="031ed-162">См. также:</span><span class="sxs-lookup"><span data-stu-id="031ed-162">See Also</span></span>  
 <span data-ttu-id="031ed-163">[Автономные базы данных](contained-databases.md) </span><span class="sxs-lookup"><span data-stu-id="031ed-163">[Contained Databases](contained-databases.md) </span></span>  
 [<span data-ttu-id="031ed-164">Переход на частично автономную базу данных</span><span class="sxs-lookup"><span data-stu-id="031ed-164">Migrate to a Partially Contained Database</span></span>](migrate-to-a-partially-contained-database.md)  
  
  
