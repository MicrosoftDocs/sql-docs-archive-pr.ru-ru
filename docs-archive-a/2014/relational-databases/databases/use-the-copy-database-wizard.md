---
title: Использование мастера копирования базы данных | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
f1_keywords:
- sql12.swb.cdw.transfermethod.f1
- sql12.swb.cdw.welcome.f1
- sql12.swb.cdw.packageconfiguration.f1
- sql12.swb.cdw.schedule.f1
- sql12.swb.cdw.destination.f1
- sql12.swb.cdw.complete.f1
- sql12.swb.cdw.destinationconfiguration.f1
- sql12.swb.cdw.selectdatabaseobjects.f1
- sql12.swb.cdw.databases.f1
- sql12.swb.cdw.source.f1
- sql12.swb.cdw.locationofsourcedbfiles.f1
helpviewer_keywords:
- Copy Database Wizard
- starting Copy Database Wizard
ms.assetid: 7a999fc7-0a26-4a0d-9eeb-db6fc794f3cb
author: stevestein
ms.author: sstein
ms.openlocfilehash: 0baaeef6cb196a67b2f615aa280b61b61fbc5119
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87749980"
---
# <a name="use-the-copy-database-wizard"></a>Использование мастера копирования базы данных
  С помощью мастера копирования баз данных можно легко перемещать или копировать базы данных и их объекты с одного сервера на другой, без перерывов в работе сервера. Можно также обновить базы данных с прошлой версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] до версии [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]. С помощью этого мастера можно сделать следующее.  
  
-   Выбрать исходный и целевой серверы.  
  
-   Выбрать базы данных для перемещения, копирования или обновления.  
  
-   Указать расположение файлов для баз данных.  
  
-   Создать имена входа для целевого сервера.  
  
-   Копировать дополнительные вспомогательные объекты, задания, пользовательские хранимые процедуры и сообщения об ошибках.  
  
-   Задать расписание перемещения или копирования баз данных.  
  
 При копировании базы данных можно также выполнить копирование связанных метаданных, например имен входа и объектов из базы данных **master** , необходимых для ее работы.  
  
 **В этом разделе**  
  
-   **Перед началом работы**  
  
     [Ограничения](#Restrictions)  
  
     [Предварительные требования](#Prerequisites)  
  
     [Рекомендации](#Recommendations)  
  
     [Безопасность](#Security)  
  
-   **Использование мастера копирования баз данных для:**  
  
     [Копирование, перемещение или обновление баз данных](#Copy_Move)  
  
-   **Проверки после обновления.**  
  
     [После обновления базы данных SQL Server](#FollowUp)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> Ограничения  
  
-   Мастер копирования баз данных недоступен в выпуске Express.  
  
-   Мастер копирования базы данных нельзя использовать для перемещения или копирования следующих типов баз данных.  
  
    -   Системные базы данных  
  
    -   Базы данных, отмеченные для репликации.  
  
    -   Базы данных в следующих состояниях: недоступные, в процессе загрузки, в режиме вне сети, в процессе восстановления, подозрительные или в аварийном режиме.  
  
-   После обновления базы данных возврат к предыдущей версии невозможен.  
  
-   Если выбран параметр **Переместить** , после перемещения базы данных мастер автоматически удаляет базу данных-источник. При выборе параметра **Копирование** мастер копирования базы данных не выполняет удаление базы данных-источника.  
  
-   При использовании метода управляющих объектов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для перемещения полнотекстового каталога после перемещения необходимо заново заполнить индекс.  
  
-   Метод отсоединения и присоединения отсоединяет базу данных, перемещает или копирует ее файлы (MDF, NDF и LDF) и подсоединяет базу данных в новом расположении. При использовании этого метода во избежание потери или рассогласования данных к копируемой или перемещаемой базе данных нельзя присоединять активные сеансы. При наличии каких-либо активных сеансов мастер копирования баз данных не выполняет операцию перемещения или копирования. Если используется метод управляющих объектов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , активные сеансы допустимы, так как база данных не переводится в режим «вне сети».  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> Предварительные требования  
 На сервере назначения должен быть запущен агент SQL Server.  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> Рекомендации  
  
-   Для обеспечения оптимальной производительности обновленной базы данных выполните процедуру sp_updatestats (обновление статистики) для обновленной базы данных.  
  
-   При копировании базы данных на другой экземпляр сервера, чтобы обеспечить однородность среды, возможно, на другом экземпляре сервера придется повторно создать некоторые (или даже все) метаданные базы данных: имена входа, задания и т. д. Дополнительные сведения см. в статье [Управление метаданными при обеспечении доступности базы данных на другом экземпляре сервера (SQL Server)](manage-metadata-when-making-a-database-available-on-another-server.md).  
  
###  <a name="security"></a><a name="Security"></a> безопасность  
  
####  <a name="permissions"></a><a name="Permissions"></a> Permissions  
 Вы должны быть членом предопределенной роли сервера **sysadmin** как на исходном, так и на целевом сервере.  
  
##  <a name="copy-move-or-upgrade-databases"></a><a name="Copy_Move"></a>Копирование, перемещение или обновление баз данных  
  
1.  В [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] обозревателе объектов разверните узел **базы данных**, щелкните правой кнопкой мыши базу данных, укажите пункт **задачи**и выберите команду **Копировать базу данных**.  
  
2.  На странице **Выбор исходного сервера** укажите сервер с базой данных, которую следует переместить или скопировать, а также введите сведения для входа. После выбора метода проверки подлинности и введения сведений для входа нажмите кнопку **Далее** , чтобы установить соединения с исходным сервером. Это соединение остается открытым в течение всего сеанса.  
  
     **Исходный сервер**  
     Выберите имя сервера, на котором находятся базы данных, которые необходимо переместить или скопировать, или нажмите кнопку обзора (**...**), чтобы найти нужный сервер. Версия сервера должна быть не ниже [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)].  
  
     **Использовать проверку подлинности Windows**  
     Пользователь может подключаться через учетную запись [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows.  
  
     **Использовать проверку подлинности SQL Server**  
     Позволяет пользователю подключаться с помощью имени пользователя и пароля для проверки подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
     **User name**  
     Введите имя пользователя для соединения. Этот параметр доступен только в том случае, если выбрано соединение с использованием проверки подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
     **Пароль**  
     Введите пароль для этого имени входа. Этот параметр доступен только в том случае, если выбрано соединение с использованием проверки подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
     **Вперед**  
     Соединение с сервером и проверка пользователя. Этот процесс проверяет членство пользователя в фиксированной роли сервера **sysadmin** на выбранном компьютере.  
  
3.  На странице **Выбор сервера назначения** укажите сервер, на который будет выполнено копирование или перемещение базы данных. Если в качестве исходного и целевого сервера выбрать один и тот же экземпляр сервера, будет создана копия базы данных. В этом случае необходимо задать другое имя для целевой базы данных в мастере. Имя базы данных-источника может быть использовано в качестве имени скопированной или перемещенной базы данных только в том случае, если на целевом сервере не возникает конфликтов имен. Если конфликты имен существуют, их необходимо разрешить вручную на целевом сервере, прежде чем там можно будет использовать имя базы данных-источника.  
  
     **Целевой сервер**  
     Выберите имя сервера, на который будут перемещены или скопированы база данных или базы. либо нажмите кнопку обзора (**...**), чтобы найти целевой сервер.  
  
    > [!NOTE]  
    >  В качестве целевого можно использовать кластеризованный сервер, при этом мастер копирования базы данных должен убедиться, что на кластеризованном целевом сервере выбраны только совместно используемые диски.  
  
     **Использовать проверку подлинности Windows**  
     Пользователь может подключаться через учетную запись [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows.  
  
     **Использовать проверку подлинности SQL Server**  
     Позволяет пользователю подключаться с помощью имени пользователя и пароля для проверки подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
     **User name**  
     Введите имя пользователя для соединения. Данный параметр доступен только при выборе проверки подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
     **Пароль**  
     Введите пароль для этого имени входа. Данный параметр доступен только при выборе проверки подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
     **Вперед**  
     Соединение с сервером и проверка пользователя. Во время этого процесса выполняется проверка перечисленных выше разрешений пользователя на выбранном компьютере.  
  
4.  На странице **Выбор метода переноса** выберите метод переноса.  
  
     **Использовать метод отсоединения и присоединения**  
     Отключите базу данных от сервера-источника, скопируйте файлы базы данных (MDF-, NDF- и LDF-файлы) на целевой сервер и подключите базу данных на целевом сервере. Обычно это самый быстрый метод, так как основной выполняемой работой является считывание данных с диска источника и запись на целевой диск. Для создания объектов в базе данных или структур хранилищ данных не требуется логика [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Однако этот метод может быть более медленным, если база данных содержит большой объем выделенного, но неиспользуемого пространства. Если экземпляр содержит новую и практически пустую базу данных, под которую при создании было выделено 100 МБ, все эти 100 МБ будут скопированы, даже если заполнено всего 5 МБ.  
  
    > [!NOTE]  
    >  Во время передачи данных этим методом база данных недоступна пользователям.  
  
     **В случае ошибки восстановить подключение базы данных-источника**  
     При копировании базы данных файлы исходной базы данных всегда повторно присоединяются к исходному серверу. Установите этот флажок, чтобы заново присоединить исходные файлы к базе данных-источнику, если перемещение базы данных не может быть выполнено.  
  
     **Использовать метод объектов SMO**  
     Этот метод выполняет чтение определения каждого объекта базы данных-источника и создание каждого из этих объектов в целевой базе данных. После этого происходит перенос данных из исходных таблиц в целевые таблицы с воссозданием индексов и метаданных.  
  
    > [!NOTE]  
    >  Во время переноса пользователи базы данных могут продолжать обращаться к ней.  
  
5.  На странице **Выбор базы данных** выберите одну или несколько баз данных, которые требуется переместить или скопировать с исходного сервера на целевой. Ознакомьтесь с [ограничениями](#Restrictions) в разделе "перед тем, как вы Begin в этом разделе.  
  
     **Перемещение**  
     Переместить базы данных на целевой сервер.  
  
     **Копировать**  
     Копировать базы данных на целевой сервер.  
  
     **Source**  
     Показывает базы данных, присутствующие на исходном сервере.  
  
     **Состояние**  
     Если база данных может быть перемещена, отображается значение **ОК** . В противном случае отображается причина, по которой база данных не может быть перемещена.  
  
     **Обновить**  
     Обновить список баз данных.  
  
     **Вперед**  
     Начать проверку и перейти на следующий экран.  
  
6.  На странице **Настройка целевой базы данных** измените, если нужно, имя базы данных и укажите местоположение и имена файлов базы данных. Эта страница отображается один раз для каждой перемещаемой или копируемой базы данных.  
  
7.  На странице **Выбор объектов базы данных** выберите объекты, которые необходимо включить в операцию перемещения или копирования. Эта страница доступна только в том случае, когда в качестве исходного и целевого серверов используются разные сервера. Чтобы включить объект, выберите имя объекта в поле **Доступные связанные объекты** , затем нажмите кнопку **>>** для перемещения объекта в поле **Выбранные связанные объекты** . Чтобы исключить объект, щелкните имя объекта в поле **Выбранные связанные объекты** , а затем нажмите кнопку, **<\<** чтобы переместить объект в поле **доступные связанные объекты** . По умолчанию переносятся все объекты всех выбранных типов. Для выбора отдельных объектов любого типа нажмите кнопку с многоточием рядом с любым типом объекта в поле **Выбранные связанные объекты** . Откроется диалоговое окно, в котором можно будет выбрать отдельные объекты.  
  
     **Имена входа (все имена входа во время выполнения)**  
     Включает имена входа в операцию копирования или перемещения. Выбрано по умолчанию.  
  
     **Хранимые процедуры из главной базы данных**  
     Включить хранимые процедуры из базы данных **master** в операцию перемещения или копирования.  
  
    > [!NOTE]  
    >  Расширенные хранимые процедуры и связанные с ними DLL-файлы недоступны для автоматического копирования.  
  
     **задания агента SQL Server**  
     Включить задания из базы данных **msdb** в операцию перемещения или копирования.  
  
     **Определяемые пользователем сообщения об ошибках**  
     Включает в операцию перемещения или копирования определяемые пользователем сообщения об ошибках.  
  
     **Конечные точки**  
     Включить конечные точки, определенные в базе данных-источнике.  
  
     **Полнотекстовый каталог**  
     Включает полнотекстовые каталоги из базы данных-источника.  
  
     **Пакет служб SSIS**  
     Включить пакеты служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] , определенные в базе данных-источнике.  
  
     **Описание**  
     Описание объекта.  
  
8.  На странице **Местоположение файлов исходной базы данных** укажите общую папку в файловой системе, содержащую файлы базы данных на исходном сервере. Это необходимо в том случае, если экземпляры исходного и целевого серверов находятся на разных компьютерах.  
  
     **База данных**  
     Отображает имя каждой перемещаемой базы данных.  
  
     **Расположение папки**  
     Укажите местоположение файлов базы данных-источника в файловой системе.  
  
     Например: C:\Program Files\Microsoft SQL Server\MSSQL110.MSSQLSERVER\MSSQL\DATA  
  
     **Общая папка на исходном сервере**  
     Укажите местоположение файлов базы данных-источника в виде пути к общей папке.  
  
     Например: " \\ \\ *server_name*\c $ \Program Files\Microsoft SQL Server\MSSQL110. мссклсервер\мсскл\дата  
  
9. Мастер копирования базы данных создает пакет служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] для передачи базы данных на странице **Настройка пакета** . Внесите изменения в пакет, если это необходимо.  
  
     **Размещение пакета**  
     Указывает, куда будет записан пакет служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] .  
  
     **Имя пакета**  
     Введите имя для пакета служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] .  
  
     **Параметры ведения журнала**  
     Выберите сохранение сведений либо в журнал событий Windows, либо в текстовый файл.  
  
     **Путь к журналу ошибок**  
     Укажите путь размещения файла журнала. Этот параметр доступен только в том случае, если выбрано сохранение журнала в текстовый файл.  
  
10. На странице **Расписание пакета** укажите, когда требуется начать операцию перемещения или копирования. Если вы не являетесь системным администратором, необходимо указать учетную запись-посредник агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , имеющую доступ к подсистеме выполнения пакетов служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] (SSIS).  
  
     **Run immediately**  
     Запустите операцию перемещения или копирования после нажатия кнопки **Далее**.  
  
     **Расписание**  
     Начать операцию копирования или перемещения позже. В окне описания появятся текущие параметры расписания. Чтобы изменить расписание, нажмите кнопку **Изменить**.  
  
     **Изменение**  
     Откройте диалоговое окно **Создание расписания задания** .  
  
     **Учетная запись-посредник служб SSIS**  
     Выберите учетную запись-посредник. Чтобы запланировать перемещение, пользователь должен иметь по крайней мере одну учетную запись-посредник, настроенную с разрешением доступа к подсистеме **Выполнение пакетов служб SQL Server Integration Services** .  
  
     Чтобы создать учетную запись-посредник для [!INCLUDE[ssIS](../../includes/ssis-md.md)] выполнения пакета, в обозревателе объектов разверните узел **Агент SQL Server**, затем — **прокси-серверы**, щелкните правой кнопкой мыши пункт **выполнение пакетов служб SSIS**и выберите команду **создать прокси-сервер**.  
  
     Члены предопределенной роли сервера **sysadmin** могут выбрать **учетную запись службы агента SQL Server**, которая имеет все нужные разрешения.  
  
11. На странице **Завершение работы мастера** просмотрите сводку выбранных параметров. Нажмите кнопку **Назад** для изменения параметров. Чтобы создать базу данных, нажмите кнопку **Готово** . Во время передачи на странице **Выполнение операции** отображаются данные о состоянии выполнения операций, заданных в **мастере копирования баз данных**.  
  
     **Действие**  
     Отображает список всех выполняемых действий.  
  
     **Состояние**  
     Указывает, выполнено действие успешно или нет.  
  
     **Message**  
     Предоставляет все сообщения, возвращаемые в каждом шаге.  
  
##  <a name="follow-up-after-upgrading-a-sql-server-database"></a><a name="FollowUp"></a> Дальнейшие действия. После обновления базы данных SQL Server  
 После обновления базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] до [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]с помощью мастера копирования баз данных эта база данных сразу же становится доступной и обновляется автоматически. Если база данных содержит полнотекстовые индексы, то в процессе обновления будет произведен их импорт, сброс или перестроение в зависимости от установленного значения свойства сервера **Режим обновления полнотекстового каталога** . Если при обновлении выбран режим **Импортировать** или **Перестроить**, то полнотекстовые индексы во время обновления будут недоступны. В зависимости от объема индексируемых данных процесс импорта может занять несколько часов, а перестроение — в несколько (до десяти) раз больше. Обратите внимание, что если при обновлении выбран режим **Импортировать**, а полнотекстовый каталог недоступен, то связанные с ним полнотекстовые индексы будут перестроены. Сведения о просмотре и изменении параметра **Режим обновления полнотекстового поиска** см. в статье [Наблюдение за полнотекстовым поиском для экземпляра сервера и управление им](../search/manage-and-monitor-full-text-search-for-a-server-instance.md).  
  
 Если уровень совместимости пользовательской базы данных до обновления был 100 или выше, после обновления он останется таким же. Если уровень совместимости был 90, то в обновленной базе данных устанавливается уровень 100, что является минимально поддерживаемым уровнем совместимости в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]. Дополнительные сведения см. в разделе [Уровень совместимости инструкции ALTER DATABASE (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level).  
  
## <a name="see-also"></a>См. также:  
 [Обновление базы данных с помощью отсоединения и присоединения &#40;Transact-SQL&#41;](upgrade-a-database-using-detach-and-attach-transact-sql.md)   
 [Создание учетной записи-посредника агента SQL Server](../../ssms/agent/create-a-sql-server-agent-proxy.md)  
  
  
