---
title: Моментальные снимки базы данных (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- static database views
- snapshots [SQL Server database snapshots]
- source databases [SQL Server]
- snapshots [SQL Server database snapshots], about database snapshots
- database snapshots [SQL Server]
- read-only database views
- database snapshots [SQL Server], about database snapshots
ms.assetid: 00179314-f23e-47cb-a35c-da6f180f86d3
author: stevestein
ms.author: sstein
ms.openlocfilehash: 8a0fa9b6cee2287d4e6060d4cb39f34d909e7db9
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751112"
---
# <a name="database-snapshots-sql-server"></a><span data-ttu-id="ce5f8-102">Моментальные снимки базы данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="ce5f8-102">Database Snapshots (SQL Server)</span></span>
  <span data-ttu-id="ce5f8-103">Моментальный снимок базы данных является статичным, доступным только для чтения представлением базы данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ( *базы данных-источника*).</span><span class="sxs-lookup"><span data-stu-id="ce5f8-103">A database snapshot is a read-only, static view of a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database (the *source database*).</span></span> <span data-ttu-id="ce5f8-104">Моментальный снимок базы данных согласуется на уровне транзакций с базой данных-источником в момент создания моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-104">The database snapshot is transactionally consistent with the source database as of the moment of the snapshot's creation.</span></span> <span data-ttu-id="ce5f8-105">Моментальный снимок базы данных всегда находится на том же экземпляре сервера, что и база данных-источник.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-105">A database snapshot always resides on the same server instance as its source database.</span></span> <span data-ttu-id="ce5f8-106">При обновлении базы данных-источника обновляется и моментальный снимок базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-106">As the source database is updated, the database snapshot is updated.</span></span> <span data-ttu-id="ce5f8-107">Это означает, что чем дольше существует моментальный снимок базы данных, тем больше вероятность того, что он израсходует все доступное место на диске.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-107">Therefore, the longer a database snapshot exists, the more likely it is to use up its available disk space.</span></span>  
  
 <span data-ttu-id="ce5f8-108">Может существовать несколько моментальных снимков одной и той же базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-108">Multiple snapshots can exist on a given source database.</span></span> <span data-ttu-id="ce5f8-109">Каждый моментальный снимок базы данных существует до тех пор, пока он не будет явно удален владельцем базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-109">Each database snapshot persists until it is explicitly dropped by the database owner.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ce5f8-110">Моментальные снимки базы данных не связаны с резервным копированием путем создания моментальных снимков, с изоляцией моментальных снимков транзакций и с репликацией моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-110">Database snapshots are unrelated to snapshot backups, snapshot isolation of transactions, or snapshot replication.</span></span>  
  
 <span data-ttu-id="ce5f8-111">**В этом разделе.**</span><span class="sxs-lookup"><span data-stu-id="ce5f8-111">**In this Topic:**</span></span>  
  
-   [<span data-ttu-id="ce5f8-112">Общие сведения о функциях</span><span class="sxs-lookup"><span data-stu-id="ce5f8-112">Feature Overview</span></span>](#FeatureOverview)  
  
-   [<span data-ttu-id="ce5f8-113">Преимущества моментальных снимков баз данных</span><span class="sxs-lookup"><span data-stu-id="ce5f8-113">Benefits of Database Snapshots</span></span>](#Benefits)  
  
-   [<span data-ttu-id="ce5f8-114">Термины и определения</span><span class="sxs-lookup"><span data-stu-id="ce5f8-114">Terms and Definitions</span></span>](#TermsAndDefinitions)  
  
-   [<span data-ttu-id="ce5f8-115">Обязательные условия и ограничения для моментальных снимков базы данных</span><span class="sxs-lookup"><span data-stu-id="ce5f8-115">Prerequisites for and Limitations on Database Snapshots</span></span>](#LimitationsRequirements)  
  
-   [<span data-ttu-id="ce5f8-116">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="ce5f8-116">Related Tasks</span></span>](#RelatedTasks)  
  
##  <a name="feature-overview"></a><a name="FeatureOverview"></a> <span data-ttu-id="ce5f8-117">Общие сведения о функциях</span><span class="sxs-lookup"><span data-stu-id="ce5f8-117">Feature Overview</span></span>  
 <span data-ttu-id="ce5f8-118">Моментальные снимки базы данных работают на уровне страниц данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-118">Database snapshots operate at the data-page level.</span></span> <span data-ttu-id="ce5f8-119">Перед первым изменением базы данных-источника исходная страница копируется из нее в моментальный снимок.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-119">Before a page of the source database is modified for the first time, the original page is copied from the source database to the snapshot.</span></span> <span data-ttu-id="ce5f8-120">Моментальный снимок хранит исходную страницу, оставляя записи данных в том виде, в котором они существовали на момент создания моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-120">The snapshot stores the original page, preserving the data records as they existed when the snapshot was created.</span></span> <span data-ttu-id="ce5f8-121">Процесс повторяется для каждой страницы, изменяемой впервые.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-121">The same process is repeated for every page that is being modified for the first time.</span></span> <span data-ttu-id="ce5f8-122">Для пользователя моментальный снимок никогда не меняется, поскольку операции считывания в моментальном снимке базы данных всегда обращаются к исходным страницам данных, независимо от того, сохранились они или нет.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-122">To the user, a database snapshot appears never to change, because read operations on a database snapshot always access the original data pages, regardless of where they reside.</span></span>  
  
 <span data-ttu-id="ce5f8-123">Для хранения исходных страниц моментальный снимок использует один или более *разреженных файлов*.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-123">To store the copied original pages, the snapshot uses one or more *sparse files*.</span></span> <span data-ttu-id="ce5f8-124">Изначально разреженный файл представляет собой пустой файл, который не содержит никаких пользовательских данных, и ему еще не выделено место на диске для пользовательских данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-124">Initially, a sparse file is an essentially empty file that contains no user data and has not yet been allocated disk space for user data.</span></span> <span data-ttu-id="ce5f8-125">По мере обновления страниц в базе данных-источнике размер файла увеличивается.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-125">As more and more pages are updated in the source database, the size of the file grows.</span></span> <span data-ttu-id="ce5f8-126">На этом рисунке показано действие двух различных конфигураций обновления на размер моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-126">The following figure illustrates the effects of two contrasting update patterns on the size of a snapshot.</span></span> <span data-ttu-id="ce5f8-127">Конфигурация обновления А отражает условия, при которых в течение жизни моментального снимка обновляется только 30% всех исходных страниц.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-127">Update pattern A reflects an environment in which only 30 percent of the original pages are updated during the life of the snapshot.</span></span> <span data-ttu-id="ce5f8-128">Конфигурация обновления Б отражает условия, при которых в течение жизни моментального снимка обновляется только 80% всех исходных страниц.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-128">Update pattern B reflects an environment in which 80 percent of the original pages are updated during the life of the snapshot.</span></span>  
  
 <span data-ttu-id="ce5f8-129">![Другие шаблоны обновления и размеры моментальных снимков](../../database-engine/media/dbview-04.gif "Другие шаблоны обновления и размеры моментальных снимков")</span><span class="sxs-lookup"><span data-stu-id="ce5f8-129">![Alternative update patterns and snapshot size](../../database-engine/media/dbview-04.gif "Alternative update patterns and snapshot size")</span></span>  
  
##  <a name="benefits-of-database-snapshots"></a><a name="Benefits"></a> <span data-ttu-id="ce5f8-130">Преимущества моментальных снимков баз данных</span><span class="sxs-lookup"><span data-stu-id="ce5f8-130">Benefits of Database Snapshots</span></span>  
  
-   <span data-ttu-id="ce5f8-131">Моментальные снимки можно использовать для составления отчетов.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-131">Snapshots can be used for reporting purposes.</span></span>  
  
     <span data-ttu-id="ce5f8-132">Клиент может запрашивать моментальный снимок базы данных, что может потребоваться для создания отчетов на основе данных, относящихся к моменту создания моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-132">Clients can query a database snapshot, which makes it useful for writing reports based on the data at the time of snapshot creation.</span></span>  
  
-   <span data-ttu-id="ce5f8-133">Поддержка хронологических данных для создания отчетов.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-133">Maintaining historical data for report generation.</span></span>  
  
     <span data-ttu-id="ce5f8-134">Моментальный снимок позволяет пользователю получить доступ к данным по состоянию на определенный момент времени.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-134">A snapshot can extend user access to data from a particular point in time.</span></span> <span data-ttu-id="ce5f8-135">Например, моментальный снимок базы данных можно создать в конце определенного периода времени (например, финансового квартала) для последующего создания отчетов.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-135">For example, you can create a database snapshot at the end of a given time period (such as a financial quarter) for later reporting.</span></span> <span data-ttu-id="ce5f8-136">Отчеты о каждом таком периоде будут создаваться на основе данных из моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-136">You can then run end-of-period reports on the snapshot.</span></span> <span data-ttu-id="ce5f8-137">Если на диске достаточно свободного места, можно создавать такие моментальные снимки для каждого отчетного периода и разрешить запросы результатов по отчетным периодам, что может понадобиться, например для исследования эффективности деятельности организации.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-137">If disk space permits, you can also maintain end-of-period snapshots indefinitely, allowing queries against the results from these periods; for example, to investigate organizational performance.</span></span>  
  
-   <span data-ttu-id="ce5f8-138">Экономия ресурсов за счет доступности данных, необходимых для создания отчетов, в зеркальных базах данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-138">Using a mirror database that you are maintaining for availability purposes to offload reporting.</span></span>  
  
     <span data-ttu-id="ce5f8-139">Применение моментальных снимков с зеркальным отображением баз данных позволяет сделать данные на зеркальном сервере доступными для отчетов.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-139">Using database snapshots with database mirroring permits you to make the data on the mirror server accessible for reporting.</span></span> <span data-ttu-id="ce5f8-140">Кроме того, выполнение запросов в зеркальной базе данных может освободить ресурсы основной базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-140">Additionally, running queries on the mirror database can free up resources on the principal.</span></span> <span data-ttu-id="ce5f8-141">Дополнительные сведения см. в статье [Зеркальное отображение и моментальные снимки баз данных (SQL Server)](database-snapshots-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="ce5f8-141">For more information, see [Database Mirroring and Database Snapshots &#40;SQL Server&#41;](database-snapshots-sql-server.md).</span></span>  
  
-   <span data-ttu-id="ce5f8-142">Защита данных от административных ошибок.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-142">Safeguarding data against administrative error.</span></span>  
  
-   <span data-ttu-id="ce5f8-143">При возникновении пользовательской ошибки в базе данных-источнике эту базу данных можно вернуть к состоянию, в котором она находилась на момент создания определенного моментального снимка базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-143">In the event of a user error on a source database, you can revert the source database to the state it was in when a given database snapshot was created.</span></span> <span data-ttu-id="ce5f8-144">Потеря данных затронет только изменения в базе данных, произведенные после создания моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-144">Data loss is confined to updates to the database since the snapshot's creation.</span></span>  
  
     <span data-ttu-id="ce5f8-145">Перед серьезными обновлениями, такими как массовое обновление или изменение схемы, следует создать моментальный снимок базы данных для защиты данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-145">For example, before doing major updates, such as a bulk update or a schema change, create a database snapshot on the database protects data.</span></span> <span data-ttu-id="ce5f8-146">В случае ошибки можно будет восстановить базу данных путем возврата ее в предыдущее состояние с помощью моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-146">If you make a mistake, you can use the snapshot to recover by reverting the database to the snapshot.</span></span> <span data-ttu-id="ce5f8-147">Потенциально процедура возврата занимает гораздо меньше времени, чем восстановление из резервной копии, но при этом она не поддерживает накат.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-147">Reverting is potentially much faster for this purpose than restoring from a backup; however, you cannot roll forward afterward.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="ce5f8-148">Восстановление неприменимо к поврежденной базе данных и к базе данных, находящейся в режиме вне сети.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-148">Reverting does not work in an offline or corrupted database.</span></span> <span data-ttu-id="ce5f8-149">Таким образом, создание регулярных резервных копий и тестирование плана восстановления необходимы для защиты базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-149">Therefore, taking regular backups and testing your restore plan are necessary to protect a database.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="ce5f8-150">Моментальные снимки базы данных зависят от базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-150">Database snapshots are dependent on the source database.</span></span> <span data-ttu-id="ce5f8-151">Следовательно, стратегию резервного копирования и восстановления не следует заменять восстановлением данных с помощью моментальных снимков базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-151">Therefore, using database snapshots for reverting a database is not a substitute for your backup and restore strategy.</span></span> <span data-ttu-id="ce5f8-152">Плановое создание резервных копий остается основным действием.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-152">Performing all your scheduled backups remains essential.</span></span> <span data-ttu-id="ce5f8-153">Если необходимо восстановить базу данных-источник на момент времени, в который был создан моментальный снимок базы данных, реализуйте политику резервного копирования, позволяющую это делать.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-153">If you must restore the source database to the point in time at which you created a database snapshot, implement a backup policy that enables you to do that.</span></span>  
  
-   <span data-ttu-id="ce5f8-154">Защита данных от пользовательских ошибок.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-154">Safeguarding data against user error.</span></span>  
  
     <span data-ttu-id="ce5f8-155">Регулярное создание моментальных снимков базы данных может уменьшить ущерб от серьезных ошибок пользователей, например от удаления той или иной таблицы.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-155">By creating database snapshots on a regular basis, you can mitigate the impact of a major user error, such as a dropped table.</span></span> <span data-ttu-id="ce5f8-156">Чтобы обеспечить высокий уровень защиты можно создать несколько моментальных снимков баз данных, охватывающих период времени, достаточный, чтобы распознать большинство пользовательских ошибок и устранить их последствия.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-156">For a high level of protection, you can create a series of database snapshots spanning enough time to recognize and respond to most user errors.</span></span> <span data-ttu-id="ce5f8-157">Например, если достаточно свободного места на диске, то можно поддерживать от 6 до 12 моментальных снимков, охватывающих 24-часовой интервал.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-157">For instance, you might maintain 6 to 12 rolling snapshots spanning a 24-hour interval, depending on your disk resources.</span></span> <span data-ttu-id="ce5f8-158">При создании следующего моментального снимка самый ранний будет удаляться.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-158">Then, each time a new snapshot is created, the earliest snapshot can be deleted.</span></span>  
  
    -   <span data-ttu-id="ce5f8-159">Для устранения ошибки пользователя можно с помощью моментального снимка вернуть базу данных в состояние непосредственно перед этой ошибкой.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-159">To recover from a user error, you can revert the database to the snapshot immediately before the error.</span></span> <span data-ttu-id="ce5f8-160">Потенциально процедура возврата занимает гораздо меньше времени, чем восстановление из резервной копии, но при этом она не поддерживает накат.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-160">Reverting is potentially much faster for this purpose than restoring from a backup; however, you cannot roll forward afterward.</span></span>  
  
    -   <span data-ttu-id="ce5f8-161">Кроме того, удаленную таблицу или другие потерянные данные можно восстановить вручную по данным в моментальном снимке.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-161">Alternatively, you may be able to manually reconstruct a dropped table or other lost data from the information in a snapshot.</span></span> <span data-ttu-id="ce5f8-162">Например, можно выполнить массовое копирование данных из моментального снимка в базу данных и вручную выполнить слияние данных в базе.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-162">For instance, you could bulk copy the data out of the snapshot into the database and manually merge the data back into the database.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="ce5f8-163">От причины использования моментальных снимков зависит число параллельных снимков для одной базы данных, частота создания новых снимков и срок их хранения.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-163">Your reasons for using database snapshots determine how many concurrent snapshots you need on a database, how frequently to create a new snapshot, and how long to keep it.</span></span>  
  
-   <span data-ttu-id="ce5f8-164">Управление тестовой базой данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-164">Managing a test database</span></span>  
  
     <span data-ttu-id="ce5f8-165">При повторяющемся выполнении тестового протокола в базе данных тестовой среды полезно, чтобы база данных содержала одинаковые данные в начале каждого цикла тестирования.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-165">In a testing environment, it can be useful when repeatedly running a test protocol for the database to contain identical data at the start of each round of testing.</span></span> <span data-ttu-id="ce5f8-166">Перед выполнением первого цикла разработчик приложения или тестировщик может создать моментальный снимок тестовой базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-166">Before running the first round, an application developer or tester can create a database snapshot on the test database.</span></span> <span data-ttu-id="ce5f8-167">После каждого запуска тестирования базу данных можно быстро вернуть в предыдущее состояние путем возврата моментального снимка базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-167">After each test run, the database can be quickly returned to its prior state by reverting the database snapshot.</span></span>  
  
##  <a name="terms-and-definitions"></a><a name="TermsAndDefinitions"></a> <span data-ttu-id="ce5f8-168">Термины и определения</span><span class="sxs-lookup"><span data-stu-id="ce5f8-168">Terms and Definitions</span></span>  
 <span data-ttu-id="ce5f8-169">database snapshot</span><span class="sxs-lookup"><span data-stu-id="ce5f8-169">database snapshot</span></span>  
 <span data-ttu-id="ce5f8-170">Согласованное на уровне транзакций, доступное только для чтения статическое представление базы данных (базы данных-источника).</span><span class="sxs-lookup"><span data-stu-id="ce5f8-170">A transactionally consistent, read-only, static view of a database (the source database).</span></span>  
  
 <span data-ttu-id="ce5f8-171">базы данных-источника</span><span class="sxs-lookup"><span data-stu-id="ce5f8-171">source database</span></span>  
 <span data-ttu-id="ce5f8-172">Для моментального снимка базы данных — база данных, в которой создан моментальный снимок.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-172">For a database snapshot, the database on which the snapshot was created.</span></span> <span data-ttu-id="ce5f8-173">Моментальные снимки базы данных зависят от базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-173">Database snapshots are dependent on the source database.</span></span> <span data-ttu-id="ce5f8-174">Они должны находиться на одном экземпляре сервера вместе с базой данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-174">The snapshots of a database must be on the same server instance as the database.</span></span> <span data-ttu-id="ce5f8-175">Более того, если по какой-либо причине база данных становится недоступной, все ее моментальные снимки также становятся недоступными.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-175">Furthermore, if that database becomes unavailable for any reason, all of its database snapshots also become unavailable.</span></span>  
  
 <span data-ttu-id="ce5f8-176">разреженный файл</span><span class="sxs-lookup"><span data-stu-id="ce5f8-176">sparse file</span></span>  
 <span data-ttu-id="ce5f8-177">Файл, предоставленный файловой системой NTFS, в результате чего он занимает значительно меньше места на диске, чем обычные файлы.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-177">A file provided by the NTFS file system that requires much less disk space than would otherwise be needed.</span></span> <span data-ttu-id="ce5f8-178">Разреженный файл используется для хранения страниц, помещенных в моментальный снимок базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-178">A sparse file is used to store pages copied to a database snapshot.</span></span> <span data-ttu-id="ce5f8-179">После создания разреженный файл занимает немного места на диске.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-179">When first created, a sparse file takes up little disk space.</span></span> <span data-ttu-id="ce5f8-180">По мере занесения данных в моментальный снимок базы данных файловая система NTFS постепенно выделяет место на диске для соответствующего разреженного файла.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-180">As data is written to a database snapshot, NTFS allocates disk space gradually to the corresponding sparse file.</span></span>  
  
##  <a name="prerequisites-for-and-limitations-on-database-snapshots"></a><a name="LimitationsRequirements"></a> <span data-ttu-id="ce5f8-181">Обязательные условия и ограничения для моментальных снимков базы данных</span><span class="sxs-lookup"><span data-stu-id="ce5f8-181">Prerequisites for and Limitations on Database Snapshots</span></span>  
 <span data-ttu-id="ce5f8-182">**В этом разделе.**</span><span class="sxs-lookup"><span data-stu-id="ce5f8-182">**In This Section:**</span></span>  
  
-   [<span data-ttu-id="ce5f8-183">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="ce5f8-183">Prerequisites</span></span>](#Prerequisites)  
  
-   [<span data-ttu-id="ce5f8-184">Ограничения по базе данных-источнику</span><span class="sxs-lookup"><span data-stu-id="ce5f8-184">Limitations on the Source Database</span></span>](#LimitsOnSourceDb)  
  
-   [<span data-ttu-id="ce5f8-185">Ограничения по моментальным снимкам баз данных</span><span class="sxs-lookup"><span data-stu-id="ce5f8-185">Limitations on Database Snapshots</span></span>](#LimitsOnDbSS)  
  
-   [<span data-ttu-id="ce5f8-186">Требования к месту на диске</span><span class="sxs-lookup"><span data-stu-id="ce5f8-186">Disk Space Requirements</span></span>](#DiskSpace)  
  
-   [<span data-ttu-id="ce5f8-187">Моментальные снимки базы данных с файловыми группами вне сети</span><span class="sxs-lookup"><span data-stu-id="ce5f8-187">Database Snapshots with Offline Filegroups</span></span>](#OfflineFGs)  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="ce5f8-188">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="ce5f8-188">Prerequisites</span></span>  
 <span data-ttu-id="ce5f8-189">База данных-источник, в которой может применяться любая модель восстановления, должна соответствовать следующим предварительным требованиям.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-189">The source database, which can use any recovery model, must meet the following prerequisites:</span></span>  
  
-   <span data-ttu-id="ce5f8-190">Экземпляр сервера должен работать на выпуске [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , который поддерживает моментальные снимки баз данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-190">The server instance must be running on an edition of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that supports database snapshots.</span></span> <span data-ttu-id="ce5f8-191">Дополнительные сведения см. [в разделе функции, поддерживаемые различными Выпусками SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span><span class="sxs-lookup"><span data-stu-id="ce5f8-191">For more information, see [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>  
  
-   <span data-ttu-id="ce5f8-192">База данных-источник должна быть в режиме в сети, если база данных не является зеркальной в сеансе зеркального отображения базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-192">The source database must be online, unless the database is a mirror database within a database mirroring session.</span></span>  
  
-   <span data-ttu-id="ce5f8-193">Моментальный снимок базы данных можно создать в любой базе данных-источнике или базе данных-получателе в группе доступности.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-193">You can create a database snapshot on any primary or secondary database in an availability group.</span></span> <span data-ttu-id="ce5f8-194">Ролью реплики должна быть PRIMARY или SECONDARY, она не может находиться в состоянии RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-194">The replica role must be either PRIMARY or SECONDARY, not in the RESOLVING state.</span></span>  
  
     <span data-ttu-id="ce5f8-195">Для создания моментального снимка рекомендуется, чтобы состояние синхронизации базы данных было SYNCHRONIZING или SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-195">We recommend that the database synchronization state be SYNCHRONIZING or SYNCHRONIZED when you create a database snapshot.</span></span> <span data-ttu-id="ce5f8-196">Однако моментальные снимки базы данных могут создаваться и в состоянии синхронизации базы данных NOT SYNCHRONIZING.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-196">However, database snapshots can be created when the database synchronization state is NOT SYNCHRONIZING.</span></span>  
  
     <span data-ttu-id="ce5f8-197">Дополнительные сведения см. в статье [ Моментальные снимки баз данных для групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/database-snapshots-with-always-on-availability-groups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="ce5f8-197">For more information, see [Database Snapshots with AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/database-snapshots-with-always-on-availability-groups-sql-server.md).</span></span>  
  
-   <span data-ttu-id="ce5f8-198">Для создания моментального снимка в зеркальной базе данных эта база данных должна быть в состоянии зеркального отображения SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-198">To create a database snapshot on a mirror database, the database must be in the SYNCHRONIZED mirroring state.</span></span>  
  
-   <span data-ttu-id="ce5f8-199">База данных-источник не может быть настроена в качестве масштабируемой общей базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-199">The source database cannot be configured as a scalable shared database.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ce5f8-200">Все модели восстановления поддерживают моментальные снимки базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-200">All recovery models support database snapshots.</span></span>  
  
###  <a name="limitations-on-the-source-database"></a><a name="LimitsOnSourceDb"></a> <span data-ttu-id="ce5f8-201">Ограничения по базе данных-источнику</span><span class="sxs-lookup"><span data-stu-id="ce5f8-201">Limitations on the Source Database</span></span>  
 <span data-ttu-id="ce5f8-202">В течение всего периода существования моментального снимка базы данных имеются следующие ограничения по базе данных-источнику моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-202">As long as a database snapshot exists, the following limitations exist on the snapshot's source database:</span></span>  
  
-   <span data-ttu-id="ce5f8-203">База данных не может быть сброшена, отсоединена или восстановлена.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-203">The database cannot be dropped, detached, or restored.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="ce5f8-204">Резервное копирование базы данных-источника работает как обычно; на него не оказывают влияния моментальные снимки базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-204">Backing up the source database works normally; it is unaffected by database snapshots.</span></span>  
  
-   <span data-ttu-id="ce5f8-205">Производительность снижается по причине увеличения количества операций ввода-вывода в базе данных-источнике из-за выполнения операции копирования при записи в моментальный снимок всякий раз при обновлении страницы.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-205">Performance is reduced, due to increased I/O on the source database resulting from a copy-on-write operation to the snapshot every time a page is updated.</span></span>  
  
-   <span data-ttu-id="ce5f8-206">Файлы не могут быть сброшены из базы данных-источника или из любых моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-206">Files cannot be dropped from the source database or from any snapshots.</span></span>  
  
###  <a name="limitations-on-database-snapshots"></a><a name="LimitsOnDbSS"></a> <span data-ttu-id="ce5f8-207">Ограничения по моментальным снимкам баз данных</span><span class="sxs-lookup"><span data-stu-id="ce5f8-207">Limitations on Database Snapshots</span></span>  
 <span data-ttu-id="ce5f8-208">Следующие ограничения применяются к моментальным снимкам базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-208">The following limitations apply to database snapshots:</span></span>  
  
-   <span data-ttu-id="ce5f8-209">Моментальный снимок базы данных должен создаваться и оставаться на том же экземпляре сервера, что и база данных-источник.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-209">A database snapshot must be created and remain on the same server instance as the source database.</span></span>  
  
-   <span data-ttu-id="ce5f8-210">Моментальные снимки базы данных всегда применяются на всей базе данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-210">Database snapshots always work on an entire database.</span></span>  
  
-   <span data-ttu-id="ce5f8-211">Моментальные снимки базы данных связаны с базой данных-источником и не являются избыточным хранилищем данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-211">Database snapshots are dependent on the source database and are not redundant storage.</span></span> <span data-ttu-id="ce5f8-212">Они не защищают от ошибок диска или других видов повреждений.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-212">They do not protect against disk errors or other types of corruption.</span></span> <span data-ttu-id="ce5f8-213">Следовательно, стратегию резервного копирования и восстановления не следует заменять восстановлением данных с помощью моментальных снимков базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-213">Therefore, using database snapshots for reverting a database is not a substitute for your backup and restore strategy.</span></span> <span data-ttu-id="ce5f8-214">Плановое создание резервных копий остается основным действием.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-214">Performing all your scheduled backups remains essential.</span></span> <span data-ttu-id="ce5f8-215">Если необходимо восстановить базу данных-источник на момент времени, в который был создан моментальный снимок базы данных, реализуйте политику резервного копирования, позволяющую это делать.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-215">If you must restore the source database to the point in time at which you created a database snapshot, implement a backup policy that enables you to do that.</span></span>  
  
-   <span data-ttu-id="ce5f8-216">Если при обновлении страницы в базе данных-источнике и при записи этого обновления в моментальный снимок не хватает места на диске или возникает какая-либо иная ошибка, моментальный снимок становится подозрительным и должен быть удален.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-216">When a page getting updated on the source database is pushed to a snapshot, if the snapshot runs out of disk space or encounters some other error, the snapshot becomes suspect and must be deleted.</span></span>  
  
-   <span data-ttu-id="ce5f8-217">Моментальные снимки доступны только для чтения.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-217">Snapshots are read-only.</span></span> <span data-ttu-id="ce5f8-218">Так как они доступны только для чтения, они не могут быть обновлены.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-218">Since they are read only, they cannot be upgraded.</span></span> <span data-ttu-id="ce5f8-219">Таким образом, моментальные снимки базы данных не будут работоспособны после обновления.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-219">Therefore, database snapshots are not expected to be viable after an upgrade.</span></span>  
  
-   <span data-ttu-id="ce5f8-220">Создание моментальных снимков баз данных **model**, **master**и **tempdb** запрещено.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-220">Snapshots of the **model**, **master**, and **tempdb** databases are prohibited.</span></span>  
  
-   <span data-ttu-id="ce5f8-221">Нельзя изменять любые из характеристик файлов моментального снимка базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-221">You cannot change any of the specifications of the database snapshot files.</span></span>  
  
-   <span data-ttu-id="ce5f8-222">Нельзя удалять файлы из моментального снимка базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-222">You cannot drop files from a database snapshot.</span></span>  
  
-   <span data-ttu-id="ce5f8-223">Нельзя выполнять резервное копирование или восстановление моментальных снимков базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-223">You cannot back up or restore database snapshots.</span></span>  
  
-   <span data-ttu-id="ce5f8-224">Нельзя присоединять или отсоединять моментальные снимки базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-224">You cannot attach or detach database snapshots.</span></span>  
  
-   <span data-ttu-id="ce5f8-225">Нельзя создавать моментальные снимки базы данных в файловой системе FAT32 или в необработанных секциях.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-225">You cannot create database snapshots on FAT32 file system or RAW partitions.</span></span> <span data-ttu-id="ce5f8-226">Разреженные файлы, используемые моментальными снимками базы данных, предоставляются файловой системой NTFS.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-226">The sparse files used by database snapshots are provided by the NTFS file system.</span></span>  
  
-   <span data-ttu-id="ce5f8-227">Полнотекстовое индексирование не поддерживается на моментальных снимках базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-227">Full-text indexing is not supported on database snapshots.</span></span> <span data-ttu-id="ce5f8-228">Полнотекстовые каталоги не распространяются из базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-228">Full-text catalogs are not propagated from the source database.</span></span>  
  
-   <span data-ttu-id="ce5f8-229">Моментальный снимок базы данных наследует ограничения безопасности своей базы данных-источника на момент создания моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-229">A database snapshot inherits the security constraints of its source database at the time of snapshot creation.</span></span> <span data-ttu-id="ce5f8-230">Поскольку моментальные снимки обладают свойством «только для чтения», наследуемые разрешения не могут быть изменены, и изменения, совершенные в отношении источника, не будут отражены в существующих моментальных снимках.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-230">Because snapshots are read-only, inherited permissions cannot be changed and permission changes made to the source will not be reflected in existing snapshots.</span></span>  
  
-   <span data-ttu-id="ce5f8-231">Моментальный снимок всегда отражает состояние файловых групп на момент создания снимка: если файловая группа была в сети, она остается в сети, если же она была отключена, она остается вне сети.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-231">A snapshot always reflects the state of filegroups at the time of snapshot creation: online filegroups remain online, and offline filegroups remain offline.</span></span> <span data-ttu-id="ce5f8-232">Дополнительные сведения см. в подразделе «Моментальные снимки базы данных с файловыми группами вне сети» далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-232">For more information, see "Database Snapshots with Offline Filegroups" later in this topic.</span></span>  
  
-   <span data-ttu-id="ce5f8-233">Если база данных-источник становится RECOVERY_PENDING, ее моментальные снимки могут стать недоступными.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-233">If a source database becomes RECOVERY_PENDING, its database snapshots may become inaccessible.</span></span> <span data-ttu-id="ce5f8-234">Однако после решения проблемы в базе данных-источнике ее моментальные снимки должны вновь стать доступными.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-234">After the issue on the source database is resolved, however, its snapshots should become available again.</span></span>  
  
-   <span data-ttu-id="ce5f8-235">Возвращение к исходному состоянию не поддерживается для файловых групп со свойством «только для чтения» и сжатых файловых групп.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-235">Reverting is unsupported for read-only filegroups and for compressed filegroups.</span></span> <span data-ttu-id="ce5f8-236">Попытки возвращения базы данных, содержащей один из этих типов файловых групп, завершатся неудачно.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-236">Attempts to revert a database containing either of these types of filegroups fail.</span></span>  
  
-   <span data-ttu-id="ce5f8-237">В конфигурации доставки журналов моментальные снимки базы данных могут быть только созданы в базе данных-источнике, а не в базе данных-получателе.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-237">In a log shipping configuration, database snapshots can be created only on the primary database, not on a secondary database.</span></span> <span data-ttu-id="ce5f8-238">Если роли переключаются между экземплярами сервера-источника и сервера-получателя, необходимо удалить все моментальные снимки базы данных, перед тем как станет возможным настроить основную базы данных в качестве базы данных-получателя.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-238">If you switch roles between the primary server instance and a secondary server instance, you must drop all the database snapshots before you can set the primary database up as a secondary database.</span></span>  
  
-   <span data-ttu-id="ce5f8-239">Моментальный снимок базы данных не может быть настроен в качестве масштабируемой общей базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-239">A database snapshot cannot be configured as a scalable shared database.</span></span>  
  
-   <span data-ttu-id="ce5f8-240">В моментальных снимках базы данных не поддерживаются файловые группы FILESTREAM.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-240">FILESTREAM filegroups are not supported by database snapshots.</span></span> <span data-ttu-id="ce5f8-241">Если в базе данных-источнике существуют файловые группы FILESTREAM, они помечаются как вне сети в ее моментальных снимках и их нельзя использовать для восстановления базы в исходное состояние.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-241">If FILESTREAM filegroups exist in a source database, they are marked as offline in its database snapshots, and the database snapshots cannot be used for reverting the database.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="ce5f8-242">В инструкции SELECT, применяемой к моментальному снимку базы данных, нельзя указывать столбцы FILESTREAM; в противном случае будет возвращено следующее сообщение об ошибке: `Could not continue scan with NOLOCK due to data movement.`</span><span class="sxs-lookup"><span data-stu-id="ce5f8-242">A SELECT statement that is executed on a database snapshot must not specify a FILESTREAM column; otherwise, the following error message will be returned: `Could not continue scan with NOLOCK due to data movement.`</span></span>  
  
-   <span data-ttu-id="ce5f8-243">Если статистика для доступного только для чтения моментального снимка отсутствует или устарела, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] создаст и будет поддерживать временную статистику в базе данных tempdb.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-243">When statistics on a read-only snapshot are missing or stale, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] creates and maintains temporary statistics in tempdb.</span></span> <span data-ttu-id="ce5f8-244">Дополнительные сведения см. в статье [Managing statistics on tables in SQL Data Warehouse](../statistics/statistics.md) (Управление статистикой таблиц в хранилище данных SQL).</span><span class="sxs-lookup"><span data-stu-id="ce5f8-244">For more information, see [Statistics](../statistics/statistics.md).</span></span>  
  
###  <a name="disk-space-requirements"></a><a name="DiskSpace"></a> <span data-ttu-id="ce5f8-245">Требования к месту на диске</span><span class="sxs-lookup"><span data-stu-id="ce5f8-245">Disk Space Requirements</span></span>  
 <span data-ttu-id="ce5f8-246">Моментальные снимки базы данных занимают место на диске.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-246">Database snapshots consume disk space.</span></span> <span data-ttu-id="ce5f8-247">Если для моментального снимка базы данных не хватает места на диске, он помечается как подозрительный и должен быть сброшен.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-247">If a database snapshot runs out of disk space, it is marked as suspect and must be dropped.</span></span> <span data-ttu-id="ce5f8-248">(Однако на базу данных-источник влияния не оказывается; действия в ней продолжаются, как обычно.) В сравнении с полной копией базы данных моментальные снимки намного более эффективны в вопросе использования места на диске.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-248">(The source database, however, is not affected; actions on it continue normally.) Compared to a full copy of a database, however, snapshots are highly space efficient.</span></span> <span data-ttu-id="ce5f8-249">Моментальный снимок требует лишь столько места, сколько необходимо для хранения страниц, изменяющихся в период его существования.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-249">A snapshot requires only enough storage for the pages that change during its lifetime.</span></span> <span data-ttu-id="ce5f8-250">В целом, моментальные снимки хранятся ограниченное время, поэтому их размер не является предметом первостепенной важности.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-250">Generally, snapshots are kept for a limited time, so their size is not a major concern.</span></span>  
  
 <span data-ttu-id="ce5f8-251">Однако чем дольше хранится моментальный снимок, тем больше вероятность того, что он израсходует все доступное место на диске.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-251">The longer you keep a snapshot, however, the more likely it is to use up available space.</span></span> <span data-ttu-id="ce5f8-252">Максимальным размером, до которого может вырасти разреженный файл, является размер соответствующего файла базы данных-источника на момент создания моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-252">The maximum size to which a sparse file can grow is the size of the corresponding source database file at the time of the snapshot creation.</span></span>  
  
 <span data-ttu-id="ce5f8-253">Если для моментального снимка базы данных не хватает места на диске, он должен быть удален (сброшен).</span><span class="sxs-lookup"><span data-stu-id="ce5f8-253">If a database snapshot runs out of disk space, it must be deleted (dropped).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ce5f8-254">За исключением места для файла, моментальный снимок базы данных использует примерно столько же ресурсов, что и база данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-254">Except for file space, a database snapshot consumes roughly as many resources as a database.</span></span>  
  
###  <a name="database-snapshots-with-offline-filegroups"></a><a name="OfflineFGs"></a> <span data-ttu-id="ce5f8-255">Моментальные снимки базы данных с файловыми группами вне сети</span><span class="sxs-lookup"><span data-stu-id="ce5f8-255">Database Snapshots with Offline Filegroups</span></span>  
 <span data-ttu-id="ce5f8-256">Файловые группы вне сети в базе данных-источнике оказывают влияние на моментальные снимки базы данных при попытке выполнить любое из следующих действий.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-256">Offline filegroups in the source database affect database snapshots when you try to do any of the following:</span></span>  
  
-   <span data-ttu-id="ce5f8-257">Создание моментального снимка</span><span class="sxs-lookup"><span data-stu-id="ce5f8-257">Create a snapshot</span></span>  
  
     <span data-ttu-id="ce5f8-258">Когда в базе данных-источнике имеется одна или несколько файловых групп вне сети, создание моментального снимка завершается успешно с файловыми группами вне сети.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-258">When a source database has one or more offline filegroups, snapshot creation succeeds with the filegroups offline.</span></span> <span data-ttu-id="ce5f8-259">Разреженные файлы не создаются для файловых групп вне сети.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-259">Sparse files are not created for the offline filegroups.</span></span>  
  
-   <span data-ttu-id="ce5f8-260">Перевод файловой группы в режим вне сети</span><span class="sxs-lookup"><span data-stu-id="ce5f8-260">Take a filegroup offline</span></span>  
  
     <span data-ttu-id="ce5f8-261">Можно перевести файл в режим вне сети в базе данных-источнике.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-261">You can take a file offline in the source database.</span></span> <span data-ttu-id="ce5f8-262">Однако файловая группа останется в режиме в сети в моментальных снимках базы данных, если она находилась в режиме в сети на момент создания моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-262">However, the filegroup remains online in database snapshots if it was online when the snapshot was created.</span></span> <span data-ttu-id="ce5f8-263">Если запрашиваемые данные были изменены с момента создания моментального снимка, оригинальная страница данных будет доступна в моментальном снимке.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-263">If the queried data has changed since snapshot creation, the original data page will be accessible in the snapshot.</span></span> <span data-ttu-id="ce5f8-264">Однако выполнение запросов, использующих моментальный снимок для доступа к неизмененным данным в файловой группе, скорее всего, завершится неудачно с ошибками ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-264">However, queries that use the snapshot to access unmodified data in the filegroup are likely to fail with input/output (I/O) errors.</span></span>  
  
-   <span data-ttu-id="ce5f8-265">Перевод файловой группы в режим в сети</span><span class="sxs-lookup"><span data-stu-id="ce5f8-265">Bring a filegroup online</span></span>  
  
     <span data-ttu-id="ce5f8-266">Нельзя перевести файловую группу в режим в сети в базе данных, в которой имеются моментальные снимки базы данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-266">You cannot bring a filegroup online in a database that has any database snapshots.</span></span> <span data-ttu-id="ce5f8-267">Если файловая группа находится в режиме вне  сети во время создания моментального снимка или отключена во время существования моментального снимка базы данных, файловая группа остается в режиме вне  сети.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-267">If a filegroup is offline at the time of snapshot creation or is taken offline while a database snapshot exists, the filegroup remains offline.</span></span> <span data-ttu-id="ce5f8-268">Это происходит потому, что перевод файла обратно в режим в сети запускает его восстановление, что невозможно при существовании моментального снимка в базе данных.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-268">This is because bringing a file back online involves restoring it, which is not possible if a database snapshot exists on the database.</span></span>  
  
-   <span data-ttu-id="ce5f8-269">Возврат базы данных-источника в состояние по моментальному снимку</span><span class="sxs-lookup"><span data-stu-id="ce5f8-269">Revert the source database to the snapshot</span></span>  
  
     <span data-ttu-id="ce5f8-270">Восстановление базы данных-источника к состоянию на момент создания моментального снимка базы данных требует, чтобы все файловые группы находились в режиме «в сети», за исключением файловых групп, которые были «вне сети» при создании моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="ce5f8-270">Reverting a source database to a database snapshot requires that all of the filegroups are online except for filegroups that were offline when the snapshot was created.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="ce5f8-271">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="ce5f8-271">Related Tasks</span></span>  
  
-   [<span data-ttu-id="ce5f8-272">Создание моментального снимка базы данных (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="ce5f8-272">Create a Database Snapshot &#40;Transact-SQL&#41;</span></span>](create-a-database-snapshot-transact-sql.md)  
  
-   [<span data-ttu-id="ce5f8-273">Просмотр моментального снимка базы данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="ce5f8-273">View a Database Snapshot &#40;SQL Server&#41;</span></span>](view-a-database-snapshot-sql-server.md)  
  
-   [<span data-ttu-id="ce5f8-274">Просмотр размера разреженного файла снимка базы данных (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="ce5f8-274">View the Size of the Sparse File of a Database Snapshot &#40;Transact-SQL&#41;</span></span>](view-the-size-of-the-sparse-file-of-a-database-snapshot-transact-sql.md)  
  
-   [<span data-ttu-id="ce5f8-275">Восстановление базы данных до состояния, сохраненного в моментальном снимке</span><span class="sxs-lookup"><span data-stu-id="ce5f8-275">Revert a Database to a Database Snapshot</span></span>](revert-a-database-to-a-database-snapshot.md)  
  
-   [<span data-ttu-id="ce5f8-276">Удаление моментального снимка базы данных (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="ce5f8-276">Drop a Database Snapshot &#40;Transact-SQL&#41;</span></span>](drop-a-database-snapshot-transact-sql.md)  
  
## <a name="see-also"></a><span data-ttu-id="ce5f8-277">См. также:</span><span class="sxs-lookup"><span data-stu-id="ce5f8-277">See Also</span></span>  
 [<span data-ttu-id="ce5f8-278">Зеркальное отображение и моментальные снимки баз данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="ce5f8-278">Database Mirroring and Database Snapshots &#40;SQL Server&#41;</span></span>](database-snapshots-sql-server.md)  
  
  
