---
title: Использование WQL с поставщиком WMI для событий сервера | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: wmi
ms.topic: reference
helpviewer_keywords:
- queries [WMI]
- query language [WMI]
- WMI Query Language [WMI]
- WQL [WMI]
- WMI Provider for Server Events, WQL
ms.assetid: 58b67426-1e66-4445-8e2c-03182e94c4be
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: df2bbf5c6031781494695f95116441fde34bf4f5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87664057"
---
# <a name="using-wql-with-the-wmi-provider-for-server-events"></a><span data-ttu-id="adb3b-102">Использование WQL с поставщиком WMI для событий сервера</span><span class="sxs-lookup"><span data-stu-id="adb3b-102">Using WQL with the WMI Provider for Server Events</span></span>
  <span data-ttu-id="adb3b-103">Приложения управления могут получать доступ к событиям [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] с помощью поставщика WMI для событий сервера путем выполнения инструкций WMI Query Language (WQL).</span><span class="sxs-lookup"><span data-stu-id="adb3b-103">Management applications access [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] events using the WMI Provider for Server Events by issuing WMI Query Language (WQL) statements.</span></span> <span data-ttu-id="adb3b-104">WQL является упрощенным подмножеством языка SQL с некоторыми расширениями, специфичными для WMI.</span><span class="sxs-lookup"><span data-stu-id="adb3b-104">WQL is a simplified subset of structured query language (SQL), with some WMI-specific extensions.</span></span> <span data-ttu-id="adb3b-105">При использовании WQL приложение извлекает тип события из определенного экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], базы данных или объекта базы данных (в настоящее время поддерживаются только объекты очереди).</span><span class="sxs-lookup"><span data-stu-id="adb3b-105">In using WQL, an application retrieves an event type against a specific instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a database, or a database object (the only object currently supported is queue).</span></span> <span data-ttu-id="adb3b-106">Поставщик WMI для событий сервера преобразует запрос в уведомление о событии, которое создается в целевой базе данных для уведомлений о событиях уровня базы данных или области объекта, или в базе данных **master** для уведомлений о событиях на уровне сервера.</span><span class="sxs-lookup"><span data-stu-id="adb3b-106">The WMI Provider for Server Events translates the query into an event notification that is created in the target database for database-scoped or object-scoped event notifications, or in the **master** database for server-scoped event notifications.</span></span>  
  
 <span data-ttu-id="adb3b-107">Например, рассмотрим следующий WQL-запрос.</span><span class="sxs-lookup"><span data-stu-id="adb3b-107">For example, consider the following WQL query:</span></span>  
  
```  
SELECT * FROM DDL_DATABASE_LEVEL_EVENTS WHERE DatabaseName = 'AdventureWorks'  
```  
  
 <span data-ttu-id="adb3b-108">На основе этого запроса поставщик WMI совершает попытку создать эквивалент этого уведомления о событии на целевом сервере.</span><span class="sxs-lookup"><span data-stu-id="adb3b-108">From this query, the WMI Provider tries to produce the equivalent of this event notification on the target server:</span></span>  
  
```  
USE AdventureWorks ;  
GO  
  
CREATE EVENT NOTIFICATION SQLWEP_76CF38C1_18BB_42DD_A7DC_C8820155B0E9  
    ON DATABASE  
    WITH FAN_IN  
    FOR DDL_DATABASE_LEVEL_EVENTS  
    TO SERVICE   
        'SQL/Notifications/ProcessWMIEventProviderNotification/v1.0',  
        'A7E5521A-1CA6-4741-865D-826F804E5135';  
GO  
```  
  
 <span data-ttu-id="adb3b-109">Аргумент в предложении `FROM` WQL-запроса (`DDL_DATABASE_LEVEL_EVENTS`) может представлять любое допустимое событие, о котором может быть создано уведомление.</span><span class="sxs-lookup"><span data-stu-id="adb3b-109">The argument in the `FROM` clause of the WQL query (`DDL_DATABASE_LEVEL_EVENTS`) can be any valid event upon which an event notification can be created.</span></span> <span data-ttu-id="adb3b-110">Аргументы в предложениях `SELECT` и `WHERE` могут указывать любые свойства событий, связанные с событием или его родительским событием.</span><span class="sxs-lookup"><span data-stu-id="adb3b-110">The arguments in the `SELECT` and `WHERE` clauses can specify any event property associated with an event or its parent event.</span></span> <span data-ttu-id="adb3b-111">Список допустимых событий и свойств событий см. в разделе [уведомления о событиях (ядро СУБД)](https://technet.microsoft.com/library/ms182602.aspx).</span><span class="sxs-lookup"><span data-stu-id="adb3b-111">For a list of valid events and event properties, see [Event Notifications (Database Engine)](https://technet.microsoft.com/library/ms182602.aspx).</span></span>  
  
 <span data-ttu-id="adb3b-112">Следующий синтаксис языка WQL явно поддерживается поставщиком WMI для событий сервера.</span><span class="sxs-lookup"><span data-stu-id="adb3b-112">The following WQL syntax is supported explicitly by the WMI Provider for Server Events.</span></span> <span data-ttu-id="adb3b-113">Может быть указан дополнительный синтаксис WQL, но он не зависит от этого поставщика и вместо этого анализируется службой узлов WMI.</span><span class="sxs-lookup"><span data-stu-id="adb3b-113">Additional WQL syntax may be specified, but it is not specific to this provider and is parsed instead by the WMI host service.</span></span> <span data-ttu-id="adb3b-114">Дополнительные сведения о языке запросов WMI см. в документации по WQL на веб-узле MSDN.</span><span class="sxs-lookup"><span data-stu-id="adb3b-114">For more information about the WMI Query Language, see the WQL documentation on the Microsoft Developer Network (MSDN).</span></span>  
  
## <a name="syntax"></a><span data-ttu-id="adb3b-115">Синтаксис</span><span class="sxs-lookup"><span data-stu-id="adb3b-115">Syntax</span></span>  
  
```  
  
SELECT { event_property [ ,...n ] | * }  
FROM event_type   
WHERE where_condition  
```  
  
## <a name="arguments"></a><span data-ttu-id="adb3b-116">Аргументы</span><span class="sxs-lookup"><span data-stu-id="adb3b-116">Arguments</span></span>  
 <span data-ttu-id="adb3b-117">*event_property*</span><span class="sxs-lookup"><span data-stu-id="adb3b-117">*event_property*</span></span>  
 <span data-ttu-id="adb3b-118">Свойство события.</span><span class="sxs-lookup"><span data-stu-id="adb3b-118">Is a property of an event.</span></span> <span data-ttu-id="adb3b-119">Например, `PostTime`, `SPID` и `LoginName`.</span><span class="sxs-lookup"><span data-stu-id="adb3b-119">Examples include `PostTime`, `SPID`, and `LoginName`.</span></span> <span data-ttu-id="adb3b-120">Найдите каждое событие в списке [поставщик WMI для классов событий сервера и свойства](wmi-provider-for-server-events-classes-and-properties.md) , чтобы определить, какие свойства он содержит.</span><span class="sxs-lookup"><span data-stu-id="adb3b-120">Look up each event listed in [WMI Provider for Server Events Classes and Properties](wmi-provider-for-server-events-classes-and-properties.md) to determine which properties it holds.</span></span> <span data-ttu-id="adb3b-121">Например, событие DDL_DATABASE_LEVEL_EVENTS имеет свойства `DatabaseName` и `UserName`.</span><span class="sxs-lookup"><span data-stu-id="adb3b-121">For example, the DDL_DATABASE_LEVEL_EVENTS event holds the `DatabaseName` and `UserName` properties.</span></span> <span data-ttu-id="adb3b-122">Также оно наследует свойства `SQLInstance`, `LoginName`, `PostTime`, `SPID` и `ComputerName` от родительских событий.</span><span class="sxs-lookup"><span data-stu-id="adb3b-122">It also inherits the `SQLInstance`, `LoginName`, `PostTime`, `SPID`, and `ComputerName` properties from its parent events.</span></span>  
  
 <span data-ttu-id="adb3b-123">**,** *... n*</span><span class="sxs-lookup"><span data-stu-id="adb3b-123">**,** *...n*</span></span>  
 <span data-ttu-id="adb3b-124">Указывает, что *event_property* можно запросить несколько раз, разделяя их запятыми.</span><span class="sxs-lookup"><span data-stu-id="adb3b-124">Indicates that *event_property* can be queried multiple times, separated by commas.</span></span>  
  
 \*  
 <span data-ttu-id="adb3b-125">Указывает, что запрашиваются все свойства, связанные с событием.</span><span class="sxs-lookup"><span data-stu-id="adb3b-125">Specifies that all properties associated with an event are queried.</span></span>  
  
 <span data-ttu-id="adb3b-126">*event_type*</span><span class="sxs-lookup"><span data-stu-id="adb3b-126">*event_type*</span></span>  
 <span data-ttu-id="adb3b-127">Событие, для которого может быть создано уведомление.</span><span class="sxs-lookup"><span data-stu-id="adb3b-127">Is any event against which an event notification can be created.</span></span> <span data-ttu-id="adb3b-128">Список доступных событий см. в разделе [поставщик WMI для классов событий сервера и свойства](https://technet.microsoft.com/library/ms186449.aspx).</span><span class="sxs-lookup"><span data-stu-id="adb3b-128">For a list of available events, see [WMI Provider for Server Events Classes and Properties](https://technet.microsoft.com/library/ms186449.aspx).</span></span> <span data-ttu-id="adb3b-129">Обратите внимание, что имена *типов событий* соответствуют одному и тому же *event_type*  |  *event_group* , которые могут быть указаны при создании уведомления о событии вручную с помощью команды создать уведомление о событии.</span><span class="sxs-lookup"><span data-stu-id="adb3b-129">Note that *event type* names correspond to the same *event_type* | *event_group* that can be specified when you manually create an event notification by using CREATE EVENT NOTIFICATION.</span></span> <span data-ttu-id="adb3b-130">Примеры *типов событий* включают CREATE_TABLE, LOCK_DEADLOCK, DDL_USER_EVENTS и TRC_DATABASE.</span><span class="sxs-lookup"><span data-stu-id="adb3b-130">Examples of *event type* include CREATE_TABLE, LOCK_DEADLOCK, DDL_USER_EVENTS, and TRC_DATABASE.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="adb3b-131">Определенные системные хранимые процедуры, выполняющие DDL-подобные операции, могут также вызывать формирование уведомления о событиях.</span><span class="sxs-lookup"><span data-stu-id="adb3b-131">Certain system stored procedures that perform DDL-like operations can also fire event notifications.</span></span> <span data-ttu-id="adb3b-132">Протестируйте свои уведомления о событиях, чтобы определить их реакцию на системные хранимые процедуры.</span><span class="sxs-lookup"><span data-stu-id="adb3b-132">Test your event notifications to determine their responses to system stored procedures that are run.</span></span> <span data-ttu-id="adb3b-133">Например, инструкция CREATE TYPE и хранимая процедура **sp_addtype** будут вызывать уведомление о событии, созданное для события CREATE_TYPE.</span><span class="sxs-lookup"><span data-stu-id="adb3b-133">For example, the CREATE TYPE statement and **sp_addtype** stored procedure will both fire an event notification that is created on a CREATE_TYPE event.</span></span> <span data-ttu-id="adb3b-134">Однако **sp_rename** хранимая процедура не запускает уведомления о событиях.</span><span class="sxs-lookup"><span data-stu-id="adb3b-134">However, the **sp_rename** stored procedure does not fire any event notifications.</span></span> <span data-ttu-id="adb3b-135">Дополнительные сведения см. в разделе[DDL Events](../triggers/ddl-events.md).</span><span class="sxs-lookup"><span data-stu-id="adb3b-135">For more information, see[DDL Events](../triggers/ddl-events.md).</span></span>  
  
 <span data-ttu-id="adb3b-136">*where_condition*</span><span class="sxs-lookup"><span data-stu-id="adb3b-136">*where_condition*</span></span>  
 <span data-ttu-id="adb3b-137">Предикат запроса предложения WHERE, состоящие из *event_property* имен и логических операторов и.</span><span class="sxs-lookup"><span data-stu-id="adb3b-137">Is a WHERE clause query predicate made up of *event_property* names and logical and comparison operators.</span></span> <span data-ttu-id="adb3b-138">*Where_condition* определяет область, в которой соответствующее уведомление о событии регистрируется в целевой базе данных.</span><span class="sxs-lookup"><span data-stu-id="adb3b-138">The *where_condition* determines the scope in which the corresponding event notification is registered in the target database.</span></span> <span data-ttu-id="adb3b-139">Он также может использоваться в качестве фильтра для конкретной схемы или объекта, из которого запрашиваются *event_type.*</span><span class="sxs-lookup"><span data-stu-id="adb3b-139">It can also act as a filter to target a particular schema or object from which to query *event_type.*</span></span> <span data-ttu-id="adb3b-140">Дополнительные сведения см. в подразделе «Примечания» далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="adb3b-140">For more information, see the Remarks section later in this topic.</span></span>  
  
 <span data-ttu-id="adb3b-141">Только операнд `=` может использоваться вместе с `DatabaseName`, `SchemaName` и `ObjectName`.</span><span class="sxs-lookup"><span data-stu-id="adb3b-141">Only the `=` operand can be used together with `DatabaseName`, `SchemaName`, and `ObjectName`.</span></span> <span data-ttu-id="adb3b-142">Другие выражения нельзя использовать с этими свойствами событий.</span><span class="sxs-lookup"><span data-stu-id="adb3b-142">Other expressions cannot be used with these event properties.</span></span>  
  
## <a name="remarks"></a><span data-ttu-id="adb3b-143">Remarks</span><span class="sxs-lookup"><span data-stu-id="adb3b-143">Remarks</span></span>  
 <span data-ttu-id="adb3b-144">*Where_condition* синтаксиса поставщика WMI для событий сервера определяет следующее:</span><span class="sxs-lookup"><span data-stu-id="adb3b-144">The *where_condition* of the WMI Provider for Server Events syntax determines the following:</span></span>  
  
-   <span data-ttu-id="adb3b-145">Область, с помощью которой поставщик пытается получить указанный *event_type*: уровень сервера, уровень базы данных или уровень объекта (в настоящее время поддерживается только текущий объект).</span><span class="sxs-lookup"><span data-stu-id="adb3b-145">The scope by which the provider tries to retrieve the specified *event_type*: the server level, database level, or object level (the only object currently supported is queue).</span></span> <span data-ttu-id="adb3b-146">В конечном счете эта область определяет тип уведомления о событии, создаваемого в базе данных-получателе.</span><span class="sxs-lookup"><span data-stu-id="adb3b-146">Ultimately, this scope determines the type of event notification created in the target database.</span></span> <span data-ttu-id="adb3b-147">Этот процесс называется регистрацией уведомления о событии.</span><span class="sxs-lookup"><span data-stu-id="adb3b-147">This process called event notification registration.</span></span>  
  
-   <span data-ttu-id="adb3b-148">База данных, схема и объект (если применимо), в которых выполняется регистрация.</span><span class="sxs-lookup"><span data-stu-id="adb3b-148">The database, schema, and object, where appropriate, on which to register.</span></span>  
  
 <span data-ttu-id="adb3b-149">Поставщик WMI для событий сервера использует восходящий алгоритм «первый подходящий» для создания наиболее узкой области для базового уведомления EVENT NOTIFICATION.</span><span class="sxs-lookup"><span data-stu-id="adb3b-149">The WMI Provider for Server Events uses a bottom-up, first-fit algorithm to produce the narrowest possible scope for the underlying EVENT NOTIFICATION.</span></span> <span data-ttu-id="adb3b-150">Алгоритм пытается минимизировать внутреннюю активность на сервере и сетевой трафик между экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и процессом на узле WMI.</span><span class="sxs-lookup"><span data-stu-id="adb3b-150">The algorithm tries to minimize internal activity on the server and network traffic between the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and the WMI host process.</span></span> <span data-ttu-id="adb3b-151">Поставщик проверяет *event_type* , указанные в предложении FROM, и условия в предложении WHERE, а также пытается зарегистрировать базовое уведомление о событии с самой узкий из возможных областей.</span><span class="sxs-lookup"><span data-stu-id="adb3b-151">The provider examines the *event_type* specified in the FROM clause and the conditions in the WHERE clause, and tries to register the underlying EVENT NOTIFICATION with the narrowest possible scope.</span></span> <span data-ttu-id="adb3b-152">Если поставщику не удается выполнить регистрацию в наиболее узкой области, он пытается выполнить ее в областях более высокого уровня, пока регистрация не пройдет успешно.</span><span class="sxs-lookup"><span data-stu-id="adb3b-152">If the provider cannot register at the narrowest scope, it tries to register at successively higher scopes until a registration finally succeeds.</span></span> <span data-ttu-id="adb3b-153">Если достигнут самый высокий уровень (уровень сервера), а регистрация завершается сбоем, возвращается сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="adb3b-153">If it reaches the highest scope the server-level) and fails, it returns an error to the consumer.</span></span>  
  
 <span data-ttu-id="adb3b-154">Например, если в предложении WHERE указано DatabaseName =**"** AdventureWorks **"**, поставщик пытается зарегистрировать уведомление о событии в [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] базе данных.</span><span class="sxs-lookup"><span data-stu-id="adb3b-154">For example, if DatabaseName=**'** AdventureWorks **'** is specified in the WHERE clause, the provider tries to register an event notification in the [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database.</span></span> <span data-ttu-id="adb3b-155">Если база данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] существует, а у вызывающего клиента достаточно разрешений для создания уведомления в [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)], регистрация выполняется успешно.</span><span class="sxs-lookup"><span data-stu-id="adb3b-155">If the [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database exists and the calling client has the required permissions to create an event notification in [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)], the registration is successful.</span></span> <span data-ttu-id="adb3b-156">В противном случае выполняется попытка зарегистрировать уведомление о событии на уровне сервера.</span><span class="sxs-lookup"><span data-stu-id="adb3b-156">Otherwise, an attempt is made to register the event notification at the server level.</span></span> <span data-ttu-id="adb3b-157">Регистрация выполняется успешно, если клиент WMI имеет необходимые разрешения.</span><span class="sxs-lookup"><span data-stu-id="adb3b-157">The registration succeeds if the WMI client has the required permissions.</span></span> <span data-ttu-id="adb3b-158">Однако в этом сценарии события не возвращаются клиенту, пока не будет создана база данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)].</span><span class="sxs-lookup"><span data-stu-id="adb3b-158">However, under this scenario, events are not returned to the client until the [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database has been created.</span></span>  
  
 <span data-ttu-id="adb3b-159">*Where_condition* может также действовать как фильтр, чтобы дополнительно ограничить запрос определенной базой данных, схемой или объектом.</span><span class="sxs-lookup"><span data-stu-id="adb3b-159">The *where_condition* can also act as a filter to additionally limit the query to a specific database, schema, or object.</span></span> <span data-ttu-id="adb3b-160">Например, рассмотрим следующий WQL-запрос.</span><span class="sxs-lookup"><span data-stu-id="adb3b-160">For example, consider the following WQL query:</span></span>  
  
```  
SELECT * FROM ALTER_TABLE   
WHERE DatabaseName = 'AdventureWorks' AND SchemaName = 'Sales'   
    AND ObjectType='Table' AND ObjectName = 'SalesOrderDetail'  
```  
  
 <span data-ttu-id="adb3b-161">В зависимости от результатов процесса регистрации WQL-запрос может быть зарегистрирован либо на уровне базы данных, либо на уровне сервера.</span><span class="sxs-lookup"><span data-stu-id="adb3b-161">Depending on the outcome of the registration process, this WQL query may be registered either at the database or server level.</span></span> <span data-ttu-id="adb3b-162">Однако даже если он зарегистрирован на уровне сервера, поставщик в конечном итоге отфильтровывает любые события `ALTER_TABLE`, неприменимые к таблице `AdventureWorks.Sales.SalesOrderDetail`.</span><span class="sxs-lookup"><span data-stu-id="adb3b-162">However, even if it is registered at the server level, the provider ultimately filters any `ALTER_TABLE` events that do not apply to the `AdventureWorks.Sales.SalesOrderDetail` table.</span></span> <span data-ttu-id="adb3b-163">Иными словами, поставщик возвращает только свойства событий `ALTER_TABLE`, возникших в конкретной таблице.</span><span class="sxs-lookup"><span data-stu-id="adb3b-163">In other words, the provider returns only the properties of the `ALTER_TABLE` events that occur on that specific table.</span></span>  
  
 <span data-ttu-id="adb3b-164">Если указано составное выражение (такое как `DatabaseName='AW1'` OR `DatabaseName='AW2'`), выполняется попытка зарегистрировать одиночное уведомление о событии на уровне сервера вместо регистрации двух отдельных уведомлений о событии.</span><span class="sxs-lookup"><span data-stu-id="adb3b-164">If a compound expression such as `DatabaseName='AW1'` OR `DatabaseName='AW2'` is specified, an attempt is made to register a single event notification at the server scope instead of two separate event notifications.</span></span> <span data-ttu-id="adb3b-165">Регистрация выполняется успешно, если вызывающий клиент имеет необходимые разрешения.</span><span class="sxs-lookup"><span data-stu-id="adb3b-165">The registration succeeds if the calling client has permissions.</span></span>  
  
 <span data-ttu-id="adb3b-166">Если `SchemaName='X' AND ObjectType='Y' AND ObjectName='Z'` все указаны в `WHERE` предложении, предпринимается попытка зарегистрировать уведомление о событии непосредственно в объекте `Z` схемы `X` .</span><span class="sxs-lookup"><span data-stu-id="adb3b-166">If `SchemaName='X' AND ObjectType='Y' AND ObjectName='Z'` are all specified in the `WHERE` clause, an attempt is made to register the event notification directly on object `Z` in schema `X`.</span></span> <span data-ttu-id="adb3b-167">Регистрация выполняется успешно, если клиент имеет необходимые разрешения.</span><span class="sxs-lookup"><span data-stu-id="adb3b-167">The registration succeeds if the client has permissions.</span></span> <span data-ttu-id="adb3b-168">Обратите внимание, что в настоящее время события уровня объекта поддерживаются только в очередях и только для *event_type*QUEUE_ACTIVATION.</span><span class="sxs-lookup"><span data-stu-id="adb3b-168">Note that currently, object-level events are supported only on queues, and only for the QUEUE_ACTIVATION *event_type*.</span></span>  
  
 <span data-ttu-id="adb3b-169">Следует иметь в виду, что не все события могут запрашиваться во всех областях действия.</span><span class="sxs-lookup"><span data-stu-id="adb3b-169">Note that not all events can be queried at any particular scope.</span></span> <span data-ttu-id="adb3b-170">Например, WQL-запрос о событии трассировки, таком как Lock_Deadlock, или группе событий трассировки, такой как TRC_LOCKS, может быть зарегистрирован только на уровне сервера.</span><span class="sxs-lookup"><span data-stu-id="adb3b-170">For example, a WQL query on a trace event such as Lock_Deadlock, or a trace event group such as TRC_LOCKS, can only be registered at the server level.</span></span> <span data-ttu-id="adb3b-171">Аналогичным образом событие CREATE_ENDPOINT и группа событий DDL_ENDPOINT_EVENTS также могут быть зарегистрированы только на уровне сервера.</span><span class="sxs-lookup"><span data-stu-id="adb3b-171">Similarly, the CREATE_ENDPOINT event and the DDL_ENDPOINT_EVENTS event group can also be registered only at the server level.</span></span> <span data-ttu-id="adb3b-172">Дополнительные сведения о подходящей области для регистрации событий см. в разделе [Разработка уведомлений о событиях](https://technet.microsoft.com/library/ms175854\(v=sql.105\).aspx).</span><span class="sxs-lookup"><span data-stu-id="adb3b-172">For more information about the appropriate scope for registering events, see [Designing Event Notifications](https://technet.microsoft.com/library/ms175854\(v=sql.105\).aspx).</span></span> <span data-ttu-id="adb3b-173">Попытка зарегистрировать WQL-запрос, *event_type* может быть зарегистрирован только на уровне сервера, всегда устанавливается на уровне сервера.</span><span class="sxs-lookup"><span data-stu-id="adb3b-173">An attempt to register a WQL query whose *event_type* can only be registered at the server level is always made at the server level.</span></span> <span data-ttu-id="adb3b-174">Регистрация выполняется успешно, если клиент WMI имеет необходимые разрешения.</span><span class="sxs-lookup"><span data-stu-id="adb3b-174">Registration succeeds if the WMI client has permissions.</span></span> <span data-ttu-id="adb3b-175">Иначе клиенту возвращается ошибка.</span><span class="sxs-lookup"><span data-stu-id="adb3b-175">Otherwise, an error is returned to the client.</span></span> <span data-ttu-id="adb3b-176">Однако в некоторых случаях можно использовать предложение WHERE в качестве фильтра для событий на уровне сервера на основе свойств, соответствующих событию.</span><span class="sxs-lookup"><span data-stu-id="adb3b-176">In some cases, however, you can still use the WHERE clause as a filter for server-level events based on the properties that correspond to the event.</span></span> <span data-ttu-id="adb3b-177">Например, многие события трассировки имеют свойство `DatabaseName`, которое можно использовать в предложении WHERE в качестве фильтра.</span><span class="sxs-lookup"><span data-stu-id="adb3b-177">For example, many trace events have a `DatabaseName` property that can be used in the WHERE clause as a filter.</span></span>  
  
 <span data-ttu-id="adb3b-178">Уведомления о событиях уровня сервера создаются в базе данных **master** и могут запрашиваться для метаданных с помощью представления каталога [sys. server_event_notifications](/sql/relational-databases/system-catalog-views/sys-server-event-notifications-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="adb3b-178">Server-scoped event notifications are created in the **master** database and can be queried for metadata by using the [sys.server_event_notifications](/sql/relational-databases/system-catalog-views/sys-server-event-notifications-transact-sql) catalog view.</span></span>  
  
 <span data-ttu-id="adb3b-179">Уведомления о событиях уровня базы данных или области объекта создаются в указанной базе данных и могут запрашиваться для метаданных с помощью представления каталога [sys. event_notifications](/sql/relational-databases/system-catalog-views/sys-event-notifications-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="adb3b-179">Database-scoped or object-scoped event notifications are created in the specified database and can be queried for metadata by using the [sys.event_notifications](/sql/relational-databases/system-catalog-views/sys-event-notifications-transact-sql) catalog view.</span></span> <span data-ttu-id="adb3b-180">Представление каталога должно иметь префикс с именем соответствующей базы данных.</span><span class="sxs-lookup"><span data-stu-id="adb3b-180">(You must prefix the catalog view with the corresponding database name.)</span></span>  
  
## <a name="examples"></a><span data-ttu-id="adb3b-181">Примеры</span><span class="sxs-lookup"><span data-stu-id="adb3b-181">Examples</span></span>  
  
### <a name="a-querying-for-events-at-the-server-scope"></a><span data-ttu-id="adb3b-182">A.</span><span class="sxs-lookup"><span data-stu-id="adb3b-182">A.</span></span> <span data-ttu-id="adb3b-183">Запросы событий на уровне сервера</span><span class="sxs-lookup"><span data-stu-id="adb3b-183">Querying for events at the server scope</span></span>  
 <span data-ttu-id="adb3b-184">Следующий WQL-запрос получает все свойства событий для любого события трассировки `SERVER_MEMORY_CHANGE`, возникшего в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="adb3b-184">The following WQL query retrieves all event properties for any `SERVER_MEMORY_CHANGE` trace event that occurs on the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
```  
SELECT * FROM SERVER_MEMORY_CHANGE  
```  
  
### <a name="b-querying-for-events-at-the-database-scope"></a><span data-ttu-id="adb3b-185">Б.</span><span class="sxs-lookup"><span data-stu-id="adb3b-185">B.</span></span> <span data-ttu-id="adb3b-186">Запросы событий на уровне базы данных</span><span class="sxs-lookup"><span data-stu-id="adb3b-186">Querying for events at the database scope</span></span>  
 <span data-ttu-id="adb3b-187">Следующий WQL-запрос получает конкретные свойства событий для любых событий, возникающих в базе данных `AdventureWorks` и существующих в группе событий `DDL_DATABASE_LEVEL_EVENTS`.</span><span class="sxs-lookup"><span data-stu-id="adb3b-187">The following WQL query retrieves specific event properties for any event that occurs in the `AdventureWorks` database and exists under the `DDL_DATABASE_LEVEL_EVENTS` event group.</span></span>  
  
```  
SELECT SPID, SQLInstance, DatabaseName FROM DDL_DATABASE_LEVEL_EVENTS   
WHERE DatabaseName = 'AdventureWorks'   
```  
  
### <a name="c-querying-for-events-at-the-database-scope-filtering-by-schema-and-object"></a><span data-ttu-id="adb3b-188">В.</span><span class="sxs-lookup"><span data-stu-id="adb3b-188">C.</span></span> <span data-ttu-id="adb3b-189">Запросы событий на уровне базы данных, фильтрация по схеме и объекту</span><span class="sxs-lookup"><span data-stu-id="adb3b-189">Querying for events at the database scope, filtering by schema and object</span></span>  
 <span data-ttu-id="adb3b-190">Следующий запрос получает все свойства событий для любого события `ALTER_TABLE`, возникшего в таблице `AdventureWorks.Sales.SalesOrderDetail`.</span><span class="sxs-lookup"><span data-stu-id="adb3b-190">The following query retrieves all event properties for any `ALTER_TABLE` event that occurs on table `AdventureWorks.Sales.SalesOrderDetail`.</span></span>  
  
```  
SELECT * FROM ALTER_TABLE   
WHERE DatabaseName = 'AdventureWorks' AND SchemaName = 'Sales'   
    AND ObjectType='Table' AND ObjectName = 'SalesOrderDetail'  
```  
  
## <a name="see-also"></a><span data-ttu-id="adb3b-191">См. также:</span><span class="sxs-lookup"><span data-stu-id="adb3b-191">See Also</span></span>  
 <span data-ttu-id="adb3b-192">[Основные понятия о поставщике WMI для событий сервера](https://technet.microsoft.com/library/ms180560.aspx) </span><span class="sxs-lookup"><span data-stu-id="adb3b-192">[WMI Provider for Server Events Concepts](https://technet.microsoft.com/library/ms180560.aspx) </span></span>  
 [<span data-ttu-id="adb3b-193">Уведомления о событиях (компонент Database Engine)</span><span class="sxs-lookup"><span data-stu-id="adb3b-193">Event Notifications (Database Engine)</span></span>](https://technet.microsoft.com/library/ms182602.aspx)  
  
  
