---
title: Рекомендации по использованию тестовых серверов | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- overhead [Database Engine Tuning Advisor]
- tuning overhead [SQL Server]
- reducing production server tuning load
- Database Engine Tuning Advisor [SQL Server], test servers
- xp_msver
- test servers [Database Engine Tuning Advisor]
- production servers [SQL Server]
- offload tuning overhead [SQL Server]
ms.assetid: 94e6c3e5-1f09-4616-9da2-4e44d066d494
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 3fe835c1e92b382e3e2fadd7e80d4b2984929cc5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87730538"
---
# <a name="considerations-for-using-test-servers"></a><span data-ttu-id="532bf-102">Вопросы использования тестовых серверов</span><span class="sxs-lookup"><span data-stu-id="532bf-102">Considerations for Using Test Servers</span></span>
  <span data-ttu-id="532bf-103">Одним из важных преимуществ помощника по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] является возможность использовать тестовый сервер для настройки базы данных на рабочем сервере.</span><span class="sxs-lookup"><span data-stu-id="532bf-103">Using a test server to tune a database on a production server is an important benefit of [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor.</span></span> <span data-ttu-id="532bf-104">Благодаря этому можно перенаправить работу по настройке базы данных на тестовый сервер, не копируя на него данные с рабочего сервера.</span><span class="sxs-lookup"><span data-stu-id="532bf-104">Using this feature, you can offload tuning overhead to a test server without copying the actual data over to the test server from the production server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="532bf-105">Функция настройки тестового сервера не поддерживается в графическом пользовательском интерфейсе помощника по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="532bf-105">The test server tuning feature is not supported in the [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor graphical user interface (GUI).</span></span>  
  
 <span data-ttu-id="532bf-106">Чтобы успешно использовать эту возможность, просмотрите рекомендации, приведенные в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="532bf-106">To use this feature successfully, review the considerations listed in the following sections.</span></span>  
  
## <a name="setting-up-the-test-serverproduction-server-environment"></a><span data-ttu-id="532bf-107">Установка среды тестового или рабочего сервера</span><span class="sxs-lookup"><span data-stu-id="532bf-107">Setting Up the Test Server/Production Server Environment</span></span>  
  
-   <span data-ttu-id="532bf-108">Пользователь, в контексте которого на тестовом сервере будет настраиваться база данных с рабочего сервера, должен существовать на обоих серверах.</span><span class="sxs-lookup"><span data-stu-id="532bf-108">The user who wants to use a test server to tune a database on a production server must exist on both servers, or this scenario will not work.</span></span>  
  
-   <span data-ttu-id="532bf-109">Настроить базу данных с рабочего сервера на тестовом сервере можно только в том случае, если активирована расширенная хранимая процедура **xp_msver**.</span><span class="sxs-lookup"><span data-stu-id="532bf-109">The extended stored procedure, **xp_msver**, must be enabled to use the test server/production server scenario.</span></span> [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="532bf-110">Помощник по настройке компонента использует эту расширенную хранимую процедуру при настройке тестового сервера для выборки числа процессоров и доступной памяти рабочего сервера.</span><span class="sxs-lookup"><span data-stu-id="532bf-110">Tuning Advisor uses this extended stored procedure to fetch the number of processors and the available memory of the production server to use while tuning the test server.</span></span> <span data-ttu-id="532bf-111">Если процедура **xp_msver** не активирована, помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] подразумевает, что характеристики оборудования те же, что и на компьютере, на котором запущен помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="532bf-111">If **xp_msver** is not enabled, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor assumes the hardware characteristics of the computer where [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor is running.</span></span> <span data-ttu-id="532bf-112">Если характеристики оборудования того компьютера, на котором выполняется помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] , недоступны, то предполагается наличие одного процессора и 1024 МБ оперативной памяти.</span><span class="sxs-lookup"><span data-stu-id="532bf-112">If the hardware characteristics of the computer where [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor is running are not available, one processor and 1024 megabytes (MBs) of memory are assumed.</span></span> <span data-ttu-id="532bf-113">Эта расширенная хранимая процедура включается по умолчанию при установке [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="532bf-113">This extended stored procedure is turned on by default when you install [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="532bf-114">Дополнительные сведения см. в разделе [Surface Area Configuration](../security/surface-area-configuration.md) и [xp_msver (Transact-SQL)](/sql/relational-databases/system-stored-procedures/xp-msver-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="532bf-114">For more information, see [Surface Area Configuration](../security/surface-area-configuration.md) and [xp_msver &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/xp-msver-transact-sql).</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="532bf-115">Помощник по настройке предполагает, что выпуски [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на тестовом и рабочем сервере совпадают.</span><span class="sxs-lookup"><span data-stu-id="532bf-115">Tuning Advisor expects the editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to be the same on both the test server and the production server.</span></span> <span data-ttu-id="532bf-116">Если это два разных выпуска, приоритет получает выпуск на тестовом сервере.</span><span class="sxs-lookup"><span data-stu-id="532bf-116">If there are two different editions, the edition on the test server takes precedence.</span></span> <span data-ttu-id="532bf-117">Например, если тестовый сервер работает под управлением [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard Edition, помощник по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] не включает в свои рекомендации индексированные представления, секционирование и операции, выполняющиеся в режиме «в сети», даже если рабочий сервер работает под управлением [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise Edition.</span><span class="sxs-lookup"><span data-stu-id="532bf-117">For example, if the test server is running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor will not include indexed views, partitioning, and online operations in its recommendations even if the production server is running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span></span>  
  
## <a name="about-test-serverproduction-server-behavior"></a><span data-ttu-id="532bf-118">О поведении тестового или рабочего сервера</span><span class="sxs-lookup"><span data-stu-id="532bf-118">About Test Server/Production Server Behavior</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="532bf-119">При составлении рекомендаций помощник по настройке учитывает различия характеристик оборудования рабочего и тестового серверов.</span><span class="sxs-lookup"><span data-stu-id="532bf-119">Tuning Advisor takes into account hardware differences between the production and the test server when creating recommendations.</span></span> <span data-ttu-id="532bf-120">При этом он составляет такие рекомендации, как если бы настройка выполнялась только на рабочем сервере.</span><span class="sxs-lookup"><span data-stu-id="532bf-120">The recommendation is the same as though the tuning was done on the production server alone.</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="532bf-121">Выполнение помощника по настройке может привести к повышению нагрузки на рабочий сервер из-за сбора метаданных и составления необходимой для настройки статистики.</span><span class="sxs-lookup"><span data-stu-id="532bf-121">Tuning Advisor may impose some load on the production server for gathering metadata as well as creation of statistics necessary for tuning.</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="532bf-122">не копирует реальные данные с рабочего сервера на тестовый сервер.</span><span class="sxs-lookup"><span data-stu-id="532bf-122">Tuning Advisor does not copy actual data from the production server to the test server.</span></span> <span data-ttu-id="532bf-123">Он копирует только метаданные баз данных и необходимую статистику.</span><span class="sxs-lookup"><span data-stu-id="532bf-123">It only copies the metadata of the databases and the necessary statistics.</span></span>  
  
-   <span data-ttu-id="532bf-124">Все данные сеанса хранятся на рабочем сервере в базе данных **msdb** .</span><span class="sxs-lookup"><span data-stu-id="532bf-124">All session information is stored in **msdb** on the production server.</span></span> <span data-ttu-id="532bf-125">Благодаря этому можно использовать для настройки любой доступный тестовый сервер, а сведения обо всех сеансах хранятся в одном месте (рабочий сервер).</span><span class="sxs-lookup"><span data-stu-id="532bf-125">This allows you to exploit any available test server for tuning, and information about all sessions is available in one place (the production server).</span></span>  
  
## <a name="issues-related-to-the-shell-database"></a><span data-ttu-id="532bf-126">Вопросы, относящиеся к базе данных оболочки</span><span class="sxs-lookup"><span data-stu-id="532bf-126">Issues Related to the Shell Database</span></span>  
  
-   <span data-ttu-id="532bf-127">После настройки помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] должен удалить все метаданные, созданные им на тестовом сервере во время настройки,</span><span class="sxs-lookup"><span data-stu-id="532bf-127">After tuning, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor should remove any metadata that it created on the test server during the tuning process.</span></span> <span data-ttu-id="532bf-128">в том числе базу данных оболочки.</span><span class="sxs-lookup"><span data-stu-id="532bf-128">This includes the shell database.</span></span> <span data-ttu-id="532bf-129">Если выполняется несколько сеансов настройки, в которых используются те же рабочий и тестовый серверы, можете сохранить базу данных оболочки для экономии времени.</span><span class="sxs-lookup"><span data-stu-id="532bf-129">If you are performing a series of tuning sessions with the same production and test servers, you may want to retain this shell database to save time.</span></span> <span data-ttu-id="532bf-130">Укажите для этого во входном XML-файле дочерний элемент **RetainShellDB** и другие дочерние элементы родительского элемента **TuningOptions** .</span><span class="sxs-lookup"><span data-stu-id="532bf-130">In the XML input file, specify the **RetainShellDB** subelement with the other sub elements under the **TuningOptions** parent element.</span></span> <span data-ttu-id="532bf-131">Если они будут указаны, помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] сохранит базу данных оболочки.</span><span class="sxs-lookup"><span data-stu-id="532bf-131">Using these options causes [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor to retain the shell database.</span></span> <span data-ttu-id="532bf-132">Дополнительные сведения см. в [Справочнике по входным XML-файлам (помощник по настройке ядра СУБД)](database-engine-tuning-advisor.md).</span><span class="sxs-lookup"><span data-stu-id="532bf-132">For more information, see [XML Input File Reference &#40;Database Engine Tuning Advisor&#41;](database-engine-tuning-advisor.md).</span></span>  
  
-   <span data-ttu-id="532bf-133">Базы данных оболочки могут остаться на тестовом сервере после успешного сеанса настройки тестового или рабочего сервера, даже если не был указан подэлемент **RetainShellDB** .</span><span class="sxs-lookup"><span data-stu-id="532bf-133">Shell databases may be left behind on the test server after a successful test server/production server tuning session even if you have not specified the **RetainShellDB** subelement.</span></span> <span data-ttu-id="532bf-134">Эти нежелательные базы данных оболочки могут повлиять на последующие сеансы настройки и должны быть удалены до следующего сеанса настройки тестового или рабочего сервера.</span><span class="sxs-lookup"><span data-stu-id="532bf-134">These unwanted shell databases may interfere with subsequent tuning sessions and should be dropped before performing another test server/production server tuning session.</span></span> <span data-ttu-id="532bf-135">Кроме того, если сеанс настройки непредвиденно завершится, базы данных оболочки и объекты внутри них могут остаться на тестовом сервере.</span><span class="sxs-lookup"><span data-stu-id="532bf-135">In addition, if a tuning session exits unexpectedly, the shell databases on the test server and the objects within those databases may be left behind on the test server.</span></span> <span data-ttu-id="532bf-136">Перед началом нового сеанса настройки тестового или рабочего сервера необходимо удалить эти базы данных и объекты.</span><span class="sxs-lookup"><span data-stu-id="532bf-136">You should also delete these databases and objects before starting a new test server/production server tuning session.</span></span>  
  
## <a name="issues-related-to-the-tuning-process"></a><span data-ttu-id="532bf-137">Вопросы, относящиеся к процессу настройки</span><span class="sxs-lookup"><span data-stu-id="532bf-137">Issues Related to the Tuning Process</span></span>  
  
-   <span data-ttu-id="532bf-138">Пользователь должен проверять журнал настройки на предмет ошибок, обусловленных различиями рабочего и тестового серверов, а также ошибок, ставших результатом копирования метаданных с рабочего сервера на тестовый.</span><span class="sxs-lookup"><span data-stu-id="532bf-138">The user must check the tuning log for tuning errors that result from differences between the production and test servers, and for errors that result from copying metadata from the production to the test server.</span></span> <span data-ttu-id="532bf-139">Например, на тестовом сервере может быть не задано имя входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="532bf-139">For example, a user login may not exist on the test server.</span></span> <span data-ttu-id="532bf-140">В этом случае настройка событий рабочей нагрузки, создаваемых в контексте этого имени входа, может оказаться невозможной.</span><span class="sxs-lookup"><span data-stu-id="532bf-140">If a user login does not exist on the test server, those events in the workload that are issued by that user login may not be tunable.</span></span> <span data-ttu-id="532bf-141">Используйте для просмотра журнала настройки графический интерфейс помощника по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="532bf-141">Use the [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor GUI to view the tuning log.</span></span> <span data-ttu-id="532bf-142">Дополнительные сведения см. в разделе [Просмотр и работа с выходными данными помощника по настройке ядра СУБД](view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md).</span><span class="sxs-lookup"><span data-stu-id="532bf-142">For more information, see [View and Work with the Output from the Database Engine Tuning Advisor](view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md)</span></span>  
  
-   <span data-ttu-id="532bf-143">Если помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] не может настроить большое число событий из-за отсутствия объектов в базе данных оболочки, созданной этим помощником [!INCLUDE[ssDE](../../includes/ssde-md.md)] на тестовом сервере, пользователь должен проверить журнал настройки.</span><span class="sxs-lookup"><span data-stu-id="532bf-143">If [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor cannot tune many events because objects are missing in the shell database that [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor creates on the test server, the user must check the tuning log.</span></span> <span data-ttu-id="532bf-144">События, которые не могут быть настроены, указываются в этом журнале.</span><span class="sxs-lookup"><span data-stu-id="532bf-144">Events that cannot be tuned are listed in the log.</span></span> <span data-ttu-id="532bf-145">Чтобы успешно настроить базу данных на тестовом сервере, пользователь должен создать объекты, отсутствующие в базе данных оболочки, и запустить новый сеанс настройки.</span><span class="sxs-lookup"><span data-stu-id="532bf-145">To successfully tune the database on the test server, the user must create the missing objects in the shell database, and then start a new tuning session.</span></span>  
  
-   <span data-ttu-id="532bf-146">Если на тестовом сервере уже существует база данных с тем же именем, помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] не копирует метаданные, а продолжает настройку, собирая статистику по мере надобности.</span><span class="sxs-lookup"><span data-stu-id="532bf-146">If a database with the same name already exists on the test server, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor does not copy metadata, but continues tuning and gathers statistics as necessary.</span></span> <span data-ttu-id="532bf-147">Это полезно, если пользователь перед вызовом помощника по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] уже создал на тестовом сервере базу данных и скопировал соответствующие метаданные.</span><span class="sxs-lookup"><span data-stu-id="532bf-147">This is useful if the user has already created a database on the test server and has copied the appropriate metadata before invoking [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor.</span></span>  
  
-   <span data-ttu-id="532bf-148">Если для базы данных на рабочем сервере установлен параметр DATE_CORRELATION_OPTIMIZATION, то при настройке тестового сервера метаданные и связанные с этим параметром данные будут записываться в сценарий неполностью.</span><span class="sxs-lookup"><span data-stu-id="532bf-148">If the DATE_CORRELATION_OPTIMIZATION option is turned on for a database on the production server, metadata and the data associated with this option are not completely scripted while tuning the test server.</span></span> <span data-ttu-id="532bf-149">При настройке базы данных рабочего сервера на тестовом сервере возможны следующие проблемы.</span><span class="sxs-lookup"><span data-stu-id="532bf-149">When tuning is performed for a test server/production server scenario, the following issues may apply:</span></span>  
  
    -   <span data-ttu-id="532bf-150">Пользователям могут соответствовать на серверах разные планы запросов с параметром DATE_CORRELATION_OPTIMIZATION.</span><span class="sxs-lookup"><span data-stu-id="532bf-150">Users can have different query plans on the servers for queries that use the DATE_CORRELATION_OPTIMIZATION option.</span></span>  
  
    -   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="532bf-151">В скрипт рекомендаций помощник по настройке может включить совет удалить индексированные представления, принудительно применяющие параметр DATE_CORRELATION_OPTIMIZATION.</span><span class="sxs-lookup"><span data-stu-id="532bf-151">Tuning Advisor may suggest dropping indexed views that enforce the DATE_CORRELATION_OPTIMIZATION option in the recommendation script.</span></span>  
  
     <span data-ttu-id="532bf-152">Иными словами, помощнику по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] известны только издержки, связанные с индексированными представлениями статистики корреляций, но не их достоинства, поэтому соответствующие рекомендации помощника [!INCLUDE[ssDE](../../includes/ssde-md.md)] иногда лучше пропускать.</span><span class="sxs-lookup"><span data-stu-id="532bf-152">Therefore, you may want to ignore any recommendations that [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor makes about the indexed views that hold correlation statistics because [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor knows their costs but not their benefits.</span></span> [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="532bf-153">Помощник по настройке не всегда рекомендует выбрать определенные индексы, повышающие эффективность работы при указанном параметре DATE_CORRELATION_OPTIMIZATION, как, например, кластеризованные индексы столбцов типа **datetime** .</span><span class="sxs-lookup"><span data-stu-id="532bf-153">Tuning Advisor may not recommend selection of certain indexes such as clustered indexes on **datetime** columns, which could be beneficial when DATE_CORRELATION_OPTIMIZATION is enabled.</span></span>  
  
     <span data-ttu-id="532bf-154">Чтобы определить, основано ли представление на статистике корреляций, выберите столбец **is_date_correlation_view** представления каталога [sys.views](/sql/relational-databases/system-catalog-views/sys-views-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="532bf-154">To determine if a view is based on correlation statistics, select the **is_date_correlation_view** column of the [sys.views](/sql/relational-databases/system-catalog-views/sys-views-transact-sql) catalog view.</span></span>  
  
  
