---
title: Рекомендации по использованию тестовых серверов | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- overhead [Database Engine Tuning Advisor]
- tuning overhead [SQL Server]
- reducing production server tuning load
- Database Engine Tuning Advisor [SQL Server], test servers
- xp_msver
- test servers [Database Engine Tuning Advisor]
- production servers [SQL Server]
- offload tuning overhead [SQL Server]
ms.assetid: 94e6c3e5-1f09-4616-9da2-4e44d066d494
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 3fe835c1e92b382e3e2fadd7e80d4b2984929cc5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87730538"
---
# <a name="considerations-for-using-test-servers"></a>Вопросы использования тестовых серверов
  Одним из важных преимуществ помощника по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] является возможность использовать тестовый сервер для настройки базы данных на рабочем сервере. Благодаря этому можно перенаправить работу по настройке базы данных на тестовый сервер, не копируя на него данные с рабочего сервера.  
  
> [!NOTE]  
>  Функция настройки тестового сервера не поддерживается в графическом пользовательском интерфейсе помощника по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .  
  
 Чтобы успешно использовать эту возможность, просмотрите рекомендации, приведенные в следующих разделах.  
  
## <a name="setting-up-the-test-serverproduction-server-environment"></a>Установка среды тестового или рабочего сервера  
  
-   Пользователь, в контексте которого на тестовом сервере будет настраиваться база данных с рабочего сервера, должен существовать на обоих серверах.  
  
-   Настроить базу данных с рабочего сервера на тестовом сервере можно только в том случае, если активирована расширенная хранимая процедура **xp_msver**. [!INCLUDE[ssDE](../../includes/ssde-md.md)] Помощник по настройке компонента использует эту расширенную хранимую процедуру при настройке тестового сервера для выборки числа процессоров и доступной памяти рабочего сервера. Если процедура **xp_msver** не активирована, помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] подразумевает, что характеристики оборудования те же, что и на компьютере, на котором запущен помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] . Если характеристики оборудования того компьютера, на котором выполняется помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] , недоступны, то предполагается наличие одного процессора и 1024 МБ оперативной памяти. Эта расширенная хранимая процедура включается по умолчанию при установке [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. в разделе [Surface Area Configuration](../security/surface-area-configuration.md) и [xp_msver (Transact-SQL)](/sql/relational-databases/system-stored-procedures/xp-msver-transact-sql).  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] Помощник по настройке предполагает, что выпуски [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на тестовом и рабочем сервере совпадают. Если это два разных выпуска, приоритет получает выпуск на тестовом сервере. Например, если тестовый сервер работает под управлением [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard Edition, помощник по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] не включает в свои рекомендации индексированные представления, секционирование и операции, выполняющиеся в режиме «в сети», даже если рабочий сервер работает под управлением [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise Edition.  
  
## <a name="about-test-serverproduction-server-behavior"></a>О поведении тестового или рабочего сервера  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] При составлении рекомендаций помощник по настройке учитывает различия характеристик оборудования рабочего и тестового серверов. При этом он составляет такие рекомендации, как если бы настройка выполнялась только на рабочем сервере.  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] Выполнение помощника по настройке может привести к повышению нагрузки на рабочий сервер из-за сбора метаданных и составления необходимой для настройки статистики.  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] не копирует реальные данные с рабочего сервера на тестовый сервер. Он копирует только метаданные баз данных и необходимую статистику.  
  
-   Все данные сеанса хранятся на рабочем сервере в базе данных **msdb** . Благодаря этому можно использовать для настройки любой доступный тестовый сервер, а сведения обо всех сеансах хранятся в одном месте (рабочий сервер).  
  
## <a name="issues-related-to-the-shell-database"></a>Вопросы, относящиеся к базе данных оболочки  
  
-   После настройки помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] должен удалить все метаданные, созданные им на тестовом сервере во время настройки, в том числе базу данных оболочки. Если выполняется несколько сеансов настройки, в которых используются те же рабочий и тестовый серверы, можете сохранить базу данных оболочки для экономии времени. Укажите для этого во входном XML-файле дочерний элемент **RetainShellDB** и другие дочерние элементы родительского элемента **TuningOptions** . Если они будут указаны, помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] сохранит базу данных оболочки. Дополнительные сведения см. в [Справочнике по входным XML-файлам (помощник по настройке ядра СУБД)](database-engine-tuning-advisor.md).  
  
-   Базы данных оболочки могут остаться на тестовом сервере после успешного сеанса настройки тестового или рабочего сервера, даже если не был указан подэлемент **RetainShellDB** . Эти нежелательные базы данных оболочки могут повлиять на последующие сеансы настройки и должны быть удалены до следующего сеанса настройки тестового или рабочего сервера. Кроме того, если сеанс настройки непредвиденно завершится, базы данных оболочки и объекты внутри них могут остаться на тестовом сервере. Перед началом нового сеанса настройки тестового или рабочего сервера необходимо удалить эти базы данных и объекты.  
  
## <a name="issues-related-to-the-tuning-process"></a>Вопросы, относящиеся к процессу настройки  
  
-   Пользователь должен проверять журнал настройки на предмет ошибок, обусловленных различиями рабочего и тестового серверов, а также ошибок, ставших результатом копирования метаданных с рабочего сервера на тестовый. Например, на тестовом сервере может быть не задано имя входа пользователя. В этом случае настройка событий рабочей нагрузки, создаваемых в контексте этого имени входа, может оказаться невозможной. Используйте для просмотра журнала настройки графический интерфейс помощника по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] . Дополнительные сведения см. в разделе [Просмотр и работа с выходными данными помощника по настройке ядра СУБД](view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md).  
  
-   Если помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] не может настроить большое число событий из-за отсутствия объектов в базе данных оболочки, созданной этим помощником [!INCLUDE[ssDE](../../includes/ssde-md.md)] на тестовом сервере, пользователь должен проверить журнал настройки. События, которые не могут быть настроены, указываются в этом журнале. Чтобы успешно настроить базу данных на тестовом сервере, пользователь должен создать объекты, отсутствующие в базе данных оболочки, и запустить новый сеанс настройки.  
  
-   Если на тестовом сервере уже существует база данных с тем же именем, помощник по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] не копирует метаданные, а продолжает настройку, собирая статистику по мере надобности. Это полезно, если пользователь перед вызовом помощника по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] уже создал на тестовом сервере базу данных и скопировал соответствующие метаданные.  
  
-   Если для базы данных на рабочем сервере установлен параметр DATE_CORRELATION_OPTIMIZATION, то при настройке тестового сервера метаданные и связанные с этим параметром данные будут записываться в сценарий неполностью. При настройке базы данных рабочего сервера на тестовом сервере возможны следующие проблемы.  
  
    -   Пользователям могут соответствовать на серверах разные планы запросов с параметром DATE_CORRELATION_OPTIMIZATION.  
  
    -   [!INCLUDE[ssDE](../../includes/ssde-md.md)] В скрипт рекомендаций помощник по настройке может включить совет удалить индексированные представления, принудительно применяющие параметр DATE_CORRELATION_OPTIMIZATION.  
  
     Иными словами, помощнику по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] известны только издержки, связанные с индексированными представлениями статистики корреляций, но не их достоинства, поэтому соответствующие рекомендации помощника [!INCLUDE[ssDE](../../includes/ssde-md.md)] иногда лучше пропускать. [!INCLUDE[ssDE](../../includes/ssde-md.md)] Помощник по настройке не всегда рекомендует выбрать определенные индексы, повышающие эффективность работы при указанном параметре DATE_CORRELATION_OPTIMIZATION, как, например, кластеризованные индексы столбцов типа **datetime** .  
  
     Чтобы определить, основано ли представление на статистике корреляций, выберите столбец **is_date_correlation_view** представления каталога [sys.views](/sql/relational-databases/system-catalog-views/sys-views-transact-sql) .  
  
  
