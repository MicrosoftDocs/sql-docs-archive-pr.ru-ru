---
title: Присоединение указаний запросов к структуре плана | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
ms.assetid: 2131f796-6359-4f9e-9047-da0b3d4dedaf
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 074c69ffefd2b5a7b2ef445f941f97b7130b0732
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87666008"
---
# <a name="attach-query-hints-to-a-plan-guide"></a><span data-ttu-id="3238f-102">Присоединение указаний запросов к структуре плана</span><span class="sxs-lookup"><span data-stu-id="3238f-102">Attach Query Hints to a Plan Guide</span></span>
  <span data-ttu-id="3238f-103">Любые сочетания действительных указаний запроса могут быть использованы в руководстве плана.</span><span class="sxs-lookup"><span data-stu-id="3238f-103">Any combination of valid query hints can be used in a plan guide.</span></span> <span data-ttu-id="3238f-104">Когда структура плана совпадает с запросом, предложение OPTION, указанное в предложении указания структуры плана, добавляется к запросу, прежде чем запрос подвергается компиляции и оптимизации.</span><span class="sxs-lookup"><span data-stu-id="3238f-104">When a plan guide matches a query, the OPTION clause specified in the hints clause of a plan guide is added to the query before it compiles and optimizes.</span></span> <span data-ttu-id="3238f-105">Если в запросе, совпавшем со структурой плана, уже присутствует предложение OPTION, указания запроса, заданные в структуре плана, заменяют рекомендации в запросе.</span><span class="sxs-lookup"><span data-stu-id="3238f-105">If a query that is matched to a plan guide already has an OPTION clause, the query hints specified in the plan guide replace those in the query.</span></span> <span data-ttu-id="3238f-106">Чтобы структура плана совпала с запросом, уже содержащим предложение OPTION, предложение OPTION запроса необходимо включить при указании текста запроса для сопоставления в инструкции sp_create_plan_guide.</span><span class="sxs-lookup"><span data-stu-id="3238f-106">However, for a plan guide to match a query that already has an OPTION clause, you must include the OPTION clause of the query when you specify the text of the query to match in the sp_create_plan_guide statement.</span></span> <span data-ttu-id="3238f-107">Если необходимо, чтобы подсказки, указанные в руководстве плана, были добавлены к подсказкам, которые уже существуют в запросе, вместо того, чтобы заменить их, следует указать и исходные, и дополнительные подсказки в предложении OPTION структуры плана.</span><span class="sxs-lookup"><span data-stu-id="3238f-107">If you want the hints specified in the plan guide to be added to the hints that already exist on the query, instead of replacing them, you must specify both the original hints and the additional hints in the OPTION clause of the plan guide.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="3238f-108">Структуры планов с неправильным использованием указаний запросов могут привести к проблемам при компиляции во время выполнения и ухудшению производительности.</span><span class="sxs-lookup"><span data-stu-id="3238f-108">Plan guides that misuse query hints can cause compilation, execution, or performance problems.</span></span> <span data-ttu-id="3238f-109">Структуры планов должны применяться только опытными разработчиками и администраторами баз данных.</span><span class="sxs-lookup"><span data-stu-id="3238f-109">Plan guides should be used only by experienced developers and database administrators.</span></span>  
  
## <a name="common-query-hints-used-in-plan-guides"></a><span data-ttu-id="3238f-110">Общие указания запросов, используемые в структурах планов</span><span class="sxs-lookup"><span data-stu-id="3238f-110">Common Query Hints Used in Plan Guides</span></span>  
 <span data-ttu-id="3238f-111">Запросы, получающие преимущества от структур планов, обычно используют параметры и могут выполняться неэффективно, так как при их выполнении кэшируются планы запросов со значениями параметров, не соответствующими сценарию худшего случая или типичному сценарию.</span><span class="sxs-lookup"><span data-stu-id="3238f-111">Queries that can benefit from plan guides are generally parameter-based, and may be performing poorly because they use cached query plans whose parameter values do not represent a worst-case or most representative scenario.</span></span> <span data-ttu-id="3238f-112">Для решения этой проблемы можно использовать указания запросов OPTIMIZE FOR и RECOMPILE.</span><span class="sxs-lookup"><span data-stu-id="3238f-112">The OPTIMIZE FOR and RECOMPILE query hints can be used to address this problem.</span></span> <span data-ttu-id="3238f-113">Подсказка OPTIMIZE FOR сообщает [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , что нужно использовать конкретное значение параметра при оптимизации запроса.</span><span class="sxs-lookup"><span data-stu-id="3238f-113">OPTIMIZE FOR instructs [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to use a particular value for a parameter when the query is optimized.</span></span> <span data-ttu-id="3238f-114">Указание RECOMPILE сообщает серверу, что после выполнения план запроса нужно удалить и что оптимизатору запросов нужно будет перекомпилировать план при следующем выполнении запроса.</span><span class="sxs-lookup"><span data-stu-id="3238f-114">RECOMPILE instructs the server to discard a query plan after execution, forcing the query optimizer to recompile a new query plan the next time that the same query is executed.</span></span> <span data-ttu-id="3238f-115">См. пример в статье [Руководства планов](plan-guides.md).</span><span class="sxs-lookup"><span data-stu-id="3238f-115">For an example, see [Plan Guides](plan-guides.md).</span></span>  
  
 <span data-ttu-id="3238f-116">Кроме того, можно задать указания таблицы INDEX, FORCESCAN и FORCESEEK как указания запроса.</span><span class="sxs-lookup"><span data-stu-id="3238f-116">In addition, you can specify the table hints INDEX, FORCESCAN, and FORCESEEK as query hints.</span></span> <span data-ttu-id="3238f-117">При использовании в качестве указаний запроса они ведут себя так же, как и встроенные табличные указания или указания представлений.</span><span class="sxs-lookup"><span data-stu-id="3238f-117">When specified as query hints, these hints behave like an inline table or view hint.</span></span> <span data-ttu-id="3238f-118">Указание INDEX вынуждает оптимизатор запросов использовать только заданные индексы при получении доступа к данным ссылочной таблицы или ссылочного представления.</span><span class="sxs-lookup"><span data-stu-id="3238f-118">The INDEX hint forces the query optimizer to use only the specified indexes to access the data in the referenced table or view.</span></span> <span data-ttu-id="3238f-119">Указание FORCESEEK вынуждает оптимизатор запросов использовать только операцию поиска по индексу для доступа к данным ссылочной таблицы или ссылочного представления в запросе.</span><span class="sxs-lookup"><span data-stu-id="3238f-119">The FORCESEEK hint forces the optimizer to use only an index seek operation to access the data in the referenced table or view.</span></span> <span data-ttu-id="3238f-120">Эти указания предоставляют дополнительные функциональные возможности структуре плана и позволяют оказывать большее влияние на процесс оптимизации запросов, использующих структуру плана.</span><span class="sxs-lookup"><span data-stu-id="3238f-120">These hints provide additional plan guide functionality and allow you to have more influence over the optimization of queries that use the plan guide.</span></span>  
  
  
