---
title: Общие сведения о групповой загрузке XML (SQLXML 4,0) | Документация Майкрософт
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: reference
helpviewer_keywords:
- nontransacted XML Bulk Load operations
- XML Bulk Load [SQLXML], about XML Bulk Load
- bulk load [SQLXML], about bulk load
- transacted XML Bulk Load operations
- streaming XML data
ms.assetid: 38bd3cbd-65ef-4c23-9ef3-e70ecf6bb88a
author: rothja
ms.author: jroth
ms.openlocfilehash: 4f3e0e78edd967e5fcb7377312c1811d34cb1ef8
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87728141"
---
# <a name="introduction-to-xml-bulk-load-sqlxml-40"></a><span data-ttu-id="c2b5a-102">Введение в массовую загрузку XML (SQLXML 4.0)</span><span class="sxs-lookup"><span data-stu-id="c2b5a-102">Introduction to XML Bulk Load (SQLXML 4.0)</span></span>
  <span data-ttu-id="c2b5a-103">Массовая загрузка XML является изолированным объектом COM, который позволяет загрузить частично структурированные XML-данные в таблицы Microsoft [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c2b5a-103">XML Bulk Load is a stand-alone COM object that allows you to load semistructured XML data into Microsoft [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] tables.</span></span>  
  
 <span data-ttu-id="c2b5a-104">Можно вставить XML-данные в базу данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] при помощи инструкции INSERT и функции OPENXML, однако программа массовой загрузки обладает более высокой производительностью, если нужно вставить большие объемы XML-данных.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-104">You can insert XML data into a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database by using an INSERT statement and the OPENXML function; however, the Bulk Load utility provides better performance when you need to insert large amounts of XML data.</span></span>  
  
 <span data-ttu-id="c2b5a-105">Метод Execute модели объектов с массовым загрузкой XML принимает два параметра:</span><span class="sxs-lookup"><span data-stu-id="c2b5a-105">The Execute method of the XML Bulk Load object model takes two parameters:</span></span>  
  
-   <span data-ttu-id="c2b5a-106">Схема XSD (XML Schema definition) с заметками или схема XDR (XML-Data Reduced) с заметками.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-106">An annotated XML Schema Definition (XSD) or XML-Data Reduced (XDR) schema.</span></span> <span data-ttu-id="c2b5a-107">Программа массовой загрузки XML интерпретирует эту схему сопоставления и заметки, которые указаны в схеме, при идентификации таблиц SQL Server, в которые XML-данные будут вставлены.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-107">The XML Bulk Load utility interprets this mapping schema and the annotations that are specified in the schema in identifying the SQL Server tables into which the XML data is to be inserted.</span></span>  
  
-   <span data-ttu-id="c2b5a-108">XML-документ или фрагмент документа (фрагмент документа — это документ, в котором элемент верхнего уровня может быть не единственным).</span><span class="sxs-lookup"><span data-stu-id="c2b5a-108">An XML document or document fragment (a document fragment is a document without a single top-level element).</span></span> <span data-ttu-id="c2b5a-109">Может быть указано имя файла или поток, из которого массовая загрузка XML может читать.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-109">A file name or a stream from which XML Bulk Load can read can be specified.</span></span>  
  
 <span data-ttu-id="c2b5a-110">Массовая загрузка XML интерпретирует схему сопоставления и указывает таблицу или таблицы, в которые будут вставлены XML-данные.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-110">XML Bulk Load interprets the mapping schema and identifies the table(s) into which the XML data is to be inserted.</span></span>  
  
 <span data-ttu-id="c2b5a-111">Предполагается, что читатель знаком со следующими функциями [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c2b5a-111">It is assumed that you are familiar with the following [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] features:</span></span>  
  
-   <span data-ttu-id="c2b5a-112">Схемы XSD и XDR с заметками.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-112">Annotated XSD and XDR schemas.</span></span> <span data-ttu-id="c2b5a-113">Дополнительные сведения о схемах XSD с заметками см. [в статье Введение в схемы XSD с Заметками &#40;SQLXML 4,0&#41;](../../sqlxml/annotated-xsd-schemas/introduction-to-annotated-xsd-schemas-sqlxml-4-0.md).</span><span class="sxs-lookup"><span data-stu-id="c2b5a-113">For more information about annotated XSD schemas, see [Introduction to Annotated XSD Schemas &#40;SQLXML 4.0&#41;](../../sqlxml/annotated-xsd-schemas/introduction-to-annotated-xsd-schemas-sqlxml-4-0.md).</span></span> <span data-ttu-id="c2b5a-114">Сведения о схемах XDR с заметками см. [в разделе схемы XDR с Заметками &#40;устаревшие в SQLXML 4,0&#41;](../../sqlxml/annotated-xsd-schemas/annotated-xdr-schemas-deprecated-in-sqlxml-4-0.md).</span><span class="sxs-lookup"><span data-stu-id="c2b5a-114">For information about annotated XDR schemas, see [Annotated XDR Schemas &#40;Deprecated in SQLXML 4.0&#41;](../../sqlxml/annotated-xsd-schemas/annotated-xdr-schemas-deprecated-in-sqlxml-4-0.md).</span></span>  
  
-   <span data-ttu-id="c2b5a-115">Механизмы массовой вставки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], такие как инструкция [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT и программа bcp.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-115">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] bulk insert mechanisms, such as the [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT statement and the bcp utility.</span></span> <span data-ttu-id="c2b5a-116">Дополнительные сведения см. в статьях [BULK INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/bulk-insert-transact-sql) и [bcp Utility](../../../tools/bcp-utility.md).</span><span class="sxs-lookup"><span data-stu-id="c2b5a-116">For more information, see [BULK INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/bulk-insert-transact-sql) and [bcp Utility](../../../tools/bcp-utility.md).</span></span>  
  
## <a name="streaming-of-xml-data"></a><span data-ttu-id="c2b5a-117">Потоковая передача XML-данных</span><span class="sxs-lookup"><span data-stu-id="c2b5a-117">Streaming of XML Data</span></span>  
 <span data-ttu-id="c2b5a-118">Так как исходный XML-документ может быть большого размера, для обработки массовой загрузки целый документ не читается в память.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-118">Because the source XML document can be large, the entire document is not read into memory for bulk load processing.</span></span> <span data-ttu-id="c2b5a-119">Вместо этого массовая загрузка XML интерпретирует XML-данные как поток и читает.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-119">Instead, XML Bulk Load interprets the XML data as a stream and reads it.</span></span> <span data-ttu-id="c2b5a-120">После того как программа прочитает данные, она идентифицирует таблицу базы данных, создает соответствующую запись из источника XML-данных, а затем отправляет запись [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для вставки.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-120">As the utility reads the data, it identifies the database table(s), generates the appropriate record(s) from the XML data source, and then sends the record(s) to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] for insertion.</span></span>  
  
 <span data-ttu-id="c2b5a-121">Например, следующий исходный XML-документ состоит из **\<Customer>** элементов и **\<Order>** дочерних элементов:</span><span class="sxs-lookup"><span data-stu-id="c2b5a-121">For example, the following source XML document consists of **\<Customer>** elements and **\<Order>** child elements:</span></span>  
  
```  
<Customer ...>  
    <Order.../>  
    <Order .../>  
     ...  
</Customer>  
...  
```  
  
 <span data-ttu-id="c2b5a-122">Поскольку при выполнении операции XML-загрузки считывается **\<Customer>** элемент, он создает запись для кустомертабле.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-122">As XML Bulk Load reads the **\<Customer>** element, it generates a record for the Customertable.</span></span> <span data-ttu-id="c2b5a-123">Когда он считывает **\</Customer>** закрывающий тег, при выполнении операции XML-загрузки выполняется вставка этой записи в таблицу в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="c2b5a-123">When it reads the **\</Customer>** end tag, XML Bulk Load inserts that record into the table in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c2b5a-124">Аналогичным образом, при считывании элемента при выполнении **\<Order>** XML-загрузки при выполнении операции «неполная загрузка» создается запись для ордертабле, а затем эта запись вставляется в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] таблицу при считывании **\</Order>** закрывающего тега.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-124">In the same way, when it reads the **\<Order>** element, XML Bulk Load generates a record for the Ordertable, and then inserts that record into the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] table upon reading the **\</Order>** end tag.</span></span>  
  
## <a name="transacted-and-nontransacted-xml-bulk-load-operations"></a><span data-ttu-id="c2b5a-125">Транзакционные и нетранзакционные операции массовой загрузки XML</span><span class="sxs-lookup"><span data-stu-id="c2b5a-125">Transacted and Nontransacted XML Bulk Load Operations</span></span>  
 <span data-ttu-id="c2b5a-126">Массовая загрузка XML может работать в транзакционном и нетранзакционном режимах.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-126">XML Bulk Load can operate in either a transacted or a nontransacted mode.</span></span> <span data-ttu-id="c2b5a-127">Производительность обычно является оптимальной при выполнении многоязыковой загрузки в неусловном режиме: то есть свойство Transaction имеет значение FALSE, и одно из следующих условий имеет значение true.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-127">Performance is usually optimal if you are bulk loading in a nontransacted mode: that is, the Transaction property is set to FALSE) and either of the following conditions is true:</span></span>  
  
-   <span data-ttu-id="c2b5a-128">Таблицы, в которые происходит массовая загрузка данных, пусты и не имеют индексов.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-128">The tables into which the data is bulk loaded are empty with no indexes.</span></span>  
  
-   <span data-ttu-id="c2b5a-129">Таблицы содержат данные и имеют уникальные индексы.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-129">The tables have data and unique indexes.</span></span>  
  
 <span data-ttu-id="c2b5a-130">Нетранзакционный подход не гарантирует возможности отката, если в процессе массовой загрузки что-то пойдет не так (также могут случаться частичные откаты).</span><span class="sxs-lookup"><span data-stu-id="c2b5a-130">The nontransacted approach does not guarantee a rollback if something goes wrong in the bulk load process (although partial rollbacks can happen).</span></span> <span data-ttu-id="c2b5a-131">Нетранзакционная массовая загрузка подходит, если база данных пуста.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-131">The nontransacted bulk load is appropriate when the database is empty.</span></span> <span data-ttu-id="c2b5a-132">В этом случае, если что-то пошло не так, можно очистить базу данных и начать массовую загрузку XML заново.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-132">Therefore, if something does go wrong, you can clean the database and start XML Bulk Load again.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c2b5a-133">В нетранзакционном режиме массовая загрузка XML использует вложенные внутренние транзакции по умолчанию и фиксирует их.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-133">In nontransacted mode, XML Bulk Load uses a default internal transaction and commits it.</span></span> <span data-ttu-id="c2b5a-134">Если свойство Transaction имеет значение TRUE, при выполнении этой транзакции не выполняется автоматическая загрузка XML.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-134">When the Transaction property is set to TRUE, XML Bulk Load does not call commit on this transaction.</span></span>  
  
 <span data-ttu-id="c2b5a-135">Если для свойства Transaction задано значение TRUE, то при выполнении операции XML-загрузки выполняется создание временных файлов, по одному для каждой таблицы, определенной в схеме сопоставления.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-135">If the Transaction property is set to TRUE, XML Bulk Load creates temporary files, one for each table that is identified in the mapping schema.</span></span> <span data-ttu-id="c2b5a-136">Массовая загрузка XML сначала поместит записи из исходного XML-документа в эти временные файлы.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-136">XML Bulk Load first stores the records from the source XML document in these temporary files.</span></span> <span data-ttu-id="c2b5a-137">Затем инструкция [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT получит эти записи из файлов и поместит их в соответствующие таблицы.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-137">Then, a [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT statement retrieves these records from the files and stores them in the corresponding tables.</span></span> <span data-ttu-id="c2b5a-138">Расположение этих временных файлов можно указать с помощью свойства TempFilePath.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-138">You can specify the location for these temporary files by using the TempFilePath property.</span></span> <span data-ttu-id="c2b5a-139">Следует убедиться, что у учетной записи [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], используемой в массовой загрузке XML, есть доступ к этому пути.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-139">You must ensure that the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] account used with XML Bulk Load has access to this path.</span></span> <span data-ttu-id="c2b5a-140">Если свойство TempFilePath не задано, для создания временных файлов используется путь к файлу по умолчанию, указанный в переменной среды TEMP.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-140">If the TempFilePath property is not specified, the default file path that is specified in the TEMP environment variable is used to create the temporary files.</span></span>  
  
 <span data-ttu-id="c2b5a-141">Если для свойства Transaction задано значение FALSE (значение по умолчанию), при выполнении групповой загрузки XML для выполнения операции загрузки данных используется интерфейс OLE DB IRowsetFastLoad.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-141">If the Transaction property is set to FALSE (the default setting), XML Bulk Load uses the OLE DB interface IRowsetFastLoad to bulk load the data.</span></span>  
  
 <span data-ttu-id="c2b5a-142">Если свойство ConnectionString задает строку соединения, а свойство Transaction имеет значение TRUE, то при выполнении операции XML-загрузки выполняется в собственном контексте транзакции.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-142">If the ConnectionString property sets the connection string, and the Transaction property is set to TRUE, XML Bulk Load operates in its own transaction context.</span></span> <span data-ttu-id="c2b5a-143">(Например, массовая загрузка XML начинает собственную транзакцию и фиксирует изменения или при необходимости производит откат.)</span><span class="sxs-lookup"><span data-stu-id="c2b5a-143">(For example, XML Bulk Load starts its own transaction, and commits or rolls back as appropriate.)</span></span>  
  
 <span data-ttu-id="c2b5a-144">Если свойство ConnectionCommand устанавливает соединение с существующим объектом соединения, а свойство Transaction имеет значение TRUE, то при выполнении автоматической загрузки XML инструкция COMMIT или ROLLBACK не выдается в случае успеха или сбоя соответственно.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-144">If the ConnectionCommand property sets the connection with an existing connection object and the Transaction property is set to TRUE, XML Bulk Load does not issue a COMMIT or ROLLBACK statement in the case of a success or a failure, respectively.</span></span> <span data-ttu-id="c2b5a-145">Если происходит ошибка, массовая загрузка XML возвращает соответствующее сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-145">If there is an error, XML Bulk Load returns the appropriate error message.</span></span> <span data-ttu-id="c2b5a-146">Решение об использовании инструкции COMMIT или ROLLBACK остается за клиентом, который инициировал массовую загрузку.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-146">The decision to issue a COMMIT or ROLLBACK statement is left to the client that initiated the bulk load.</span></span> <span data-ttu-id="c2b5a-147">Объект соединения, используемый для групповой загрузки XML, должен иметь тип ICommand или объект команды ADO.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-147">The connection object that is used for XML Bulk Load should be of type ICommand or be an ADO command object.</span></span>  
  
 <span data-ttu-id="c2b5a-148">В SQLXML 4,0 Коннектионобжект нельзя использовать, если свойство Transaction имеет значение FALSE.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-148">In SQLXML 4.0, a ConnectionObject cannot be used with the Transaction property set to FALSE.</span></span> <span data-ttu-id="c2b5a-149">Неподдерживаемый режим не поддерживается для Коннектионобжект, так как невозможно открыть более одного интерфейса IRowsetFastLoad в переданном сеансе.</span><span class="sxs-lookup"><span data-stu-id="c2b5a-149">The nontransacted mode is not supported with a ConnectionObject because it is impossible to open more than one IRowsetFastLoad interface on a passed-in session.</span></span>  
  
  
