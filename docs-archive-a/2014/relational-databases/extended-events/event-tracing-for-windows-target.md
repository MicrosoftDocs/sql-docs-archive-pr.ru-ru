---
title: Цель "Средство трассировки событий для Windows" | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xevents
ms.topic: conceptual
helpviewer_keywords:
- event tracing for windows target
- ETW target
- targets [SQL Server extended events], event tracing for windows target
ms.assetid: ca2bb295-b7f6-49c3-91ed-0ad4c39f89d5
author: rothja
ms.author: jroth
ms.openlocfilehash: 55f247af30b5278f614b6505a94266cc07ec6c54
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655736"
---
# <a name="event-tracing-for-windows-target"></a>Цель «Средство трассировки событий для Windows»
  Прежде чем использовать средство трассировки событий для Windows (ETW) в качестве назначения, рекомендуется сначала попрактиковаться в работе с данным средством. Трассировка событий Windows используется совместно с расширенными событиями или в качестве потребителя расширенных событий. Следующие внешние ссылки помогут получить начальные сведения о трассировке событий Windows.  
  
-   [События Windows](https://go.microsoft.com/fwlink/?LinkId=92380)  
  
-   [Усовершенствованные отладка и настройка производительности с помощью приложения ETW](https://go.microsoft.com/fwlink/?LinkId=92381)  
  
 Цель «Трассировка событий Windows» является одноэлементным целевым объектом, хотя она может быть добавлена в несколько сеансов. Если событие происходит в нескольких сеансах, то данное событие будет передано цели трассировки событий Windows по одному разу для каждого произошедшего события. Каждый процесс может иметь только одну подсистему расширенных событий.  
  
> [!IMPORTANT]  
>  Чтобы назначение ETW работало, стартовая учетная запись служб [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должна входить в группу «Пользователи журналов производительности».  
  
 Конфигурация событий в сеансе ETW управляется процессом, в котором размещена подсистема расширенных событий. Эта подсистема управляет последовательностью и условиями запуска событий.  
  
 После привязки к сеансу расширенных событий, который присоединяет назначение средства отслеживания событий для Windows в первый раз в процессе, средство ETW открывает один сеанс ETW в поставщике [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Если сеанс ETW уже существует, цель ETW получает ссылку на существующий сеанс. Этот сеанс ETW используется всеми экземплярами [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на компьютере. Сеанс ETW получает все события от сеансов, имеющих цель ETW.  
  
 Поскольку приложению ETW требуются поставщики, способные потреблять события и направлять их в ETW, в сеансе включаются все пакеты расширенных событий. При запуске события цель ETW отправляет его в сеанс, в котором включен поставщик события.  
  
 Назначение ETW поддерживает синхронную публикацию событий в потоке, запускающем это событие. Однако назначение ETW не поддерживает асинхронную публикацию событий.  
  
 Назначение трассировки событий Windows не может управляться внешними контроллерами трассировки событий Windows, например Logman.exe. Для трассировки событий Windows нужно создать сеанс события с назначением трассировки событий Windows. Дополнительные сведения см. в разделе [CREATE EVENT SESSION (Transact-SQL)](/sql/t-sql/statements/create-event-session-transact-sql).  
  
> [!NOTE]  
>  При включении назначения ETW создается сеанс ETW с именем XE_DEFAULT_ETW_SESSION. Если сеанс с именем XE_DEFAULT_ETW_SESSION уже существует, то он используется как есть, без изменения свойств. Сеанс XE_DEFAULT_ETW_SESSION используется совместно всеми экземплярами [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. После запуска сеанса XE_DEFAULT_ETW_SESSION необходимо остановить его с помощью контроллера ETW, например инструмента Logman. Например, можно выполнить в командной строке следующую команду: `logman stop XE_DEFAULT_ETW_SESSION -ets`.  
  
 В следующей таблице описаны доступные параметры для настройки назначения ETW.  
  
|Параметр|Допустимые значения|Описание|  
|------------|--------------------|-----------------|  
|default_xe_session_name|Любая строка длиной до 256 символов. Это значение является необязательным.|Имя сеанса расширенных событий. По умолчанию это XE_DEFAULT_ETW_SESSION.|  
|default_etw_session_logfile_path|Любая строка длиной до 256 символов. Это значение является необязательным.|Путь к файлу журнала сеанса расширенных событий. По умолчанию %TEMP%\ XEEtw.etl.|  
|default_etw_session_logfile_size_mb|Любое целое число без знака. Это значение является необязательным.|Размер файла журнала для сеанса расширенных событий (в мегабайтах, МБ). По умолчанию установлено значение 20 МБ.|  
|default_etw_session_buffer_size_kb|Любое целое число без знака. Это значение является необязательным.|Размер буфера в памяти (в килобайтах) для сеанса расширенных событий. Значение по умолчанию — 128 КБ.|  
|retries|Любое целое число без знака.|Число попыток публикации события в подсистеме ETW до удаления события. Значение по умолчанию равно 0.|  
  
 Конфигурация указанных параметров не обязательна. Цель ETW использует для них параметры по умолчанию.  
  
 Цель ETW отвечает за следующие действия.  
  
-   Создание сеанса ETW по умолчанию.  
  
-   Регистрация всех пакетов расширенных событий в приложении ETW. Тем самым обеспечивается сохранность событий в приложении ETW.  
  
-   Управление потоком событий, направляемых приложению ETW. Цель ETW создает событие ETW с данными, полученными от расширенных событий, и отправляет это событие в соответствующий сеанс ETW. Если событие превышает размер буфера или данные не вмещаются в одно событие ETW, приложение ETW разбивает это событие на фрагменты.  
  
-   Хранение пакетов расширенных событий включено постоянно.  
  
 Приложение ETW по умолчанию использует следующие расположения.  
  
-   Выходной файл ETW: %TEMP%\XEEtw.etl.  
  
    > [!IMPORTANT]  
    >  После начала первого сеанса путь к файлу изменить нельзя.  
  
-   MOF-файлы находятся в папке: *\<your install path>* \Microsoft SQL Server\Shared Дополнительные сведения см. в разделе [Формат управляющих объектов](https://go.microsoft.com/fwlink/?LinkId=92851) библиотеки MSDN.  
  
## <a name="adding-the-target-to-a-session"></a>Добавление цели к сеансу  
 Для добавления назначения счетчика событий в сеанс расширенных событий следует использовать одну из следующих инструкций при создании или изменении сеанса события:  
  
```  
ADD TARGET package0.etw_classic_sync_target  
```  
  
 Дополнительные сведения о полном примере, который показывает, как использовать назначение трассировки событий, включая просмотр данных, см. в разделе [отслеживать активность системы с помощью расширенных событий](monitor-system-activity-using-extended-events.md).  
  
## <a name="see-also"></a>См. также:  
 [Цели расширенных событий SQL Server](../../database-engine/sql-server-extended-events-targets.md)   
 [sys.dm_xe_session_targets (Transact-SQL)](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql)   
 [CREATE EVENT SESSION (Transact-SQL)](/sql/t-sql/statements/create-event-session-transact-sql)   
 [ALTER EVENT SESSION (Transact-SQL)](/sql/t-sql/statements/alter-event-session-transact-sql)  
  
  
