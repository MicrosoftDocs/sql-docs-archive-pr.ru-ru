---
title: Цель "Средство трассировки событий для Windows" | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xevents
ms.topic: conceptual
helpviewer_keywords:
- event tracing for windows target
- ETW target
- targets [SQL Server extended events], event tracing for windows target
ms.assetid: ca2bb295-b7f6-49c3-91ed-0ad4c39f89d5
author: rothja
ms.author: jroth
ms.openlocfilehash: 55f247af30b5278f614b6505a94266cc07ec6c54
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655736"
---
# <a name="event-tracing-for-windows-target"></a><span data-ttu-id="9a903-102">Цель «Средство трассировки событий для Windows»</span><span class="sxs-lookup"><span data-stu-id="9a903-102">Event Tracing for Windows Target</span></span>
  <span data-ttu-id="9a903-103">Прежде чем использовать средство трассировки событий для Windows (ETW) в качестве назначения, рекомендуется сначала попрактиковаться в работе с данным средством.</span><span class="sxs-lookup"><span data-stu-id="9a903-103">Before you use Event Tracing for Windows (ETW) as a target, we recommend that you have a working knowledge of ETW.</span></span> <span data-ttu-id="9a903-104">Трассировка событий Windows используется совместно с расширенными событиями или в качестве потребителя расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="9a903-104">ETW tracing is either used together with Extended Events or as an Extended Events event consumer.</span></span> <span data-ttu-id="9a903-105">Следующие внешние ссылки помогут получить начальные сведения о трассировке событий Windows.</span><span class="sxs-lookup"><span data-stu-id="9a903-105">The following external links provide a starting point for obtaining background information about ETW:</span></span>  
  
-   [<span data-ttu-id="9a903-106">События Windows</span><span class="sxs-lookup"><span data-stu-id="9a903-106">Windows Events</span></span>](https://go.microsoft.com/fwlink/?LinkId=92380)  
  
-   [<span data-ttu-id="9a903-107">Усовершенствованные отладка и настройка производительности с помощью приложения ETW</span><span class="sxs-lookup"><span data-stu-id="9a903-107">Improve Debugging And Performance Tuning With ETW</span></span>](https://go.microsoft.com/fwlink/?LinkId=92381)  
  
 <span data-ttu-id="9a903-108">Цель «Трассировка событий Windows» является одноэлементным целевым объектом, хотя она может быть добавлена в несколько сеансов.</span><span class="sxs-lookup"><span data-stu-id="9a903-108">The ETW target is a singleton target, although the target can be added to many sessions.</span></span> <span data-ttu-id="9a903-109">Если событие происходит в нескольких сеансах, то данное событие будет передано цели трассировки событий Windows по одному разу для каждого произошедшего события.</span><span class="sxs-lookup"><span data-stu-id="9a903-109">If an event is raised on many sessions, the event will only be propagated to the ETW target one time per event occurrence.</span></span> <span data-ttu-id="9a903-110">Каждый процесс может иметь только одну подсистему расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="9a903-110">The Extended Events engine is limited to a single instance per process.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="9a903-111">Чтобы назначение ETW работало, стартовая учетная запись служб [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должна входить в группу «Пользователи журналов производительности».</span><span class="sxs-lookup"><span data-stu-id="9a903-111">For the ETW target to work, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Service startup account must be a member of the Performance Log Users group.</span></span>  
  
 <span data-ttu-id="9a903-112">Конфигурация событий в сеансе ETW управляется процессом, в котором размещена подсистема расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="9a903-112">The configuration of the events present in an ETW session is controlled by the process that hosts the Extended Events engine.</span></span> <span data-ttu-id="9a903-113">Эта подсистема управляет последовательностью и условиями запуска событий.</span><span class="sxs-lookup"><span data-stu-id="9a903-113">The engine controls which events to raise and what conditions must be met for an event to occur.</span></span>  
  
 <span data-ttu-id="9a903-114">После привязки к сеансу расширенных событий, который присоединяет назначение средства отслеживания событий для Windows в первый раз в процессе, средство ETW открывает один сеанс ETW в поставщике [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="9a903-114">After binding to an Extended Events session, which attaches the ETW target for the first time during the lifetime of a process, the ETW target opens a single ETW session on the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provider.</span></span> <span data-ttu-id="9a903-115">Если сеанс ETW уже существует, цель ETW получает ссылку на существующий сеанс.</span><span class="sxs-lookup"><span data-stu-id="9a903-115">If an ETW session already exists, the ETW target obtains a reference to the existing session.</span></span> <span data-ttu-id="9a903-116">Этот сеанс ETW используется всеми экземплярами [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на компьютере.</span><span class="sxs-lookup"><span data-stu-id="9a903-116">This ETW session is shared across all [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instances on a given computer.</span></span> <span data-ttu-id="9a903-117">Сеанс ETW получает все события от сеансов, имеющих цель ETW.</span><span class="sxs-lookup"><span data-stu-id="9a903-117">This ETW session receives all the events from sessions that have the ETW target.</span></span>  
  
 <span data-ttu-id="9a903-118">Поскольку приложению ETW требуются поставщики, способные потреблять события и направлять их в ETW, в сеансе включаются все пакеты расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="9a903-118">Because ETW needs providers to be enabled to consume events and flow them down to the ETW, all Extended Events packages are enabled on the session.</span></span> <span data-ttu-id="9a903-119">При запуске события цель ETW отправляет его в сеанс, в котором включен поставщик события.</span><span class="sxs-lookup"><span data-stu-id="9a903-119">When an event is fired, the ETW target sends the event to the session on which the provider for the event is enabled.</span></span>  
  
 <span data-ttu-id="9a903-120">Назначение ETW поддерживает синхронную публикацию событий в потоке, запускающем это событие.</span><span class="sxs-lookup"><span data-stu-id="9a903-120">The ETW target supports synchronous publishing of events on the thread that raises the event.</span></span> <span data-ttu-id="9a903-121">Однако назначение ETW не поддерживает асинхронную публикацию событий.</span><span class="sxs-lookup"><span data-stu-id="9a903-121">However, the ETW target does not support asynchronous event publishing.</span></span>  
  
 <span data-ttu-id="9a903-122">Назначение трассировки событий Windows не может управляться внешними контроллерами трассировки событий Windows, например Logman.exe.</span><span class="sxs-lookup"><span data-stu-id="9a903-122">The ETW target does not support control from external ETW controllers such as Logman.exe.</span></span> <span data-ttu-id="9a903-123">Для трассировки событий Windows нужно создать сеанс события с назначением трассировки событий Windows.</span><span class="sxs-lookup"><span data-stu-id="9a903-123">To produce ETW traces, an event session must be created with the ETW target.</span></span> <span data-ttu-id="9a903-124">Дополнительные сведения см. в разделе [CREATE EVENT SESSION (Transact-SQL)](/sql/t-sql/statements/create-event-session-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9a903-124">For more information, see [CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9a903-125">При включении назначения ETW создается сеанс ETW с именем XE_DEFAULT_ETW_SESSION.</span><span class="sxs-lookup"><span data-stu-id="9a903-125">Enabling the ETW target creates an ETW session that is named XE_DEFAULT_ETW_SESSION.</span></span> <span data-ttu-id="9a903-126">Если сеанс с именем XE_DEFAULT_ETW_SESSION уже существует, то он используется как есть, без изменения свойств.</span><span class="sxs-lookup"><span data-stu-id="9a903-126">If a session with the name XE_DEFAULT_ETW_SESSION already exists, it is used without modifying any properties of the existing session.</span></span> <span data-ttu-id="9a903-127">Сеанс XE_DEFAULT_ETW_SESSION используется совместно всеми экземплярами [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9a903-127">The XE_DEFAULT_ETW_SESSION is shared between all instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="9a903-128">После запуска сеанса XE_DEFAULT_ETW_SESSION необходимо остановить его с помощью контроллера ETW, например инструмента Logman.</span><span class="sxs-lookup"><span data-stu-id="9a903-128">After you start the XE_DEFAULT_ETW_SESSION, you must stop it by using an ETW controller, such as the Logman tool.</span></span> <span data-ttu-id="9a903-129">Например, можно выполнить в командной строке следующую команду: `logman stop XE_DEFAULT_ETW_SESSION -ets`.</span><span class="sxs-lookup"><span data-stu-id="9a903-129">For example, you can run the following command at the command prompt: `logman stop XE_DEFAULT_ETW_SESSION -ets`.</span></span>  
  
 <span data-ttu-id="9a903-130">В следующей таблице описаны доступные параметры для настройки назначения ETW.</span><span class="sxs-lookup"><span data-stu-id="9a903-130">The following table describes the available options for configuring the ETW target.</span></span>  
  
|<span data-ttu-id="9a903-131">Параметр</span><span class="sxs-lookup"><span data-stu-id="9a903-131">Option</span></span>|<span data-ttu-id="9a903-132">Допустимые значения</span><span class="sxs-lookup"><span data-stu-id="9a903-132">Allowed values</span></span>|<span data-ttu-id="9a903-133">Описание</span><span class="sxs-lookup"><span data-stu-id="9a903-133">Description</span></span>|  
|------------|--------------------|-----------------|  
|<span data-ttu-id="9a903-134">default_xe_session_name</span><span class="sxs-lookup"><span data-stu-id="9a903-134">default_xe_session_name</span></span>|<span data-ttu-id="9a903-135">Любая строка длиной до 256 символов.</span><span class="sxs-lookup"><span data-stu-id="9a903-135">Any string up to 256 characters.</span></span> <span data-ttu-id="9a903-136">Это значение является необязательным.</span><span class="sxs-lookup"><span data-stu-id="9a903-136">This value is optional.</span></span>|<span data-ttu-id="9a903-137">Имя сеанса расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="9a903-137">The Extended Events session name.</span></span> <span data-ttu-id="9a903-138">По умолчанию это XE_DEFAULT_ETW_SESSION.</span><span class="sxs-lookup"><span data-stu-id="9a903-138">By default, this is XE_DEFAULT_ETW_SESSION.</span></span>|  
|<span data-ttu-id="9a903-139">default_etw_session_logfile_path</span><span class="sxs-lookup"><span data-stu-id="9a903-139">default_etw_session_logfile_path</span></span>|<span data-ttu-id="9a903-140">Любая строка длиной до 256 символов.</span><span class="sxs-lookup"><span data-stu-id="9a903-140">Any string up to 256 characters.</span></span> <span data-ttu-id="9a903-141">Это значение является необязательным.</span><span class="sxs-lookup"><span data-stu-id="9a903-141">This value is optional.</span></span>|<span data-ttu-id="9a903-142">Путь к файлу журнала сеанса расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="9a903-142">The path of the log file for the Extended Events session.</span></span> <span data-ttu-id="9a903-143">По умолчанию %TEMP%\ XEEtw.etl.</span><span class="sxs-lookup"><span data-stu-id="9a903-143">By default, this is %TEMP%\ XEEtw.etl.</span></span>|  
|<span data-ttu-id="9a903-144">default_etw_session_logfile_size_mb</span><span class="sxs-lookup"><span data-stu-id="9a903-144">default_etw_session_logfile_size_mb</span></span>|<span data-ttu-id="9a903-145">Любое целое число без знака.</span><span class="sxs-lookup"><span data-stu-id="9a903-145">Any unsigned integer.</span></span> <span data-ttu-id="9a903-146">Это значение является необязательным.</span><span class="sxs-lookup"><span data-stu-id="9a903-146">This value is optional.</span></span>|<span data-ttu-id="9a903-147">Размер файла журнала для сеанса расширенных событий (в мегабайтах, МБ).</span><span class="sxs-lookup"><span data-stu-id="9a903-147">The log file size, in megabytes (MB), for the Extended Events session.</span></span> <span data-ttu-id="9a903-148">По умолчанию установлено значение 20 МБ.</span><span class="sxs-lookup"><span data-stu-id="9a903-148">The default is 20 MB.</span></span>|  
|<span data-ttu-id="9a903-149">default_etw_session_buffer_size_kb</span><span class="sxs-lookup"><span data-stu-id="9a903-149">default_etw_session_buffer_size_kb</span></span>|<span data-ttu-id="9a903-150">Любое целое число без знака.</span><span class="sxs-lookup"><span data-stu-id="9a903-150">Any unsigned integer.</span></span> <span data-ttu-id="9a903-151">Это значение является необязательным.</span><span class="sxs-lookup"><span data-stu-id="9a903-151">This value is optional.</span></span>|<span data-ttu-id="9a903-152">Размер буфера в памяти (в килобайтах) для сеанса расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="9a903-152">The in-memory buffer size, in kilobytes (KB), for the Extended Events session.</span></span> <span data-ttu-id="9a903-153">Значение по умолчанию — 128 КБ.</span><span class="sxs-lookup"><span data-stu-id="9a903-153">The default is 128 KB.</span></span>|  
|<span data-ttu-id="9a903-154">retries</span><span class="sxs-lookup"><span data-stu-id="9a903-154">retries</span></span>|<span data-ttu-id="9a903-155">Любое целое число без знака.</span><span class="sxs-lookup"><span data-stu-id="9a903-155">Any unsigned integer.</span></span>|<span data-ttu-id="9a903-156">Число попыток публикации события в подсистеме ETW до удаления события.</span><span class="sxs-lookup"><span data-stu-id="9a903-156">The number of times to retry publishing the event to the ETW subsystem before dropping the event.</span></span> <span data-ttu-id="9a903-157">Значение по умолчанию равно 0.</span><span class="sxs-lookup"><span data-stu-id="9a903-157">The default is 0.</span></span>|  
  
 <span data-ttu-id="9a903-158">Конфигурация указанных параметров не обязательна.</span><span class="sxs-lookup"><span data-stu-id="9a903-158">Configuring these settings is optional.</span></span> <span data-ttu-id="9a903-159">Цель ETW использует для них параметры по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9a903-159">The ETW target uses default values for these settings.</span></span>  
  
 <span data-ttu-id="9a903-160">Цель ETW отвечает за следующие действия.</span><span class="sxs-lookup"><span data-stu-id="9a903-160">The ETW target is responsible for:</span></span>  
  
-   <span data-ttu-id="9a903-161">Создание сеанса ETW по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9a903-161">Creating the default ETW session.</span></span>  
  
-   <span data-ttu-id="9a903-162">Регистрация всех пакетов расширенных событий в приложении ETW.</span><span class="sxs-lookup"><span data-stu-id="9a903-162">Registering all Extended Events packages with ETW.</span></span> <span data-ttu-id="9a903-163">Тем самым обеспечивается сохранность событий в приложении ETW.</span><span class="sxs-lookup"><span data-stu-id="9a903-163">This ensures that events are not dropped by ETW.</span></span>  
  
-   <span data-ttu-id="9a903-164">Управление потоком событий, направляемых приложению ETW.</span><span class="sxs-lookup"><span data-stu-id="9a903-164">Managing the flow of events to ETW.</span></span> <span data-ttu-id="9a903-165">Цель ETW создает событие ETW с данными, полученными от расширенных событий, и отправляет это событие в соответствующий сеанс ETW.</span><span class="sxs-lookup"><span data-stu-id="9a903-165">The ETW target creates an ETW event with Extended Events data and sends it to the appropriate ETW session.</span></span> <span data-ttu-id="9a903-166">Если событие превышает размер буфера или данные не вмещаются в одно событие ETW, приложение ETW разбивает это событие на фрагменты.</span><span class="sxs-lookup"><span data-stu-id="9a903-166">If the event is larger than the buffer size, or data cannot fit in one ETW event, ETW splits the event into fragments.</span></span>  
  
-   <span data-ttu-id="9a903-167">Хранение пакетов расширенных событий включено постоянно.</span><span class="sxs-lookup"><span data-stu-id="9a903-167">Keeping Extended Events packages enabled at all times.</span></span>  
  
 <span data-ttu-id="9a903-168">Приложение ETW по умолчанию использует следующие расположения.</span><span class="sxs-lookup"><span data-stu-id="9a903-168">The following default file locations are used by ETW:</span></span>  
  
-   <span data-ttu-id="9a903-169">Выходной файл ETW: %TEMP%\XEEtw.etl.</span><span class="sxs-lookup"><span data-stu-id="9a903-169">The ETW output file is in %TEMP%\XEEtw.etl.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="9a903-170">После начала первого сеанса путь к файлу изменить нельзя.</span><span class="sxs-lookup"><span data-stu-id="9a903-170">The file path cannot be changed after the first session starts.</span></span>  
  
-   <span data-ttu-id="9a903-171">MOF-файлы находятся в папке: *\<your install path>* \Microsoft SQL Server\Shared</span><span class="sxs-lookup"><span data-stu-id="9a903-171">Managed Object Format (MOF) files are in *\<your install path>* \Microsoft SQL Server\Shared.</span></span> <span data-ttu-id="9a903-172">Дополнительные сведения см. в разделе [Формат управляющих объектов](https://go.microsoft.com/fwlink/?LinkId=92851) библиотеки MSDN.</span><span class="sxs-lookup"><span data-stu-id="9a903-172">For more information, see [Managed Object Format](https://go.microsoft.com/fwlink/?LinkId=92851) on MSDN.</span></span>  
  
## <a name="adding-the-target-to-a-session"></a><span data-ttu-id="9a903-173">Добавление цели к сеансу</span><span class="sxs-lookup"><span data-stu-id="9a903-173">Adding the Target to a Session</span></span>  
 <span data-ttu-id="9a903-174">Для добавления назначения счетчика событий в сеанс расширенных событий следует использовать одну из следующих инструкций при создании или изменении сеанса события:</span><span class="sxs-lookup"><span data-stu-id="9a903-174">To add the ETW target to an Extended Events session, you must include the following statement when you create or alter an event session:</span></span>  
  
```  
ADD TARGET package0.etw_classic_sync_target  
```  
  
 <span data-ttu-id="9a903-175">Дополнительные сведения о полном примере, который показывает, как использовать назначение трассировки событий, включая просмотр данных, см. в разделе [отслеживать активность системы с помощью расширенных событий](monitor-system-activity-using-extended-events.md).</span><span class="sxs-lookup"><span data-stu-id="9a903-175">For more information about a full example that shows how to use the ETW target, including how to view the data, see [Monitor System Activity Using Extended Events](monitor-system-activity-using-extended-events.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9a903-176">См. также:</span><span class="sxs-lookup"><span data-stu-id="9a903-176">See Also</span></span>  
 <span data-ttu-id="9a903-177">[Цели расширенных событий SQL Server](../../database-engine/sql-server-extended-events-targets.md) </span><span class="sxs-lookup"><span data-stu-id="9a903-177">[SQL Server Extended Events Targets](../../database-engine/sql-server-extended-events-targets.md) </span></span>  
 <span data-ttu-id="9a903-178">[sys.dm_xe_session_targets (Transact-SQL)](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="9a903-178">[sys.dm_xe_session_targets &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql) </span></span>  
 <span data-ttu-id="9a903-179">[CREATE EVENT SESSION (Transact-SQL)](/sql/t-sql/statements/create-event-session-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="9a903-179">[CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql) </span></span>  
 [<span data-ttu-id="9a903-180">ALTER EVENT SESSION (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="9a903-180">ALTER EVENT SESSION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-event-session-transact-sql)  
  
  
