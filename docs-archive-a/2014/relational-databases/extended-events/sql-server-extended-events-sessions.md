---
title: Сеансы расширенных событий SQL Server | Документация Майкрософт
ms.custom: ''
ms.date: 05/26/2020
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xevents
ms.topic: conceptual
helpviewer_keywords:
- xe
- sessions
- extend events [SQL Server]
ms.assetid: c3c92544-351a-4bce-a06a-1f2a47e494e9
author: rothja
ms.author: jroth
ms.openlocfilehash: 3aab8c57a578ea60829514b575e168bc5a1dd8c7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655168"
---
# <a name="sql-server-extended-events-sessions"></a><span data-ttu-id="d8823-102">SQL Server Extended Events Sessions</span><span class="sxs-lookup"><span data-stu-id="d8823-102">SQL Server Extended Events Sessions</span></span>
  <span data-ttu-id="d8823-103">Сеанс расширенных событий [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] создается в процессе [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , в котором выполняется подсистема расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="d8823-103">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Extended Events session is created in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] process hosting the Extended Events engine.</span></span> <span data-ttu-id="d8823-104">Следующие аспекты сеанса расширенных событий предоставляют контекст, необходимый для понимания инфраструктуры и принципов работы расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="d8823-104">The following aspects of an Extended Events session provide a context for understanding the Extended Events infrastructure and the general processing that takes place:</span></span>  
  
-   <span data-ttu-id="d8823-105">Состояния сеанса.</span><span class="sxs-lookup"><span data-stu-id="d8823-105">Session states.</span></span> <span data-ttu-id="d8823-106">Различные состояния сеанса расширенных событий при выполнении инструкций CREATE EVENT SESSION и ALTER EVENT SESSION.</span><span class="sxs-lookup"><span data-stu-id="d8823-106">The different states that an Extended Events session is in when CREATE EVENT SESSION and ALTER EVENT SESSION statements are executed.</span></span>  
  
-   <span data-ttu-id="d8823-107">Содержимое и характеристики сеанса.</span><span class="sxs-lookup"><span data-stu-id="d8823-107">Session content and characteristics.</span></span> <span data-ttu-id="d8823-108">Содержимое сеанса расширенных событий, например цели и события, и связь этих объектов в сеансе и между сеансами.</span><span class="sxs-lookup"><span data-stu-id="d8823-108">The content of an Extended Events session, such as targets and events, and how these objects are related in a session or between sessions.</span></span>  
  
## <a name="session-states"></a><span data-ttu-id="d8823-109">Состояния сеанса</span><span class="sxs-lookup"><span data-stu-id="d8823-109">Session States</span></span>  
 <span data-ttu-id="d8823-110">На следующем рисунке показаны различные состояния сеанса расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="d8823-110">The following illustration shows the various states of an Extended Events session.</span></span>  

<span data-ttu-id="d8823-111">![Состояние сеанса расширенных событий](../../database-engine/media/xesessionstate.png "Состояние сеанса расширенных событий")</span><span class="sxs-lookup"><span data-stu-id="d8823-111">![Extended event session state](../../database-engine/media/xesessionstate.png "Extended event session state")</span></span>

 <span data-ttu-id="d8823-112">Обратите внимание, что на предыдущем рисунке состояние сеанса меняется по мере того, как выполняются разные команды DDL.</span><span class="sxs-lookup"><span data-stu-id="d8823-112">Referring to the preceding figure, note that session state changes as the different DDL commands are issued for an event session.</span></span> <span data-ttu-id="d8823-113">В следующей таблице описаны эти изменения состояния.</span><span class="sxs-lookup"><span data-stu-id="d8823-113">The following table describes these changes in state.</span></span>  
  
|<span data-ttu-id="d8823-114">Метка рисунка</span><span class="sxs-lookup"><span data-stu-id="d8823-114">Illustration label</span></span>|<span data-ttu-id="d8823-115">Инструкция DDL</span><span class="sxs-lookup"><span data-stu-id="d8823-115">DDL statement</span></span>|<span data-ttu-id="d8823-116">Описание</span><span class="sxs-lookup"><span data-stu-id="d8823-116">Description</span></span>|  
|------------------------|-------------------|-----------------|  
|<span data-ttu-id="d8823-117">Создание</span><span class="sxs-lookup"><span data-stu-id="d8823-117">Create</span></span>|<span data-ttu-id="d8823-118">CREATE EVENT SESSION</span><span class="sxs-lookup"><span data-stu-id="d8823-118">CREATE EVENT SESSION</span></span>|<span data-ttu-id="d8823-119">Процесс создает объект сеанса, содержащий метаданные, предоставленные инструкцией CREATE EVENT SESSION.</span><span class="sxs-lookup"><span data-stu-id="d8823-119">The host process creates a session object that contains the metadata provided by CREATE EVENT SESSION.</span></span> <span data-ttu-id="d8823-120">Процесс проверяет определение сеанса, уровень разрешений пользователя и сохраняет метаданные в базе данных master.</span><span class="sxs-lookup"><span data-stu-id="d8823-120">The host process validates the session definition, validates the user permission level, and stores the metadata in the master database.</span></span> <span data-ttu-id="d8823-121">В этот момент сеанс неактивен.</span><span class="sxs-lookup"><span data-stu-id="d8823-121">At this point the session is not active.</span></span>|  
|<span data-ttu-id="d8823-122">Alter</span><span class="sxs-lookup"><span data-stu-id="d8823-122">Alter</span></span>|<span data-ttu-id="d8823-123">ALTER EVENT SESSION, STATE=START</span><span class="sxs-lookup"><span data-stu-id="d8823-123">ALTER EVENT SESSION, STATE=START</span></span>|<span data-ttu-id="d8823-124">Процесс запускает сеанс.</span><span class="sxs-lookup"><span data-stu-id="d8823-124">The host process starts the session.</span></span> <span data-ttu-id="d8823-125">Процесс считывает сохраненные метаданные, проверяет определение сеанса, уровень разрешений пользователя и создает сеанс.</span><span class="sxs-lookup"><span data-stu-id="d8823-125">The host process reads the stored metadata, validates the session definition, verifies the level of user permission level, and creates the session.</span></span> <span data-ttu-id="d8823-126">Загружаются такие объекты сеанса, как события и цели, и сеанс становится активным.</span><span class="sxs-lookup"><span data-stu-id="d8823-126">Session objects, such as events and targets, are loaded and event handling is active.</span></span>|  
|<span data-ttu-id="d8823-127">Alter</span><span class="sxs-lookup"><span data-stu-id="d8823-127">Alter</span></span>|<span data-ttu-id="d8823-128">ALTER EVENT SESSION, STATE=STOP</span><span class="sxs-lookup"><span data-stu-id="d8823-128">ALTER EVENT SESSION, STATE=STOP</span></span>|<span data-ttu-id="d8823-129">Процесс останавливает активный сеанс, но сохраняет метаданные.</span><span class="sxs-lookup"><span data-stu-id="d8823-129">The host process stops the active session but retains the metadata.</span></span>|  
|<span data-ttu-id="d8823-130">Drop</span><span class="sxs-lookup"><span data-stu-id="d8823-130">Drop</span></span>|<span data-ttu-id="d8823-131">DROP EVENT SESSION</span><span class="sxs-lookup"><span data-stu-id="d8823-131">DROP EVENT SESSION</span></span>|<span data-ttu-id="d8823-132">Если сеанс активен, инструкция удаляет метаданные и закрывает активный сеанс, в противном случае удаляет метаданные сеанса.</span><span class="sxs-lookup"><span data-stu-id="d8823-132">Depending on whether or not the session is active, Drop (DROP SESSION) will delete the metadata and close the active session, or delete the session metadata.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="d8823-133">Инструкции ALTER EVENT SESSION и DROP EVENT SESSION могут применяться к метаданным или к активному сеансу и метаданным.</span><span class="sxs-lookup"><span data-stu-id="d8823-133">Both ALTER EVENT SESSION and DROP EVENT SESSION can be applied to the metadata or to an active session and the metadata.</span></span>  
  
## <a name="session-content-and-characteristics"></a><span data-ttu-id="d8823-134">Содержимое и характеристики сеанса</span><span class="sxs-lookup"><span data-stu-id="d8823-134">Session Content and Characteristics</span></span>  
 <span data-ttu-id="d8823-135">Сеансы расширенных событий имеют неявные границы, выражающиеся в том, что конфигурация одного сеанса не изменяет конфигурацию другого сеанса.</span><span class="sxs-lookup"><span data-stu-id="d8823-135">Extended Event sessions have implied boundaries in that the configuration of one session does not change the configuration of another session.</span></span> <span data-ttu-id="d8823-136">Однако эти границы не мешают использованию одного события или одной цели в нескольких сеансах.</span><span class="sxs-lookup"><span data-stu-id="d8823-136">However, these boundaries do not prevent an event or target from being used in more than one session.</span></span>  
  
 <span data-ttu-id="d8823-137">На следующем рисунке показано содержимое сеанса и связь между пакетами и сеансами.</span><span class="sxs-lookup"><span data-stu-id="d8823-137">The following illustration shows session content and the relationship between packages and sessions.</span></span>  
  
 <span data-ttu-id="d8823-138">![Совместная работа и использование объектов в сеансах.](../../database-engine/media/xesessions.gif "Совместная работа и использование объектов в сеансах.")</span><span class="sxs-lookup"><span data-stu-id="d8823-138">![Object co-existance and sharing in sessions.](../../database-engine/media/xesessions.gif "Object co-existance and sharing in sessions.")</span></span>  
  
 <span data-ttu-id="d8823-139">Обратите внимание, что на предыдущем рисунке:</span><span class="sxs-lookup"><span data-stu-id="d8823-139">Referring to the preceding illustration, note that:</span></span>  
  
-   <span data-ttu-id="d8823-140">Между пакетами и сеансом существует связь типа "многие ко многим", которая означает, что объект может появляться в нескольких сеансах, а сеанс может содержать несколько объектов.</span><span class="sxs-lookup"><span data-stu-id="d8823-140">The mapping between package objects and sessions is many to many, which means that an object can appear in several sessions, and a session can contain several objects.</span></span>  
  
-   <span data-ttu-id="d8823-141">Одно и то же событие (событие 1) или одну и ту же цель (цель 1) можно включить в нескольких сеансах.</span><span class="sxs-lookup"><span data-stu-id="d8823-141">The same event (Event 1) or target (Target 1) can be enabled in more than one session.</span></span>  
  
 <span data-ttu-id="d8823-142">Сеансы имеют следующие характеристики.</span><span class="sxs-lookup"><span data-stu-id="d8823-142">Sessions have the following characteristics:</span></span>  
  
-   <span data-ttu-id="d8823-143">Действия и предикаты привязаны к событиям по сеансам.</span><span class="sxs-lookup"><span data-stu-id="d8823-143">Actions and predicates are bound to events on a per-session basis.</span></span> <span data-ttu-id="d8823-144">Если в сеансе A имеется событие 1 с действием 1 и предикатом Z, это никаким образом не затронет событие 1 в сеансе B с действиями 2 и 3 без предиката.</span><span class="sxs-lookup"><span data-stu-id="d8823-144">If you have Event 1 in Session A with Action 1 and Predicate Z, this will not in any way affect having Event 1 in Session B with Action 2 and Action 3 with no predicate.</span></span>  
  
-   <span data-ttu-id="d8823-145">Политики прикрепляются к сеансам для обработки буферизации и диспетчеризации, а также для отслеживания причинно-следственных связей.</span><span class="sxs-lookup"><span data-stu-id="d8823-145">Policies are attached to sessions to handle buffering and dispatch, and causality tracking.</span></span>  
  
 <span data-ttu-id="d8823-146">**Буферизация и диспетчеризация**</span><span class="sxs-lookup"><span data-stu-id="d8823-146">**Buffering and dispatch**</span></span>  
  
 <span data-ttu-id="d8823-147">Под буферизацией понимается способ хранения данных события при выполнении сеанса событий.</span><span class="sxs-lookup"><span data-stu-id="d8823-147">Buffering refers to how event data is stored while an event session is running.</span></span>  <span data-ttu-id="d8823-148">Политики буферизации задают объем памяти для данных события и метод обработки потерь для событий.</span><span class="sxs-lookup"><span data-stu-id="d8823-148">Buffering policies specify how much memory to use for event data, and the loss policy for the events.</span></span> <span data-ttu-id="d8823-149">Диспетчеризация определяет время хранения событий в буферах, прежде чем события будут передаваться целям для обработки.</span><span class="sxs-lookup"><span data-stu-id="d8823-149">Dispatch refers to the amount of time events will stay in buffers before being served to targets for processing.</span></span>  
  
 <span data-ttu-id="d8823-150">**Отслеживание причинно-следственных связей**</span><span class="sxs-lookup"><span data-stu-id="d8823-150">**Causality tracking**</span></span>  
  
 <span data-ttu-id="d8823-151">Отслеживание причинно-следственных связей помогает отслеживать действия в нескольких задачах.</span><span class="sxs-lookup"><span data-stu-id="d8823-151">Causality tracking provides the ability to track work across multiple tasks.</span></span> <span data-ttu-id="d8823-152">Если включено отслеживание причинно-следственных связей, каждое запущенное событие получает уникальный в системе идентификатор активности.</span><span class="sxs-lookup"><span data-stu-id="d8823-152">When causality tracking is enabled, each event fired has a unique activity ID across the system.</span></span> <span data-ttu-id="d8823-153">Идентификатор активности является сочетанием значения идентификатора GUID, который остается неизменным для всех операций в задаче, и порядкового номера, возрастающего при каждом запуске события.</span><span class="sxs-lookup"><span data-stu-id="d8823-153">The activity ID is a combination of a GUID value that remains constant across all events for a task, and a sequence number that is incremented each time an event is fired.</span></span> <span data-ttu-id="d8823-154">Если одна задача вызывает действия в другой задаче, родительский идентификатор активности сообщается дочерней задаче.</span><span class="sxs-lookup"><span data-stu-id="d8823-154">When one task causes work to be done on another, the activity ID of the parent is sent to the child task.</span></span> <span data-ttu-id="d8823-155">Дочерняя задача регистрирует родительский идентификатор активности при первом запуске события.</span><span class="sxs-lookup"><span data-stu-id="d8823-155">The child task outputs the parent's activity ID the first time it fires an event.</span></span>  
  
 <span data-ttu-id="d8823-156">Архитектура расширенных событий представляет собой гибкую систему, позволяющую совместно использовать разнообразные объекты для решения конкретных проблем.</span><span class="sxs-lookup"><span data-stu-id="d8823-156">The Extended Events architecture provides a flexible system that allows a variety of objects to be used together to solve specific problems.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d8823-157">См. также:</span><span class="sxs-lookup"><span data-stu-id="d8823-157">See Also</span></span>  
 [<span data-ttu-id="d8823-158">Расширенные события</span><span class="sxs-lookup"><span data-stu-id="d8823-158">Extended Events</span></span>](extended-events.md)  
  
  
