---
title: Диагностические записи и поля | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- header records [ODBC]
- SQL Server Native Client ODBC driver, errors
- messages [ODBC], diagnostic records
- ODBC error handling, diagnostic records
- SQLGetDiagField function
- diagnostic records [ODBC]
- errors [ODBC], diagnostic records
- fields [ODBC]
- status information [ODBC]
ms.assetid: 4949530c-62d1-4f1a-b592-144244444ce0
author: rothja
ms.author: jroth
ms.openlocfilehash: 4fe52b211eb6d5a0e4d875264609d036702b2b0b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87738330"
---
# <a name="diagnostic-records-and-fields"></a><span data-ttu-id="a4d75-102">Диагностические записи и поля</span><span class="sxs-lookup"><span data-stu-id="a4d75-102">Diagnostic Records and Fields</span></span>
  <span data-ttu-id="a4d75-103">Диагностические записи связаны со средой ODBC, соединением, инструкцией или указателями дескриптора.</span><span class="sxs-lookup"><span data-stu-id="a4d75-103">Diagnostic records are associated with ODBC environment, connection, statement, or descriptor handles.</span></span> <span data-ttu-id="a4d75-104">Когда любая функция ODBC возвращает код возврата, отличный от SQL_SUCCESS или SQL_INVALID_HANDLE, дескриптор, вызванный функцией, имеет связанные диагностические записи, содержащие информационные сообщения или сообщения об ошибке.</span><span class="sxs-lookup"><span data-stu-id="a4d75-104">When any ODBC function raises a return code other than SQL_SUCCESS or SQL_INVALID_HANDLE, the handle called by the function has associated diagnostic records that contain informational or error messages.</span></span> <span data-ttu-id="a4d75-105">Эти записи сохраняются до тех пор, пока с помощью данного дескриптора не будет вызвана другая функция, в этот момент записи отменяются.</span><span class="sxs-lookup"><span data-stu-id="a4d75-105">These records are retained until another function is called using that handle, at which time they are discarded.</span></span> <span data-ttu-id="a4d75-106">Не существует ограничения на количество диагностических записей, одновременно связанных с дескриптором.</span><span class="sxs-lookup"><span data-stu-id="a4d75-106">There is no limit to the number of diagnostic records that can be associated with a handle at any one time.</span></span>  
  
 <span data-ttu-id="a4d75-107">Существует два типа диагностических записей: заголовок и состояние.</span><span class="sxs-lookup"><span data-stu-id="a4d75-107">There are two types of diagnostic records: header and status.</span></span> <span data-ttu-id="a4d75-108">Заголовочная запись имеет номер 0; если есть записи состояния, то они имеют номера от 1 и далее.</span><span class="sxs-lookup"><span data-stu-id="a4d75-108">The header record is record 0; when there are status records, they are records 1 and later.</span></span> <span data-ttu-id="a4d75-109">Диагностические записи содержат различные поля для заголовочной записи и для записей состояния.</span><span class="sxs-lookup"><span data-stu-id="a4d75-109">Diagnostic records contain different fields for the header record and the status records.</span></span> <span data-ttu-id="a4d75-110">Компоненты ODBC могут также определять свои собственные поля диагностических записей.</span><span class="sxs-lookup"><span data-stu-id="a4d75-110">ODBC components can also define their own diagnostic record fields.</span></span>  
  
 <span data-ttu-id="a4d75-111">Поля в заголовочной записи содержат общие сведения о выполнении функции, включая код возврата, число строк, число записей состояния и тип выполняемой инструкции.</span><span class="sxs-lookup"><span data-stu-id="a4d75-111">Fields in the header record contain general information about a function's execution, including the return code, row count, number of status records, and type of statement executed.</span></span> <span data-ttu-id="a4d75-112">Заголовочная запись создается всегда, если только функция ODBC не возвращает SQL_INVALID_HANDLE.</span><span class="sxs-lookup"><span data-stu-id="a4d75-112">The header record is always created unless an ODBC function returns SQL_INVALID_HANDLE.</span></span> <span data-ttu-id="a4d75-113">Полный список полей в записи заголовка см. в разделе [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span><span class="sxs-lookup"><span data-stu-id="a4d75-113">For a complete list of fields in the header record, see [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span></span>  
  
 <span data-ttu-id="a4d75-114">Поля в записях состояния содержат сведения об конкретных ошибках и предупреждениях, возвращаемых диспетчером драйверов ODBC, драйвером или источником данных, включая значение SQLSTATE, номер собственной ошибки, диагностическое сообщение, номер столбца и номер строки.</span><span class="sxs-lookup"><span data-stu-id="a4d75-114">Fields in the status records contain information about specific errors or warnings returned by the ODBC Driver Manager, driver, or data source, including the SQLSTATE, native error number, diagnostic message, column number, and row number.</span></span> <span data-ttu-id="a4d75-115">Записи состояния создаются только в том случае, если функция возвращает SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA или SQL_STILL_EXECUTING.</span><span class="sxs-lookup"><span data-stu-id="a4d75-115">Status records are created only if the function returns SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA, or SQL_STILL_EXECUTING.</span></span> <span data-ttu-id="a4d75-116">Полный список полей в записях состояния см. в разделе **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="a4d75-116">For a complete list of fields in the status records, see **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="a4d75-117">**SQLGetDiagRec** извлекает одну диагностическую запись вместе с ее ODBC SQLSTATE, номером собственной ошибки и полями диагностического сообщения.</span><span class="sxs-lookup"><span data-stu-id="a4d75-117">**SQLGetDiagRec** retrieves a single diagnostic record along with its ODBC SQLSTATE, native error number, and diagnostic-message fields.</span></span> <span data-ttu-id="a4d75-118">Эта функция аналогична функции ODBC 2. Функция _x_**SqlError** .</span><span class="sxs-lookup"><span data-stu-id="a4d75-118">This functionality is similar to the ODBC 2._x_**SQLError** function.</span></span> <span data-ttu-id="a4d75-119">Простейшая функция обработки ошибок в ODBC 3. *x* — повторять вызов **SQLGetDiagRec** , начиная с параметра *рекнумбер* , для которого установлено значение 1, и увеличивать *рекнумбер* на 1 до тех пор, пока **SQLGetDiagRec** возвращает SQL_NO_DATA.</span><span class="sxs-lookup"><span data-stu-id="a4d75-119">The simplest error-handling function in ODBC 3.*x* is to repeatedly call **SQLGetDiagRec** starting with the *RecNumber* parameter set to 1 and incrementing *RecNumber* by 1 until **SQLGetDiagRec** returns SQL_NO_DATA.</span></span> <span data-ttu-id="a4d75-120">Это эквивалентно ODBC 2. Приложение *x* , вызывающее **SqlError** , пока не вернет SQL_NO_DATA_FOUND.</span><span class="sxs-lookup"><span data-stu-id="a4d75-120">This is equivalent to an ODBC 2.*x* application calling **SQLError** until it returns SQL_NO_DATA_FOUND.</span></span>  
  
 <span data-ttu-id="a4d75-121">ODBC 3. *x* поддерживает гораздо больше диагностических сведений, чем ODBC 2. *x*.</span><span class="sxs-lookup"><span data-stu-id="a4d75-121">ODBC 3.*x* supports much more diagnostic information than ODBC 2.*x*.</span></span> <span data-ttu-id="a4d75-122">Эти сведения хранятся в дополнительных полях в диагностических записях, полученных с помощью **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="a4d75-122">This information is stored in additional fields in diagnostic records retrieved by using **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="a4d75-123">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента содержит поля диагностики, относящиеся к драйверу, которые можно получить с помощью **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="a4d75-123">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver has driver-specific diagnostic fields that can be retrieved with **SQLGetDiagField**.</span></span> <span data-ttu-id="a4d75-124">Метки для этих специфических для драйвера полей определяются в файле sqlncli.h.</span><span class="sxs-lookup"><span data-stu-id="a4d75-124">Labels for these driver-specific fields are defined in sqlncli.h.</span></span> <span data-ttu-id="a4d75-125">С помощью этих меток можно получить состояние [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], степень серьезности, имя сервера, имя процедуры и номер строки, связанный с каждой диагностической записью.</span><span class="sxs-lookup"><span data-stu-id="a4d75-125">Use these labels to retrieve the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] state, severity level, server name, procedure name, and line number associated with each diagnostic record.</span></span> <span data-ttu-id="a4d75-126">Кроме того, sqlncli. h содержит определения кодов, которые драйвер использует для определения инструкций Transact-SQL, если приложение вызывает **SQLGetDiagField** с *диагидентифиер* , для которого задано значение SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span><span class="sxs-lookup"><span data-stu-id="a4d75-126">Also, sqlncli.h contains definitions of the codes the driver uses to identify Transact-SQL statements if an application calls **SQLGetDiagField** with *DiagIdentifier* set to SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span></span>  
  
 <span data-ttu-id="a4d75-127">**SQLGetDiagField** обрабатывается диспетчером драйверов ODBC с помощью сведений об ошибке, который кэшируется в базовом драйвере.</span><span class="sxs-lookup"><span data-stu-id="a4d75-127">**SQLGetDiagField** is processed by the ODBC Driver Manager using error information it caches from the underlying driver.</span></span> <span data-ttu-id="a4d75-128">Диспетчер драйверов ODBC не кэширует специфические для драйвера диагностические поля до того, как установлено успешное соединение.</span><span class="sxs-lookup"><span data-stu-id="a4d75-128">The ODBC Driver Manager does not cache driver-specific diagnostic fields until after a successful connection has been made.</span></span> <span data-ttu-id="a4d75-129">**SQLGetDiagField** возвращает SQL_ERROR, если он вызывается для получения диагностических полей, относящихся к драйверу, до завершения успешного подключения.</span><span class="sxs-lookup"><span data-stu-id="a4d75-129">**SQLGetDiagField** returns SQL_ERROR if it is called to get driver-specific diagnostic fields before a successful connection has been completed.</span></span> <span data-ttu-id="a4d75-130">Если функция соединения ODBC возвращает SQL_SUCCESS_WITH_INFO, то специфические для драйвера диагностические поля еще не доступны для функции соединения.</span><span class="sxs-lookup"><span data-stu-id="a4d75-130">If an ODBC connect function returns SQL_SUCCESS_WITH_INFO, the driver-specific diagnostic fields for the connect function are not yet available.</span></span> <span data-ttu-id="a4d75-131">Вы можете начать вызов **SQLGetDiagField** для полей диагностики, относящихся к драйверу, только после того, как вы сделали другой вызов функции ODBC после функции Connect.</span><span class="sxs-lookup"><span data-stu-id="a4d75-131">You can start calling **SQLGetDiagField** for driver-specific diagnostic fields only after you have made another ODBC function call after the connect function.</span></span>  
  
 <span data-ttu-id="a4d75-132">Большинство ошибок, о которых сообщает [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] драйвер ODBC для собственного клиента, можно эффективно диагностировать, используя только сведения, возвращенные **SQLGetDiagRec**.</span><span class="sxs-lookup"><span data-stu-id="a4d75-132">Most errors reported by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver can be effectively diagnosed using only the information returned by **SQLGetDiagRec**.</span></span> <span data-ttu-id="a4d75-133">Однако в некоторых случаях сведения, возвращаемые в специфических для драйвера диагностических полях, важны для диагностирования ошибки.</span><span class="sxs-lookup"><span data-stu-id="a4d75-133">In some cases, however, the information returned by the driver-specific diagnostic fields is important in diagnosing an error.</span></span> <span data-ttu-id="a4d75-134">При написании обработчика ошибок ODBC для приложений, использующих [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] драйвер ODBC для собственного клиента, рекомендуется также использовать **SQLGetDiagField** для получения по крайней мере SQL_DIAG_SS_MSGSTATE и SQL_DIAG_SS_SEVERITY полей, относящихся к драйверу.</span><span class="sxs-lookup"><span data-stu-id="a4d75-134">When coding an ODBC error handler for applications using the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver, it is a good idea to also use **SQLGetDiagField** to retrieve at least the SQL_DIAG_SS_MSGSTATE and SQL_DIAG_SS_SEVERITY driver-specific fields.</span></span> <span data-ttu-id="a4d75-135">Если какая-то ошибка может быть вызвана в нескольких местах кода [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], то SQL_DIAG_SS_MSGSTATE показывает сотруднику отдела службы технической поддержки корпорации Майкрософт, где именно ошибка была вызвана, и это может иногда помочь при диагностике проблемы.</span><span class="sxs-lookup"><span data-stu-id="a4d75-135">If a particular error can be raised at several locations in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] code, SQL_DIAG_SS_MSGSTATE indicates to a Microsoft support engineer specifically where an error was raised, which sometimes aids in diagnosing a problem.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a4d75-136">См. также:</span><span class="sxs-lookup"><span data-stu-id="a4d75-136">See Also</span></span>  
 [<span data-ttu-id="a4d75-137">Обработка ошибок и сообщений</span><span class="sxs-lookup"><span data-stu-id="a4d75-137">Handling Errors and Messages</span></span>](handling-errors-and-messages.md)  
  
  
