---
title: Управление размером файла журнала транзакций | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- transaction logs [SQL Server], size management
ms.assetid: 3a70e606-303f-47a8-96d4-2456a18d4297
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 219ba0605d60bab0b13675f7f9f7ff01cace5755
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87658249"
---
# <a name="manage-the-size-of-the-transaction-log-file"></a><span data-ttu-id="593ac-102">Управление размером файла журнала транзакций</span><span class="sxs-lookup"><span data-stu-id="593ac-102">Manage the Size of the Transaction Log File</span></span>
  <span data-ttu-id="593ac-103">В некоторых случаях может оказаться полезным физическое сжатие или расширение размера реального файла журнала или журнала транзакции базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="593ac-103">In some cases, it can be useful to physically shrink or expand the physical log file of the transaction log of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database.</span></span> <span data-ttu-id="593ac-104">В данном разделе содержатся сведения о мониторинге размера журнала транзакций [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , сжатии журнала транзакций, добавлении или увеличении файла журнала транзакций, оптимизации скорости роста журнала транзакций **tempdb** , а также об управлении размером файла журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="593ac-104">This topic contains information about how to monitor the size of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction log, shrink the transaction log, add or enlarge a transaction log file, optimize the **tempdb** transaction log growth rate, and control the growth of a transaction log file.</span></span>  
  
  
##  <a name="monitor-log-space-use"></a><a name="MonitorSpaceUse"></a><span data-ttu-id="593ac-105">Мониторинг использования пространства журнала</span><span class="sxs-lookup"><span data-stu-id="593ac-105">Monitor Log Space Use</span></span>  
 <span data-ttu-id="593ac-106">Контролировать используемое пространство журнала можно с помощью процедуры DBCC SQLPERF (LOGSPACE).</span><span class="sxs-lookup"><span data-stu-id="593ac-106">You can monitor log space use by using DBCC SQLPERF (LOGSPACE).</span></span> <span data-ttu-id="593ac-107">Она возвращает сведения об объеме пространства, используемого журналом в данный момент, и указывает, если необходимо провести усечение журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="593ac-107">This command returns information about the amount of log space currently used and indicates when the transaction log is in need of truncation.</span></span> <span data-ttu-id="593ac-108">Дополнительные сведения см. в разделе [DBCC SQLPERF (Transact-SQL)](/sql/t-sql/database-console-commands/dbcc-sqlperf-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="593ac-108">For more information, see [DBCC SQLPERF &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-sqlperf-transact-sql).</span></span> <span data-ttu-id="593ac-109">Для получения сведений о текущем размере файла журнала, его максимальном размере и параметре автоматического увеличения файла вы можете также использовать столбцы **size**, **max_size** и **growth** для данного файла журнала в представлении **sys.database_files**.</span><span class="sxs-lookup"><span data-stu-id="593ac-109">For information about the current size of a log file, its maximum size, and the autogrow option for the file, you can also use the **size**, **max_size**, and **growth** columns for that log file in **sys.database_files**.</span></span> <span data-ttu-id="593ac-110">Дополнительные сведения см. в разделе [sys.database_files (Transact-SQL)](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="593ac-110">For more information, see [sys.database_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="593ac-111">Рекомендуется избегать переполнения диска, содержащего журналы.</span><span class="sxs-lookup"><span data-stu-id="593ac-111">We recommend that you avoid overloading the log disk.</span></span>  
  
  
##  <a name="shrink-the-size-of-the-log-file"></a><a name="ShrinkSize"></a><span data-ttu-id="593ac-112">Уменьшение размера файла журнала</span><span class="sxs-lookup"><span data-stu-id="593ac-112">Shrink the Size of the Log File</span></span>  
 <span data-ttu-id="593ac-113">Для уменьшения реального размера физического файла журнала необходимо выполнить его сжатие.</span><span class="sxs-lookup"><span data-stu-id="593ac-113">To reduce the physical size of a physical log file, you must shrink the log file.</span></span> <span data-ttu-id="593ac-114">Это полезно, если файл журнала транзакций содержит ненужное неиспользованное пространство.</span><span class="sxs-lookup"><span data-stu-id="593ac-114">This is useful if you know that a transaction log file contains unused space that you will not be needing.</span></span> <span data-ttu-id="593ac-115">Сжатие файла журнала может производиться только в том случае, если база данных находится в режиме «в сети» и пока свободен хотя бы один виртуальный файл журнала.</span><span class="sxs-lookup"><span data-stu-id="593ac-115">Shrinking a log file can occur only while the database is online and, also, at least one virtual log file is free.</span></span> <span data-ttu-id="593ac-116">В ряде случаев сжатие невозможно до тех пор, пока не выполнена следующая операция усечения журнала.</span><span class="sxs-lookup"><span data-stu-id="593ac-116">In some cases, shrinking the log may not be possible until after the next log truncation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="593ac-117">Такие факторы, как долго выполняемые транзакции, удерживающие файлы журналов в активном состоянии в течение продолжительного периода времени, могут ограничить или вовсе не допустить возможность сжатия журнала.</span><span class="sxs-lookup"><span data-stu-id="593ac-117">Factors, such as a long-running transaction, that keep virtual log files active for an extended period can restrict log shrinkage or even prevent the log from shrinking at all.</span></span> <span data-ttu-id="593ac-118">Дополнительные сведения о факторах, из-за которых усечение журнала может откладываться, см. в разделе [Журнал транзакций (SQL Server)](the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="593ac-118">For information about factors that can delay log truncation, see [The Transaction Log &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="593ac-119">Процесс сжатия файла журнала удаляет один или несколько виртуальных файлов журнала, которые не содержат частей логического журнала ( *неактивные виртуальные файлы журнала*).</span><span class="sxs-lookup"><span data-stu-id="593ac-119">Shrinking a log file removes one or more virtual log files that do not hold any part of the logical log (that is, *inactive virtual log files*).</span></span> <span data-ttu-id="593ac-120">При сжатии файла журнала транзакций в конце файла журнала удаляется достаточное количество неактивных виртуальных файлов журнала, чтобы журнал уменьшился до приблизительного целевого размера.</span><span class="sxs-lookup"><span data-stu-id="593ac-120">When a transaction log file is shrunk, enough inactive virtual log files are removed from the end of the log file to reduce the log to approximately the target size.</span></span>  
  
 <span data-ttu-id="593ac-121">**Сжатие файла журнала (без сжатия файлов базы данных)**</span><span class="sxs-lookup"><span data-stu-id="593ac-121">**To shrink a log file (without shrinking database files)**</span></span>  
  
-   [<span data-ttu-id="593ac-122">DBCC SHRINKFILE (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="593ac-122">DBCC SHRINKFILE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-shrinkfile-transact-sql)  
  
-   [<span data-ttu-id="593ac-123">Сжатие файла</span><span class="sxs-lookup"><span data-stu-id="593ac-123">Shrink a File</span></span>](../databases/shrink-a-file.md)  
  
 <span data-ttu-id="593ac-124">**Мониторинг событий сжатия файла журнала**</span><span class="sxs-lookup"><span data-stu-id="593ac-124">**To monitor log-file shrink events**</span></span>  
  
-   <span data-ttu-id="593ac-125">[Log File Auto Shrink Event Class](../event-classes/log-file-auto-shrink-event-class.md).</span><span class="sxs-lookup"><span data-stu-id="593ac-125">[Log File Auto Shrink Event Class](../event-classes/log-file-auto-shrink-event-class.md).</span></span>  
  
 `To monitor log space`  
  
-   [<span data-ttu-id="593ac-126">DBCC SQLPERF (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="593ac-126">DBCC SQLPERF &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-sqlperf-transact-sql)  
  
-   <span data-ttu-id="593ac-127">[sys.database_files (Transact-SQL)](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql) (См. столбцы **size**, **max_size** и **growth** файла или файлов журнала.)</span><span class="sxs-lookup"><span data-stu-id="593ac-127">[sys.database_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql) (See the **size**, **max_size**, and **growth** columns for the log file or files.)</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="593ac-128">Можно задать автоматическое выполнение сжатия файлов базы данных и журнала.</span><span class="sxs-lookup"><span data-stu-id="593ac-128">Shrinking database and log files can be set to occur automatically.</span></span> <span data-ttu-id="593ac-129">Однако автоматическое сжатие не рекомендуется, поэтому свойство `autoshrink` базы данных по умолчанию имеет значение FALSE.</span><span class="sxs-lookup"><span data-stu-id="593ac-129">However, we recommend against automatic shrinking, and the `autoshrink` database property is set to FALSE by default.</span></span> <span data-ttu-id="593ac-130">Если свойство `autoshrink` имеет значение TRUE, то автоматическое сжатие уменьшит размер файла только в том случае, если неиспользуемое пространство занимает более 25 % от общего объема.</span><span class="sxs-lookup"><span data-stu-id="593ac-130">If `autoshrink` is set to TRUE, automatic shrinking reduces the size of a file only when more than 25 percent of its space is unused.</span></span> <span data-ttu-id="593ac-131">Файл будет сжат либо до размера, в котором 25 % пространства не используется, либо до исходного размера, каким бы большим он ни был.</span><span class="sxs-lookup"><span data-stu-id="593ac-131">The file is shrunk either to the size at which only 25 percent of the file is unused space or to the original size of the file, whichever is larger.</span></span> <span data-ttu-id="593ac-132">Сведения об изменении значения `autoshrink` свойства см. в разделе [Просмотр или изменение свойств базы данных](../databases/view-or-change-the-properties-of-a-database.md)— используйте свойство **Автоматическое сжатие** на странице **параметры** или [параметры ALTER DATABASE SET &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options)— используйте параметр AUTO_SHRINK.</span><span class="sxs-lookup"><span data-stu-id="593ac-132">For information about changing the setting of the `autoshrink` property, see [View or Change the Properties of a Database](../databases/view-or-change-the-properties-of-a-database.md)-use the **Auto Shrink** property on the **Options** page-or [ALTER DATABASE SET Options &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options)-use the AUTO_SHRINK option.</span></span>  
  
  
##  <a name="add-or-enlarge-a-log-file"></a><a name="AddOrEnlarge"></a><span data-ttu-id="593ac-133">Добавление или увеличение файла журнала</span><span class="sxs-lookup"><span data-stu-id="593ac-133">Add or Enlarge a Log File</span></span>  
 <span data-ttu-id="593ac-134">Кроме того, можно выделить дополнительное место на диске путем увеличения существующего файла журнала (если для этого достаточно места на диске) либо путем добавления файла журнала в базу данных, как правило, на другом диске.</span><span class="sxs-lookup"><span data-stu-id="593ac-134">Alternatively, you can gain space by enlarging the existing log file (if disk space permits) or by adding a log file to the database, typically on a different disk.</span></span>  
  
-   <span data-ttu-id="593ac-135">Файл журнала добавляется в базу данных с помощью предложения ADD LOG FILE инструкции ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="593ac-135">To add a log file to the database, use the ADD LOG FILE clause of the ALTER DATABASE statement.</span></span> <span data-ttu-id="593ac-136">Это позволяет увеличить размер файла.</span><span class="sxs-lookup"><span data-stu-id="593ac-136">Adding a log file allows the log to grow.</span></span>  
  
-   <span data-ttu-id="593ac-137">Файл журнала можно увеличить с помощью предложения MODIFY FILE инструкции ALTER DATABASE. При этом следует указать синтаксис SIZE и MAXSIZE.</span><span class="sxs-lookup"><span data-stu-id="593ac-137">To enlarge the log file, use the MODIFY FILE clause of the ALTER DATABASE statement, specifying the SIZE and MAXSIZE syntax.</span></span> <span data-ttu-id="593ac-138">Дополнительные сведения см. в разделе [ALTER DATABASE (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="593ac-138">For more information, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
  
##  <a name="optimize-the-size-of-the-tempdb-transaction-log"></a><a name="tempdbOptimize"></a><span data-ttu-id="593ac-139">Оптимизация размера журнала транзакций базы данных tempdb</span><span class="sxs-lookup"><span data-stu-id="593ac-139">Optimize the Size of the tempdb Transaction Log</span></span>  
 <span data-ttu-id="593ac-140">При перезапуске экземпляра сервера размер журнала транзакций базы данных **tempdb** изменяется и становится равным исходному размеру, который был до применения параметра автоматического увеличения файла.</span><span class="sxs-lookup"><span data-stu-id="593ac-140">Restarting a server instance resizes the transaction log of the **tempdb** database to its original, pre-autogrow size.</span></span> <span data-ttu-id="593ac-141">Это может понизить производительность журнала транзакций базы данных **tempdb** .</span><span class="sxs-lookup"><span data-stu-id="593ac-141">This can reduce the performance of the **tempdb** transaction log.</span></span> <span data-ttu-id="593ac-142">Этого можно избежать с помощью увеличения размера журнала транзакций базы данных **tempdb** после запуска или перезапуска экземпляра сервера.</span><span class="sxs-lookup"><span data-stu-id="593ac-142">You can avoid this overhead by increasing the size of the **tempdb** transaction log after starting or restarting the server instance.</span></span> <span data-ttu-id="593ac-143">Дополнительные сведения см. в статье [tempdb Database](../databases/tempdb-database.md).</span><span class="sxs-lookup"><span data-stu-id="593ac-143">For more information, see [tempdb Database](../databases/tempdb-database.md).</span></span>  
  
  
##  <a name="control-the-growth-of-a-transaction-log-file"></a><a name="ControlGrowth"></a><span data-ttu-id="593ac-144">Управление ростом файла журнала транзакций</span><span class="sxs-lookup"><span data-stu-id="593ac-144">Control the Growth of a Transaction Log File</span></span>  
 <span data-ttu-id="593ac-145">Для управления размером файла журнала транзакций вы можете использовать инструкцию [ALTER DATABASE (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="593ac-145">You can use the [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) statement to manage the growth of a transaction log file.</span></span> <span data-ttu-id="593ac-146">Следует отметить следующее.</span><span class="sxs-lookup"><span data-stu-id="593ac-146">Note the following:</span></span>  
  
-   <span data-ttu-id="593ac-147">Чтобы изменить текущий размер файла в КБ, МБ, ГБ и ТБ, используйте параметр «SIZE».</span><span class="sxs-lookup"><span data-stu-id="593ac-147">To change the current file size in KB, MB, GB, and TB units, use the SIZE option.</span></span>  
  
-   <span data-ttu-id="593ac-148">Чтобы изменить шаг приращения размера, используйте параметр FILEGROWTH.</span><span class="sxs-lookup"><span data-stu-id="593ac-148">To change the growth increment, use the FILEGROWTH option.</span></span> <span data-ttu-id="593ac-149">Значение 0 указывает, что автоматическое приращение выключено и дополнительное пространство для файла не разрешено.</span><span class="sxs-lookup"><span data-stu-id="593ac-149">A value of 0 indicates that automatic growth is set to off and no additional space is permitted.</span></span> <span data-ttu-id="593ac-150">Небольшое значение параметра автоувеличения прироста размера файла журнала может снизить производительность системы.</span><span class="sxs-lookup"><span data-stu-id="593ac-150">A small autogrowth increment on a log file can reduce performance.</span></span> <span data-ttu-id="593ac-151">Во избежание слишком частых увеличений размера файла журнала следует задать достаточно большое значение шагу роста файла журнала.</span><span class="sxs-lookup"><span data-stu-id="593ac-151">The file growth increment on a log file should be sufficiently large to avoid frequent expansion.</span></span> <span data-ttu-id="593ac-152">Как правило, достаточно установить значение увеличения шага роста равным 10 %.</span><span class="sxs-lookup"><span data-stu-id="593ac-152">The default growth increment of 10 percent is generally suitable.</span></span>  
  
     <span data-ttu-id="593ac-153">Сведения об изменении свойства роста файла журнала см. в разделе [ALTER database &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="593ac-153">For information on changing the file-growth property on a log file, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
-   <span data-ttu-id="593ac-154">Чтобы установить максимальный размер файла журнала в КБ, МБ, ГБ и ТБ или задать неограниченный размер, используйте параметр MAXSIZE.</span><span class="sxs-lookup"><span data-stu-id="593ac-154">To control the maximum the size of a log file in KB, MB, GB, and TB units or to set growth to UNLIMITED, use the MAXSIZE option.</span></span>  
  
  
## <a name="see-also"></a><span data-ttu-id="593ac-155">См. также:</span><span class="sxs-lookup"><span data-stu-id="593ac-155">See Also</span></span>  
 <span data-ttu-id="593ac-156">[BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="593ac-156">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 [<span data-ttu-id="593ac-157">Устранение неполадок при переполнении журнала транзакций (ошибка SQL Server 9002)</span><span class="sxs-lookup"><span data-stu-id="593ac-157">Troubleshoot a Full Transaction Log &#40;SQL Server Error 9002&#41;</span></span>](troubleshoot-a-full-transaction-log-sql-server-error-9002.md)  
  
  
