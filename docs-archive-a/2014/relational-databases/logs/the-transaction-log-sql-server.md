---
title: Журнал транзакций (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 01/04/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- transaction logs [SQL Server], about
- databases [SQL Server], transaction logs
- logs [SQL Server], transaction logs
ms.assetid: d7be5ac5-4c8e-4d0a-b114-939eb97dac4d
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 025ef22e6dee1fcfaa1225a4709fa01b6c326b12
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87658246"
---
# <a name="the-transaction-log-sql-server"></a><span data-ttu-id="13200-102">Журнал транзакций (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="13200-102">The Transaction Log (SQL Server)</span></span>
  <span data-ttu-id="13200-103">Каждая база данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] имеет журнал транзакций, в котором фиксируются все транзакции и производимые ими в базе изменения.</span><span class="sxs-lookup"><span data-stu-id="13200-103">Every [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database has a transaction log that records all transactions and the database modifications made by each transaction.</span></span> <span data-ttu-id="13200-104">Журнал транзакций необходимо регулярно усекать, чтобы избежать его переполнения.</span><span class="sxs-lookup"><span data-stu-id="13200-104">The transaction log must be truncated on a regular basis to keep it from filling up.</span></span> <span data-ttu-id="13200-105">Но при этом по ряду причин его усечение может быть отложено, поэтому очень важно следить за размером журнала.</span><span class="sxs-lookup"><span data-stu-id="13200-105">However, some factors can delay log truncation, so monitoring log size is important.</span></span> <span data-ttu-id="13200-106">Некоторые операции можно выполнять с минимальным протоколированием, чтобы сократить их вклад в размер журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="13200-106">Some operations can be minimally logged to reduce their impact on transaction log size.</span></span>  
  
 <span data-ttu-id="13200-107">Журнал транзакций является критическим компонентом базы данных и в случае системного сбоя может потребоваться для приведения базы данных в согласованное состояние.</span><span class="sxs-lookup"><span data-stu-id="13200-107">The transaction log is a critical component of the database and, if there is a system failure, the transaction log might be required to bring your database back to a consistent state.</span></span> <span data-ttu-id="13200-108">Журнал транзакций нельзя ни удалять, ни изменять, если только не известны возможные последствия.</span><span class="sxs-lookup"><span data-stu-id="13200-108">The transaction log should never be deleted or moved unless you fully understand the ramifications of doing this.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="13200-109">Известные рабочие точки, от которых следует начинать применение журналов транзакций при восстановлении базы данных, создаются контрольными точками.</span><span class="sxs-lookup"><span data-stu-id="13200-109">Known good points from which to begin applying transaction logs during database recovery are created by checkpoints.</span></span> <span data-ttu-id="13200-110">Дополнительные сведения см. в разделе [Контрольные точки базы данных (SQL Server)](database-checkpoints-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="13200-110">For more information, see [Database Checkpoints &#40;SQL Server&#41;](database-checkpoints-sql-server.md).</span></span>  
  
 <span data-ttu-id="13200-111">**В этом разделе.**</span><span class="sxs-lookup"><span data-stu-id="13200-111">**In this Topic:**</span></span>  
  
-   [<span data-ttu-id="13200-112">Преимущества: операции, поддерживаемые журналом транзакций</span><span class="sxs-lookup"><span data-stu-id="13200-112">Benefits: Operations Supported by the Transaction Log</span></span>](#Benefits)  
  
-   [<span data-ttu-id="13200-113">Усечение журнала транзакций</span><span class="sxs-lookup"><span data-stu-id="13200-113">Transaction Log Truncation</span></span>](#Truncation)  
  
-   [<span data-ttu-id="13200-114">Факторы, которые могут вызвать задержку усечения журнала</span><span class="sxs-lookup"><span data-stu-id="13200-114">Factors That Can Delay Log Truncation</span></span>](#FactorsThatDelayTruncation)  
  
-   [<span data-ttu-id="13200-115">Операции, которые могут быть минимально записаны в журнал</span><span class="sxs-lookup"><span data-stu-id="13200-115">Operations That Can Be Minimally Logged</span></span>](#MinimallyLogged)  
  
-   [<span data-ttu-id="13200-116">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="13200-116">Related Tasks</span></span>](#RelatedTasks)  
  
##  <a name="benefits-operations-supported-by-the-transaction-log"></a><a name="Benefits"></a><span data-ttu-id="13200-117">Преимущества: операции, поддерживаемые журналом транзакций</span><span class="sxs-lookup"><span data-stu-id="13200-117">Benefits: Operations Supported by the Transaction Log</span></span>  
 <span data-ttu-id="13200-118">Журнал транзакций поддерживает следующие операции:</span><span class="sxs-lookup"><span data-stu-id="13200-118">The transaction log supports the following operations:</span></span>  
  
-   <span data-ttu-id="13200-119">восстановление отдельных транзакций;</span><span class="sxs-lookup"><span data-stu-id="13200-119">Recovery of individual transactions.</span></span>  
  
-   <span data-ttu-id="13200-120">восстановление всех незавершенных транзакций при запуске [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ;</span><span class="sxs-lookup"><span data-stu-id="13200-120">Recovery of all incomplete transactions when [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is started.</span></span>  
  
-   <span data-ttu-id="13200-121">накат восстановленной базы данных, файла, файловой группы или страницы до момента сбоя;</span><span class="sxs-lookup"><span data-stu-id="13200-121">Rolling a restored database, file, filegroup, or page forward to the point of failure.</span></span>  
  
-   <span data-ttu-id="13200-122">поддержка репликации транзакций;</span><span class="sxs-lookup"><span data-stu-id="13200-122">Supporting transactional replication.</span></span>  
  
-   <span data-ttu-id="13200-123">Поддержка решений высокой уровня доступности и аварийного восстановления: [!INCLUDE[ssHADR](../../includes/sshadr-md.md)], зеркальное отображение базы данных и доставка журналов.</span><span class="sxs-lookup"><span data-stu-id="13200-123">Supporting high availability and disaster recovery solutions: [!INCLUDE[ssHADR](../../includes/sshadr-md.md)], database mirroring, and log shipping.</span></span>  
  
##  <a name="transaction-log-truncation"></a><a name="Truncation"></a> <span data-ttu-id="13200-124">Усечение журнала транзакций</span><span class="sxs-lookup"><span data-stu-id="13200-124">Transaction Log Truncation</span></span>  
 <span data-ttu-id="13200-125">Процесс усечения журнала освобождает место в файле журнала для повторного использования журналом транзакций.</span><span class="sxs-lookup"><span data-stu-id="13200-125">Log truncation frees space in the log file for reuse by the transaction log.</span></span> <span data-ttu-id="13200-126">Усечение журнала необходимо для предотвращения переполнения журнала.</span><span class="sxs-lookup"><span data-stu-id="13200-126">Log truncation is essential to keep the log from filling.</span></span> <span data-ttu-id="13200-127">При усечении журнала удаляются неактивные виртуальные файлы журнала из логического журнала транзакций базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , что приводит к освобождению пространства в логическом журнале для повторного использования физическим журналом транзакций.</span><span class="sxs-lookup"><span data-stu-id="13200-127">Log truncation deletes inactive virtual log files from the logical transaction log of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database, freeing space in the logical log for reuse by the Physical transaction log.</span></span> <span data-ttu-id="13200-128">Если усечение журнала транзакций не выполняется, со временем он заполняет все доступное место на диске, отведенное для файлов физического журнала.</span><span class="sxs-lookup"><span data-stu-id="13200-128">If a transaction log were never truncated, it would eventually fill all the disk space that is allocated to its physical log files.</span></span>  
  
 <span data-ttu-id="13200-129">В целях предотвращения этой проблемы усечение журнала выполняется автоматически после следующих событий, за исключением тех случаев, когда оно по каким-то причинам задерживается.</span><span class="sxs-lookup"><span data-stu-id="13200-129">To avoid this problem, unless log truncation is being delayed for some reason, truncation occurs automatically after the following events:</span></span>  
  
-   <span data-ttu-id="13200-130">В простой модели восстановления — после достижения контрольной точки.</span><span class="sxs-lookup"><span data-stu-id="13200-130">Under the simple recovery model, after a checkpoint.</span></span>  
  
-   <span data-ttu-id="13200-131">Для моделей полного восстановления и моделей восстановления с неполным протоколированием, если контрольная точка была создана после предыдущего резервного копирования, усечение происходит после резервного копирования журнала (если только это не резервная копия журнала только для копирования).</span><span class="sxs-lookup"><span data-stu-id="13200-131">Under the full recovery model or bulk-logged recovery model, if a checkpoint has occurred since the previous backup, truncation occurs after a log backup (unless it is a copy-only log backup).</span></span>  
  
 <span data-ttu-id="13200-132">Дополнительные сведения см. в подразделе [факторы, которые могут вызвать задержку усечения журнала](#FactorsThatDelayTruncation)далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="13200-132">For more information, see [Factors That Can Delay Log Truncation](#FactorsThatDelayTruncation), later in this topic.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="13200-133">Усечение журнала не приводит к уменьшению размера физического файла журнала.</span><span class="sxs-lookup"><span data-stu-id="13200-133">Log truncation does not reduce the size of the physical log file.</span></span> <span data-ttu-id="13200-134">Для уменьшения реального размера физического файла журнала необходимо выполнить его сжатие.</span><span class="sxs-lookup"><span data-stu-id="13200-134">To reduce the physical size of a physical log file, you need to shrink the log file.</span></span> <span data-ttu-id="13200-135">Сведения о сжатии физического файла журнала см. в разделе [Управление размером файла журнала транзакций](manage-the-size-of-the-transaction-log-file.md).</span><span class="sxs-lookup"><span data-stu-id="13200-135">For information about shrinking the size of the physical log file, see [Manage the Size of the Transaction Log File](manage-the-size-of-the-transaction-log-file.md).</span></span>  
  
##  <a name="factors-that-can-delay-log-truncation"></a><a name="FactorsThatDelayTruncation"></a><span data-ttu-id="13200-136">Факторы, которые могут вызвать задержку усечения журнала</span><span class="sxs-lookup"><span data-stu-id="13200-136">Factors That Can Delay Log Truncation</span></span>  
 <span data-ttu-id="13200-137">Когда записи журнала остаются активными длительное время, усечение журнала транзакций откладывается и возникает вероятность переполнения журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="13200-137">When log records remain active for a long time transaction log truncation is delayed, and potentially the transaction log can fill up.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="13200-138">Дополнительные сведения о том, что нужно делать при переполнении журнала транзакций, см. в разделе [Troubleshoot a Full Transaction Log &#40;SQL Server Error 9002&#41;](troubleshoot-a-full-transaction-log-sql-server-error-9002.md).</span><span class="sxs-lookup"><span data-stu-id="13200-138">For information about how to respond to a full transaction log, see [Troubleshoot a Full Transaction Log &#40;SQL Server Error 9002&#41;](troubleshoot-a-full-transaction-log-sql-server-error-9002.md).</span></span>  
  
 <span data-ttu-id="13200-139">Усечение журнала может быть задержано из-за множества факторов.</span><span class="sxs-lookup"><span data-stu-id="13200-139">Log truncation can be delayed by a variety of factors.</span></span> <span data-ttu-id="13200-140">Чтобы определить причину, препятствующую усечению журнала транзакций в конкретном случае, выполните запрос по столбцам **log_reuse_wait** и **log_reuse_wait_desc** представления каталога [sys.database](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="13200-140">You can discover what, if anything, is preventing log truncation by querying the **log_reuse_wait** and **log_reuse_wait_desc** columns of the [sys.databases](/sql/relational-databases/system-catalog-views/sys-databases-transact-sql) catalog view.</span></span> <span data-ttu-id="13200-141">В следующей таблице описаны значения этих столбцов.</span><span class="sxs-lookup"><span data-stu-id="13200-141">The following table describes the values of these columns.</span></span>  
  
|<span data-ttu-id="13200-142">Значение столбца log_reuse_wait</span><span class="sxs-lookup"><span data-stu-id="13200-142">log_reuse_wait value</span></span>|<span data-ttu-id="13200-143">Значение столбца log_reuse_wait_desc</span><span class="sxs-lookup"><span data-stu-id="13200-143">log_reuse_wait_desc value</span></span>|<span data-ttu-id="13200-144">Описание</span><span class="sxs-lookup"><span data-stu-id="13200-144">Description</span></span>|  
|----------------------------|----------------------------------|-----------------|  
|<span data-ttu-id="13200-145">0</span><span class="sxs-lookup"><span data-stu-id="13200-145">0</span></span>|<span data-ttu-id="13200-146">NOTHING;</span><span class="sxs-lookup"><span data-stu-id="13200-146">NOTHING</span></span>|<span data-ttu-id="13200-147">В данный момент существует один или более виртуальных файлов журнала, доступных для повторного использования.</span><span class="sxs-lookup"><span data-stu-id="13200-147">Currently there are one or more reusable virtual log files.</span></span>|  
|<span data-ttu-id="13200-148">1</span><span class="sxs-lookup"><span data-stu-id="13200-148">1</span></span>|<span data-ttu-id="13200-149">CHECKPOINT</span><span class="sxs-lookup"><span data-stu-id="13200-149">CHECKPOINT</span></span>|<span data-ttu-id="13200-150">С момента последнего усечения журнала не было новых контрольных точек, либо заголовок журнала не перемещался за пределы виртуального файла журнала.</span><span class="sxs-lookup"><span data-stu-id="13200-150">No checkpoint has occurred since the last log truncation, or the head of the log has not yet moved beyond a virtual log file.</span></span> <span data-ttu-id="13200-151">(Все модели восстановления)</span><span class="sxs-lookup"><span data-stu-id="13200-151">(All recovery models)</span></span><br /><br /> <span data-ttu-id="13200-152">Это широко распространенная причина задержки усечения журнала.</span><span class="sxs-lookup"><span data-stu-id="13200-152">This is a routine reason for delaying log truncation.</span></span> <span data-ttu-id="13200-153">Дополнительные сведения см. в разделе [Контрольные точки базы данных (SQL Server)](database-checkpoints-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="13200-153">For more information, see [Database Checkpoints &#40;SQL Server&#41;](database-checkpoints-sql-server.md).</span></span>|  
|<span data-ttu-id="13200-154">2</span><span class="sxs-lookup"><span data-stu-id="13200-154">2</span></span>|<span data-ttu-id="13200-155">LOG_BACKUP</span><span class="sxs-lookup"><span data-stu-id="13200-155">LOG_BACKUP</span></span>|<span data-ttu-id="13200-156">Требуется выполнить резервное копирование журналов, поскольку лишь после этого журнал транзакций может быть усечен.</span><span class="sxs-lookup"><span data-stu-id="13200-156">A log backup is required before the transaction log can be truncated.</span></span> <span data-ttu-id="13200-157">(Только для моделей полного восстановления и моделей восстановления с неполным протоколированием)</span><span class="sxs-lookup"><span data-stu-id="13200-157">(Full or bulk-logged recovery models only)</span></span><br /><br /> <span data-ttu-id="13200-158">После завершения создания следующей резервной копии журнала некоторое пространство журнала может освободиться для повторного использования.</span><span class="sxs-lookup"><span data-stu-id="13200-158">When the next log backup is completed, some log space might become reusable.</span></span>|  
|<span data-ttu-id="13200-159">3</span><span class="sxs-lookup"><span data-stu-id="13200-159">3</span></span>|<span data-ttu-id="13200-160">ACTIVE_BACKUP_OR_RESTORE</span><span class="sxs-lookup"><span data-stu-id="13200-160">ACTIVE_BACKUP_OR_RESTORE</span></span>|<span data-ttu-id="13200-161">Выполняется резервное копирование или восстановление данных (для всех моделей восстановления).</span><span class="sxs-lookup"><span data-stu-id="13200-161">A data backup or a restore is in progress (all recovery models).</span></span><br /><br /> <span data-ttu-id="13200-162">Если усечению журнала препятствует резервное копирование данных, то проблему может решить отмена операции резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="13200-162">If a data backup is preventing log truncation, canceling the backup operation might help the immediate problem.</span></span>|  
|<span data-ttu-id="13200-163">4</span><span class="sxs-lookup"><span data-stu-id="13200-163">4</span></span>|<span data-ttu-id="13200-164">ACTIVE_TRANSACTION</span><span class="sxs-lookup"><span data-stu-id="13200-164">ACTIVE_TRANSACTION</span></span>|<span data-ttu-id="13200-165">Активна одна из транзакций (для всех моделей восстановления).</span><span class="sxs-lookup"><span data-stu-id="13200-165">A transaction is active (all recovery models).</span></span><br /><br /> <span data-ttu-id="13200-166">Во время начала создания резервной копии журнала может существовать длительная транзакция.</span><span class="sxs-lookup"><span data-stu-id="13200-166">A long-running transaction might exist at the start of the log backup.</span></span> <span data-ttu-id="13200-167">В этом случае, чтобы освободить пространство, может потребоваться создание другой резервной копии журнала.</span><span class="sxs-lookup"><span data-stu-id="13200-167">In this case, freeing the space might require another log backup.</span></span> <span data-ttu-id="13200-168">Обратите внимание, что длительные транзакции препятствуют усечению журнала во всех моделях восстановления, включая простую модель восстановления, при которой журнал транзакций обычно усекается на каждой автоматической контрольной точке.</span><span class="sxs-lookup"><span data-stu-id="13200-168">Note that a long-running transactions prevent log truncation under all recovery models, including the simple recovery model, under which the transaction log is generally truncated on each automatic checkpoint.</span></span><br /><br /> <span data-ttu-id="13200-169">Транзакция отложена.</span><span class="sxs-lookup"><span data-stu-id="13200-169">A transaction is deferred.</span></span> <span data-ttu-id="13200-170">*Отложенная транзакция* — это активная транзакция, откат которой был заблокирован по причине недоступности какого-либо ресурса.</span><span class="sxs-lookup"><span data-stu-id="13200-170">A *deferred transaction* is effectively an active transaction whose rollback is blocked because of some unavailable resource.</span></span> <span data-ttu-id="13200-171">Дополнительные сведения о причинах, вызывающих появление отложенных транзакций, и о том, как их можно вывести из такого состояния, см. в статье [Отложенные транзакции (SQL Server)](../backup-restore/deferred-transactions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="13200-171">For information about the causes of deferred transactions and how to move them out of the deferred state, see [Deferred Transactions &#40;SQL Server&#41;](../backup-restore/deferred-transactions-sql-server.md).</span></span> <br /><br /><span data-ttu-id="13200-172">Длительные транзакции также могут переполнить журнал транзакций базы данных tempdb.</span><span class="sxs-lookup"><span data-stu-id="13200-172">Long-running transactions might also fill up tempdb's transaction log.</span></span> <span data-ttu-id="13200-173">Пользовательские транзакции неявно используют базу данных tempdb для внутренних объектов, например для сортировки рабочих таблиц, хэширования рабочих файлов, перемещения рабочих таблиц и управления версиями строк.</span><span class="sxs-lookup"><span data-stu-id="13200-173">Tempdb is used implicitly by user transactions for internal objects such as work tables for sorting, work files for hashing, cursor work tables, and row versioning.</span></span> <span data-ttu-id="13200-174">Даже если пользовательская транзакция включает только чтение данных (запросы SELECT), внутренние объекты могут создаваться и использоваться в пользовательских транзакциях.</span><span class="sxs-lookup"><span data-stu-id="13200-174">Even if the user transaction includes only reading data (SELECT queries), internal objects may be created and used under user transactions.</span></span> <span data-ttu-id="13200-175">В результате журнал транзакций базы данных tempdb может быть заполнен.</span><span class="sxs-lookup"><span data-stu-id="13200-175">Then the tempdb transaction log can be filled.</span></span>|  
|<span data-ttu-id="13200-176">5</span><span class="sxs-lookup"><span data-stu-id="13200-176">5</span></span>|<span data-ttu-id="13200-177">DATABASE_MIRRORING</span><span class="sxs-lookup"><span data-stu-id="13200-177">DATABASE_MIRRORING</span></span>|<span data-ttu-id="13200-178">Зеркальное отображение базы данных приостановлено или в режиме высокой производительности зеркальная база данных намного отстает от основной.</span><span class="sxs-lookup"><span data-stu-id="13200-178">Database mirroring is paused, or under high-performance mode, the mirror database is significantly behind the principal database.</span></span> <span data-ttu-id="13200-179">(Только для модели полного восстановления)</span><span class="sxs-lookup"><span data-stu-id="13200-179">(Full recovery model only)</span></span><br /><br /> <span data-ttu-id="13200-180">Дополнительные сведения см. в разделе [Зеркальное отображение базы данных (SQL Server)](../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="13200-180">For more information, see [Database Mirroring &#40;SQL Server&#41;](../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span></span>|  
|<span data-ttu-id="13200-181">6</span><span class="sxs-lookup"><span data-stu-id="13200-181">6</span></span>|<span data-ttu-id="13200-182">РЕПЛИКАЦИЯ</span><span class="sxs-lookup"><span data-stu-id="13200-182">REPLICATION</span></span>|<span data-ttu-id="13200-183">Во время репликации транзакций в базу данных распространителя не доставляются транзакции, имеющие отношение к публикациям.</span><span class="sxs-lookup"><span data-stu-id="13200-183">During transactional replications, transactions relevant to the publications are still undelivered to the distribution database.</span></span> <span data-ttu-id="13200-184">(Только для модели полного восстановления)</span><span class="sxs-lookup"><span data-stu-id="13200-184">(Full recovery model only)</span></span><br /><br /> <span data-ttu-id="13200-185">Дополнительные сведения о репликации транзакций см. в разделе [SQL Server Replication](../../relational-databases/replication/sql-server-replication.md).</span><span class="sxs-lookup"><span data-stu-id="13200-185">For information about transactional replication, see [SQL Server Replication](../../relational-databases/replication/sql-server-replication.md).</span></span>|  
|<span data-ttu-id="13200-186">7</span><span class="sxs-lookup"><span data-stu-id="13200-186">7</span></span>|<span data-ttu-id="13200-187">DATABASE_SNAPSHOT_CREATION</span><span class="sxs-lookup"><span data-stu-id="13200-187">DATABASE_SNAPSHOT_CREATION</span></span>|<span data-ttu-id="13200-188">Создается моментальный снимок базы данных.</span><span class="sxs-lookup"><span data-stu-id="13200-188">A database snapshot is being created.</span></span> <span data-ttu-id="13200-189">(Все модели восстановления)</span><span class="sxs-lookup"><span data-stu-id="13200-189">(All recovery models)</span></span><br /><br /> <span data-ttu-id="13200-190">Это очень распространенная (и обычно кратковременная) причина задержки усечения журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="13200-190">This is a routine, and typically brief, cause of delayed log truncation.</span></span>|  
|<span data-ttu-id="13200-191">8</span><span class="sxs-lookup"><span data-stu-id="13200-191">8</span></span>|<span data-ttu-id="13200-192">LOG_SCAN</span><span class="sxs-lookup"><span data-stu-id="13200-192">LOG_SCAN</span></span>|<span data-ttu-id="13200-193">Производится просмотр журнала.</span><span class="sxs-lookup"><span data-stu-id="13200-193">A log scan is occurring.</span></span> <span data-ttu-id="13200-194">(Все модели восстановления)</span><span class="sxs-lookup"><span data-stu-id="13200-194">(All recovery models)</span></span><br /><br /> <span data-ttu-id="13200-195">Это очень распространенная (и обычно кратковременная) причина задержки усечения журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="13200-195">This is a routine, and typically brief, cause of delayed log truncation.</span></span>|  
|<span data-ttu-id="13200-196">9</span><span class="sxs-lookup"><span data-stu-id="13200-196">9</span></span>|<span data-ttu-id="13200-197">AVAILABILITY_REPLICA</span><span class="sxs-lookup"><span data-stu-id="13200-197">AVAILABILITY_REPLICA</span></span>|<span data-ttu-id="13200-198">Вторичная реплика группы доступности применяет записи журнала транзакций этой базы данных к соответствующей базе данных-получателю.</span><span class="sxs-lookup"><span data-stu-id="13200-198">A secondary replica of an availability group is applying transaction log records of this database to a corresponding secondary database.</span></span> <span data-ttu-id="13200-199">(Модель полного восстановления)</span><span class="sxs-lookup"><span data-stu-id="13200-199">(Full recovery model)</span></span><br /><br /> <span data-ttu-id="13200-200">Дополнительные сведения см. в разделе Общие сведения о [группы доступности AlwaysOn &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="13200-200">For more information, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md).</span></span>|  
|<span data-ttu-id="13200-201">10</span><span class="sxs-lookup"><span data-stu-id="13200-201">10</span></span>|-|<span data-ttu-id="13200-202">Только для внутреннего применения</span><span class="sxs-lookup"><span data-stu-id="13200-202">For internal use only</span></span>|  
|<span data-ttu-id="13200-203">11</span><span class="sxs-lookup"><span data-stu-id="13200-203">11</span></span>|-|<span data-ttu-id="13200-204">Только для внутреннего применения</span><span class="sxs-lookup"><span data-stu-id="13200-204">For internal use only</span></span>|  
|<span data-ttu-id="13200-205">12</span><span class="sxs-lookup"><span data-stu-id="13200-205">12</span></span>|-|<span data-ttu-id="13200-206">Только для внутреннего применения</span><span class="sxs-lookup"><span data-stu-id="13200-206">For internal use only</span></span>|  
|<span data-ttu-id="13200-207">13</span><span class="sxs-lookup"><span data-stu-id="13200-207">13</span></span>|<span data-ttu-id="13200-208">OLDEST_PAGE</span><span class="sxs-lookup"><span data-stu-id="13200-208">OLDEST_PAGE</span></span>|<span data-ttu-id="13200-209">Если база данных настроена для использования косвенных контрольных точек, самая старая страница в базе данных может быть старше контрольной точки с номером LSN.</span><span class="sxs-lookup"><span data-stu-id="13200-209">If a database is configured to use indirect checkpoints, the oldest page on the database might be older than the checkpoint LSN.</span></span> <span data-ttu-id="13200-210">В этом случае самая старая страница может задержать усечение журнала.</span><span class="sxs-lookup"><span data-stu-id="13200-210">In this case, the oldest page can delay log truncation.</span></span> <span data-ttu-id="13200-211">(Все модели восстановления)</span><span class="sxs-lookup"><span data-stu-id="13200-211">(All recovery models)</span></span><br /><br /> <span data-ttu-id="13200-212">Сведения о косвенных контрольных точках см. в статье [Database Checkpoints &#40;SQL Server&#41;](database-checkpoints-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="13200-212">For information about indirect checkpoints, see [Database Checkpoints &#40;SQL Server&#41;](database-checkpoints-sql-server.md).</span></span>|  
|<span data-ttu-id="13200-213">14</span><span class="sxs-lookup"><span data-stu-id="13200-213">14</span></span>|<span data-ttu-id="13200-214">OTHER_TRANSIENT</span><span class="sxs-lookup"><span data-stu-id="13200-214">OTHER_TRANSIENT</span></span>|<span data-ttu-id="13200-215">Эта значение сейчас не используется.</span><span class="sxs-lookup"><span data-stu-id="13200-215">This value is currently not used.</span></span>|  
|<span data-ttu-id="13200-216">16</span><span class="sxs-lookup"><span data-stu-id="13200-216">16</span></span>|<span data-ttu-id="13200-217">XTP_CHECKPOINT</span><span class="sxs-lookup"><span data-stu-id="13200-217">XTP_CHECKPOINT</span></span>|<span data-ttu-id="13200-218">Если база данных имеет оптимизированную для памяти файловую группу, журнал транзакций может не усекаться до срабатывания автоматической контрольной точки [!INCLUDE[hek_2](../../includes/hek-2-md.md)] (что происходит при росте размера журнала на каждые 512 МБ).</span><span class="sxs-lookup"><span data-stu-id="13200-218">When a database has a memory-optimized filegroup, the transaction log may not truncate until automatic [!INCLUDE[hek_2](../../includes/hek-2-md.md)] checkpoint is triggered (which happens at every 512 MB of log growth).</span></span><br /><br /> <span data-ttu-id="13200-219">Примечание. чтобы усечь журнал транзакций до 512 МБ, запустите команду Checkpoint вручную в соответствии с рассматриваемой базой данных.</span><span class="sxs-lookup"><span data-stu-id="13200-219">Note: To truncate transaction log before 512 MB size, fire the Checkpoint command manually against the database in question.</span></span>|  
  
##  <a name="operations-that-can-be-minimally-logged"></a><a name="MinimallyLogged"></a><span data-ttu-id="13200-220">Операции, которые могут быть минимально записаны в журнал</span><span class="sxs-lookup"><span data-stu-id="13200-220">Operations That Can Be Minimally Logged</span></span>  
 <span data-ttu-id="13200-221">*Минимальное протоколирование* — это протоколирование только информации, необходимой для восстановления транзакции без поддержки восстановления на момент времени.</span><span class="sxs-lookup"><span data-stu-id="13200-221">*Minimal logging* involves logging only the information that is required to recover the transaction without supporting point-in-time recovery.</span></span> <span data-ttu-id="13200-222">В этом разделе определяются операции, которые подлежат минимальному протоколированию в модели восстановления с неполным протоколированием (как и в простой модели восстановления, кроме случаев, когда выполняется резервное копирование).</span><span class="sxs-lookup"><span data-stu-id="13200-222">This topic identifies the operations that are minimally logged under the bulk-logged recovery model (as well as under the simple recovery model, except when a backup is running).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="13200-223">Минимальное протоколирование не поддерживается для оптимизированных для памяти таблиц.</span><span class="sxs-lookup"><span data-stu-id="13200-223">Minimal logging is not supported for memory-optimized tables.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="13200-224">В модели полного восстановления все массовые операции полностью протоколируются.</span><span class="sxs-lookup"><span data-stu-id="13200-224">Under the full recovery model, all bulk operations are fully logged.</span></span> <span data-ttu-id="13200-225">Однако для набора массовых операций можно использовать минимальное протоколирование, временно переключив базу данных на модель восстановления с неполным протоколированием во время массовых операций.</span><span class="sxs-lookup"><span data-stu-id="13200-225">However, you can minimize logging for a set of bulk operations by switching the database to the bulk-logged recovery model temporarily for bulk operations.</span></span> <span data-ttu-id="13200-226">Минимальное протоколирование более эффективно, чем полное, и снижает вероятность того, что во время массовой операции большого объема будет заполнено все доступное пространство журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="13200-226">Minimal logging is more efficient than full logging, and it reduces the possibility of a large-scale bulk operation filling the available transaction log space during a bulk transaction.</span></span> <span data-ttu-id="13200-227">Однако, если при включенном минимальном протоколировании база данных будет повреждена или потеряна, ее нельзя будет восстановить до точки сбоя.</span><span class="sxs-lookup"><span data-stu-id="13200-227">However, if the database is damaged or lost when minimal logging is in effect, you cannot recover the database to the point of failure.</span></span>  
  
 <span data-ttu-id="13200-228">Следующие операции, выполняемые с полным протоколированием в модели полного восстановления, осуществляются с минимальным протоколированием в простой модели восстановления и модели восстановления с неполным протоколированием:</span><span class="sxs-lookup"><span data-stu-id="13200-228">The following operations, which are fully logged under the full recovery model, are minimally logged under the simple and bulk-logged recovery model:</span></span>  
  
-   <span data-ttu-id="13200-229">Операции массового импорта ([bcp](../../tools/bcp-utility.md), [BULK INSERT](/sql/t-sql/statements/bulk-insert-transact-sql) и [INSERT... SELECT](/sql/t-sql/statements/insert-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="13200-229">Bulk import operations ([bcp](../../tools/bcp-utility.md), [BULK INSERT](/sql/t-sql/statements/bulk-insert-transact-sql), and [INSERT... SELECT](/sql/t-sql/statements/insert-transact-sql)).</span></span> <span data-ttu-id="13200-230">Дополнительные сведения о том, когда массовый импорт в таблицу подлежит минимальному протоколированию, см. в разделе [Prerequisites for Minimal Logging in Bulk Import](../import-export/prerequisites-for-minimal-logging-in-bulk-import.md).</span><span class="sxs-lookup"><span data-stu-id="13200-230">For more information about when bulk import into a table is minimally logged, see [Prerequisites for Minimal Logging in Bulk Import](../import-export/prerequisites-for-minimal-logging-in-bulk-import.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="13200-231">Если включена репликация транзакций, операции BULK INSERT полностью протоколируются даже в модели с неполным протоколированием.</span><span class="sxs-lookup"><span data-stu-id="13200-231">When transactional replication is enabled, BULK INSERT operations are fully logged even under the Bulk Logged recovery model.</span></span>  
  
-   <span data-ttu-id="13200-232">Операции SELECT [Into](/sql/t-sql/queries/select-into-clause-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="13200-232">SELECT [INTO](/sql/t-sql/queries/select-into-clause-transact-sql) operations.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="13200-233">Если включена репликация транзакций, операции SELECT INTO полностью протоколируются даже в модели восстановления с неполным протоколированием.</span><span class="sxs-lookup"><span data-stu-id="13200-233">When transactional replication is enabled, SELECT INTO operations are fully logged even under the Bulk Logged recovery model.</span></span>  
  
-   <span data-ttu-id="13200-234">Частичные обновления типов данных с большими значениями с помощью предложений .WRITE инструкции [UPDATE](/sql/t-sql/queries/update-transact-sql) при вставке или добавлении новых данных.</span><span class="sxs-lookup"><span data-stu-id="13200-234">Partial updates to large value data types, using the .WRITE clause in the [UPDATE](/sql/t-sql/queries/update-transact-sql) statement when inserting or appending new data.</span></span> <span data-ttu-id="13200-235">Обратите внимание, что минимальное протоколирование не используется при обновлении существующих значений.</span><span class="sxs-lookup"><span data-stu-id="13200-235">Note that minimal logging is not used when existing values are updated.</span></span> <span data-ttu-id="13200-236">Дополнительные сведения о больших типах-значениях см. в статье [Типы данных (Transact-SQL)](/sql/t-sql/data-types/data-types-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="13200-236">For more information about large value data types, see [Data Types &#40;Transact-SQL&#41;](/sql/t-sql/data-types/data-types-transact-sql).</span></span>  
  
-   <span data-ttu-id="13200-237">Инструкции [WRITETEXT](/sql/t-sql/queries/writetext-transact-sql) и [UPDATETEXT](/sql/t-sql/queries/updatetext-transact-sql) при вставке или добавлении новых данных в `text` `ntext` `image` столбцы типа данных, и.</span><span class="sxs-lookup"><span data-stu-id="13200-237">[WRITETEXT](/sql/t-sql/queries/writetext-transact-sql) and [UPDATETEXT](/sql/t-sql/queries/updatetext-transact-sql) statements when inserting or appending new data into the `text`, `ntext`, and `image` data type columns.</span></span> <span data-ttu-id="13200-238">Обратите внимание, что минимальное протоколирование не используется при обновлении существующих значений.</span><span class="sxs-lookup"><span data-stu-id="13200-238">Note that minimal logging is not used when existing values are updated.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="13200-239">Инструкции WRITETEXT и UPDATETEXT являются устаревшими, поэтому следует избегать их использования в новых приложениях.</span><span class="sxs-lookup"><span data-stu-id="13200-239">The WRITETEXT and UPDATETEXT statements are deprecated, so you should avoid using them in new applications.</span></span>  
  
-   <span data-ttu-id="13200-240">Если в базе данных используется простая модель восстановления или модель восстановления с неполным протоколированием, некоторые DDL-операции с индексом протоколируются в минимальном объеме при их выполнении как режиме «вне сети», так и в режиме «в сети».</span><span class="sxs-lookup"><span data-stu-id="13200-240">If the database is set to the simple or bulk-logged recovery model, some index DDL operations are minimally logged whether the operation is executed offline or online.</span></span> <span data-ttu-id="13200-241">Минимально протоколируются следующие операции с индексами.</span><span class="sxs-lookup"><span data-stu-id="13200-241">The minimally logged index operations are as follows:</span></span>  
  
    -   <span data-ttu-id="13200-242">Операции[CREATE INDEX](/sql/t-sql/statements/create-index-transact-sql) (включая индексированные представления).</span><span class="sxs-lookup"><span data-stu-id="13200-242">[CREATE INDEX](/sql/t-sql/statements/create-index-transact-sql) operations (including indexed views).</span></span>  
  
    -   <span data-ttu-id="13200-243">Операции[ALTER INDEX](/sql/t-sql/statements/alter-index-transact-sql) REBUILD или DBCC DBREINDEX.</span><span class="sxs-lookup"><span data-stu-id="13200-243">[ALTER INDEX](/sql/t-sql/statements/alter-index-transact-sql) REBUILD or DBCC DBREINDEX operations.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="13200-244">Инструкция DBCC DBREINDEX является устаревшей, поэтому следует избегать ее использования в новых приложениях.</span><span class="sxs-lookup"><span data-stu-id="13200-244">The DBCC DBREINDEX statement is deprecated so you should avoid using it in new applications.</span></span>  
  
    -   <span data-ttu-id="13200-245">Перестроение новой кучи DROP INDEX (если применимо).</span><span class="sxs-lookup"><span data-stu-id="13200-245">DROP INDEX new heap rebuild (if applicable).</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="13200-246"> Освобождение страниц индекса в ходе выполнения операции [DROP INDEX](/sql/t-sql/statements/drop-index-transact-sql) всегда протоколируется полностью.</span><span class="sxs-lookup"><span data-stu-id="13200-246">Index page deallocation during a [DROP INDEX](/sql/t-sql/statements/drop-index-transact-sql) operation is always fully logged.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="13200-247">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="13200-247">Related Tasks</span></span>  
 `Managing the transaction log`  
  
-   [<span data-ttu-id="13200-248">Управление размером файла журнала транзакций</span><span class="sxs-lookup"><span data-stu-id="13200-248">Manage the Size of the Transaction Log File</span></span>](manage-the-size-of-the-transaction-log-file.md)  
  
-   [<span data-ttu-id="13200-249">Устранение неполадок при переполнении журнала транзакций (ошибка SQL Server 9002)</span><span class="sxs-lookup"><span data-stu-id="13200-249">Troubleshoot a Full Transaction Log &#40;SQL Server Error 9002&#41;</span></span>](troubleshoot-a-full-transaction-log-sql-server-error-9002.md)  
  
 <span data-ttu-id="13200-250">**Резервное копирование журнала транзакций (модель полного восстановления)**</span><span class="sxs-lookup"><span data-stu-id="13200-250">**Backing Up the Transaction Log (Full Recovery Model)**</span></span>  
  
-   [<span data-ttu-id="13200-251">Создание резервной копии журнала транзакций (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="13200-251">Back Up a Transaction Log &#40;SQL Server&#41;</span></span>](../backup-restore/back-up-a-transaction-log-sql-server.md)  
  
 <span data-ttu-id="13200-252">**Восстановление журнала транзакций (модель полного восстановления)**</span><span class="sxs-lookup"><span data-stu-id="13200-252">**Restoring the Transaction Log (Full Recovery Model)**</span></span>  
  
-  [<span data-ttu-id="13200-253">Восстановление резервной копии журнала транзакций</span><span class="sxs-lookup"><span data-stu-id="13200-253">Restore a Transaction Log Backup</span></span>](../backup-restore/restore-a-transaction-log-backup-sql-server.md)   
  
## <a name="see-also"></a><span data-ttu-id="13200-254">См. также:</span><span class="sxs-lookup"><span data-stu-id="13200-254">See Also</span></span>  
 <span data-ttu-id="13200-255">[Управление устойчивостью транзакций](control-transaction-durability.md) </span><span class="sxs-lookup"><span data-stu-id="13200-255">[Control Transaction Durability](control-transaction-durability.md) </span></span>  
 <span data-ttu-id="13200-256">[Предварительные условия для минимального протоколирования массового импорта данных](../import-export/prerequisites-for-minimal-logging-in-bulk-import.md) </span><span class="sxs-lookup"><span data-stu-id="13200-256">[Prerequisites for Minimal Logging in Bulk Import](../import-export/prerequisites-for-minimal-logging-in-bulk-import.md) </span></span>  
 <span data-ttu-id="13200-257">[Резервное копирование и восстановление баз данных SQL Server](../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="13200-257">[Back Up and Restore of SQL Server Databases](../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span></span>  
 <span data-ttu-id="13200-258">[Контрольные точки базы данных (SQL Server)](database-checkpoints-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="13200-258">[Database Checkpoints &#40;SQL Server&#41;](database-checkpoints-sql-server.md) </span></span>  
 <span data-ttu-id="13200-259">[Просмотр или изменение свойств базы данных](../databases/view-or-change-the-properties-of-a-database.md) </span><span class="sxs-lookup"><span data-stu-id="13200-259">[View or Change the Properties of a Database](../databases/view-or-change-the-properties-of-a-database.md) </span></span>  
 [<span data-ttu-id="13200-260">Модели восстановления (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="13200-260">Recovery Models &#40;SQL Server&#41;</span></span>](../backup-restore/recovery-models-sql-server.md)  
  
  
