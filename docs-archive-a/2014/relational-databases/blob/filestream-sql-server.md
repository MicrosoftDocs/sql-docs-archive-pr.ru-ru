---
title: FILESTREAM (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: filestream
ms.topic: conceptual
helpviewer_keywords:
- FILESTREAM [SQL Server]
- FILESTREAM [SQL Server], about
- FILESTREAM [SQL Server], overview
ms.assetid: 9a5a8166-bcbe-4680-916c-26276253eafa
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 971f45fd69f381a8997bb2f8f08444f4d9c107c4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87740070"
---
# <a name="filestream-sql-server"></a><span data-ttu-id="55f3b-102">FILESTREAM (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="55f3b-102">FILESTREAM (SQL Server)</span></span>
  <span data-ttu-id="55f3b-103">FILESTREAM позволяет приложениям на основе [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]хранить в файловой системе неструктурированные данные, например документы и изображения.</span><span class="sxs-lookup"><span data-stu-id="55f3b-103">FILESTREAM enables [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]-based applications to store unstructured data, such as documents and images, on the file system.</span></span> <span data-ttu-id="55f3b-104">Приложения могут одновременно использовать многопоточные API-интерфейсы и производительность файловой системы, тем самым обеспечивая транзакционную согласованность между неструктурированными и соответствующими им структурированными данными.</span><span class="sxs-lookup"><span data-stu-id="55f3b-104">Applications can leverage the rich streaming APIs and performance of the file system and at the same time maintain transactional consistency between the unstructured data and corresponding structured data.</span></span>  
  
 <span data-ttu-id="55f3b-105">Файловый поток интегрируется [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] с файловой системой NTFS путем хранения `varbinary(max)` данных больших двоичных объектов (BLOB) в виде файлов в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="55f3b-105">FILESTREAM integrates the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] with an NTFS file system by storing `varbinary(max)` binary large object (BLOB) data as files on the file system.</span></span> [!INCLUDE[tsql](../../includes/tsql-md.md)] <span data-ttu-id="55f3b-106">можно вставлять, обновлять, запрашивать, искать и создавать резервные копии данных FILESTREAM.</span><span class="sxs-lookup"><span data-stu-id="55f3b-106">statements can insert, update, query, search, and back up FILESTREAM data.</span></span> <span data-ttu-id="55f3b-107">Интерфейсы файловой системы Win32 предоставляют потоковый доступ к этим данным.</span><span class="sxs-lookup"><span data-stu-id="55f3b-107">Win32 file system interfaces provide streaming access to the data.</span></span>  
  
 <span data-ttu-id="55f3b-108">Для кэширования данных файлов в хранилище FILESTREAM используется системный кэш NT.</span><span class="sxs-lookup"><span data-stu-id="55f3b-108">FILESTREAM uses the NT system cache for caching file data.</span></span> <span data-ttu-id="55f3b-109">Это позволяет снизить возможное влияние данных FILESTREAM на производительность компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="55f3b-109">This helps reduce any effect that FILESTREAM data might have on [!INCLUDE[ssDE](../../includes/ssde-md.md)] performance.</span></span> <span data-ttu-id="55f3b-110">Буферный пул [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не используется, поэтому эта память доступна для обработки запросов.</span><span class="sxs-lookup"><span data-stu-id="55f3b-110">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] buffer pool is not used; therefore, this memory is available for query processing.</span></span>  
  
 <span data-ttu-id="55f3b-111">FILESTREAM не включается автоматически при установке или обновлении [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="55f3b-111">FILESTREAM is not automatically enabled when you install or upgrade [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="55f3b-112">FILESTREAM необходимо включить с помощью диспетчера конфигурации SQL Server и среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="55f3b-112">You must enable FILESTREAM by using SQL Server Configuration Manager and [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span> <span data-ttu-id="55f3b-113">Для использования FILESTREAM нужно создать или изменить базу данных, которая будет содержать заданный тип файловой группы.</span><span class="sxs-lookup"><span data-stu-id="55f3b-113">To use FILESTREAM, you must create or modify a database to contain a special type of filegroup.</span></span> <span data-ttu-id="55f3b-114">После этого следует создать или изменить таблицу, чтобы она содержала столбец `varbinary(max)` с атрибутом FILESTREAM.</span><span class="sxs-lookup"><span data-stu-id="55f3b-114">Then, create or modify a table so that it contains a `varbinary(max)` column with the FILESTREAM attribute.</span></span> <span data-ttu-id="55f3b-115">После завершения выполнения этих задач можно будет пользоваться [!INCLUDE[tsql](../../includes/tsql-md.md)] и Win32 для управления данными FILESTREAM.</span><span class="sxs-lookup"><span data-stu-id="55f3b-115">After you complete these tasks, you can use [!INCLUDE[tsql](../../includes/tsql-md.md)] and Win32 to manage the FILESTREAM data.</span></span>  
  
 <span data-ttu-id="55f3b-116">Дополнительные сведения об установке и использованию FILESTREAM см. в списке [Связанные задачи](#reltasks).</span><span class="sxs-lookup"><span data-stu-id="55f3b-116">For more information about installing and using FILESTREAM, see the list of [Related Tasks](#reltasks).</span></span>  
  
##  <a name="when-to-use-filestream"></a><a name="whentouse"></a><span data-ttu-id="55f3b-117">Когда следует использовать FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="55f3b-117">When to Use FILESTREAM</span></span>  
 <span data-ttu-id="55f3b-118">В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] большие двоичные объекты (BLOB) могут представлять собой либо стандартный тип `varbinary(max)`, где данные хранятся в таблице базы данных, либо объекты FILESTREAM типа `varbinary(max)`, где данные хранятся в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="55f3b-118">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], BLOBs can be standard `varbinary(max)` data that stores the data in tables, or FILESTREAM `varbinary(max)` objects that store the data in the file system.</span></span> <span data-ttu-id="55f3b-119">Выбор в качестве хранилища базы данных или файловой системы определяется размером и назначением данных.</span><span class="sxs-lookup"><span data-stu-id="55f3b-119">The size and use of the data determines whether you should use database storage or file system storage.</span></span> <span data-ttu-id="55f3b-120">Объекты FILESTREAM следует использовать в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="55f3b-120">If the following conditions are true, you should consider using FILESTREAM:</span></span>  
  
-   <span data-ttu-id="55f3b-121">средний размер сохраняемых объектов превышает 1 МБ;</span><span class="sxs-lookup"><span data-stu-id="55f3b-121">Objects that are being stored are, on average, larger than 1 MB.</span></span>  
  
-   <span data-ttu-id="55f3b-122">важен быстрый доступ для чтения;</span><span class="sxs-lookup"><span data-stu-id="55f3b-122">Fast read access is important.</span></span>  
  
-   <span data-ttu-id="55f3b-123">в разрабатываемых приложениях для логики приложений используется средний уровень.</span><span class="sxs-lookup"><span data-stu-id="55f3b-123">You are developing applications that use a middle tier for application logic.</span></span>  
  
 <span data-ttu-id="55f3b-124">При работе с объектами меньшего размера сохранение больших двоичных объектов (BLOB) типа `varbinary(max)` в базе данных часто позволяет добиться лучшей производительности потоков.</span><span class="sxs-lookup"><span data-stu-id="55f3b-124">For smaller objects, storing `varbinary(max)` BLOBs in the database often provides better streaming performance.</span></span>  
  
  
##  <a name="filestream-storage"></a><a name="storage"></a><span data-ttu-id="55f3b-125">Хранилище FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="55f3b-125">FILESTREAM Storage</span></span>  
 <span data-ttu-id="55f3b-126">Хранилище FILESTREAM реализовано в виде столбца типа `varbinary(max)`, данные которого хранятся в файловой системе как большие двоичные объекты (BLOB).</span><span class="sxs-lookup"><span data-stu-id="55f3b-126">FILESTREAM storage is implemented as a `varbinary(max)` column in which the data is stored as BLOBs in the file system.</span></span> <span data-ttu-id="55f3b-127">Размеры объектов BLOB ограничены только размером тома файловой системы.</span><span class="sxs-lookup"><span data-stu-id="55f3b-127">The sizes of the BLOBs are limited only by the volume size of the file system.</span></span> <span data-ttu-id="55f3b-128">Стандартное ограничение типа `varbinary(max)`, согласно которому размер файла не должен превышать 2 ГБ, не применяется к объектам BLOB, сохраняемым в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="55f3b-128">The standard `varbinary(max)` limitation of 2-GB file sizes does not apply to BLOBs that are stored in the file system.</span></span>  
  
 <span data-ttu-id="55f3b-129">Чтобы указать необходимость сохранения данных столбца в файловой системе, укажите атрибут FILESTREAM для столбца `varbinary(max)`.</span><span class="sxs-lookup"><span data-stu-id="55f3b-129">To specify that a column should store data on the file system, specify the FILESTREAM attribute on a `varbinary(max)` column.</span></span> <span data-ttu-id="55f3b-130">В результате компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] будет сохранять все данные этого столбца в файловой системе, а не в файле базы данных.</span><span class="sxs-lookup"><span data-stu-id="55f3b-130">This causes the [!INCLUDE[ssDE](../../includes/ssde-md.md)] to store all data for that column on the file system, but not in the database file.</span></span>  
  
 <span data-ttu-id="55f3b-131">Данные FILESTREAM должны сохраняться в файловых группах FILESTREAM.</span><span class="sxs-lookup"><span data-stu-id="55f3b-131">FILESTREAM data must be stored in FILESTREAM filegroups.</span></span> <span data-ttu-id="55f3b-132">Файловая группа FILESTREAM представляет собой особую файловую группу, в которой вместо самих файлов содержатся системные каталоги файлов.</span><span class="sxs-lookup"><span data-stu-id="55f3b-132">A FILESTREAM filegroup is a special filegroup that contains file system directories instead of the files themselves.</span></span> <span data-ttu-id="55f3b-133">Данные системные каталоги файлов называются *контейнерами данных*.</span><span class="sxs-lookup"><span data-stu-id="55f3b-133">These file system directories are called *data containers*.</span></span> <span data-ttu-id="55f3b-134">Они являются интерфейсом между хранилищем компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] и хранилищем файловой системы.</span><span class="sxs-lookup"><span data-stu-id="55f3b-134">Data containers are the interface between [!INCLUDE[ssDE](../../includes/ssde-md.md)] storage and file system storage.</span></span>  
  
 <span data-ttu-id="55f3b-135">При использовании хранилища FILESTREAM обратите внимание на следующие аспекты:</span><span class="sxs-lookup"><span data-stu-id="55f3b-135">When you use FILESTREAM storage, consider the following:</span></span>  
  
-   <span data-ttu-id="55f3b-136">если в таблице присутствует столбец FILESTREAM, каждая строка должна иметь уникальный идентификатор строки (не равен NULL);</span><span class="sxs-lookup"><span data-stu-id="55f3b-136">When a table contains a FILESTREAM column, each row must have a nonnull unique row ID.</span></span>  
  
-   <span data-ttu-id="55f3b-137">в файловую группу FILESTREAM можно добавить несколько контейнеров данных;</span><span class="sxs-lookup"><span data-stu-id="55f3b-137">Multiple data containers can be added to a FILESTREAM filegroup.</span></span>  
  
-   <span data-ttu-id="55f3b-138">вложенность контейнеров данных FILESTREAM не допускается;</span><span class="sxs-lookup"><span data-stu-id="55f3b-138">FILESTREAM data containers cannot be nested.</span></span>  
  
-   <span data-ttu-id="55f3b-139">при использовании отказоустойчивого кластера файловые группы FILESTREAM должны находиться в ресурсах общего диска;</span><span class="sxs-lookup"><span data-stu-id="55f3b-139">When you are using failover clustering, the FILESTREAM filegroups must be on shared disk resources.</span></span>  
  
-   <span data-ttu-id="55f3b-140">файловые группы FILESTREAM могут размещаться на сжатых томах.</span><span class="sxs-lookup"><span data-stu-id="55f3b-140">FILESTREAM filegroups can be on compressed volumes.</span></span>  
  
### <a name="integrated-management"></a><span data-ttu-id="55f3b-141">Интегрированное управление</span><span class="sxs-lookup"><span data-stu-id="55f3b-141">Integrated Management</span></span>  
 <span data-ttu-id="55f3b-142">Поскольку FILESTREAM реализуется в виде столбца типа `varbinary(max)` и интегрируется непосредственно в компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)], большинство функций и средств управления [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не требуют изменения для работы с данными FILESTREAM.</span><span class="sxs-lookup"><span data-stu-id="55f3b-142">Because FILESTREAM is implemented as a `varbinary(max)` column and integrated directly into the [!INCLUDE[ssDE](../../includes/ssde-md.md)], most [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] management tools and functions work without modification for FILESTREAM data.</span></span> <span data-ttu-id="55f3b-143">Так, например, с данными FILESTREAM можно использовать любые модели резервного копирования и восстановления, а резервное копирование данных FILESTREAM осуществляется при помощи структурированных данных в базе данных.</span><span class="sxs-lookup"><span data-stu-id="55f3b-143">For example, you can use all backup and recovery models with FILESTREAM data, and the FILESTREAM data is backed up with the structured data in the database.</span></span> <span data-ttu-id="55f3b-144">Если резервное копирование данных FILESTREAM при помощи реляционных данных выполнять нежелательно, для исключения файловых групп FILESTREAM можно воспользоваться частичным резервным копированием.</span><span class="sxs-lookup"><span data-stu-id="55f3b-144">If you do not want to back up FILESTREAM data with relational data, you can use a partial backup to exclude FILESTREAM filegroups.</span></span>  

  
### <a name="integrated-security"></a><span data-ttu-id="55f3b-145">Встроенные функции безопасности</span><span class="sxs-lookup"><span data-stu-id="55f3b-145">Integrated Security</span></span>  
 <span data-ttu-id="55f3b-146">В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]защита данных FILESTREAM осуществляется таким же образом, как и защита любых других данных: посредством предоставления разрешений на уровнях таблицы или столбца.</span><span class="sxs-lookup"><span data-stu-id="55f3b-146">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], FILESTREAM data is secured just like other data is secured: by granting permissions at the table or column levels.</span></span> <span data-ttu-id="55f3b-147">Пользователь, у которого имеется разрешение на столбец FILESTREAM в таблице, может открыть связанные файлы.</span><span class="sxs-lookup"><span data-stu-id="55f3b-147">If a user has permission to the FILESTREAM column in a table, the user can open the associated files.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="55f3b-148">В данных FILESTREAM не поддерживается шифрование.</span><span class="sxs-lookup"><span data-stu-id="55f3b-148">Encryption is not supported on FILESTREAM data.</span></span>  
  
 <span data-ttu-id="55f3b-149">Разрешения NTFS для доступа к контейнеру FILESTREAM предоставляются только той учетной записью, под которой выполняется служба [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="55f3b-149">Only the account under which the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] service account runs is granted NTFS permissions to the FILESTREAM container.</span></span> <span data-ttu-id="55f3b-150">Другим учетным записям разрешения на доступ к контейнеру данных предоставлять не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="55f3b-150">We recommend that no other account be granted permissions on the data container.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="55f3b-151">Имена входа SQL не работают с контейнерами FILESTREAM.</span><span class="sxs-lookup"><span data-stu-id="55f3b-151">SQL logins will not work with FILESTREAM containers.</span></span> <span data-ttu-id="55f3b-152">С контейнерами FILESTREAM работает только проверка подлинности NTFS.</span><span class="sxs-lookup"><span data-stu-id="55f3b-152">Only NTFS authentication will work with FILESTREAM containers.</span></span>  
  
##  <a name="accessing-blob-data-with-transact-sql-and-file-system-streaming-access"></a><a name="dual"></a> <span data-ttu-id="55f3b-153">Доступ к данным BLOB с помощью Transact-SQL и потокового доступа к файловой системе</span><span class="sxs-lookup"><span data-stu-id="55f3b-153">Accessing BLOB Data with Transact-SQL and File System Streaming Access</span></span>  
 <span data-ttu-id="55f3b-154">После сохранения данных в столбце FILESTREAM доступ к файлам возможен в транзакциях [!INCLUDE[tsql](../../includes/tsql-md.md)] или через API-интерфейсы Win32.</span><span class="sxs-lookup"><span data-stu-id="55f3b-154">After you store data in a FILESTREAM column, you can access the files by using [!INCLUDE[tsql](../../includes/tsql-md.md)] transactions or by using Win32 APIs.</span></span>  
  
### <a name="transact-sql-access"></a><span data-ttu-id="55f3b-155">Доступ с помощью Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="55f3b-155">Transact-SQL Access</span></span>  
 <span data-ttu-id="55f3b-156">Язык [!INCLUDE[tsql](../../includes/tsql-md.md)]позволяет вставлять, обновлять и удалять данные FILESTREAM:</span><span class="sxs-lookup"><span data-stu-id="55f3b-156">By using [!INCLUDE[tsql](../../includes/tsql-md.md)], you can insert, update, and delete FILESTREAM data:</span></span>  
  
-   <span data-ttu-id="55f3b-157">Операция вставки позволяет выполнить предварительное заполнение поля FILESTREAM значением NULL, пустым значением или встроенными данными относительно небольшого размера.</span><span class="sxs-lookup"><span data-stu-id="55f3b-157">You can use an insert operation to prepopulate a FILESTREAM field with a null value, empty value, or relatively short inline data.</span></span> <span data-ttu-id="55f3b-158">Однако при работе с большими объемами данных большей эффективности потока можно добиться при помощи файла, использующего интерфейсы Win32.</span><span class="sxs-lookup"><span data-stu-id="55f3b-158">However, a large amount of data is more efficiently streamed into a file that uses Win32 interfaces.</span></span>  
  
-   <span data-ttu-id="55f3b-159">При обновлении поля FILESTREAM происходит изменение базовых данных BLOB в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="55f3b-159">When you update a FILESTREAM field, you modify the underlying BLOB data in the file system.</span></span> <span data-ttu-id="55f3b-160">Если в поле FILESTREAM содержится значение NULL, данные BLOB, связанные с этим полем, удаляются.</span><span class="sxs-lookup"><span data-stu-id="55f3b-160">When a FILESTREAM field is set to NULL, the BLOB data associated with the field is deleted.</span></span> <span data-ttu-id="55f3b-161">Обновление фрагмента данных на языке [!INCLUDE[tsql](../../includes/tsql-md.md)] , реализованное в виде конструкции UPDATE **.** Write(), использовать для частичного обновления данных нельзя.</span><span class="sxs-lookup"><span data-stu-id="55f3b-161">You cannot use a [!INCLUDE[tsql](../../includes/tsql-md.md)] chunked update, implemented as UPDATE **.** Write(), to perform partial updates to the data.</span></span>  
  
-   <span data-ttu-id="55f3b-162">При удалении строки или удалении или усечении таблицы, содержащей данные FILESTREAM, удаляются базовые данные BLOB в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="55f3b-162">When you delete a row or delete or truncate a table that contains FILESTREAM data, you delete the underlying BLOB data in the file system.</span></span>  
  
### <a name="file-system-streaming-access"></a><span data-ttu-id="55f3b-163">Потоковый доступ к файловой системе</span><span class="sxs-lookup"><span data-stu-id="55f3b-163">File System Streaming Access</span></span>  
 <span data-ttu-id="55f3b-164">Поддержка потоков в Win32 запускается в контексте транзакций [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="55f3b-164">The Win32 streaming support works in the context of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction.</span></span> <span data-ttu-id="55f3b-165">В рамках транзакции функции FILESTREAM позволяют получить логический UNC-путь к файлу в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="55f3b-165">Within a transaction, you can use FILESTREAM functions to obtain a logical UNC file system path of a file.</span></span> <span data-ttu-id="55f3b-166">API-интерфейс OpenSqlFilestream позволяет получить дескриптор файла.</span><span class="sxs-lookup"><span data-stu-id="55f3b-166">You then use the OpenSqlFilestream API to obtain a file handle.</span></span> <span data-ttu-id="55f3b-167">Затем этот дескриптор может использоваться интерфейсами файловых потоков Win32, например ReadFile() и WriteFile(), для доступа и обновления файла посредством файловой системы.</span><span class="sxs-lookup"><span data-stu-id="55f3b-167">This handle can then be used by Win32 file streaming interfaces, such as ReadFile() and WriteFile(), to access and update the file by way of the file system.</span></span>  
  
 <span data-ttu-id="55f3b-168">Поскольку операции над файлами являются транзакционными, удалить или переименовать файлы FILESTREAM с помощью файловой системы невозможно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-168">Because file operations are transactional, you cannot delete or rename FILESTREAM files through the file system.</span></span>  
  
 <span data-ttu-id="55f3b-169">**Модель инструкции**</span><span class="sxs-lookup"><span data-stu-id="55f3b-169">**Statement Model**</span></span>  
  
 <span data-ttu-id="55f3b-170">Доступ к файловой системе FILESTREAM моделирует инструкцию на языке [!INCLUDE[tsql](../../includes/tsql-md.md)] , используя операции открытия и закрытия файлов.</span><span class="sxs-lookup"><span data-stu-id="55f3b-170">The FILESTREAM file system access models a [!INCLUDE[tsql](../../includes/tsql-md.md)] statement by using file open and close.</span></span> <span data-ttu-id="55f3b-171">Эта инструкция запускается при открытии дескриптора файла и завершается при закрытии этого дескриптора.</span><span class="sxs-lookup"><span data-stu-id="55f3b-171">The statement starts when a file handle is opened and ends when the handle is closed.</span></span> <span data-ttu-id="55f3b-172">Например, при закрытии обработчика записи срабатывают все возможные триггеры AFTER, зарегистрированные в таблице, как если бы была выполнена инструкция UPDATE.</span><span class="sxs-lookup"><span data-stu-id="55f3b-172">For example, when a write handle is closed, any possible AFTER trigger that is registered on the table fires as if an UPDATE statement is completed.</span></span>  
  
 <span data-ttu-id="55f3b-173">**Пространство имен хранилища**</span><span class="sxs-lookup"><span data-stu-id="55f3b-173">**Storage Namespace**</span></span>  
  
 <span data-ttu-id="55f3b-174">В хранилище FILESTREAM компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] управляет пространством имен физической файловой системы объектов BLOB.</span><span class="sxs-lookup"><span data-stu-id="55f3b-174">In FILESTREAM, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] controls the BLOB physical file system namespace.</span></span> <span data-ttu-id="55f3b-175">Новая встроенная функция, [PathName](/sql/relational-databases/system-functions/pathname-transact-sql), предоставляет логический UNC-путь объекта BLOB, соответствующего каждой ячейке FILESTREAM в таблице.</span><span class="sxs-lookup"><span data-stu-id="55f3b-175">A new intrinsic function, [PathName](/sql/relational-databases/system-functions/pathname-transact-sql), provides the logical UNC path of the BLOB that corresponds to each FILESTREAM cell in the table.</span></span> <span data-ttu-id="55f3b-176">В приложении этот логический путь используется для получения дескриптора Win32 и работы с данными BLOB посредством обычных интерфейсов файловой системы Win32.</span><span class="sxs-lookup"><span data-stu-id="55f3b-176">The application uses this logical path to obtain the Win32 handle and operate on the BLOB data by using regular Win32 file system interfaces.</span></span> <span data-ttu-id="55f3b-177">Эта функция возвращает значение NULL, если значением столбца FILESTREAM является NULL.</span><span class="sxs-lookup"><span data-stu-id="55f3b-177">The function returns NULL if the value of the FILESTREAM column is NULL.</span></span>  
  
 <span data-ttu-id="55f3b-178">**Доступ к транзакционной файловой системе**</span><span class="sxs-lookup"><span data-stu-id="55f3b-178">**Transacted File System Access**</span></span>  
  
 <span data-ttu-id="55f3b-179">Новая встроенная функция [GET_FILESTREAM_TRANSACTION_CONTEXT()](/sql/t-sql/functions/get-filestream-transaction-context-transact-sql)возвращает токен, представляющий актуальную транзакцию, с которой связан сеанс.</span><span class="sxs-lookup"><span data-stu-id="55f3b-179">A new intrinsic function, [GET_FILESTREAM_TRANSACTION_CONTEXT()](/sql/t-sql/functions/get-filestream-transaction-context-transact-sql), provides the token that represents the current transaction that the session is associated with.</span></span> <span data-ttu-id="55f3b-180">Эта транзакция должна быть запущена, не прервана и не зафиксирована.</span><span class="sxs-lookup"><span data-stu-id="55f3b-180">The transaction must have been started and not yet aborted or committed.</span></span> <span data-ttu-id="55f3b-181">Получение токена позволяет приложению связать потоковые операции файловой системы FILESTREAM с запущенной транзакцией.</span><span class="sxs-lookup"><span data-stu-id="55f3b-181">By obtaining a token, the application binds the FILESTREAM file system streaming operations with a started transaction.</span></span> <span data-ttu-id="55f3b-182">Эта функция возвращает значение NULL в случае отсутствия явно запущенной транзакции.</span><span class="sxs-lookup"><span data-stu-id="55f3b-182">The function returns NULL in case of no explicitly started transaction.</span></span>  
  
 <span data-ttu-id="55f3b-183">Прежде чем транзакция будет зафиксирована или прервана, все дескрипторы файлов должны быть закрыты.</span><span class="sxs-lookup"><span data-stu-id="55f3b-183">All file handles must be closed before the transaction commits or aborts.</span></span> <span data-ttu-id="55f3b-184">Если дескриптор остается открытым за пределами области действия транзакции, дополнительные операции чтения, применяемые к этому дескриптору, завершатся ошибкой; дополнительные операции записи, применяемые к этому дескриптору, будут выполнены успешно, но фактические данные не будут записаны на диск.</span><span class="sxs-lookup"><span data-stu-id="55f3b-184">If a handle is left open beyond the transaction scope, additional reads against the handle will cause a failure; additional writes against the handle will succeed, but the actual data will not be written to disk.</span></span> <span data-ttu-id="55f3b-185">Аналогичным образом, если работа базы данных или экземпляра компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] завершается, все открытые дескрипторы становятся недопустимыми.</span><span class="sxs-lookup"><span data-stu-id="55f3b-185">Similarly, if the database or instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] shuts down, all open handles are invalidated.</span></span>  
  
 <span data-ttu-id="55f3b-186">**Надежность транзакций**</span><span class="sxs-lookup"><span data-stu-id="55f3b-186">**Transactional Durability**</span></span>  
  
 <span data-ttu-id="55f3b-187">При работе с FILESTREAM до момента фиксации транзакции надежность транзакций для данных FILESTREAM объектов BLOB, измененных на основе потокового доступа к файловой системе, обеспечивает компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="55f3b-187">With FILESTREAM, upon transaction commit, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] ensures transaction durability for FILESTREAM BLOB data that is modified from the file system streaming access.</span></span>  
  
 <span data-ttu-id="55f3b-188">**Семантика изоляции**</span><span class="sxs-lookup"><span data-stu-id="55f3b-188">**Isolation Semantics**</span></span>  
  
 <span data-ttu-id="55f3b-189">Управление семантикой изоляции осуществляется уровнями изоляции транзакций компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="55f3b-189">The isolation semantics are governed by [!INCLUDE[ssDE](../../includes/ssde-md.md)] transaction isolation levels.</span></span> <span data-ttu-id="55f3b-190">Для доступа к [!INCLUDE[tsql](../../includes/tsql-md.md)] и файловой системе поддерживается только уровень изоляции READ COMMITTED.</span><span class="sxs-lookup"><span data-stu-id="55f3b-190">Read-committed isolation level is supported for [!INCLUDE[tsql](../../includes/tsql-md.md)] and file system access.</span></span> <span data-ttu-id="55f3b-191">Поддерживаются операции чтения с возможностью повторения, а также сериализуемая изоляция и изоляция моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="55f3b-191">Repeatable read operations, and also serializable and snapshot isolations, are supported.</span></span> <span data-ttu-id="55f3b-192">«Грязные» чтения не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="55f3b-192">Dirty read is not supported.</span></span>  
  
 <span data-ttu-id="55f3b-193">Открытые операции доступа к файловой системе не ожидают никаких блокировок.</span><span class="sxs-lookup"><span data-stu-id="55f3b-193">The file system access open operations do not wait for any locks.</span></span> <span data-ttu-id="55f3b-194">Вместо этого открытые операции моментально завершаются ошибкой, если вследствие изоляции транзакции не удается получить доступ к данным.</span><span class="sxs-lookup"><span data-stu-id="55f3b-194">Instead, the open operations fail immediately if they cannot access the data because of transaction isolation.</span></span> <span data-ttu-id="55f3b-195">Потоковые вызовы API завершаются ошибкой ERROR_SHARING_VIOLATION, если вследствие нарушения изоляции невозможно продолжение открытой операции.</span><span class="sxs-lookup"><span data-stu-id="55f3b-195">The streaming API calls fail with ERROR_SHARING_VIOLATION if the open operation cannot continue because of isolation violation.</span></span>  
  
 <span data-ttu-id="55f3b-196">Чтобы разрешить выполнение частичных обновлений, приложение может издать команду FSCTL_SQL_FILESTREAM_FETCH_OLD_CONTENT для выборки старого содержимого в файл, открытый с помощью ссылки на дескриптор.</span><span class="sxs-lookup"><span data-stu-id="55f3b-196">To allow for partial updates to be made, the application can issue a device FS control (FSCTL_SQL_FILESTREAM_FETCH_OLD_CONTENT) to fetch the old content into the file that the opened handle references.</span></span> <span data-ttu-id="55f3b-197">Это приведет к началу копирования старого содержимого на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="55f3b-197">This will trigger a server-side old content copy.</span></span> <span data-ttu-id="55f3b-198">Чтобы добиться лучшей производительности приложения и избежать потенциальных сбоев из-за времени ожидания при работе с очень большими файлами, рекомендуется использовать асинхронные операции ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="55f3b-198">For better application performance and to avoid running into potential time-outs when you are working with very large files, we recommend that you use asynchronous I/O.</span></span>  
  
 <span data-ttu-id="55f3b-199">Если формирование команды FSCTL произошло после записи в дескриптор, сохраняется последняя операция записи, а результаты предыдущих операций записи в дескриптор теряются.</span><span class="sxs-lookup"><span data-stu-id="55f3b-199">If the FSCTL is issued after the handle has been written to, the last write operation will persist, and prior writes that were made to the handle are lost.</span></span>  
  
 <span data-ttu-id="55f3b-200">**API-интерфейсы файловой системы и поддерживаемые уровни изоляции**</span><span class="sxs-lookup"><span data-stu-id="55f3b-200">**File System APIs and Supported Isolation Levels**</span></span>  
  
 <span data-ttu-id="55f3b-201">Если API-интерфейсу файловой системы не удается открыть файл из-за нарушения изоляции, то возвращается исключение ERROR_SHARING_VIOLATION.</span><span class="sxs-lookup"><span data-stu-id="55f3b-201">When a file system API cannot open a file because of an isolation violation, an ERROR_SHARING_VIOLATION exception is returned.</span></span> <span data-ttu-id="55f3b-202">Это нарушение изоляции возникает в том случае, когда две транзакции пытаются получить доступ к одному и тому же файлу.</span><span class="sxs-lookup"><span data-stu-id="55f3b-202">This isolation violation occurs when two transactions try to access the same file.</span></span> <span data-ttu-id="55f3b-203">Результат операции доступа зависит от режима, в котором файл был открыт, и версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , в которой выполняется транзакция.</span><span class="sxs-lookup"><span data-stu-id="55f3b-203">The outcome of the access operation depends on the mode the file was opened in and the version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that the transaction is running on.</span></span> <span data-ttu-id="55f3b-204">В следующей таблице приведены возможные результаты обращения двух транзакций к одному и тому же файлу.</span><span class="sxs-lookup"><span data-stu-id="55f3b-204">The following table outlines the possibly outcomes for two transactions that are accessing the same file.</span></span>  
  
|<span data-ttu-id="55f3b-205">Транзакция 1</span><span class="sxs-lookup"><span data-stu-id="55f3b-205">Transaction 1</span></span>|<span data-ttu-id="55f3b-206">Транзакция 2</span><span class="sxs-lookup"><span data-stu-id="55f3b-206">Transaction 2</span></span>|<span data-ttu-id="55f3b-207">Результат на сервере SQL Server 2008</span><span class="sxs-lookup"><span data-stu-id="55f3b-207">Outcome on SQL Server 2008</span></span>|<span data-ttu-id="55f3b-208">Результат на SQL Server 2008 R2 и более поздних версиях</span><span class="sxs-lookup"><span data-stu-id="55f3b-208">Outcome on SQL Server 2008 R2 and later versions</span></span>|  
|-------------------|-------------------|--------------------------------|------------------------------------------------------|  
|<span data-ttu-id="55f3b-209">Открыта для чтения.</span><span class="sxs-lookup"><span data-stu-id="55f3b-209">Open for read.</span></span>|<span data-ttu-id="55f3b-210">Открыта для чтения.</span><span class="sxs-lookup"><span data-stu-id="55f3b-210">Open for read.</span></span>|<span data-ttu-id="55f3b-211">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-211">Both succeed.</span></span>|<span data-ttu-id="55f3b-212">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-212">Both succeed.</span></span>|  
|<span data-ttu-id="55f3b-213">Открыта для чтения.</span><span class="sxs-lookup"><span data-stu-id="55f3b-213">Open for read.</span></span>|<span data-ttu-id="55f3b-214">Открыта для записи.</span><span class="sxs-lookup"><span data-stu-id="55f3b-214">Open for write.</span></span>|<span data-ttu-id="55f3b-215">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-215">Both succeed.</span></span> <span data-ttu-id="55f3b-216">Операции записи в рамках транзакции 2 не влияют на операции чтения, выполняемые транзакцией 1.</span><span class="sxs-lookup"><span data-stu-id="55f3b-216">Write operations under transaction 2 do not affect read operations performed in transaction 1.</span></span>|<span data-ttu-id="55f3b-217">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-217">Both succeed.</span></span> <span data-ttu-id="55f3b-218">Операции записи в рамках транзакции 2 не влияют на операции чтения, выполняемые транзакцией 1.</span><span class="sxs-lookup"><span data-stu-id="55f3b-218">Write operations under transaction 2 do not affect read operations performed in transaction 1.</span></span>|  
|<span data-ttu-id="55f3b-219">Открыта для записи.</span><span class="sxs-lookup"><span data-stu-id="55f3b-219">Open for write.</span></span>|<span data-ttu-id="55f3b-220">Открыта для чтения.</span><span class="sxs-lookup"><span data-stu-id="55f3b-220">Open for read.</span></span>|<span data-ttu-id="55f3b-221">При открытии для транзакции 2 возникает ошибка с исключением ERROR_SHARING_VIOLATION.</span><span class="sxs-lookup"><span data-stu-id="55f3b-221">Open for transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|<span data-ttu-id="55f3b-222">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-222">Both succeed.</span></span>|  
|<span data-ttu-id="55f3b-223">Открыта для записи.</span><span class="sxs-lookup"><span data-stu-id="55f3b-223">Open for write.</span></span>|<span data-ttu-id="55f3b-224">Открыта для записи.</span><span class="sxs-lookup"><span data-stu-id="55f3b-224">Open for write.</span></span>|<span data-ttu-id="55f3b-225">При открытии для транзакции 2 возникает ошибка с исключением ERROR_SHARING_VIOLATION.</span><span class="sxs-lookup"><span data-stu-id="55f3b-225">Open for transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|<span data-ttu-id="55f3b-226">При открытии для транзакции 2 возникает ошибка с исключением ERROR_SHARING_VIOLATION.</span><span class="sxs-lookup"><span data-stu-id="55f3b-226">Open for transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|  
|<span data-ttu-id="55f3b-227">Открыта для чтения.</span><span class="sxs-lookup"><span data-stu-id="55f3b-227">Open for read.</span></span>|<span data-ttu-id="55f3b-228">Открыта для SELECT.</span><span class="sxs-lookup"><span data-stu-id="55f3b-228">Open for SELECT.</span></span>|<span data-ttu-id="55f3b-229">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-229">Both succeed.</span></span>|<span data-ttu-id="55f3b-230">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-230">Both succeed.</span></span>|  
|<span data-ttu-id="55f3b-231">Открыта для чтения.</span><span class="sxs-lookup"><span data-stu-id="55f3b-231">Open for read.</span></span>|<span data-ttu-id="55f3b-232">Открыта для UPDATE или DELETE.</span><span class="sxs-lookup"><span data-stu-id="55f3b-232">Open for UPDATE or DELETE.</span></span>|<span data-ttu-id="55f3b-233">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-233">Both succeed.</span></span> <span data-ttu-id="55f3b-234">Операции записи в рамках транзакции 2 не влияют на операции чтения, выполняемые транзакцией 1.</span><span class="sxs-lookup"><span data-stu-id="55f3b-234">Write operations under transaction 2 do not affect read operations performed in transaction 1.</span></span>|<span data-ttu-id="55f3b-235">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-235">Both succeed.</span></span> <span data-ttu-id="55f3b-236">Операции записи в рамках транзакции 2 не влияют на операции чтения, выполняемые транзакцией 1.</span><span class="sxs-lookup"><span data-stu-id="55f3b-236">Write operations under transaction 2 do not affect read operations performed in transaction 1.</span></span>|  
|<span data-ttu-id="55f3b-237">Открыта для записи.</span><span class="sxs-lookup"><span data-stu-id="55f3b-237">Open for write.</span></span>|<span data-ttu-id="55f3b-238">Открыта для SELECT.</span><span class="sxs-lookup"><span data-stu-id="55f3b-238">open for SELECT.</span></span>|<span data-ttu-id="55f3b-239">Транзакция 2 блокируется, пока транзакция 1 не будет зафиксирована или завершена или пока не истечет время ожидания блокировки транзакции.</span><span class="sxs-lookup"><span data-stu-id="55f3b-239">Transaction 2 blocks until transaction 1 commits or ends the transaction, or the transaction lock times out.</span></span>|<span data-ttu-id="55f3b-240">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-240">Both succeed.</span></span>|  
|<span data-ttu-id="55f3b-241">Открыта для записи.</span><span class="sxs-lookup"><span data-stu-id="55f3b-241">Open for write.</span></span>|<span data-ttu-id="55f3b-242">Открыта для UPDATE или DELETE.</span><span class="sxs-lookup"><span data-stu-id="55f3b-242">Open for UPDATE or DELETE.</span></span>|<span data-ttu-id="55f3b-243">Транзакция 2 блокируется, пока транзакция 1 не будет зафиксирована или завершена или пока не истечет время ожидания блокировки транзакции.</span><span class="sxs-lookup"><span data-stu-id="55f3b-243">Transaction 2 blocks until transaction 1 commits or ends the transaction, or the transaction lock times out.</span></span>|<span data-ttu-id="55f3b-244">Транзакция 2 блокируется, пока транзакция 1 не будет зафиксирована или завершена или пока не истечет время ожидания блокировки транзакции.</span><span class="sxs-lookup"><span data-stu-id="55f3b-244">Transaction 2 blocks until transaction 1 commits or ends the transaction, or the transaction lock times out.</span></span>|  
|<span data-ttu-id="55f3b-245">Открыта для SELECT.</span><span class="sxs-lookup"><span data-stu-id="55f3b-245">Open for SELECT.</span></span>|<span data-ttu-id="55f3b-246">Открыта для чтения.</span><span class="sxs-lookup"><span data-stu-id="55f3b-246">Open for read.</span></span>|<span data-ttu-id="55f3b-247">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-247">Both succeed.</span></span>|<span data-ttu-id="55f3b-248">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-248">Both succeed.</span></span>|  
|<span data-ttu-id="55f3b-249">Открыта для SELECT.</span><span class="sxs-lookup"><span data-stu-id="55f3b-249">Open for SELECT.</span></span>|<span data-ttu-id="55f3b-250">Открыта для записи.</span><span class="sxs-lookup"><span data-stu-id="55f3b-250">Open for write.</span></span>|<span data-ttu-id="55f3b-251">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-251">Both succeed.</span></span> <span data-ttu-id="55f3b-252">Операции записи в рамках транзакции 2 не влияют на транзакцию 1.</span><span class="sxs-lookup"><span data-stu-id="55f3b-252">Write operations under transaction 2 do not affect transaction 1.</span></span>|<span data-ttu-id="55f3b-253">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-253">Both succeed.</span></span> <span data-ttu-id="55f3b-254">Операции записи в рамках транзакции 2 не влияют на транзакцию 1.</span><span class="sxs-lookup"><span data-stu-id="55f3b-254">Write operations under transaction 2 do not affect transaction 1.</span></span>|  
|<span data-ttu-id="55f3b-255">Открыта для UPDATE или DELETE.</span><span class="sxs-lookup"><span data-stu-id="55f3b-255">Open for UPDATE or DELETE.</span></span>|<span data-ttu-id="55f3b-256">Открыта для чтения.</span><span class="sxs-lookup"><span data-stu-id="55f3b-256">Open for read.</span></span>|<span data-ttu-id="55f3b-257">При открытии для транзакции 2 возникает ошибка с исключением ERROR_SHARING_VIOLATION.</span><span class="sxs-lookup"><span data-stu-id="55f3b-257">The open operation on transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|<span data-ttu-id="55f3b-258">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-258">Both succeed.</span></span>|  
|<span data-ttu-id="55f3b-259">Открыта для UPDATE или DELETE.</span><span class="sxs-lookup"><span data-stu-id="55f3b-259">Open for UPDATE or DELETE.</span></span>|<span data-ttu-id="55f3b-260">Открыта для записи.</span><span class="sxs-lookup"><span data-stu-id="55f3b-260">Open for write.</span></span>|<span data-ttu-id="55f3b-261">При открытии для транзакции 2 возникает ошибка с исключением ERROR_SHARING_VIOLATION.</span><span class="sxs-lookup"><span data-stu-id="55f3b-261">The open operation on transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|<span data-ttu-id="55f3b-262">При открытии для транзакции 2 возникает ошибка с исключением ERROR_SHARING_VIOLATION.</span><span class="sxs-lookup"><span data-stu-id="55f3b-262">The open operation on transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|  
|<span data-ttu-id="55f3b-263">Открыта для SELECT с повторяющимся чтением.</span><span class="sxs-lookup"><span data-stu-id="55f3b-263">Open for SELECT with repeatable read.</span></span>|<span data-ttu-id="55f3b-264">Открыта для чтения.</span><span class="sxs-lookup"><span data-stu-id="55f3b-264">Open for read.</span></span>|<span data-ttu-id="55f3b-265">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-265">Both succeed.</span></span>|<span data-ttu-id="55f3b-266">Обе завершаются успешно.</span><span class="sxs-lookup"><span data-stu-id="55f3b-266">Both succeed.</span></span>|  
|<span data-ttu-id="55f3b-267">Открыта для SELECT с повторяющимся чтением.</span><span class="sxs-lookup"><span data-stu-id="55f3b-267">Open for SELECT with repeatable read.</span></span>|<span data-ttu-id="55f3b-268">Открыта для записи.</span><span class="sxs-lookup"><span data-stu-id="55f3b-268">Open for write.</span></span>|<span data-ttu-id="55f3b-269">При открытии для транзакции 2 возникает ошибка с исключением ERROR_SHARING_VIOLATION.</span><span class="sxs-lookup"><span data-stu-id="55f3b-269">The open operation on transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|<span data-ttu-id="55f3b-270">При открытии для транзакции 2 возникает ошибка с исключением ERROR_SHARING_VIOLATION.</span><span class="sxs-lookup"><span data-stu-id="55f3b-270">The open operation on transaction 2 fails with an ERROR_SHARING_VIOLATION exception.</span></span>|  
  
 <span data-ttu-id="55f3b-271">**Сквозная запись от удаленных клиентов**</span><span class="sxs-lookup"><span data-stu-id="55f3b-271">**Write-Through from Remote Clients**</span></span>  
  
 <span data-ttu-id="55f3b-272">Удаленный доступ файловой системы к данным FILESTREAM осуществляется по протоколу SMB.</span><span class="sxs-lookup"><span data-stu-id="55f3b-272">Remote file system access to FILESTREAM data is enabled over the Server Message Block (SMB) protocol.</span></span> <span data-ttu-id="55f3b-273">Если клиент является удаленным, операции записи не кэшируются на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="55f3b-273">If the client is remote, no write operations are cached by the client side.</span></span> <span data-ttu-id="55f3b-274">Операции записи всегда отправляются на сервер.</span><span class="sxs-lookup"><span data-stu-id="55f3b-274">The write operations will always be sent to the server.</span></span> <span data-ttu-id="55f3b-275">Кэширование данных возможно на серверной стороне.</span><span class="sxs-lookup"><span data-stu-id="55f3b-275">The data can be cached on the server side.</span></span> <span data-ttu-id="55f3b-276">В приложениях, запущенных на удаленных клиентах, рекомендуется объединять небольшие операции записи, чтобы сократить число операций записи, используя данные большего размера.</span><span class="sxs-lookup"><span data-stu-id="55f3b-276">We recommend that applications that are running on remote clients consolidate small write operations to make fewer write operations using larger data size.</span></span>  
  
 <span data-ttu-id="55f3b-277">Создание представлений, отображенных в памяти (отображенных в памяти операций ввода-вывода), при помощи дескриптора FILESTREAM не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="55f3b-277">Creating memory mapped views (memory mapped I/O) by using a FILESTREAM handle is not supported.</span></span> <span data-ttu-id="55f3b-278">Если для данных FILESTREAM используется отображение в памяти, то компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] не может гарантировать согласованность и надежность данных или целостность базы данных.</span><span class="sxs-lookup"><span data-stu-id="55f3b-278">If memory mapping is used for FILESTREAM data, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] cannot guarantee consistency and durability of the data or the integrity of the database.</span></span>  
  
##  <a name="related-tasks"></a><a name="reltasks"></a> <span data-ttu-id="55f3b-279">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="55f3b-279">Related Tasks</span></span>  
 [<span data-ttu-id="55f3b-280">Включение и настройка FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="55f3b-280">Enable and Configure FILESTREAM</span></span>](enable-and-configure-filestream.md)  
  [<span data-ttu-id="55f3b-281">Создание базы данных с поддержкой FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="55f3b-281">Create a FILESTREAM-Enabled Database</span></span>](create-a-filestream-enabled-database.md)  
  [<span data-ttu-id="55f3b-282">Создание таблицы для хранения данных FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="55f3b-282">Create a Table for Storing FILESTREAM Data</span></span>](create-a-table-for-storing-filestream-data.md)  
  [<span data-ttu-id="55f3b-283">Доступ к данным FILESTREAM с помощью Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="55f3b-283">Access FILESTREAM Data with Transact-SQL</span></span>](access-filestream-data-with-transact-sql.md)  
  [<span data-ttu-id="55f3b-284">Создание клиентских приложений для данных FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="55f3b-284">Create Client Applications for FILESTREAM Data</span></span>](create-client-applications-for-filestream-data.md)  
  [<span data-ttu-id="55f3b-285">Доступ к данным FILESTREAM с OpenSqlFilestream</span><span class="sxs-lookup"><span data-stu-id="55f3b-285">Access FILESTREAM Data with OpenSqlFilestream</span></span>](access-filestream-data-with-opensqlfilestream.md)  
  [<span data-ttu-id="55f3b-286">Создание частичных обновлений данных FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="55f3b-286">Make Partial Updates to FILESTREAM Data</span></span>](make-partial-updates-to-filestream-data.md)  
  [<span data-ttu-id="55f3b-287">Избегание конфликтов в операциях баз данных в приложениях FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="55f3b-287">Avoid Conflicts with Database Operations in FILESTREAM Applications</span></span>](avoid-conflicts-with-database-operations-in-filestream-applications.md)  
  [<span data-ttu-id="55f3b-288">переместить базу данных с поддержкой FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="55f3b-288">Move a FILESTREAM-Enabled Database</span></span>](move-a-filestream-enabled-database.md)  
  [<span data-ttu-id="55f3b-289">Установка FILESTREAM в отказоустойчивом кластере</span><span class="sxs-lookup"><span data-stu-id="55f3b-289">Set Up FILESTREAM on a Failover Cluster</span></span>](set-up-filestream-on-a-failover-cluster.md)  
  [<span data-ttu-id="55f3b-290">Настройка брандмауэра для доступа к FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="55f3b-290">Configure a Firewall for FILESTREAM Access</span></span>](configure-a-firewall-for-filestream-access.md)  
  
##  <a name="related-content"></a><a name="relcontent"></a> <span data-ttu-id="55f3b-291">См. также</span><span class="sxs-lookup"><span data-stu-id="55f3b-291">Related Content</span></span>  
 [<span data-ttu-id="55f3b-292">Совместимость FILESTREAM с другими компонентами SQL Server</span><span class="sxs-lookup"><span data-stu-id="55f3b-292">FILESTREAM Compatibility with Other SQL Server Features</span></span>](filestream-compatibility-with-other-sql-server-features.md)  
  
