---
title: Доступ к таблицам FileTable с помощью API-интерфейсов ввода-вывода файлов | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: filestream
ms.topic: conceptual
helpviewer_keywords:
- FileTables [SQL Server], accessing files with file APIs
ms.assetid: fa504c5a-f131-4781-9a90-46e6c2de27bb
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 56118ef2db319abd270ff51259e3537864fdd57e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87736410"
---
# <a name="access-filetables-with-file-input-output-apis"></a>Доступ к таблицам FileTable с помощью API-интерфейсов ввода-вывода файлов
  Описание работы файловой системы ввода-вывода с таблицами FileTable.  
  
##  <a name="get-started-using-file-io-apis-with-filetables"></a><a name="accessing"></a> Начало использования API-интерфейсов файлового ввода-вывода с таблицами FileTable  
 Предполагается, что таблицы FileTable в первую очередь будут использоваться через файловую систему Windows и API-интерфейсы файлового ввода-вывода. Таблицы FileTable поддерживают нетранзакционный доступ с помощью широкого набора API-интерфейсов файлового ввода-вывода.  
  
1.  Доступ API-интерфейса файлового ввода-вывода обычно начинается с получения логического UNC-пути к файлу или каталогу. Для получения логического пути к файлу или каталогу приложения могут использовать инструкцию [!INCLUDE[tsql](../../includes/tsql-md.md)] с функцией [GetFileNamespacePath (Transact-SQL)](/sql/relational-databases/system-functions/getfilenamespacepath-transact-sql). Дополнительные сведения см. в статье [Work with Directories and Paths in FileTables](work-with-directories-and-paths-in-filetables.md).  
  
2.  Затем приложение использует этот логический путь для получения дескриптора файла или каталога и совершения каких-либо действий с объектом. Путь может быть передан какой-либо из поддерживаемых функций API файловой системы, например CreateFile() или CreateDirectory(), для создания или открытия файла и получения дескриптора. Затем дескриптор может использоваться для потоковой передачи данных, перечисления или упорядочивания каталогов, получения или задания атрибутов файлов, удаления файлов или каталогов и т. д.  
  
##  <a name="creating-files-and-directories-in-a-filetable"></a><a name="create"></a> Создание файлов и каталогов в таблице FileTable  
 Файл или каталог в таблице FileTable можно создать путем вызова таких API-интерфейсов файлового ввода-вывода, как CreateFile или CreateDirectory.  
  
-   Поддерживаются все флаги создания назначения, режимы совместного использования и режимы доступа. Поддерживаются создание, удаление и изменение файлов на месте. Также поддерживается обновление файловых пространств имен, например операции создания и удаления, переименования и перемещения каталогов.  
  
-   Создание нового файла или каталога соответствует созданию новой строки в базовой таблице FileTable.  
  
-   Для файлов потоковые данные хранятся в столбце **file_stream** , в то время как для каталогов этот столбец содержит значение null.  
  
-   Для файлов столбец **is_directory** содержит значение **false**. Для каталогов этот столбец содержит значение **true**.  
  
-   Совместный и одновременный доступ действуют, если несколько одновременных операций ввода-вывода или операций [!INCLUDE[tsql](../../includes/tsql-md.md)] обращаются к одному и тому же файлу или каталогу в иерархии.  
  
##  <a name="reading-files-and-directories-in-a-filetable"></a><a name="read"></a> Чтение файлов и каталогов в таблице FileTable  
 Для всех операций файлового ввода-вывода (для потоковых данных и данных атрибутов) уровень изоляции для данных в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] имеет значение READ COMMITTED.  
  
##  <a name="writing-and-updating-files-and-directories-in-a-filetable"></a><a name="write"></a> Запись и обновление файлов и каталогов в таблице FileTable  
  
-   Все операции записи и обновления файлового ввода-вывода в таблице FileTable являются нетранзакционными. Это значит, что к этим операциям не привязаны транзакции [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и не предоставляются никакие гарантии ACID.  
  
-   Для таблицы FileTable поддерживаются все потоковые обновления и обновления на месте при файловом вводе-выводе.  
  
-   При обновлении данных FILESTREAM или атрибутов с помощью API-интерфейсов файлового ввода-вывода обновляются соответствующие столбцы **file_stream** и столбцы атрибутов файлов в таблицах FileTable.  
  
##  <a name="deleting-files-and-directories-in-a-filetable"></a><a name="delete"></a> Удаление файлов и каталогов в таблице FileTable  
 При удалении файла или каталога применяется вся семантика API-интерфейсов файлового ввода-вывода Windows.  
  
-   При удалении каталога происходит сбой, если каталог содержит файлы и вложенные каталоги.  
  
-   При удалении файла или каталога удаляется соответствующая строка из таблицы FileTable. Это эквивалентно удалению этой строки с помощью операции [!INCLUDE[tsql](../../includes/tsql-md.md)] .  
  
##  <a name="supported-file-system-operations"></a><a name="supported"></a> Поддерживаемые операции файловой системы  
 Таблицы FileTable поддерживают API-интерфейсы файловой системы, связанные со следующими операциями файловой системы:  
  
-   Управление каталогом  
  
-   Управление файлами  
  
 Таблицы FileTable не поддерживают следующие операции:  
  
-   Управление дисками  
  
-   Управление томами  
  
-   Поддержка транзакций в NTFS  
  
##  <a name="additional-considerations-for-file-io-access-to-filetables"></a><a name="considerations"></a> Дополнительные соображения при доступе файлового ввода-вывода к таблицам FileTable  
  
###  <a name="using-virtual-network-names-vnns-with-alwayson-availability-groups"></a><a name="vnn"></a> Использование имен виртуальной сети для групп доступности AlwaysOn  
 Если база данных, содержащая данные FILESTREAM или FileTable, принадлежит к группе доступности AlwaysOn, то любой доступ к данным FILESTREAM или FileTable через API-интерфейсы файловой системы должен осуществляться по именам виртуальной сети, а не по именам компьютеров. Дополнительные сведения см. в разделе [FILESTREAM и FileTable с группами доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/filestream-and-filetable-with-always-on-availability-groups-sql-server.md).  
  
###  <a name="partial-updates"></a><a name="partial"></a> Частичные обновления  
 Доступный для записи дескриптор для данных FILESTREAM в таблице FileTable, полученный с помощью функции [GetFileNamespacePath (Transact-SQL)](/sql/relational-databases/system-functions/getfilenamespacepath-transact-sql), можно использовать для выполнения частичного обновления содержимого FILESTREAM на месте. Это отличается от транзакционного доступа к данным FILESTREAM с помощью дескриптора, полученного путем вызова **OpenSQLFILESTREAM()** и передачи явного контекста транзакции.  
  
###  <a name="transactional-semantics"></a><a name="trans"></a> Семантика транзакций  
 При доступе к файлам в таблице FileTable с помощью API-интерфейсов файлового ввода-вывода эти операции не связаны с какими-либо пользовательскими транзакциями и имеют следующие дополнительные характеристики.  
  
-   Поскольку нетранзакционный доступ к данным FILESTREAM в таблице FileTable не связан с какой-либо транзакцией, у него нет какой-либо особой семантики изоляции. Однако [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] может использовать внутренние транзакции для реализации семантики блокировок и параллелизма для данных FileTable. Любые внутренние транзакции данного типа осуществляется с изоляцией read-committed.  
  
-   Для таких нетранзакционных операций с данными FILESTREAM нет гарантий ACID. Гарантии согласованности сходны с таковыми при обновлении файлов, выполняемым приложениями в файловой системе.  
  
-   Эти изменения нельзя откатить.  
  
 Однако к столбцу FILESTREAM в таблице FileTable также можно получить транзакционный доступ FILESTREAM путем вызова **OpenSqlFileStream()** . Этот вид доступа может быть полностью транзакционным и будет поддерживать все уровни транзакционной согласованности, предлагаемые в настоящий момент.  
  
###  <a name="concurrency-control"></a><a name="concurrency"></a> Управление параллелизмом  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] обеспечивает управление параллелизмом при доступе к таблице FileTable со стороны приложений файловой системы, а также между приложениями файловой системы и приложениями [!INCLUDE[tsql](../../includes/tsql-md.md)] . Такое управление параллелизмом обеспечивается путем создания соответствующих блокировок для строк FileTable.  
  
###  <a name="triggers"></a><a name="triggers"></a> Триггеры  
 Создание, изменение и удаление файлов, каталогов или их атрибутов в файловой системе приведет к соответствующим операциям вставки, обновления и удаления в таблице FileTable. В рамках этих операций сработают все связанные триггеры DML [!INCLUDE[tsql](../../includes/tsql-md.md)] .  
  
##  <a name="file-system-functionality-supported-in-filetables"></a><a name="funclist"></a> Функции файловой системы, поддерживаемые в таблицах FileTable  
  
|Функция|Поддерживается|Комментарии|  
|----------------|---------------|--------------|  
|**Операционные блокировки**|Да|Поддерживаются операционные блокировки уровня 2, уровня 1, пакетные операционные блокировки и операционные блокировки фильтров.|  
|**Расширенные атрибуты**|Нет||  
|**Точки повторного синтаксического анализа**|Нет||  
|**Постоянные ACL**|Нет||  
|**Именованные потоки**|Нет||  
|**Разреженные файлы**|Да|Разреженность можно задавать только для файлов, она влияет на способ хранения потока данных. Поскольку данные FILESTREAM хранятся на томах NTFS, функции FileTable поддерживают разреженные файлы, перенаправляя запросы в файловую систему NTFS.|  
|**Сжатие**|Да||  
|**Шифрование**|Да||  
|**TxF**|Нет||  
|**Идентификаторы файлов**|Нет||  
|**Идентификаторы объектов**|Нет||  
|**Символические ссылки**|Нет||  
|**Жесткие связи**|Нет||  
|**Краткие имена**|Нет||  
|**Уведомления об изменении каталога**|Нет||  
|**Блокировка диапазона байтов**|Да|Запросы блокировки диапазона байтов передаются в файловую систему NTFS.|  
|**Файлы, отображенные в памяти**|Нет||  
|**Отмена ввода-вывода**|Да||  
|**Безопасность**|Нет|Принудительно применяются настройки безопасности уровня общего ресурса Windows и уровня таблицы или столбца [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .|  
|**Журнал USN**|Нет|Изменения метаданных для файлов и каталогов в таблице FileTable являются операциями DML в базе данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Поэтому они записываются в соответствующий файл журнала базы данных. Однако они не регистрируются в журнале USN файловой системы NTFS (за исключением изменения размера).<br /><br /> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .|  
  
## <a name="see-also"></a>См. также:  
 [выполнить загрузку файлов в таблицу FileTables](load-files-into-filetables.md)   
 [Work with Directories and Paths in FileTables](work-with-directories-and-paths-in-filetables.md)   
 [Доступ к таблицам FileTable с помощью Transact-SQL](access-filetables-with-transact-sql.md)   
 [Инструкции FileTable языка DDL, функции, хранимые процедуры и представления](../views/views.md)  
  
  
