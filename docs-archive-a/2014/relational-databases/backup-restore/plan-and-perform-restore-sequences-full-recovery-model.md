---
title: Планирование и выполнение последовательностей восстановления (модель полного восстановления) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- restore sequences [SQL Server], planning for
- full recovery model [SQL Server], planning restore sequences
ms.assetid: 9cbefaf8-d2b6-41c9-83fc-b3807a841fe2
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 85558c0a6361837b5645b9fc38ad040254265d72
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87666696"
---
# <a name="plan-and-perform-restore-sequences-full-recovery-model"></a><span data-ttu-id="df8ea-102">Планирование и выполнение последовательностей восстановления (модель полного восстановления)</span><span class="sxs-lookup"><span data-stu-id="df8ea-102">Plan and Perform Restore Sequences (Full Recovery Model)</span></span>
  <span data-ttu-id="df8ea-103">В этой теме приведены рекомендации по планированию и выполнению последовательности восстановления баз данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] согласно модели полного восстановления.</span><span class="sxs-lookup"><span data-stu-id="df8ea-103">This topic explains how to plan and perform a restore sequence for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases that ordinarily uses the full recovery model.</span></span> <span data-ttu-id="df8ea-104">*Последовательность восстановления* — это последовательность из одной или нескольких инструкций [RESTORE](/sql/t-sql/statements/restore-statements-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="df8ea-104">A *restore sequence* is a sequence of one or more [RESTORE](/sql/t-sql/statements/restore-statements-transact-sql) statements.</span></span> <span data-ttu-id="df8ea-105">Как правило, она инициализирует содержимое базы данных, файлы или страницы, производя последовательность восстановления (стадия копирования данных), выполняет накат записанных транзакций (стадия повтора) и откатывает нефиксированные транзакции (стадия отката).</span><span class="sxs-lookup"><span data-stu-id="df8ea-105">Typically, a restore sequences initializes the contents of the database, files, and/or pages being restored (the data-copy phase), rolls forward logged transactions (the redo phase), and rolls back uncommitted transactions (the undo phase).</span></span>  
  
 <span data-ttu-id="df8ea-106">В простых случаях для последовательности восстановления необходима только полная резервная копия базы данных, разностная резервная копия и последующие резервные копии журнала.</span><span class="sxs-lookup"><span data-stu-id="df8ea-106">In simple cases, a restore sequence requires only a full database backup, a differential database backup, and the subsequent log backups.</span></span> <span data-ttu-id="df8ea-107">В таких ситуациях выстроить правильную последовательность восстановления нетрудно.</span><span class="sxs-lookup"><span data-stu-id="df8ea-107">In these cases, constructing a correct restore sequence is easy.</span></span> <span data-ttu-id="df8ea-108">Например, чтобы восстановить всю базу данных до точки сбоя, начинают с резервного копирования журнала действующих транзакций ( *заключительного фрагмента журнала* ).</span><span class="sxs-lookup"><span data-stu-id="df8ea-108">For example, to restore a whole database to the point of a failure, start by backing up the active transaction log (the *tail* of the log).</span></span> <span data-ttu-id="df8ea-109">Затем восстанавливают последнюю полную резервную копию базы данных, последнюю разностную резервную копию базы данных (если она есть), а затем все последующие резервные копии журналов в порядке их выполнения.</span><span class="sxs-lookup"><span data-stu-id="df8ea-109">Then, restore the most recent full database backup, the most recent differential backup (if any), and all subsequent log backups in the order in which they were taken.</span></span>  
  
 <span data-ttu-id="df8ea-110">В более сложных случаях может оказаться совсем непросто определить правильную последовательность восстановления.</span><span class="sxs-lookup"><span data-stu-id="df8ea-110">In more complex cases, constructing a correct restore sequence can be a complex process.</span></span> <span data-ttu-id="df8ea-111">Например, для последовательности восстановления может потребоваться несколько резервных копий файла или восстановление данных до определенного момента времени.</span><span class="sxs-lookup"><span data-stu-id="df8ea-111">For example, a restore sequence might require multiple file backups or restoring data to a specific point in time.</span></span> <span data-ttu-id="df8ea-112">В самых сложных случаях может потребоваться обход разветвленного пути восстановления, образующего одну или несколько вилок восстановления.</span><span class="sxs-lookup"><span data-stu-id="df8ea-112">In very complex cases, you might even have to traverse a forked recovery path that spans one or more recovery forks.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="df8ea-113">Последовательность резервных копий данных и журналов, которая позволяет привести базу данных к состоянию на определенный момент времени, называется *путь восстановления* .</span><span class="sxs-lookup"><span data-stu-id="df8ea-113">A *recovery path* is the sequence of data and log backups that have brought a database to a particular point in time (known as a recovery point).</span></span> <span data-ttu-id="df8ea-114">Путь восстановления представляет собой определенный набор преобразований, отражающих развитие базы данных в течение времени и, в то же время, поддерживающих согласованность данных в ней.</span><span class="sxs-lookup"><span data-stu-id="df8ea-114">A recovery path is a specific set of transformations that have evolved the database over time, yet have maintained the consistency of the database.</span></span> <span data-ttu-id="df8ea-115">Путь восстановления описывает диапазон номеров LSN от точки запуска (LSN,GUID) до конечной точки (LSN,GUID).</span><span class="sxs-lookup"><span data-stu-id="df8ea-115">A recovery path describes a range of LSNs from a start point (LSN,GUID) to an end point (LSN,GUID).</span></span> <span data-ttu-id="df8ea-116">Диапазон номеров LSN в ветви восстановления может проходить по одной или более ветвям от начала до конца.</span><span class="sxs-lookup"><span data-stu-id="df8ea-116">The range of LSNs in a recovery path can traverse one or more recovery branches from start to end.</span></span>  
  
## <a name="to-plan-a-restore-sequence"></a><span data-ttu-id="df8ea-117">Планирование последовательности восстановления</span><span class="sxs-lookup"><span data-stu-id="df8ea-117">To Plan a Restore Sequence</span></span>  
 <span data-ttu-id="df8ea-118">Перед запуском последовательности восстановления выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="df8ea-118">Before you start a restore sequence, follow these steps:</span></span>  
  
1.  <span data-ttu-id="df8ea-119">По возможности создайте резервную копию заключительного фрагмента журнала базы данных.</span><span class="sxs-lookup"><span data-stu-id="df8ea-119">Create a tail-log backup of the database, if you can.</span></span> <span data-ttu-id="df8ea-120">Дополнительные сведения см. в статье [Резервные копии заключительного фрагмента журнала (SQL Server)](tail-log-backups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="df8ea-120">For more information, see [Tail-Log Backups &#40;SQL Server&#41;](tail-log-backups-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="df8ea-121">Определите целевую точку восстановления.</span><span class="sxs-lookup"><span data-stu-id="df8ea-121">Determine the target recovery point.</span></span>  
  
     <span data-ttu-id="df8ea-122">Целевая точка восстановления может быть любым моментом времени или меткой в пределах резервной копии журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="df8ea-122">The target recovery point can be any point in time or mark within a transaction log backup.</span></span> <span data-ttu-id="df8ea-123">Дополнительные сведения см. в статье [Восстановление базы данных SQL Server до определенного момента времени (модель полного восстановления)](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) или [Использование помеченных транзакций для согласованного восстановления связанных баз данных (модель полного восстановления)](use-marked-transactions-to-recover-related-databases-consistently.md).</span><span class="sxs-lookup"><span data-stu-id="df8ea-123">For more information, see [Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) or [Use Marked Transactions to Recover Related Databases Consistently &#40;Full Recovery Model&#41;](use-marked-transactions-to-recover-related-databases-consistently.md).</span></span>  
  
3.  <span data-ttu-id="df8ea-124">Определите тип выполняемого восстановления.</span><span class="sxs-lookup"><span data-stu-id="df8ea-124">Determine the type of restore you want to perform.</span></span> <span data-ttu-id="df8ea-125">Дополнительные сведения см. в статье [Обзор процессов восстановления (SQL Server)](restore-and-recovery-overview-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="df8ea-125">For more information, see [Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span></span>  
  
4.  <span data-ttu-id="df8ea-126">Определите, какие резервные копии необходимы, и убедитесь, что доступны необходимые наборы носителей и устройства резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="df8ea-126">Identify which backups you require and make sure that the necessary media sets and backup devices are available.</span></span> <span data-ttu-id="df8ea-127">Дополнительные сведения см. в статьях [Устройства резервного копирования (SQL Server)](backup-devices-sql-server.md) и [Наборы носителей, семейства носителей и резервные наборы данных Sets (SQL Server)](media-sets-media-families-and-backup-sets-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="df8ea-127">For more information, see [Backup Devices &#40;SQL Server&#41;](backup-devices-sql-server.md) and [Media Sets, Media Families, and Backup Sets &#40;SQL Server&#41;](media-sets-media-families-and-backup-sets-sql-server.md).</span></span>  
  
## <a name="to-perform-a-restore-sequence"></a><span data-ttu-id="df8ea-128">Выполнение последовательности восстановления</span><span class="sxs-lookup"><span data-stu-id="df8ea-128">To Perform a Restore Sequence</span></span>  
 <span data-ttu-id="df8ea-129">Выполнение последовательности восстановления.</span><span class="sxs-lookup"><span data-stu-id="df8ea-129">To perform a restore sequence, follow these steps:</span></span>  
  
1.  <span data-ttu-id="df8ea-130">Чтобы начать последовательность, восстановите одну или несколько резервных копий данных, например: резервную копию данных, частичную резервную копию, одну или несколько резервных копий файлов.</span><span class="sxs-lookup"><span data-stu-id="df8ea-130">To start the sequence, restore a one or more data backups, such as: a database backup, a partial backup, one or more file backups.</span></span>  
  
2.  <span data-ttu-id="df8ea-131">При необходимости можно восстановить последние разностные резервные копии, основанные на этих полных резервных копиях.</span><span class="sxs-lookup"><span data-stu-id="df8ea-131">Optionally, restore the latest differential backups that are based on these full backups.</span></span>  
  
     <span data-ttu-id="df8ea-132">Для каждой полной резервной копии, которую планируется восстановить, определите, является ли она основой для каких-либо разностных резервных копий.</span><span class="sxs-lookup"><span data-stu-id="df8ea-132">For each full backup that you plan to restore, determine whether it is the base for any differential backups.</span></span> <span data-ttu-id="df8ea-133">Если да, то по возможности восстановите самую последнюю разностную копию.</span><span class="sxs-lookup"><span data-stu-id="df8ea-133">If so, restore most recent differential backup, if you can.</span></span> <span data-ttu-id="df8ea-134">Дополнительные сведения см. в разделе [Разностные резервные копии (SQL Server)](differential-backups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="df8ea-134">For more information, see [Differential Backups &#40;SQL Server&#41;](differential-backups-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="df8ea-135">Произведите накат базы данных, по порядку восстановив резервные копии журналов, заканчивая резервной копией, содержащей точку восстановления.</span><span class="sxs-lookup"><span data-stu-id="df8ea-135">Roll forward the database by restoring log backups in sequence, finishing with the backup that contains the recovery point.</span></span> <span data-ttu-id="df8ea-136">Необходимость в применении всех резервных копий зависит от того, какая из них содержит целевую точку восстановления.</span><span class="sxs-lookup"><span data-stu-id="df8ea-136">Whether you have to apply all the log backups depends on what log backup contains the target recovery point, as follows:</span></span>  
  
    -   <span data-ttu-id="df8ea-137">Если точка восстановления совпадает с точкой сбоя, необходимо восстановить все резервные копии журнала, созданные с момента восстановления последней резервной копии данных (полной или разностной).</span><span class="sxs-lookup"><span data-stu-id="df8ea-137">If the recovery point is the point of a failure, you must restore every log backup that was created since the last data (full or differential) backup you restored.</span></span> <span data-ttu-id="df8ea-138">Дополнительные сведения см. в разделе [Применение резервных копий журналов транзакций (SQL Server)](transaction-log-backups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="df8ea-138">For more information, see [Apply Transaction Log Backups &#40;SQL Server&#41;](transaction-log-backups-sql-server.md).</span></span>  
  
    -   <span data-ttu-id="df8ea-139">Для восстановления на момент времени самые последние резервные копии журнала могут не потребоваться.</span><span class="sxs-lookup"><span data-stu-id="df8ea-139">For a point-in-time restore, you might not require the most recent log backups.</span></span> <span data-ttu-id="df8ea-140">Если используется [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], то помощник по восстановлению базы данных гарантирует, что будут выбраны только резервные копии, которые необходимо восстановить на указанный момент времени.</span><span class="sxs-lookup"><span data-stu-id="df8ea-140">If you use [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], the Database Recovery Advisor ensures that only backups that are required to restore to your specified point in time are selected.</span></span> <span data-ttu-id="df8ea-141">Эти резервные копии составляют рекомендованный план восстановления для данного восстановления на момент времени.</span><span class="sxs-lookup"><span data-stu-id="df8ea-141">These backups make up the recommended restore plan for your point-in-time restore.</span></span> <span data-ttu-id="df8ea-142">Дополнительные сведения см. в статье [Восстановление базы данных SQL Server до определенного момента времени (модель полного восстановления)](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md).</span><span class="sxs-lookup"><span data-stu-id="df8ea-142">For more information, see [Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md).</span></span>  
  
## <a name="restarting-a-restore-sequence"></a><span data-ttu-id="df8ea-143">Перезапуск последовательности восстановления</span><span class="sxs-lookup"><span data-stu-id="df8ea-143">Restarting a Restore Sequence</span></span>  
 <span data-ttu-id="df8ea-144">Столкнувшись с проблемой в ходе выполнения последовательности восстановления, можно выйти и перезапустить последовательность восстановления заново с самого начала.</span><span class="sxs-lookup"><span data-stu-id="df8ea-144">If you encounter a problem with the outcome of a restore sequence, you can quit it and restart the restore sequence over from the start.</span></span> <span data-ttu-id="df8ea-145">Например, если случайно было восстановлено слишком много резервных копий журнала и тем самым восстановление перешло запланированную точку восстановления, необходимо перезапустить последовательность восстановления и выполнить ее до резервной копии журнала, содержащей целевую точку восстановления.</span><span class="sxs-lookup"><span data-stu-id="df8ea-145">For example, if you accidentally restore too many log backups and overshoot the intended recovery point, you must restart the restore sequence up to log backup that contains the target recovery point.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="df8ea-146">См. также:</span><span class="sxs-lookup"><span data-stu-id="df8ea-146">See Also</span></span>  
 <span data-ttu-id="df8ea-147">[Общие сведения о резервном копировании (SQL Server)](backup-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="df8ea-147">[Backup Overview &#40;SQL Server&#41;](backup-overview-sql-server.md) </span></span>  
 <span data-ttu-id="df8ea-148">[Обзор процессов восстановления (SQL Server)](restore-and-recovery-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="df8ea-148">[Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span></span>  
 <span data-ttu-id="df8ea-149">[Выполнение полного восстановления базы данных (модель полного восстановления)](complete-database-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="df8ea-149">[Complete Database Restores &#40;Full Recovery Model&#41;](complete-database-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="df8ea-150">[Восстановление в сети (SQL Server)](online-restore-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="df8ea-150">[Online Restore &#40;SQL Server&#41;](online-restore-sql-server.md) </span></span>  
 <span data-ttu-id="df8ea-151">[Восстановления файлов (модель полного восстановления)](file-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="df8ea-151">[File Restores &#40;Full Recovery Model&#41;](file-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="df8ea-152">[Восстановление страниц (SQL Server)](restore-pages-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="df8ea-152">[Restore Pages &#40;SQL Server&#41;](restore-pages-sql-server.md) </span></span>  
 [<span data-ttu-id="df8ea-153">Поэтапное восстановление (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="df8ea-153">Piecemeal Restores &#40;SQL Server&#41;</span></span>](piecemeal-restores-sql-server.md)  
  
  
