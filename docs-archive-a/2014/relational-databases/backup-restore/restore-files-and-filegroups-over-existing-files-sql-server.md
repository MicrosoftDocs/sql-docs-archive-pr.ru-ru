---
title: Восстановление файлов и файловых групп поверх существующих файлов (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- restoring files [SQL Server], how-to topics
- restoring files [SQL Server], steps
- file restores [SQL Server], how-to topics
- filegroups [SQL Server], restoring
- restoring filegroups [SQL Server]
- overwriting filegroups
- overwriting files
ms.assetid: 517e07eb-9685-4b06-90af-b1cc496700b7
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: fc72ae3ae2472fe579755fa624e9af6953c7aed8
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87658837"
---
# <a name="restore-files-and-filegroups-over-existing-files-sql-server"></a>Восстановление файлов и файловых групп поверх существующих файлов (SQL Server)
  В этом разделе описывается восстановление файлов и файловых групп для существующих файлов в среде [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] с помощью [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../includes/tsql-md.md)].  
  
 **В этом разделе**  
  
-   **Перед началом работы**  
  
     [Ограничения](#Restrictions)  
  
     [Безопасность](#Security)  
  
-   **Восстановление файлов и файловых групп поверх существующих с помощью:**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> Ограничения  
  
-   Системный администратор, восстанавливающий файлы и файловые группы, должен быть единственным лицом, использующим восстанавливаемую базу данных в данный момент.  
  
-   Инструкция RESTORE недопустима в явной или неявной транзакции.  
  
-   Перед началом восстановления файлов по модели полного восстановления или модели восстановления с неполным протоколированием необходимо выполнить резервное копирование активного журнала транзакций (который называется заключительным фрагментом журнала). Дополнительные сведения см. в статье [Создание резервной копии журнала транзакций (SQL Server)](back-up-a-transaction-log-sql-server.md)).  
  
-   Чтобы восстановить зашифрованную базу данных, необходимо иметь доступ к сертификату или асимметричному ключу, который использовался для шифрования базы данных. Без сертификата или асимметричного ключа восстановить базу данных нельзя. Поэтому сертификат, используемый для шифрования ключа шифрования базы данных, должен храниться в течение всего времени, пока есть необходимость в резервной копии. Дополнительные сведения см. в статье [SQL Server Certificates and Asymmetric Keys](../security/sql-server-certificates-and-asymmetric-keys.md).  
  
###  <a name="security"></a><a name="Security"></a> безопасность  
  
####  <a name="permissions"></a><a name="Permissions"></a> Permissions  
 Если восстанавливаемая база данных не существуют, для выполнения инструкции RESTORE у пользователя должны быть разрешения CREATE DATABASE. Если база данных существует, разрешения на выполнение инструкции RESTORE по умолчанию предоставлены членам предопределенных ролей сервера **sysadmin** и **dbcreator** , а также владельцу базы данных (**dbo**) (для параметра FROM DATABASE_SNAPSHOT база данных всегда существует).  
  
 Разрешения на выполнение инструкции RESTORE даются ролям, в которых данные о членстве всегда доступны серверу. Так как членство в предопределенной роли базы данных может быть проверено только тогда, когда база данных доступна и не повреждена, что не всегда имеет место при выполнении инструкции RESTORE, члены предопределенной роли базы данных **db_owner** не имеют разрешений RESTORE.  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
  
#### <a name="to-restore-files-and-filegroups-over-existing-files"></a>Восстановление файлов и файловых групп поверх существующих файлов  
  
1.  В **обозревателе объектов**подключитесь к экземпляру компонента [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)], разверните его, а затем разверните узел **Базы данных**.  
  
2.  Щелкните правой кнопкой мыши нужную базу данных, наведите указатель на пункт **Задачи**, а затем выберите пункты **Восстановить**и **Файлы и файловые группы**.  
  
3.  На странице **Общие** в списке **В базу данных** введите имя восстанавливаемой базы данных. Можно ввести новую базу данных или выбрать уже существующую из раскрывающегося списка. Список включает все базы данных на сервере кроме системных баз данных **master** и **tempdb**.  
  
4.  Чтобы указать источник и расположение восстанавливаемых резервных наборов данных, выберите один из следующих вариантов.  
  
    -   **Из базы данных**  
  
         Введите имя базы данных в списке. Данный список содержит только базы данных, резервное копирование которых было выполнено в соответствии с журналом резервного копирования **msdb** .  
  
    -   **С устройства**  
  
         Нажмите кнопку обзора. В диалоговом окне **Указание устройств резервного копирования** выберите один из перечисленных типов устройств в списке **Тип носителя резервной копии** . Чтобы выбрать одно или несколько устройств в списке **Носитель резервной копии** , нажмите кнопку **Добавить**.  
  
         После добавления нужных устройств в списке **Носитель резервной копии** нажмите кнопку **ОК** для возвращения на страницу **Общие** .  
  
5.  В сетке **Выберите резервные наборы данных для восстановления** выберите нужные резервные наборы. В этой сетке отображаются резервные копии, доступные в указанном месте. По умолчанию предлагается план восстановления. Чтобы переопределить предложенный план восстановления, можно изменить выбранные элементы в сетке. Если выбор каких-то резервных копий отменяется, то автоматически отменяется и выбор зависящих от них резервных копий.  
  
    |Заголовок столбца|Значения|  
    |-----------------|------------|  
    |**Восстановление**|Установленные флажки обозначают резервные наборы данных, отмеченные для восстановления.|  
    |**имя**;|Имя резервного набора данных.|  
    |**Тип файла**|Задает тип данных в резервной копии: **Данные**, **Журнал** или **Данные Filestream**. Данные, содержащиеся в таблицах, хранятся в файлах типа **Данные** . Данные журнала транзакций хранятся в файлах типа **Журнал** . Данные больших двоичных объектов (BLOB), которые хранятся в файловой системе, находятся в файлах типа **Данные Filestream** .|  
    |**Тип**|Тип выполняемого резервного копирования: **Полное**, **Разностное**или **Журнал транзакций**.|  
    |**Server**|Имя экземпляра ядра СУБД, выполнившего операцию резервного копирования.|  
    |**Логическое имя файла**|Логическое имя файла.|  
    |**База данных**|Имя базы данных, участвовавшей в операции резервного копирования.|  
    |**Дата начала**|Дата и время начала операции резервного копирования, указанные в региональных настройках клиента.|  
    |**Дата завершения**|Дата и время завершения операции резервного копирования, указанные в формате, соответствующем региональным настройкам клиента.|  
    |**Размер**|Размер резервного набора данных в байтах.|  
    |**Имя пользователя**|Имя пользователя, выполнившего операцию резервного копирования.|  
  
6.  На панели **Выбор страницы** щелкните **Параметры** .  
  
7.  На панели **Параметры восстановления** выберите пункт **Перезаписать существующую базу данных (WITH REPLACE)** . Операция восстановления перезаписывает все существующие базы данных и связанные с ними файлы, даже если база данных или файл с указанным именем уже существуют.  
  
8.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> Использование Transact-SQL  
  
#### <a name="to-restore-files-and-filegroups-over-existing-files"></a>Восстановление файлов и файловых групп поверх существующих файлов  
  
1.  Выполните инструкцию RESTORE DATABASE для восстановления резервной копии файлов и файловых групп, указав следующее:  
  
    -   Имя базы данных для восстановления.  
  
    -   Устройство резервного копирования, откуда будет восстановлена полная резервная копия.  
  
    -   предложение FILE для каждого восстанавливаемого файла;  
  
    -   предложение FILEGROUP для каждой восстанавливаемой файловой группы;  
  
    -   параметр REPLACE для указания возможности восстановления каждого файла поверх существующих файлов, имеющих то же имя и место размещения;  
  
        > [!CAUTION]  
        >  Параметр REPLACE следует использовать с осторожностью. Дополнительные сведения см. в разделе .  
  
    -   Параметр NORECOVERY. (если файлы не изменялись со времени создания резервной копии, укажите предложение RECOVERY).  
  
2.  Если файлы были изменены после создания резервной копии, выполните инструкцию RESTORE LOG для применения резервной копии журнала транзакций, указав следующее:  
  
    -   Имя базы данных, к которой будет применен журнал транзакций.  
  
    -   Устройство резервного копирования, с которого будет восстановлена резервная копия журнала транзакций.  
  
    -   Предложение NORECOVERY, если существует другая резервная копия журналов транзакций для применения после текущего; в противном случае укажите предложение RECOVERY.  
  
         Резервные копии журналов транзакций, в случае их использования, должны включать в себя промежуток времени, в течение которого создавались резервные копии файлов и файловых групп.  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> Примеры (Transact-SQL)  
 В данном примере показано восстановление файлов и файловых групп для базы данных `MyNwind` и замена всех существующих файлов, имеющих то же имя. Два журнала транзакций также будут применены при восстановлении базы данных до текущего момента.  
  
```sql  
USE master;  
GO  
-- Restore the files and filesgroups for MyNwind.  
RESTORE DATABASE MyNwind  
   FILE = 'MyNwind_data_1',  
   FILEGROUP = 'new_customers',  
   FILE = 'MyNwind_data_2',  
   FILEGROUP = 'first_qtr_sales'  
   FROM MyNwind_1  
   WITH NORECOVERY,  
   REPLACE;  
GO  
-- Apply the first transaction log backup.  
RESTORE LOG MyNwind  
   FROM MyNwind_log1  
   WITH NORECOVERY;  
GO  
-- Apply the last transaction log backup.  
RESTORE LOG MyNwind  
   FROM MyNwind_log2  
   WITH RECOVERY;  
GO  
```  
  
## <a name="see-also"></a>См. также:  
 [Восстановление резервной копии базы данных &#40;SQL Server Management Studio&#41;](restore-a-database-backup-using-ssms.md)   
 [RESTORE (Transact-SQL)](/sql/t-sql/statements/restore-statements-transact-sql)   
 [Восстановление файлов и файловых групп (SQL Server)](restore-files-and-filegroups-sql-server.md)   
 [Копирование баз данных путем создания и восстановления резервных копий](../databases/copy-databases-with-backup-and-restore.md)  
  
  
