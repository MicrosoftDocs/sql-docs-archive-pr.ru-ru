---
title: Создание полной резервной копии базы данных (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- backing up databases [SQL Server], full backups
- backing up databases [SQL Server], SQL Server Management Studio
- backups [SQL Server], creating
- database backups [SQL Server], SQL Server Management Studio
ms.assetid: 586561fc-dfbb-4842-84f8-204a9100a534
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: f406464680a1669133dc87bdfb231c644d33fbdb
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87749995"
---
# <a name="create-a-full-database-backup-sql-server"></a>Создание полной резервной копии базы данных (SQL Server)
  В этом разделе описывается создание полной резервной копии базы данных в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] с помощью [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)]или PowerShell.  
  
> [!NOTE]  
>  Сведения о SQL Server резервного копирования в службу хранилища BLOB-объектов Azure см. в статье [SQL Server резервное копирование и восстановление с помощью службы хранилища BLOB-объектов Azure](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).  
  
 **В этом разделе**  
  
-   **Перед началом работы**  
  
     [Ограничения](#Restrictions)  
  
     [Рекомендации](#Recommendations)  
  
     [Безопасность](#Security)  
  
-   **Создание полной резервной копии базы данных с помощью:**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
     [PowerShell](#PowerShellProcedure)  
  
-   [Связанные задачи](#RelatedTasks)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> Ограничения  
  
-   Инструкция BACKUP не разрешена в явных и неявных транзакциях.  
  
-   Резервные копии, созданные более поздними версиями [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , не могут быть восстановлены в более ранних версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
-   Дополнительные сведения см. в разделе [Общие сведения о резервном копировании (SQL Server)](backup-overview-sql-server.md).  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> Рекомендации  
  
-   Однако по мере увеличения размера базы данных полное резервное копирование занимает больше времени и требует больше пространства для хранения. Поэтому для больших баз данных может потребоваться, кроме полных резервных копий, создавать также и *разностные резервные копии баз данных*. Дополнительные сведения см. в разделе [Разностные резервные копии (SQL Server)](differential-backups-sql-server.md).  
  
-   Размер полной резервной копии базы данных вы можете вычислить с помощью системной хранимой процедуры [sp_spaceused](/sql/relational-databases/system-stored-procedures/sp-spaceused-transact-sql) .  
  
-   По умолчанию каждая успешная операция резервного копирования добавляет запись в журнал ошибок служб [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и в журнал системных событий. Если создание резервной копии журналов производится очень часто, это приводит к быстрому накоплению сообщений об успешном завершении. Это приводит к увеличению журналов ошибок, затрудняя поиск других сообщений. Если работа существующих скриптов не зависит от этих записей, то их можно отключить с помощью флага трассировки 3226. Дополнительные сведения см. в разделе [Флаги трассировки (Transact-SQL)](/sql/t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql).  
  
###  <a name="security"></a><a name="Security"></a> безопасность  
 Для резервной копии базы данных свойству TRUSTWORTHY присваивается значение OFF. Дополнительные сведения о том, как задать для параметра TRUSTWORTHY значение ON, см. в разделе [Параметры ALTER DATABASE SET (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql-set-options).  
  
 Начиная с [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], параметры `PASSWORD` и `MEDIAPASSWORD` не поддерживаются при создании резервных копий. Все еще вы можете восстанавливать резервные копии, созданные с паролями.  
  
####  <a name="permissions"></a><a name="Permissions"></a> Permissions  
 Разрешения BACKUP DATABASE и BACKUP LOG назначены по умолчанию членам предопределенной роли сервера **sysadmin** и предопределенным ролям базы данных **db_owner** и **db_backupoperator** .  
  
 Проблемы, связанные с владельцем и разрешениями у физических файлов на устройстве резервного копирования, могут помешать операции резервного копирования. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должен иметь возможность считывать и записывать данные на устройстве; учетная запись, от имени которой выполняется служба [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , должна иметь разрешения на запись. Однако процедура [sp_addumpdevice](/sql/relational-databases/system-stored-procedures/sp-addumpdevice-transact-sql), добавляющая запись для устройства резервного копирования в системные таблицы, не проверяет разрешения на доступ к файлу. Проблемы физического файла устройства резервного копирования могут не проявляться до момента доступа к физическому ресурсу во время операции резервного копирования или восстановления.  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
  
> [!NOTE]  
>   При создании задания резервного копирования с помощью среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]вы можете сформировать соответствующий скрипт [!INCLUDE[tsql](../../includes/tsql-md.md)] [BACKUP](/sql/t-sql/statements/backup-transact-sql) , нажав кнопку **Скрипт** и выбрав назначение скрипта.  
  
#### <a name="to-back-up-a-database"></a>Создание резервной копии базы данных  
  
1.  После подключения к соответствующему экземпляру [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] в обозревателе объектов разверните дерево сервера, щелкнув его имя.  
  
2.  Раскройте узел **Базы данных**и в зависимости от типа восстанавливаемой базы данных выберите пользовательскую базу данных или раскройте узел **Системные базы данных** и выберите системную базу данных.  
  
3.  Щелкните правой кнопкой мыши базу данных, выберите пункт **Задачи**, а затем команду **Создать резервную копию**. Откроется диалоговое окно **Резервное копирование базы данных** .  
  
4.  В `Database` списке проверьте имя базы данных. При необходимости можно выбрать другую базу данных из списка.  
  
5.  Резервное копирование базы данных можно выполнять для любой модели восстановления (**FULL**, **BULK_LOGGED**или **SIMPLE**).  
  
6.  В списке **Тип резервной копии** выберите **Полная**.  
  
     Обратите внимание на то, что при создании полной резервной копии базы данных можно создавать разностные резервные копии; дополнительные сведения см. в разделе [Создание разностной резервной копии базы данных (SQL Server)](create-a-differential-database-backup-sql-server.md).  
  
7.  Также можно выбрать вариант **Резервная копия только для копирования** , чтобы создать резервную копию только для копирования. *Резервная копия только для копирования* — это резервная копия [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], которая не зависит от обычной последовательности создания традиционных резервных копий [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. в разделе [Резервные копии только для копирования (SQL Server)](copy-only-backups-sql-server.md).  
  
    > [!NOTE]  
    >  Если выбран параметр **Разностная** , то резервную копию только для копирования создать не удастся.  
  
8.  Для **компонента резервного копирования**щелкните `Database` .  
  
9. Оставьте имя резервного набора данных, предложенное по умолчанию в текстовом поле **Имя** , или введите другое имя резервного набора данных.  
  
10. При необходимости можно ввести описание резервного набора данных в текстовом поле **Описание** .  
  
11. Выберите тип назначения резервного копирования, щелкнув **Диск**, **Тип** или **URL**. Чтобы выбрать пути к 64 (или менее) дискам или накопителям на магнитной ленте, содержащим один набор носителей, нажмите кнопку **Добавить**. Выбранные пути отображаются в списке **Создать резервную копию в** .  
  
     Чтобы удалить носитель резервной копии, выберите его и нажмите кнопку **Удалить**. Чтобы просмотреть содержимое носителя резервной копии, выберите его и щелкните **Содержимое**.  
  
12. Для просмотра или выбора параметров носителя нажмите кнопку **Параметры носителя** на панели **Выбор страницы** .  
  
13. Выберите параметр **Переписать носитель** , указав один из следующих вариантов:  
  
    -   **Создать резервную копию в существующем наборе носителей**  
  
         Для этого параметра выберите вариант **Добавить в существующий резервный набор данных** или **Перезаписать все существующие резервные наборы данных**. Дополнительные сведения см. в разделах [Наборы носителей, семейства носителей и резервные наборы данных (SQL Server)](media-sets-media-families-and-backup-sets-sql-server.md).  
  
         При необходимости выберите **Проверить имя набора носителей и срок действия резервного набора данных** , чтобы при выполнении операции резервного копирования производилась проверка срока действия набора носителей и резервного набора данных.  
  
         При необходимости введите имя в текстовое поле **Имя набора носителей** . Если имя не указано, создается набор носителей с пустым именем. Если имя набора носителей указано, то для носителя (ленточного или дискового) проверяется совпадение введенного и существующего имени.  
  
        > [!IMPORTANT]  
        >  Этот параметр будет отключен, если в качества назначения резервного копирования на странице **Общее** выбран параметр **URL** . Дополнительные сведения см. в разделе [Резервное копирование базы данных (страница "Параметры носителя")](back-up-database-media-options-page.md).  
        >   
        >  Не выбирайте этот параметр, если планируете использовать шифрование. Если выбран данный вариант, параметры шифрования на странице **Параметры резервного копирования** будут отключены. При присоединении к существующему резервному набору данных шифрование не поддерживается.  
  
    -   **Создать резервную копию в новом наборе носителей и удалить все существующие резервные наборы данных**  
  
         Для этого параметра введите имя в текстовом поле **Имя нового набора носителей** и при необходимости введите описание набора носителей в текстовое поле **Описание нового набора носителей** .  
  
        > [!IMPORTANT]  
        >  Этот параметр будет отключен, если в качества назначения на странице **Общее** выбран вариант **URL** . Эти действия не поддерживаются при резервном копировании в службу хранилища Azure.  
  
14. В разделе **надежность** при необходимости установите флажок:  
  
    -   **Проверить резервную копию после завершения**.  
  
    -   **Рассчитать контрольную сумму перед записью на носитель**и, при необходимости, **Продолжить при ошибке контрольной суммы**. Дополнительные сведения см. в разделе [Возможные ошибки носителей во время резервного копирования и восстановления (SQL Server)](possible-media-errors-during-backup-and-restore-sql-server.md).  
  
15. При резервном копировании на накопитель на магнитной ленте (как указано в разделе **Назначение** страницы **Общие** ) активен параметр **Выгрузить ленту после резервного копирования** . Щелкните этот параметр, чтобы активировать параметр **Перемотать ленту перед выгрузкой** .  
  
    > [!NOTE]  
    >  Параметры в разделе **Журнал транзакций** доступны, только если создается резервная копия журнала транзакций (это можно указать в разделе **Тип резервной копии** вкладки **Общие** ).  
  
16. Для просмотра или выбора параметров резервного копирования нажмите кнопку **Параметры резервного копирования** на панели **Выбор страницы** .  
  
17. Укажите, когда закончится срок действия резервного набора данных и когда этот набор может быть перезаписан без явного пропуска проверки на истечение срока.  
  
    -   Чтобы задать срок действия резервного набора данных, выберите пункт **После** (параметр по умолчанию) и введите срок действия набора в днях с момента его создания. Это значение может быть задано в диапазоне от 0 до 99 999 дней. Значение 0 означает, что срок действия резервного набора данных не ограничен.  
  
         Значение по умолчанию задается в поле **Срок хранения носителей резервных копий по умолчанию (дней)** в диалоговом окне **Свойства сервера** (страница параметров базы данных). Чтобы получить доступ к этому параметру, щелкните правой кнопкой мыши имя сервера в обозревателе объектов и выберите пункт "Свойства", а затем выберите страницу **Настройки базы данных** .  
  
    -   Чтобы указать дату истечения срока действия резервного набора данных, выберите пункт **На**и введите дату истечения срока действия резервного набора данных.  
  
         Дополнительные сведения о дате истечения срока действия резервных копий см. в разделе [BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql).  
  
18. [!INCLUDE[ssEnterpriseEd10](../../../includes/ssenterpriseed10-md.md)] и более поздние версии поддерживают [сжатие резервных копий](backup-compression-sql-server.md). По умолчанию сжатие резервных копий зависит от значения параметра конфигурации сервера **backup-compression default** . Однако независимо от текущего значения по умолчанию на уровне сервера можно сжать резервные копии, установив параметр **Сжимать резервные копии**, или отказаться от сжатия резервных копий, установив параметр **Не сжимать резервные копии**.  
  
     **Просмотр и изменение текущих значений параметров по умолчанию для сжатия резервных копий**  
  
    -   [Параметр конфигурации сервера «Просмотр или настройка параметра сжатия резервных копий по умолчанию»](../../database-engine/configure-windows/view-or-configure-the-backup-compression-default-server-configuration-option.md)  
  
19. Укажите, следует ли использовать шифрование для резервных копий. Выберите алгоритм шифрования для шага шифрования и выберите сертификат или асимметричный ключ из списка существующих сертификатов или асимметричных ключей. Шифрование поддерживается в SQL Server 2014 и более поздних версиях. Дополнительные сведения об этом параметре шифрования см. в разделе [Резервное копирование базы данных (страница "Параметры резервного копирования")](back-up-database-backup-options-page.md).  
  
> [!NOTE]  
>  Также для создания резервных копий баз данных можно использовать мастер планов обслуживания базы данных.  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> Использование Transact-SQL  
  
#### <a name="to-create-a-full-database-backup"></a>Создание полной резервной копии базы данных  
  
1.  Выполните инструкцию BACKUP DATABASE для создания полной резервной копии базы данных, указав следующее:  
  
    -   имя базы данных для создания резервной копии;  
  
    -   устройство резервного копирования, на которое записывается полная резервная копия базы данных.  
  
     Базовая структура синтаксиса [!INCLUDE[tsql](../../includes/tsql-md.md)] для полного резервного копирования базы данных:  
  
     BACKUP DATABASE *database*  
  
     TO *backup_device* [ **,** ...*n* ]  
  
     [ WITH *with_options* [ **,** ...*o* ] ] ;  
  
    |Параметр|Описание|  
    |------------|-----------------|  
    |*database*|База данных для резервного копирования.|  
    |*backup_device* [ **,** ...*n* ]|Указывает список от 1 до 64 устройств резервного копирования, используемых для создания резервной копии. Можно указать как физическое устройство резервного копирования, так и соответствующее логическое устройство, если оно уже определено. Для указания физического устройства резервного копирования используйте параметр DISK или TAPE.<br /><br /> { DISK &#124; TAPE } **=** _имя_физического_устройства_резервного _копирования_<br /><br /> Дополнительные сведения см. в разделе [Устройства резервного копирования (SQL Server)](backup-devices-sql-server.md).|  
    |WITH *with_options* [ **,** ...*o* ]|При необходимости можно указать один или несколько дополнительных параметров, *o*. Сведения о некоторых основных параметрах см. в пункте 2.|  
  
2.  При необходимости укажите один или несколько параметров WITH. Здесь описываются некоторые основные параметры WITH. Сведения о всех параметрах WITH см. в разделе [BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql).  
  
    -   Основные параметры WITH резервного набора данных:  
  
         { COMPRESSION | NO_COMPRESSION }  
         Только в версии [!INCLUDE[ssEnterpriseEd10](../../../includes/ssenterpriseed10-md.md)] и выше указано, выполняется ли команда [backup compression](backup-compression-sql-server.md) для этой резервной копии, переопределяя значение по умолчанию на уровне сервера.  
  
         ШИФРОВАНИЕ (АЛГОРИТМ, СЕРТИФИКАТ СЕРВЕРА |АСИММЕТРИЧНЫЙ КЛЮЧ)  
         Только для SQL Server 2014 и выше укажите используемый алгоритм шифрования, а также сертификат или асимметричный ключ для шифрования.  
  
         Описание **=** { **" *`text`* "**  |  **@** _text_variable_ }  
         Задает произвольное текстовое описание резервного набора данных. В этой строке может содержаться до 255 символов.  
  
         Имя **=** { *backup_set_name*  |  **@** _backup_set_name_var_ }  
         Указывает имя резервного набора данных. Длина имени не может превышать 128 символов. Если параметр NAME не указан, то имя является пустым.  
  
    -   Основные параметры WITH резервного набора данных:  
  
         По умолчанию команда BACKUP добавляет резервную копию в существующий набор носителей, сохраняя существующие резервные наборы данных. Чтобы явно указать это, используйте параметр NOINIT. Сведения о присоединении к существующим резервным наборам данных см. в разделе [Наборы носителей, семейства носителей и резервные наборы данных (SQL Server)](media-sets-media-families-and-backup-sets-sql-server.md).  
  
         Чтобы отформатировать носитель резервной копии используется параметр FORMAT:  
  
         Format [ **,** MEDIANAME **=** { *media_name*  |  **@** _media_name_variable_ }] [ **,** MEDIADESCRIPTION **=** { *Text*  |  **@** _text_variable_ }]  
         Используйте предложение FORMAT при первом использовании носителя или при необходимости перезаписать существующие данные. При необходимости назначьте новому носителю имя и описание.  
  
        > [!IMPORTANT]  
        >  Будьте предельно осторожны, используя предложение FORMAT инструкции BACKUP, так как оно удаляет все резервные копии, сохраненные ранее на носителе резервных копий.  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> Примеры (Transact-SQL)  
  
#### <a name="a-backing-up-to-a-disk-device"></a>A. Резервное копирование на дисковое устройство  
 В следующем примере производится резервное копирование всей базы данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] на диск и создание нового набора носителей с помощью параметра `FORMAT` .  
  
```sql  
USE AdventureWorks2012;  
GO  
BACKUP DATABASE AdventureWorks2012  
TO DISK = 'Z:\SQLServerBackups\AdventureWorks2012.Bak'  
   WITH FORMAT,  
      MEDIANAME = 'Z_SQLServerBackups',  
      NAME = 'Full Backup of AdventureWorks2012';  
GO  
```  
  
#### <a name="b-backing-up-to-a-tape-device"></a>Б. Резервное копирование на ленточное устройство  
 В следующем примере создается полная резервная копия базы данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)]на ленте в дополнение к предыдущим резервными копиям.  
  
```sql  
USE AdventureWorks2012;  
GO  
BACKUP DATABASE AdventureWorks2012  
   TO TAPE = '\\.\Tape0'  
   WITH NOINIT,  
      NAME = 'Full Backup of AdventureWorks2012';  
GO  
```  
  
#### <a name="c-backing-up-to-a-logical-tape-device"></a>В. Резервное копирование на логическое ленточное устройство  
 В следующем примере создается логическое устройство резервного копирования для ленточного накопителя. Затем показано, как производится полное резервное копирование базы данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] на этот накопитель.  
  
```sql  
-- Create a logical backup device,   
-- AdventureWorks2012_Bak_Tape, for tape device \\.\tape0.  
USE master;  
GO  
EXEC sp_addumpdevice 'tape', 'AdventureWorks2012_Bak_Tape', '\\.\tape0'; USE AdventureWorks2012;  
GO  
BACKUP DATABASE AdventureWorks2012  
   TO AdventureWorks2012_Bak_Tape  
   WITH FORMAT,  
      MEDIANAME = 'AdventureWorks2012_Bak_Tape',  
      MEDIADESCRIPTION = '\\.\tape0',   
      NAME = 'Full Backup of AdventureWorks2012';  
GO  
```  
  
##  <a name="using-powershell"></a><a name="PowerShellProcedure"></a> Использование PowerShell  
  
1.  Используйте командлет `Backup-SqlDatabase`. Чтобы явно указать, что это полная резервная копия базы данных, укажите параметр **-BackupAction** со значением по умолчанию, `Database` . Данный параметр является необязательным для полных резервных копий баз данных.  
  
     В следующем примере создается полная резервная копия базы данных `MyDB` в заданном по умолчанию расположении резервного копирования на экземпляре сервера `Computer\Instance`. Дополнительно в этом примере указывается `-BackupAction Database`.  
  
    ```powershell
    Backup-SqlDatabase -ServerInstance Computer\Instance -Database MyDB -BackupAction Database  
    ```  
  
 **Настройка и использование поставщика SQL Server PowerShell**  
  
-   [Поставщик SQL Server PowerShell](../../powershell/sql-server-powershell-provider.md)  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> Связанные задачи  
  
-   [Резервное копирование базы данных (SQL Server)](create-a-full-database-backup-sql-server.md)  
  
-   [Создание разностной резервной копии базы данных (SQL Server)](create-a-differential-database-backup-sql-server.md)  
  
-   [Восстановление резервной копии базы данных &#40;SQL Server Management Studio&#41;](restore-a-database-backup-using-ssms.md)  
  
-   [Восстановление резервной копии базы данных в простой модели восстановления (Transact-SQL)](restore-a-database-backup-under-the-simple-recovery-model-transact-sql.md)  
  
-   [Восстановление базы данных до точки сбоя в модели полного восстановления (Transact-SQL)](restore-database-to-point-of-failure-full-recovery.md)  
  
-   [Восстановление базы данных в новом расположении (SQL Server)](restore-a-database-to-a-new-location-sql-server.md)  
  
-   [Использование мастера планов обслуживания](../maintenance-plans/use-the-maintenance-plan-wizard.md)  
  
## <a name="see-also"></a>См. также:  
 [Общие сведения о резервном копировании (SQL Server)](backup-overview-sql-server.md)   
 [Резервные копии журналов транзакций (SQL Server)](transaction-log-backups-sql-server.md)   
 [Наборы носителей, семейства носителей и резервные наборы данных (SQL Server)](media-sets-media-families-and-backup-sets-sql-server.md)   
 [sp_addumpdevice (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-addumpdevice-transact-sql)   
 [BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql)   
 [Резервное копирование базы данных (страница "Общие")](../../integration-services/general-page-of-integration-services-designers-options.md)   
 [Резервное копирование базы данных (страница "Параметры резервного копирования")](back-up-database-backup-options-page.md)   
 [Разностные резервные копии (SQL Server)](differential-backups-sql-server.md)   
 [Полные резервные копии баз данных (SQL Server)](full-database-backups-sql-server.md)  
