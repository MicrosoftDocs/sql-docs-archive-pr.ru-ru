---
title: Возможные ошибки носителей во время резервного копирования и восстановления (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- media errors [SQL Server]
- CONTINUE_AFTER_ERROR option
- errors [SQL Server], backups
- backups [SQL Server], errors
- RESTORE VERIFYONLY statement
- backup media [SQL Server], error management
- page checksums [SQL Server]
- backup checksums [SQL Server]
- backing up [SQL Server], media errors
- RESTORE statement, media errors
- NO_CHECKSUM option
- checksums [SQL Server]
ms.assetid: 83a27b29-1191-4f8d-9648-6e6be73a9b7c
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 15691c513aad6027be1063ef566ebdf245ebcc8c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87736443"
---
# <a name="possible-media-errors-during-backup-and-restore-sql-server"></a><span data-ttu-id="9de13-102">Возможные ошибки носителей во время резервного копирования и восстановления (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="9de13-102">Possible Media Errors During Backup and Restore (SQL Server)</span></span>
  [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] <span data-ttu-id="9de13-103">позволяет восстанавливать базу данных, несмотря на обнаруженные ошибки.</span><span class="sxs-lookup"><span data-stu-id="9de13-103">gives you the option of recovering a database despite detected errors.</span></span> <span data-ttu-id="9de13-104">Новый важный механизм обнаружения ошибок состоит в возможном создании контрольной суммы резервной копии, которую можно создать операцией резервного копирования и проверить операцией восстановления.</span><span class="sxs-lookup"><span data-stu-id="9de13-104">An important new error-detection mechanism is the optional creation of a backup checksum that can be created by a backup operation and validated by a restore operation.</span></span> <span data-ttu-id="9de13-105">Можно управлять тем, будет ли операция проверять наличие ошибок и будет ли она останавливаться или продолжаться при обнаружении ошибки.</span><span class="sxs-lookup"><span data-stu-id="9de13-105">You can control whether an operation checks for errors and whether the operation stops or continues on encountering an error.</span></span> <span data-ttu-id="9de13-106">Если резервная копия содержит контрольную сумму, инструкции RESTORE и RESTORE VERIFYONLY могут выполнять проверку на наличие ошибок.</span><span class="sxs-lookup"><span data-stu-id="9de13-106">If a backup contains a backup checksum, RESTORE and RESTORE VERIFYONLY statements can check for errors.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9de13-107">Зеркальные резервные копии могут содержать до четырех копий (зеркал) наборов носителей, предоставляя другие копии для исправления ошибок, вызванных повреждением носителей.</span><span class="sxs-lookup"><span data-stu-id="9de13-107">Mirrored backups provide up to four copies (mirrors) of a media set, providing alternative copies for recovering from errors caused by damaged media.</span></span> <span data-ttu-id="9de13-108">Дополнительные сведения см. в подразделе [Зеркальные наборы носителей резервных копий (SQL Server)](mirrored-backup-media-sets-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="9de13-108">For more information, see [Mirrored Backup Media Sets &#40;SQL Server&#41;](mirrored-backup-media-sets-sql-server.md).</span></span>  
  
  
  
##  <a name="backup-checksums"></a><a name="BckChecksums"></a> <span data-ttu-id="9de13-109">Контрольные суммы резервных копий</span><span class="sxs-lookup"><span data-stu-id="9de13-109">Backup Checksums</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="9de13-110">поддерживает три типа контрольных сумм: на страницах, в блоках журналов и резервных копиях.</span><span class="sxs-lookup"><span data-stu-id="9de13-110">supports three types of checksums: a checksum on pages, a checksum in log blocks, and a backup checksum.</span></span> <span data-ttu-id="9de13-111">При создании контрольной суммы резервной копии инструкция BACKUP проверяет согласованность данных, считанных из базы данных, со всеми контрольными суммами или признаками обрыва страниц в этой базе.</span><span class="sxs-lookup"><span data-stu-id="9de13-111">When generating a backup checksum, BACKUP verifies that the data read from the database is consistent with any checksum or torn-page indication that is present in the database.</span></span>  
  
 <span data-ttu-id="9de13-112">Инструкция BACKUP может также вычислять контрольную сумму резервной копии для потока резервирования. Если на данной странице есть контрольная сумма или данные о разрыве страниц, то при резервном копировании инструкция BACKUP также проверяет для страницы контрольную сумму, идентификатор и состояние разрыва страницы.</span><span class="sxs-lookup"><span data-stu-id="9de13-112">The BACKUP statement optionally computes a backup checksum on the backup stream; if page-checksum or torn-page information is present on a given page, when backing up the page, BACKUP also verifies the checksum and torn-page status and the page ID, of the page.</span></span> <span data-ttu-id="9de13-113">При создании контрольной суммы резервной копии операция резервного копирования не добавляет никаких контрольных сумм к страницам.</span><span class="sxs-lookup"><span data-stu-id="9de13-113">When creating a backup checksum, a backup operation does not add any checksums to pages.</span></span> <span data-ttu-id="9de13-114">Страницы копируются так, как они существуют в базе данных, они не изменяются операцией резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="9de13-114">Pages are backed up as they exist in the database, and the pages are unmodified by backup.</span></span>  
  
 <span data-ttu-id="9de13-115">Из-за дополнительной нагрузки при проверке и создании контрольных сумм резервных копий их использование может ухудшить производительность.</span><span class="sxs-lookup"><span data-stu-id="9de13-115">Due to the overhead verifying and generating backup checksums, using backup checksums poses a potential performance impact.</span></span> <span data-ttu-id="9de13-116">Может пострадать как рабочая нагрузка, так и пропускная способность резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="9de13-116">Both the workload and the backup throughput may be affected.</span></span> <span data-ttu-id="9de13-117">Поэтому использование контрольных сумм резервных копий необязательно.</span><span class="sxs-lookup"><span data-stu-id="9de13-117">Therefore, using backup checksums is optional.</span></span> <span data-ttu-id="9de13-118">При принятии решения о создании контрольных сумм резервных копий необходимо тщательно проконтролировать соответствующую дополнительную загрузку ЦП и влияние на остальную рабочую нагрузку системы.</span><span class="sxs-lookup"><span data-stu-id="9de13-118">When deciding to generate checksums during a backup, carefully monitor the CPU overhead incurred as well as the impact on any concurrent workload on the system.</span></span>  
  
 <span data-ttu-id="9de13-119">Инструкция BACKUP никогда не изменяет исходную страницу на диске и ее содержимое.</span><span class="sxs-lookup"><span data-stu-id="9de13-119">BACKUP never modifies the source page on disk nor the contents of a page.</span></span>  
  
 <span data-ttu-id="9de13-120">Если контрольные суммы резервных копий включены, операция резервного копирования выполняет следующие шаги:</span><span class="sxs-lookup"><span data-stu-id="9de13-120">When backup checksums are enabled, a backup operation performs the following steps:</span></span>  
  
1.  <span data-ttu-id="9de13-121">Перед записью страницы на резервный носитель операция резервного копирования проверяет сведения на уровне страницы (контрольную сумму или обнаружение разрыва страницы), если они имеются.</span><span class="sxs-lookup"><span data-stu-id="9de13-121">Before writing a page to the backup media, the backup operation verifies the page-level information (page checksum or torn page detection), if either exists.</span></span> <span data-ttu-id="9de13-122">Если они отсутствуют, операция резервного копирования не может проверить страницу.</span><span class="sxs-lookup"><span data-stu-id="9de13-122">If neither exists, backup cannot verify the page.</span></span> <span data-ttu-id="9de13-123">Непроверенные страницы включаются «как есть», а их содержимое добавляется в общую контрольную сумму резервной копии.</span><span class="sxs-lookup"><span data-stu-id="9de13-123">Unverified the pages are included as is, and their contents are added to the overall backup checksum.</span></span>  
  
     <span data-ttu-id="9de13-124">Если во время проверки операция резервного копирования обнаруживает ошибку страницы, резервное копирование прерывается с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="9de13-124">If the backup operation encounters a page error during verification, the backup fails.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="9de13-125">Дополнительные сведения о контрольной сумме страниц и обнаружении разрывов страниц см. в описании параметра PAGE_VERIFY инструкции ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="9de13-125">For more information about page checksums and torn page detection, see the PAGE_VERIFY option of the ALTER DATABASE statement.</span></span> <span data-ttu-id="9de13-126">Дополнительные сведения см. в разделе [Параметры ALTER DATABASE SET (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql-set-options).</span><span class="sxs-lookup"><span data-stu-id="9de13-126">For more information, see [ALTER DATABASE SET Options &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options).</span></span>  
  
2.  <span data-ttu-id="9de13-127">Независимо от того, присутствует ли контрольная сумма страницы или нет, инструкция BACKUP создает отдельные контрольные суммы резервных копий для потока резервных файлов.</span><span class="sxs-lookup"><span data-stu-id="9de13-127">Regardless of whether page checksums are present, BACKUP generates a separate backup checksum for the backup streams.</span></span> <span data-ttu-id="9de13-128">Дополнительно операции восстановления могут использовать контрольные суммы резервных копий для проверки наличия повреждений в резервных файлах.</span><span class="sxs-lookup"><span data-stu-id="9de13-128">Restore operations can optionally use the backup checksum to validate that the backup is not corrupted.</span></span> <span data-ttu-id="9de13-129">Контрольная сумма резервной копии хранится на носителе резервных файлов, а не на страницах базы данных.</span><span class="sxs-lookup"><span data-stu-id="9de13-129">The backup checksum is stored on the backup media, not on the database pages.</span></span> <span data-ttu-id="9de13-130">Контрольную сумму резервной копии также можно использовать во время восстановления.</span><span class="sxs-lookup"><span data-stu-id="9de13-130">The backup checksum can optionally be used at restore time.</span></span>  
  
3.  <span data-ttu-id="9de13-131">Резервный набор данных помечен как содержащий контрольные суммы резервных копий (в столбце **has_backup_checksums** таблицы **msdb..backupset**).</span><span class="sxs-lookup"><span data-stu-id="9de13-131">The backup set is flagged as containing backup checksums (in the **has_backup_checksums** column of **msdb..backupset)**.</span></span> <span data-ttu-id="9de13-132">Дополнительные сведения см. в разделе [backupset (Transact-SQL)](/sql/relational-databases/system-tables/backupset-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9de13-132">For more information, see [backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql).</span></span>  
  
 <span data-ttu-id="9de13-133">Во время операции восстановления, если на резервном носителе имеются контрольные суммы, по умолчанию и инструкция RESTORE, и инструкция RESTORE VERIFYONLY проверяют контрольные суммы резервных копий и страниц.</span><span class="sxs-lookup"><span data-stu-id="9de13-133">During a restore operation, if backup checksums are present on the backup media, by default, both the RESTORE and RESTORE VERIFYONLY statements verify the backup checksums and page checksums.</span></span> <span data-ttu-id="9de13-134">Если у резервной копии нет контрольной суммы, все операции восстановления продолжаются без проверок. Данное поведение объясняется тем, что без контрольной суммы резервной копии операция восстановления не может достоверно проверять контрольные суммы страниц.</span><span class="sxs-lookup"><span data-stu-id="9de13-134">If there is no backup checksum, either restore operation proceeds without any verification; this is because without a backup checksum, restore cannot reliably verify page checksums.</span></span>  
  
## <a name="response-to-page-checksum-errors-during-a-backup-or-restore-operation"></a><span data-ttu-id="9de13-135">Реакция на ошибки контрольной суммы страниц при операциях резервного копирования или восстановления</span><span class="sxs-lookup"><span data-stu-id="9de13-135">Response to Page Checksum Errors During a Backup or Restore Operation</span></span>  
 <span data-ttu-id="9de13-136">По умолчанию после обнаружения ошибки контрольной суммы страницы операция BACKUP или RESTORE прерывается, а операция RESTORE VERIFYONLY продолжает работу.</span><span class="sxs-lookup"><span data-stu-id="9de13-136">By default, after encountering a page checksum error, a BACKUP or RESTORE operation fails and a RESTORE VERIFYONLY operation continues.</span></span> <span data-ttu-id="9de13-137">Однако вы можете определить, будет ли та или иная операция прерываться при возникновении ошибки или пытаться продолжать работу.</span><span class="sxs-lookup"><span data-stu-id="9de13-137">However, you can control whether a given operation fails on encountering an error or continues as best it can.</span></span>  
  
 <span data-ttu-id="9de13-138">Если операция BACKUP продолжает работу при возникновении ошибок, она производит следующие действия:</span><span class="sxs-lookup"><span data-stu-id="9de13-138">If a BACKUP operation continues after encountering errors, the operation performs the following steps:</span></span>  
  
1.  <span data-ttu-id="9de13-139">Помечает резервный набор данных на резервном носителе как содержащий ошибки и отслеживает эту страницу в таблице **suspect_pages** в базе данных **msdb** .</span><span class="sxs-lookup"><span data-stu-id="9de13-139">Flags the backup set on the backup media as containing errors and tracks the page in the **suspect_pages** table in the **msdb** database.</span></span> <span data-ttu-id="9de13-140">Дополнительные сведения см. в разделе [suspect_pages (Transact-SQL)](/sql/relational-databases/system-tables/suspect-pages-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9de13-140">For more information, see [suspect_pages &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/suspect-pages-transact-sql).</span></span>  
  
2.  <span data-ttu-id="9de13-141">Записывает эту ошибку в журнал ошибок SQL Server.</span><span class="sxs-lookup"><span data-stu-id="9de13-141">Logs the error in the SQL Server error log.</span></span>  
  
3.  <span data-ttu-id="9de13-142">Помечает резервный набор данных как содержащий данный тип ошибок (в столбце **is_damaged** таблицы **msdb.backupset**).</span><span class="sxs-lookup"><span data-stu-id="9de13-142">Marks the backup set as containing this type of error (in the **is_damaged** column of **msdb.backupset)**.</span></span> <span data-ttu-id="9de13-143">Дополнительные сведения см. в разделе [backupset (Transact-SQL)](/sql/relational-databases/system-tables/backupset-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9de13-143">For more information, see [backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql).</span></span>  
  
4.  <span data-ttu-id="9de13-144">Выдает сообщение о том, что резервная копия успешно создана, но содержит ошибки страниц.</span><span class="sxs-lookup"><span data-stu-id="9de13-144">Issues a message that the backup was successfully generated, but contains page errors.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="9de13-145">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="9de13-145">Related Tasks</span></span>  
 <span data-ttu-id="9de13-146">**Включение или отключение контрольных сумм резервных копий**</span><span class="sxs-lookup"><span data-stu-id="9de13-146">**To enable or disable backup checksums**</span></span>  
  
-   [<span data-ttu-id="9de13-147">Включение или отключение вычисления контрольных сумм резервных копий во время резервного копирования или восстановления (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="9de13-147">Enable or Disable Backup Checksums During Backup or Restore &#40;SQL Server&#41;</span></span>](enable-or-disable-backup-checksums-during-backup-or-restore-sql-server.md)  
  
 <span data-ttu-id="9de13-148">**Управление реакцией на ошибку во время операции резервного копирования**</span><span class="sxs-lookup"><span data-stu-id="9de13-148">**To control the response to a error during a backup operation**</span></span>  
  
-   [<span data-ttu-id="9de13-149">Определение, продолжает ли операция резервного копирования или восстановления работу после возникновения ошибки (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="9de13-149">Specify Whether a Backup or Restore Operation Continues or Stops After Encountering an Error &#40;SQL Server&#41;</span></span>](specify-if-backup-or-restore-continues-or-stops-after-error.md)  
  
## <a name="see-also"></a><span data-ttu-id="9de13-150">См. также:</span><span class="sxs-lookup"><span data-stu-id="9de13-150">See Also</span></span>  
 <span data-ttu-id="9de13-151">[ALTER DATABASE (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="9de13-151">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span></span>  
 <span data-ttu-id="9de13-152">[BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="9de13-152">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 <span data-ttu-id="9de13-153">[backupset (Transact-SQL)](/sql/relational-databases/system-tables/backupset-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="9de13-153">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span></span>  
 <span data-ttu-id="9de13-154">[Зеркальные наборы носителей резервных копий (SQL Server)](mirrored-backup-media-sets-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="9de13-154">[Mirrored Backup Media Sets &#40;SQL Server&#41;](mirrored-backup-media-sets-sql-server.md) </span></span>  
 <span data-ttu-id="9de13-155">[RESTORE (Transact-SQL)](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="9de13-155">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 [<span data-ttu-id="9de13-156">RESTORE VERIFYONLY (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="9de13-156">RESTORE VERIFYONLY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-verifyonly-transact-sql)  
  
  
