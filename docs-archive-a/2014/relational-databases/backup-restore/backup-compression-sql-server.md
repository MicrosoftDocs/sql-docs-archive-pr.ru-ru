---
title: Сжатие резервных копий (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- log shipping [SQL Server], backup compression
- backup compression [SQL Server], about backup compression
- compression [SQL Server], backup compression
- backups [SQL Server], compression
- backing up [SQL Server], backup compression
- backup compression [SQL Server]
ms.assetid: 05bc9c4f-3947-4dd4-b823-db77519bd4d2
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 3291a858d8ef037e7cca92eb2e6abb19aec4da8e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655788"
---
# <a name="backup-compression-sql-server"></a>Сжатие резервных копий (SQL Server)
  В этом разделе описывается сжатие резервных копий [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , в том числе ограничения, влияние сжатия резервных копий на производительность, настройка конфигурации сжатия резервных копий и коэффициент сжатия.  
  
> [!NOTE]  
>  Сведения о том, какие выпуски [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] поддерживают сжатие резервных копий, см. [в разделе функции, поддерживаемые различными выпусками SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md). Сжатую резервную копию можно восстановить в любом выпуске [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] и более поздней версии.  
  
  
##  <a name="benefits"></a><a name="Benefits"></a> Преимущества  
  
-   Так как сжатая резервная копия занимает меньше места, чем распакованная резервная копия тех же данных, для сжатия резервной копии обычно требуется меньше операций ввода-вывода какого-либо устройства, что обычно существенно повышает скорость резервного копирования.  
  
     Дополнительные сведения см. ниже в подразделе [Воздействие сжатых резервных копий на производительность](#PerfImpact).  
  
  
##  <a name="restrictions"></a><a name="Restrictions"></a> Ограничения  
 К сжатым резервным копиям применяются следующие ограничения.  
  
-   В наборе носителей не допускается одновременное существование сжатых и несжатых резервных копий.  
  
-   В предыдущих версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] считывание сжатых резервных копий не поддерживается.  
  
-   Резервные копии NT не могут совместно использовать магнитные ленты со сжатыми резервными копиями [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
  
##  <a name="performance-impact-of-compressing-backups"></a><a name="PerfImpact"></a> Воздействие сжатых резервных копий на производительность  
 По умолчанию сжатие существенно повышает загрузку ЦП. Дополнительная нагрузка на ЦП может помешать выполнению других операций. Поэтому может потребоваться создать сжатые резервные копии с низким приоритетом в сеансе, для которого использование ЦП ограничивается[регулятором ресурсов](../resource-governor/resource-governor.md). Дополнительные сведения см. ниже в подразделе [Использование регулятора ресурсов для ограничения загрузки ЦП при сжатии резервной копии (Transact-SQL)](use-resource-governor-to-limit-cpu-usage-by-backup-compression-transact-sql.md).  
  
 В целях оптимизации производительности операций ввода-вывода резервной копии их можно изолировать от устройств или закрепить за устройствами в зависимости от оценки следующих видов счетчиков производительности.  
  
-   Счетчики производительности операций ввода-вывода Windows, такие как счетчики физического использования дисков.  
  
-   Счетчик **Пропускная способность устройства, байт/с** объекта [SQLServer:Backup Device](../performance-monitor/sql-server-backup-device-object.md)  
  
-   Счетчик **Пропускная способность резервного копирования и восстановления/с** объекта [SQLServer:Databases](../performance-monitor/sql-server-databases-object.md)  
  
 Сведения о счетчиках Windows см. в справке Windows. Сведения о работе со счетчиками SQL Server см. в разделе [Использование объектов SQL Server](../performance-monitor/use-sql-server-objects.md).  
  
  
##  <a name="calculate-the-compression-ratio-of-a-compressed-backup"></a><a name="CompressionRatio"></a> Вычисление коэффициента сжатия для сжатой резервной копии  
 Чтобы вычислить коэффициент сжатия резервной копии, используйте значения столбцов **backup_size** и **compressed_backup_size** из таблицы журнала [backupset](/sql/relational-databases/system-tables/backupset-transact-sql) для резервной копии следующим образом:  
  
 **backup_size**:**compressed_backup_size**  
  
 Например, коэффициент сжатия 3:1 обозначает, что экономится около 66% места на диске. Чтобы запросить эти столбцы, можно выполнить следующую инструкцию Transact-SQL:  
  
```  
SELECT backup_size/compressed_backup_size FROM msdb..backupset;  
```  
  
 Коэффициент сжатия уже сжатой резервной копии зависит от подвергаемых сжатию данных. На полученный коэффициент сжатия оказывают влияние различные факторы. К основным факторам относятся следующие.  
  
-   Тип данных.  
  
     Символьные данные можно сжать сильнее, чем другие типы данных.  
  
-   Согласованность данных в строках на странице.  
  
     Как правило, если несколько строк на странице содержат одно и то же значение в каком-либо поле, для этого значения можно добиться существенного сжатия. И наоборот, в базах данных, содержащих случайные значения или одну большую строку на странице, сжатые резервные копии будут практически такого же размера, что и несжатые резервные копии.  
  
-   Шифрование данных.  
  
     Зашифрованные данные подвергаются сжатию в значительно меньшей степени, чем незашифрованные. Если для шифрования всей базы данных используется прозрачное шифрование данных, сжатие резервных копий, возможно, ненамного снизит их размер, если снизит вообще.  
  
-   Сжатие базы данных.  
  
     Если база данных уже сжата, сжатие резервных копий может лишь незначительно сократить размер или не сократить его вообще.  
  
  
##  <a name="allocation-of-space-for-the-backup-file"></a><a name="Allocation"></a> Выделение пространства для файла резервной копии  
 При резервном копировании со сжатием конечный размер файла резервной копии зависит от степени сжимаемости исходных данных, которая становится известной только после окончания операции резервного копирования.  Вследствие этого изначальный размер файла резервной копии, создаваемого компонентом Database Engine при резервном копировании базы данных со сжатием, определяется с помощью алгоритма предварительного выделения. Согласно данному алгоритму, размер создаваемого файла резервной копии соответствует стандартному проценту от размера базы данных. Если для операции резервного копирования необходимо больше пространства, компонент Database Engine увеличивает размер файла. Если конечный размер меньше выделенного пространства, в конце операции резервного копирования компонент Database Engine сжимает файл до фактического конечного размера резервной копии.  
  
 Флаг трассировки 3042 позволяет создать файл резервной копии минимального размера, с последующим увеличением при необходимости до конечного размера. При использовании флага трассировки 3042 операция резервного копирования не задействует алгоритм предварительного выделения пространства для резервной копии со сжатием. Этот флаг трассировки полезен для экономии пространства, так как выделяется только фактическое пространство, необходимое для резервной копии со сжатием. Однако, при использовании данного флага трассировки возможно небольшое уменьшение производительности (увеличение продолжительности операции резервного копирования).  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> Связанные задачи  
  
-   [Настройка сжатия резервных копий (SQL Server)](backup-compression-sql-server.md)  
  
-   [Параметр конфигурации сервера «Просмотр или настройка параметра сжатия резервных копий по умолчанию»](../../database-engine/configure-windows/view-or-configure-the-backup-compression-default-server-configuration-option.md)  
  
-   [Использование регулятора ресурсов для ограничения загрузки ЦП при сжатии резервной копии (Transact-SQL)](use-resource-governor-to-limit-cpu-usage-by-backup-compression-transact-sql.md)  
  
-   [DBCC TRACEON (Transact-SQL)](/sql/t-sql/database-console-commands/dbcc-traceon-transact-sql)  
  
-   [DBCC TRACEOFF (Transact-SQL)](/sql/t-sql/database-console-commands/dbcc-traceoff-transact-sql)  
  
## <a name="see-also"></a>См. также:  
 [Общие сведения о резервном копировании (SQL Server)](backup-overview-sql-server.md)   
 [Флаги трассировки (Transact-SQL)](/sql/t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql)  
  
  
