---
title: Разностные резервные копии (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- differential backups
- differential backups, about
ms.assetid: 123bb7af-1367-4bde-bfcb-76d36799b905
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 5c057e0d41cb46adef0ec1e01c3406190db900e4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87667742"
---
# <a name="differential-backups-sql-server"></a><span data-ttu-id="24acf-102">Разностные резервные копии (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="24acf-102">Differential Backups (SQL Server)</span></span>
  <span data-ttu-id="24acf-103">В данной теме рассматривается резервное копирование и восстановление любых баз данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="24acf-103">This backup and restore topic is relevant for all [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases.</span></span>  
  
 <span data-ttu-id="24acf-104">Разностная резервная копия основывается на последней предшествующей полной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-104">A differential backup is based on the most recent, previous full data backup.</span></span> <span data-ttu-id="24acf-105">В разностной резервной копии сохраняются только те изменения, которые были произведены с момента создания последней полной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-105">A differential backup captures only the data that has changed since that full backup.</span></span> <span data-ttu-id="24acf-106">Полная резервная копия, на которой основано разностное резервное копирование, известна также как *основа* разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-106">The full backup upon which a differential backup is based is known as the *base* of the differential.</span></span> <span data-ttu-id="24acf-107">Полные резервные копии, за исключением резервных копий только для копирования, могут служить базой для последовательности разностных резервных копий, включая резервные копии баз данных, частичные резервные копии и резервные копии файлов.</span><span class="sxs-lookup"><span data-stu-id="24acf-107">Full backups, except for copy-only backups, can serve as the base for a series of differential backups, including database backups, partial backups, and file backups.</span></span> <span data-ttu-id="24acf-108">Базовая разностная резервная копия для файла может содержаться в полной резервной копии, в резервной копии файлов или частичной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-108">The base backup for a file differential backup can be contained within a full backup, a file backup, or a partial backup.</span></span>  
  
  
##  <a name="benefits"></a><a name="Benefits"></a> <span data-ttu-id="24acf-109">Преимущества</span><span class="sxs-lookup"><span data-stu-id="24acf-109">Benefits</span></span>  
  
-   <span data-ttu-id="24acf-110">Создание разностных резервных копий выполняется гораздо быстрее по сравнению с созданием полной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-110">Creating a differential backups can be very fast compared to creating a full backup.</span></span> <span data-ttu-id="24acf-111">Разностная резервная копия баз данных сохраняет только те данные, которые изменились по сравнению с полной резервной копией, которая служила основой для разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-111">A differential backup records only the data that has changed since the full backup upon the differential backup is based.</span></span> <span data-ttu-id="24acf-112">Это облегчает процесс частого создания резервных копий с целью снижения риска потери данных.</span><span class="sxs-lookup"><span data-stu-id="24acf-112">This facilitates taking frequent data backups, which decrease the risk of data loss.</span></span> <span data-ttu-id="24acf-113">Однако перед восстановлением разностной резервной копии необходимо восстановить ее основу.</span><span class="sxs-lookup"><span data-stu-id="24acf-113">However, before you restore a differential backup, you must restore its base.</span></span> <span data-ttu-id="24acf-114">Поэтому восстановление разностной резервной копии потребует большего количества шагов и времени по сравнению с восстановлением полной резервной копии, поскольку будут необходимы два файла резервных копий.</span><span class="sxs-lookup"><span data-stu-id="24acf-114">Therefore restoring from a differential backup will necessarily take more steps and time than restoring from a full backup because two backup files are required.</span></span>  
  
-   <span data-ttu-id="24acf-115">Разностные резервные копии базы данных особенно полезны в тех случаях, когда в базе данных имеется подмножество, которое изменяется значительно чаще всех остальных данных.</span><span class="sxs-lookup"><span data-stu-id="24acf-115">Differential database backups are especially useful if a subset of a database is modified more frequently than the rest of the database.</span></span> <span data-ttu-id="24acf-116">В этом случае разностная резервная копия позволит чаще производить резервное копирование, одновременно снижая издержки полного резервного копирования базы данных.</span><span class="sxs-lookup"><span data-stu-id="24acf-116">In these cases, differential database backups enable you back up frequently without the overhead of full database backups.</span></span>  
  
-   <span data-ttu-id="24acf-117">В рамках модели полного восстановления использование разностных резервных копий позволяет сократить число резервных копий журналов, которые требуется восстановить.</span><span class="sxs-lookup"><span data-stu-id="24acf-117">Under the full recovery model, using differential backups can reduce the number of log backups that you have to restore.</span></span>  
  
##  <a name="overview-of-differential-backups"></a><a name="Overview"></a> <span data-ttu-id="24acf-118">Общие сведения о разностных резервных копиях</span><span class="sxs-lookup"><span data-stu-id="24acf-118">Overview of Differential Backups</span></span>  
 <span data-ttu-id="24acf-119">Разностная резервная копия фиксирует состояние любого *экстента* (набора из 8 физически непрерывных страниц), который изменяется с момента создания базовой копии для разностного копирования до момента создания разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-119">A differential backup captures the state of any *extents* (collections of eight physically contiguous pages) that have changed between when the differential base was created and the when differential backup is created.</span></span> <span data-ttu-id="24acf-120">Это означает, что размер разностной резервной копии зависит от объема данных, которые изменились со времени создания основы.</span><span class="sxs-lookup"><span data-stu-id="24acf-120">This means that the size of a given differential backup depends on the amount of data that has changed since the base.</span></span> <span data-ttu-id="24acf-121">Как правило, чем старее базовая резервная копия, тем больше должна быть новая разностная резервная копия.</span><span class="sxs-lookup"><span data-stu-id="24acf-121">Generally, the older a base is, the larger a new differential backup will be.</span></span> <span data-ttu-id="24acf-122">В последовательности разностных резервных копий часто обновляемый экстент в каждой разностной копии файлов с высокой вероятностью может содержать различные данные.</span><span class="sxs-lookup"><span data-stu-id="24acf-122">In a series of differential backups, a frequently updated extent is likely to contain different data in each differential backup.</span></span>  
  
 <span data-ttu-id="24acf-123">На следующем рисунке показано, как работает разностное резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="24acf-123">The following illustration shows how a differential backup works.</span></span> <span data-ttu-id="24acf-124">В базе данных содержится 24 экстента данных, 6 из которых изменены.</span><span class="sxs-lookup"><span data-stu-id="24acf-124">The figure shows 24 data extents, 6 of which have changed.</span></span> <span data-ttu-id="24acf-125">Разностная резервная копия содержит только эти шесть экстентов данных.</span><span class="sxs-lookup"><span data-stu-id="24acf-125">The differential backup contains only these 6 data extents.</span></span> <span data-ttu-id="24acf-126">Разностное резервное копирование зависит от страницы битовой карты, которая содержит один бит для каждого экстента.</span><span class="sxs-lookup"><span data-stu-id="24acf-126">The differential backup operation relies on a bitmap page that contains a bit for every extent.</span></span> <span data-ttu-id="24acf-127">Для каждого экстента, обновленного с момента создания основы для разностной копии, в битовой карте биту присваивается значение 1.</span><span class="sxs-lookup"><span data-stu-id="24acf-127">For each extent updated since the base, the bit is set to 1 in the bitmap.</span></span>  
  
 <span data-ttu-id="24acf-128">![Битовая карта разностного резервного копирования определяет изменившиеся экстенты](../../database-engine/media/bnr-how-diff-backups-work.gif "Битовая карта разностного резервного копирования определяет изменившиеся экстенты")</span><span class="sxs-lookup"><span data-stu-id="24acf-128">![Differential bitmap identifies changed extents](../../database-engine/media/bnr-how-diff-backups-work.gif "Differential bitmap identifies changed extents")</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="24acf-129">Битовая карта разностного резервного копирования не обновляется при создании резервной копии только для копирования.</span><span class="sxs-lookup"><span data-stu-id="24acf-129">The differential bitmap is not updated by a copy-only backup.</span></span> <span data-ttu-id="24acf-130">Поэтому резервная копия только для копирования не оказывает никакого влияния на последующие разностные резервные копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-130">Therefore, a copy-only backup does not affect subsequent differential backups.</span></span>  
  
 <span data-ttu-id="24acf-131">Разностная резервная копия, создаваемая вскоре после своей основы, занимает значительно меньше места, чем базовая копия для разностного копирования.</span><span class="sxs-lookup"><span data-stu-id="24acf-131">A differential backup that is taken fairly soon after its base is usually significantly smaller than the differential base.</span></span> <span data-ttu-id="24acf-132">Это позволяет сэкономить место в хранилище и уменьшить время копирования.</span><span class="sxs-lookup"><span data-stu-id="24acf-132">This saves storage space and backup time.</span></span> <span data-ttu-id="24acf-133">Однако с течением времени по мере изменения базы данных различие между базой данных и базовой копией для разностного копирования увеличивается.</span><span class="sxs-lookup"><span data-stu-id="24acf-133">However, as a database changes over time, the difference between the database and a specific differential base increases.</span></span> <span data-ttu-id="24acf-134">Чем больше промежуток времени между созданием основы для разностной копии и разностной резервной копией, тем больше места, скорее всего, будет занимать разностная резервная копия.</span><span class="sxs-lookup"><span data-stu-id="24acf-134">The longer the time between a differential backup and its base, the larger the differential backup is likely to be.</span></span> <span data-ttu-id="24acf-135">Это означает, что в конце концов разностная резервная копия приблизится по размеру к своей базовой копии для разностного копирования.</span><span class="sxs-lookup"><span data-stu-id="24acf-135">This means that the differential backups can eventually approach the differential base in size.</span></span> <span data-ttu-id="24acf-136">Разностная резервная копия большого размера теряет все свои преимущества: быстроту работы и малый объем.</span><span class="sxs-lookup"><span data-stu-id="24acf-136">A large differential backup loses the advantages of a faster and smaller backup.</span></span>  
  
 <span data-ttu-id="24acf-137">Поскольку разностные резервные копии увеличиваются в размере, восстановление разностной резервной копии может значительно увеличить время, которое необходимо для восстановления базы данных.</span><span class="sxs-lookup"><span data-stu-id="24acf-137">As the differential backups increase in size, restoring a differential backup can significantly increase the time that is required to restore a database.</span></span> <span data-ttu-id="24acf-138">Поэтому рекомендуется через некоторое время выполнить создание новой полной резервной копии, чтобы получить новую базовую копию для разностного копирования.</span><span class="sxs-lookup"><span data-stu-id="24acf-138">Therefore, we recommend that you take a new full backup at set intervals to establish a new differential base for the data.</span></span> <span data-ttu-id="24acf-139">Например, можно выполнять полное резервное копирование всей базы данных один раз в неделю, а затем в течение недели регулярно создавать разностные резервные копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-139">For example, you might take a weekly full backup of the whole database (that is, a full database backup) followed by a regular series of differential database backups during the week.</span></span>  
  
 <span data-ttu-id="24acf-140">Прежде чем начать восстановление из разностной резервной копии, необходимо восстановить основу.</span><span class="sxs-lookup"><span data-stu-id="24acf-140">At restore time, before you restore a differential backup, you must restore its base.</span></span> <span data-ttu-id="24acf-141">Затем восстанавливается только самая последняя разностная копия, чтобы привести базу данных ко времени создания разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-141">Then, restore only the most recent differential backup to bring the database forward to the time when that differential backup was created.</span></span> <span data-ttu-id="24acf-142">Обычно восстанавливается последняя полная резервная копия, а затем последняя разностная резервная копия, которая на ней основана.</span><span class="sxs-lookup"><span data-stu-id="24acf-142">Typically, you would restore the most recent full backup followed by the most recent differential backup that is based on that full backup.</span></span>  
  
## <a name="differential-backups-of-databases-with-memory-optimized-tables"></a><span data-ttu-id="24acf-143">Разностные резервные копии баз данных с таблицами, оптимизированными для памяти</span><span class="sxs-lookup"><span data-stu-id="24acf-143">Differential Backups of Databases with Memory-Optimized Tables</span></span>  
 <span data-ttu-id="24acf-144">Сведения о разностных резервных копиях и базах данных с оптимизированными для памяти таблицами см. в статье [Резервное копирование базы данных с оптимизированными для памяти таблицами](../in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="24acf-144">For information about differential backups and databases with memory-optimized tables, see [Backing Up a Database with Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
##  <a name="differential-backups-of-read-only-databases"></a><a name="ReadOnlyDbs"></a> <span data-ttu-id="24acf-145">Разностное резервное копирование баз данных только для чтения</span><span class="sxs-lookup"><span data-stu-id="24acf-145">Differential Backups of Read-Only Databases</span></span>  
 <span data-ttu-id="24acf-146">В базах данных только для чтения использование полной резервной копии базы данных самой по себе проще, чем ее использование вместе с разностными резервными копиями.</span><span class="sxs-lookup"><span data-stu-id="24acf-146">For read-only databases, full backups used alone are easier to manage than when they are used with differential backups.</span></span> <span data-ttu-id="24acf-147">Это объясняется тем, что если база данных находится в режиме «только для чтения», то резервное копирование и прочие операции не в состоянии изменить содержащиеся в файле метаданные.</span><span class="sxs-lookup"><span data-stu-id="24acf-147">When a database is read-only, backup and other operations cannot change the metadata that is contained in the file.</span></span> <span data-ttu-id="24acf-148">Следовательно, необходимые для разностной резервной копии метаданные (в частности, номер LSN, с которого начинается разностное резервное копирование — номер LSN базовой копии для разностного копирования) хранятся в базе данных **master** .</span><span class="sxs-lookup"><span data-stu-id="24acf-148">Therefore, metadata that is required by a differential backup, such as the log sequence number at which the differential backup begins (the differential base LSN) is stored in the **master** database.</span></span> <span data-ttu-id="24acf-149">Если базовая копия для разностного копирования создавалась в тот момент, когда база данных была доступна только для чтения, то битовая карта разностного резервного копирования будет отображать большее число изменений, чем в действительности произошло с момента создания основы резервной копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-149">If the differential base is taken when the database is read-only, the differential bitmap indicates more changes than have actually occurred since the base backup.</span></span> <span data-ttu-id="24acf-150">Дополнительные данные считываются при резервном копировании, но не записываются в резервную копию, так как столбец **differential_base_lsn** в системной таблице [backupset](/sql/relational-databases/system-tables/backupset-transact-sql) определяет, какие данные действительно были изменены с момента создания базы.</span><span class="sxs-lookup"><span data-stu-id="24acf-150">The extra data is read by backup, but is not written to the backup, because the **differential_base_lsn** stored in the [backupset](/sql/relational-databases/system-tables/backupset-transact-sql) system table is used to determine whether the data has actually changed since the base.</span></span>  
  
 <span data-ttu-id="24acf-151">Если база данных, доступная только для чтения, перестраивается, восстанавливается или отсоединяется, а затем снова присоединяется, то теряются все данные основы для разностной резервной копии.</span><span class="sxs-lookup"><span data-stu-id="24acf-151">When a read-only database is rebuilt, restored, or detached and attached, the differential-base information is lost.</span></span> <span data-ttu-id="24acf-152">Это происходит потому, что база данных **master** не синхронизована с базой данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="24acf-152">This occurs because the **master** database is not synchronized with the user database.</span></span> <span data-ttu-id="24acf-153">Компонент [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] не может ни обнаружить, ни предотвратить возникновение этой проблемы.</span><span class="sxs-lookup"><span data-stu-id="24acf-153">The [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] cannot detect or prevent this problem.</span></span> <span data-ttu-id="24acf-154">Все более поздние разностные резервные копии не будут основаны на последней полной резервной копии, что может привести к непредсказуемым результатам.</span><span class="sxs-lookup"><span data-stu-id="24acf-154">Any later differential backups are not based on the most recent full backup and could provide unexpected results.</span></span> <span data-ttu-id="24acf-155">Чтобы установить новую базовую копию для разностного копирования, рекомендуется создать полную резервную копию базы данных.</span><span class="sxs-lookup"><span data-stu-id="24acf-155">To establish a new differential base, we recommend that you create a full database backup.</span></span>  
  
### <a name="best-practices-for-using-differential-backups-with-a-read-only-database"></a><span data-ttu-id="24acf-156">Рекомендации по использованию разностного резервного копирования с базами данных только для чтения</span><span class="sxs-lookup"><span data-stu-id="24acf-156">Best Practices for Using Differential Backups with a Read-Only Database</span></span>  
 <span data-ttu-id="24acf-157">Если после создания полной резервной копии базы данных, доступной только для чтения, планируется последующее разностное резервное копирование, создайте резервную копию базы данных **master** .</span><span class="sxs-lookup"><span data-stu-id="24acf-157">After you create a full database backup of a read-only database, if you intend to create a subsequent differential backup, back up the **master** database.</span></span>  
  
 <span data-ttu-id="24acf-158">Если база данных **master** утрачена, восстановите ее перед восстановлением любой разностной резервной копии пользовательской базы данных.</span><span class="sxs-lookup"><span data-stu-id="24acf-158">If the **master** database is lost, restore it before you restore any differential backup of a user database.</span></span>  
  
 <span data-ttu-id="24acf-159">При отключении и подключении базы данных только для чтения, для которой в дальнейшем планируется создавать разностные резервные копии, как можно скорее создайте полную резервную копию самой базы данных и базы данных **master** .</span><span class="sxs-lookup"><span data-stu-id="24acf-159">If you detach and attach a read-only database for which you plan to later use differential backups, as soon as it is practical, take a full database backup of both the read-only database and of the **master** database.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="24acf-160">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="24acf-160">Related Tasks</span></span>  
  
-   [<span data-ttu-id="24acf-161">Создание разностной резервной копии базы данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="24acf-161">Create a Differential Database Backup &#40;SQL Server&#41;</span></span>](create-a-differential-database-backup-sql-server.md)  
  
-   [<span data-ttu-id="24acf-162">Восстановление разностной резервной копии базы данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="24acf-162">Restore a Differential Database Backup &#40;SQL Server&#41;</span></span>](restore-a-differential-database-backup-sql-server.md)  
  
  
## <a name="see-also"></a><span data-ttu-id="24acf-163">См. также:</span><span class="sxs-lookup"><span data-stu-id="24acf-163">See Also</span></span>  
 <span data-ttu-id="24acf-164">[Общие сведения о резервном копировании (SQL Server)](backup-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="24acf-164">[Backup Overview &#40;SQL Server&#41;](backup-overview-sql-server.md) </span></span>  
 <span data-ttu-id="24acf-165">[Полные резервные копии баз данных (SQL Server)](full-database-backups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="24acf-165">[Full Database Backups &#40;SQL Server&#41;](full-database-backups-sql-server.md) </span></span>  
 <span data-ttu-id="24acf-166">[Выполнение полного восстановления базы данных (модель полного восстановления)](complete-database-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="24acf-166">[Complete Database Restores &#40;Full Recovery Model&#41;](complete-database-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="24acf-167">[Выполнение полного восстановления базы данных (простая модель восстановления)](complete-database-restores-simple-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="24acf-167">[Complete Database Restores &#40;Simple Recovery Model&#41;](complete-database-restores-simple-recovery-model.md) </span></span>  
 [<span data-ttu-id="24acf-168">Резервные копии журналов транзакций (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="24acf-168">Transaction Log Backups &#40;SQL Server&#41;</span></span>](transaction-log-backups-sql-server.md)  
  
  
