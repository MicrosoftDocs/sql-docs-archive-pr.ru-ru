---
title: Резервное копирование и восстановление баз данных SQL Server | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- disaster recovery [SQL Server], see restoring [SQL Server]
- backups [SQL Server]
- restoring databases [SQL Server]
- backup [SQL Server], see backing up [SQL Server]
- databases [SQL Server], restoring
- backing up databases [SQL Server]
- restore [SQL Server], see restoring [SQL Server]
- disaster recovery [SQL Server], see backing up [SQL Server]
- backing up [SQL Server]
- Database Engine [SQL Server], backups
- databases [SQL Server], backups
ms.assetid: 570a21b3-ad29-44a9-aa70-deb2fbd34f27
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: ec2104219d98ed3cb97bfbb8993a3c28d45841c6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87668955"
---
# <a name="back-up-and-restore-of-sql-server-databases"></a>Резервное копирование и восстановление баз данных SQL Server
  В этом разделе описываются преимущества резервного копирования баз данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , основные условия резервного копирования и восстановления, а также приводятся стратегии резервного копирования и восстановления для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и рассматриваются вопросы безопасности, связанные с резервным копированием и восстановлением в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
 Компонент резервного копирования и восстановления [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] обеспечивает необходимую защиту важных данных, которые хранятся в базах данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Чтобы свести к минимуму риск необратимой потери данных, необходимо создавать резервные копии баз данных для сохранения вносимых изменений на регулярной основе. Хорошо спланированная стратегия резервного копирования и восстановления защищает базы от потери данных, вызванной разными сбоями. Протестируйте стратегию, выполнив восстановление набора резервных копий и вернув в исходное состояние базу данных. Так вы будете готовы эффективно реагировать на проблемы.  
  
 В дополнение к локальному хранилищу для хранения резервных копий SQL Server поддерживает резервное копирование и восстановление из службы хранилища BLOB-объектов Azure. Дополнительные сведения см. в статье [Резервное копирование и восстановление SQL Server с помощью службы хранилищ больших двоичных объектов Windows Azure](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).  
  

  
##  <a name="benefits"></a><a name="Benefits"></a> Преимущества  
  
-   Создание резервных копий баз данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , выполнение проверочных процедур восстановления резервных копий и хранение резервных копий в безопасном месте вне рабочей площадки помогают предотвратить возможную необратимую потерю данных.  
  
    > [!IMPORTANT]  
    >  Это единственный способ надежно защитить данные в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
     При правильном создании резервных копий баз данных можно будет восстановить данные после многих видов сбоев, включая следующие:  
  
    -   сбой носителя;  
  
    -   ошибки пользователей (например, удаление таблицы по ошибке);  
  
    -   сбои оборудования (например, поврежденный дисковый накопитель или безвозвратная потеря данных на сервере);  
  
    -   стихийные бедствия. При выполнении резервного копирования SQL Server в службу хранилища BLOB-объектов Azure можно создать резервную копию в регионе, отличном от региона своего фактического локального расположения, на случай возникновения природных катастроф в своем регионе.  
  
-   Кроме того, резервные копии баз данных полезны и при выполнении повседневных административных задач, например для копирования баз данных с одного сервера на другой, настройки [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] или зеркального отображения баз данных и архивирования.  
  

  
##  <a name="components-and-concepts"></a><a name="TermsAndDefinitions"></a> Компоненты и основные понятия  
 создание резервных копий  
 Копирование данных или записей журнала из базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или журнала ее транзакций на устройство для резервного копирования, например на диск, на котором создается резервная копия данных или журнала.  
  
 резервная копия  
 Копия данных, которая может использоваться для восстановления данных в случае возникновения ошибки. Резервные копии баз данных также могут использоваться для восстановления копии базы данных в новом расположении.  
  
 устройство резервного копирования  
 Диск или ленточное устройство, на которые записываются резервные копии SQL Server для последующего восстановления. Резервные копии SQL Server можно также записать в службу хранилища BLOB-объектов Azure, а формат **URL-адреса** используется, чтобы указать назначение и имя файла резервной копии. Дополнительные сведения см. в статье [Резервное копирование и восстановление SQL Server с помощью службы хранилищ больших двоичных объектов Windows Azure](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).  
  
 носитель данных резервной копии  
 Один или несколько наборов дисков или ленточных устройств, на которые записывается резервная копия.  
  
 резервное копирование данных  
 Резервная копия данных всей базы данных (резервная копия базы данных), части базы данных (частичная резервная копия) или набора файлов данных или файловых групп (резервная копия файлов).  
  
 резервное копирование базы данных  
 Резервная копия базы данных. Полные резервные копии базы данных отображают состояние всей базы данных на момент завершения резервного копирования. Разностные резервные копии базы данных содержат только изменения базы данных с момента последнего полного резервного копирования.  
  
 разностная резервная копия  
 Резервная копия данных, основанная на последней полной или частичной резервной копии базы данных или набора файлов данных или файловых групп (базовой копии для разностного копирования), которая содержит только данные, измененные по сравнению с базовой копией для разностного копирования.  
  
 полная резервная копия  
 Резервная копия, которая содержит все данные заданной базы данных или наборов файлов или файловых групп, а также журналов для обеспечения возможности последующего восстановления этих данных.  
  
 резервная копия журналов  
 Резервная копия журналов транзакций, включающая все записи журнала, не входившие в предыдущую резервную копию журналов. (модель полного восстановления)  
  
 recover  
 Для возврата базы данных в стабильное и согласованное состояние.  
  
 recovery  
 Фаза запуска или восстановления базы данных, которая приводит базу данных в состояние согласованности транзакций.  
  
 модель восстановления  
 Свойство базы данных, с помощью которого выполняется управление обслуживанием журналов транзакций в базе данных. Существует три модели восстановления: простая модель восстановления, модель полного восстановления и модель восстановления с неполным протоколированием. Модель восстановления базы данных определяет требования к резервному копированию и восстановлению.  
  
 Восстановление  
 Многоэтапный процесс, в ходе которого все данные и страницы журнала копируются из указанной резервной копии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в определенную базу данных, а затем выполняется накат всех фиксированных транзакций, записанных в резервной копии журнала, путем внесения новых данных на основе зарегистрированных изменений.  
  

  
##  <a name="introduction-to-backup-and-restore-strategies"></a><a name="BnrStrategies"></a>Общие сведения о стратегиях резервного копирования и восстановления  
 Операции резервирования и восстановления данных следует адаптировать под конкретную среду с учетом доступных ресурсов. Таким образом, для надежной работы операций резервирования и восстановления необходима стратегия резервирования и восстановления. Правильно созданная стратегия резервирования и восстановления увеличивает доступность данных и уменьшает их потери, учитывая требования пользователей.  
  
> [!IMPORTANT]  
>  Базу данных и резервные копии следует размещать на отдельных устройствах резервного копирования. В противном случае при сбое устройства, содержащего базу данных, резервные копии окажутся недоступными. Кроме того, размещение данных и их резервных копий на отдельных устройствах повышает производительность ввода-вывода как при записи резервных копий, так и в процессе производственного использования базы данных.  
  
 Стратегия резервирования и восстановления состоит из части, относящейся к резервированию, и части, относящейся к восстановлению. Часть, относящаяся к резервированию, определяет тип и частоту создания резервных копий, тип и скоростные характеристики оборудования, необходимого для их создания, способ проверки резервных копий, а также местонахождение и тип носителя резервных копий (включая и вопросы безопасности). Часть, относящаяся к восстановлению, определяет ответственного за проведение операций восстановления, а также методы их проведения, позволяющие удовлетворить требования пользователей по доступности данных и минимизации их потерь. Рекомендуется документировать процедуры резервирования и восстановления и хранить копию этой документации в документации по задаче.  
  
 Разработка эффективной стратегии резервирования и восстановления требует тщательного планирования, реализации и тестирования. Необходимо тестирование. До тех пор пока не были успешно восстановлены все резервные копии во всех сочетаниях, вовлеченных в стратегию восстановления, нет и стратегии резервного копирования. Необходимо оценить ряд факторов. следующие основные параметры.  
  
-   Производственные задачи организации, относящиеся к базе данных, особенно требования к доступности данных и их защите от потери.  
  
-   Свойства каждой базы данных: размер, типичное использование, характер содержимого, требования к данным и т. д.  
  
-   Ограничения на ресурсы, например: оборудование, персонал, пространство для хранения носителей резервных копий, физическая безопасность этих носителей и так далее.  
  
    > [!NOTE]  
    >  Формат хранения данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на диске в 64-разрядной и 32-разрядной средах одинаков. Следовательно, резервное копирование и восстановление работают и в 32-разрядной, и в 64-разрядной средах. Резервная копия, созданная на экземпляре сервера, работающем в одной среде, может быть восстановлена на экземпляре сервера, работающем в другой среде.  
  

  
### <a name="impact-of-the-recovery-model-on-backup-and-restore"></a>Влияние модели восстановления на резервное копирование и восстановление  
 Операции резервного копирования и восстановления выполняются в контексте моделей восстановления. Модель восстановления является свойством базы данных, которое задает, как выполняется управление журналом транзакций. Также модель восстановления базы данных определяет, какие типы резервных копий и сценарии восстановления поддерживаются для базы данных. Обычно база данных использует простую модель восстановления или модель полного восстановления. Модель полного восстановления может быть дополнена путем переключения на модель с неполным протоколированием перед выполнением массовых операций. Основные сведения о моделях восстановления и их влиянии на управление журналом транзакций см. в разделе [Журнал транзакций (SQL Server)](../logs/the-transaction-log-sql-server.md).  
  
 Лучший выбор модели восстановления базы данных зависит от бизнес-требований. Чтобы избежать управления журналом транзакций и упростить резервное копирование и восстановление, используйте простую модель восстановления. Чтобы снизить вероятность потери результатов работы ценой увеличения административных издержек, используйте модель полного восстановления. Дополнительные сведения о влиянии моделей восстановления на создание резервных копий и восстановление см. в разделе [Общие сведения о резервном копировании (SQL Server)](backup-overview-sql-server.md).  
  
### <a name="design-the-backup-strategy"></a>Создание стратегии резервного копирования  
 После того как выбрана модель восстановления, соответствующая бизнес-требованиям определенной базы данных, необходимо спланировать и выполнить соответствующую стратегию резервного копирования. Оптимальная стратегия зависит от многих факторов, среди которых наиболее важны следующие.  
  
-   Сколько часов в день приложения имеют доступ к базе данных?  
  
     Если существует прогнозируемый внепиковый период, рекомендуется запланировать полное резервное копирование базы данных именно на этот период.  
  
-   Насколько часты и вероятны изменения и обновления?  
  
     Если изменения часты, учтите следующее.  
  
    -   В рамках простой модели восстановления рассмотрите возможность запланировать разностное резервное копирование между полными резервными копированиями базы данных. Разностная резервная копия сохраняет только те изменения, которые были внесены с момента последнего полного резервного копирования.  
  
    -   В рамках модели полного восстановления следует запланировать частное резервное копирование журналов. Планирование разностного резервного копирования между полными резервными копиями сокращает время восстановления путем сокращения количества резервных копий журналов, которые необходимо восстанавливать после восстановления данных.  
  
-   Касаются ли обычно изменения небольшой или же значительной части базы данных?  
  
     В большой базе данных, в которой изменения концентрируются в части файлов или файловых групп, полезно частичное резервное копирование или резервное копирование файлов. Дополнительные сведения см. в разделах [Частичные резервные копии (SQL Server)](partial-backups-sql-server.md) и [Полные резервные копии файлов (SQL Server)](full-file-backups-sql-server.md).  
  
-   Сколько места на диске требуется для полного резервного копирования базы данных?  
  
     Дополнительные сведения см. в разделе [Оценка размера полной резервной копии базы данных](#EstimateDbBuSize)ниже в этом подразделе.  
  
####  <a name="estimate-the-size-of-a-full-database-backup"></a><a name="EstimateDbBuSize"></a>Оценка размера полной резервной копии базы данных  
 Перед тем как выбрать стратегию резервного копирования и восстановления, необходимо рассчитать, какой объем места на диске необходим для полной резервной копии базы данных. При выполнении операции резервного копирования данные, содержащиеся в базе данных, копируются в файл резервной копии. Резервная копия содержит только фактические данные в базе данных, а не любое неиспользованное пространство. Поэтому резервная копия обычно меньше, чем база данных. Размер полной резервной копии базы данных вы можете вычислить с помощью системной хранимой процедуры **sp_spaceused** . Дополнительные сведения см. в разделе [sp_spaceused (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-spaceused-transact-sql).  
  
### <a name="schedule-backups"></a>Создание расписания резервного копирования  
 Влияние, оказываемое осуществлением резервного копирования на выполняемые транзакции, минимально, поэтому операции резервного копирования могут выполняться одновременно с выполнением обычных операций. Резервное копирование в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] можно выполнять с минимальным влиянием на рабочие нагрузки.  
  
> [!NOTE]  
>  Сведения об ограничениях параллелизма во время резервного копирования см. в разделе [Общие сведения о резервном копировании (SQL Server)](backup-overview-sql-server.md).  
  
 После принятия решения о том, какой тип резервного копирования необходим и как часто его выполнять, рекомендуется запланировать регулярное резервное копирование как часть плана обслуживания базы данных. Дополнительные сведения о планах обслуживания и об их создании для резервных копий баз данных и журналов см. в разделе [Use the Maintenance Plan Wizard](../maintenance-plans/use-the-maintenance-plan-wizard.md).  
  
### <a name="test-your-backups"></a>Тестирование резервных копий  
 Можно сказать, что стратегия восстановления отсутствует, пока резервные копии не протестированы. Очень важно полностью протестировать стратегию резервного копирования для каждой базы данных, восстанавливая копию базы данных в систему тестирования. Необходимо протестировать восстановление каждого типа резервной копии, которую планируется использовать.  
  
 Рекомендуется вести руководство по эксплуатации для каждой базы данных. Такое руководство по эксплуатации должно указывать расположение резервных копий, имена устройств резервного копирования (если есть), время, требуемое для восстановления тестовой резервной копии.  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> Связанные задачи  
  
### <a name="scheduling-backup-jobs"></a>Создание расписания заданий резервного копирования  
  
-   [Создание плана обслуживания](../maintenance-plans/create-a-maintenance-plan.md)  
  
-   [Создание задания](../../ssms/agent/create-a-job.md)  
  
-   [Планирование задания](../../ssms/agent/schedule-a-job.md)  
  
### <a name="working-with-backup-devices-and-backup-media"></a>Работа с устройствами резервного копирования и носителями резервных копий  
  
-   [Определение логического устройства резервного копирования для дискового файла (SQL Server)](define-a-logical-backup-device-for-a-disk-file-sql-server.md)  
  
-   [Определение логического устройства резервного копирования для ленточного накопителя (SQL Server)](define-a-logical-backup-device-for-a-tape-drive-sql-server.md)  
  
-   [Указание в качестве назначения резервного копирования диска или ленты (SQL Server)](specify-a-disk-or-tape-as-a-backup-destination-sql-server.md)  
  
-   [Удаление устройства резервного копирования (SQL Server)](delete-a-backup-device-sql-server.md)  
  
-   [Назначение срока хранения резервной копии (SQL Server)](set-the-expiration-date-on-a-backup-sql-server.md)  
  
-   [Просмотр содержимого ленты или файла резервной копии (SQL Server)](view-the-contents-of-a-backup-tape-or-file-sql-server.md)  
  
-   [Просмотр файлов данных и журналов в резервном наборе данных (SQL Server)](view-the-data-and-log-files-in-a-backup-set-sql-server.md)  
  
-   [Просмотр свойств и содержимого логического устройства резервного копирования (SQL Server)](view-the-properties-and-contents-of-a-logical-backup-device-sql-server.md)  
  
-   [Восстановление резервной копии с устройства (SQL Server)](restore-a-backup-from-a-device-sql-server.md)  
  
### <a name="creating-backups"></a>Создание резервных копий  
  
> [!NOTE]  
>  Для создания частичной резервной копии или резервной копии только для копирования используется инструкция [!INCLUDE[tsql](../../includes/tsql-md.md)][BACKUP](/sql/t-sql/statements/backup-transact-sql) с параметром PARTIAL или COPY_ONLY.  
  
 **Использование среды SQL Server Management Studio**  
  
-   [Создание полной резервной копии базы данных (SQL Server)](create-a-full-database-backup-sql-server.md)  
  
-   [Создание резервной копии журнала транзакций (SQL Server)](back-up-a-transaction-log-sql-server.md)  
  
-   [Резервное копирование файлов и файловых групп (SQL Server)](back-up-files-and-filegroups-sql-server.md)  
  
-   [Создание разностной резервной копии базы данных (SQL Server)](create-a-differential-database-backup-sql-server.md)  
  
 **Использование Transact-SQL**  
  
-   [Использование регулятора ресурсов для ограничения загрузки ЦП при сжатии резервной копии (Transact-SQL)](use-resource-governor-to-limit-cpu-usage-by-backup-compression-transact-sql.md)  
  
-   [Создание резервной копии журнала транзакций при повреждении базы данных (SQL Server)](back-up-the-transaction-log-when-the-database-is-damaged-sql-server.md)  
  
-   [Включение или отключение вычисления контрольных сумм резервных копий во время резервного копирования или восстановления (SQL Server)](enable-or-disable-backup-checksums-during-backup-or-restore-sql-server.md)  
  
-   [Определение, продолжает ли операция резервного копирования или восстановления работу после возникновения ошибки (SQL Server)](specify-if-backup-or-restore-continues-or-stops-after-error.md)  
  

  
### <a name="restoring-data-backups"></a>Восстановление резервных копий данных  
 **Использование среды SQL Server Management Studio**  
  
-   [Восстановление резервной копии базы данных &#40;SQL Server Management Studio&#41;](restore-a-database-backup-using-ssms.md)  
  
-   [Восстановление базы данных в новом расположении (SQL Server)](restore-a-database-to-a-new-location-sql-server.md)  
  
-   [Восстановление разностной резервной копии базы данных (SQL Server)](restore-a-differential-database-backup-sql-server.md)  
  
-   [Восстановление файлов и файловых групп (SQL Server)](restore-files-and-filegroups-sql-server.md)  
  
 **Использование Transact-SQL**  
  
-   [Восстановление резервной копии базы данных в простой модели восстановления (Transact-SQL)](restore-a-database-backup-under-the-simple-recovery-model-transact-sql.md)  
  
-   [Восстановление базы данных до точки сбоя в модели полного восстановления (Transact-SQL)](restore-database-to-point-of-failure-full-recovery.md)  
  
-   [Восстановление файлов и файловых групп поверх существующих файлов (SQL Server)](restore-files-and-filegroups-over-existing-files-sql-server.md)  
  
-   [Восстановление файлов в новое место (SQL Server)](restore-files-to-a-new-location-sql-server.md)  
  
-   [Восстановление базы данных master (Transact-SQL)](restore-the-master-database-transact-sql.md)  
  

  
### <a name="restoring-transaction-logs-full-recovery-model"></a>Восстановление журналов транзакций (модель полного восстановления)  
 **Использование среды SQL Server Management Studio**  
  
-   [Восстановление базы данных до помеченной транзакции (среда SQL Server Management Studio)](restore-a-database-to-a-marked-transaction-sql-server-management-studio.md)  
  
-   [Восстановление резервной копии журнала транзакций (SQL Server)](restore-a-transaction-log-backup-sql-server.md)  
  
-   [Восстановление базы данных SQL Server до определенного момента времени (модель полного восстановления)](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md)  
  
 **Использование Transact-SQL**  
  
-   [Восстановление базы данных SQL Server до определенного момента времени (модель полного восстановления)](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md)  
  

  
### <a name="additional-restore-tasks"></a>Дополнительные задачи восстановления  
 **Использование Transact-SQL**  
  
-   [Перезапуск прерванной операции восстановления (Transact-SQL)](restart-an-interrupted-restore-operation-transact-sql.md)  
  
-   [Восстановление базы данных без восстановления данных (Transact-SQL)](recover-a-database-without-restoring-data-transact-sql.md)  
  

  
## <a name="see-also"></a>См. также:  
 [Общие сведения о резервном копировании (SQL Server)](backup-overview-sql-server.md)   
 [Обзор процессов восстановления (SQL Server)](restore-and-recovery-overview-sql-server.md)   
 [BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql)   
 [RESTORE (Transact-SQL)](/sql/t-sql/statements/restore-statements-transact-sql)   
 [Создание и восстановление резервных копий баз данных служб Analysis Services](https://docs.microsoft.com/analysis-services/multidimensional-models/backup-and-restore-of-analysis-services-databases)   
 [Создание резервных копий и восстановление полнотекстовых каталогов и индексов](../search/back-up-and-restore-full-text-catalogs-and-indexes.md)   
 [Создание резервной копии и восстановление из копий реплицируемых баз данных](../replication/administration/back-up-and-restore-replicated-databases.md)   
 [Журнал транзакций (SQL Server)](../logs/the-transaction-log-sql-server.md)   
 [Модели восстановления (SQL Server)](recovery-models-sql-server.md)   
 [Наборы носителей, семейства носителей и резервные наборы данных (SQL Server)](media-sets-media-families-and-backup-sets-sql-server.md)  
  
  
