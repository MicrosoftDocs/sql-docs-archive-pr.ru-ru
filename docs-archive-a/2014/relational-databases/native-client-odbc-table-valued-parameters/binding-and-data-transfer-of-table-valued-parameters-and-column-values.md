---
title: Привязка и Передача данных возвращающих табличное значение параметров и значений столбцов | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters (ODBC), binding and data transfer
ms.assetid: 0a2ea462-d613-42b6-870f-c7fa086a6b42
author: rothja
ms.author: jroth
ms.openlocfilehash: 2e9e30e22a69b2d500990cc1481506b4edbda99b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87667079"
---
# <a name="binding-and-data-transfer-of-table-valued-parameters-and-column-values"></a><span data-ttu-id="c0bae-102">Привязка и передача данных возвращающих табличное значение параметров и значений столбцов</span><span class="sxs-lookup"><span data-stu-id="c0bae-102">Binding and Data Transfer of Table-Valued Parameters and Column Values</span></span>
  <span data-ttu-id="c0bae-103">Возвращающие табличное значение параметры, как и другие параметры, нуждаются в привязке до их передачи на сервер.</span><span class="sxs-lookup"><span data-stu-id="c0bae-103">Table-valued parameters, like other parameters, must be bound before they are passed to the server.</span></span> <span data-ttu-id="c0bae-104">Приложение привязывает возвращающие табличное значение параметры так же, как привязывает другие параметры: с помощью SQLBindParameter или эквивалентных вызовов SQLSetDescField или SQLSetDescRec.</span><span class="sxs-lookup"><span data-stu-id="c0bae-104">The application binds table-valued parameters the same way it binds other parameters: by using SQLBindParameter or equivalent calls to SQLSetDescField or SQLSetDescRec.</span></span> <span data-ttu-id="c0bae-105">Типом данных на сервере для параметра, возвращающего табличное значение, является SQL_SS_TABLE.</span><span class="sxs-lookup"><span data-stu-id="c0bae-105">The server data type for a table-valued parameter is SQL_SS_TABLE.</span></span> <span data-ttu-id="c0bae-106">Тип C может иметь значение SQL_C_DEFAULT или SQL_C_BINARY.</span><span class="sxs-lookup"><span data-stu-id="c0bae-106">The C type can be specified either as SQL_C_DEFAULT or SQL_C_BINARY.</span></span>  
  
 <span data-ttu-id="c0bae-107">В [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] и более поздних версиях возвращающие табличное значение параметры поддерживаются только как входные.</span><span class="sxs-lookup"><span data-stu-id="c0bae-107">In [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] or later, only input table-valued parameters are supported.</span></span> <span data-ttu-id="c0bae-108">Поэтому любая попытка установить для SQL_DESC_PARAMETER_TYPE значение, отличное от SQL_PARAM_INPUT, приведет к возникновению ошибки SQL_ERROR с SQLSTATE = HY105 и появлению сообщения «Недопустимый тип параметра».</span><span class="sxs-lookup"><span data-stu-id="c0bae-108">Therefore, any attempt to set SQL_DESC_PARAMETER_TYPE to a value other than SQL_PARAM_INPUT will return SQL_ERROR with SQLSTATE = HY105 and the message "Invalid parameter type".</span></span>  
  
 <span data-ttu-id="c0bae-109">Можно назначать значение по умолчанию для целых столбцов возвращающих табличное значение параметров с помощью атрибута SQL_CA_SS_COL_HAS_DEFAULT_VALUE.</span><span class="sxs-lookup"><span data-stu-id="c0bae-109">Entire table-valued parameter columns can be assigned default values by using the attribute SQL_CA_SS_COL_HAS_DEFAULT_VALUE.</span></span> <span data-ttu-id="c0bae-110">Однако отдельные значения столбцов возвращающего табличное значение параметра не могут быть назначены значениями по умолчанию с помощью SQL_DEFAULT_PARAM в *StrLen_or_IndPtr* с SQLBindParameter.</span><span class="sxs-lookup"><span data-stu-id="c0bae-110">Individual table-valued parameter column values, however, cannot be assigned default values by using SQL_DEFAULT_PARAM in *StrLen_or_IndPtr* with SQLBindParameter.</span></span> <span data-ttu-id="c0bae-111">Возвращающие табличные значения параметры не могут быть установлены в значение по умолчанию с помощью SQL_DEFAULT_PARAM в *StrLen_or_IndPtr* с SQLBindParameter.</span><span class="sxs-lookup"><span data-stu-id="c0bae-111">Table-valued parameters as a whole cannot be set to a default value by using SQL_DEFAULT_PARAM in *StrLen_or_IndPtr* with SQLBindParameter.</span></span> <span data-ttu-id="c0bae-112">Если эти правила не выполняются, SQLExecute или SQLExecDirect возвратит SQL_ERROR.</span><span class="sxs-lookup"><span data-stu-id="c0bae-112">If these rules are not followed, SQLExecute or SQLExecDirect will return SQL_ERROR.</span></span> <span data-ttu-id="c0bae-113">Будет создана диагностическая запись с параметром SQLSTATE = 07S01 и сообщением "Недопустимое использование параметра по умолчанию для параметра \<p> ", где \<p> — это порядковый номер TVP в инструкции запроса.</span><span class="sxs-lookup"><span data-stu-id="c0bae-113">A diagnostic record will be generated with SQLSTATE=07S01 and the message "Invalid use of default parameter for parameter \<p>", where \<p> is the ordinal of the TVP in the query statement.</span></span>  
  
 <span data-ttu-id="c0bae-114">После привязки возвращающего табличное значение параметра приложение должно выполнить привязку каждого столбца параметров, возвращающих табличное значение.</span><span class="sxs-lookup"><span data-stu-id="c0bae-114">After binding the table-valued parameter, the application must then bind each table-valued parameter column.</span></span> <span data-ttu-id="c0bae-115">Для этого приложение сначала вызывает SQLSetStmtAttr, чтобы задать SQL_SOPT_SS_PARAM_FOCUS порядковому номеру возвращающего табличное значение параметра.</span><span class="sxs-lookup"><span data-stu-id="c0bae-115">To do this, the application first calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to the ordinal of a table-valued parameter.</span></span> <span data-ttu-id="c0bae-116">Затем приложение привязывает столбцы возвращающего табличное значение параметра с помощью вызовов к следующим подпрограммым: SQLBindParameter, SQLSetDescRec и SQLSetDescField.</span><span class="sxs-lookup"><span data-stu-id="c0bae-116">Then the application binds the columns of the table-valued parameter by calls to the following routines: SQLBindParameter, SQLSetDescRec, and SQLSetDescField.</span></span> <span data-ttu-id="c0bae-117">При установке SQL_SOPT_SS_PARAM_FOCUS в 0 восстанавливается обычный результат SQLBindParameter, SQLSetDescRec и SQLSetDescField в работе с обычными параметрами верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="c0bae-117">Setting SQL_SOPT_SS_PARAM_FOCUS to 0 restores the usual effect of SQLBindParameter, SQLSetDescRec, and SQLSetDescField in operating on regular top-level parameters.</span></span>  
  
 <span data-ttu-id="c0bae-118">Для самого возвращающего табличное значение параметра никакие данные не передаются и не принимаются. Передаются и принимаются данные для каждого из столбцов, составляющих этот параметр.</span><span class="sxs-lookup"><span data-stu-id="c0bae-118">No actual data is sent or received for the table-valued parameter itself, but data is sent and received for each of its constituent columns.</span></span> <span data-ttu-id="c0bae-119">Поскольку возвращающий табличное значение параметр является псевдо-столбцом, параметры для SQLBindParameter используются для ссылки на другие атрибуты, отличные от других типов данных, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="c0bae-119">Because the table-valued parameter is a pseudo column, the parameters for SQLBindParameter are used to refer to different attributes than other data types, as follows:</span></span>  
  
|<span data-ttu-id="c0bae-120">Параметр</span><span class="sxs-lookup"><span data-stu-id="c0bae-120">Parameter</span></span>|<span data-ttu-id="c0bae-121">Связанный атрибут для типов параметров, не являющихся табличными, включая столбцы</span><span class="sxs-lookup"><span data-stu-id="c0bae-121">Related attribute for non-table-valued parameter types, including columns</span></span>|<span data-ttu-id="c0bae-122">Связанные атрибуты для возвращающих табличное значение параметров</span><span class="sxs-lookup"><span data-stu-id="c0bae-122">Related attribute for table-valued parameters</span></span>|  
|---------------|--------------------------------------------------------------------------------|----------------------------------------------------|  
|<span data-ttu-id="c0bae-123">*InputOutputType*</span><span class="sxs-lookup"><span data-stu-id="c0bae-123">*InputOutputType*</span></span>|<span data-ttu-id="c0bae-124">SQL_DESC_PARAMETER_TYPE в IPD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-124">SQL_DESC_PARAMETER_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="c0bae-125">Для столбцов, возвращающих табличное значение параметров, этот атрибут должен совпадать с настройкой для самого возвращающего табличное значение параметра.</span><span class="sxs-lookup"><span data-stu-id="c0bae-125">For table-valued parameter columns, this must be the same as the setting for the table-valued parameter itself.</span></span>|<span data-ttu-id="c0bae-126">SQL_DESC_PARAMETER_TYPE в IPD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-126">SQL_DESC_PARAMETER_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="c0bae-127">Это должен быть атрибут SQL_PARAM_INPUT.</span><span class="sxs-lookup"><span data-stu-id="c0bae-127">This must be SQL_PARAM_INPUT.</span></span>|  
|<span data-ttu-id="c0bae-128">*Внедрен*</span><span class="sxs-lookup"><span data-stu-id="c0bae-128">*ValueType*</span></span>|<span data-ttu-id="c0bae-129">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE в APD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-129">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in APD.</span></span>|<span data-ttu-id="c0bae-130">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE в APD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-130">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in APD.</span></span><br /><br /> <span data-ttu-id="c0bae-131">Это должен быть атрибут SQL_C_DEFAULT или SQL_C_BINARY.</span><span class="sxs-lookup"><span data-stu-id="c0bae-131">This must be SQL_C_DEFAULT or SQL_C_BINARY.</span></span>|  
|<span data-ttu-id="c0bae-132">*ParameterType*</span><span class="sxs-lookup"><span data-stu-id="c0bae-132">*ParameterType*</span></span>|<span data-ttu-id="c0bae-133">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE в IPD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-133">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in IPD.</span></span>|<span data-ttu-id="c0bae-134">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE в IPD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-134">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="c0bae-135">Это должен быть атрибут SQL_SS_TABLE.</span><span class="sxs-lookup"><span data-stu-id="c0bae-135">This must be SQL_SS_TABLE.</span></span>|  
|<span data-ttu-id="c0bae-136">*ColumnSize*</span><span class="sxs-lookup"><span data-stu-id="c0bae-136">*ColumnSize*</span></span>|<span data-ttu-id="c0bae-137">SQL_DESC_LENGTH или SQL_DESC_PRECISION в IPD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-137">SQL_DESC_LENGTH or SQL_DESC_PRECISION in IPD.</span></span><br /><br /> <span data-ttu-id="c0bae-138">Это зависит от значения *ParameterType*.</span><span class="sxs-lookup"><span data-stu-id="c0bae-138">This depends on the value of *ParameterType*.</span></span>|<span data-ttu-id="c0bae-139">SQL_DESC_ARRAY_SIZE</span><span class="sxs-lookup"><span data-stu-id="c0bae-139">SQL_DESC_ARRAY_SIZE</span></span><br /><br /> <span data-ttu-id="c0bae-140">Значение этого атрибута можно задать также с помощью атрибута SQL_ATTR_PARAM_SET_SIZE, когда фокус параметра установлен на возвращающий табличное значение параметр.</span><span class="sxs-lookup"><span data-stu-id="c0bae-140">Can also be set using SQL_ATTR_PARAM_SET_SIZE when the parameter focus is set to the table-valued parameter.</span></span><br /><br /> <span data-ttu-id="c0bae-141">Для возвращающего табличное значение параметра эта величина равна количеству строк в буферах столбцов данного параметра.</span><span class="sxs-lookup"><span data-stu-id="c0bae-141">For a table-valued parameter, this is the number of rows in the table-valued parameter column buffers.</span></span>|  
|<span data-ttu-id="c0bae-142">*DecimalDigits*</span><span class="sxs-lookup"><span data-stu-id="c0bae-142">*DecimalDigits*</span></span>|<span data-ttu-id="c0bae-143">SQL_DESC_PRECISION или SQL_DESC_SCALE в IPD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-143">SQL_DESC_PRECISION or SQL_DESC_SCALE in IPD.</span></span>|<span data-ttu-id="c0bae-144">Не используется.</span><span class="sxs-lookup"><span data-stu-id="c0bae-144">Unused.</span></span> <span data-ttu-id="c0bae-145">Атрибут должен иметь значение 0.</span><span class="sxs-lookup"><span data-stu-id="c0bae-145">This must be 0.</span></span><br /><br /> <span data-ttu-id="c0bae-146">Если этот параметр не равен 0, SQLBindParameter возвратит SQL_ERROR, и будет создана диагностическая запись с параметром SQLSTATE = HY104 и сообщением "недопустимая точность или масштаб".</span><span class="sxs-lookup"><span data-stu-id="c0bae-146">If this parameter is not 0, SQLBindParameter will return SQL_ERROR, and a diagnostic record will be generated with SQLSTATE= HY104 and the message "Invalid precision or scale".</span></span>|  
|<span data-ttu-id="c0bae-147">*параметервалуептр*</span><span class="sxs-lookup"><span data-stu-id="c0bae-147">*ParameterValuePtr*</span></span>|<span data-ttu-id="c0bae-148">SQL_DESC_DATA_PTR в APD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-148">SQL_DESC_DATA_PTR in APD.</span></span>|<span data-ttu-id="c0bae-149">SQL_CA_SS_TYPE_NAME.</span><span class="sxs-lookup"><span data-stu-id="c0bae-149">SQL_CA_SS_TYPE_NAME.</span></span><br /><br /> <span data-ttu-id="c0bae-150">Необязательный атрибут для вызова хранимых процедур. Если значение не нужно, можно задать NULL.</span><span class="sxs-lookup"><span data-stu-id="c0bae-150">This is optional for stored procedure calls, and NULL can be specified if it is not required.</span></span> <span data-ttu-id="c0bae-151">Для инструкций SQL, не являющихся вызовами процедур, атрибут должен быть задан.</span><span class="sxs-lookup"><span data-stu-id="c0bae-151">It must be specified for SQL statements that are not procedure calls.</span></span><br /><br /> <span data-ttu-id="c0bae-152">Этот параметр также служит уникальным значением, по которому приложение может узнать конкретный возвращающий табличное значение параметр при использовании переменной строковой привязки.</span><span class="sxs-lookup"><span data-stu-id="c0bae-152">This parameter also serves as a unique value that the application can use to identify this table-valued parameter when variable row binding is used.</span></span> <span data-ttu-id="c0bae-153">Дополнительные сведения см. в подразделе «Переменная строковая привязка возвращающих табличное значение параметров» далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="c0bae-153">For more information, see the "Variable Table-Valued Parameter Row Binding" section, later in this topic.</span></span><br /><br /> <span data-ttu-id="c0bae-154">Если в вызове SQLBindParameter указано имя типа возвращающего табличное значение параметра, оно должно быть указано в Юникоде даже в приложениях, созданных как приложения ANSI.</span><span class="sxs-lookup"><span data-stu-id="c0bae-154">When a table-valued parameter type name is specified on a call to SQLBindParameter, it must be specified as a Unicode value, even in applications that are built as ANSI applications.</span></span> <span data-ttu-id="c0bae-155">Значение, используемое для параметра *StrLen_or_IndPtr* , должно быть либо SQL_NTS, либо строковой длины имени, умноженной на sizeof (WChar).</span><span class="sxs-lookup"><span data-stu-id="c0bae-155">The value used for the parameter *StrLen_or_IndPtr* should be either SQL_NTS or the string length of the name multiplied by sizeof(WCHAR).</span></span>|  
|<span data-ttu-id="c0bae-156">*BufferLength*</span><span class="sxs-lookup"><span data-stu-id="c0bae-156">*BufferLength*</span></span>|<span data-ttu-id="c0bae-157">SQL_DESC_OCTET_LENGTH в APD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-157">SQL_DESC_OCTET_LENGTH in APD.</span></span>|<span data-ttu-id="c0bae-158">Длина имени типа возвращающего табличное значение параметра в байтах.</span><span class="sxs-lookup"><span data-stu-id="c0bae-158">The length of the table-valued parameter type name in bytes.</span></span><br /><br /> <span data-ttu-id="c0bae-159">Значение может быть равно SQL_NTS, если имя типа представляет собой строку, завершающуюся нулем, или 0, если имя типа возвращающего табличное значение параметра не требуется.</span><span class="sxs-lookup"><span data-stu-id="c0bae-159">This can be SQL_NTS if the type name is null terminated, or 0 if the table-valued parameter type name is not required.</span></span>|  
|<span data-ttu-id="c0bae-160">*StrLen_or_IndPtr*</span><span class="sxs-lookup"><span data-stu-id="c0bae-160">*StrLen_or_IndPtr*</span></span>|<span data-ttu-id="c0bae-161">SQL_DESC_OCTET_LENGTH_PTR в APD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-161">SQL_DESC_OCTET_LENGTH_PTR in APD.</span></span>|<span data-ttu-id="c0bae-162">SQL_DESC_OCTET_LENGTH_PTR в APD.</span><span class="sxs-lookup"><span data-stu-id="c0bae-162">SQL_DESC_OCTET_LENGTH_PTR in APD.</span></span><br /><br /> <span data-ttu-id="c0bae-163">Для возвращающих табличное значение параметров этот атрибут хранит не длину данных, а количество строк.</span><span class="sxs-lookup"><span data-stu-id="c0bae-163">For table-valued parameters, this is a row count rather than a data length.</span></span>|  
  
 <span data-ttu-id="c0bae-164">Для возвращающих табличное значение параметров поддерживаются два режима передачи данных: фиксированная и переменная привязка строк.</span><span class="sxs-lookup"><span data-stu-id="c0bae-164">Two data transfer modes are supported for table-valued parameters: fixed row binding and variable row binding.</span></span>  
  
## <a name="fixed-table-valued-parameter-row-binding"></a><span data-ttu-id="c0bae-165">Фиксированная привязка строк возвращающего табличное значение параметра</span><span class="sxs-lookup"><span data-stu-id="c0bae-165">Fixed Table-Valued Parameter Row Binding</span></span>  
 <span data-ttu-id="c0bae-166">Для фиксированной привязки строк приложение выделяет буферы (или буферные массивы), достаточно большие для всех возможных значений входных столбцов.</span><span class="sxs-lookup"><span data-stu-id="c0bae-166">For fixed row binding, an application allocates buffers (or buffer arrays) large enough for all possible input column values.</span></span> <span data-ttu-id="c0bae-167">Приложение выполняет следующие действия.</span><span class="sxs-lookup"><span data-stu-id="c0bae-167">The application does the following:</span></span>  
  
1.  <span data-ttu-id="c0bae-168">Привязывает все параметры с помощью вызовов SQLBindParameter, SQLSetDescRec или SQLSetDescField.</span><span class="sxs-lookup"><span data-stu-id="c0bae-168">Binds all parameters by using SQLBindParameter, SQLSetDescRec, or SQLSetDescField calls.</span></span>  
  
    1.  <span data-ttu-id="c0bae-169">Присваивает атрибуту SQL_DESC_ARRAY_SIZE значение максимально возможного числа рядов, которые можно передать для каждого возвращающего табличное значение параметра.</span><span class="sxs-lookup"><span data-stu-id="c0bae-169">Sets SQL_DESC_ARRAY_SIZE to the maximum number of rows that can be transferred for each table-valued parameter.</span></span> <span data-ttu-id="c0bae-170">Это можно сделать в вызове SQLBindParameter.</span><span class="sxs-lookup"><span data-stu-id="c0bae-170">This can be done in the SQLBindParameter call.</span></span>  
  
2.  <span data-ttu-id="c0bae-171">Вызывает SQLSetStmtAttr, чтобы задать SQL_SOPT_SS_PARAM_FOCUS порядковому номеру каждого возвращающего табличное значение параметра.</span><span class="sxs-lookup"><span data-stu-id="c0bae-171">Calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to the ordinal of each table-valued parameter.</span></span>  
  
    1.  <span data-ttu-id="c0bae-172">Для каждого возвращающего табличное значение параметра выполняет привязку столбцов возвращающего табличное значение параметра с помощью вызовов SQLBindParameter, SQLSetDescRec или SQLSetDescField.</span><span class="sxs-lookup"><span data-stu-id="c0bae-172">For each table-valued parameter, binds table-valued parameter columns by using SQLBindParameter, SQLSetDescRec, or SQLSetDescField calls.</span></span>  
  
    2.  <span data-ttu-id="c0bae-173">Для каждого столбца возвращающего табличное значение параметра, который должен иметь значения по умолчанию, вызывает SQLSetDescField, чтобы задать SQL_CA_SS_COL_HAS_DEFAULT_VALUE равным 1.</span><span class="sxs-lookup"><span data-stu-id="c0bae-173">For each table-valued parameter column that is to have default values, calls SQLSetDescField to set SQL_CA_SS_COL_HAS_DEFAULT_VALUE to 1.</span></span>  
  
3.  <span data-ttu-id="c0bae-174">Вызывает SQLSetStmtAttr, чтобы задать SQL_SOPT_SS_PARAM_FOCUS 0.</span><span class="sxs-lookup"><span data-stu-id="c0bae-174">Calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to 0.</span></span> <span data-ttu-id="c0bae-175">Это необходимо сделать до вызова SQLExecute или SQLExecDirect.</span><span class="sxs-lookup"><span data-stu-id="c0bae-175">This must be done before SQLExecute or SQLExecDirect is called.</span></span> <span data-ttu-id="c0bae-176">В противном случае функция вернет значение SQL_ERROR и будет создана диагностическая запись с параметром SQLSTATE=HY024 и сообщением «Недопустимое значение атрибута SQL_SOPT_SS_PARAM_FOCUS (атрибут должен быть равен нулю во время выполнения)».</span><span class="sxs-lookup"><span data-stu-id="c0bae-176">Otherwise, SQL_ERROR is be returned and a diagnostic record is generated with SQLSTATE=HY024 and the message "Invalid attribute value, SQL_SOPT_SS_PARAM_FOCUS (must be zero at execution time)".</span></span>  
  
4.  <span data-ttu-id="c0bae-177">Задает *StrLen_or_IndPtr* или SQL_DESC_OCTET_LENGTH_PTR SQL_DEFAULT_PARAM для возвращающего табличное значение параметра, не имеющего строк, или числа строк, которые будут переданы при следующем вызове SQLExecute или SQLExecDirect, если возвращающий табличное значение параметр содержит строки.</span><span class="sxs-lookup"><span data-stu-id="c0bae-177">Sets *StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR to SQL_DEFAULT_PARAM for a table-valued parameter with no rows, or the number of rows to be transferred on the next call of SQLExecute or SQLExecDirect if the table-valued parameter has rows.</span></span> <span data-ttu-id="c0bae-178">Значения *StrLen_or_IndPtr* и SQL_DESC_OCTET_LENGTH_PTR не могут быть SQL_NULL_DATA для возвращающего табличное значение параметра, так как возвращающие табличное значение параметры не допускают значения NULL (хотя возвращающие табличное значение параметр может допускать значения NULL).</span><span class="sxs-lookup"><span data-stu-id="c0bae-178">*StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR cannot be set to SQL_NULL_DATA for a table-valued parameter as table-valued parameters are not nullable (though table-valued parameter constituent columns may be nullable).</span></span> <span data-ttu-id="c0bae-179">Если задано недопустимое значение, SQLExecute или SQLExecDirect возвращает SQL_ERROR, а диагностическая запись создается с параметром SQLSTATE = HY090 и сообщением "Недопустимая строка или длина буфера для параметра \<p> ", где p — номер параметра.</span><span class="sxs-lookup"><span data-stu-id="c0bae-179">If this is set to an invalid value, SQLExecute or SQLExecDirect returns SQL_ERROR, and a diagnostic record is generated with SQLSTATE=HY090 and the message "Invalid string or buffer length for parameter \<p>", where p is the parameter number.</span></span>  
  
5.  <span data-ttu-id="c0bae-180">Вызывает SQLExecute или SQLExecDirect.</span><span class="sxs-lookup"><span data-stu-id="c0bae-180">Calls SQLExecute or SQLExecDirect.</span></span>  
  
 <span data-ttu-id="c0bae-181">Входные значения столбца возвращающего табличное значение параметра могут передаваться в части, если для столбца *StrLen_or_IndPtr* задано значение SQL_LEN_DATA_AT_EXEC (*длина*) или SQL_DATA_AT_EXEC.</span><span class="sxs-lookup"><span data-stu-id="c0bae-181">Input table-valued parameter column values can be passed in pieces if *StrLen_or_IndPtr* is set to SQL_LEN_DATA_AT_EXEC(*length*) or SQL_DATA_AT_EXEC for the column.</span></span> <span data-ttu-id="c0bae-182">Это похоже на передачу значений по частям при использовании массивов параметров.</span><span class="sxs-lookup"><span data-stu-id="c0bae-182">This is similar to passing values in pieces when arrays of parameters are used.</span></span> <span data-ttu-id="c0bae-183">Как и во всех параметрах данных во время выполнения, метод SQLParamData не указывает, для какой строки массива драйвер запрашивает данные. Это приложение должно позаботиться об этом.</span><span class="sxs-lookup"><span data-stu-id="c0bae-183">As with all data-at-execution parameters, SQLParamData does not indicate which row of the array the driver is requesting data for; the application must take care of this.</span></span> <span data-ttu-id="c0bae-184">Приложение не может делать никаких предположений о порядке, в котором драйвер будет запрашивать данные.</span><span class="sxs-lookup"><span data-stu-id="c0bae-184">The application cannot make any assumptions about the order in which the driver will request values.</span></span>  
  
## <a name="variable-table-valued-parameter-row-binding"></a><span data-ttu-id="c0bae-185">Переменная привязка строк возвращающего табличное значение параметра</span><span class="sxs-lookup"><span data-stu-id="c0bae-185">Variable Table-Valued Parameter Row Binding</span></span>  
 <span data-ttu-id="c0bae-186">Строки при использовании переменной привязки передаются пакетами во время выполнения, и приложение передает их драйверу по требованию.</span><span class="sxs-lookup"><span data-stu-id="c0bae-186">For variable row binding, rows are transferred in batches at execution time and the application passes rows to the driver on demand.</span></span> <span data-ttu-id="c0bae-187">Это похоже на данные времени выполнения для отдельных значений параметров.</span><span class="sxs-lookup"><span data-stu-id="c0bae-187">This is similar to data-at-execution for individual parameter values.</span></span> <span data-ttu-id="c0bae-188">Для переменной привязки строк приложение выполняет следующие действия.</span><span class="sxs-lookup"><span data-stu-id="c0bae-188">For variable row binding, the application does the following:</span></span>  
  
1.  <span data-ttu-id="c0bae-189">Привязывает параметры и столбцы возвращающих табличное значение параметров, как описано в шагах с 1 по 3 предыдущего раздела «Фиксированная привязка строк возвращающего табличное значение параметра».</span><span class="sxs-lookup"><span data-stu-id="c0bae-189">Binds parameters and table-valued parameter columns as described in steps 1 to 3 of the previous section, "Fixed Table-Valued Parameter Row Binding".</span></span>  
  
2.  <span data-ttu-id="c0bae-190">Задает *StrLen_or_IndPtr* или SQL_DESC_OCTET_LENGTH_PTR для всех возвращающих табличное значение параметров, которые должны передаваться во время выполнения для SQL_DATA_AT_EXEC.</span><span class="sxs-lookup"><span data-stu-id="c0bae-190">Sets *StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR for any table-valued parameters that are to be passed at execution time to SQL_DATA_AT_EXEC.</span></span> <span data-ttu-id="c0bae-191">Если ни один из указанных атрибутов не установлен, параметр будет обрабатываться, как описано в предыдущем разделе.</span><span class="sxs-lookup"><span data-stu-id="c0bae-191">If neither is set, the parameter will be processed as described in the previous section.</span></span>  
  
3.  <span data-ttu-id="c0bae-192">Вызывает SQLExecute или SQLExecDirect.</span><span class="sxs-lookup"><span data-stu-id="c0bae-192">Calls SQLExecute or SQLExecDirect.</span></span> <span data-ttu-id="c0bae-193">При наличии любых параметров типа SQL_PARAM_INPUT или SQL_PARAM_INPUT_OUTPUT, которые должны быть обработаны как параметры с данными времени выполнения, этот вызов функции вернет значение SQL_NEED_DATA.</span><span class="sxs-lookup"><span data-stu-id="c0bae-193">This will return SQL_NEED_DATA if there are any SQL_PARAM_INPUT or SQL_PARAM_INPUT_OUTPUT parameters to be handled as data-at-execution parameters.</span></span> <span data-ttu-id="c0bae-194">В этом случае приложение выполняет следующие действия.</span><span class="sxs-lookup"><span data-stu-id="c0bae-194">In this case, the application does the following:</span></span>  
  
    -   <span data-ttu-id="c0bae-195">Вызывает метод SQLParamData.</span><span class="sxs-lookup"><span data-stu-id="c0bae-195">Calls SQLParamData.</span></span> <span data-ttu-id="c0bae-196">Он возвращает значение *параметервалуептр* для параметра данных при выполнении и код возврата SQL_NEED_DATA.</span><span class="sxs-lookup"><span data-stu-id="c0bae-196">This returns the *ParameterValuePtr* value for a data-at-execution parameter and a return code of SQL_NEED_DATA.</span></span> <span data-ttu-id="c0bae-197">После передачи всех данных параметров в драйвер метод SQLParamData возвращает SQL_SUCCESS, SQL_SUCCESS_WITH_INFO или SQL_ERROR.</span><span class="sxs-lookup"><span data-stu-id="c0bae-197">When all parameter data has been passed to the driver, SQLParamData returns SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, or SQL_ERROR.</span></span> <span data-ttu-id="c0bae-198">Для параметров данных, выполняемых при выполнении, *параметервалуептр*, который совпадает с полем дескриптора SQL_DESC_DATA_PTR, может рассматриваться как маркер для уникальной идентификации параметра, для которого требуется значение.</span><span class="sxs-lookup"><span data-stu-id="c0bae-198">For data-at-execution parameters, *ParameterValuePtr*, which is the same as the descriptor field SQL_DESC_DATA_PTR, can be regarded as a token to uniquely identify a parameter for which a value is required.</span></span> <span data-ttu-id="c0bae-199">Этот токен передается приложением драйверу во время привязки, а затем передается обратно приложению во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="c0bae-199">This "token" is passed from the application to the driver at bind time, then passed back to the application at execution time.</span></span>  
  
4.  <span data-ttu-id="c0bae-200">Чтобы отправить данные строки возвращающего табличное значение параметра для возвращающих табличные значения параметров, если параметр с табличным значением не содержит строк, приложение вызывает SQLPutData с *StrLen_Or_Ind* установленным в значение SQL_DEFAULT_PARAM.</span><span class="sxs-lookup"><span data-stu-id="c0bae-200">To send table-valued parameter row data for null table-valued parameters, if the table-valued parameter has no rows, an application calls SQLPutData with *StrLen_or_Ind* set to SQL_DEFAULT_PARAM.</span></span>  
  
     <span data-ttu-id="c0bae-201">Для возвращающих табличное значение параметров, отличных от NULL, приложение выполняет следующие действия.</span><span class="sxs-lookup"><span data-stu-id="c0bae-201">For non-NULL TVPs, an application:</span></span>  
  
    -   <span data-ttu-id="c0bae-202">Задает *Str_Len_or_Ind* для всех столбцов возвращающих табличное значение параметров соответствующих значений и заполняет буферы данных для столбцов возвращающих табличные значения параметров, которые не являются параметрами данных во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="c0bae-202">Sets *Str_Len_or_Ind* for all the table-valued parameter columns to appropriate values, and populates data buffers for table-valued parameter columns that are not to be data-at-execution parameters.</span></span> <span data-ttu-id="c0bae-203">Данные времени выполнения можно использовать для столбцов возвращающих табличное значение параметров, подобно тому, как обычные параметры могут передаваться драйверу по частям.</span><span class="sxs-lookup"><span data-stu-id="c0bae-203">You can use data-at-execution for table-valued parameter columns in a similar way to that in which ordinary parameters can be passed to the driver in pieces.</span></span>  
  
    -   <span data-ttu-id="c0bae-204">Вызывает SQLPutData с *Str_Len_or_Ind* заданным числом строк, которые будут отправлены на сервер.</span><span class="sxs-lookup"><span data-stu-id="c0bae-204">Calls SQLPutData with *Str_Len_or_Ind* set to the number of rows to be sent to the server.</span></span> <span data-ttu-id="c0bae-205">Любое значение, меньше 0 или больше SQL_DESC_ARRAY_SIZE или SQL_DEFAULT_PARAM, является ошибкой, и в этом случае вызов вернет состояние SQLSTATE HY090 с сообщением «Недопустимая длина строки или буфера».</span><span class="sxs-lookup"><span data-stu-id="c0bae-205">Any value outside the range 0 to SQL_DESC_ARRAY_SIZE or SQL_DEFAULT_PARAM is an error, and will return SQLSTATE HY090, with the message "Invalid string or buffer length".</span></span> <span data-ttu-id="c0bae-206">0 означает, что все строки уже были переданы и в данном возвращающем табличное значение параметре данных больше нет (как указано во втором пункте данного списка).</span><span class="sxs-lookup"><span data-stu-id="c0bae-206">0 indicates that all rows have been sent and there is no more data for a table-valued parameter (as noted in the second bullet item in this list).</span></span> <span data-ttu-id="c0bae-207">SQL_DEFAULT_PARAM можно использовать только в случае, если драйвер запрашивает данные возвращающего табличное значение параметра впервые (как описано в первом пункте данного списка).</span><span class="sxs-lookup"><span data-stu-id="c0bae-207">SQL_DEFAULT_PARAM can only be used the first time the driver requests data for a table-valued parameter (as described in the first bullet item in this list).</span></span>  
  
5.  <span data-ttu-id="c0bae-208">После отправки всех строк вызывает SQLPutData для возвращающего табличное значение параметра с *Str_Len_or_Ind* значением 0, а затем переходит к шагу 3a выше.</span><span class="sxs-lookup"><span data-stu-id="c0bae-208">When all rows have been sent, calls SQLPutData for the table-valued parameter with a *Str_Len_or_Ind* value of 0, then proceeds to step 3a above.</span></span>  
  
6.  <span data-ttu-id="c0bae-209">Вызывает метод SQLParamData еще раз.</span><span class="sxs-lookup"><span data-stu-id="c0bae-209">Calls SQLParamData again.</span></span> <span data-ttu-id="c0bae-210">Если между столбцами возвращающего табличное значение параметра находятся какие-либо параметры обработки данных, они будут идентифицированы по значению *валуептрптр* , возвращаемому параметром метод SQLParamData.</span><span class="sxs-lookup"><span data-stu-id="c0bae-210">If there are any data-at-execution parameters among the table-valued parameter columns, these will be identified by the value *ValuePtrPtr* returned by SQLParamData.</span></span> <span data-ttu-id="c0bae-211">Когда все значения столбцов доступны, метод SQLParamData снова возвращает значение *параметервалуептр* для возвращающего табличное значения параметра, и приложение начинает снова запускаться.</span><span class="sxs-lookup"><span data-stu-id="c0bae-211">When all column values are available, SQLParamData will again return the *ParameterValuePtr* value for the table-valued parameter, and the application begins again.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c0bae-212">См. также:</span><span class="sxs-lookup"><span data-stu-id="c0bae-212">See Also</span></span>  
 [<span data-ttu-id="c0bae-213">Возвращающие табличное значение параметры &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="c0bae-213">Table-Valued Parameters &#40;ODBC&#41;</span></span>](table-valued-parameters-odbc.md)  
  
  
