---
title: Получение строк | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- fetching rows
- OLE DB rowsets, fetching
- rowsets [OLE DB], fetching
- IRowset interface
- SQL Server Native Client OLE DB provider, fetching
ms.assetid: 5e6dbe36-b682-464d-adfa-8e886f9bd452
author: rothja
ms.author: jroth
ms.openlocfilehash: 435e1d705091814b2544c75772f20882caddf942
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87656381"
---
# <a name="fetching-rows"></a><span data-ttu-id="6542a-102">Выборка строк</span><span class="sxs-lookup"><span data-stu-id="6542a-102">Fetching Rows</span></span>
  <span data-ttu-id="6542a-103">Интерфейс **IRowset** — это базовый интерфейс набора строк.</span><span class="sxs-lookup"><span data-stu-id="6542a-103">The **IRowset** interface is the base rowset interface.</span></span> <span data-ttu-id="6542a-104">Интерфейс **IRowset** предоставляет методы для последовательной выборки строк, извлечения данных из этих строк и управления строками.</span><span class="sxs-lookup"><span data-stu-id="6542a-104">The **IRowset** interface provides methods for fetching rows sequentially, getting the data from those rows, and managing rows.</span></span> <span data-ttu-id="6542a-105">Объекты-получатели используют методы интерфейса **IRowset** для всех базовых операций с набором строк.</span><span class="sxs-lookup"><span data-stu-id="6542a-105">Consumers use the methods in **IRowset** for all basic rowset operations.</span></span> <span data-ttu-id="6542a-106">Сюда входят выборка и освобождение строк, а также получение значений столбцов.</span><span class="sxs-lookup"><span data-stu-id="6542a-106">This includes fetching and releasing rows and getting column values.</span></span>  
  
 <span data-ttu-id="6542a-107">Когда объект-получатель получает указатель интерфейса для набора строк, первым шагом обычно является определение свойств этого набора строк с помощью метода **IRowsetInfo::GetProperties**.</span><span class="sxs-lookup"><span data-stu-id="6542a-107">When a consumer obtains an interface pointer on a rowset, the first step is ordinarily to determine the capabilities of the rowset by using the **IRowsetInfo::GetProperties** method.</span></span> <span data-ttu-id="6542a-108">Этот метод возвращает сведения об интерфейсах, предоставляемых набором строк, а также о свойствах набора строк, не отображаемых в качестве отдельных интерфейсов, таких как максимальное количество активных строк и количество строк, операции обновления которых одновременно ожидают в очереди.</span><span class="sxs-lookup"><span data-stu-id="6542a-108">This returns information about the interfaces exposed by the rowset and also capabilities of the rowset that do not show up as distinct interfaces, such as the maximum number of active rows and the number of rows that can have pending updates at the same time.</span></span>  
  
 <span data-ttu-id="6542a-109">Следующим шагом потребителя является определение характеристик или метаданных столбцов в наборе строк.</span><span class="sxs-lookup"><span data-stu-id="6542a-109">The next step for consumers is to determine the characteristics, or metadata, of the columns in the rowset.</span></span> <span data-ttu-id="6542a-110">Для этого можно воспользоваться методом **IColumnsInfo** для получения простых сведений о столбце или методом **IColumnsRowset** для получения расширенных сведений о столбце.</span><span class="sxs-lookup"><span data-stu-id="6542a-110">For this they use the **IColumnsInfo** method for simple column information or the **IColumnsRowset** method for extended column information.</span></span> <span data-ttu-id="6542a-111">Метод **GetColumnInfo** возвращает следующие сведения.</span><span class="sxs-lookup"><span data-stu-id="6542a-111">The **GetColumnInfo** method returns the following information:</span></span>  
  
-   <span data-ttu-id="6542a-112">Количество столбцов в результирующем наборе.</span><span class="sxs-lookup"><span data-stu-id="6542a-112">The number of columns in the result set.</span></span>  
  
-   <span data-ttu-id="6542a-113">Массив структур DBCOLUMNINFO, по одной на столбец.</span><span class="sxs-lookup"><span data-stu-id="6542a-113">An array of DBCOLUMNINFO structures, one per column.</span></span>  
  
     <span data-ttu-id="6542a-114">Порядок структур соответствует порядку столбцов в наборе строк.</span><span class="sxs-lookup"><span data-stu-id="6542a-114">The order of the structures is the order in which the columns appear in the rowset.</span></span> <span data-ttu-id="6542a-115">Каждая структура DBCOLUMNINFO включает метаданные столбца, такие как имя столбца, порядковый номер столбца, максимально возможная длина значения в столбце, тип данных в столбце, точность и длина.</span><span class="sxs-lookup"><span data-stu-id="6542a-115">Each DBCOLUMNINFO structure includes column metadata, such as column name, ordinal of the column, maximum possible length of a value in the column, data type of the column, precision, and length.</span></span>  
  
-   <span data-ttu-id="6542a-116">Указатель хранилища для всех строковых значений в одном блоке распределения.</span><span class="sxs-lookup"><span data-stu-id="6542a-116">The pointer to a storage for all string values within a single allocation block.</span></span>  
  
 <span data-ttu-id="6542a-117">Потребитель определяет, какие столбцы ему требуются, либо на основе метаданных, либо на основе текста команды, создавшей набор строк.</span><span class="sxs-lookup"><span data-stu-id="6542a-117">The consumer determines which columns it needs either from the metadata or based on the text command that generated the rowset.</span></span> <span data-ttu-id="6542a-118">Он определяет порядковые номера необходимых столбцов на основе сведений об упорядочивании, возвращенных методом **IColumnsInfo**, или на основе порядковых номеров в наборе строк метаданных столбцов, возвращаемых методом **IColumnsRowset**.</span><span class="sxs-lookup"><span data-stu-id="6542a-118">It determines the ordinals of the needed columns from the ordering of the column information returned by **IColumnsInfo** or from the ordinals in the column metadata rowset returned by **IColumnsRowset**.</span></span>  
  
 <span data-ttu-id="6542a-119">Интерфейсы **IColumnsInfo** и **IColumnsRowset** используются для извлечения сведений о столбце из набора строк.</span><span class="sxs-lookup"><span data-stu-id="6542a-119">The **IColumnsInfo** and **IColumnsRowset** interfaces are used to extract information about the columns in the rowset.</span></span> <span data-ttu-id="6542a-120">Интерфейс **IColumnsInfo** возвращает ограниченный набор сведений, тогда как интерфейс **IColumnsRowset** предоставляет все метаданные.</span><span class="sxs-lookup"><span data-stu-id="6542a-120">The **IColumnsInfo** interface returns a limited set of information, whereas **IColumnsRowset** provides all the metadata.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6542a-121">В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] версии 7.0 и более ранних необязательный столбец метаданных DBCOLUMN_COMPUTEMODE, возвращаемый методом **IColumnsInfo::GetColumnsInfo**, содержит значение DBSTATUS_S_ISNULL (а не значения, указывающие, является ли столбец вычисляемым), так как он не может установить, является ли вычисляемым базовый столбец.</span><span class="sxs-lookup"><span data-stu-id="6542a-121">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] version 7.0 and earlier, the optional metadata column DBCOLUMN_COMPUTEMODE returned by **IColumnsInfo::GetColumnsInfo** returns DBSTATUS_S_ISNULL (instead of the values describing whether the column is computed) because it cannot be determined whether the underlying column is computed.</span></span>  
  
 <span data-ttu-id="6542a-122">Порядковые номера используются для указания привязок к столбцу.</span><span class="sxs-lookup"><span data-stu-id="6542a-122">The ordinals are used to specify a binding to a column.</span></span> <span data-ttu-id="6542a-123">Привязка — это структура, связывающая элемент пользовательской структуры со столбцом.</span><span class="sxs-lookup"><span data-stu-id="6542a-123">A binding is a structure that associates an element of the consumer's structure with a column.</span></span> <span data-ttu-id="6542a-124">Привязываться может значение данных, длина или значение состояния столбца.</span><span class="sxs-lookup"><span data-stu-id="6542a-124">The binding can bind the data value, length, and status value of the column.</span></span>  
  
 <span data-ttu-id="6542a-125">Набор привязок объединяется в метод доступа.</span><span class="sxs-lookup"><span data-stu-id="6542a-125">A set of bindings is gathered together in an accessor.</span></span> <span data-ttu-id="6542a-126">Он создается с помощью метода **IAccessor::CreateAccessor**.</span><span class="sxs-lookup"><span data-stu-id="6542a-126">This is created by using the **IAccessor::CreateAccessor** method.</span></span> <span data-ttu-id="6542a-127">Метод доступа может содержать несколько привязок, чтобы данные из нескольких столбцов можно было получать или задавать одним вызовом.</span><span class="sxs-lookup"><span data-stu-id="6542a-127">An accessor can contain multiple bindings so that the data for multiple columns can be retrieved or set in a single call.</span></span> <span data-ttu-id="6542a-128">Потребитель может создать несколько методов доступа для различных способов использования в различных частях приложения.</span><span class="sxs-lookup"><span data-stu-id="6542a-128">The consumer can create several accessors to match different usage patterns in different parts of the application.</span></span> <span data-ttu-id="6542a-129">Можно создавать и освобождать методы доступа, пока существует набор строк.</span><span class="sxs-lookup"><span data-stu-id="6542a-129">It can create and release accessors while the rowset remains in existence.</span></span>  
  
 <span data-ttu-id="6542a-130">Для выборки строк из базы данных объект-получатель вызывает метод, например **IRowset::GetNextRows** или **IRowsetLocate::GetRowsAt**.</span><span class="sxs-lookup"><span data-stu-id="6542a-130">To fetch rows from the database, the consumer calls a method, such as **IRowset::GetNextRows** or **IRowsetLocate::GetRowsAt**.</span></span> <span data-ttu-id="6542a-131">Эти операции выборки помещают данные строк с сервера в буфер строк поставщика.</span><span class="sxs-lookup"><span data-stu-id="6542a-131">These fetch operations put row data from the server into the row buffer of the provider.</span></span> <span data-ttu-id="6542a-132">Потребитель не имеет прямого доступа к буферу строк поставщика.</span><span class="sxs-lookup"><span data-stu-id="6542a-132">The consumer does not have direct access to the row buffer of the provider.</span></span> <span data-ttu-id="6542a-133">Объект-получатель использует метод **IRowset::GetData** для копирования данных из буфера поставщика в буфер объекта-получателя и метод **IRowsetChange::SetData** для копирования изменений из буфера объекта-получателя в буфер поставщика.</span><span class="sxs-lookup"><span data-stu-id="6542a-133">The consumer uses **IRowset::GetData** to copy data from the buffer of the provider to the consumer buffer and **IRowsetChange::SetData** to copy data changes from the consumer buffer to the provider buffer.</span></span>  
  
 <span data-ttu-id="6542a-134">Объект-получатель вызывает метод **GetData** и передает дескриптор строке и методу доступа, а указатель буферу, выделенному объектом-получателем.</span><span class="sxs-lookup"><span data-stu-id="6542a-134">The consumer calls the **GetData** method and passes the handle to a row, the handle to an accessor, and a pointer to a consumer-allocated buffer.</span></span> <span data-ttu-id="6542a-135">Метод **GetData** преобразует данные и возвращает столбцы, как указано в привязках, использовавшихся для создания метода доступа.</span><span class="sxs-lookup"><span data-stu-id="6542a-135">**GetData** converts the data and returns the columns as specified in the bindings used to create the accessor.</span></span> <span data-ttu-id="6542a-136">Объект-получатель может вызвать метод**GetData** несколько раз для одной строки, используя разные методы доступа и буферы, следовательно, он может получить несколько копий одних и тех же данных.</span><span class="sxs-lookup"><span data-stu-id="6542a-136">The consumer can call **GetData** more than one time for a row, using different accessors and buffers and therefore the consumer can obtain multiple copies of the same data.</span></span>  
  
 <span data-ttu-id="6542a-137">Данные из столбцов с переменной длиной могут обрабатываться различными способами.</span><span class="sxs-lookup"><span data-stu-id="6542a-137">Data from variable-length columns can be treated several ways.</span></span> <span data-ttu-id="6542a-138">Прежде всего, такие столбцы могут быть привязаны к конечному разделу структуры потребителя.</span><span class="sxs-lookup"><span data-stu-id="6542a-138">First, such columns can be bound to a finite section of the consumer's structure.</span></span> <span data-ttu-id="6542a-139">Это вызывает усечение, если длина данных превышает размер буфера.</span><span class="sxs-lookup"><span data-stu-id="6542a-139">This causes truncation when the length of the data exceeds the length of the buffer.</span></span> <span data-ttu-id="6542a-140">Потребитель может определить, что произошло усечение, проверив состояние DBSTATUS_S_TRUNCATED.</span><span class="sxs-lookup"><span data-stu-id="6542a-140">The consumer can determine that truncation has occurred by checking for the status DBSTATUS_S_TRUNCATED.</span></span> <span data-ttu-id="6542a-141">Возвращаемая длина — это всегда действительная длина в байтах, соответственно, потребитель может также определить, сколько данных было усечено.</span><span class="sxs-lookup"><span data-stu-id="6542a-141">The returned length is always the true length in bytes, so that the consumer also can determine how much data was truncated.</span></span>  
  
 <span data-ttu-id="6542a-142">Когда объект-получатель завершает выборку или обновление строк, он освобождает их с помощью метода **ReleaseRows**.</span><span class="sxs-lookup"><span data-stu-id="6542a-142">When the consumer has finished fetching or updating rows, it releases them with the **ReleaseRows** method.</span></span> <span data-ttu-id="6542a-143">Это позволяет высвободить ресурсы, затраченные на хранение копии строк в наборе, и создает свободное пространство для новых строк.</span><span class="sxs-lookup"><span data-stu-id="6542a-143">This releases resources from the copy of the rows in the rowset and makes room for new rows.</span></span> <span data-ttu-id="6542a-144">Потребитель затем может повторить цикл выборки или создания строк и доступа к данным в них.</span><span class="sxs-lookup"><span data-stu-id="6542a-144">The consumer can then repeat its cycle of fetching or creating rows and accessing the data in them.</span></span>  
  
 <span data-ttu-id="6542a-145">Завершив работу с набором строк, объект-получатель вызывает метод **IAccessor::ReleaseAccessor** для освобождения метода доступа.</span><span class="sxs-lookup"><span data-stu-id="6542a-145">When the consumer is finished with the rowset, it calls the **IAccessor::ReleaseAccessor** method to release any accessor.</span></span> <span data-ttu-id="6542a-146">Он вызывает метод **IUnknown::Release** для всех интерфейсов, предоставленных набором строк, для освобождения набора строк.</span><span class="sxs-lookup"><span data-stu-id="6542a-146">It calls the **IUnknown::Release** method on all interfaces exposed by the rowset to release the rowset.</span></span> <span data-ttu-id="6542a-147">После освобождения набора строк принудительно освобождаются все оставшиеся строки или методы доступа, которые могут удерживаться потребителем.</span><span class="sxs-lookup"><span data-stu-id="6542a-147">When the rowset is released, it forces the release of any remaining rows or accessors the consumer may hold.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="6542a-148">в этом разделе</span><span class="sxs-lookup"><span data-stu-id="6542a-148">In This Section</span></span>  
  
-   [<span data-ttu-id="6542a-149">Следующая позиция выборки</span><span class="sxs-lookup"><span data-stu-id="6542a-149">Next Fetch Position</span></span>](fetching-rows-next-fetch-position.md)  
  
## <a name="see-also"></a><span data-ttu-id="6542a-150">См. также:</span><span class="sxs-lookup"><span data-stu-id="6542a-150">See Also</span></span>  
 [<span data-ttu-id="6542a-151">Наборы строк</span><span class="sxs-lookup"><span data-stu-id="6542a-151">Rowsets</span></span>](rowsets.md)  
  
  
