---
title: Недопустимые символы и правила экранирования | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- FOR XML clause, invalid characters
- FOR XML clause, escape rules
ms.assetid: f2e9b997-f400-4963-b225-59d46c6b93e8
author: rothja
ms.author: jroth
ms.openlocfilehash: 8624a31dea4e97e05da6d86c3c0c518b9c4d0aba
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750559"
---
# <a name="invalid-characters-and-escape-rules"></a>Недопустимые символы и правила экранирования
  В данном разделе описана обработка недопустимых символов XML при помощи предложения FOR XML и перечислены правила экранирования для символов, недопустимых в XML-именах.  
  
## <a name="for-xml-and-invalid-characters"></a>Предложение FOR XML и недопустимые символы  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] преобразует недопустимые XML-символы в сущности, когда они возвращаются в запросах FOR XML, не содержащих директивы TYPE.  
  
 Хотя синтаксические анализаторы, следующие стандарту XML 1.0, будут выводить ошибку независимо от того, преобразованы ли такие символы в сущности, это поведение более соответствует XML 1.1. Представление таких символов в виде сущностей также может оказаться более согласованным с будущими версиями стандарта XML. Кроме того, таким образом упрощается отладка, так как становится виден элемент кода, содержащий недопустимый символ.  
  
 Пользователям инструментов XML не требуется делать никаких обновлений, так как анализатор XML в любом случае выдаст ошибку, встретив в потоке данных недопустимый символ. При использовании других инструментов это изменение может потребовать обновления программной логики для поиска таких символов в виде сущностей.  
  
 Следующие символы пробела в результатах запросов FOR XML преобразуются в сущности иным образом с целью их сохранения для обратных преобразований.  
  
-   В содержимом и атрибутах элементов: **hex(0D)** (возврат каретки)  
  
-   В содержимом атрибутов: **hex(09)** (табуляция), **hex(0A)** (перевод строки)  
  
 Данные символы сохраняются в выходе, и средство синтаксического анализа не выполняет их нормализацию.  
  
## <a name="escape-rules"></a>Правила экранирования  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , содержащие недопустимые в именах XML символы, например пробелы, преобразуются в имена XML таким образом, при котором недопустимые символы переводятся в представление соответствующими численными сущностями с экранирующим символом.  
  
 Есть только два небуквенных символа, которые могут встречаться в имени XML: двоеточие (:) и подчеркивание (_). Так как двоеточие уже зарезервировано для пространств имен, в качестве escape-символа используется подчеркивание. Далее перечислены правила кодирования недопустимых символов.  
  
-   Все символы UCS-2, которые не могут входить имена XML в соответствии со стандартом XML 1.0, экранируются как _xHHHH\_. Здесь сочетание HHHH будет замещено на четырехразрядный шестнадцатеричный код символа в UCS-2, где самым старшим является первый разряд. Например, имя таблицы **Order Details** будет закодировано как Order_x0020_Details.  
  
-   Символы, не входящие в диапазон UCS-2 (дополнения UCS-4 в диапазоне от U+00010000 до U+0010FFFF), кодируются как _xHHHHHHHH\_. Здесь сочетание HHHHHHHH будет замещено на восьмиразрядный шестнадцатеричный код символа в UCS-4, если используется режим обратной совместимости с SQL Server 2000. В иных случаях символы кодируются как _xHHHHHH\_в целях соответствия стандарту ISO.  
  
-   Символ нижнего подчеркивания не нуждается в экранировании, если за ним не следует символ x. Например, имя таблицы **Данные заказа** не будет закодировано.  
  
-   Двоеточие в идентификаторах не кодируется. Поэтому запрос FOR XML может формировать элемент пространства имени и имена атрибутов. Например, следующий запрос формирует атрибут пространства имен с двоеточием в имени:  
  
    ```  
    SELECT 'namespace-urn' as 'xmlns:namespace',   
     1 as 'namespace:a'   
    FOR XML RAW  
    ```  
  
     Результат этого запроса будет таким:  
  
    ```  
    <row xmlns:namespace="namespace-urn" namespace:a="1"/>  
    ```  
  
     Обратите внимание, что для добавления пространств имен XML рекомендуется использовать предложение WITH XMLNAMESPACES.  
  
## <a name="see-also"></a>См. также:  
 [FOR XML (SQL Server)](for-xml-sql-server.md)  
  
  
