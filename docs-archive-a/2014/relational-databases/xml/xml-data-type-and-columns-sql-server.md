---
title: Столбцы и типы XML-данных (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
ms.assetid: 00db8f21-7d4b-4347-ae43-3a7c314d2fa1
author: rothja
ms.author: jroth
ms.openlocfilehash: 575f8b8fc640ea5ff671a6b0cef4208e7447898f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750547"
---
# <a name="xml-data-type-and-columns-sql-server"></a><span data-ttu-id="bc79e-102">Столбцы и типы XML-данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="bc79e-102">XML Data Type and Columns (SQL Server)</span></span>
  <span data-ttu-id="bc79e-103">В этом разделе обсуждаются преимущества и ограничения `xml` типа данных в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и помогает выбрать способ хранения XML-данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-103">This topic discusses the advantages and the limitations of the `xml` data type in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], and helps you to choose how to store XML data.</span></span>  
  
## <a name="relational-or-xml-data-model"></a><span data-ttu-id="bc79e-104">Модель данных: реляционная или XML</span><span class="sxs-lookup"><span data-stu-id="bc79e-104">Relational or XML Data Model</span></span>  
 <span data-ttu-id="bc79e-105">Если данные хорошо структурированы и известна их схема, то для их хранения наверняка лучше всего подойдет реляционная модель.</span><span class="sxs-lookup"><span data-stu-id="bc79e-105">If your data is highly structured with known schema, the relational model is likely to work best for data storage.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="bc79e-106">включает все необходимые для этого средства и функции.</span><span class="sxs-lookup"><span data-stu-id="bc79e-106">provides the required functionality and tools you may need.</span></span> <span data-ttu-id="bc79e-107">С другой стороны, если данные структурированы частично, не структурированы или если их структура неизвестна, следует подумать о моделировании таких данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-107">On the other hand, if the structure is semi-structured or unstructured, or unknown, you have to give consideration to modeling such data.</span></span>  
  
 <span data-ttu-id="bc79e-108">XML является удачным выбором, если нужна не зависящая от платформы модель, позволяющая гарантировать совместимость данных за счет применения структурной и семантической разметки.</span><span class="sxs-lookup"><span data-stu-id="bc79e-108">XML is a good choice if you want a platform-independent model in order to ensure portability of the data by using structural and semantic markup.</span></span> <span data-ttu-id="bc79e-109">Кроме того, этот вариант уместен, если выполняются некоторые из следующих условий:</span><span class="sxs-lookup"><span data-stu-id="bc79e-109">Additionally, it is an appropriate option if some of the following properties are satisfied:</span></span>  
  
-   <span data-ttu-id="bc79e-110">данные разрежены, их структура неизвестна или их структура может значительно измениться в будущем;</span><span class="sxs-lookup"><span data-stu-id="bc79e-110">Your data is sparse or you do not know the structure of the data, or the structure of your data may change significantly in the future.</span></span>  
  
-   <span data-ttu-id="bc79e-111">данные представляют иерархию контейнеров, а не ссылки между сущностями, и могут быть рекурсивными;</span><span class="sxs-lookup"><span data-stu-id="bc79e-111">Your data represents containment hierarchy, instead of references among entities, and may be recursive.</span></span>  
  
-   <span data-ttu-id="bc79e-112">данные упорядочены;</span><span class="sxs-lookup"><span data-stu-id="bc79e-112">Order is inherent in your data.</span></span>  
  
-   <span data-ttu-id="bc79e-113">требуется запрашивать данные или обновлять их фрагменты на основе их структуры.</span><span class="sxs-lookup"><span data-stu-id="bc79e-113">You want to query into the data or update parts of it, based on its structure.</span></span>  
  
 <span data-ttu-id="bc79e-114">Если ни одно из этих условий не выполняется, следует выбрать реляционную модель данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-114">If none of these conditions is met, you should use the relational data model.</span></span> <span data-ttu-id="bc79e-115">Например, если данные представлены в формате XML, но приложение пользуется базой данных только для их хранения и извлечения, то для этого вполне подойдет тип данных `[n]varchar(max)`.</span><span class="sxs-lookup"><span data-stu-id="bc79e-115">For example, if your data is in XML format but your application just uses the database to store and retrieve the data, an `[n]varchar(max)` column is all you require.</span></span> <span data-ttu-id="bc79e-116">Хранение данных в XML-столбце обеспечивает дополнительные преимущества.</span><span class="sxs-lookup"><span data-stu-id="bc79e-116">Storing the data in an XML column has additional benefits.</span></span> <span data-ttu-id="bc79e-117">В их число входят проверка структуры и правильности данных, а также поддержка детализированных запросов и обновлений XML-данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-117">This includes having the engine determine that the data is well formed or valid, and also includes support for fine-grained query and updates into the XML data.</span></span>  
  
## <a name="reasons-for-storing-xml-data-in-sql-server"></a><span data-ttu-id="bc79e-118">Причины хранения XML-данных в SQL Server</span><span class="sxs-lookup"><span data-stu-id="bc79e-118">Reasons for Storing XML Data in SQL Server</span></span>  
 <span data-ttu-id="bc79e-119">Ниже приведены некоторые условия, при которых лучше использовать собственные XML-функции [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , а не управлять XML-данными, хранящимися в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="bc79e-119">Following are some of the reasons to use native XML features in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instead of managing your XML data in the file system:</span></span>  
  
-   <span data-ttu-id="bc79e-120">Требуется эффективно распространять, запрашивать и изменять свои XML-данные на основе транзакций.</span><span class="sxs-lookup"><span data-stu-id="bc79e-120">You want to share, query, and modify your XML data in an efficient and transacted way.</span></span> <span data-ttu-id="bc79e-121">Большое значение имеет высокая детализация доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="bc79e-121">Fine-grained data access is important to your application.</span></span> <span data-ttu-id="bc79e-122">Например, иногда нужно извлекать некоторые разделы XML-документа или вставлять в него новые разделы без замены всего документа.</span><span class="sxs-lookup"><span data-stu-id="bc79e-122">For example, you may want to extract some of the sections within an XML document, or you may want to insert a new section without replacing your whole document.</span></span>  
  
-   <span data-ttu-id="bc79e-123">Предстоит иметь дело с реляционными и XML-данными, и необходимо обеспечить их совместимость в приложении.</span><span class="sxs-lookup"><span data-stu-id="bc79e-123">You have relational data and XML data and you want interoperability between both relational and XML data within your application.</span></span>  
  
-   <span data-ttu-id="bc79e-124">Необходима языковая поддержка запросов и модификации данных в приложениях, охватывающих несколько доменов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-124">You need language support for query and data modification for cross-domain applications.</span></span>  
  
-   <span data-ttu-id="bc79e-125">Требуется, чтобы сервер гарантировал верность структуры данных и, возможно, проверял данные в соответствии с XML-схемами.</span><span class="sxs-lookup"><span data-stu-id="bc79e-125">You want the server to guarantee that the data is well formed and also optionally validate your data according to XML schemas.</span></span>  
  
-   <span data-ttu-id="bc79e-126">Требуется проиндексировать XML-данные для оптимизации обработки запросов и улучшения масштабируемости и использовать эффективный оптимизатор запросов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-126">You want indexing of XML data for efficient query processing and good scalability, and the use of a first-rate query optimizer.</span></span>  
  
-   <span data-ttu-id="bc79e-127">Требуется обращаться к XML-данным, используя технологии SOAP, ADO.NET и OLE DB.</span><span class="sxs-lookup"><span data-stu-id="bc79e-127">You want SOAP, ADO.NET, and OLE DB access to XML data.</span></span>  
  
-   <span data-ttu-id="bc79e-128">Требуется использовать для управления XML-данными средства администрирования, реализованные в сервере баз данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-128">You want to use administrative functionality of the database server for managing your XML data.</span></span> <span data-ttu-id="bc79e-129">Примерами таких задач управления могут служить резервное копирование данных, их восстановление и репликация.</span><span class="sxs-lookup"><span data-stu-id="bc79e-129">For example, this would be backup, recovery, and replication.</span></span>  
  
 <span data-ttu-id="bc79e-130">Если же ни одно из этих условий не выполняется, то для хранения данных лучше использовать отличный от XML тип больших объектов (например, `[n]varchar(max)` или `varbinary(max)`).</span><span class="sxs-lookup"><span data-stu-id="bc79e-130">If none of these conditions is satisfied, it may be better to store your data as a non-XML, large object type, such as `[n]varchar(max)` or `varbinary(max)`.</span></span>  
  
## <a name="xml-storage-options"></a><span data-ttu-id="bc79e-131">Варианты хранения XML-данных</span><span class="sxs-lookup"><span data-stu-id="bc79e-131">XML Storage Options</span></span>  
 <span data-ttu-id="bc79e-132">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает несколько вариантов хранения XML-данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-132">The storage options for XML in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] include the following:</span></span>  
  
-   <span data-ttu-id="bc79e-133">Естественное хранение в виде типа `xml`</span><span class="sxs-lookup"><span data-stu-id="bc79e-133">Native storage as `xml` data type</span></span>  
  
     <span data-ttu-id="bc79e-134">Данные при этом хранятся во внутреннем представлении, которое обеспечивает неизменность XML-содержимого данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-134">The data is stored in an internal representation that preserves the XML content of the data.</span></span> <span data-ttu-id="bc79e-135">Это внутреннее представление включает в себя сведения об иерархии контейнеров, порядке документов и значений элементов и атрибутов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-135">This internal representation includes information about the containment hierarchy, document order, and element and attribute values.</span></span> <span data-ttu-id="bc79e-136">Точнее говоря, при этом обеспечивается неизменность InfoSet-содержимого XML-данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-136">Specifically, the InfoSet content of the XML data is preserved.</span></span> <span data-ttu-id="bc79e-137">Дополнительные сведения об информационном наборе см. в разделе [http://www.w3.org/TR/xml-infoset](https://go.microsoft.com/fwlink/?LinkId=48843).</span><span class="sxs-lookup"><span data-stu-id="bc79e-137">For more information about InfoSet, visit [http://www.w3.org/TR/xml-infoset](https://go.microsoft.com/fwlink/?LinkId=48843).</span></span> <span data-ttu-id="bc79e-138">InfoSet-содержимое не всегда идентично текстовым XML-данным, потому что следующая информация при этом не сохраняется: несущественные пробелы, порядок атрибутов, префиксы пространств имен и XML-декларация.</span><span class="sxs-lookup"><span data-stu-id="bc79e-138">The InfoSet content may not be an identical copy of the text XML, because the following information is not retained: insignificant white spaces, order of attributes, namespace prefixes, and XML declaration.</span></span>  
  
     <span data-ttu-id="bc79e-139">Для типизированного `xml` типа данных — это `xml` тип данных, привязанный к XML-схемам, набор сведений о проверке после схемы (PSVI) добавляет сведения о типах в информационный набор и кодируется во внутреннее представление.</span><span class="sxs-lookup"><span data-stu-id="bc79e-139">For typed `xml` data type, an `xml` data type bound to XML schemas, the post-schema validation InfoSet (PSVI) adds type information to the InfoSet and is encoded in the internal representation.</span></span> <span data-ttu-id="bc79e-140">Это значительно ускоряет синтаксический анализ.</span><span class="sxs-lookup"><span data-stu-id="bc79e-140">This improves parsing speed significantly.</span></span> <span data-ttu-id="bc79e-141">Дополнительные сведения см. в спецификациях XML-схемы W3C на страницах [http://www.w3.org/TR/xmlschema-1](https://go.microsoft.com/fwlink/?LinkId=48881) и [http://www.w3.org/TR/xmlschema-2](https://go.microsoft.com/fwlink/?LinkId=4871).</span><span class="sxs-lookup"><span data-stu-id="bc79e-141">For more information, see the W3C XML Schema specifications at [http://www.w3.org/TR/xmlschema-1](https://go.microsoft.com/fwlink/?LinkId=48881) and [http://www.w3.org/TR/xmlschema-2](https://go.microsoft.com/fwlink/?LinkId=4871).</span></span>  
  
-   <span data-ttu-id="bc79e-142">Сопоставление XML-данных и данных, хранящихся в реляционном формате</span><span class="sxs-lookup"><span data-stu-id="bc79e-142">Mapping between XML and relational storage</span></span>  
  
     <span data-ttu-id="bc79e-143">Используя аннотированную схему (AXSD), можно разбить XML на столбцы одной или нескольких таблиц.</span><span class="sxs-lookup"><span data-stu-id="bc79e-143">By using an annotated schema (AXSD), the XML is decomposed into columns in one or more tables.</span></span> <span data-ttu-id="bc79e-144">Это обеспечивает правильность данных на реляционном уровне.</span><span class="sxs-lookup"><span data-stu-id="bc79e-144">This preserves fidelity of the data at the relational level.</span></span> <span data-ttu-id="bc79e-145">В результате гарантируется сохранность иерархической структуры данных, хотя порядок элементов не учитывается.</span><span class="sxs-lookup"><span data-stu-id="bc79e-145">As a result, the hierarchical structure is preserved although order among elements is ignored.</span></span> <span data-ttu-id="bc79e-146">Схема не может быть рекурсивной.</span><span class="sxs-lookup"><span data-stu-id="bc79e-146">The schema cannot be recursive.</span></span>  
  
-   <span data-ttu-id="bc79e-147">Хранение больших объектов, `[n]varchar(max)` и `varbinary(max)`</span><span class="sxs-lookup"><span data-stu-id="bc79e-147">Large object storage, `[n]varchar(max)` and `varbinary(max)`</span></span>  
  
     <span data-ttu-id="bc79e-148">При этом хранится идентичная копия данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-148">An identical copy of the data is stored.</span></span> <span data-ttu-id="bc79e-149">Это полезно в приложениях специального назначения, например в приложениях, обрабатывающих юридическую документацию.</span><span class="sxs-lookup"><span data-stu-id="bc79e-149">This is useful for special-purpose applications such as legal documents.</span></span> <span data-ttu-id="bc79e-150">Большинству приложений точная копия данных не нужна — им хватает XML-содержимого (правильности элементов InfoSet).</span><span class="sxs-lookup"><span data-stu-id="bc79e-150">Most applications do not require an exact copy and are satisfied with the XML content (InfoSet fidelity).</span></span>  
  
 <span data-ttu-id="bc79e-151">Обычно используется сочетание этих подходов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-151">Generally, you may have to use a combination of these approaches.</span></span> <span data-ttu-id="bc79e-152">Например, XML-данные можно сохранить в столбце типа `xml`, производя продвижение его свойств до уровня реляционных столбцов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-152">For example, you may want to store your XML data in an `xml` data type column and promote properties from it into relational columns.</span></span> <span data-ttu-id="bc79e-153">Или вы можете использовать технологию сопоставления для хранения нерекурсивных частей в столбцах, отличных от XML, и только рекурсивных частей в `xml` столбцах типа данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-153">Or, you may want to use mapping technology to store nonrecursive parts in non-XML columns and only the recursive parts in `xml` data type columns.</span></span>  
  
### <a name="choice-of-xml-technology"></a><span data-ttu-id="bc79e-154">Выбор XML-технологии</span><span class="sxs-lookup"><span data-stu-id="bc79e-154">Choice of XML Technology</span></span>  
 <span data-ttu-id="bc79e-155">Выбор между естественным форматом XML и XML-представлениями обычно зависит от следующих факторов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-155">The choice of XML technology, native XML versus XML view, generally depends upon the following factors:</span></span>  
  
-   <span data-ttu-id="bc79e-156">Варианты хранилищ</span><span class="sxs-lookup"><span data-stu-id="bc79e-156">Storage options</span></span>  
  
     <span data-ttu-id="bc79e-157">Иногда XML-данные (например, руководство по продукции) лучше хранить как большой объект, а в других ситуациях — в реляционных столбцах (например, описание товара, преобразованное в формат XML).</span><span class="sxs-lookup"><span data-stu-id="bc79e-157">Your XML data may be more appropriate for large object storage (for example, a product manual), or more amenable to storage in relational columns (for example, a line item converted to XML).</span></span> <span data-ttu-id="bc79e-158">Каждый вариант хранения данных обеспечивает точность документа в разной степени.</span><span class="sxs-lookup"><span data-stu-id="bc79e-158">Each storage option preserves document fidelity to a different extent.</span></span>  
  
-   <span data-ttu-id="bc79e-159">Обработка запросов</span><span class="sxs-lookup"><span data-stu-id="bc79e-159">Query capabilities</span></span>  
  
     <span data-ttu-id="bc79e-160">Иногда один вариант хранения данных лучше другого соответствует природе и интенсивности запросов XML-данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-160">You may find one storage option more appropriate than another, based on the nature of your queries and on the extent to which you query your XML data.</span></span> <span data-ttu-id="bc79e-161">Степень поддержки детализированных запросов XML-данных, например оценки предикатов для XML-узлов, поддерживается двумя технологиями хранения данных в разной степени.</span><span class="sxs-lookup"><span data-stu-id="bc79e-161">Fine-grained query of your XML data, for example, predicate evaluation on XML nodes, is supported to varying degrees in the two storage options.</span></span>  
  
-   <span data-ttu-id="bc79e-162">Индексирование XML-данных</span><span class="sxs-lookup"><span data-stu-id="bc79e-162">Indexing XML data</span></span>  
  
     <span data-ttu-id="bc79e-163">Возможно, потребуется проиндексировать XML-данные, чтобы ускорить обработку XML-запросов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-163">You may want to index the XML data to speed up XML query performance.</span></span> <span data-ttu-id="bc79e-164">Возможности индексирования зависят от технологии хранения данных; для оптимизации рабочей нагрузки нужно выбрать более подходящий вариант.</span><span class="sxs-lookup"><span data-stu-id="bc79e-164">Indexing options vary with the storage options; you have to make the appropriate choice to optimize your workload.</span></span>  
  
-   <span data-ttu-id="bc79e-165">Возможности модификации данных</span><span class="sxs-lookup"><span data-stu-id="bc79e-165">Data modification capabilities</span></span>  
  
     <span data-ttu-id="bc79e-166">Некоторые виды рабочей нагрузки сопряжены с детализированной модификацией XML-данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-166">Some workloads involve fine-grained modification of XML data.</span></span> <span data-ttu-id="bc79e-167">Это может требоваться, например, при добавлении нового раздела в документ, в то время как при решении других задач, таких как обработка веб-содержимого, это не нужно.</span><span class="sxs-lookup"><span data-stu-id="bc79e-167">For example, this can include adding a new section within a document, while other workloads, such as Web content, do not.</span></span> <span data-ttu-id="bc79e-168">Для разработчиков того или иного приложения большое значение может иметь поддержка языка модификации данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-168">Data modification language support may be important for your application.</span></span>  
  
-   <span data-ttu-id="bc79e-169">Поддержка схем</span><span class="sxs-lookup"><span data-stu-id="bc79e-169">Schema support</span></span>  
  
     <span data-ttu-id="bc79e-170">XML-данные можно описать при помощи схемы, которая может быть, а может и не быть документом XML-схемы.</span><span class="sxs-lookup"><span data-stu-id="bc79e-170">Your XML data may be described by a schema that may or may not be an XML schema document.</span></span> <span data-ttu-id="bc79e-171">Поддержка связанных со схемой XML-данных зависит от XML-технологии.</span><span class="sxs-lookup"><span data-stu-id="bc79e-171">The support for schema-bound XML depends upon the XML technology.</span></span>  
  
 <span data-ttu-id="bc79e-172">Кроме того, технологии хранения XML-данных различаются по быстродействию.</span><span class="sxs-lookup"><span data-stu-id="bc79e-172">Different choices also have different performance characteristics.</span></span>  
  
### <a name="native-xml-storage"></a><span data-ttu-id="bc79e-173">Хранение XML-данных в собственном формате</span><span class="sxs-lookup"><span data-stu-id="bc79e-173">Native XML Storage</span></span>  
 <span data-ttu-id="bc79e-174">XML-данные можно хранить на сервере в столбце типа `xml`.</span><span class="sxs-lookup"><span data-stu-id="bc79e-174">You can store your XML data in an `xml` data type column at the server.</span></span> <span data-ttu-id="bc79e-175">Этот вариант уместен, если выполняются следующие условия:</span><span class="sxs-lookup"><span data-stu-id="bc79e-175">This is an appropriate choice if the following applies:</span></span>  
  
-   <span data-ttu-id="bc79e-176">необходим простой способ хранения XML-данных на сервере, при этом нужно сохранить порядок и структуру документа;</span><span class="sxs-lookup"><span data-stu-id="bc79e-176">You want a straightforward way to store your XML data at the server and, at the same time, preserve document order and document structure.</span></span>  
  
-   <span data-ttu-id="bc79e-177">существует вероятность отсутствия схемы XML-данных;</span><span class="sxs-lookup"><span data-stu-id="bc79e-177">You may or may not have a schema for your XML data.</span></span>  
  
-   <span data-ttu-id="bc79e-178">требуется запрашивать и изменять XML-данные;</span><span class="sxs-lookup"><span data-stu-id="bc79e-178">You want to query and modify your XML data.</span></span>  
  
-   <span data-ttu-id="bc79e-179">требуется проиндексировать XML-данные для ускорения обработки запросов;</span><span class="sxs-lookup"><span data-stu-id="bc79e-179">You want to index the XML data for faster query processing.</span></span>  
  
-   <span data-ttu-id="bc79e-180">требуется использовать в приложении представления системного каталога для управления XML-данными и XML-схемами.</span><span class="sxs-lookup"><span data-stu-id="bc79e-180">Your application needs system catalog views to administer your XML data and XML schemas.</span></span>  
  
 <span data-ttu-id="bc79e-181">Механизм хранения XML-данных в естественном формате полезен, если есть XML-документы, имеющие разную структуру, или XML-документы, соответствующие разным или сложным схемам, которые слишком трудно сопоставить с реляционными структурами.</span><span class="sxs-lookup"><span data-stu-id="bc79e-181">Native XML storage is useful when you have XML documents that have a range of structures, or you have XML documents that conform to different or complex schemas that are too hard to map to relational structures.</span></span>  
  
#### <a name="example-modeling-xml-data-using-the-xml-data-type"></a><span data-ttu-id="bc79e-182">Пример моделирования XML-данных с использованием типа данных XML</span><span class="sxs-lookup"><span data-stu-id="bc79e-182">Example: Modeling XML Data Using the xml Data Type</span></span>  
 <span data-ttu-id="bc79e-183">Допустим, мы имеем дело с руководством по продукции в формате XML, которое охватывает ряд тем, разделенных на несколько глав, включающих по несколько разделов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-183">Consider a product manual in XML format that is made up of a separate chapter for each topic and that has multiple sections within each chapter.</span></span> <span data-ttu-id="bc79e-184">Раздел может содержать подразделы.</span><span class="sxs-lookup"><span data-stu-id="bc79e-184">A section can contain subsections.</span></span> <span data-ttu-id="bc79e-185">Таким образом, элемент \<section> является рекурсивным.</span><span class="sxs-lookup"><span data-stu-id="bc79e-185">As a result, \<section> is a recursive element.</span></span> <span data-ttu-id="bc79e-186">Руководства по продукции содержат большой объем смешанной информации, диаграмм и технических характеристик; эти данные структурированы частично.</span><span class="sxs-lookup"><span data-stu-id="bc79e-186">Product manuals contain a large amount of mixed content, diagrams, and technical material; the data is semi-structured.</span></span> <span data-ttu-id="bc79e-187">Пользователям руководств может пригодиться возможность контекстного поиска интересующих их тем, например подраздела «кластеризованный индекс» в разделе «индексирование», и запроса технических характеристик.</span><span class="sxs-lookup"><span data-stu-id="bc79e-187">Users may want to perform a contextual search for topics of interest such as searching for the section on "clustered index" within the chapter on "indexing", and query technical quantities.</span></span>  
  
 <span data-ttu-id="bc79e-188">Для хранения таких XML-документов прекрасно подходит столбец типа `xml`.</span><span class="sxs-lookup"><span data-stu-id="bc79e-188">An appropriate storage model for your XML documents is an `xml` data type column.</span></span> <span data-ttu-id="bc79e-189">Это позволяет сохранить InfoSet-содержимое XML-данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-189">This preserves the InfoSet content of your XML data.</span></span> <span data-ttu-id="bc79e-190">Индексирование XML-столбца позволяет повысить эффективность обработки запросов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-190">Indexing the XML column benefits query performance.</span></span>  
  
#### <a name="example-retaining-exact-copies-of-xml-data"></a><span data-ttu-id="bc79e-191">Пример сохранения точных копий XML-данных</span><span class="sxs-lookup"><span data-stu-id="bc79e-191">Example: Retaining Exact Copies of XML Data</span></span>  
 <span data-ttu-id="bc79e-192">Предположим, что правительственные законы требуют, чтобы хранились точные текстовые копии XML-документов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-192">For illustration, assume that government regulations require you to retain exact textual copies of your XML documents.</span></span> <span data-ttu-id="bc79e-193">К этой категории могут относиться подписанные документы, юридические постановления и отчеты о биржевых операциях.</span><span class="sxs-lookup"><span data-stu-id="bc79e-193">For example, these could include signed documents, legal documents, or stock transaction orders.</span></span> <span data-ttu-id="bc79e-194">Такие данные можно хранить в столбце типа `[n]varchar(max)`.</span><span class="sxs-lookup"><span data-stu-id="bc79e-194">You may want to store your documents in a `[n]varchar(max)` column.</span></span>  
  
 <span data-ttu-id="bc79e-195">При обработке запросов во время выполнения преобразуйте данные в тип `xml` и выполните для них запрос XQuery.</span><span class="sxs-lookup"><span data-stu-id="bc79e-195">For querying, convert the data to `xml` data type at run time and execute Xquery on it.</span></span> <span data-ttu-id="bc79e-196">Преобразование типов в период выполнения может быть связано со значительной тратой ресурсов, особенно если документ велик.</span><span class="sxs-lookup"><span data-stu-id="bc79e-196">The run-time conversion may be costly, especially when the document is large.</span></span> <span data-ttu-id="bc79e-197">При высокой частоте запросов документы можно дополнительно сохранять в столбце типа `xml` и индексировать именно его, а для возврата точных копий документа использовать столбец `[n]varchar(max)`.</span><span class="sxs-lookup"><span data-stu-id="bc79e-197">If you query frequently, you can redundantly store the documents in an `xml` data type column and index it while you return exact document copies from the `[n]varchar(max)` column.</span></span>  
  
 <span data-ttu-id="bc79e-198">XML-столбец может быть столбцом, вычисляемым на основе столбца `[n]varchar(max)`.</span><span class="sxs-lookup"><span data-stu-id="bc79e-198">The XML column may be a computed column, based on the `[n]varchar(max)` column.</span></span> <span data-ttu-id="bc79e-199">Однако нельзя создать XML-индекс для вычисляемого XML-столбца, а также построить XML-индекс на основе `[n]varchar(max)` `varbinary(max)` столбцов или.</span><span class="sxs-lookup"><span data-stu-id="bc79e-199">However, you cannot create an XML index on a computed, XML column, nor can an XML index be built on `[n]varchar(max)` or `varbinary(max)` columns.</span></span>  
  
### <a name="xml-view-technology"></a><span data-ttu-id="bc79e-200">Технология XML-представлений</span><span class="sxs-lookup"><span data-stu-id="bc79e-200">XML View Technology</span></span>  
 <span data-ttu-id="bc79e-201">Определив соответствие между XML-схемами и таблицами базы данных, можно создать «XML-представление» хранимых данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-201">By defining a mapping between your XML schemas and the tables in a database, you create an "XML view" of your persistent data.</span></span> <span data-ttu-id="bc79e-202">Чтобы заполнить базовые таблицы при помощи XML-представления, можно использовать операцию массовой загрузки XML-данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-202">XML bulk load can be used to populate the underlying tables by using the XML view.</span></span> <span data-ttu-id="bc79e-203">Запрашивать XML-данные можно при помощи технологии XPath версии 1.0, при этом запрос преобразуется в SQL-запросы таблиц.</span><span class="sxs-lookup"><span data-stu-id="bc79e-203">You can query the XML view by using XPath version 1.0; the query is translated to SQL queries on the tables.</span></span> <span data-ttu-id="bc79e-204">Обновления также распространяются на эти таблицы.</span><span class="sxs-lookup"><span data-stu-id="bc79e-204">Similarly, updates are also propagated to those tables.</span></span>  
  
 <span data-ttu-id="bc79e-205">Эта технология полезна в следующих ситуациях:</span><span class="sxs-lookup"><span data-stu-id="bc79e-205">This technology is useful in the following situations:</span></span>  
  
-   <span data-ttu-id="bc79e-206">требуется реализовать ориентированную на XML модель программирования, используя XML-представления существующих реляционных данных;</span><span class="sxs-lookup"><span data-stu-id="bc79e-206">You want to have an XML-centric programming model using XML views over your existing relational data.</span></span>  
  
-   <span data-ttu-id="bc79e-207">есть XSD-схема или XDR-схема XML-данных, которую, возможно, предоставила внешняя партнерская организация;</span><span class="sxs-lookup"><span data-stu-id="bc79e-207">You have a schema (XSD, XDR) for your XML data that an external partner may have provided.</span></span>  
  
-   <span data-ttu-id="bc79e-208">порядок данных не важен, данные таблиц нерекурсивны или максимальная глубина рекурсии не известна заранее;</span><span class="sxs-lookup"><span data-stu-id="bc79e-208">Order is not important in your data, or your query table data is not recursive, or the maximal recursion depth is known in advance.</span></span>  
  
-   <span data-ttu-id="bc79e-209">требуется запрашивать и изменять данные посредством XML-представления с использованием технологии XPath версии 1.0;</span><span class="sxs-lookup"><span data-stu-id="bc79e-209">You want to query and modify the data through the XML view by using XPath version 1.0.</span></span>  
  
-   <span data-ttu-id="bc79e-210">требуется выполнять массовую загрузку XML-данных и распределять их между базовыми таблицами с использованием XML-представления.</span><span class="sxs-lookup"><span data-stu-id="bc79e-210">You want to bulk load XML data and decompose them into the underlying tables by using the XML view.</span></span>  
  
 <span data-ttu-id="bc79e-211">Примерами данных, отвечающих этим условиям, могут служить реляционные данные, предоставляемые веб-службам и средствам обмена данными в форме XML, а также XML-данные с фиксированной схемой.</span><span class="sxs-lookup"><span data-stu-id="bc79e-211">Examples include relational data exposed as XML for data exchange and Web services, and XML data with fixed schema.</span></span> <span data-ttu-id="bc79e-212">Дополнительные сведения см. в [библиотеке MSDN Online](https://go.microsoft.com/fwlink/?linkid=31174).</span><span class="sxs-lookup"><span data-stu-id="bc79e-212">For more information, see the [MSDN Online Library](https://go.microsoft.com/fwlink/?linkid=31174).</span></span>  
  
#### <a name="example-modeling-data-using-an-annotated-xml-schema-axsd"></a><span data-ttu-id="bc79e-213">Пример моделирования данных с использованием аннотированной XML-схемы (AXSD)</span><span class="sxs-lookup"><span data-stu-id="bc79e-213">Example: Modeling Data Using an Annotated XML Schema (AXSD)</span></span>  
 <span data-ttu-id="bc79e-214">Предположим, что есть реляционные данные (например, сведения о заказчиках, заказах и товарах), которые нужно обрабатывать как XML.</span><span class="sxs-lookup"><span data-stu-id="bc79e-214">For illustration, assume that you have existing relational data, such as customers, orders, and line items, that you want to handle as XML.</span></span> <span data-ttu-id="bc79e-215">Определите в этом случае XML-представление, применив схему AXSD к реляционным данным.</span><span class="sxs-lookup"><span data-stu-id="bc79e-215">Define an XML view by using AXSD over the relational data.</span></span> <span data-ttu-id="bc79e-216">XML-представление позволяет выполнять массовую загрузку XML-данных в таблицы, а также запрашивать и обновлять реляционные данные.</span><span class="sxs-lookup"><span data-stu-id="bc79e-216">The XML view allows you to bulk load XML data into your tables and query and update the relational data by using the XML view.</span></span> <span data-ttu-id="bc79e-217">Эта модель особенно эффективна, если требуется обмениваться данными, содержащими XML-разметку, с другими приложениями без приостановления работы приложений SQL.</span><span class="sxs-lookup"><span data-stu-id="bc79e-217">This model is useful if you have to exchange data that contains XML markup with other applications while your SQL applications work uninterrupted.</span></span>  
  
### <a name="hybrid-model"></a><span data-ttu-id="bc79e-218">Комбинированная модель</span><span class="sxs-lookup"><span data-stu-id="bc79e-218">Hybrid Model</span></span>  
 <span data-ttu-id="bc79e-219">Зачастую сочетание столбцов реляционных и `xml` типов данных подходит для моделирования данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-219">Frequently, a combination of relational and `xml` data type columns is appropriate for data modeling.</span></span> <span data-ttu-id="bc79e-220">Некоторые значения XML-данных можно хранить в реляционных столбцах, а остальные или все значения XML — в XML-столбце.</span><span class="sxs-lookup"><span data-stu-id="bc79e-220">Some of the values from your XML data can be stored in relational columns, and the rest, or the whole XML value stored in an XML column.</span></span> <span data-ttu-id="bc79e-221">Это может привести к повышению производительности за счет более полного контроля над индексами, созданными для реляционных столбцов, и параметрами блокировки.</span><span class="sxs-lookup"><span data-stu-id="bc79e-221">This may yield better performance in that you have more control over the indexes created on the relational columns and locking characteristics.</span></span>  
  
 <span data-ttu-id="bc79e-222">Значения, которые следует хранить в реляционных столбцах, зависят от рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="bc79e-222">The values to store in relational columns depend on your workload.</span></span> <span data-ttu-id="bc79e-223">Например, если вы извлекаете все XML-значения, соответствующие выражению пути /Customer/@CustId, вынесение значения атрибута **CustId** в реляционный столбец с последующей индексацией может существенно ускорить обработку запросов.</span><span class="sxs-lookup"><span data-stu-id="bc79e-223">For example, if you retrieve all the XML values based on the path expression, /Customer/@CustId, promoting the value of the **CustId** attribute into a relational column and indexing it may yield faster query performance.</span></span> <span data-ttu-id="bc79e-224">С другой стороны, если XML-данные чрезмерно распределить по реляционным столбцам без дублирования, составление данных в единое целое может оказаться слишком дорогим.</span><span class="sxs-lookup"><span data-stu-id="bc79e-224">On the other hand, if your XML data is extensively and nonredundantly decomposed into relational columns, the re-assembly cost may be significant.</span></span>  
  
 <span data-ttu-id="bc79e-225">В случае высокоструктурированных XML-данных, таких как содержимое таблицы, преобразованное в XML, можно сопоставить все значения с реляционными столбцами и, возможно, использовать технологию XML-представлений.</span><span class="sxs-lookup"><span data-stu-id="bc79e-225">For highly structured XML data, for example, the content of a table has been converted into XML; you can map all values to relational columns, and possibly use XML view technology.</span></span>  
  
## <a name="granularity-of-xml-data"></a><span data-ttu-id="bc79e-226">Гранулярность XML-данных</span><span class="sxs-lookup"><span data-stu-id="bc79e-226">Granularity of XML Data</span></span>  
 <span data-ttu-id="bc79e-227">Гранулярность XML-данных, хранимых в XML-столбце, очень важна при блокировках и, в меньшей степени, при обновлениях.</span><span class="sxs-lookup"><span data-stu-id="bc79e-227">The granularity of the XML data stored in an XML column is very important for locking and, to a lesser degree, it is also important for updates.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="bc79e-228">использует одинаковые механизмы блокировки для XML-данных и данных, отличных от XML.</span><span class="sxs-lookup"><span data-stu-id="bc79e-228">uses the same locking mechanism for both XML and non-XML data.</span></span> <span data-ttu-id="bc79e-229">Таким образом, при блокировке на уровне строки блокируются все экземпляры XML в строке.</span><span class="sxs-lookup"><span data-stu-id="bc79e-229">Therefore, row-level locking causes all XML instances in the row to be locked.</span></span> <span data-ttu-id="bc79e-230">Если гранулярность велика, блокировка крупных экземпляров XML для выполнения обновлений сокращает производительность системы в многопользовательской среде.</span><span class="sxs-lookup"><span data-stu-id="bc79e-230">When the granularity is large, locking large XML instances for updates causes throughput to decline in a multiuser scenario.</span></span> <span data-ttu-id="bc79e-231">С другой стороны, при чрезмерной декомпозиции утрачивается инкапсуляция объекта и возрастают накладные расходы, связанные с воссозданием данных.</span><span class="sxs-lookup"><span data-stu-id="bc79e-231">On the other hand, severe decomposition loses object encapsulation and increases reassembly cost.</span></span>  
  
 <span data-ttu-id="bc79e-232">Чтобы создать эффективную систему, нужно достичь баланса между требованиями к моделированию данных и характеристиками блокировок и обновлений.</span><span class="sxs-lookup"><span data-stu-id="bc79e-232">A balance between data modeling requirements and locking and update characteristics is important for good design.</span></span> <span data-ttu-id="bc79e-233">Однако в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]размер хранимых экземпляров XML имеет не такое большое значение.</span><span class="sxs-lookup"><span data-stu-id="bc79e-233">However, in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the size of actual stored XML instances is not as critical.</span></span>  
  
 <span data-ttu-id="bc79e-234">Например, обновления экземпляра XML выполняются с использованием нового способа частичного обновления больших двоичных объектов (BLOB) и индексов, при котором существующий хранимый экземпляр XML сравнивается с его обновленной версией.</span><span class="sxs-lookup"><span data-stu-id="bc79e-234">For example, updates to an XML instance are performed by using new support for partial binary large object (BLOB) and partial index updates in which the existing stored XML instance is compared to its updated version.</span></span> <span data-ttu-id="bc79e-235">При частичном обновлении большого двоичного объекта выполняется разностное сравнение двух экземпляров XML и обновляются только различающиеся данные.</span><span class="sxs-lookup"><span data-stu-id="bc79e-235">Partial binary large object (BLOB) update performs a differential comparison between the two XML instances and updates only the differences.</span></span> <span data-ttu-id="bc79e-236">При частичном обновлении индекса изменяются только те строки XML-индекса, которые этого требуют.</span><span class="sxs-lookup"><span data-stu-id="bc79e-236">Partial index updates modify only those rows that must be changed in the XML index.</span></span>  
  
## <a name="limitations-of-the-xml-data-type"></a><span data-ttu-id="bc79e-237">Ограничения типа данных xml</span><span class="sxs-lookup"><span data-stu-id="bc79e-237">Limitations of the xml Data Type</span></span>  
 <span data-ttu-id="bc79e-238">Обратите внимание, что на тип данных `xml` накладываются следующие ограничения.</span><span class="sxs-lookup"><span data-stu-id="bc79e-238">Note the following general limitations that apply to the `xml` data type:</span></span>  
  
-   <span data-ttu-id="bc79e-239">Размер хранимого представления экземпляра типа данных `xml` не должен превышать 2 ГБ.</span><span class="sxs-lookup"><span data-stu-id="bc79e-239">The stored representation of `xml` data type instances cannot exceed 2 GB.</span></span>  
  
-   <span data-ttu-id="bc79e-240">Данный тип не может быть использован в качестве подтипа экземпляра **sql_variant** .</span><span class="sxs-lookup"><span data-stu-id="bc79e-240">It cannot be used as a subtype of a **sql_variant** instance.</span></span>  
  
-   <span data-ttu-id="bc79e-241">Приведение или преобразование к типам `text` или `ntext` не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="bc79e-241">It does not support casting or converting to either `text` or `ntext`.</span></span> <span data-ttu-id="bc79e-242">Вместо него следует использовать элементы `varchar(max)` или `nvarchar(max)`.</span><span class="sxs-lookup"><span data-stu-id="bc79e-242">Use `varchar(max)` or `nvarchar(max)` instead.</span></span>  
  
-   <span data-ttu-id="bc79e-243">Сравнение и сортировка не допускаются.</span><span class="sxs-lookup"><span data-stu-id="bc79e-243">It cannot be compared or sorted.</span></span> <span data-ttu-id="bc79e-244">Это значит, что данные типа `xml` не могут использоваться в предложении GROUP BY.</span><span class="sxs-lookup"><span data-stu-id="bc79e-244">This means an `xml` data type cannot be used in a GROUP BY statement.</span></span>  
  
-   <span data-ttu-id="bc79e-245">Не может использоваться в качестве параметров любых скалярных встроенных функций, кроме ISNULL, COALESCE и DATALENGTH.</span><span class="sxs-lookup"><span data-stu-id="bc79e-245">It cannot be used as a parameter to any scalar, built-in functions other than ISNULL, COALESCE, and DATALENGTH.</span></span>  
  
-   <span data-ttu-id="bc79e-246">Не может использоваться как ключевой столбец индекса.</span><span class="sxs-lookup"><span data-stu-id="bc79e-246">It cannot be used as a key column in an index.</span></span> <span data-ttu-id="bc79e-247">Однако может включаться в виде данных в кластеризованный индекс или явно добавляться в некластеризованный индекс при его создании с помощью ключевого слова INCLUDE.</span><span class="sxs-lookup"><span data-stu-id="bc79e-247">However, it can be included as data in a clustered index or explicitly added to a nonclustered index by using the INCLUDE keyword when the nonclustered index is created.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bc79e-248">См. также:</span><span class="sxs-lookup"><span data-stu-id="bc79e-248">See Also</span></span>  
 [<span data-ttu-id="bc79e-249">Примеры массового импорта и экспорта XML-документов (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="bc79e-249">Examples of Bulk Import and Export of XML Documents &#40;SQL Server&#41;</span></span>](../import-export/examples-of-bulk-import-and-export-of-xml-documents-sql-server.md)  
  
  
