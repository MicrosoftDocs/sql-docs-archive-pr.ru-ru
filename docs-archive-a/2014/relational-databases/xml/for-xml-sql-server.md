---
title: FOR XML (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- FOR XML clause, about FOR XML clause
- PATH FOR XML mode, construction
- EXPLICIT FOR XML mode
- RAW FOR XML mode
- retrieving XML data
- XML [SQL Server], FOR XML clause
- AUTO FOR XML mode
- XML [SQL Server], construction
ms.assetid: 2b6b5c61-c5bd-49d2-8c0c-b7cf15857906
author: rothja
ms.author: jroth
ms.openlocfilehash: 6fe55186e89020f57ae1eb078625d1cdce262864
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751996"
---
# <a name="for-xml-sql-server"></a><span data-ttu-id="630ca-102">FOR XML (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="630ca-102">FOR XML (SQL Server)</span></span>
  <span data-ttu-id="630ca-103">Запрос SELECT возвращает результаты в виде набора строк.</span><span class="sxs-lookup"><span data-stu-id="630ca-103">A SELECT query returns results as a rowset.</span></span> <span data-ttu-id="630ca-104">При необходимости можно получать результаты SQL-запроса в формате XML. Для этого в запросе необходимо указать предложение FOR XML.</span><span class="sxs-lookup"><span data-stu-id="630ca-104">You can optionally retrieve formal results of a SQL query as XML by specifying the FOR XML clause in the query.</span></span> <span data-ttu-id="630ca-105">Предложение FOR XML может использоваться в запросах верхнего уровня и во вложенных запросах.</span><span class="sxs-lookup"><span data-stu-id="630ca-105">The FOR XML clause can be used in top-level queries and in sub queries.</span></span> <span data-ttu-id="630ca-106">Предложение FOR XML верхнего уровня можно использовать только в инструкции SELECT.</span><span class="sxs-lookup"><span data-stu-id="630ca-106">The top-level FOR XML clause can be used only in the SELECT statement.</span></span> <span data-ttu-id="630ca-107">Во вложенных запросах предложение FOR XML можно использовать в инструкциях INSERT, UPDATE и DELETE.</span><span class="sxs-lookup"><span data-stu-id="630ca-107">In sub queries, FOR XML can be used in the INSERT, UPDATE, and DELETE statements.</span></span> <span data-ttu-id="630ca-108">Оно также может использоваться в инструкциях присваивания.</span><span class="sxs-lookup"><span data-stu-id="630ca-108">It can also be used in assignment statements.</span></span>  
  
 <span data-ttu-id="630ca-109">В предложении FOR XML можно указать один из следующих режимов:</span><span class="sxs-lookup"><span data-stu-id="630ca-109">In a FOR XML clause, you specify one of these modes:</span></span>  
  
-   <span data-ttu-id="630ca-110">RAW</span><span class="sxs-lookup"><span data-stu-id="630ca-110">RAW</span></span>  
  
-   <span data-ttu-id="630ca-111">AUTO</span><span class="sxs-lookup"><span data-stu-id="630ca-111">AUTO</span></span>  
  
-   <span data-ttu-id="630ca-112">EXPLICIT</span><span class="sxs-lookup"><span data-stu-id="630ca-112">EXPLICIT</span></span>  
  
-   <span data-ttu-id="630ca-113">PATH</span><span class="sxs-lookup"><span data-stu-id="630ca-113">PATH</span></span>  
  
 <span data-ttu-id="630ca-114">В режиме RAW создается одиночный элемент \<row> для каждой строки набора строк, возвращенного инструкцией SELECT.</span><span class="sxs-lookup"><span data-stu-id="630ca-114">The RAW mode generates a single \<row> element per row in the rowset that is returned by the SELECT statement.</span></span> <span data-ttu-id="630ca-115">XML-иерархию можно создать с помощью написания вложенных запросов FOR XML.</span><span class="sxs-lookup"><span data-stu-id="630ca-115">You can generate XML hierarchy by writing nested FOR XML queries.</span></span>  
  
 <span data-ttu-id="630ca-116">В режиме AUTO вложенность XML создается эвристически, в зависимости от метода определения инструкции SELECT.</span><span class="sxs-lookup"><span data-stu-id="630ca-116">The AUTO mode generates nesting in the resulting XML by using heuristics based on the way the SELECT statement is specified.</span></span> <span data-ttu-id="630ca-117">Управление формой создаваемой XML структуры минимально.</span><span class="sxs-lookup"><span data-stu-id="630ca-117">You have minimal control over the shape of the XML generated.</span></span> <span data-ttu-id="630ca-118">Для создания XML-иерархии, расширяющей возможности XML-структуры, созданной эвристически в режиме AUTO, можно написать вложенные запросы FOR XML.</span><span class="sxs-lookup"><span data-stu-id="630ca-118">The nested FOR XML queries can be written to generate XML hierarchy beyond the XML shape that is generated by AUTO mode heuristics.</span></span>  
  
 <span data-ttu-id="630ca-119">Режим EXPLICIT предоставляет больше возможностей по управлению формой XML-структуры.</span><span class="sxs-lookup"><span data-stu-id="630ca-119">The EXPLICIT mode allows more control over the shape of the XML.</span></span> <span data-ttu-id="630ca-120">В XML-структуре могут быть использованы смешанные атрибуты и элементы.</span><span class="sxs-lookup"><span data-stu-id="630ca-120">You can mix attributes and elements at will in deciding the shape of the XML.</span></span> <span data-ttu-id="630ca-121">Это требует особого формата для результирующего набора строк, создаваемого в результате выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="630ca-121">It requires a specific format for the resulting rowset that is generated because of query execution.</span></span> <span data-ttu-id="630ca-122">Формат этого набора строк затем сопоставляется с формой XML-структуры.</span><span class="sxs-lookup"><span data-stu-id="630ca-122">This rowset format is then mapped into XML shape.</span></span> <span data-ttu-id="630ca-123">Преимущества режима EXPLICIT состоят в возможности использования смешанных атрибутов и элементов, в возможности создания упаковщиков и вложенных составных свойств, создания значений, разделенных пробелами (например, атрибут OrderID может содержать список значений идентификаторов порядка), и смешанного содержимого.</span><span class="sxs-lookup"><span data-stu-id="630ca-123">The power of EXPLICIT mode is to mix attributes and elements at will, create wrappers and nested complex properties, create space-separated values (for example, OrderID attribute may have a list of order ID values), and mixed contents.</span></span>  
  
 <span data-ttu-id="630ca-124">Однако написание запросов в режиме EXPLICIT может быть очень обременительным.</span><span class="sxs-lookup"><span data-stu-id="630ca-124">However, writing EXPLICIT mode queries can be cumbersome.</span></span> <span data-ttu-id="630ca-125">Можно использовать некоторые новые возможности предложения FOR XML, например написание вложенных запросов FOR XML в режиме RAW/AUTO/PATH и директивы TYPE вместо использования режима EXPLICIT для создания иерархий.</span><span class="sxs-lookup"><span data-stu-id="630ca-125">You can use some of the new FOR XML capabilities, such as writing nested FOR XML RAW/AUTO/PATH mode queries and the TYPE directive, instead of using EXPLICIT mode to generate the hierarchies.</span></span> <span data-ttu-id="630ca-126">Вложенные запросы FOR XML могут создавать любую XML структуру, которую можно создать с помощью режима EXPLICIT.</span><span class="sxs-lookup"><span data-stu-id="630ca-126">The nested FOR XML queries can produce any XML that you can generate by using the EXPLICIT mode.</span></span> <span data-ttu-id="630ca-127">Дополнительные сведения см. в статьях [Использование вложенных запросов FOR XML](use-nested-for-xml-queries.md) и [Директива TYPE в запросах FOR XML](type-directive-in-for-xml-queries.md).</span><span class="sxs-lookup"><span data-stu-id="630ca-127">For more information, see [Use Nested FOR XML Queries](use-nested-for-xml-queries.md) and [TYPE Directive in FOR XML Queries](type-directive-in-for-xml-queries.md).</span></span>  
  
 <span data-ttu-id="630ca-128">Режим PATH совместно с вложенным запросом FOR XML обеспечивает гибкость режима EXPLICIT более простым образом.</span><span class="sxs-lookup"><span data-stu-id="630ca-128">The PATH mode together with the nested FOR XML query capability provides the flexibility of the EXPLICIT mode in a simpler manner.</span></span>  
  
 <span data-ttu-id="630ca-129">Эти режимы на самом деле работают только при выполнении запросов, для которых они установлены.</span><span class="sxs-lookup"><span data-stu-id="630ca-129">These modes are in effect only for the execution of the query for which they are set.</span></span> <span data-ttu-id="630ca-130">Они не влияют на результаты любых последующих запросов.</span><span class="sxs-lookup"><span data-stu-id="630ca-130">They do not affect the results of any subsequent queries.</span></span>  
  
 <span data-ttu-id="630ca-131">Предложение FOR XML недопустимо для выборки с использованием предложений FOR BROWSE.</span><span class="sxs-lookup"><span data-stu-id="630ca-131">FOR XML is not valid for any selection that is used with a FOR BROWSE clause.</span></span>  
  
## <a name="example"></a><span data-ttu-id="630ca-132">Пример</span><span class="sxs-lookup"><span data-stu-id="630ca-132">Example</span></span>  
 <span data-ttu-id="630ca-133">Следующая инструкция `SELECT` получает данные из таблиц `Sales.Customer` и `Sales.SalesOrderHeader` базы данных `AdventureWorks2012` .</span><span class="sxs-lookup"><span data-stu-id="630ca-133">The following `SELECT` statement retrieves information from the `Sales.Customer` and `Sales.SalesOrderHeader` tables in the `AdventureWorks2012` database.</span></span> <span data-ttu-id="630ca-134">В этом запросе задается режим `AUTO` в предложении `FOR XML` :</span><span class="sxs-lookup"><span data-stu-id="630ca-134">This query specifies the `AUTO` mode in the `FOR XML` clause:</span></span>  
  
```  
USE AdventureWorks2012  
GO  
SELECT Cust.CustomerID,   
       OrderHeader.CustomerID,  
       OrderHeader.SalesOrderID,   
       OrderHeader.Status  
FROM Sales.Customer Cust   
INNER JOIN Sales.SalesOrderHeader OrderHeader  
ON Cust.CustomerID = OrderHeader.CustomerID  
FOR XML AUTO  
```  
  
## <a name="the-for-xml-clause-and-server-names"></a><span data-ttu-id="630ca-135">Предложение FOR XML и имена сервера</span><span class="sxs-lookup"><span data-stu-id="630ca-135">The FOR XML Clause and Server Names</span></span>  
 <span data-ttu-id="630ca-136">Если в инструкции SELECT, использующей предложение FOR XML, указано четырехкомпонентное имя, в возвращаемом документе имя сервера отсутствует, если запрос выполняется на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="630ca-136">When a SELECT statement with a FOR XML clause specifies a four-part name in the query, the server name is not returned in the resulting XML document when the query is executed on the local computer.</span></span> <span data-ttu-id="630ca-137">Однако имя сервера возвращается как часть имени, если запрос выполняется на сетевом сервере.</span><span class="sxs-lookup"><span data-stu-id="630ca-137">However, the server name is returned as the four-part name when the query is executed on a network server.</span></span>  
  
 <span data-ttu-id="630ca-138">В качестве примера рассмотрим запрос:</span><span class="sxs-lookup"><span data-stu-id="630ca-138">For example, consider this query:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person  
FOR XML AUTO  
```  
  
 <span data-ttu-id="630ca-139">Если `ServerName` — локальный сервер, результат запроса будет таким:</span><span class="sxs-lookup"><span data-stu-id="630ca-139">When `ServerName` is a local server, the query returns the following:</span></span>  
  
```  
<AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="630ca-140">Если `ServerName` — сетевой сервер, результат запроса будет таким:</span><span class="sxs-lookup"><span data-stu-id="630ca-140">When `ServerName` is a network server, the query returns the following:</span></span>  
  
```  
<ServerName.AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="630ca-141">Этой возможной неоднозначности можно избежать с помощью такого псевдонима:</span><span class="sxs-lookup"><span data-stu-id="630ca-141">This potential ambiguity can be avoided by specifying this alias:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person x  
FOR XML AUTO   
```  
  
 <span data-ttu-id="630ca-142">Результат этого запроса будет таким:</span><span class="sxs-lookup"><span data-stu-id="630ca-142">This query returns the following:</span></span>  
  
```  
<x LastName="Achong"/>  
```  
  
## <a name="see-also"></a><span data-ttu-id="630ca-143">См. также:</span><span class="sxs-lookup"><span data-stu-id="630ca-143">See Also</span></span>  
 <span data-ttu-id="630ca-144">[Базовый синтаксис предложения FOR XML](basic-syntax-of-the-for-xml-clause.md) </span><span class="sxs-lookup"><span data-stu-id="630ca-144">[Basic Syntax of the FOR XML Clause](basic-syntax-of-the-for-xml-clause.md) </span></span>  
 <span data-ttu-id="630ca-145">[Использование с RAW Mode для FOR XML](use-raw-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="630ca-145">[Use RAW Mode with FOR XML](use-raw-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="630ca-146">[Использование режима AUTO совместно с FOR XML](use-auto-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="630ca-146">[Use AUTO Mode with FOR XML](use-auto-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="630ca-147">[Использование режима EXPLICIT совместно с предложением FOR XML](use-explicit-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="630ca-147">[Use EXPLICIT Mode with FOR XML](use-explicit-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="630ca-148">[Использование режима PATH совместно с FOR XML](use-path-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="630ca-148">[Use PATH Mode with FOR XML](use-path-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="630ca-149">[SQL Server &#40;OPENXML&#41;](openxml-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="630ca-149">[OPENXML &#40;SQL Server&#41;](openxml-sql-server.md) </span></span>  
 [<span data-ttu-id="630ca-150">Добавление пространств имен в запросы с WITH XMLNAMESPACES</span><span class="sxs-lookup"><span data-stu-id="630ca-150">Add Namespaces to Queries with WITH XMLNAMESPACES</span></span>](add-namespaces-to-queries-with-with-xmlnamespaces.md)  
  
  
