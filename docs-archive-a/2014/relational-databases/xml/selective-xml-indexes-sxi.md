---
title: Селективные XML-индексы | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
ms.assetid: 598ecdcd-084b-4032-81b2-eed6ae9f5d44
author: rothja
ms.author: jroth
ms.openlocfilehash: 37dd72c5de2892672dc9f63066075ab5e770d758
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87668672"
---
# <a name="selective-xml-indexes-sxi"></a>Выборочный XML-индекс (SXI)
  Селективные XML-индексы — это еще один тип XML-индексов, доступный наряду с обычными XML-индексами. Селективный XML-индекс используется в следующих целях.  
  
-   Для повышения производительности запросов к XML-данным, хранящимся в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
-   Для поддержки более быстрого индексирования больших объемов XML-данных.  
  
-   Для повышения масштабируемости путем уменьшения затрат на хранение XML-индексов.  
  
 Основным ограничением обычных XML-индексов является то, что они индексируют весь XML-документ. Это ограничение влечет за собой несколько значительных недостатков, например снижение производительности запросов и увеличенные затрат на обслуживание, в основном относящихся к затратам на хранение индекса.  
  
 Функция селективного XML-индекса позволяет повышать только некоторые пути из XML-документов в индекс. Во время создания индекса производится вычисление этих путей, а узлы, на которые они указывают, разделяются и сохраняются в реляционной таблице в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Эта функция использует эффективный алгоритм сопоставления, разработанный [!INCLUDE[msCoName](../../includes/msconame-md.md)] Research в сотрудничестве с группой разработчиков [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Этот алгоритм сопоставляет узлы XML с одной реляционной таблицей и достигает исключительной производительности при использовании небольшого пространства для хранения.  
  
 Функция селективного XML-индекса также поддерживает вторичные селективные XML-индексы для узлов, которые были индексированы селективным XML-индексом. Эти вторичные селективные индексы являются эффективными и еще более повышают производительность запросов.  
  
##  <a name="benefits-of-selective-xml-indexes"></a><a name="benefits"></a> Преимущества селективных XML-индексов  
 Селективные XML-индексы дают следующие преимущества:  
  
1.  Значительное улучшение производительности запросов к типу данных XML для типичных нагрузок по запросам.  
  
2.  Сниженные требования к хранилищу по сравнению с обычными XML-индексами.  
  
3.  Сниженные расходы на обслуживание индекса по сравнению с обычными XML-индексами.  
  
4.  Нет необходимости обновлять приложения для получения пользы от селективных XML-индексов.  
  

  
##  <a name="selective-xml-indexes-and-primary-xml-indexes"></a><a name="compare"></a> Селективные XML-индексы и первичные XML-индексы  
  
> [!IMPORTANT]  
>  Создание селективного XML-индекса вместо обычного XML-индекса в большинстве случаев приводит к повышению производительности и более эффективному использованию хранилища.  
  
 Однако селективный XML-индекс не рекомендуется использовать при наличии следующих условий.  
  
-   Необходимо сопоставить большое число путей узлов.  
  
-   Поддерживаются запросы неизвестных элементов или элементов в неизвестном месте структуры документа.  
  

  
##  <a name="simple-example-of-a-selective-xml-index"></a><a name="example"></a> Простой пример селективного XML-индекса  
 Рассмотрим следующий фрагмент XML как XML-документ в таблице из приблизительно 500 000 строк.  
  
```xml  
<book>  
    <created>2004-03-01</created>   
    <authors>Various</authors>  
    <subjects>  
        <subject>English wit and humor -- Periodicals</subject>  
        <subject>AP</subject>   
    </subjects>  
    <title>Punch, or the London Charivari, Volume 156, April 2, 1919</title>  
    <id>etext11617</id>  
</book>  
```  
  
 Создание первичного XML-индекса для такого большого количества строк этой простой схемы занимает длительное время. Создание запросов к этим данным также является неэффективным, поскольку первичный XML-индекс не поддерживает селективное индексирование.  
  
 Если запросы к данным выполняются только по путям `/book/title` и `/book/subjects` , вы можете создать следующий селективный XML-индекс.  
  
```sql  
CREATE SELECTIVE XML INDEX SXI_index  
ON Tbl(xmlcol)  
FOR   
(  
    pathTitle = '/book/title/text()' AS XQUERY 'xs:string',   
    pathAuthors = '/book/authors' AS XQUERY 'node()',  
    pathId = '/book/id' AS SQL NVARCHAR(100)  
)  
```  
  
 Предыдущая инструкция — это хороший пример синтаксиса CREATE, используемого при создании селективного XML-индекса. В инструкции CREATE указывается имя индекса и определяется таблица и XML-столбец для индексирования. Затем передаются пути для индексирования. Путь состоит из 3 частей:  
  
1.  имя, однозначно определяющее путь;  
  
2.  выражение XQuery, описывающее путь;  
  
3.  необязательные указания по оптимизации.  
  
 Дополнительные сведения об этих элементах см. в разделе [Связанные задачи](#reltasks).  
  

  
## <a name="supported-features-prerequisites-and-limitations"></a>Поддерживаемые функции, предварительные требования и ограничения  
  
###  <a name="supported-xml-features"></a><a name="features"></a> Поддерживаемые функции XML  
 Селективные XML-индексы поддерживают XQuery, поддерживаемые [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в методах exist(), value() и nodes().  
  
-   Для методов exist(), value() и nodes() селективные XML-индексы содержат достаточно данных для преобразования всего выражения.  
  
-   Для методов query() и modify() селективные XML-индексы можно использовать только для фильтрации узлов.  
  
-   Для метода query() селективные XML-индексы не используются для получения результатов.  
  
-   Для метода modify() селективные XML-индексы не используются для обновления XML-документов.  
  

  
###  <a name="unsupported-xml-features"></a><a name="unsupported"></a> Неподдерживаемые функции XML  
 Селективные XML-индексы не поддерживают следующие функции, поддерживаемые в реализации [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] XML:  
  
-   Индексирование узлов со сложными типами XS: типами объединений, типами последовательностей и типами списков.  
  
-   Индексирование узлов с двоичными типами XS: например, base64Binary и hexBinary.  
  
-   Указание узлов для индексирования с выражениями XPath, которые содержат подстановочный знак `*` в конце. Например, `/a/b/c/*`, `/a//b/*` или `/a/b/*:c`.  
  
-   Индексирование любых осей, отличных от осей дочерних элементов, атрибутов или объектов-потомков. Вариант `//<step>` допускается как исключение.  
  
-   Индексирование инструкций и комментариев по обработке XML.  
  
-   Указание и получение идентификатора для узла с помощью функции id().  
  

  
###  <a name="prerequisites"></a><a name="prereq"></a> Предварительные требования  
 Следующие предварительные условия должны существовать до создания селективного XML-индекса для XML-столбца в пользовательской таблице.  
  
-   Кластеризованный индекс должен существовать для первичного ключа таблицы пользователя.  
  
-   Первичный ключ пользовательской таблицы ограничивается размером в 128 байт при использовании с селективными XML-индексами.  
  
-   Ключ кластеризации пользовательской таблицы имеет ограничение в 15 столбцов при использовании с селективными XML-индексами.  
  

  
###  <a name="limitations"></a><a name="limits"></a> Ограничения  
 **Общие требования и ограничения**  
  
-   Каждый селективный XML-индекс может быть создан только для одного XML-столбца.  
  
-   Невозможно создать селективный XML-индекс для столбца, имеющего тип, отличный от XML.  
  
-   Каждый XML-столбец в таблице может иметь только один селективный XML-индекс.  
  
-   Каждая таблица может иметь до 249 селективных XML-индексов.  
  
 **Ограничения для поддерживаемых объектов**  
  
 Нельзя создавать селективные XML-индексы для следующих объектов:  
  
1.  XML-столбцы в представлении.  
  
2.  Возвращающая табличное значение переменная с XML-столбцами.  
  
3.  Переменные типа XML.  
  
4.  Вычисляемые XML-столбцы.  
  
5.  XML-столбец с глубиной более чем в 128 вложенных узлов.  
  
 **Ограничения, относящиеся к хранению**  
  
 Существует ограниченное предельное число узлов из XML-документа, которое можно добавить в индекс. Селективный XML-индекс сопоставляет XML-документы с одной реляционной таблицей. Поэтому он не может содержать более 1024 столбцов со значениями, отличными от NULL, в любой заданной строке таблицы. Кроме того, многие из ограничений для разреженных столбцов также применяются к селективным XML-индексам, поскольку индексы используют разреженные столбцы для хранения.  
  
 Максимальное количество столбцов со значениями, отличными от NULL, поддерживаемое в любой заданной строке, зависит от размера данных в столбцах.  
  
-   В лучшем случае поддерживается 1024 столбца со значениями, отличными от NULL, если все столбцы имеют тип **bit**.  
  
-   В худшем случае поддерживается только 236 столбцов со значениями, отличными от NULL, если все столбцы являются большими объектами типа **varchar**.  
  
 Селективные XML-индексы внутренним образом используют от одного до четырех столбцов для каждого индексированного пути узла. Общее количество доступных для индексации узлов лежит в диапазоне от 60 до нескольких сотен узлов и зависит от фактического размера данных в индексированных путях.  
  
-   В худшем случае, если некоторые или все узлы сопоставлены с помощью `//` в определении пути узла, максимальное количество индексируемых узлов равно 60.  
  
-   В лучшем случае, если узлы сопоставлены без использования `//` в определении пути узла, максимальное количество индексируемых узлов равно 200.  
  
 **Селективные XML-индексы перестраиваются при создании и изменении индекса при помощи инструкций CREATE и ALTER.**  
  
 При создании или изменении селективного XML-индекса при помощи инструкций CREATE и ALTER оно перестраивается в однопотоковом режиме «вне сети». Часто инструкции ALTER отрицательно влияют на производительность запросов к индексированным XML-документам.  
  
 **Прочие ограничения**  
  
-   Селективные XML-индексы не поддерживаются в указаниях запросов.  
  
-   Селективные XML-индексы и вторичные селективные XML-индексы не поддерживаются в помощнике по настройке базы данных.  
  

  
##  <a name="related-tasks"></a><a name="reltasks"></a> Связанные задачи  
  
|||  
|-|-|  
|**Задача**|**Раздел**|  
|При создании или изменении селективного XML-индекса необходимо указать пути узлов, которые нужно индексировать, а также необязательные указания по оптимизации.|[Задание путей и указания по оптимизации для селективных XML-индексов](specify-paths-and-optimization-hints-for-selective-xml-indexes.md)|  
|Создание, изменение и удаление селективного XML-индекса.|[Создание, изменение и удаление селективных XML-индексов](create-alter-and-drop-selective-xml-indexes.md)|  
|Создание, изменение и удаление вторичного селективного XML-индекса.|[Создание, изменение и удаление вторичных селективных XML-индексов](create-alter-and-drop-secondary-selective-xml-indexes.md)|  
  

  
  
