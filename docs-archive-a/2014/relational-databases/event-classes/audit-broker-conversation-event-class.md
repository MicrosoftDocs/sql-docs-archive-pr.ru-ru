---
title: Класс событий Audit Broker Conversation | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
topic_type:
- apiref
helpviewer_keywords:
- Audit Broker Conversation event class
ms.assetid: d58e3577-e297-42e5-b8fe-206665a75d13
author: stevestein
ms.author: sstein
ms.openlocfilehash: 46c09737aeafffd04f3dc2c129692bbf78d2c096
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87732682"
---
# <a name="audit-broker-conversation-event-class"></a>Audit Broker Conversation, класс событий
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] создает событие **Audit Broker Conversation** для выдачи сообщений аудита, относящихся к безопасности диалога компонента Service Broker.  
  
## <a name="audit-broker-conversation-event-class-data-columns"></a>Столбцы данных класса события Audit Broker Conversation  
  
|Столбец данных|Тип|Description|Номер столбца|Фильтруемый|  
|-----------------|----------|-----------------|-------------------|----------------|  
|**ApplicationName**|**nvarchar**|Имя клиентского приложения, установившего соединение с экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Этот столбец заполняется значениями, передаваемыми приложением, а не отображаемым именем программы.|10|Да|  
|**BigintData1**|**bigint**|Последовательный номер сообщения.|52|нет|  
|**ClientProcessID**|**int**|Идентификатор, присвоенный компьютером сервера процессу, в котором работает клиентское приложение. Этот столбец данных заполняется в том случае, если клиент вводит идентификатор клиентского процесса.|9|Да|  
|**DatabaseID**|**int**|Идентификатор базы данных, указанной в инструкции USE *database* , или базы данных по умолчанию, если для данного экземпляра инструкция USE *database* не выполнялась. [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] отображает имя базы данных, если столбец данных **ServerName** захвачен при трассировке и сервер доступен. Определите значение для базы данных, используя функцию DB_ID.|3|Да|  
|**Ошибка**|**int**|Код ошибки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , если событие сигнализирует об ошибке.|31|нет|  
|**EventClass**|**int**|Тип захваченного класса событий. Всегда равен **158** для класса **Audit Broker Conversation**.|27|нет|  
|**EventSubClass**|**int**|Тип подкласса событий, предоставляющий дополнительные сведения о каждом классе события. Приведенная ниже таблица содержит список подклассов для данного класса событий.|21|Да|  
|**FileName**|**nvarchar**|Причина ошибки входа. Если вход произведен успешно, этот столбец пуст.|36|нет|  
|**GUID**|**uniqueidentifier**|Идентификатор диалога. Этот идентификатор передается в составе сообщения и является общим для обоих участников диалога.|54|нет|  
|**HostName**|**nvarchar**|Имя компьютера, на котором выполняется клиентская программа. Заполнение этого столбца данных производится в том случае, если клиент предоставляет имя узла. Чтобы определить имя узла, используйте функцию **HOST_NAME** .|8|Да|  
|**IntegerData**|**int**|Номер фрагмента сообщения.|25|нет|  
|**NTDomainName**|**nvarchar**|Домен Windows, к которому принадлежит пользователь.|7|Да|  
|**NTUserName**|**nvarchar**|Имя пользователя, которому принадлежит соединение, создавшее это событие.|6|Да|  
|**ObjectId**|**int**|Идентификатор пользователя целевой службы.|22|нет|  
|**RoleName**|**nvarchar**|Роль дескриптора диалога. Это либо **initiator** , либо **target**.|38|нет|  
|**ServerName**|**nvarchar**|Имя экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , подвергаемого трассировке.|26|нет|  
|**Severity**|**int**|Уровень серьезности ошибки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , если данное событие сообщает об ошибке.|29|нет|  
|**SPID**|**int**|Идентификатор процесса сервера, который [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] присвоил процессу, связанному с клиентом.|12|Да|  
|**StartTime**|**datetime**|Время начала события, если доступно.|14|Да|  
|**Состояние**|**int**|Указывает место в исходном коде [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , которое вызвало это событие. Каждое место, которое может вызвать это событие, обозначается отдельным кодом состояния. Сотрудник службы технической поддержки Microsoft может использовать этот код состояния для обнаружения участка, выполнение которого привело к событию.|30|нет|  
|**TextData**|**ntext**|Для ошибки содержит сообщение, описывающее ее причину. Одно из следующих значений:<br /><br /> **Сертификат не найден**. Пользователь, указанный в протоколе защиты диалога, не имеет сертификата.<br /><br /> **Недопустимый срок действия**. Пользователь, указанный в протоколе защиты диалога, имеет сертификат, но срок его действия истек.<br /><br /> **Сертификат слишком велик для размещения в памяти**. Пользователь, указанный для протокола защиты диалога, имеет сертификат, но его размер слишком велик. Максимальная длина сертификата, поддерживаемая компонентом Service Broker, составляет 32 768 байт.<br /><br /> **Не найден закрытый ключ**. Пользователь, указанный для протокола защиты диалога, имеет сертификат, но отсутствует закрытый ключ, связанный с этим сертификатом.<br /><br /> **Размер закрытого ключа сертификата несовместим с поставщиком службы криптографии**. Закрытый ключ для данного сертификата имеет размер, исключающий нормальную работу с ним. Размер закрытого ключа должен быть кратен 64 байт.<br /><br /> **Размер открытого ключа несовместим с поставщиком службы криптографии**. Открытый ключ для данного сертификата имеет размер, исключающий нормальную работу с ним. Размер открытого ключа должен быть кратен 64 байт.<br /><br /> **Размер закрытого ключа несовместим с зашифрованным ключом обмена ключами**. Размер ключа, указанный в ключе обмена ключами, не совпадает с размером закрытого ключа для данного сертификата. Как правило, это свидетельствует о том, что сертификат удаленного компьютера не соответствует сертификату в базе данных.<br /><br /> **Размер открытого ключа сертификата несовместим с подписью заголовка безопасности**. Заголовок безопасности содержит цифровую подпись, которая не может быть проверена открытым ключом сертификата. Как правило, это свидетельствует о том, что сертификат удаленного компьютера не соответствует сертификату в базе данных.|1|Да|  
  
 Следующая таблица содержит список значений подклассов события для этого класса событий.  
  
|ID|Подкласс|Description|  
|--------|--------------|-----------------|  
|1|Отсутствует заголовок безопасности|Во время защищенного диалога компонента Service Broker получил сообщение, которое не содержит ключа сеанса. Протокол требует, чтобы после установления защищенного диалога каждое сообщение содержало ключ сеанса.|  
|2|Отсутствует сертификат|Компонент Service Broker не смог найти подходящего сертификата для одного из участников диалога. Для защиты диалога база данных должна содержать сертификаты как отправителя, так и получателя.|  
|3|Неверная цифровая подпись|Service Broker не смог, используя открытый ключ сертификата отправителя, проверить цифровую подпись сообщения. Это может указывать на то, что сообщение повреждено или фальсифицировано, что для удаленной и локальной служб установлен не один и тот же сертификат или что срок действия сертификата истек.|  
|4|Ошибка выполнения на целевом сервере|Пользователю назначения не предоставлены разрешения на очередь назначения. Чтобы предотвратить получение сообщений неавторизованными пользователями, компонент Service Broker не ставит в очередь сообщения, адресованные пользователю, который не сможет получить их, независимо от того, имеет ли вызывающий пользователь разрешения на помещение сообщений в очередь.|  
  
## <a name="see-also"></a>См. также:  
 [SQL Server Service Broker](../../database-engine/configure-windows/sql-server-service-broker.md)  
  
  
