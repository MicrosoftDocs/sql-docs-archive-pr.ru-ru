---
title: Класс событий Hash Warning | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
topic_type:
- apiref
helpviewer_keywords:
- Hash Warning event class
ms.assetid: cb93c620-4be9-4362-8bf0-af3f2048bdaf
author: stevestein
ms.author: sstein
ms.openlocfilehash: 1c26b06e61a6f9fcad52dab0d042b299f993342e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87736317"
---
# <a name="hash-warning-event-class"></a>Hash Warning, класс событий
  Класс событий Hash Warning можно использовать для мониторинга возникновения рекурсии хэша или остановки хэширования (аварийного хэширования) во время операции хэширования.  
  
 Рекурсия хэша возникает, когда входные данные не помещаются в доступную память, что приводит к разбиению их на несколько отдельно обрабатываемых секций. Если какая-либо из этих секций все же не помещается в доступную память, она разбивается на подсекции, которые также обрабатываются отдельно. Процесс разбиения продолжается, либо пока все секции не будут помещаться в доступную память, либо пока не будет достигнут максимальный уровень рекурсии (который можно проверить в столбце данных IntegerData).  
  
 Аварийное хэширование происходит, когда операция хэширования достигает максимального уровня рекурсии и переходит к альтернативному плану обработки оставшихся секционированных данных. Причиной этого обычно становятся ассиметричные данные.  
  
 Рекурсии и аварийное хэширование приводят к снижению производительности сервера. Для устранения или уменьшения частоты появления рекурсий и аварийного хэширования можно применить следующие методы.  
  
-   Удостовериться в том, что для соединяемых или группируемых столбцов существует статистика.  
  
-   Если для столбцов существует статистика, обновить ее.  
  
-   Использовать другой тип соединения. Например, соединения MERGE или LOOP, если это допустимо.  
  
-   Увеличить объем доступной памяти на компьютере. Рекурсии и аварийное хэширование возникают, когда в машине недостаточно памяти для обработки имеющихся запросов и их приходится сбрасывать на диск.  
  
 Создание или обновление статистики по столбцу, включенному в соединение, представляет собой наиболее эффективный способ уменьшения числа рекурсий или аварийного хэширования.  
  
> [!NOTE]  
>  Также для описания аварийного хэширования используются термины *поэтапное хэш-соединение* и *рекурсивное хэш-соединение* .  
  
> [!IMPORTANT]  
>  Для обнаружения возникновения события Hash Warning при формировании плана выполнения запроса оптимизатором запросов в трассировке необходимо также собрать класс событий Showplan. Можно выбрать любой класс событий Showplan, за исключением классов событий Showplan Text и Showplan Text (Unencoded), которые не возвращают идентификатор узла. Идентификаторы узлов в классе событий Showplan идентифицируют каждую операцию, выполняемую оптимизатором запросов при формировании плана выполнения запроса. Такие операции называются *операторами*, и каждый оператор в классе событий Showplan имеет свой идентификатор узла. Столбец ObjectID для событий Hash Warning соответствует идентификатору узла в классе событий Showplan, поэтому можно определить, какой оператор или операция вызывает ошибку.  
  
## <a name="hash-warning-event-class-data-columns"></a>Столбцы данных класса событий Hash Warning  
  
|Имя столбца данных|Тип данных|Описание|Идентификатор столбца|Фильтруемый|  
|----------------------|---------------|-----------------|---------------|----------------|  
|ApplicationName|`nvarchar`|Имя клиентского приложения, установившего соединение с экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Этот столбец заполняется значениями, передаваемыми приложением, а не отображаемым именем программы.|10|Да|  
|ClientProcessID|`int`|Идентификатор, присвоенный главным компьютером сервера процессу, в котором работает клиентское приложение. Этот столбец данных заполняется в том случае, если клиент вводит идентификатор клиентского процесса.|9|Да|  
|DatabaseID|`int`|Идентификатор базы данных, указанной в инструкции USE *database* , или базы данных по умолчанию, если для данного экземпляра инструкция USE *database* не выполнялась. [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] отображает имя базы данных, если столбец данных ServerName захвачен при трассировке и сервер доступен. Определите значение для базы данных, используя функцию DB_ID.|3|Да|  
|имя_базы_данных|`nvarchar`|Имя базы данных, в которой выполняется пользовательская инструкция.|35|Да|  
|EventClass|`int`|Тип события = 55.|27|Нет|  
|EventSequence|`int`|Последовательность данного события в запросе.|51|Нет|  
|EventSubClass|`int`|Тип подкласса события.<br /><br /> 0 = рекурсия<br /><br /> 1 = аварийное завершение|21|Да|  
|GroupID|`int`|Идентификатор группы рабочей нагрузки, в которой запускается событие трассировки SQL.|66|Да|  
|HostName|`nvarchar`|Имя компьютера, на котором выполняется клиентская программа. Этот столбец данных заполняется, если клиент предоставляет имя узла. Чтобы определить имя узла, используйте функцию HOST_NAME.|8|Да|  
|IntegerData|`int`|Уровень рекурсии (только рекурсия хэширования).|25|Да|  
|IsSystem|`int`|Указывает, произошло событие в системном или в пользовательском процессе. 1 = системный, 0 = пользовательский.|60|Да|  
|LoginName|`nvarchar`|Имя учетной записи пользователя (защищенное имя для входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или учетные данные для входа в Windows в формате *\<DOMAIN>\\<имя пользователя\>* ).|11|Да|  
|LoginSid|`image`|Идентификатор безопасности вошедшего в систему пользователя. Эти сведения можно найти в представлении каталога sys.server_principals. Значение идентификатора безопасности уникально для каждого имени входа на сервере.|41|Да|  
|NTDomainName|`nvarchar`|Домен Windows, к которому принадлежит пользователь.|7|Да|  
|NTUserName|`nvarchar`|Имя пользователя Windows.|6|Да|  
|ObjectID|`int`|Идентификатор узла для корня группы хэширования, участвующей в перераспределении секций. Соответствует идентификатору узла в Showplan.|22|Да|  
|RequestID|`int`|Идентификатор запроса, содержащего инструкцию.|49|Да|  
|ServerName|`nvarchar`|Имя трассируемого экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .|26||  
|SessionLoginName|`nvarchar`|Имя входа пользователя, создавшего этот сеанс. Например, при соединении с [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] под именем Login1 и при выполнении инструкции под именем Login2 SessionLoginName будет содержать значение Login1, а LoginName — значение Login2. В этом столбце отображаются как имена входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , так и имена входа Windows.|64|Да|  
|SPID|`int`|Идентификатор сеанса, в котором произошло событие.|12|Да|  
|StartTime|`datetime`|Время начала события, если оно известно.|14|Да|  
|TransactionID|`bigint`|Назначенный системой идентификатор транзакции.|4|Да|  
|XactSequence|`bigint`|Токен, который описывает текущую транзакцию.|50|Да|  
  
## <a name="see-also"></a>См. также:  
 [Хранимая процедура sp_trace_setevent (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-trace-setevent-transact-sql)  
  
  
