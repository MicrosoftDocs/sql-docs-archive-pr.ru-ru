---
title: Среда, размещенная в среде CLR | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
helpviewer_keywords:
- type-safe code [CLR integration]
- UNSAFE permission set
- run-time environments [CLR integration]
- common language runtime [SQL Server], about CLR integration
- application domains [CLR integration]
- host protection attributes [CLR integration]
- managed code [SQL Server], common language runtime
- permission sets [CLR integration]
- reliability [CLR integration]
- SAFE permission set
- code access security [CLR integration]
- EXTERNAL_ACCESS permission set
- verifying type safety
- scalability [CLR integration]
- hosted environments [CLR integration]
- HPAs [CLR integration]
ms.assetid: d280d359-08f0-47b5-a07e-67dd2a58ad73
author: rothja
ms.author: jroth
ms.openlocfilehash: bd04536d1dfb8a4657fbe116cdfd38a6639a6327
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87735326"
---
# <a name="clr-hosted-environment"></a><span data-ttu-id="4d299-102">Среда размещения CLR</span><span class="sxs-lookup"><span data-stu-id="4d299-102">CLR Hosted Environment</span></span>
  <span data-ttu-id="4d299-103">Среда CLR платформы [!INCLUDE[msCoName](../../../includes/msconame-md.md)] .NET Framework представляет собой среду для выполнения кода на многих современных языках программирования, в том числе [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Visual C#, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Visual Basic и [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Visual C++.</span><span class="sxs-lookup"><span data-stu-id="4d299-103">The [!INCLUDE[msCoName](../../../includes/msconame-md.md)] .NET Framework common language runtime (CLR) is an environment that executes many modern programming languages, including [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Visual C#, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Visual Basic, and [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Visual C++.</span></span> <span data-ttu-id="4d299-104">Среда CLR характеризуется применением памяти со сбором мусора, потоковой обработки с вытеснением, службы метаданных (отражения типа), проверки кода и управления доступом для кода.</span><span class="sxs-lookup"><span data-stu-id="4d299-104">The CLR features garbage-collected memory, pre-emptive threading, metadata services (type reflection), code verifiability, and code access security.</span></span> <span data-ttu-id="4d299-105">В среде CLR метаданные используются для обнаружения и загрузки классов, размещения экземпляров в памяти, разрешения вызовов методов, формирования машинного кода, обеспечения безопасности и определения границ контекста времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="4d299-105">The CLR uses metadata to locate and load classes, lay out instances in memory, resolve method invocations, generate native code, enforce security, and set run-time context boundaries.</span></span>  
  
 <span data-ttu-id="4d299-106">CLR и [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] различаются как варианты среды времени выполнения по способам управления памятью, потоками и синхронизацией.</span><span class="sxs-lookup"><span data-stu-id="4d299-106">The CLR and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] differ as run-time environments in the way they handle memory, threads, and synchronization.</span></span> <span data-ttu-id="4d299-107">В этом разделе описан способ интеграции этих двух вариантов среды времени выполнения, позволяющий обеспечить единообразное управление всеми системными ресурсами.</span><span class="sxs-lookup"><span data-stu-id="4d299-107">This topic describes the way in which these two run times are integrated so that all system resources are managed uniformly.</span></span> <span data-ttu-id="4d299-108">В этом разделе рассматривается также способ интеграции средств управления доступом для кода (CAS) среды CLR и средств безопасности [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в целях предоставления надежной и безопасной среды выполнения пользовательского кода.</span><span class="sxs-lookup"><span data-stu-id="4d299-108">This topic also covers the way in which CLR code access security (CAS) and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] security are integrated to provide a reliable and secure execution environment for user code.</span></span>  
  
## <a name="basic-concepts-of-clr-architecture"></a><span data-ttu-id="4d299-109">Основные понятия архитектуры CLR</span><span class="sxs-lookup"><span data-stu-id="4d299-109">Basic Concepts of CLR Architecture</span></span>  
 <span data-ttu-id="4d299-110">На платформе .NET Framework программист использует язык высокого уровня, который реализует класс, определяющий его структуру (например, поля или свойства класса) и методы.</span><span class="sxs-lookup"><span data-stu-id="4d299-110">In the .NET Framework, a programmer writes in a high-level language that implements a class defining its structure (for example, the fields or properties of the class) and methods.</span></span> <span data-ttu-id="4d299-111">Некоторые из этих методов могут быть статическими функциями.</span><span class="sxs-lookup"><span data-stu-id="4d299-111">Some of these methods can be static functions.</span></span> <span data-ttu-id="4d299-112">Компиляция программы создает файл, называемый сборкой, содержащей скомпилированный код на [!INCLUDE[msCoName](../../../includes/msconame-md.md)] промежуточном языке (MSIL), и манифест, содержащий все ссылки на зависимые сборки.</span><span class="sxs-lookup"><span data-stu-id="4d299-112">The compilation of the program produces a file called an assembly that contains the compiled code in the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] intermediate language (MSIL), and a manifest that contains all references to dependent assemblies.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4d299-113">Сборки — важнейший элемент архитектуры CLR.</span><span class="sxs-lookup"><span data-stu-id="4d299-113">Assemblies are a vital element in the architecture of the CLR.</span></span> <span data-ttu-id="4d299-114">Они представляют собой средства упаковки, развертывания и управления версиями кода приложений на платформе .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="4d299-114">They are the units of packaging, deployment, and versioning of application code in the .NET Framework.</span></span> <span data-ttu-id="4d299-115">С помощью сборок можно развертывать код приложений в базе данных и предоставлять единообразный способ администрирования, создания резервных копий и восстановления законченных приложений базы данных.</span><span class="sxs-lookup"><span data-stu-id="4d299-115">Using assemblies, you can deploy application code inside the database and provide a uniform way to administer, back up, and restore complete database applications.</span></span>  
  
 <span data-ttu-id="4d299-116">Манифест сборки содержит метаданные о сборке, описывающие все структуры, поля, свойства, классы, связи наследования, функции и методы, определенные в программе.</span><span class="sxs-lookup"><span data-stu-id="4d299-116">The assembly manifest contains metadata about the assembly, describing all of the structures, fields, properties, classes, inheritance relationships, functions, and methods defined in the program.</span></span> <span data-ttu-id="4d299-117">Манифест устанавливает идентификационные данные сборки, указывает файлы, образующие реализацию сборки, задает типы и ресурсы, составляющие сборку, конкретизирует зависимости времени компиляции от других сборок и регламентирует набор разрешений, необходимых для правильного выполнения сборки.</span><span class="sxs-lookup"><span data-stu-id="4d299-117">The manifest establishes the assembly identity, specifies the files that make up the assembly implementation, specifies the types and resources that make up the assembly, itemizes the compile-time dependencies on other assemblies, and specifies the set of permissions required for the assembly to run properly.</span></span> <span data-ttu-id="4d299-118">Эти сведения используются во время выполнения для разрешения ссылок, применения политики привязки версии и проверки целостности загруженных сборок.</span><span class="sxs-lookup"><span data-stu-id="4d299-118">This information is used at run time to resolve references, enforce version binding policy, and validate the integrity of loaded assemblies.</span></span>  
  
 <span data-ttu-id="4d299-119">Платформа .NET Framework поддерживает пользовательские атрибуты для аннотации классов, свойств, функций и методов с дополнительными сведениями, которые приложение может собрать в метаданных.</span><span class="sxs-lookup"><span data-stu-id="4d299-119">The .NET Framework supports custom attributes for annotating classes, properties, functions, and methods with additional information the application may capture in metadata.</span></span> <span data-ttu-id="4d299-120">Все компиляторы .NET Framework воспринимают эти заметки без интерпретации и хранят их как метаданные сборки.</span><span class="sxs-lookup"><span data-stu-id="4d299-120">All .NET Framework compilers consume these annotations without interpretation and store them as assembly metadata.</span></span> <span data-ttu-id="4d299-121">Эти заметки можно анализировать так же, как любые другие метаданные.</span><span class="sxs-lookup"><span data-stu-id="4d299-121">These annotations can be examined in the same way as any other metadata.</span></span>  
  
 <span data-ttu-id="4d299-122">Управляемый код представляет собой код MSIL, выполняемый в среде CLR, а не непосредственно операционной системой.</span><span class="sxs-lookup"><span data-stu-id="4d299-122">Managed code is MSIL executed in the CLR, rather than directly by the operating system.</span></span> <span data-ttu-id="4d299-123">Приложения с управляемым кодом используют средства служб CLR, такие как автоматическая сборка мусора, проверка типов на стадии выполнения и обеспечение безопасности.</span><span class="sxs-lookup"><span data-stu-id="4d299-123">Managed code applications acquire CLR services, such as automatic garbage collection, run-time type checking, and security support.</span></span> <span data-ttu-id="4d299-124">Эти службы помогают обеспечить единообразное поведение приложений с управляемым кодом независимо от платформы и языка.</span><span class="sxs-lookup"><span data-stu-id="4d299-124">These services help provide uniform platform- and language-independent behavior of managed code applications.</span></span>  
  
## <a name="design-goals-of-clr-integration"></a><span data-ttu-id="4d299-125">Цели проектирования при интеграции со средой CLR</span><span class="sxs-lookup"><span data-stu-id="4d299-125">Design Goals of CLR Integration</span></span>  
 <span data-ttu-id="4d299-126">Если пользовательский код выполняется в среде размещения CLR в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (что принято называть интеграцией со средой CLR), то ставятся следующие цели проектирования.</span><span class="sxs-lookup"><span data-stu-id="4d299-126">When user code runs inside the CLR-hosted environment in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (called CLR integration), the following design goals apply:</span></span>  
  
###### <a name="reliability-safety"></a><span data-ttu-id="4d299-127">Надежность (безопасность)</span><span class="sxs-lookup"><span data-stu-id="4d299-127">Reliability (Safety)</span></span>  
 <span data-ttu-id="4d299-128">В пользовательском коде не должно быть разрешено выполнение операций, нарушающих целостность процесса компонента Database Engine, таких как вывод окна сообщения, запрашивающего ответ от пользователя, или выход из процесса.</span><span class="sxs-lookup"><span data-stu-id="4d299-128">User code should not be allowed to perform operations that compromise the integrity of the Database Engine process, such as popping a message box requesting a user response or exiting the process.</span></span> <span data-ttu-id="4d299-129">Пользовательский код не должен иметь возможности перезаписывать буфера памяти компонента Database Engine или внутренние структуры данных.</span><span class="sxs-lookup"><span data-stu-id="4d299-129">User code should not be able to overwrite Database Engine memory buffers or internal data structures.</span></span>  
  
###### <a name="scalability"></a><span data-ttu-id="4d299-130">Масштабируемость</span><span class="sxs-lookup"><span data-stu-id="4d299-130">Scalability</span></span>  
 <span data-ttu-id="4d299-131">В [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и в среде CLR используются различные внутренние модели планирования и управления памятью.</span><span class="sxs-lookup"><span data-stu-id="4d299-131">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and the CLR have different internal models for scheduling and memory management.</span></span> <span data-ttu-id="4d299-132">В [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] поддерживается кооперативная модель потоков без вытеснения, в которой каждый выполняющийся поток должен сам возвращать управление либо по прошествии определенного периода, либо во время ожидания освобождения блокировок или завершения операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="4d299-132">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] supports a cooperative, non-preemptive threading model in which the threads voluntarily yield execution periodically, or when they are waiting on locks or I/O.</span></span> <span data-ttu-id="4d299-133">Среда CLR поддерживает модель потоков с вытеснением.</span><span class="sxs-lookup"><span data-stu-id="4d299-133">The CLR supports a preemptive threading model.</span></span> <span data-ttu-id="4d299-134">Если в пользовательском коде, выполняемом в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], допускается непосредственный вызов базовых функций управления потоками операционной системы, то интеграция этого кода в планировщик задач [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] становится неудовлетворительной и может снизиться масштабируемость системы.</span><span class="sxs-lookup"><span data-stu-id="4d299-134">If user code running inside [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can directly call the operating system threading primitives, then it does not integrate well into the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] task scheduler and can degrade the scalability of the system.</span></span> <span data-ttu-id="4d299-135">В среде CLR виртуальная и физическая память не различаются, но [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] непосредственно управляет физической памятью и должна использовать физическую память в пределах, определяемых конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="4d299-135">The CLR does not distinguish between virtual and physical memory, but [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] directly manages physical memory and is required to use physical memory within a configurable limit.</span></span>  
  
 <span data-ttu-id="4d299-136">Если должно быть обеспечено масштабирование системы управления реляционной базой данных (СУРБД) в целях одновременной поддержки тысяч пользовательских сеансов, то приходится решать сложные задачи интеграции в связи с применением разных моделей организации потоков, планирования и управления памятью.</span><span class="sxs-lookup"><span data-stu-id="4d299-136">The different models for threading, scheduling, and memory management present an integration challenge for a relational database management system (RDBMS) that scales to support thousands of concurrent user sessions.</span></span> <span data-ttu-id="4d299-137">Создаваемая архитектура должна гарантировать, чтобы на масштабируемость системы не оказывал отрицательное влияние непосредственный вызов в пользовательском коде прикладных программных интерфейсов (API) в целях применения базовых функций управления потоками, памятью и синхронизацией.</span><span class="sxs-lookup"><span data-stu-id="4d299-137">The architecture should ensure that the scalability of the system is not compromised by user code calling application programming interfaces (APIs) for threading, memory, and synchronization primitives directly.</span></span>  
  
###### <a name="security"></a><span data-ttu-id="4d299-138">Безопасность</span><span class="sxs-lookup"><span data-stu-id="4d299-138">Security</span></span>  
 <span data-ttu-id="4d299-139">Пользовательский код, выполняемый в базе данных, должен соответствовать правилам проверки подлинности и авторизации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] при доступе к таким объектам базы данных, как таблицы и столбцы.</span><span class="sxs-lookup"><span data-stu-id="4d299-139">User code running in the database must follow [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] authentication and authorization rules when accessing database objects such as tables and columns.</span></span> <span data-ttu-id="4d299-140">Кроме того, администраторы баз данных должны иметь возможность управлять доступом к ресурсам операционной системы, таким как файлы и сетевой доступ, осуществляемым из пользовательского кода, который выполняется в базе данных.</span><span class="sxs-lookup"><span data-stu-id="4d299-140">In addition, database administrators should be able to control access to operating system resources, such as files and network access, from user code running in the database.</span></span> <span data-ttu-id="4d299-141">Это становится необходимым, поскольку управляемые языки программирования (в отличие от неуправляемых языков наподобие Transact-SQL), предоставляют API для доступа к таким ресурсам.</span><span class="sxs-lookup"><span data-stu-id="4d299-141">This becomes important as managed programming languages (unlike non-managed languages such as Transact-SQL) provide APIs to access such resources.</span></span> <span data-ttu-id="4d299-142">Система должна предоставить безопасный способ доступа пользовательского кода к ресурсам компьютера вне процесса компонента [!INCLUDE[ssDE](../../../includes/ssde-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d299-142">The system must provide a secure way for user code to access machine resources outside the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] process.</span></span> <span data-ttu-id="4d299-143">Дополнительные сведения см. в статье [CLR Integration Security](security/clr-integration-security.md).</span><span class="sxs-lookup"><span data-stu-id="4d299-143">For more information, see [CLR Integration Security](security/clr-integration-security.md).</span></span>  
  
###### <a name="performance"></a><span data-ttu-id="4d299-144">Производительность</span><span class="sxs-lookup"><span data-stu-id="4d299-144">Performance</span></span>  
 <span data-ttu-id="4d299-145">Управляемый пользовательский код, выполняемый в компоненте [!INCLUDE[ssDE](../../../includes/ssde-md.md)], должен обеспечивать вычислительную производительность, сравнимую с выполнением того же кода вне сервера.</span><span class="sxs-lookup"><span data-stu-id="4d299-145">Managed user code running in the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] should have computational performance comparable to the same code run outside the server.</span></span> <span data-ttu-id="4d299-146">Доступ к базам данных из управляемого пользовательского кода осуществляется не так быстро, как из собственного кода [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d299-146">Database access from managed user code is not as fast as native [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span> <span data-ttu-id="4d299-147">Дополнительные сведения см. в статье [производительность интеграции со средой CLR](clr-integration-architecture-performance.md).</span><span class="sxs-lookup"><span data-stu-id="4d299-147">For more information, see [Performance of CLR Integration](clr-integration-architecture-performance.md).</span></span>  
  
## <a name="clr-services"></a><span data-ttu-id="4d299-148">Службы CLR</span><span class="sxs-lookup"><span data-stu-id="4d299-148">CLR Services</span></span>  
 <span data-ttu-id="4d299-149">Среда CLR предоставляет ряд служб, чтобы облегчить достижение целей проектирования для интеграции среды CLR с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d299-149">The CLR provides a number of services to help achieve the design goals of CLR integration with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
###### <a name="type-safety-verification"></a><span data-ttu-id="4d299-150">Проверка безопасности типов</span><span class="sxs-lookup"><span data-stu-id="4d299-150">Type safety verification</span></span>  
 <span data-ttu-id="4d299-151">Типизированный код — это код, который обращается к структурам памяти только строго определенными способами.</span><span class="sxs-lookup"><span data-stu-id="4d299-151">Type-safe code is code that accesses memory structures only in well-defined ways.</span></span> <span data-ttu-id="4d299-152">Например, при наличии допустимой ссылки на объект типизированный код может обращаться к памяти с фиксированными смещениями, соответствующими фактическим полям элементов.</span><span class="sxs-lookup"><span data-stu-id="4d299-152">For example, given a valid object reference, type-safe code can access memory at fixed offsets corresponding to actual field members.</span></span> <span data-ttu-id="4d299-153">Но если код обращается к памяти с произвольными смещениями внутри и вне области памяти, которая принадлежит к объекту, то код нетипизированный.</span><span class="sxs-lookup"><span data-stu-id="4d299-153">However, if the code accesses memory at arbitrary offsets inside or outside the range of memory that belongs to the object, then it is not type-safe.</span></span> <span data-ttu-id="4d299-154">Если выполняется загрузка сборок в среду CLR до компиляции MSIL с использованием JIT-компиляции, то на этапе проверки во время выполнения код анализируется, чтобы можно было определить безопасность типов.</span><span class="sxs-lookup"><span data-stu-id="4d299-154">When assemblies are loaded in the CLR, prior to the MSIL being compiled using just-in-time (JIT) compilation, the runtime performs a verification phase that examines code to determine its type-safety.</span></span> <span data-ttu-id="4d299-155">Код, успешно прошедший эту проверку, называется «проверяемым типизированным кодом».</span><span class="sxs-lookup"><span data-stu-id="4d299-155">Code that successfully passes this verification is called verifiably type-safe code.</span></span>  
  
###### <a name="application-domains"></a><span data-ttu-id="4d299-156">Домены приложений</span><span class="sxs-lookup"><span data-stu-id="4d299-156">Application domains</span></span>  
 <span data-ttu-id="4d299-157">Среда CLR поддерживает понятие доменов приложений как зон выполнения внутри основного процесса, в который можно загрузить и выполнить сборки управляемого кода.</span><span class="sxs-lookup"><span data-stu-id="4d299-157">The CLR supports the notion of application domains as execution zones within a host process where managed code assemblies can be loaded and executed.</span></span> <span data-ttu-id="4d299-158">Граница домена приложения обеспечивает изоляцию между сборками.</span><span class="sxs-lookup"><span data-stu-id="4d299-158">The application domain boundary provides isolation between assemblies.</span></span> <span data-ttu-id="4d299-159">Сборки изолированы с точки зрения видимости статических переменных и элементов данных, а также возможности динамического вызова кода.</span><span class="sxs-lookup"><span data-stu-id="4d299-159">The assemblies are isolated in terms of visibility of static variables and data members and the ability to call code dynamically.</span></span> <span data-ttu-id="4d299-160">Домены приложений также обеспечивают механизм для загрузки и выгрузки кода.</span><span class="sxs-lookup"><span data-stu-id="4d299-160">Application domains are also the mechanism for loading and unloading code.</span></span> <span data-ttu-id="4d299-161">Код можно выгрузить из памяти, только выгрузив домен приложения.</span><span class="sxs-lookup"><span data-stu-id="4d299-161">Code can be unloaded from memory only by unloading the application domain.</span></span> <span data-ttu-id="4d299-162">Дополнительные сведения см. в разделе [домены приложений и безопасность интеграции со средой CLR](../../database-engine/dev-guide/application-domains-and-clr-integration-security.md).</span><span class="sxs-lookup"><span data-stu-id="4d299-162">For more information, see [Application Domains and CLR Integration Security](../../database-engine/dev-guide/application-domains-and-clr-integration-security.md).</span></span>  
  
###### <a name="code-access-security-cas"></a><span data-ttu-id="4d299-163">CAS (Code Access Security — безопасность доступа кода)</span><span class="sxs-lookup"><span data-stu-id="4d299-163">Code Access Security (CAS)</span></span>  
 <span data-ttu-id="4d299-164">Система безопасности CLR обеспечивает способ выбора типа операций, которые могут быть выполнены управляемым кодом, назначая разрешения коду.</span><span class="sxs-lookup"><span data-stu-id="4d299-164">The CLR security system provides a way to control what kinds of operations managed code can perform by assigning permissions to code.</span></span> <span data-ttu-id="4d299-165">Разрешения доступа для кода назначаются на основе удостоверения кода (например, подпись сборки или происхождение кода).</span><span class="sxs-lookup"><span data-stu-id="4d299-165">Code access permissions are assigned based on code identity (for example, the signature of the assembly or the origin of the code).</span></span>  
  
 <span data-ttu-id="4d299-166">Среда CLR обеспечивает применение политики уровня компьютера, которую может назначить администратор компьютера.</span><span class="sxs-lookup"><span data-stu-id="4d299-166">The CLR provides for a computer-wide policy that can be set by the computer administrator.</span></span> <span data-ttu-id="4d299-167">Эта политика предоставляет разрешения для любого управляемого кода, выполняемого на компьютере.</span><span class="sxs-lookup"><span data-stu-id="4d299-167">This policy defines the permission grants for any managed code running on the machine.</span></span> <span data-ttu-id="4d299-168">Кроме того, существует политика безопасности на уровне узла, которую можно использовать на таких узлах, как [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], чтобы указать дополнительные ограничения для управляемого кода.</span><span class="sxs-lookup"><span data-stu-id="4d299-168">In addition, there is a host-level security policy that can be used by hosts such as [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to specify additional restrictions on managed code.</span></span>  
  
 <span data-ttu-id="4d299-169">Если управляемый API на платформе .NET Framework предоставляет операции над ресурсами, защищенные набором разрешений на доступ к коду, то API потребует разрешение перед доступом к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="4d299-169">If a managed API in the .NET Framework exposes operations on resources that are protected by a code access permission, the API will demand that permission before accessing the resource.</span></span> <span data-ttu-id="4d299-170">В силу этого требования система безопасности CLR запускает исчерпывающую проверку каждого блока кода (сборки) в стеке вызова.</span><span class="sxs-lookup"><span data-stu-id="4d299-170">This demand causes the CLR security system to trigger a comprehensive check of every unit of code (assembly) in the call stack.</span></span> <span data-ttu-id="4d299-171">Только если вся цепочка вызовов имеет разрешение, будет предоставлен доступ к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="4d299-171">Only if the entire call chain has permission will access to the resource be granted.</span></span>  
  
 <span data-ttu-id="4d299-172">Обратите внимание, что возможность динамического создания управляемого кода с использованием API Reflection.Emit в среде размещения CLR в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="4d299-172">Note that the ability to generate managed code dynamically, using the Reflection.Emit API, is not supported inside the CLR-hosted environment in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="4d299-173">Такой код не будет иметь разрешений CAS для выполнения и поэтому завершится неудачей во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="4d299-173">Such code would not have the CAS permissions to run and would therefore fail at run time.</span></span> <span data-ttu-id="4d299-174">Дополнительные сведения см. в статье [Безопасность доступа к коду для интеграции со средой CLR](security/clr-integration-code-access-security.md).</span><span class="sxs-lookup"><span data-stu-id="4d299-174">For more information, see [CLR Integration Code Access Security](security/clr-integration-code-access-security.md).</span></span>  
  
###### <a name="host-protection-attributes-hpas"></a><span data-ttu-id="4d299-175">Атрибуты защиты узла (HPA)</span><span class="sxs-lookup"><span data-stu-id="4d299-175">Host Protection Attributes (HPAs)</span></span>  
 <span data-ttu-id="4d299-176">Среда CLR обеспечивает механизм для аннотирования управляемых API, которые являются частью платформы .NET Framework с определенными атрибутами, которые могут представлять интерес для узла CLR.</span><span class="sxs-lookup"><span data-stu-id="4d299-176">The CLR provides a mechanism to annotate managed APIs that are part of the .NET Framework with certain attributes that may be of interest to a host of the CLR.</span></span> <span data-ttu-id="4d299-177">Примеры таких атрибутов включают следующее.</span><span class="sxs-lookup"><span data-stu-id="4d299-177">Examples of such attributes include:</span></span>  
  
-   <span data-ttu-id="4d299-178">SharedState, который указывает, обеспечивает ли API возможность создавать или управлять общим состоянием (например, статическими полями классов).</span><span class="sxs-lookup"><span data-stu-id="4d299-178">SharedState, which indicates whether the API exposes the ability to create or manage shared state (for example, static class fields).</span></span>  
  
-   <span data-ttu-id="4d299-179">Synchronization, который указывает, обеспечивает ли API возможность выполнять синхронизацию между потоками.</span><span class="sxs-lookup"><span data-stu-id="4d299-179">Synchronization, which indicates whether the API exposes the ability to perform synchronization between threads.</span></span>  
  
-   <span data-ttu-id="4d299-180">ExternalProcessMgmt, который указывает, предоставляет ли API возможность управлять основным процессом.</span><span class="sxs-lookup"><span data-stu-id="4d299-180">ExternalProcessMgmt, which indicates whether the API exposes a way to control the host process.</span></span>  
  
 <span data-ttu-id="4d299-181">С учетом этих атрибутов узел может указать список атрибутов защиты узла, таких как атрибут SharedState, которые должны быть запрещены в управляемой среде.</span><span class="sxs-lookup"><span data-stu-id="4d299-181">Given these attributes, the host can specify a list of HPAs, such as the SharedState attribute, that should be disallowed in the hosted environment.</span></span> <span data-ttu-id="4d299-182">В этом случае среда CLR запрещает попытки пользовательского кода, которые направлены на вызов API, внесенных атрибутами защиты узла в запрещенный список.</span><span class="sxs-lookup"><span data-stu-id="4d299-182">In this case, the CLR denies attempts by user code to call APIs that are annotated by the HPAs in the prohibited list.</span></span> <span data-ttu-id="4d299-183">Дополнительные сведения см. в разделе [атрибуты защиты узла и программирование интеграции со средой CLR](../clr-integration-security-host-protection-attributes/host-protection-attributes-and-clr-integration-programming.md).</span><span class="sxs-lookup"><span data-stu-id="4d299-183">For more information, see [Host Protection Attributes and CLR Integration Programming](../clr-integration-security-host-protection-attributes/host-protection-attributes-and-clr-integration-programming.md).</span></span>  
  
## <a name="how-sql-server-and-the-clr-work-together"></a><span data-ttu-id="4d299-184">Совместная работа SQL Server и среды CLR</span><span class="sxs-lookup"><span data-stu-id="4d299-184">How SQL Server and the CLR Work Together</span></span>  
 <span data-ttu-id="4d299-185">В этом разделе описано, как [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] интегрирует модели организации потоков, планирования, синхронизации и управления памятью [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и среды CLR.</span><span class="sxs-lookup"><span data-stu-id="4d299-185">This section discusses how [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] integrates the threading, scheduling, synchronization, and memory management models of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and the CLR.</span></span> <span data-ttu-id="4d299-186">В частности, в этом разделе интеграция рассматривается с позиций масштабируемости, надежности и безопасности.</span><span class="sxs-lookup"><span data-stu-id="4d299-186">In particular, this section examines the integration in light of scalability, reliability, and security goals.</span></span> <span data-ttu-id="4d299-187">В сущности, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] выполняет функцию операционной системы для среды CLR при ее размещении в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d299-187">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] essentially acts as the operating system for the CLR when it is hosted inside [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="4d299-188">Среда CLR вызывает низкоуровневые программы, реализованные в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], для управления потоками, планированием, синхронизацией и памятью.</span><span class="sxs-lookup"><span data-stu-id="4d299-188">The CLR calls low-level routines implemented by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] for threading, scheduling, synchronization, and memory management.</span></span> <span data-ttu-id="4d299-189">Это те же базовые функции, которые используются остальными компонентами механизма [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d299-189">These are the same primitives that the rest of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] engine uses.</span></span> <span data-ttu-id="4d299-190">Этот подход обеспечивает несколько преимуществ с точки зрения масштабируемости, надежности и безопасности.</span><span class="sxs-lookup"><span data-stu-id="4d299-190">This approach provides several scalability, reliability, and security benefits.</span></span>  
  
###### <a name="scalability-common-threading-scheduling-and-synchronization"></a><span data-ttu-id="4d299-191">Масштабируемость. Общие потоки, планирование и синхронизация</span><span class="sxs-lookup"><span data-stu-id="4d299-191">Scalability: Common threading, scheduling, and synchronization</span></span>  
 <span data-ttu-id="4d299-192">В среде CLR происходит вызов API [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для создания потоков, как для выполнения пользовательского кода, так и для собственного внутреннего использования.</span><span class="sxs-lookup"><span data-stu-id="4d299-192">CLR calls [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] APIs for creating threads, both for running user code and for its own internal use.</span></span> <span data-ttu-id="4d299-193">Чтобы синхронизировать несколько потоков, среда CLR вызывает объекты синхронизации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d299-193">In order to synchronize between multiple threads, the CLR calls [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] synchronization objects.</span></span> <span data-ttu-id="4d299-194">Это позволяет планировщику [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] запланировать другие задачи, когда поток ожидает объект синхронизации.</span><span class="sxs-lookup"><span data-stu-id="4d299-194">This allows the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] scheduler to schedule other tasks when a thread is waiting on a synchronization object.</span></span> <span data-ttu-id="4d299-195">Например, когда среда CLR запускает сбор мусора, все потоки ожидают завершения сбора мусора.</span><span class="sxs-lookup"><span data-stu-id="4d299-195">For example, when the CLR initiates garbage collection, all of its threads wait for garbage collection to finish.</span></span> <span data-ttu-id="4d299-196">Потоки CLR и ожидаемые ими объекты синхронизации известны планировщику [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], поэтому [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] может планировать потоки, которые выполняют другие задачи базы данных, не связанные со средой CLR.</span><span class="sxs-lookup"><span data-stu-id="4d299-196">Because the CLR threads and the synchronization objects they are waiting on are known to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] scheduler, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can schedule threads that are running other database tasks not involving the CLR.</span></span> <span data-ttu-id="4d299-197">Это также позволяет [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] обнаруживать взаимоблокировки с участием блокировок, установленных объектами синхронизации CLR, и использовать традиционные методы снятия взаимоблокировок.</span><span class="sxs-lookup"><span data-stu-id="4d299-197">This also enables [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to detect deadlocks that involve locks taken by CLR synchronization objects and employ traditional techniques for deadlock removal.</span></span>  
  
 <span data-ttu-id="4d299-198">Управляемый код выполняется в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] с приоритетным прерыванием.</span><span class="sxs-lookup"><span data-stu-id="4d299-198">Managed code runs preemptively in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="4d299-199">Планировщик [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] обеспечивает обнаружение и останов потоков, не возвращающих управление в течение значительного времени.</span><span class="sxs-lookup"><span data-stu-id="4d299-199">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] scheduler has the ability to detect and stop threads that have not yielded for a significant amount of time.</span></span> <span data-ttu-id="4d299-200">Возможность связывания потоков CLR с потоками [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] обусловливает то, что планировщик [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] может определять вышедшие из-под контроля потоки в среде CLR и управлять их приоритетом.</span><span class="sxs-lookup"><span data-stu-id="4d299-200">The ability to hook CLR threads to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] threads implies that the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] scheduler can identify "runaway" threads in the CLR and manage their priority.</span></span> <span data-ttu-id="4d299-201">Такие вышедшие из-под контроля потоки приостанавливаются и возвращаются в очередь.</span><span class="sxs-lookup"><span data-stu-id="4d299-201">Such runaway threads are suspended and put back in the queue.</span></span> <span data-ttu-id="4d299-202">Потокам, которые были повторно обнаружены как вышедшие из-под контроля, запрещается выполняться в течение определенного периода времени, чтобы обеспечить выполнение других рабочих потоков.</span><span class="sxs-lookup"><span data-stu-id="4d299-202">Threads that are repeatedly identified as runaway threads are not allowed to run for a given period of time so that other executing workers can run.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4d299-203">Продолжительно выполняемый управляемый код, который обращается к данным или выделяет достаточно памяти, чтобы запустить сбор мусора, осуществляет возврат управления автоматически.</span><span class="sxs-lookup"><span data-stu-id="4d299-203">Long-running managed code that accesses data or allocates enough memory to trigger garbage collection will yield automatically.</span></span> <span data-ttu-id="4d299-204">Продолжительно выполняемый управляемый код, который не обращается к данным или не выделяет достаточно памяти, чтобы запустить сбор мусора, должен явно возвращать управление путем вызова функции System.Thread.Sleep() платформы .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="4d299-204">Long-running managed code that does not access data or allocate enough managed memory to trigger garbage collection should explicitly yield by calling the System.Thread.Sleep() function of the .NET Framework.</span></span>  
  
###### <a name="scalability-common-memory-management"></a><span data-ttu-id="4d299-205">Масштабируемость. общее управление памятью</span><span class="sxs-lookup"><span data-stu-id="4d299-205">Scalability: Common memory management</span></span>  
 <span data-ttu-id="4d299-206">Среда CLR вызывает базовые функции [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для выделения и отмены выделения памяти.</span><span class="sxs-lookup"><span data-stu-id="4d299-206">The CLR calls [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] primitives for allocating and de-allocating its memory.</span></span> <span data-ttu-id="4d299-207">Память, используемая средой CLR, учитывается в общем объеме использования памяти системы, поэтому [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] может оставаться в пределах памяти, заданных в конфигурации, и предотвращать конкуренцию за память между средой CLR и [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d299-207">Because the memory used by the CLR is accounted for in the total memory usage of the system, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can stay within its configured memory limits and ensure the CLR and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] are not competing with each other for memory.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="4d299-208">может также отвергать запросы памяти от среды CLR при ограниченном объеме доступной системной памяти и запрашивать у среды CLR сокращение использования памяти, если память нужна другим задачам.</span><span class="sxs-lookup"><span data-stu-id="4d299-208">can also reject CLR memory requests when system memory is constrained, and ask CLR to reduce its memory use when other tasks need memory.</span></span>  
  
###### <a name="reliability-application-domains-and-unrecoverable-exceptions"></a><span data-ttu-id="4d299-209">Надежность: домены приложений и невосстанавливаемые исключения</span><span class="sxs-lookup"><span data-stu-id="4d299-209">Reliability: Application domains and unrecoverable exceptions</span></span>  
 <span data-ttu-id="4d299-210">Когда управляемый код в API .NET Framework встречает критические исключения, такие как нехватка памяти или переполнение стека, не всегда удается выполнить восстановление после отказа и обеспечить согласованную и правильную семантику для их реализации.</span><span class="sxs-lookup"><span data-stu-id="4d299-210">When managed code in the .NET Framework APIs encounters critical exceptions, such as out-of-memory or stack overflow, it is not always possible to recover from such failures and ensure consistent and correct semantics for their implementation.</span></span> <span data-ttu-id="4d299-211">Эти API активизируют исключение прерывания потока в ответ на такие отказы.</span><span class="sxs-lookup"><span data-stu-id="4d299-211">These APIs raise a thread abort exception in response to these failures.</span></span>  
  
 <span data-ttu-id="4d299-212">При размещении в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] такие прерывания потока обрабатываются следующим образом: среда CLR обнаруживает любое общее состояние в домене приложения, в котором происходит прерывание потока.</span><span class="sxs-lookup"><span data-stu-id="4d299-212">When hosted in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], such thread aborts are handled as follows: the CLR detects any shared state in the application domain in which the thread abort occurs.</span></span> <span data-ttu-id="4d299-213">Для этого среда CLR проверяет присутствие объектов синхронизации.</span><span class="sxs-lookup"><span data-stu-id="4d299-213">The CLR does this by checking for the presence of synchronization objects.</span></span> <span data-ttu-id="4d299-214">Если в домене приложения имеется общее состояние, то выгружается сам домен приложения.</span><span class="sxs-lookup"><span data-stu-id="4d299-214">If there is shared state in the application domain, then the application domain itself is unloaded.</span></span> <span data-ttu-id="4d299-215">В результате выгрузки домена приложения останавливаются транзакции базы данных, выполняемые в это время в домене приложения.</span><span class="sxs-lookup"><span data-stu-id="4d299-215">The unloading of the application domain stops database transactions that are currently running in that application domain.</span></span> <span data-ttu-id="4d299-216">Поскольку присутствие общего состояния может увеличить влияние таких критических исключений на пользовательские сеансы, отличные от сеанса, вызвавшего исключение, в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и среде CLR приняты меры для уменьшения вероятности возникновения общего состояния.</span><span class="sxs-lookup"><span data-stu-id="4d299-216">Because the presence of shared state can widen the impact of such critical exceptions to user sessions other than the one triggering the exception, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and the CLR have taken steps to reduce the likelihood of shared state.</span></span> <span data-ttu-id="4d299-217">Дополнительные сведения см. в документации по .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="4d299-217">For more information, see the .NET Framework documentation.</span></span>  
  
###### <a name="security-permission-sets"></a><span data-ttu-id="4d299-218">Безопасность: наборы разрешений</span><span class="sxs-lookup"><span data-stu-id="4d299-218">Security: Permission sets</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="4d299-219">позволяет пользователям указывать требования к надежности и безопасности для кода, развернутого в базе данных.</span><span class="sxs-lookup"><span data-stu-id="4d299-219">allows users to specify the reliability and security requirements for code deployed into the database.</span></span> <span data-ttu-id="4d299-220">Когда сборки загружаются в базу данных, автор сборки может указать один из трех наборов разрешений для этой сборки: "надежный", "EXTERNAL_ACCESS" и "ненадежный".</span><span class="sxs-lookup"><span data-stu-id="4d299-220">When assemblies are uploaded into the database, the author of the assembly can specify one of three permission sets for that assembly: SAFE, EXTERNAL_ACCESS and UNSAFE.</span></span>  
  
|||||  
|-|-|-|-|  
|<span data-ttu-id="4d299-221">Набор разрешений</span><span class="sxs-lookup"><span data-stu-id="4d299-221">Permission set</span></span>|<span data-ttu-id="4d299-222">SAFE</span><span class="sxs-lookup"><span data-stu-id="4d299-222">SAFE</span></span>|<span data-ttu-id="4d299-223">EXTERNAL_ACCESS</span><span class="sxs-lookup"><span data-stu-id="4d299-223">EXTERNAL_ACCESS</span></span>|<span data-ttu-id="4d299-224">UNSAFE</span><span class="sxs-lookup"><span data-stu-id="4d299-224">UNSAFE</span></span>|  
|<span data-ttu-id="4d299-225">Управление доступом для кода</span><span class="sxs-lookup"><span data-stu-id="4d299-225">Code Access Security</span></span>|<span data-ttu-id="4d299-226">Только выполнение</span><span class="sxs-lookup"><span data-stu-id="4d299-226">Execute only</span></span>|<span data-ttu-id="4d299-227">Выполнение и доступ к внешним ресурсам</span><span class="sxs-lookup"><span data-stu-id="4d299-227">Execute + access to external resources</span></span>|<span data-ttu-id="4d299-228">С неограниченным доступом</span><span class="sxs-lookup"><span data-stu-id="4d299-228">Unrestricted</span></span>|  
|<span data-ttu-id="4d299-229">Ограничения модели программирования</span><span class="sxs-lookup"><span data-stu-id="4d299-229">Programming model restrictions</span></span>|<span data-ttu-id="4d299-230">Да</span><span class="sxs-lookup"><span data-stu-id="4d299-230">Yes</span></span>|<span data-ttu-id="4d299-231">Да</span><span class="sxs-lookup"><span data-stu-id="4d299-231">Yes</span></span>|<span data-ttu-id="4d299-232">Нет ограничений</span><span class="sxs-lookup"><span data-stu-id="4d299-232">No restrictions</span></span>|  
|<span data-ttu-id="4d299-233">Требование к проверяемости</span><span class="sxs-lookup"><span data-stu-id="4d299-233">Verifiability requirement</span></span>|<span data-ttu-id="4d299-234">Да</span><span class="sxs-lookup"><span data-stu-id="4d299-234">Yes</span></span>|<span data-ttu-id="4d299-235">Да</span><span class="sxs-lookup"><span data-stu-id="4d299-235">Yes</span></span>|<span data-ttu-id="4d299-236">Нет</span><span class="sxs-lookup"><span data-stu-id="4d299-236">No</span></span>|  
|<span data-ttu-id="4d299-237">Возможность вызова машинного кода</span><span class="sxs-lookup"><span data-stu-id="4d299-237">Ability to call native code</span></span>|<span data-ttu-id="4d299-238">Нет</span><span class="sxs-lookup"><span data-stu-id="4d299-238">No</span></span>|<span data-ttu-id="4d299-239">Нет</span><span class="sxs-lookup"><span data-stu-id="4d299-239">No</span></span>|<span data-ttu-id="4d299-240">Да</span><span class="sxs-lookup"><span data-stu-id="4d299-240">Yes</span></span>|  
  
 <span data-ttu-id="4d299-241">SAFE — самый надежный и безопасный режим с соответствующими ограничениями в отношении разрешенной программной модели.</span><span class="sxs-lookup"><span data-stu-id="4d299-241">SAFE is the most reliable and secure mode with associated restrictions in terms of the allowed programming model.</span></span> <span data-ttu-id="4d299-242">Сборки SAFE получают достаточные разрешения для запуска, выполнения вычислений и доступа к локальной базе данных.</span><span class="sxs-lookup"><span data-stu-id="4d299-242">SAFE assemblies are given enough permission to run, perform computations, and have access to the local database.</span></span> <span data-ttu-id="4d299-243">Сборки SAFE должны использовать безопасные типы с возможностью проверки этого факта; они также не могут вызывать неуправляемый код.</span><span class="sxs-lookup"><span data-stu-id="4d299-243">SAFE assemblies need to be verifiably type safe and are not allowed to call unmanaged code.</span></span>  
  
 <span data-ttu-id="4d299-244">Режим UNSAFE предназначен для кода с высоким уровнем доверия, который могут создавать только администраторы базы данных.</span><span class="sxs-lookup"><span data-stu-id="4d299-244">UNSAFE is for highly trusted code that can only be created by database administrators.</span></span> <span data-ttu-id="4d299-245">На этот доверенный код не налагаются ограничения управления доступом для кода, и он может вызывать неуправляемый (машинный) код.</span><span class="sxs-lookup"><span data-stu-id="4d299-245">This trusted code has no code access security restrictions, and it can call unmanaged (native) code.</span></span>  
  
 <span data-ttu-id="4d299-246">Режим EXTERNAL_ACCESS обеспечивает промежуточный уровень безопасности, в котором код может обращаться к ресурсам, внешним по отношению к базе данных, и при этом иметь гарантии надежности уровня SAFE.</span><span class="sxs-lookup"><span data-stu-id="4d299-246">EXTERNAL_ACCESS provides an intermediate security option, allowing code to access resources external to the database but still having the reliability guarantees of SAFE.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="4d299-247">использует уровень политики CAS на уровне узла, чтобы установить политику узла, которая предоставляет один из трех наборов разрешений на основе набора разрешений, хранимого в каталогах [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d299-247">uses the host-level CAS policy layer to set up a host policy that grants one of the three sets of permissions based on the permission set stored in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] catalogs.</span></span> <span data-ttu-id="4d299-248">Управляемый код, выполняемый внутри базы данных, всегда получает один из этих наборов разрешений доступа для кода.</span><span class="sxs-lookup"><span data-stu-id="4d299-248">Managed code running inside the database always gets one of these code access permission sets.</span></span>  
  
### <a name="programming-model-restrictions"></a><span data-ttu-id="4d299-249">Ограничения модели программирования</span><span class="sxs-lookup"><span data-stu-id="4d299-249">Programming Model Restrictions</span></span>  
 <span data-ttu-id="4d299-250">Модель программирования для управляемого кода в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] включает написание функций, процедур и типов, которые обычно не требуют использования общего состояния в нескольких вызовах или общего состояния нескольких пользовательских сеансов.</span><span class="sxs-lookup"><span data-stu-id="4d299-250">The programming model for managed code in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] involves writing functions, procedures, and types which typically do not require the use of state held across multiple invocations or the sharing of state across multiple user sessions.</span></span> <span data-ttu-id="4d299-251">Кроме того, как было описано выше, наличие общего состояния может привести к критическим исключениям, которые влияют на масштабируемость и надежность приложения.</span><span class="sxs-lookup"><span data-stu-id="4d299-251">Further, as described earlier, the presence of shared state can cause critical exceptions that impact the scalability and the reliability of the application.</span></span>  
  
 <span data-ttu-id="4d299-252">С учетом этих факторов не рекомендуется использовать статические переменные и статические элементы данных классов, используемых в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d299-252">Given these considerations, we discourage the use of static variables and static data members of classes used in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="4d299-253">Для сборок SAFE и EXTERNAL_ACCESS в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] анализируются метаданные сборки во время выполнения инструкции CREATE ASSEMBLY и отменяется создание таких сборок, если будет обнаружено использование статических элементов данных и переменных.</span><span class="sxs-lookup"><span data-stu-id="4d299-253">For SAFE and EXTERNAL_ACCESS assemblies, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] examines the metadata of the assembly at CREATE ASSEMBLY time and fails the creation of such assemblies if it finds the use of static data members and variables.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="4d299-254">запрещает также вызовы к API .NET Framework, аннотированные атрибутами защиты узла `SharedState`, `Synchronization` и `ExternalProcessMgmt`.</span><span class="sxs-lookup"><span data-stu-id="4d299-254">also disallows calls to .NET Framework APIs that are annotated with the `SharedState`, `Synchronization` and `ExternalProcessMgmt` host protection attributes.</span></span> <span data-ttu-id="4d299-255">Это не позволяет сборкам SAFE и EXTERNAL_ACCESS направлять вызовы к любым API, которые поддерживают общее состояние, выполнение синхронизации и влияют на целостность процесса [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4d299-255">This prevents SAFE and EXTERNAL_ACCESS assemblies from calling any APIs that enable sharing state, performing synchronization, and affecting the integrity of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] process.</span></span> <span data-ttu-id="4d299-256">Дополнительные сведения см. в разделе [ограничения модели программирования интеграции со средой CLR](database-objects/clr-integration-programming-model-restrictions.md).</span><span class="sxs-lookup"><span data-stu-id="4d299-256">For more information, see [CLR Integration Programming Model Restrictions](database-objects/clr-integration-programming-model-restrictions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4d299-257">См. также:</span><span class="sxs-lookup"><span data-stu-id="4d299-257">See Also</span></span>  
 <span data-ttu-id="4d299-258">[Безопасность интеграции со средой CLR](security/clr-integration-security.md) </span><span class="sxs-lookup"><span data-stu-id="4d299-258">[CLR Integration Security](security/clr-integration-security.md) </span></span>  
 [<span data-ttu-id="4d299-259">Производительность интеграции со средой CLR</span><span class="sxs-lookup"><span data-stu-id="4d299-259">Performance of CLR Integration</span></span>](clr-integration-architecture-performance.md)  
  
  
