---
title: Заполнение полнотекстовых индексов | Документация Майкрософт
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: search
ms.topic: conceptual
helpviewer_keywords:
- index populations [full-text search]
- incremental populations [full-text search]
- populations [full-text search]
- full-text search [SQL Server], populations
- crawls [full-text search]
- automatic full-text index updates
- change tracking-based populations [full-text search]
- manual updates [full-text search]
- manual populations [full-text search]
- auto populations [full-text search]
- full-text indexes [SQL Server], key column
- full populations [full-text search]
- full-text indexes [SQL Server], populations
ms.assetid: 76767b20-ef55-49ce-8dc4-e77cb8ff618a
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 9ab93a3514fa260c8c3836da85c767da3c3051a1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87667006"
---
# <a name="populate-full-text-indexes"></a>Заполнение полнотекстовых индексов
  Создание и обслуживание полнотекстового индекса включает процесс *заполнения* индекса (которое также называется *сканированием*).  
  
##  <a name="types-of-population"></a><a name="types"></a>Типы населения  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]поддерживает следующие типы заполнения: полное заполнение, автоматическое или ручное заполнение на основе отслеживания изменений и добавочное заполнение на основе меток времени.  
  
### <a name="full-population"></a>Полное заполнение  
 Во время полного заполнения индексные записи строятся для всех строк таблицы или индексированного представления. Во время полного заполнения полнотекстового индекса индексные записи строятся для всех строк базовой таблицы или индексированного представления.  
  
 По умолчанию [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] полностью заполняет новый полнотекстовый индекс сразу после его создания. Однако полное заполнение может потреблять значительный объем ресурсов. Поэтому при создании полнотекстовых индексов во время периодов наибольшей потребности в ресурсах часто полезно бывает отложить полное заполнение на период наименьшего потребления ресурсов, особенно если базовая таблица полнотекстового индекса имеет большой размер. Однако полнотекстовый каталог, к которому относится индекс, нельзя использовать, пока не будут заполнены все его полнотекстовые индексы. Чтобы создать полнотекстовый индекс, но не заполнять его немедленно, укажите в инструкции  CREATE FULLTEXT INDEX предложение CHANGE_TRACKING OFF, NO POPULATION. Если указан параметр CHANGE_TRACKING MANUAL, то средство полнотекстового поиска использует инструкцию. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]не заполнит новый полнотекстовый индекс до тех пор, пока не будет выполнена инструкция ALTER FULLTEXT INDEX с предложением запустить полное ЗАПОЛНЕНие или начать ДОБАВОЧное ЗАПОЛНЕНие. Дополнительные сведения см. в примерах «А. Создание полнотекстового индекса без выполнения полного заполнения» и «Б. Выполнение полного заполнения в таблице», приведенных далее в этом разделе.  
  

  
### <a name="change-tracking-based-population"></a>Заполнение на основе отслеживания изменений  
 Можно также использовать отслеживание изменений для обслуживания полнотекстового индекса после его первоначального полного заполнения. Это вызывает небольшую нагрузку, связанную с отслеживанием изменений, поскольку [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает таблицу, в которой выполняется отслеживание изменений в базовой таблице со времени последнего заполнения. При использовании отслеживания изменений [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает запись строк базовой таблицы или индексированного представления, измененного операциями обновления, удаления или вставки. Изменения данных, внесенные с помощью инструкций WRITETEXT и UPDATETEXT, не отражаются в полнотекстовом индексе и не отмечаются при отслеживании изменений.  
  
> [!NOTE]  
>  Для таблиц, содержащих столбец `timestamp`, можно использовать добавочное заполнение.  
  
 При включении отслеживания изменений во время создания индекса [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] полностью заполняет новый полнотекстовый индекс сразу же после его создания. Таким образом, изменения отслеживаются и распространяются в полнотекстовый индекс. Отслеживания изменений выполняется двумя способами: автоматически (параметр CHANGE_TRACKING AUTO) и вручную (параметр CHANGE_TRACKING MANUAL). По умолчанию используется автоматическое отслеживание изменений.  
  
 Способ заполнения полнотекстового индекса определяется типом отслеживания изменений.  
  
-   Автоматическое заполнение  
  
     По умолчанию (либо если задан параметр CHANGE_TRACKING AUTO) средство полнотекстового поиска использует автоматическое заполнение полнотекстового индекса. После завершения первоначального полного заполнения изменения отслеживаются по мере изменений данных в базовой таблице, а зарегистрированные изменения распространяются автоматически. Полнотекстовый индекс обновляется в режиме вне сети, однако изменения, распространяемые таким образом, могут не отражаться в индексе сразу.  
  
     **Настройка отслеживания изменений с автоматическим заполнением**  
  
    -   [CREATE FULLTEXT INDEX](/sql/t-sql/statements/create-fulltext-index-transact-sql) ... WITH CHANGE_TRACKING AUTO  
  
    -   [ALTER FULLTEXT INDEX](/sql/t-sql/statements/alter-fulltext-index-transact-sql) ... SET CHANGE_TRACKING AUTO  
  
     Дополнительные сведения см. в примере «Д. Переключение полнотекстового индекса на автоматическое отслеживание изменений» далее в этом разделе.  
  
-   Заполнение вручную  
  
     Если задан параметр CHANGE_TRACKING MANUAL, то средство полнотекстового поиска использует заполнение полнотекстового индекса вручную. После завершения первоначального полного заполнения изменения отслеживаются по мере изменения данных в базовой таблице. Но изменения не добавляются в полнотекстовый индекс, пока не будет выполнена инструкция ALTER FULLTEXT INDEX … START UPDATE POPULATION . Агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] можно использовать для периодического вызова инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] .  
  
     **Запуск отслеживания изменений с заполнением вручную**  
  
    -   [CREATE FULLTEXT INDEX](/sql/t-sql/statements/create-fulltext-index-transact-sql) ... WITH CHANGE_TRACKING MANUAL  
  
    -   [ALTER FULLTEXT INDEX](/sql/t-sql/statements/alter-fulltext-index-transact-sql) ... SET CHANGE_TRACKING MANUAL  
  
     Дополнительные сведения см. в примерах «В. Создание полнотекстового индекса с отслеживанием изменений вручную» и «Г. Выполнение заполнения вручную» далее в этом разделе.  
  
 **Отключение отслеживания изменений**  
  
-   [CREATE FULLTEXT INDEX](/sql/t-sql/statements/create-fulltext-index-transact-sql) ... WITH CHANGE_TRACKING OFF  
  
-   [ALTER FULLTEXT INDEX](/sql/t-sql/statements/alter-fulltext-index-transact-sql) ... SET CHANGE_TRACKING OFF  
  

  
### <a name="incremental-timestamp-based-population"></a>Добавочное заполнение с использованием отметок времени  
 Добавочное заполнение является альтернативным механизмом по отношению к заполнению полнотекстового индекса вручную. Можно запустить добавочное заполнение для полнотекстового индекса, у которого параметру CHANGE_TRACKING присвоено значение MANUAL или OFF. Если первое заполнение полнотекстового индекса является добавочным, то производится индексирование всех строк, что является эквивалентом полного заполнения.  
  
 Для выполнения добавочного заполнения проиндексированная таблица должна включать столбец типа `timestamp`. Если столбца типа `timestamp` в таблице нет, добавочное заполнение невозможно. Попытка выполнить добавочное заполнение для таблицы, не содержащей столбец типа `timestamp`, приведет к полному заполнению. Кроме того, если за время, прошедшее с момента последнего заполнения, изменились какие-либо метаданные, влияющие на полнотекстовый индекс таблицы, то запросы добавочного заполнения реализуются как полное заполнение. Сюда относятся и изменения в метаданных, вызванные изменениями в определениях любых столбцов, индексов или полнотекстовых индексов.  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] определяет строки, которые изменились со времени последнего заполнения, с помощью столбца `timestamp`. Затем операция добавочного заполнения обновляет полнотекстовый индекс для строк, добавленных, удаленных или измененных после или во время последнего заполнения. Если выполняется большое количество операций вставки в таблицу, то использование добавочного заполнения может быть более эффективным, чем использование заполнения вручную.  
  
 По окончании заполнения служба полнотекстового поиска сохраняет новое значение `timestamp`. Это значение — самое большое значение `timestamp`, которое встретилось средству сбора данных SQL. Это значение будет использовано в начале последующего добавочного заполнения.  
  
 Для запуска добавочного заполнения выполните инструкцию ALTER FULLTEXT INDEX с использованием предложения START INCREMENTAL POPULATION.  
  

  
##  <a name="examples-of-populating-full-text-indexes"></a><a name="examples"></a>Примеры заполнения полнотекстовых индексов  
  
> [!NOTE]  
>  В примерах этого раздела используется таблица `Production.Document` или `HumanResources.JobCandidate` образца базы данных `AdventureWorks` .  
  
### <a name="a-creating-a-full-text-index-without-running-a-full-population"></a>A. Создание полнотекстового индекса без выполнения полного заполнения  
 В следующем примере создается полнотекстовый индекс для таблицы `Production.Document` образца базы данных `AdventureWorks` . В этом примере используется параметр WITH CHANGE_TRACKING OFF, NO POPULATION для задержки первоначального полного заполнения.  
  
```  
CREATE UNIQUE INDEX ui_ukDoc ON Production.Document(DocumentID);  
CREATE FULLTEXT CATALOG AW_Production_FTCat;  
CREATE FULLTEXT INDEX ON Production.Document  
(  
    Document                         --Full-text index column name   
        TYPE COLUMN FileExtension    --Name of column that contains file type information  
        Language 1033                 --1033 is LCID for the English language  
)  
    KEY INDEX ui_ukDoc  
    ON AW_Production_FTCat  
    WITH CHANGE_TRACKING OFF, NO POPULATION;  
GO  
  
```  
  
### <a name="b-running-a-full-population-on-table"></a>Б. Выполнение полного заполнения в таблице  
 В следующем примере полное заполнение выполняется в таблице `Production.Document` образца базы данных `AdventureWorks` .  
  
```  
ALTER FULLTEXT INDEX ON Production.Document  
   START FULL POPULATION;  
```  
  
### <a name="c-creating-a-full-text-index-with-manual-change-tracking"></a>В. Создание полнотекстового индекса с отслеживанием изменений вручную  
 В следующем примере создается полнотекстовый индекс, который будет использовать отслеживание изменений с заполнением вручную в таблице `HumanResources.JobCandidate` образца базы данных `AdventureWorks` .  
  
```  
USE AdventureWorks;  
GO  
CREATE UNIQUE INDEX ui_ukJobCand ON HumanResources.JobCandidate(JobCandidateID);  
CREATE FULLTEXT CATALOG ft AS DEFAULT;  
CREATE FULLTEXT INDEX ON HumanResources.JobCandidate(Resume)   
   KEY INDEX ui_ukJobCand   
   WITH CHANGE_TRACKING=MANUAL;  
GO  
```  
  
### <a name="d-running-a-manual-population"></a>Г. Выполнение заполнения вручную  
 В следующем примере выполняется заполнение вручную на полнотекстовом индексе с отслеживанием изменений для таблицы `HumanResources.JobCandidate` образца базы данных `AdventureWorks` .  
  
```  
USE AdventureWorks;  
GO  
ALTER FULLTEXT INDEX ON HumanResources.JobCandidate START UPDATE POPULATION;  
GO  
```  
  
### <a name="e-altering-a-full-text-index-to-use-automatic-change-tracking"></a>Д. Переключение полнотекстового индекса на автоматическое отслеживание изменений  
 В следующем примере полнотекстовый индекс таблицы `HumanResources.JobCandidate` образца базы данных `AdventureWorks` переключается на отслеживание изменений с автоматическим заполнением.  
  
```  
USE AdventureWorks;  
GO  
ALTER FULLTEXT INDEX ON HumanResources.JobCandidate SET CHANGE_TRACKING AUTO;  
GO   
```  
  

  
##  <a name="creating-or-changing-a-schedule-for-incremental-population"></a><a name="create"></a>Создание или изменение расписания для добавочного заполнения  
  
#### <a name="to-create-or-change-a-schedule-for-incremental-population-in-management-studio"></a>Создание или изменение расписания добавочных заполнений в Management Studio  
  
1.  В обозревателе объектов разверните узел сервера.  
  
2.  Разверните узел **Базы данных**, а затем базу данных, которая содержит полнотекстовый индекс.  
  
3.  Раскройте узел **Таблицы**.  
  
 Правой кнопкой мыши щелкните таблицу, в которой определен полнотекстовый индекс, выберите **Полнотекстовый индекс**, затем в контекстном меню **Полнотекстовый индекс** выберите **Свойства**. Откроется диалоговое окно **Свойства полнотекстового индекса** .  
  
1.  На панели **Выбор страницы** выберите пункт расписания.  
  
     Эта страница используется для создания расписания задания агента SQL Server, которое запускает добавочное заполнение базовой таблицы или индексированного представления полнотекстового индекса, а также для управления таким расписанием.  
  
    > [!IMPORTANT]  
    >  Если базовая таблица или представление не содержат столбец типа данных `timestamp`, то выполняется полное заполнение.  
  
     Существуют следующие варианты выбора.  
  
    -   Чтобы создать новое расписание, щелкните **Создать**.  
  
         Откроется диалоговое окно **Создание расписания полнотекстового индексирования таблицы** , в котором можно создать расписание. Чтобы сохранить расписание, нажмите кнопку **ОК**.  
  
        > [!IMPORTANT]  
        >  Задание агента SQL Server (запуск добавочного заполнения таблицы на *имя_базы_данных*.*имя_таблицы*) связывается с новым расписанием после выхода из диалогового окна **Свойства полнотекстового индекса** . Если создается несколько расписаний для полнотекстового индекса, то все они используют одно и то же задание.  
  
    -   Чтобы изменить расписание, выделите его и нажмите кнопку **Изменить**.  
  
         Откроется диалоговое окно **Создание расписания полнотекстового индексирования таблицы** , в котором можно изменить расписание.  
  
        > [!NOTE]  
        >  Сведения об изменении задания см. в статье [Изменение задания](../../ssms/agent/modify-a-job.md).  
  
    -   Чтобы удалить расписание, выделите его и нажмите кнопку **Удалить**.  
  
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  

  
##  <a name="troubleshooting-errors-in-a-full-text-population-crawl"></a><a name="crawl"></a>Устранение ошибок полнотекстового заполнения (сканирование)  
 При возникновении ошибки во время сканирования модуль протоколирования сканирования, входящий в механизм полнотекстового поиска, создает и обновляет журнал сканирования, хранящийся в текстовом файле. Каждый журнал сканирования соответствует конкретному полнотекстовому каталогу. По умолчанию журналы сканирования, соответствующие конкретному экземпляру — в данном случае первому экземпляру, — располагаются в папке «%ProgramFiles%\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\LOG». Имена файлов журналов сканирования имеют следующий формат.  
  
 SQLFT \<DatabaseID> \<FullTextCatalogID> . LOG [ \<n> ]  
  
 <`DatabaseID`>  
 Идентификатор базы данных. <`dbid`> — это пять цифр с нулем в начале.  
  
 <`FullTextCatalogID`>  
 Идентификатор полнотекстового каталога. <`catid`> — это пять цифр с нулем в начале.  
  
 <`n`>  
 Целое число, свидетельствующее о существовании одного или нескольких журналов сканирования одного полнотекстового каталога.  
  
 Например, SQLFT0000500008.2 является файлом журнала сканирования для базы данных с идентификатором базы данных 5 и идентификатором полнотекстового каталога 8. Двойка в конце имени файла показывает, что этой паре базы данных и каталога соответствуют два файла журналов сканирования.  
  

  
## <a name="see-also"></a>См. также:  
 [sys.dm_fts_index_population (Transact-SQL)](/sql/relational-databases/system-dynamic-management-views/sys-dm-fts-index-population-transact-sql)   
 [Приступая к работе с компонентом Full-Text Search](get-started-with-full-text-search.md)   
 [Создание и управление полнотекстовыми индексами](create-and-manage-full-text-indexes.md)   
 [CREATE FULLTEXT INDEX (Transact-SQL)](/sql/t-sql/statements/create-fulltext-index-transact-sql)   
 [ALTER FULLTEXT INDEX (Transact-SQL)](/sql/t-sql/statements/alter-fulltext-index-transact-sql)  
  
  
