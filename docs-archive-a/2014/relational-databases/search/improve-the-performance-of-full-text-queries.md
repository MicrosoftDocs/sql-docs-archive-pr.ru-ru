---
title: Повышение производительности полнотекстовых запросов | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: search
ms.topic: conceptual
ms.assetid: 0658dc74-25eb-4486-bbd6-e85c1f92c272
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: a1437f710725df5c87d31f6a80939a5d7869b412
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87733802"
---
# <a name="improve-the-performance-of-full-text-queries"></a><span data-ttu-id="ec094-102">Улучшение производительности полнотекстовых запросов</span><span class="sxs-lookup"><span data-stu-id="ec094-102">Improve the Performance of Full-Text Queries</span></span>
  <span data-ttu-id="ec094-103">Далее приведен список рекомендаций по повышению производительности обработки полнотекстовых запросов.</span><span class="sxs-lookup"><span data-stu-id="ec094-103">The following is a list of recommendations that will help to improve the performance of full-text queries.</span></span>  
  
 <span data-ttu-id="ec094-104">Производительность выполнения полнотекстовых запросов зависит от архитектуры компьютера, а также от объема памяти, скорости работы жесткого диска, ЦП и другого оборудования.</span><span class="sxs-lookup"><span data-stu-id="ec094-104">The performance of full-text queries is also influenced by hardware resources, such as memory, disk speed, CPU speed, and machine architecture.</span></span>  
  
-   <span data-ttu-id="ec094-105">Выполните дефрагментацию индекса базовой таблицы с помощью инструкции [ALTER INDEX REORGANIZE](/sql/t-sql/statements/alter-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="ec094-105">Defragment the index of the base table by using [ALTER INDEX REORGANIZE](/sql/t-sql/statements/alter-index-transact-sql).</span></span>  
  
-   <span data-ttu-id="ec094-106">Реорганизуйте полнотекстовый каталог с помощью инструкции [ALTER FULLTEXT CATALOG REORGANIZE](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="ec094-106">Reorganize the full-text catalog by using [ALTER FULLTEXT CATALOG REORGANIZE](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql).</span></span> <span data-ttu-id="ec094-107">Это необходимо сделать до начала тестирования производительности, поскольку при выполнении этой инструкции производится слияние полнотекстовых индексов в каталоге в единый файл.</span><span class="sxs-lookup"><span data-stu-id="ec094-107">Make sure that you do this before performance testing because running this statement causes a master merge of the full-text indexes in that catalog.</span></span>  
  
-   <span data-ttu-id="ec094-108">В качестве полнотекстового ключевого столбца выбирайте небольшой столбец.</span><span class="sxs-lookup"><span data-stu-id="ec094-108">Restrict your choice of full-text key columns to a small column.</span></span> <span data-ttu-id="ec094-109">Несмотря на то, что поддерживаются столбцы шириной до 900 байт, рекомендуется использовать для полнотекстового индекса ключевые столбцы меньшего размера.</span><span class="sxs-lookup"><span data-stu-id="ec094-109">Although a 900-byte column is supported, we recommend using a smaller key column in a full-text index.</span></span> <span data-ttu-id="ec094-110">Использование типов `int` и `bigint` обеспечивает улучшенную производительность.</span><span class="sxs-lookup"><span data-stu-id="ec094-110">`int` and `bigint` provide the best performance.</span></span>  
  
-   <span data-ttu-id="ec094-111">При использовании целочисленного полнотекстового ключа можно избежать соединения с таблицей сопоставлений **docid** .</span><span class="sxs-lookup"><span data-stu-id="ec094-111">Using an integer full-text key avoids a join with the **docid** mapping table.</span></span> <span data-ttu-id="ec094-112">Следовательно, использование целочисленного полнотекстового ключа на порядок увеличивает производительность запросов и увеличивает производительность сканирования.</span><span class="sxs-lookup"><span data-stu-id="ec094-112">Therefore, an integer full-text key improves query performance by an order of magnitude and improves crawl performance.</span></span> <span data-ttu-id="ec094-113">Еще большей производительности можно добиться, если сделать полнотекстовый ключ также и ключом кластеризованного индекса.</span><span class="sxs-lookup"><span data-stu-id="ec094-113">Additional performance benefits might result if the full-text key is also the clustered index key.</span></span>  
  
-   <span data-ttu-id="ec094-114">Соедините несколько предикатов [CONTAINS](/sql/t-sql/queries/contains-transact-sql) в один.</span><span class="sxs-lookup"><span data-stu-id="ec094-114">Combine multiple [CONTAINS](/sql/t-sql/queries/contains-transact-sql) predicates into one CONTAINS predicate.</span></span> <span data-ttu-id="ec094-115">В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в запросе с предикатом CONTAINS можно указывать список столбцов.</span><span class="sxs-lookup"><span data-stu-id="ec094-115">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] you can specify a list of columns in the CONTAINS query.</span></span>  
  
-   <span data-ttu-id="ec094-116">Если нужно лишь получить полнотекстовый ключ или сведения о ранжировании, то вместо предикатов CONTAINS и FREETEXT следует использовать соответственно функции [CONTAINSTABLE](/sql/relational-databases/system-functions/containstable-transact-sql) и [FREETEXTTABLE](/sql/relational-databases/system-functions/freetexttable-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="ec094-116">If you only require full-text key or rank information, use [CONTAINSTABLE](/sql/relational-databases/system-functions/containstable-transact-sql) or [FREETEXTTABLE](/sql/relational-databases/system-functions/freetexttable-transact-sql) instead of CONTAINS or FREETEXT, respectively.</span></span>  
  
-   <span data-ttu-id="ec094-117">Чтобы ограничить результаты и повысить производительность, воспользуйтесь параметром *top_n_by_rank* функций FREETEXTTABLE и CONTAINSTABLE.</span><span class="sxs-lookup"><span data-stu-id="ec094-117">To limit results and increase performance, use the *top_n_by_rank* parameter of the FREETEXTTABLE and CONTAINSTABLE functions.</span></span> <span data-ttu-id="ec094-118">Параметр*top_n_by_rank* позволяет выбирать только те попадания, которые соответствуют запросу в наибольшей степени.</span><span class="sxs-lookup"><span data-stu-id="ec094-118">*top_n_by_rank* allows you to recall only the most relevant hits.</span></span> <span data-ttu-id="ec094-119">Этот параметр используется, только если для бизнес-сценария не требуется выбирать все возможные попадания (т.е. не требуется *общая выборка*).</span><span class="sxs-lookup"><span data-stu-id="ec094-119">Use this parameter only if your business scenario does not require recalling all possible hits (that is, it does not require *total recall*).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="ec094-120">Общая выборка обычно необходима для юридических сценариев, но для безнес-сценариев, например для электронного бизнеса, она может быть менее важна, чем производительность.</span><span class="sxs-lookup"><span data-stu-id="ec094-120">Total recall is typically necessary for legal scenarios but might be less important than performance for business scenarios such as an e-business.</span></span>  
  
-   <span data-ttu-id="ec094-121">Проверьте план полнотекстового запроса и убедитесь, что выбран подходящий план соединения.</span><span class="sxs-lookup"><span data-stu-id="ec094-121">Check the full-text query plan to make sure that the appropriate join plan is chosen.</span></span> <span data-ttu-id="ec094-122">При необходимости используйте указание соединения или запроса.</span><span class="sxs-lookup"><span data-stu-id="ec094-122">Use a join hint or query hint if you have to.</span></span> <span data-ttu-id="ec094-123">Если в полнотекстовом запросе используется параметр, то его начальное значение определяется планом запроса.</span><span class="sxs-lookup"><span data-stu-id="ec094-123">If a parameter is used in the full-text query, the first-time value of the parameter determines the query plan.</span></span> <span data-ttu-id="ec094-124">Для принудительной компиляции запроса с заданным значением используйте [указание запроса](/sql/t-sql/queries/hints-transact-sql-query) OPTIMIZE FOR.</span><span class="sxs-lookup"><span data-stu-id="ec094-124">You can use the OPTIMIZE FOR [query hint](/sql/t-sql/queries/hints-transact-sql-query) to force the query to compile with the value you want.</span></span> <span data-ttu-id="ec094-125">Это позволит сделать план запроса детерминированным и повысить его производительность.</span><span class="sxs-lookup"><span data-stu-id="ec094-125">This helps achieve a deterministic query plan and better performance.</span></span>  
  
-   <span data-ttu-id="ec094-126">Наличие в полнотекстовом индексе слишком большого числа полнотекстовых фрагментов может привести к существенному снижению производительности запросов.</span><span class="sxs-lookup"><span data-stu-id="ec094-126">Too many full-text index fragments in the full-text index, can lead to substantial degradation in query performance.</span></span> <span data-ttu-id="ec094-127">Чтобы уменьшить число фрагментов, выполните переорганизацию полнотекстового каталога с помощью параметра REORGANIZE в инструкции [ALTER FULLTEXT CATALOG](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql)[!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ec094-127">To reduce the number of fragments, reorganize the full-text catalog by using the REORGANIZE option of the [ALTER FULLTEXT CATALOG](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql)[!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span> <span data-ttu-id="ec094-128">Эта инструкция выполняет слияние всех фрагментов в единый большой фрагмент и удаляет все устаревшие записи из полнотекстового индекса.</span><span class="sxs-lookup"><span data-stu-id="ec094-128">This statement essentially merges all the fragments into a single larger fragment and removes all obsolete entries from the full-text index.</span></span>  
  
-   <span data-ttu-id="ec094-129">В полнотекстовом поиске логические операторы, указанные в функции CONTAINSTABLE (AND, OR), могут быть реализованы либо как соединения SQL, либо в полнотекстовых потоковых функциях с табличным значением.</span><span class="sxs-lookup"><span data-stu-id="ec094-129">In  full-text search, logical operators specified in CONTAINSTABLE (AND, OR) can be implemented either as SQL joins or inside the full-text execution streaming table-valued functions (STVF).</span></span> <span data-ttu-id="ec094-130">Обычно запросы, в которых используется только один тип логических операторов, реализуются только средствами полнотекстового выполнения, а запросы, в которых используется одновременно несколько операторов, используют также соединения SQL.</span><span class="sxs-lookup"><span data-stu-id="ec094-130">Typically, queries with only one type of logical operators are implemented purely by full-text execution, whereas queries that mix logical operators also possess SQL joins.</span></span> <span data-ttu-id="ec094-131">При реализации логического оператора в полнотекстовой системной функции, возвращающей табличное значение, используются некоторые специальные свойства индекса, которые обеспечивают уровень производительности, намного превышающий уровень производительности соединений SQL.</span><span class="sxs-lookup"><span data-stu-id="ec094-131">Implementation of a logical operator inside the full-text execution STVF uses some special index properties that make it much faster than SQL joins.</span></span> <span data-ttu-id="ec094-132">В связи с этим рекомендуется по возможности составлять запросы, в которых используется только один тип логического оператора.</span><span class="sxs-lookup"><span data-stu-id="ec094-132">For this reason, we recommend that, where possible, you frame queries using only a single type of logical operator.</span></span>  
  
-   <span data-ttu-id="ec094-133">В приложениях, в которых используются предикаты с селективной связью, наилучшей производительности запросов с использованием избирательных реляционных предикатов и неизбирательных полнотекстовых предикатов можно добиться, настроив их на использование оптимизатора запросов.</span><span class="sxs-lookup"><span data-stu-id="ec094-133">For applications that contain selective-relation predications, queries that use selective relational predicates and unselective full-text predicates might perform best when they are written to use the query optimizer.</span></span> <span data-ttu-id="ec094-134">Это позволит оптимизатору запросов определить, может ли он использовать предикат или диапазон для создания эффективного плана запроса.</span><span class="sxs-lookup"><span data-stu-id="ec094-134">This allows the query optimizer to decide whether it can exploit predicate or range pushdown to produce an effective query plan.</span></span> <span data-ttu-id="ec094-135">Данный подход более прост и часто более эффективен, чем индексирование реляционных данных в качестве полнотекстовых данных.</span><span class="sxs-lookup"><span data-stu-id="ec094-135">This approach is simpler and often more efficient than indexing relational data as full-text data.</span></span>  
  
## <a name="related-resources"></a><span data-ttu-id="ec094-136">Связанные ресурсы</span><span class="sxs-lookup"><span data-stu-id="ec094-136">Related Resources</span></span>  
 [<span data-ttu-id="ec094-137">Средство полнотекстового поиска SQL Server 2008: возможности и улучшения</span><span class="sxs-lookup"><span data-stu-id="ec094-137">SQL Server 2008 Full-Text Search: Internals and Enhancements</span></span>](https://go.microsoft.com/fwlink/?LinkId=129544)  
  
## <a name="see-also"></a><span data-ttu-id="ec094-138">См. также:</span><span class="sxs-lookup"><span data-stu-id="ec094-138">See Also</span></span>  
 <span data-ttu-id="ec094-139">[sys.dm_fts_memory_buffers (Transact-SQL)](/sql/relational-databases/system-dynamic-management-views/sys-dm-fts-memory-buffers-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="ec094-139">[sys.dm_fts_memory_buffers &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-fts-memory-buffers-transact-sql) </span></span>  
 [<span data-ttu-id="ec094-140">sys.dm_fts_memory_pools (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="ec094-140">sys.dm_fts_memory_pools &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-fts-memory-pools-transact-sql)  
  
  
