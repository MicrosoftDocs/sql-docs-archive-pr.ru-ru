---
title: Имена субъектов-служб (SPN) в клиентских соединениях (ODBC) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
ms.assetid: 1d60cb30-4c46-49b2-89ab-701e77a330a2
author: rothja
ms.author: jroth
ms.openlocfilehash: 752cbdbf017fac6d086b9493c23ea7a490ac6ef7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87734030"
---
# <a name="service-principal-names-spns-in-client-connections-odbc"></a><span data-ttu-id="0e841-102">Имена участника-службы в клиентских соединениях (ODBC)</span><span class="sxs-lookup"><span data-stu-id="0e841-102">Service Principal Names (SPNs) in Client Connections (ODBC)</span></span>
  <span data-ttu-id="0e841-103">В данном разделе рассматриваются атрибуты и функции ODBC, поддерживающие имена участника-службы (SPN) в клиентских приложениях.</span><span class="sxs-lookup"><span data-stu-id="0e841-103">This topic describes ODBC attributes and functions that support service principal names (SPNs) in client applications.</span></span> <span data-ttu-id="0e841-104">Дополнительные сведения об именах участников-служб в клиентских приложениях см. в разделе [имя субъекта-службы &#40;SPN&#41; поддержку в клиентских подключениях](../features/service-principal-name-spn-support-in-client-connections.md) и [получение взаимной проверки подлинности Kerberos](../../native-client-odbc-how-to/get-mutual-kerberos-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="0e841-104">For more information about SPNs in client applications, see [Service Principal Name &#40;SPN&#41; Support in Client Connections](../features/service-principal-name-spn-support-in-client-connections.md) and [Get Mutual Kerberos Authentication](../../native-client-odbc-how-to/get-mutual-kerberos-authentication.md).</span></span>  
  
## <a name="connection-string-keywords"></a><span data-ttu-id="0e841-105">Ключевые слова в строке подключения</span><span class="sxs-lookup"><span data-stu-id="0e841-105">Connection String Keywords</span></span>  
 <span data-ttu-id="0e841-106">Следующие ключевые слова в строках подключения позволяют задавать имена участника-службы в клиентских приложениях.</span><span class="sxs-lookup"><span data-stu-id="0e841-106">The following connection string keywords enable client applications to specify an SPN.</span></span>  
  
|<span data-ttu-id="0e841-107">Ключевое слово</span><span class="sxs-lookup"><span data-stu-id="0e841-107">Keyword</span></span>|<span data-ttu-id="0e841-108">Значение</span><span class="sxs-lookup"><span data-stu-id="0e841-108">Value</span></span>|  
|-------------|-----------|  
|`ServerSPN`|<span data-ttu-id="0e841-109">Имя участника-службы для сервера.</span><span class="sxs-lookup"><span data-stu-id="0e841-109">The SPN for the server.</span></span> <span data-ttu-id="0e841-110">Значением по умолчанию является пустая строка, что вынуждает собственного клиента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] использовать сформированное драйвером имя участника-службы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="0e841-110">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span>|  
|`FailoverPartnerSPN`|<span data-ttu-id="0e841-111">Имя участника-службы для партнера по обеспечению отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="0e841-111">The SPN for the failover partner.</span></span> <span data-ttu-id="0e841-112">Значением по умолчанию является пустая строка, что вынуждает собственного клиента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] использовать сформированное драйвером имя участника-службы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="0e841-112">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span>|  
  
## <a name="connection-attributes"></a><span data-ttu-id="0e841-113">Атрибуты соединения</span><span class="sxs-lookup"><span data-stu-id="0e841-113">Connection Attributes</span></span>  
 <span data-ttu-id="0e841-114">Следующие атрибуты соединения позволяют указать имя участника-службы и запросить метод проверки подлинности в клиентском приложении.</span><span class="sxs-lookup"><span data-stu-id="0e841-114">The following connection attributes enable client applications to specify an SPN and query for the authentication method.</span></span>  
  
|<span data-ttu-id="0e841-115">Имя</span><span class="sxs-lookup"><span data-stu-id="0e841-115">Name</span></span>|<span data-ttu-id="0e841-116">Тип</span><span class="sxs-lookup"><span data-stu-id="0e841-116">Type</span></span>|<span data-ttu-id="0e841-117">Использование</span><span class="sxs-lookup"><span data-stu-id="0e841-117">Usage</span></span>|  
|----------|----------|-----------|  
|<span data-ttu-id="0e841-118">SQL_COPT_SS_SERVER_SPN</span><span class="sxs-lookup"><span data-stu-id="0e841-118">SQL_COPT_SS_SERVER_SPN</span></span><br /><br /> <span data-ttu-id="0e841-119">SQL_COPT_SS_FAILOVER_PARTNER_SPN</span><span class="sxs-lookup"><span data-stu-id="0e841-119">SQL_COPT_SS_FAILOVER_PARTNER_SPN</span></span>|<span data-ttu-id="0e841-120">SQLTCHAR, чтение и запись</span><span class="sxs-lookup"><span data-stu-id="0e841-120">SQLTCHAR, read/write</span></span>|<span data-ttu-id="0e841-121">Задает имя участника-службы для сервера.</span><span class="sxs-lookup"><span data-stu-id="0e841-121">Specifies the SPN for the server.</span></span> <span data-ttu-id="0e841-122">Значением по умолчанию является пустая строка, что вынуждает собственного клиента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] использовать сформированное драйвером имя участника-службы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="0e841-122">The default value is an empty string, which causes [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client to use the default, driver-generated SPN.</span></span><br /><br /> <span data-ttu-id="0e841-123">Значение этого атрибута можно запрашивать только после его задания программным путем или после открытия соединения.</span><span class="sxs-lookup"><span data-stu-id="0e841-123">This attribute can be queried only after it has been set programmatically, or after a connection has been opened.</span></span> <span data-ttu-id="0e841-124">В противном случае будет возвращено значение SQL_ERROR, а в журнал занесена диагностическая запись с кодом SQLState (равным 08003) и сообщением «Соединение не открыто».</span><span class="sxs-lookup"><span data-stu-id="0e841-124">If an attempt is made to query this attribute on a connection that is not open and the attribute has not been set programmatically, SQL_ERROR is returned, and a diagnostic record is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="0e841-125">При попытке установить этот атрибут при открытом соединении будет возвращено значение SQL_ERROR и в журнал будет занесена диагностическая запись с кодом SQLState (равным HY011) и сообщением «В настоящее время эта операция недопустима».</span><span class="sxs-lookup"><span data-stu-id="0e841-125">If an attempt is made to set this attribute when a connection is open, SQL_ERROR is returned, and a diagnostic record is logged with SQLState HY011 and the message "Operation invalid at this time".</span></span>|  
|<span data-ttu-id="0e841-126">SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD</span><span class="sxs-lookup"><span data-stu-id="0e841-126">SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD</span></span>|<span data-ttu-id="0e841-127">SQLTCHAR, только чтение</span><span class="sxs-lookup"><span data-stu-id="0e841-127">SQLTCHAR, read-only</span></span>|<span data-ttu-id="0e841-128">Возвращает метод проверки подлинности, используемый для соединения.</span><span class="sxs-lookup"><span data-stu-id="0e841-128">Returns the authentication method used for the connection.</span></span> <span data-ttu-id="0e841-129">Приложению возвращается значение, которое Windows возвращает собственному клиенту [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0e841-129">The value returned to the application is the value that Windows returns to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span></span> <span data-ttu-id="0e841-130">Возможны следующие значения:</span><span class="sxs-lookup"><span data-stu-id="0e841-130">Possible values are:</span></span><br /><br /> <span data-ttu-id="0e841-131">— "NTLM", который возвращается при открытии соединения с использованием проверки подлинности NTLM.</span><span class="sxs-lookup"><span data-stu-id="0e841-131">-   "NTLM", which is returned when a connection is opened using NTLM authentication.</span></span><br /><span data-ttu-id="0e841-132">— "Kerberos", который возвращается при открытии соединения с использованием проверки подлинности Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0e841-132">-   "Kerberos", which is returned when a connection is opened using Kerberos authentication.</span></span><br /><br /> <span data-ttu-id="0e841-133">Этот атрибут можно прочитать только при открытом соединении, использующем проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="0e841-133">This attribute can only be read for an open connection that used Windows Authentication.</span></span> <span data-ttu-id="0e841-134">При попытке считать его до открытия соединения вернется значение SQL_ERROR и в журнал будет записана ошибка с кодом SQLState 08003 и сообщением «Соединение не открыто».</span><span class="sxs-lookup"><span data-stu-id="0e841-134">If an attempt is made to read it before a connection has been opened, SQL_ERROR is returned, and an error is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="0e841-135">При попытке запросить значение этого атрибута применительно к соединению, в котором не используется проверка подлинности Windows, возвращается значение SQL_ERROR, а в журнал вносится диагностическая запись с кодом SQLState (равным HY092) и сообщением «Недопустимый идентификатор атрибута или параметра (метод SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD доступен только для доверительных соединений)».</span><span class="sxs-lookup"><span data-stu-id="0e841-135">If this attribute is queried on a connection that did not use Windows Authentication, SQL_ERROR is returned, and an error is logged with SQLState HY092 and the message "Invalid attribute/option identifier (SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD is only available for Trusted Connections)".</span></span><br /><br /> <span data-ttu-id="0e841-136">Если не удается определить используемый метод проверки подлинности, происходит возврат значения SQL_ERROR и в журнал вносится диагностическая запись с кодом SQLState (равным HY000) и сообщением «Общая ошибка».</span><span class="sxs-lookup"><span data-stu-id="0e841-136">If the authentication method cannot be determined, SQL_ERROR is returned, and an error is logged with SQLState HY000 and the message "General error".</span></span>|  
|<span data-ttu-id="0e841-137">SQL_COPT_SS_MUTUALLY_AUTHENTICATED</span><span class="sxs-lookup"><span data-stu-id="0e841-137">SQL_COPT_SS_MUTUALLY_AUTHENTICATED</span></span>|<span data-ttu-id="0e841-138">SQLSMALLINT, только для чтения</span><span class="sxs-lookup"><span data-stu-id="0e841-138">SQLSMALLINT, read-only</span></span>|<span data-ttu-id="0e841-139">Происходит возврат значения SQL_TRUE, если сервер соединения прошел взаимную проверку подлинности; в противном случае возвращается значение SQL_FALSE.</span><span class="sxs-lookup"><span data-stu-id="0e841-139">Returns SQL_TRUE if the server in the connection was mutually authenticated; otherwise, returns SQL_FALSE.</span></span><br /><br /> <span data-ttu-id="0e841-140">Этот атрибут можно прочитать только при открытом соединении.</span><span class="sxs-lookup"><span data-stu-id="0e841-140">This attribute can only be read for an open connection.</span></span> <span data-ttu-id="0e841-141">При попытке считать его до открытия соединения вернется значение SQL_ERROR и в журнал будет записана ошибка с кодом SQLState 08003 и сообщением «Соединение не открыто».</span><span class="sxs-lookup"><span data-stu-id="0e841-141">If an attempt is made to read it before a connection has been opened, SQL_ERROR is returned, and an error is logged with SQLState 08003 and the message "Connection not open".</span></span><br /><br /> <span data-ttu-id="0e841-142">При попытке запросить значение этого атрибута применительно к соединению, в котором не используется проверка подлинности Windows, будет возвращено значение SQL_FALSE.</span><span class="sxs-lookup"><span data-stu-id="0e841-142">If this attribute is queried for a connection that did not use Windows Authentication, SQL_FALSE is returned.</span></span>|  
  
## <a name="odbc-function-support-for-specifying-spns"></a><span data-ttu-id="0e841-143">Поддержка задания имен участников-служб с помощью функций ODBC</span><span class="sxs-lookup"><span data-stu-id="0e841-143">ODBC Function Support for Specifying SPNs</span></span>  
 <span data-ttu-id="0e841-144">Клиентские приложения и имена участников-служб поддерживаются следующими функциями ODBC.</span><span class="sxs-lookup"><span data-stu-id="0e841-144">The following ODBC functions support client applications and SPNs:</span></span>  
  
-   [<span data-ttu-id="0e841-145">SQLBrowseConnect</span><span class="sxs-lookup"><span data-stu-id="0e841-145">SQLBrowseConnect</span></span>](../../native-client-odbc-api/sqlbrowseconnect.md)  
  
-   [<span data-ttu-id="0e841-146">SQLConnect</span><span class="sxs-lookup"><span data-stu-id="0e841-146">SQLConnect</span></span>](../../native-client-odbc-api/sqlconnect.md)  
  
-   [<span data-ttu-id="0e841-147">SQLDriverConnect</span><span class="sxs-lookup"><span data-stu-id="0e841-147">SQLDriverConnect</span></span>](../../native-client-odbc-api/sqldriverconnect.md)  
  
-   [<span data-ttu-id="0e841-148">SQLGetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="0e841-148">SQLGetConnectAttr</span></span>](../../native-client-odbc-api/sqlgetconnectattr.md)  
  
-   [<span data-ttu-id="0e841-149">SQLSetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="0e841-149">SQLSetConnectAttr</span></span>](../../native-client-odbc-api/sqlsetconnectattr.md)  
  
## <a name="see-also"></a><span data-ttu-id="0e841-150">См. также:</span><span class="sxs-lookup"><span data-stu-id="0e841-150">See Also</span></span>  
 [<span data-ttu-id="0e841-151">SQL Server Native Client (ODBC)</span><span class="sxs-lookup"><span data-stu-id="0e841-151">SQL Server Native Client &#40;ODBC&#41;</span></span>](sql-server-native-client-odbc.md)  
  
  
