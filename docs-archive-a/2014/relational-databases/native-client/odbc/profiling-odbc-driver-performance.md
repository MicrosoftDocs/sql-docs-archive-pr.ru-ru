---
title: Профилирование производительности драйвера ODBC | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- profiling ODBC driver performance data [SQL Server Native Client]
- performance [ODBC]
- application statistics [ODBC]
- time statistics [ODBC]
- ODBC, performance data
- SQL Server Native Client ODBC driver, profiling performance data
- SQLPERF data structure
- statistical information [ODBC]
ms.assetid: 8f44e194-d556-4119-a759-4c9dec7ecead
author: rothja
ms.author: jroth
ms.openlocfilehash: 91373d22b845dd0abb1263b7fa367b4bf3bff42e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87657067"
---
# <a name="profiling-odbc-driver-performance"></a>Создание профилей производительности драйвера ODBC
  Драйвер ODBC для собственного клиента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предоставляет при профилировании два типа данных о производительности.  
  
-   Длительные запросы.  
  
     Драйвер может записывать в файл журнала любой запрос, который не получает ответа от сервера в течение заданного промежутка времени. Прикладные программисты или администраторы баз данных могут исследовать каждую записанную в журнал инструкцию SQL, чтобы определить, как повысить производительность.  
  
-   Данные о производительности драйвера.  
  
     Драйвер может регистрировать статистику производительности и либо записывать ее в файл, либо раскрывать ее для приложения с помощью специфической собственной структуры драйвера, называемой SQLPERF. Файл, содержащий статистику производительности, использует в качестве разделителей знаки табуляции. Этот файл можно легко проанализировать с помощью электронной таблицы, поддерживающей знаки табуляции в качестве разделителей, такой как Microsoft Excel.  
  
 Оба типа профилирования можно включить одним из следующих способов.  
  
-   Соединение с источником данных, настроенным для ведения журнала.  
  
-   Вызов [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) для задания атрибутов, зависящих от драйвера, которые управляют профилированием.  
  
 Каждый процесс приложения получает отдельную копию драйвера ODBC для собственного клиента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], а профилирование является глобальным для сочетания копии драйвера и процесса приложения. Если какое-либо действие приложения включает профилирование, записываются сведения для всех активных соединений с драйвером из этого приложения. Включаются даже соединения, которые сами не определяли профилирование.  
  
 После того как драйвер открывает журнал профилирования (журнал данных о производительности либо журнал длительных запросов), он не закрывает журнал, пока сам не будет выгружен диспетчером драйверов ODBC, когда приложение освободит все дескрипторы, открытые в драйвере. Если приложение открывает новый дескриптор среды, загружается новая копия драйвера. Если приложение затем подключается к источнику данных, указывающему тот же файл журнала или задающему запись атрибутов драйвера в тот же файл журнала, драйвер перезаписывает старый журнал.  
  
 Если приложение начинает профилирование в файл журнала, а другое приложение выполняет попытку профилирования в тот же файл журнала, второму приложению не удастся записать в журнал какие-либо данные профилирования. Если второе приложение запускает профилирование после выгрузки драйвера первым приложением, второе приложение перезаписывает файл журнала первого приложения.  
  
 Если приложение подключается к источнику данных с включенным профилированием, драйвер возвращает SQL_ERROR, если приложение вызывает **SQLSetConnectOption** для начала ведения журнала. Затем вызов **SQLGetDiagRec** возвращает следующее:  
  
```  
SQLState: 01000, pfNative = 0  
ErrorMsg: [Microsoft][SQL Server Native Client]  
   An error has occurred during the attempt to access  
   the log file, logging disabled.  
```  
  
 Драйвер прекращает собирать данные при закрытии дескриптора среды. Если приложение собственного клиента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] имеет несколько соединений, каждое с собственным дескриптором среды, драйвер прекратит собирать данные о производительности при закрытии любых связанных дескрипторов среды.  
  
 Данные о производительности драйвера могут сохраняться в структуре данных SQLPERF или записываться в файл со знаками табуляции в качестве разделителей. Эти данные содержат следующие категории статистики.  
  
-   Профиль приложения  
  
-   Соединение  
  
-   Сеть  
  
-   Time  
  
 В следующей таблице приведены описания полей структуры данных SQLPERF, также относящиеся к файлу журнала производительности.  
  
### <a name="application-profile-statistics"></a>Статистика профиля приложения  
  
|Поле SQLPERF|Описание|  
|-------------------|-----------------|  
|TimerResolution|Минимальное разрешение времени с часов сервера в миллисекундах. Обычно возвращается 0 (ноль). Это значение учитывается только в тех случаях, когда сообщается большое число. Если минимальное разрешение часов сервера больше, чем вероятные интервалы какой-либо статистики по таймеру, эти статистические данные могут оказаться завышенными.|  
|SQLidu|Количество инструкций INSERT, DELETE и UPDATE после SQL_PERF_START.|  
|SQLiduRows|Количество инструкций INSERT, DELETE и UPDATE после SQL_PERF_START.|  
|SQLSelects|Количество инструкций SELECT, обработанных после SQL_PERF_START.|  
|SQLSelectRows|Количество строк, выбранных после SQL_PERF_START.|  
|Транзакции|Количество пользовательских транзакций после SQL_PERF_START, включая откаты. Если приложение ODBC запущено с параметром SQL_AUTOCOMMIT_ON, каждая команда считается транзакцией.|  
|SQLPrepares|Число вызовов [функций SQLPrepare](https://go.microsoft.com/fwlink/?LinkId=59360) после SQL_PERF_START.|  
|ExecDirects|Число вызовов **SQLExecDirect** после SQL_PERF_START.|  
|SQLExecutes|Число вызовов **SQLExecute** после SQL_PERF_START.|  
|CursorOpens|Количество открытий драйвером серверного курсора после SQL_PERF_START.|  
|CursorSize|Количество строк в результирующих наборах, открытых курсором после SQL_PERF_START.|  
|CursorUsed|Количество строк, фактически полученных с помощью драйвера от курсоров после SQL_PERF_START.|  
|PercentCursorUsed|Равно CursorUsed/CursorSize. Например, если приложение вынуждает драйвер открыть серверный курсор для выполнения команды SELECT COUNT(*) FROM Authors, в результирующем наборе инструкции SELECT будет содержаться 23 строки. Если приложение затем выберет только три из этих строк, то CursorUsed/CursorSize равно 3/23, поэтому PercentCursorUsed составляет 13.043478.|  
|AvgFetchTime|Равно SQLFetchTime/SQLFetchCount.|  
|AvgCursorSize|Равно CursorSize/CursorOpens.|  
|AvgCursorUsed|Равно CursorUsed/CursorOpens.|  
|SQLFetchTime|Общее количество времени, потребовавшегося для выборки из серверных курсоров.|  
|SQLFetchCount|Количество выборок, выполненных из серверных курсоров после SQL_PERF_START.|  
|CurrentStmtCount|Количество дескрипторов инструкций, открытых в настоящее время для всех открытых в драйвере соединений.|  
|MaxOpenStmt|Максимальное количество одновременно открытых дескрипторов инструкций после SQL_PERF_START.|  
|SumOpenStmt|Количество дескрипторов инструкций, открытых после SQL_PERF_START.|  
|**Статистика соединений**||  
|CurrentConnectionCount|Текущее количество активных дескрипторов соединений, открытых приложением для сервера.|  
|MaxConnectionsOpened|Максимальное количество одновременно открытых дескрипторов соединений после SQL_PERF_START.|  
|SumConnectionsOpened|Общее количество дескрипторов соединений, открытых после SQL_PERF_START.|  
|SumConnectionTime|Общее количество времени, в течение которого были открыты соединения, после SQL_PERF_START. Например, если приложение открыло 10 соединений и поддерживало каждое соединение в течение 5 секунд, значение SumConnectionTime будет равно 50 секунд.|  
|AvgTimeOpened|Равно SumConnectionsOpened/ SumConnectionTime.|  
|**Сетевая статистика**||  
|ServerRndTrips|Количество раз, когда драйвер отправлял команды на сервер и получал ответ.|  
|BuffersSent|Количество пакетов потока табличных данных (TDS), отправленных драйвером в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] после SQL_PERF_START. Большие команды могут занимать несколько буферов, поэтому если на сервер отправляется большая команда, занимающая шесть пакетов, значение ServerRndTrips увеличивается на 1, а значение BuffersSent — на 6.|  
|BuffersRec|Количество пакетов потока табличных данных, полученных драйвером от [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] после начала использования драйвера приложением.|  
|BytesSent|Число байт данных, отправленных на сервер [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в пакетах TDS после начала использования драйвера приложением.|  
|BytesRec|Число байт данных в пакетах TDS, полученных драйвером от [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] после начала использования драйвера приложением.|  
  
### <a name="time-statistics"></a>Статистика по времени  
  
|Поле SQLPERF|Описание|  
|-------------------|-----------------|  
|msExecutionTime|Общее количество времени, затраченного драйвером на обработку после SQL_PERF_START, включая время на ожидание ответов от сервера.|  
|msNetworkServerTime|Общее количество времени, затраченного драйвером на ожидание ответов от сервера.|  
  
## <a name="see-also"></a>См. также:  
 [SQL Server Native Client &#40;ODBC&#41;](sql-server-native-client-odbc.md)   
 [Инструкции по профилированию производительности драйвера ODBC &#40;ODBC&#41;](../../native-client-odbc-how-to/profiling-odbc-driver-performance-odbc.md)  
  
  
