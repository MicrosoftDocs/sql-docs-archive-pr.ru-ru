---
title: Поддержка имени субъекта-службы в клиентских соединениях | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client, SPNs
- ODBC, SPNs
- OLE DB, SPNs
- SPNs [SQL Server]
ms.assetid: 96598c69-ce9a-4090-aacb-d546591e8af7
author: rothja
ms.author: jroth
ms.openlocfilehash: 10a64baa17bd070d9354beaf6ff8c2e460682318
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87656378"
---
# <a name="service-principal-name-spn-support-in-client-connections"></a><span data-ttu-id="a3e63-102">Поддержка имени участника-службы в клиентских соединениях</span><span class="sxs-lookup"><span data-stu-id="a3e63-102">Service Principal Name (SPN) Support in Client Connections</span></span>
  <span data-ttu-id="a3e63-103">Начиная с [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)] поддержка имен субъектов-служб была расширена для поддержки взаимной проверки подлинности во всех протоколах.</span><span class="sxs-lookup"><span data-stu-id="a3e63-103">Beginning with [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)], support for service principal names (SPNs) has been extended to enable mutual authentication across all protocols.</span></span> <span data-ttu-id="a3e63-104">В предыдущих версиях [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] имена субъектов-служб поддерживались только для протокола Kerberos через TCP, когда имя по умолчанию для экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] было зарегистрировано в Active Directory.</span><span class="sxs-lookup"><span data-stu-id="a3e63-104">In previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], SPNs were only supported for Kerberos over TCP when the default SPN for the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance was registered with Active Directory.</span></span>  
  
 <span data-ttu-id="a3e63-105">Имена субъектов-служб используются протоколом проверки подлинности для определения учетной записи, от которой запускается экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a3e63-105">SPNs are used by the authentication protocol to determine the account in which a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance runs.</span></span> <span data-ttu-id="a3e63-106">Если учетная запись экземпляра известна, то можно использовать проверку подлинности Kerberos для взаимной проверки подлинности клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="a3e63-106">If the instance account is known, Kerberos authentication can be used to provide mutual authentication by the client and server.</span></span> <span data-ttu-id="a3e63-107">Если учетная запись экземпляра неизвестна, то используется только проверка подлинности NTLM, которая обеспечивает проверку подлинности клиента сервером.</span><span class="sxs-lookup"><span data-stu-id="a3e63-107">If the instance account is not known, NTLM authentication, which only provides authentication of the client by the server, is used.</span></span> <span data-ttu-id="a3e63-108">В настоящее время собственный клиент [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] выполняет преобразование проверки подлинности, получая имя участника-службы из имени экземпляра и свойств сетевого подключения.</span><span class="sxs-lookup"><span data-stu-id="a3e63-108">Currently, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client performs the authentication lookup, deriving the SPN from the instance name and network connection properties.</span></span> <span data-ttu-id="a3e63-109">Экземпляры [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] попытаются зарегистрировать имена субъектов-служб при запуске, но их можно также зарегистрировать вручную.</span><span class="sxs-lookup"><span data-stu-id="a3e63-109">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances will attempt to register SPNs on startup, or they can be registered manually.</span></span> <span data-ttu-id="a3e63-110">Однако регистрация завершится ошибкой, если учетная запись, которая пытается зарегистрировать имена участников-служб, не имеет достаточных прав доступа.</span><span class="sxs-lookup"><span data-stu-id="a3e63-110">However, registration will fail if there are insufficient access rights for the account that attempts to register the SPNs.</span></span>  
  
 <span data-ttu-id="a3e63-111">Учетные записи домена и компьютера автоматически регистрируются в Active Directory.</span><span class="sxs-lookup"><span data-stu-id="a3e63-111">Domain and computer accounts are registered automatically in Active Directory.</span></span> <span data-ttu-id="a3e63-112">Их можно использовать в качестве имен участников-служб, или же администраторы могут определить собственные имена участников-служб.</span><span class="sxs-lookup"><span data-stu-id="a3e63-112">These can be used as SPNs, or administators can define their own SPNs.</span></span> <span data-ttu-id="a3e63-113">В [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] безопасная проверка подлинности стала более управляемой и надежной благодаря возможности для клиента напрямую указывать используемое имя субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="a3e63-113">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] makes secure authentication more manageable and reliable by allowing clients to directly specify the SPN to use.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a3e63-114">Указанное клиентским приложением имя участника-службы используется только в том случае, если соединение устанавливается с использованием встроенной безопасности Windows.</span><span class="sxs-lookup"><span data-stu-id="a3e63-114">An SPN specified by a client application is only used when a connection is made with Windows integrated security.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="a3e63-115">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] диспетчер конфигурации Kerberos для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** — это диагностическое средство, которое помогает расследовать проблемы Kerberos со связью при использовании [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a3e63-115">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a3e63-116">Дополнительные сведения см. в разделе [Диспетчер конфигурации Microsoft Kerberos для SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="a3e63-116">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="a3e63-117">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] диспетчер конфигурации Kerberos для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** — это диагностическое средство, которое помогает расследовать проблемы Kerberos со связью при использовании [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a3e63-117">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a3e63-118">Дополнительные сведения см. в разделе [Диспетчер конфигурации Microsoft Kerberos для SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="a3e63-118">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
 <span data-ttu-id="a3e63-119">Дополнительные сведения о протоколе Kerberos см. в следующих статьях.</span><span class="sxs-lookup"><span data-stu-id="a3e63-119">For more information about Kerberos, see the following articles:</span></span>  
  
-   [<span data-ttu-id="a3e63-120">Kerberos Technical Supplement for Windows</span><span class="sxs-lookup"><span data-stu-id="a3e63-120">Kerberos Technical Supplement for Windows</span></span>](https://go.microsoft.com/fwlink/?LinkId=101449)  
  
-   [<span data-ttu-id="a3e63-121">Microsoft Kerberos</span><span class="sxs-lookup"><span data-stu-id="a3e63-121">Microsoft Kerberos</span></span>](https://go.microsoft.com/fwlink/?LinkID=100758)  
  
## <a name="usage"></a><span data-ttu-id="a3e63-122">Использование</span><span class="sxs-lookup"><span data-stu-id="a3e63-122">Usage</span></span>  
 <span data-ttu-id="a3e63-123">В следующей таблице описаны наиболее типичные сценарии, в которых клиентские приложения могут включить безопасную проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="a3e63-123">The following table describes the most common scenarios in which client applications can enable secure authentication.</span></span>  
  
|<span data-ttu-id="a3e63-124">Сценарий</span><span class="sxs-lookup"><span data-stu-id="a3e63-124">Scenario</span></span>|<span data-ttu-id="a3e63-125">Описание</span><span class="sxs-lookup"><span data-stu-id="a3e63-125">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="a3e63-126">Приложение прежней версии не указывает имя участника-службы.</span><span class="sxs-lookup"><span data-stu-id="a3e63-126">A legacy application does not specify an SPN.</span></span>|<span data-ttu-id="a3e63-127">Этот сценарий совместимости гарантирует, что не будет изменений в работе приложений, разработанных для предыдущих версий [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a3e63-127">This compatibility scenario guarantees that there will be no behavior change for applications developed for previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a3e63-128">Если имя участника-службы не указано, то приложение использует сформированные имена участников-служб и ничего не знает об используемом методе проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="a3e63-128">If no SPN is specified, the application relies on generated SPNs and has no knowledge of which authentication method is used.</span></span>|  
|<span data-ttu-id="a3e63-129">Клиентское приложение, использующее текущую версию собственного клиента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , указывает имя участника-службы в строке соединения как учетную запись пользователя домена или компьютера, определяемое экземпляром имя участника-службы или определяемую пользователем строку.</span><span class="sxs-lookup"><span data-stu-id="a3e63-129">A client application using the current version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client specifies an SPN in the connection string as a domain user or computer account, as an instance-specific SPN, or as a user-defined string.</span></span>|<span data-ttu-id="a3e63-130">Ключевое слово `ServerSPN` может быть указано в строке поставщика, инициализации или соединения, для следующих целей.</span><span class="sxs-lookup"><span data-stu-id="a3e63-130">The `ServerSPN` keyword can be used in a provider, initialization, or connection string to do the following:</span></span><br /><br /> <span data-ttu-id="a3e63-131">— Укажите учетную запись, используемую [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] экземпляром для соединения.</span><span class="sxs-lookup"><span data-stu-id="a3e63-131">-   Specify the account used by the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance for a connection.</span></span> <span data-ttu-id="a3e63-132">Это упрощает доступ к проверке подлинности Kerberos.</span><span class="sxs-lookup"><span data-stu-id="a3e63-132">This simplifies access to Kerberos authentication.</span></span> <span data-ttu-id="a3e63-133">Если имеется центр распространения ключей Kerberos (KDC) и указана верная учетная запись, то проверка подлинности Kerberos будет предпочтительнее, чем NTLM.</span><span class="sxs-lookup"><span data-stu-id="a3e63-133">If a Kerberos Key Distribution Center (KDC) is present and the correct account is specified, Kerberos authentication is more likely to be used than NTLM.</span></span> <span data-ttu-id="a3e63-134">KDC обычно размещается на том же компьютере, что и контроллер домена.</span><span class="sxs-lookup"><span data-stu-id="a3e63-134">The KDC usually resides on the same computer as the domain controller.</span></span><br /><span data-ttu-id="a3e63-135">— Укажите имя субъекта-службы для поиска учетной записи службы для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] экземпляра.</span><span class="sxs-lookup"><span data-stu-id="a3e63-135">-   Specify an SPN to look up the service account for the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="a3e63-136">Для каждого экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] создаются два имени субъекта-службы по умолчанию, которые могут быть использованы для этой цели.</span><span class="sxs-lookup"><span data-stu-id="a3e63-136">For every [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance, two default SPNs are generated that can be used for this purpose.</span></span> <span data-ttu-id="a3e63-137">Однако эти ключи не обязательно будут созданы в Active Directory, поэтому в такой ситуации проверка подлинности Kerberos не гарантирована.</span><span class="sxs-lookup"><span data-stu-id="a3e63-137">These keys are not guaranteed to be present in Active Directory, however, so in this situation Kerberos authentication is not guaranteed.</span></span><br /><span data-ttu-id="a3e63-138">— Укажите имя субъекта-службы, которое будет использоваться для поиска учетной записи службы для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] экземпляра.</span><span class="sxs-lookup"><span data-stu-id="a3e63-138">-   Specify an SPN that will be used to look up the service account for the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="a3e63-139">Это может быть любая определенная пользователем строка, сопоставляемая с учетной записью службы.</span><span class="sxs-lookup"><span data-stu-id="a3e63-139">This can be any user-defined string that maps to the service account.</span></span> <span data-ttu-id="a3e63-140">В этом случае ключ должен быть вручную зарегистрирован в центре распространения ключей и удовлетворять правилам для определенных пользователем имен участников-служб.</span><span class="sxs-lookup"><span data-stu-id="a3e63-140">In this case, the key must be registered manually in the KDC and must satisfy the rules for a user-defined SPN.</span></span><br /><br /> <span data-ttu-id="a3e63-141">Ключевое слово `FailoverPartnerSPN` указывает имя партнера-службы для сервера-партнера по обеспечению отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="a3e63-141">The `FailoverPartnerSPN` keyword can be used to specify the SPN for the failover partner server.</span></span> <span data-ttu-id="a3e63-142">Ранг учетной записи и ключевые значения Active Directory те же, что и значения, которые можно указать для основного сервера.</span><span class="sxs-lookup"><span data-stu-id="a3e63-142">The range of account and Active Directory key values is the same as the values you can specify for the principal server.</span></span>|  
|<span data-ttu-id="a3e63-143">Приложение ODBC указывает имя партнера-службы как атрибут соединения для основного сервера или сервера-партнера по обеспечению отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="a3e63-143">An ODBC application specifies an SPN as a connection attribute for the principal server or failover partner server.</span></span>|<span data-ttu-id="a3e63-144">Атрибут соединения `SQL_COPT_SS_SERVER_SPN` может быть использован для указания имени участника-службы для соединения с основным сервером.</span><span class="sxs-lookup"><span data-stu-id="a3e63-144">The connection attribute `SQL_COPT_SS_SERVER_SPN` can be used to specify the SPN for a connection to the principal server.</span></span><br /><br /> <span data-ttu-id="a3e63-145">Атрибут соединения `SQL_COPT_SS_FAILOVER_PARTNER_SPN` может быть использован для указания имени партнера-службы для сервера-партнера по обеспечению отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="a3e63-145">The connection attribute `SQL_COPT_SS_FAILOVER_PARTNER_SPN` can be used to specify the SPN for the failover partner server.</span></span>|  
|<span data-ttu-id="a3e63-146">Приложение OLE DB указывает имя партнера-службы как свойство инициализации источника данных для основного сервера или сервера-партнера по обеспечению отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="a3e63-146">An OLE DB application specifies an SPN as a data source initialization property for the principal server or for a failover partner server.</span></span>|<span data-ttu-id="a3e63-147">Свойство соединения `SSPROP_INIT_SERVER_SPN` в наборе свойств `DBPROPSET_SQLSERVERDBINIT` может быть использовано для указания имени участника-службы для соединения.</span><span class="sxs-lookup"><span data-stu-id="a3e63-147">The connection property `SSPROP_INIT_SERVER_SPN` in the `DBPROPSET_SQLSERVERDBINIT` property set can be used to specify the SPN for a connection.</span></span><br /><br /> <span data-ttu-id="a3e63-148">Свойство соединения `SSPROP_INIT_FAILOVER_PARTNER_SPN` в `DBPROPSET_SQLSERVERDBINIT` может быть использовано для указания имени партнера-службы для сервера-партнера по обеспечению отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="a3e63-148">The connection property `SSPROP_INIT_FAILOVER_PARTNER_SPN` in the `DBPROPSET_SQLSERVERDBINIT` can be used to specify the SPN for the failover partner server.</span></span>|  
|<span data-ttu-id="a3e63-149">Пользователь указывает имя партнера-службы для сервера или сервера-партнера по обеспечению отработки отказа в имени источника данных (DSN) ODBC.</span><span class="sxs-lookup"><span data-stu-id="a3e63-149">A user specifies an SPN for a server or failover partner server in an ODBC data source name (DSN).</span></span>|<span data-ttu-id="a3e63-150">Имя участника-службы может быть указано в DSN ODBC через диалоговые окна настройки DSN.</span><span class="sxs-lookup"><span data-stu-id="a3e63-150">The SPN can be specified in an ODBC DSN through the DSN setup dialog boxes.</span></span>|  
|<span data-ttu-id="a3e63-151">Пользователь указывает имя партнера-службы для сервера или сервера-партнера по обеспечению отработки отказа в диалоговом окне **Связь данных** или **Имя входа** OLE DB.</span><span class="sxs-lookup"><span data-stu-id="a3e63-151">The user specifies an SPN for a server or failover partner server in an OLE DB **Data Link** or **Login** dialog box.</span></span>|<span data-ttu-id="a3e63-152">Имя участника-службы может быть указано в диалоговом окне **Связь данных** или **Имя входа** .</span><span class="sxs-lookup"><span data-stu-id="a3e63-152">The SPN can be specified in a **Data Link** or **Login** dialog box.</span></span> <span data-ttu-id="a3e63-153">Диалоговое окно **Имя входа** может использоваться с ODBC или OLE DB.</span><span class="sxs-lookup"><span data-stu-id="a3e63-153">The **Login** dialog box can be used with either ODBC or OLE DB.</span></span>|  
|<span data-ttu-id="a3e63-154">Приложение ODBC определяет метод проверки подлинности, используемый для установления соединения.</span><span class="sxs-lookup"><span data-stu-id="a3e63-154">An ODBC application determines the authentication method used to establish a connection.</span></span>|<span data-ttu-id="a3e63-155">Если соединение было установлено успешно, то приложение может запросить атрибут соединения `SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD`, чтобы определить, какой именно метод проверки подлинности будет использоваться.</span><span class="sxs-lookup"><span data-stu-id="a3e63-155">When a connection has been opened successfully, an application can query the connection attribute `SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD` to determine which authentication method was used.</span></span> <span data-ttu-id="a3e63-156">Эти значения включают `NTLM`, `Kerberos` и другие.</span><span class="sxs-lookup"><span data-stu-id="a3e63-156">The values will include, but are not limited to, `NTLM` and `Kerberos`.</span></span>|  
|<span data-ttu-id="a3e63-157">Приложение OLE DB определяет метод проверки подлинности, используемый при установлении соединения.</span><span class="sxs-lookup"><span data-stu-id="a3e63-157">An OLE DB application determines the authentication method used to establish a connection.</span></span>|<span data-ttu-id="a3e63-158">Если соединение было установлено успешно, то приложение может запросить свойство соединения `SSPROP_AUTHENTICATION_METHOD` в наборе свойств `DBPROPSET_SQLSERVERDATASOURCEINFO` для определения метода проверки подлинности, который будет использоваться.</span><span class="sxs-lookup"><span data-stu-id="a3e63-158">When a connection has been opened successfully, an application can query the connection property `SSPROP_AUTHENTICATION_METHOD` in the `DBPROPSET_SQLSERVERDATASOURCEINFO` property set to determine which authentication method was used.</span></span> <span data-ttu-id="a3e63-159">Эти значения включают `NTLM`, `Kerberos` и другие.</span><span class="sxs-lookup"><span data-stu-id="a3e63-159">The values will include, but are not limited to, `NTLM` and `Kerberos`.</span></span>|  
  
## <a name="failover"></a><span data-ttu-id="a3e63-160">Отработка отказа</span><span class="sxs-lookup"><span data-stu-id="a3e63-160">Failover</span></span>  
 <span data-ttu-id="a3e63-161">Имена участников-служб не хранятся в кэше отработки отказа и поэтому не могут передаваться между соединениями.</span><span class="sxs-lookup"><span data-stu-id="a3e63-161">SPNs are not stored in the failover cache and therefore cannot be passed between connections.</span></span> <span data-ttu-id="a3e63-162">Имена участников-служб будут использоваться при всех попытках установления соединения с основным и резервным сервером при указании атрибутов или строки соединения.</span><span class="sxs-lookup"><span data-stu-id="a3e63-162">SPNs will be used on all connection attempts to the principal and partner when specified in the connection string or connection attributes.</span></span>  
  
## <a name="connection-pooling"></a><span data-ttu-id="a3e63-163">Объединение подключений в пул</span><span class="sxs-lookup"><span data-stu-id="a3e63-163">Connection Pooling</span></span>  
 <span data-ttu-id="a3e63-164">Приложение должно учитывать, что указание имени участника-службы в некоторых, но не всех строках соединения может привести к фрагментации пула.</span><span class="sxs-lookup"><span data-stu-id="a3e63-164">Applications should be aware that specifying SPNs in some but not all connection strings can contribute to pool fragmentation.</span></span>  
  
 <span data-ttu-id="a3e63-165">Приложение может программным способом указывать имена участников-служб как атрибуты соединения, а не как ключевые слова в строке соединения.</span><span class="sxs-lookup"><span data-stu-id="a3e63-165">Applications can programmatically specify SPNs as connection attributes, instead of specifying connection string keywords.</span></span> <span data-ttu-id="a3e63-166">Это помогает управлять фрагментацией пула соединений.</span><span class="sxs-lookup"><span data-stu-id="a3e63-166">This can help manage connection pool fragmentation.</span></span>  
  
 <span data-ttu-id="a3e63-167">Приложение должно учитывать, что имя участника-службы в строке соединения может быть отменено назначением соответствующих атрибутов соединения, но строки соединения, используемые при организации пула соединений, будут использовать значения строк соединения для объединения в пул.</span><span class="sxs-lookup"><span data-stu-id="a3e63-167">Applications should be aware that SPNs in connection strings can be overridden by setting the corresponding connection attributes, but connection strings used by connection pooling will use the connection string values for pooling purposes.</span></span>  
  
## <a name="down-level-server-behavior"></a><span data-ttu-id="a3e63-168">Работа сервера низкого уровня</span><span class="sxs-lookup"><span data-stu-id="a3e63-168">Down-Level Server Behavior</span></span>  
 <span data-ttu-id="a3e63-169">Поведение нового соединения реализуется клиентом, поэтому оно не зависит от версии [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a3e63-169">The new connection behavior is implemented by the client; therefore, it is not specific to a version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="linked-servers-and-delegation"></a><span data-ttu-id="a3e63-170">Связанные серверы и делегирование</span><span class="sxs-lookup"><span data-stu-id="a3e63-170">Linked Servers and Delegation</span></span>  
 <span data-ttu-id="a3e63-171">При создании связанных серверов параметр `@provstr` хранимой процедуры [sp_addlinkedserver](/sql/relational-databases/system-stored-procedures/sp-addlinkedserver-transact-sql) можно использовать для указания имени субъекта-службы сервера и партнера по обеспечению отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="a3e63-171">When linked servers are created, the `@provstr` parameter of [sp_addlinkedserver](/sql/relational-databases/system-stored-procedures/sp-addlinkedserver-transact-sql) can be used to specify the server and failover partner SPNs.</span></span> <span data-ttu-id="a3e63-172">Такой подход имеет те же преимущества, что и при указании имен субъектов-служб в клиентских строках подключения, — установить подключения на основе аутентификации Kerberos проще и надежнее.</span><span class="sxs-lookup"><span data-stu-id="a3e63-172">The benefits of doing this are the same as specifying SPNs in client connection strings: It is simpler and more reliable to establish connections that use Kerberos authentication.</span></span>  
  
 <span data-ttu-id="a3e63-173">Делегирование со связанными серверами требует проверки подлинности Kerberos.</span><span class="sxs-lookup"><span data-stu-id="a3e63-173">Delegation with linked servers requires Kerberos authentication.</span></span>  
  
## <a name="management-aspects-of-spns-specified-by-applications"></a><span data-ttu-id="a3e63-174">Аспекты управления именами участников-служб, указываемыми приложениями</span><span class="sxs-lookup"><span data-stu-id="a3e63-174">Management Aspects of SPNs Specified by Applications</span></span>  
 <span data-ttu-id="a3e63-175">При выборе способа задания имени участника-службы: в приложении (через строку соединений) или программно (через свойства соединений вместо имени участника-службы по умолчанию, сформированного поставщиком) следует учитывать следующие факторы.</span><span class="sxs-lookup"><span data-stu-id="a3e63-175">When choosing whether to specify SPNs in an application (through connection strings) or programmatically through connection properties (rather than relying on the defalt provider generated SPNs), consider the following factors:</span></span>  
  
-   <span data-ttu-id="a3e63-176">Безопасность. Раскрывает ли указанное имя субъекта-службы конфиденциальные сведения?</span><span class="sxs-lookup"><span data-stu-id="a3e63-176">Security: Does the specified SPN disclose information that is protected?</span></span>  
  
-   <span data-ttu-id="a3e63-177">Надежность. Чтобы обеспечить использование имен субъектов-служб по умолчанию, учетная запись службы, от которой запущен экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], должна иметь достаточные права для обновления Active Directory в центре распространения ключей.</span><span class="sxs-lookup"><span data-stu-id="a3e63-177">Reliability: To enable the use of default SPNs, the service account in which the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance runs must have sufficient privileges to update the Active Directory on the KDC.</span></span>  
  
-   <span data-ttu-id="a3e63-178">Удобство и прозрачность расположения. Каким образом повлияет на имена субъектов-служб приложения перемещение базы данных в другой экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]?</span><span class="sxs-lookup"><span data-stu-id="a3e63-178">Convenience and location transparency: How will an application's SPNs be affected if its database moves to a different [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance?</span></span> <span data-ttu-id="a3e63-179">Это относится как к основному серверу, так и его партнеру по обеспечению отработки отказа при зеркальном отображении базы данных.</span><span class="sxs-lookup"><span data-stu-id="a3e63-179">This applies to both the principal server and its failover partner if you use database mirroring.</span></span> <span data-ttu-id="a3e63-180">Если при смене сервера потребуется замена имен участников-служб, как это повлияет на приложения?</span><span class="sxs-lookup"><span data-stu-id="a3e63-180">If a server change means that SPNs must be changed, how will this affect applications?</span></span> <span data-ttu-id="a3e63-181">Будут ли изменения управляемыми?</span><span class="sxs-lookup"><span data-stu-id="a3e63-181">Will any changes be managed?</span></span>  
  
## <a name="specifying-the-spn"></a><span data-ttu-id="a3e63-182">Указание имени участника-службы</span><span class="sxs-lookup"><span data-stu-id="a3e63-182">Specifying the SPN</span></span>  
 <span data-ttu-id="a3e63-183">Имя участника-службы может быть задано как через код, так и через диалоговые окна.</span><span class="sxs-lookup"><span data-stu-id="a3e63-183">You can specify an SPN in dialog boxes and in code.</span></span> <span data-ttu-id="a3e63-184">В данном разделе рассматривается задание имени участника-службы.</span><span class="sxs-lookup"><span data-stu-id="a3e63-184">This section discusses how you can specify an SPN.</span></span>  
  
 <span data-ttu-id="a3e63-185">Максимальная длина для имени участника-службы — 260 символов.</span><span class="sxs-lookup"><span data-stu-id="a3e63-185">The maximum length for an SPN is 260 characters.</span></span>  
  
 <span data-ttu-id="a3e63-186">В именах участников-служб в атрибутах или строке соединения применяется следующий синтаксис.</span><span class="sxs-lookup"><span data-stu-id="a3e63-186">The syntax that SPNs use in connection string or connection attributes is as follows:</span></span>  
  
|<span data-ttu-id="a3e63-187">Синтаксис</span><span class="sxs-lookup"><span data-stu-id="a3e63-187">Syntax</span></span>|<span data-ttu-id="a3e63-188">Описание</span><span class="sxs-lookup"><span data-stu-id="a3e63-188">Description</span></span>|  
|------------|-----------------|  
|<span data-ttu-id="a3e63-189">MSSQLSvc/*полное доменное имя*</span><span class="sxs-lookup"><span data-stu-id="a3e63-189">MSSQLSvc/*fqdn*</span></span>|<span data-ttu-id="a3e63-190">Сформированное поставщиком имя участника-службы для экземпляра по умолчанию, когда используется протокол, отличный от TCP.</span><span class="sxs-lookup"><span data-stu-id="a3e63-190">The provider-generated, default SPN for a default instance when a protocol other than TCP is used.</span></span><br /><br /> <span data-ttu-id="a3e63-191">полное *доменное имя является полным* доменным именем.</span><span class="sxs-lookup"><span data-stu-id="a3e63-191">*fqdn* is a fully-qualified domain name.</span></span>|  
|<span data-ttu-id="a3e63-192">MSSQLSvc/*fqdn*:*port*</span><span class="sxs-lookup"><span data-stu-id="a3e63-192">MSSQLSvc/*fqdn*:*port*</span></span>|<span data-ttu-id="a3e63-193">Сформированное поставщиком имя участника-службы для экземпляра по умолчанию, когда используется протокол TCP.</span><span class="sxs-lookup"><span data-stu-id="a3e63-193">The provider-generated, default SPN when TCP is used.</span></span><br /><br /> <span data-ttu-id="a3e63-194">*port* — номер TCP-порта.</span><span class="sxs-lookup"><span data-stu-id="a3e63-194">*port* is a TCP port number.</span></span>|  
|<span data-ttu-id="a3e63-195">MSSQLSvc/*FQDN*:*instanceName*</span><span class="sxs-lookup"><span data-stu-id="a3e63-195">MSSQLSvc/*fqdn*:*InstanceName*</span></span>|<span data-ttu-id="a3e63-196">Сформированное поставщиком имя участника-службы (по умолчанию) для именованного экземпляра, когда используется протокол, отличный от TCP.</span><span class="sxs-lookup"><span data-stu-id="a3e63-196">The provider-generated, default SPN for a named instance when a protocol other than TCP is used.</span></span><br /><br /> <span data-ttu-id="a3e63-197">*InstanceName* — имя экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a3e63-197">*InstanceName* is a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance name.</span></span>|  
|<span data-ttu-id="a3e63-198">HOST/*fqdn*</span><span class="sxs-lookup"><span data-stu-id="a3e63-198">HOST/*fqdn*</span></span><br /><br /> <span data-ttu-id="a3e63-199">HOST/*MachineName*</span><span class="sxs-lookup"><span data-stu-id="a3e63-199">HOST/*MachineName*</span></span>|<span data-ttu-id="a3e63-200">Имя участника-службы, сопоставляемое со встроенной учетной записью компьютера, зарегистрированной в Windows автоматически.</span><span class="sxs-lookup"><span data-stu-id="a3e63-200">The SPN that maps to built-in computer accounts that are automatically registered by Windows.</span></span>|  
|<span data-ttu-id="a3e63-201">*Имя пользователя* @ *Домен*</span><span class="sxs-lookup"><span data-stu-id="a3e63-201">*Username*@*Domain*</span></span>|<span data-ttu-id="a3e63-202">Прямое указание учетной записи домена.</span><span class="sxs-lookup"><span data-stu-id="a3e63-202">Direct specification of a domain account.</span></span><br /><br /> <span data-ttu-id="a3e63-203">*Username* — имя учетной записи пользователя Windows.</span><span class="sxs-lookup"><span data-stu-id="a3e63-203">*Username* is a Windows user account name.</span></span><br /><br /> <span data-ttu-id="a3e63-204">*Domain* — имя домена Windows или полное имя домена.</span><span class="sxs-lookup"><span data-stu-id="a3e63-204">*Domain* is a Windows domain name or fully-qualified domain name.</span></span>|  
|<span data-ttu-id="a3e63-205">*MachineName* $@ *Домен*</span><span class="sxs-lookup"><span data-stu-id="a3e63-205">*MachineName*$@*Domain*</span></span>|<span data-ttu-id="a3e63-206">Прямое указание учетной записи компьютера</span><span class="sxs-lookup"><span data-stu-id="a3e63-206">Direct specification of a computer account.</span></span><br /><br /> <span data-ttu-id="a3e63-207">(Если сервер, к которому вы подключаетесь, работает под учетной записью локальной системы или сетевой службы, для получения проверки подлинности Kerberos `ServerSPN` может использоваться *MachineName* $@ Формат*домена* MachineName.)</span><span class="sxs-lookup"><span data-stu-id="a3e63-207">(If the server you are connecting to is running under LOCAL SYSTEM or NETWORK SERVICE accounts, to get Kerberos authentication, `ServerSPN` can be in the *MachineName*$@*Domain* format.)</span></span>|  
|<span data-ttu-id="a3e63-208">*Кдккэй* / *MachineName*</span><span class="sxs-lookup"><span data-stu-id="a3e63-208">*KDCKey*/*MachineName*</span></span>|<span data-ttu-id="a3e63-209">Заданное пользователем имя участника-службы.</span><span class="sxs-lookup"><span data-stu-id="a3e63-209">A user-specified SPN.</span></span><br /><br /> <span data-ttu-id="a3e63-210">*KDCKey* — алфавитно-цифровая строка, соответствующая правилам для ключей KDC.</span><span class="sxs-lookup"><span data-stu-id="a3e63-210">*KDCKey* is an alphanumeric string that conforms to the rules for a KDC key.</span></span>|  
  
## <a name="odbc-and-ole-db-syntax-supporting-spns"></a><span data-ttu-id="a3e63-211">Синтаксис ODBC и OLE DB для поддержки имен участников-служб</span><span class="sxs-lookup"><span data-stu-id="a3e63-211">ODBC and OLE DB Syntax Supporting SPNs</span></span>  
 <span data-ttu-id="a3e63-212">Сведения о синтаксисе см. в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="a3e63-212">For syntax-specific information, see the following topics:</span></span>  
  
-   [<span data-ttu-id="a3e63-213">Имена участника-службы (SPN) в клиентских соединениях (ODBC)</span><span class="sxs-lookup"><span data-stu-id="a3e63-213">Service Principal Names &#40;SPNs&#41; in Client Connections &#40;ODBC&#41;</span></span>](../odbc/service-principal-names-spns-in-client-connections-odbc.md)  
  
-   [<span data-ttu-id="a3e63-214">Имена участника-службы (SPN) в клиентских соединениях (OLE DB)</span><span class="sxs-lookup"><span data-stu-id="a3e63-214">Service Principal Names &#40;SPNs&#41; in Client Connections &#40;OLE DB&#41;</span></span>](../ole-db/service-principal-names-spns-in-client-connections-ole-db.md)  
  
 <span data-ttu-id="a3e63-215">Дополнительные сведения об образцах приложений, которые демонстрируют эту функцию, см. в разделе [Образцы программирования для данных SQL Server](https://msftdpprodsamples.codeplex.com/).</span><span class="sxs-lookup"><span data-stu-id="a3e63-215">For information about sample applications that demonstrate this feature, see [SQL Server Data Programmability Samples](https://msftdpprodsamples.codeplex.com/).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a3e63-216">См. также:</span><span class="sxs-lookup"><span data-stu-id="a3e63-216">See Also</span></span>  
 [<span data-ttu-id="a3e63-217">Компоненты собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="a3e63-217">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
