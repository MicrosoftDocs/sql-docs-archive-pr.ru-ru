---
title: Работа с изоляцией моментального снимка | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], snapshot isolation
- SQLNCLI, snapshot isolation
- isolation levels [SQL Server], snapshot
- DBPROPSET_SESSION property set
- DBDROPSET_DATASOURCEINFO property set
- snapshot isolation [SQL Server Native Client]
- SQL Server Native Client OLE DB provider, snapshot isolation
- SQL Server Native Client ODBC driver, snapshot isolation
- SQL Server Native Client, snapshot isolation
- SQLGetInfo function
- concurrency [SQL Server Native Client]
- SQLSetConnectAttr function
ms.assetid: 39e87eb1-677e-45dd-bc61-83a4025a7756
author: rothja
ms.author: jroth
ms.openlocfilehash: 242d054a5fd2ad12a8811bebc834d423f547a499
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87666524"
---
# <a name="working-with-snapshot-isolation"></a><span data-ttu-id="2df1b-102">Работа с изоляцией моментального снимка</span><span class="sxs-lookup"><span data-stu-id="2df1b-102">Working with Snapshot Isolation</span></span>
  <span data-ttu-id="2df1b-103">В [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] появился новый уровень изоляции «моментального снимка», предназначенный для повышения параллелизма приложений оперативной обработки транзакций (OLTP).</span><span class="sxs-lookup"><span data-stu-id="2df1b-103">[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] introduced a new "snapshot" isolation level that is intended to enhance concurrency for online transaction processing (OLTP) applications.</span></span> <span data-ttu-id="2df1b-104">В предыдущих версиях [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] параллелизм был основан исключительно на блокировках, что могло вызвать проблемы с блокировками и взаимоблокировками для некоторых приложений.</span><span class="sxs-lookup"><span data-stu-id="2df1b-104">In earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], concurrency was based solely on locking, which can cause blocking and deadlocking problems for some applications.</span></span> <span data-ttu-id="2df1b-105">Изоляция моментального снимка зависит от расширений управления версиями строк и предназначена для улучшения производительности путем исключения сценариев блокировки модулей чтения или записи.</span><span class="sxs-lookup"><span data-stu-id="2df1b-105">Snapshot isolation depends on enhancements to row versioning and is intended to improve performance by avoiding reader-writer blocking scenarios.</span></span>  
  
 <span data-ttu-id="2df1b-106">Транзакции, запускаемые в режиме изоляции моментальных снимков, читают моментальный снимок базы данных на момент запуска транзакции.</span><span class="sxs-lookup"><span data-stu-id="2df1b-106">Transactions that start under snapshot isolation read a database snapshot as of the time when the transaction starts.</span></span> <span data-ttu-id="2df1b-107">Один из результатов состоит в том, что поведение набора ключей, динамических и статических серверных курсоров, открываемых в контексте транзакции моментальных снимков, более походит на статические курсоры, открытые в сериализуемых транзакциях.</span><span class="sxs-lookup"><span data-stu-id="2df1b-107">One result of this is that keyset, dynamic and static server cursors, when opened within a snapshot transaction context, behave much like static cursors opened within serializable transactions.</span></span> <span data-ttu-id="2df1b-108">Однако, когда курсоры открыты на уровне изоляции моментальных снимков, блокировки не применяются, что может снизить блокирование на сервере.</span><span class="sxs-lookup"><span data-stu-id="2df1b-108">However, when the cursors are opened under the snapshot isolation level locks are not taken, which can reduce blocking on the server.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="2df1b-109">Поставщик OLE DB для собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="2df1b-109">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="2df1b-110">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Поставщик собственного клиента OLE DB имеет улучшения, использующие преимущества изоляции моментального снимка, представленной в [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="2df1b-110">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider has enhancements that take advantage of the snapshot isolation introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="2df1b-111">Среди этих улучшений изменения наборов свойств DBPROPSET_DATASOURCEINFO и DBPROPSET_SESSION.</span><span class="sxs-lookup"><span data-stu-id="2df1b-111">These enhancements include changes to the DBPROPSET_DATASOURCEINFO and DBPROPSET_SESSION property sets.</span></span>  
  
### <a name="dbpropset_datasourceinfo"></a><span data-ttu-id="2df1b-112">DBPROPSET_DATASOURCEINFO</span><span class="sxs-lookup"><span data-stu-id="2df1b-112">DBPROPSET_DATASOURCEINFO</span></span>  
 <span data-ttu-id="2df1b-113">Набор свойств DBPROPSET_DATASOURCEINFO изменен и указывает на поддержку уровня изоляции моментальных снимков благодаря добавлению значения DBPROPVAL_TI_SNAPSHOT, используемого в свойстве DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="2df1b-113">The DBPROPSET_DATASOURCEINFO property set has been changed to indicate that the snapshot isolation level is supported by the addition of the DBPROPVAL_TI_SNAPSHOT value that is used in the DBPROP_SUPPORTEDTXNISOLEVELS property.</span></span> <span data-ttu-id="2df1b-114">Это новое значение указывает, что уровень изоляции моментального снимка поддерживается независимо от того, включено ли в базе данных управление версиями.</span><span class="sxs-lookup"><span data-stu-id="2df1b-114">This new value indicates that the snapshot isolation level is supported whether or not versioning has been enabled on the database.</span></span> <span data-ttu-id="2df1b-115">Ниже приведен список значений DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="2df1b-115">The following is a list of the DBPROP_SUPPORTEDTXNISOLEVELS values:</span></span>  
  
|<span data-ttu-id="2df1b-116">Идентификатор свойства</span><span class="sxs-lookup"><span data-stu-id="2df1b-116">Property ID</span></span>|<span data-ttu-id="2df1b-117">Описание</span><span class="sxs-lookup"><span data-stu-id="2df1b-117">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="2df1b-118">DBPROP_SUPPORTEDTXNISOLEVELS</span><span class="sxs-lookup"><span data-stu-id="2df1b-118">DBPROP_SUPPORTEDTXNISOLEVELS</span></span>|<span data-ttu-id="2df1b-119">Тип: VT_I4</span><span class="sxs-lookup"><span data-stu-id="2df1b-119">Type: VT_I4</span></span><br /><br /> <span data-ttu-id="2df1b-120">R/W: только для чтения</span><span class="sxs-lookup"><span data-stu-id="2df1b-120">R/W: Read only</span></span><br /><br /> <span data-ttu-id="2df1b-121">Описание: битовая маска, указывающая поддерживаемые уровни изоляции транзакции.</span><span class="sxs-lookup"><span data-stu-id="2df1b-121">Description: A bitmask specifying the supported transaction isolation levels.</span></span> <span data-ttu-id="2df1b-122">Сочетание может включать нуль или несколько следующих значений:</span><span class="sxs-lookup"><span data-stu-id="2df1b-122">A combination of zero or more of the following:</span></span><br /><br /> <span data-ttu-id="2df1b-123">— DBPROPVAL_TI_CHAOS</span><span class="sxs-lookup"><span data-stu-id="2df1b-123">-   DBPROPVAL_TI_CHAOS</span></span><br /><span data-ttu-id="2df1b-124">— DBPROPVAL_TI_READUNCOMMITTED</span><span class="sxs-lookup"><span data-stu-id="2df1b-124">-   DBPROPVAL_TI_READUNCOMMITTED</span></span><br /><span data-ttu-id="2df1b-125">— DBPROPVAL_TI_BROWSE</span><span class="sxs-lookup"><span data-stu-id="2df1b-125">-   DBPROPVAL_TI_BROWSE</span></span><br /><span data-ttu-id="2df1b-126">— DBPROPVAL_TI_CURSORSTABILITY</span><span class="sxs-lookup"><span data-stu-id="2df1b-126">-   DBPROPVAL_TI_CURSORSTABILITY</span></span><br /><span data-ttu-id="2df1b-127">— DBPROPVAL_TI_READCOMMITTED</span><span class="sxs-lookup"><span data-stu-id="2df1b-127">-   DBPROPVAL_TI_READCOMMITTED</span></span><br /><span data-ttu-id="2df1b-128">— DBPROPVAL_TI_REPEATABLEREAD</span><span class="sxs-lookup"><span data-stu-id="2df1b-128">-   DBPROPVAL_TI_REPEATABLEREAD</span></span><br /><span data-ttu-id="2df1b-129">— DBPROPVAL_TI_SERIALIZABLE</span><span class="sxs-lookup"><span data-stu-id="2df1b-129">-   DBPROPVAL_TI_SERIALIZABLE</span></span><br /><span data-ttu-id="2df1b-130">— DBPROPVAL_TI_ISOLATED</span><span class="sxs-lookup"><span data-stu-id="2df1b-130">-   DBPROPVAL_TI_ISOLATED</span></span><br /><span data-ttu-id="2df1b-131">— DBPROPVAL_TI_SNAPSHOT</span><span class="sxs-lookup"><span data-stu-id="2df1b-131">-   DBPROPVAL_TI_SNAPSHOT</span></span>|  
  
### <a name="dbpropset_session"></a><span data-ttu-id="2df1b-132">Набор свойств DBPROPSET_SESSION</span><span class="sxs-lookup"><span data-stu-id="2df1b-132">DBPROPSET_SESSION</span></span>  
 <span data-ttu-id="2df1b-133">Набор свойств DBPROPSET_SESSION изменен и указывает на поддержку уровня изоляции моментальных снимков благодаря добавлению значения DBPROPVAL_TI_SNAPSHOT, используемого в свойстве DBPROP_SESS_AUTOCOMMITISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="2df1b-133">The DBPROPSET_SESSION property set has been changed to indicate that the snapshot isolation level is supported by the addition of the DBPROPVAL_TI_SNAPSHOT value that is used in the DBPROP_SESS_AUTOCOMMITISOLEVELS property.</span></span> <span data-ttu-id="2df1b-134">Это новое значение указывает, что уровень изоляции моментального снимка поддерживается независимо от того, включено ли в базе данных управление версиями.</span><span class="sxs-lookup"><span data-stu-id="2df1b-134">This new value indicates that the snapshot isolation level is supported whether or not versioning has been enabled on the database.</span></span> <span data-ttu-id="2df1b-135">Ниже приведен список значений DBPROP_SESS_AUTOCOMMITISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="2df1b-135">The following is a list of the DBPROP_SESS_AUTOCOMMITISOLEVELS values:</span></span>  
  
|<span data-ttu-id="2df1b-136">Идентификатор свойства</span><span class="sxs-lookup"><span data-stu-id="2df1b-136">Property ID</span></span>|<span data-ttu-id="2df1b-137">Описание</span><span class="sxs-lookup"><span data-stu-id="2df1b-137">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="2df1b-138">DBPROP_SESS_AUTOCOMMITISOLEVELS</span><span class="sxs-lookup"><span data-stu-id="2df1b-138">DBPROP_SESS_AUTOCOMMITISOLEVELS</span></span>|<span data-ttu-id="2df1b-139">Тип: VT_I4</span><span class="sxs-lookup"><span data-stu-id="2df1b-139">Type: VT_I4</span></span><br /><br /> <span data-ttu-id="2df1b-140">R/W: только для чтения</span><span class="sxs-lookup"><span data-stu-id="2df1b-140">R/W: Read only</span></span><br /><br /> <span data-ttu-id="2df1b-141">Описание: задает битовую маску, которая указывает уровень изоляции транзакции в режиме автоматической фиксации.</span><span class="sxs-lookup"><span data-stu-id="2df1b-141">Description: Specifies a bitmask that indicates the transaction isolation level while in auto-commit mode.</span></span> <span data-ttu-id="2df1b-142">Значения, которые можно установить в этой битовой маске, такие же, как устанавливаемые для DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="2df1b-142">The values that can be set in this bitmask are the same as those that can be set for DBPROP_SUPPORTEDTXNISOLEVELS.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="2df1b-143">Ошибки DB_S_ERRORSOCCURRED или DB_E_ERRORSOCCURRED происходят, если значение DBPROPVAL_TI_SNAPSHOT установлено при использовании версий [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], предшествующих [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2df1b-143">The errors DB_S_ERRORSOCCURRED or DB_E_ERRORSOCCURRED will occur if DBPROPVAL_TI_SNAPSHOT is set when using versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] earlier than [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>  
  
 <span data-ttu-id="2df1b-144">Сведения о поддержке изоляции моментального снимка в транзакциях см. в статье [Поддержка локальных транзакций](../../native-client-ole-db-transactions/transactions.md).</span><span class="sxs-lookup"><span data-stu-id="2df1b-144">For information about how snapshot isolation is supported in transactions, see [Supporting Local Transactions](../../native-client-ole-db-transactions/transactions.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="2df1b-145">Драйвер ODBC для собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="2df1b-145">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="2df1b-146">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента обеспечивает изоляцию моментального снимка, в то же самое усовершенствованные функции [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) и [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="2df1b-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver provides support for snapshot isolation though enhancements made to the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) functions.</span></span>  
  
### <a name="sqlsetconnectattr"></a><span data-ttu-id="2df1b-147">SQLSetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="2df1b-147">SQLSetConnectAttr</span></span>  
 <span data-ttu-id="2df1b-148">Функция **SQLSetConnectAttr** теперь поддерживает использование атрибута SQL_COPT_SS_TXN_ISOLATION.</span><span class="sxs-lookup"><span data-stu-id="2df1b-148">The **SQLSetConnectAttr** function now supports the use of the SQL_COPT_SS_TXN_ISOLATION attribute.</span></span> <span data-ttu-id="2df1b-149">Задание SQL_COPT_SS_TXN_ISOLATION значения SQL_TXN_SS_SNAPSHOT указывает, что транзакция произойдет на уровне изоляции моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="2df1b-149">Setting SQL_COPT_SS_TXN_ISOLATION to SQL_TXN_SS_SNAPSHOT indicates that the transaction will take place under the snapshot isolation level.</span></span>  
  
### <a name="sqlgetinfo"></a><span data-ttu-id="2df1b-150">SQLGetInfo</span><span class="sxs-lookup"><span data-stu-id="2df1b-150">SQLGetInfo</span></span>  
 <span data-ttu-id="2df1b-151">Функция [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) теперь поддерживает SQL_TXN_SS_SNAPSHOT значение, добавленное в тип сведений SQL_TXN_ISOLATION_OPTION.</span><span class="sxs-lookup"><span data-stu-id="2df1b-151">The [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) function now supports the SQL_TXN_SS_SNAPSHOT value that has been added to the SQL_TXN_ISOLATION_OPTION info type.</span></span>  
  
 <span data-ttu-id="2df1b-152">Сведения о поддержке изоляции моментальных снимков в транзакциях см. в разделе [уровень изоляции транзакций курсора](../../native-client-odbc-cursors/properties/cursor-transaction-isolation-level.md).</span><span class="sxs-lookup"><span data-stu-id="2df1b-152">For information about how snapshot isolation is supported in transactions, see [Cursor Transaction Isolation Level](../../native-client-odbc-cursors/properties/cursor-transaction-isolation-level.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2df1b-153">См. также:</span><span class="sxs-lookup"><span data-stu-id="2df1b-153">See Also</span></span>  
 <span data-ttu-id="2df1b-154">[Компоненты собственного клиента SQL Server](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="2df1b-154">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="2df1b-155">Свойства и поведение наборов строк</span><span class="sxs-lookup"><span data-stu-id="2df1b-155">Rowset Properties and Behaviors</span></span>](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md)  
  
  
