---
title: Использование типов данных XML | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- IRowsetChange interface
- IRowsetUpdate interface
- data access [SQL Server Native Client], xml data type
- SQL Server Native Client OLE DB schema rowsets
- PROVIDER_TYPES rowset
- IColumnsInfo interface
- IRowsetFind interface
- IColumnsRowset interface
- PROCEDURE_PARAMETERS rowset
- SQLNCLI, XML
- xml data type [SQL Server], SQL Server Native Client
- SQL Server Native Client, XML
- IRowset interface
- ISequentialStream interface
- ISSCommandWithParameters interface
- SS_XMLSCHEMA rowset
- SQL Server Native Client OLE DB interfaces
- XML [SQL Server], SQL Server Native Client
- COLUMNS rowset
ms.assetid: a7af5b72-c5c2-418d-a636-ae4ac6270ee5
author: rothja
ms.author: jroth
ms.openlocfilehash: 3d0dcc8cf7259a24e53281724d8440c6ff2209f1
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87666539"
---
# <a name="using-xml-data-types"></a><span data-ttu-id="9634c-102">Использование типов данных XML</span><span class="sxs-lookup"><span data-stu-id="9634c-102">Using XML Data Types</span></span>
  <span data-ttu-id="9634c-103">В версии [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] был введен тип данных **xml**, позволяющий хранить XML-документы и их фрагменты в базе данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9634c-103">[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] introduced an **xml** data type that enables you to store XML documents and fragments in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span> <span data-ttu-id="9634c-104">Тип данных **xml** — это встроенный в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] тип данных, несколько напоминающий другие встроенные типы данных, такие как **int** и **varchar**.</span><span class="sxs-lookup"><span data-stu-id="9634c-104">The **xml** data type is a built-in data type in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], and is in some ways similar to other built-in types, such as **int** and **varchar**.</span></span> <span data-ttu-id="9634c-105">Как и другие встроенные типы данных, тип данных **xml** можно использовать как тип столбца при создании таблицы, как тип переменной, параметра, тип возвращаемого функцией значения, а также в инструкциях CAST и CONVERT.</span><span class="sxs-lookup"><span data-stu-id="9634c-105">As with other built-in types, you can use the **xml** data type as a column type when creating a table; as a variable type, a parameter type, or a function-return type; or in CAST and CONVERT functions.</span></span>  
  
## <a name="programming-considerations"></a><span data-ttu-id="9634c-106">Замечания по программированию</span><span class="sxs-lookup"><span data-stu-id="9634c-106">Programming Considerations</span></span>  
 <span data-ttu-id="9634c-107">Язык XML может описывать сам себя в том смысле, что он может по желанию включать заголовок XML, описывающий кодировку документа, например:</span><span class="sxs-lookup"><span data-stu-id="9634c-107">XML can be self-describing in that it can optionally include an XML header that specifies the encoding of the document, for example:</span></span>  
  
 `<?xml version="1.0" encoding="windows-1252"?><doc/>`  
  
 <span data-ttu-id="9634c-108">Стандарт языка XML описывает, как обработчик XML определяет кодировку, использованную в документе, по первым нескольким байтам документа.</span><span class="sxs-lookup"><span data-stu-id="9634c-108">The XML standard describes how an XML processor can detect the encoding used for a document by examining the first few bytes of the document.</span></span> <span data-ttu-id="9634c-109">Существует возможность, что кодировка, заданная приложением, не совпадет с кодировкой, заданной в документе.</span><span class="sxs-lookup"><span data-stu-id="9634c-109">There are opportunities for the encoding specified by the application to conflict with the encoding specified by the document.</span></span> <span data-ttu-id="9634c-110">Для документов, переданных как связанные параметры, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] обрабатывает XML как двоичные данные, поэтому никаких преобразований не производится, и синтаксический анализатор XML может без проблем использовать кодировку, указанную в документе.</span><span class="sxs-lookup"><span data-stu-id="9634c-110">For documents passed as bound parameters, XML is treated as binary data by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], so no conversions are made and the XML parser can use the encoding specified within the document without problems.</span></span> <span data-ttu-id="9634c-111">Однако для XML-данных, привязанных как WSTR, приложение должно проверить, что документ имеет кодировку Юникод.</span><span class="sxs-lookup"><span data-stu-id="9634c-111">However, for XML data that is bound as WSTR, then the application must ensure that the document is encoded as Unicode.</span></span> <span data-ttu-id="9634c-112">Возможно, придется загрузить документ в модель DOM, изменить кодировку на Юникод и сериализовать документ.</span><span class="sxs-lookup"><span data-stu-id="9634c-112">This may entail loading the document into a DOM, changing the encoding to Unicode and serializing the document.</span></span> <span data-ttu-id="9634c-113">Если этого не сделать, может произойти порча данных, в результате чего образуется недопустимый или испорченный XML-документ.</span><span class="sxs-lookup"><span data-stu-id="9634c-113">If this is not done, data conversions may occur, resulting in invalid or corrupt XML.</span></span>  
  
 <span data-ttu-id="9634c-114">Возможен также конфликт, если XML задается в виде литерала.</span><span class="sxs-lookup"><span data-stu-id="9634c-114">There is also potential for conflict when XML is specified in literals.</span></span> <span data-ttu-id="9634c-115">Например, приведенные ниже инструкции являются недопустимыми.</span><span class="sxs-lookup"><span data-stu-id="9634c-115">For example the following are invalid:</span></span>  
  
 `INSERT INTO xmltable(xmlcol) VALUES('<?xml version="1.0" encoding="UTF-16"?><doc/>')`  
  
 `INSERT INTO xmltable(xmlcol) VALUES(N'<?xml version="1.0" encoding="UTF-8"?><doc/>')`  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="9634c-116">Поставщик OLE DB для собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="9634c-116">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="9634c-117">DBTYPE_XML — новый, специфичный для XML тип данных в поставщике OLE DB для собственного клиента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9634c-117">DBTYPE_XML is a new data type specific to XML in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider.</span></span> <span data-ttu-id="9634c-118">Кроме того, к XML-данным можно получить доступ через существующие типы OLE DB: DBTYPE_BYTES, DBTYPE_WSTR, DBTYPE_BSTR, DBTYPE_XML, DBTYPE_STR, DBTYPE_VARIANT и DBTYPE_IUNKNOWN.</span><span class="sxs-lookup"><span data-stu-id="9634c-118">In addition, XML data can be accessed through the existing OLE DB types of DBTYPE_BYTES, DBTYPE_WSTR, DBTYPE_BSTR, DBTYPE_XML, DBTYPE_STR, DBTYPE_VARIANT, and DBTYPE_IUNKNOWN.</span></span> <span data-ttu-id="9634c-119">Данные, хранимые в столбцах типа XML, можно получить из столбца в наборе строк поставщика OLE DB для собственного клиента [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в следующих форматах.</span><span class="sxs-lookup"><span data-stu-id="9634c-119">Data stored in columns of type XML can be retrieved from a column in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider rowset in the following formats:</span></span>  
  
-   <span data-ttu-id="9634c-120">Текстовая строка.</span><span class="sxs-lookup"><span data-stu-id="9634c-120">A text string</span></span>  
  
-   <span data-ttu-id="9634c-121">Интерфейс **ISequentialStream**</span><span class="sxs-lookup"><span data-stu-id="9634c-121">An **ISequentialStream**</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9634c-122">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Поставщик OLE DB собственного клиента не включает модуль чтения SAX, но **ISequentialStream** можно легко передать в объекты SAX и DOM в MSXML.</span><span class="sxs-lookup"><span data-stu-id="9634c-122">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider does not include a SAX reader, but the **ISequentialStream** can be easily passed to SAX and DOM objects in MSXML.</span></span>  
  
 <span data-ttu-id="9634c-123">**ISequentialStream** следует использовать для извлечения больших XML-документов.</span><span class="sxs-lookup"><span data-stu-id="9634c-123">**ISequentialStream** should be use used for retrieval of large XML documents.</span></span> <span data-ttu-id="9634c-124">При работе с типами больших значений в XML используются те же технологии, что и для работы с другими типами больших значений.</span><span class="sxs-lookup"><span data-stu-id="9634c-124">The same techniques used for other large value types also apply to XML.</span></span> <span data-ttu-id="9634c-125">Дополнительные сведения см. ниже в разделе [Using Large Value Types](using-large-value-types.md) (Использование типов большого объема).</span><span class="sxs-lookup"><span data-stu-id="9634c-125">For more information, see [Using Large Value Types](using-large-value-types.md).</span></span>  
  
 <span data-ttu-id="9634c-126">Приложение может также получать, вставлять и изменять данные, хранящиеся в столбцах типа XML в наборе строк, через обычные интерфейсы, такие как **IRow::GetColumns**, **IRowChange::SetColumns** и **ICommand::Execute**.</span><span class="sxs-lookup"><span data-stu-id="9634c-126">Data stored in columns of type XML in a rowset can also be retrieved, inserted, or updated by an application via the usual interfaces such as **IRow::GetColumns**, **IRowChange::SetColumns**, and **ICommand::Execute**.</span></span> <span data-ttu-id="9634c-127">Точно так же, как и в случае с извлечением, программа приложения может передать в **ISequentialStream** [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] собственный клиент OLE DB поставщику текстовую строку или ISequentialStream.</span><span class="sxs-lookup"><span data-stu-id="9634c-127">Similarly to the retrieval case, an application program can pass either a text string or an **ISequentialStream** to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9634c-128">Для отправки данных XML в строковом формате через интерфейс **ISequentialStream** нужно получить этот интерфейс **ISequentialStream**, задав DBTYPE_IUNKNOWN и установив в привязке аргумент *pObject*, равный NULL.</span><span class="sxs-lookup"><span data-stu-id="9634c-128">To send XML data in string format through the **ISequentialStream** interface, you must obtain **ISequentialStream** by specifying DBTYPE_IUNKNOWN and set its *pObject* argument to null in the binding.</span></span>  
  
 <span data-ttu-id="9634c-129">Если полученные XML-данные усечены из-за недостаточного размера буфера потребителя, возвращаемое значение длины может быть равно 0xffffffff — это означает, что длина данных неизвестна.</span><span class="sxs-lookup"><span data-stu-id="9634c-129">When retrieved XML data is truncated due to the consumer buffer being too small, the length may be returned as 0xffffffff, which means that the length is unknown.</span></span> <span data-ttu-id="9634c-130">Это согласуется с реализацией в виде типа данных, передаваемого клиенту в потоке без пересылки информации о длине до пересылки самих данных.</span><span class="sxs-lookup"><span data-stu-id="9634c-130">This is consistent with its implementation as a data type that is streamed to the client without sending length information ahead of the actual data.</span></span> <span data-ttu-id="9634c-131">В некоторых случаях фактическая длина может возвращаться, когда поставщик помещает в буфер целое значение, например **IRowset:: GetData** и где выполняется преобразование данных.</span><span class="sxs-lookup"><span data-stu-id="9634c-131">In some cases the actual length may be returned when the provider has buffered the whole value, such as **IRowset::GetData** and where data conversion is performed.</span></span>  
  
 <span data-ttu-id="9634c-132">XML-данные, переданные в SQL Server, сервер обрабатывает как двоичные данные.</span><span class="sxs-lookup"><span data-stu-id="9634c-132">XML data sent to SQL Server is treated as binary data by the server.</span></span> <span data-ttu-id="9634c-133">Таким образом предотвращается преобразование данных, и это позволяет средству синтаксического анализа XML автоматически обнаружить кодировку XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-133">This prevents any conversions occurring and allows the XML parser to auto-detect the XML encoding.</span></span> <span data-ttu-id="9634c-134">Это позволяет принимать в качестве входных данных для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] более широкий диапазон XML-документов (например, документы в кодировке UTF-8).</span><span class="sxs-lookup"><span data-stu-id="9634c-134">This allows a wider range of XML documents (for example those encoded in UTF-8) to be accepted as input to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="9634c-135">Если входные данные XML привязаны как тип DBTYPE_WSTR, приложение должно убедиться, что данные уже находятся в кодировке Юникод, чтобы предотвратить всякую возможность повреждения данных ненужными преобразованиями.</span><span class="sxs-lookup"><span data-stu-id="9634c-135">If input XML is bound as DBTYPE_WSTR, the application must ensure it is already Unicode encoded to avoid any possibility of corruption by unwanted data conversions.</span></span>  
  
### <a name="data-bindings-and-coercions"></a><span data-ttu-id="9634c-136">Привязки данных и приведение типов</span><span class="sxs-lookup"><span data-stu-id="9634c-136">Data Bindings and Coercions</span></span>  
 <span data-ttu-id="9634c-137">В приведенной ниже таблице перечислены привязки и приведения, происходящие, когда указанный тип данных используется вместе с типом данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] **xml**.</span><span class="sxs-lookup"><span data-stu-id="9634c-137">The following table describes the binding and coercion that occurs when using the listed data types with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] **xml** data type.</span></span>  
  
|<span data-ttu-id="9634c-138">Тип данных</span><span class="sxs-lookup"><span data-stu-id="9634c-138">Data type</span></span>|<span data-ttu-id="9634c-139">На сервер</span><span class="sxs-lookup"><span data-stu-id="9634c-139">To Server</span></span><br /><br /> <span data-ttu-id="9634c-140">**XML**</span><span class="sxs-lookup"><span data-stu-id="9634c-140">**XML**</span></span>|<span data-ttu-id="9634c-141">На сервер</span><span class="sxs-lookup"><span data-stu-id="9634c-141">To Server</span></span><br /><br /> <span data-ttu-id="9634c-142">**Не XML**</span><span class="sxs-lookup"><span data-stu-id="9634c-142">**Non-XML**</span></span>|<span data-ttu-id="9634c-143">С сервера</span><span class="sxs-lookup"><span data-stu-id="9634c-143">From Server</span></span><br /><br /> <span data-ttu-id="9634c-144">**XML**</span><span class="sxs-lookup"><span data-stu-id="9634c-144">**XML**</span></span>|<span data-ttu-id="9634c-145">С сервера</span><span class="sxs-lookup"><span data-stu-id="9634c-145">From Server</span></span><br /><br /> <span data-ttu-id="9634c-146">**Не XML**</span><span class="sxs-lookup"><span data-stu-id="9634c-146">**Non-XML**</span></span>|  
|---------------|---------------------------|--------------------------------|-----------------------------|----------------------------------|  
|<span data-ttu-id="9634c-147">DBTYPE_XML</span><span class="sxs-lookup"><span data-stu-id="9634c-147">DBTYPE_XML</span></span>|<span data-ttu-id="9634c-148">Передать<sup>6,7</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-148">Pass through<sup>6,7</sup></span></span>|<span data-ttu-id="9634c-149">Ошибка<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-149">Error<sup>1</sup></span></span>|<span data-ttu-id="9634c-150">ОК<sup>11, 6</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-150">OK<sup>11, 6</sup></span></span>|<span data-ttu-id="9634c-151">Error<sup>8</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-151">Error<sup>8</sup></span></span>|  
|<span data-ttu-id="9634c-152">DBTYPE_BYTES</span><span class="sxs-lookup"><span data-stu-id="9634c-152">DBTYPE_BYTES</span></span>|<span data-ttu-id="9634c-153">Передать<sup>6,7</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-153">Pass through<sup>6,7</sup></span></span>|<span data-ttu-id="9634c-154">Н/Д<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-154">N/A<sup>2</sup></span></span>|<span data-ttu-id="9634c-155">ОК <sup>11, 6</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-155">OK <sup>11, 6</sup></span></span>|<span data-ttu-id="9634c-156">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-156">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="9634c-157">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-157">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-158">Передать<sup>6,10</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-158">Pass through<sup>6,10</sup></span></span>|<span data-ttu-id="9634c-159">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-159">N/A <sup>2</sup></span></span>|<span data-ttu-id="9634c-160">ОК<sup>4, 6, 12</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-160">OK<sup>4, 6, 12</sup></span></span>|<span data-ttu-id="9634c-161">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-161">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="9634c-162">DBTYPE_BSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-162">DBTYPE_BSTR</span></span>|<span data-ttu-id="9634c-163">Передать<sup>6,10</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-163">Pass through<sup>6,10</sup></span></span>|<span data-ttu-id="9634c-164">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-164">N/A <sup>2</sup></span></span>|<span data-ttu-id="9634c-165">ОК <sup>3</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-165">OK <sup>3</sup></span></span>|<span data-ttu-id="9634c-166">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-166">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="9634c-167">DBTYPE_STR</span><span class="sxs-lookup"><span data-stu-id="9634c-167">DBTYPE_STR</span></span>|<span data-ttu-id="9634c-168">ОК<sup>6, 9, 10</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-168">OK<sup>6, 9, 10</sup></span></span>|<span data-ttu-id="9634c-169">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-169">N/A <sup>2</sup></span></span>|<span data-ttu-id="9634c-170">ОК<sup>5, 6, 12</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-170">OK<sup>5, 6, 12</sup></span></span>|<span data-ttu-id="9634c-171">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-171">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="9634c-172">DBTYPE_IUNKNOWN</span><span class="sxs-lookup"><span data-stu-id="9634c-172">DBTYPE_IUNKNOWN</span></span>|<span data-ttu-id="9634c-173">Байтовый поток через интерфейс **ISequentialStream**<sup>7</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-173">Byte stream via **ISequentialStream**<sup>7</sup></span></span>|<span data-ttu-id="9634c-174">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-174">N/A <sup>2</sup></span></span>|<span data-ttu-id="9634c-175">Байтовый поток через интерфейс **ISequentialStream**<sup>11</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-175">Byte stream via **ISequentialStream**<sup>11</sup></span></span>|<span data-ttu-id="9634c-176">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-176">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="9634c-177">DBTYPE_VARIANT (VT_UI1 &#124; VT_ARRAY)</span><span class="sxs-lookup"><span data-stu-id="9634c-177">DBTYPE_VARIANT (VT_UI1 &#124; VT_ARRAY)</span></span>|<span data-ttu-id="9634c-178">Передать<sup>6,7</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-178">Pass through<sup>6,7</sup></span></span>|<span data-ttu-id="9634c-179">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-179">N/A <sup>2</sup></span></span>|<span data-ttu-id="9634c-180">Недоступно</span><span class="sxs-lookup"><span data-stu-id="9634c-180">N/A</span></span>|<span data-ttu-id="9634c-181">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-181">N/A <sup>2</sup></span></span>|  
|<span data-ttu-id="9634c-182">DBTYPE_VARIANT (VT_BSTR)</span><span class="sxs-lookup"><span data-stu-id="9634c-182">DBTYPE_VARIANT (VT_BSTR)</span></span>|<span data-ttu-id="9634c-183">Передать<sup>6,10</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-183">Pass through<sup>6,10</sup></span></span>|<span data-ttu-id="9634c-184">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-184">N/A <sup>2</sup></span></span>|<span data-ttu-id="9634c-185">ОК<sup>3</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-185">OK<sup>3</sup></span></span>|<span data-ttu-id="9634c-186">Н/Д <sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="9634c-186">N/A <sup>2</sup></span></span>|  
  
 <span data-ttu-id="9634c-187"><sup>1</sup> Если тип сервера, отличный от DBTYPE_XML, указан с помощью **ICommandWithParameters:: SetParameterInfo** , а тип метода доступа — DBTYPE_XML, то при выполнении инструкции возникает ошибка (DB_E_ERRORSOCCURRED состояние параметра — DBSTATUS_E_BADACCESSOR); в противном случае данные отправляются на сервер, но сервер возвращает ошибку, указывающую на отсутствие неявного преобразования из XML в тип данных параметра.</span><span class="sxs-lookup"><span data-stu-id="9634c-187"><sup>1</sup>If a server type other than DBTYPE_XML is specified with **ICommandWithParameters::SetParameterInfo** and the accessor type is DBTYPE_XML, an error occurs when the statement is executed (DB_E_ERRORSOCCURRED, the parameter status is DBSTATUS_E_BADACCESSOR); otherwise the data is sent to the server, but the server returns an error indicating that there is no implicit conversion from XML to the parameter's data type.</span></span>  
  
 <span data-ttu-id="9634c-188"><sup>2</sup> Кроме области этого раздела.</span><span class="sxs-lookup"><span data-stu-id="9634c-188"><sup>2</sup>Beyond the scope of this topic.</span></span>  
  
 <span data-ttu-id="9634c-189"><sup>3</sup>Формат UTF-16, метка порядка байтов (BOM) отсутствует, кодировка не указана, данные не завершаются нулем.</span><span class="sxs-lookup"><span data-stu-id="9634c-189"><sup>3</sup>Format is UTF-16, no bye-order mark (BOM), no encoding specification, no null termination.</span></span>  
  
 <span data-ttu-id="9634c-190"><sup>4</sup>Формат UTF-16, метка порядка байтов (BOM) отсутствует, кодировка не указана, данные завершаются нулем.</span><span class="sxs-lookup"><span data-stu-id="9634c-190"><sup>4</sup>Format is UTF-16, no BOM, no encoding specification, null termination.</span></span>  
  
 <span data-ttu-id="9634c-191"><sup>5</sup>Формат многобайтовый, кодировка совпадает с кодовой страницей клиента, данные завершаются нулем.</span><span class="sxs-lookup"><span data-stu-id="9634c-191"><sup>5</sup>Format is multibyte characters encoded in client code page with null terminator.</span></span> <span data-ttu-id="9634c-192">Преобразование из переданной с сервера кодировки Юникод может вызвать повреждение данных, поэтому такую привязку крайне не рекомендуется использовать.</span><span class="sxs-lookup"><span data-stu-id="9634c-192">Conversion from server supplied Unicode may cause data corruption, so this binding is strongly discouraged.</span></span>  
  
 <span data-ttu-id="9634c-193"><sup>6</sup>Может использоваться BY_REF.</span><span class="sxs-lookup"><span data-stu-id="9634c-193"><sup>6</sup>BY_REF may be used.</span></span>  
  
 <span data-ttu-id="9634c-194"><sup>7</sup>Данные в формате UTF-16 должны начинаться с метки порядка байтов (BOM).</span><span class="sxs-lookup"><span data-stu-id="9634c-194"><sup>7</sup>UTF-16 data must start with a BOM.</span></span> <span data-ttu-id="9634c-195">Если метка отсутствует, то кодировка может быть неправильно распознана сервером.</span><span class="sxs-lookup"><span data-stu-id="9634c-195">If it does not, the encoding may not be correctly recognized by the server.</span></span>  
  
 <span data-ttu-id="9634c-196"><sup>8</sup>Проверка может происходить во время создания метода доступа или во время получения данных.</span><span class="sxs-lookup"><span data-stu-id="9634c-196"><sup>8</sup>Validation can happen at create accessor time, or at fetch time.</span></span> <span data-ttu-id="9634c-197">Значение ошибки — DB_E_ERRORSOCCURRED, для привязки устанавливается состояние DBBINDSTATUS_UNSUPPORTEDCONVERSION.</span><span class="sxs-lookup"><span data-stu-id="9634c-197">The error is DB_E_ERRORSOCCURRED, binding status set to DBBINDSTATUS_UNSUPPORTEDCONVERSION.</span></span>  
  
 <span data-ttu-id="9634c-198"><sup>9</sup>Данные преобразуются в кодировку Юникода с помощью клиентской кодовой страницы до отправки данных на сервер.</span><span class="sxs-lookup"><span data-stu-id="9634c-198"><sup>9</sup>Data is converted to Unicode using the client codepage before being sent to the server.</span></span> <span data-ttu-id="9634c-199">Если кодировка документа не соответствует клиентской кодовой странице, это может вызвать повреждение данных, поэтому такую привязку крайне не рекомендуется использовать.</span><span class="sxs-lookup"><span data-stu-id="9634c-199">If the document encoding does not match the client codepage, this can result in data corruption, so this binding is strongly discouraged.</span></span>  
  
 <span data-ttu-id="9634c-200"><sup>10</sup>Метка порядка байтов (BOM) всегда добавляется к данным, отправляемым на сервер.</span><span class="sxs-lookup"><span data-stu-id="9634c-200"><sup>10</sup>A BOM is always added to data sent to the server.</span></span> <span data-ttu-id="9634c-201">Если в начале данных уже стоит метка порядка следования байтов, то в начале буфера будет две метки порядка следования байтов.</span><span class="sxs-lookup"><span data-stu-id="9634c-201">If the data already started with a BOM, this results in two BOMs at the start of the buffer.</span></span> <span data-ttu-id="9634c-202">Сервер использует первую метку для распознавания кодировки как UTF-16, а затем отбрасывает ее.</span><span class="sxs-lookup"><span data-stu-id="9634c-202">The server uses the first BOM to recognize the encoding as UTF-16 and then discards it.</span></span> <span data-ttu-id="9634c-203">Вторая метка порядка следования байтов рассматривается как символ неразрывного пробела нулевой ширины.</span><span class="sxs-lookup"><span data-stu-id="9634c-203">The second BOM is interpreted as a zero-width nonbreaking space character.</span></span>  
  
 <span data-ttu-id="9634c-204"><sup>11</sup>Данные в формате UTF-16, кодировка не указана, метка порядка байтов (BOM) добавляется к данным, полученным с сервера.</span><span class="sxs-lookup"><span data-stu-id="9634c-204"><sup>11</sup>Format is UTF-16, no encoding specification, a BOM is added to data received from the server.</span></span> <span data-ttu-id="9634c-205">Если сервер вернул пустую строку, метка порядка байтов все равно будет возвращена приложению.</span><span class="sxs-lookup"><span data-stu-id="9634c-205">If an empty string is returned by the server, a BOM is still returned to the application.</span></span> <span data-ttu-id="9634c-206">Если длина буфера составляет нечетное число байтов, данные усекаются правильно.</span><span class="sxs-lookup"><span data-stu-id="9634c-206">If the buffer length is an odd number of bytes, the data is truncated correctly.</span></span> <span data-ttu-id="9634c-207">Если все значение возвращается по фрагментам данных, их можно объединить для восстановления правильного значения.</span><span class="sxs-lookup"><span data-stu-id="9634c-207">If the whole value is returned in chunks, they can be concatenated to reconstitute the correct value.</span></span>  
  
 <span data-ttu-id="9634c-208"><sup>12</sup> Если длина буфера меньше двух символов, т. е. недостаточно места для завершения нулевого значения, отображается сообщение об ошибке переполнения.</span><span class="sxs-lookup"><span data-stu-id="9634c-208"><sup>12</sup>If the buffer length is less than two characters--that is, not enough space for null termination--an overflow error is reported.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9634c-209">Для XML-данных со значением NULL не возвращаются никакие данные.</span><span class="sxs-lookup"><span data-stu-id="9634c-209">No data is returned for NULL XML values.</span></span>  
  
 <span data-ttu-id="9634c-210">Согласно стандарту XML, XML-документы в кодировке UTF-16 должны начинаться с метки порядка следования байтов (BOM); в UTF-16 это код символа 0xFEFF.</span><span class="sxs-lookup"><span data-stu-id="9634c-210">The XML standard requires UTF-16 encoded XML to start with a byte-order mark (BOM), UTF-16 character code 0xFEFF.</span></span> <span data-ttu-id="9634c-211">При работе с привязками ВСТР и BSTR [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client не требует и не добавляет спецификацию, так как кодировка подразумевается привязкой.</span><span class="sxs-lookup"><span data-stu-id="9634c-211">When working with WSTR and BSTR bindings, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client does not require or add a BOM as the encoding is implied by the binding.</span></span> <span data-ttu-id="9634c-212">При работе с привязками типов BYTES, XML и IUNKNOWN целью является предоставить возможности для наиболее простого взаимодействия с другими обработчиками XML и хранилищами данных.</span><span class="sxs-lookup"><span data-stu-id="9634c-212">When working with BYTES, XML, or IUNKNOWN bindings, the intent is to provide simplicity in dealing with other XML processors and storage systems.</span></span> <span data-ttu-id="9634c-213">В этом случае в XML с кодировкой UTF-16 нужно включить метку порядка байтов, и приложение может не заботиться о том, какова на самом деле кодировка данных, потому что большинство обработчиков XML (в том числе SQL Server) вычислят кодировку по нескольким первым байтам данных.</span><span class="sxs-lookup"><span data-stu-id="9634c-213">In this case a BOM should be present with UTF-16 encoded XML, and the application need not be concerned with the actual encoding, since the majority of XML processors (including SQL Server) deduces the encoding by inspecting the first few bytes of the value.</span></span> <span data-ttu-id="9634c-214">XML-данные, полученные от [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] собственного клиента с использованием привязок bytes, XML или IUnknown, всегда кодируются в кодировке UTF – 16 с BOM и без внедренного объявления кодировки.</span><span class="sxs-lookup"><span data-stu-id="9634c-214">XML data received from [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client using BYTES, XML, or IUNKNOWN bindings is always encoded in UTF-16 with a BOM and without an embedded encoding declaration.</span></span>  
  
 <span data-ttu-id="9634c-215">Преобразование данных, выполняемое основными службами OLE DB (**IDataConvert**), неприменимо к типу DBTYPE_XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-215">Data conversions supplied by OLE DB core services (**IDataConvert**) are not applicable to DBTYPE_XML.</span></span>  
  
 <span data-ttu-id="9634c-216">Проверка производится при отсылке данных на сервер.</span><span class="sxs-lookup"><span data-stu-id="9634c-216">Validation is done when data is sent to the server.</span></span> <span data-ttu-id="9634c-217">Проверку с клиентской стороны и изменение кодировки должно проводить приложение. Обрабатывать непосредственно XML-данные не рекомендуется. Для обработки данных лучше использовать функции чтения DOM или SAX.</span><span class="sxs-lookup"><span data-stu-id="9634c-217">Client-side validation and encoding changes should be handled by your application, and it is strongly recommended that you not process the XML data directly, but should instead use a DOM or SAX reader to process it.</span></span>  
  
 <span data-ttu-id="9634c-218">Типы DBTYPE_NULL и DBTYPE_EMPTY могут быть привязаны только для входных параметров. Они не могут быть привязаны для выходных параметров или результатов.</span><span class="sxs-lookup"><span data-stu-id="9634c-218">DBTYPE_NULL and DBTYPE_EMPTY can be bound for input parameters but not for output parameters or results.</span></span> <span data-ttu-id="9634c-219">При привязке входных параметров следует установить состояние DBSTATUS_S_ISNULL или DBSTATUS_S_DEFAULT.</span><span class="sxs-lookup"><span data-stu-id="9634c-219">When bound for input parameters the status must be set to DBSTATUS_S_ISNULL or DBSTATUS_S_DEFAULT.</span></span>  
  
 <span data-ttu-id="9634c-220">DBTYPE_XML можно преобразовать в DBTYPE_EMPTY и DBTYPE_NULL, DBTYPE_EMPTY можно преобразовать в DBTYPE_XML, но DBTYPE_NULL нельзя преобразовать в DBTYPE_XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-220">DBTYPE_XML can be converted to DBTYPE_EMPTY and DBTYPE_NULL, DBTYPE_EMPTY can be converted to DBTYPE_XML, but DBTYPE_NULL cannot be converted to DBTYPE_XML.</span></span> <span data-ttu-id="9634c-221">Это согласуется с DBTYPE_WSTR.</span><span class="sxs-lookup"><span data-stu-id="9634c-221">This is consistent with DBTYPE_WSTR.</span></span>  
  
 <span data-ttu-id="9634c-222">Привязка DBTYPE_IUNKNOWN поддерживается, как показано в приведенной таблице, но преобразований между типами DBTYPE_XML и DBTYPE_IUNKNOWN не существует.</span><span class="sxs-lookup"><span data-stu-id="9634c-222">DBTYPE_IUNKNOWN is a supported binding (as shown in the above table), but there are no conversions between DBTYPE_XML and DBTYPE_IUNKNOWN.</span></span> <span data-ttu-id="9634c-223">DBTYPE_IUNKNOWN нельзя использовать с DBTYPE_BYREF.</span><span class="sxs-lookup"><span data-stu-id="9634c-223">DBTYPE_IUNKNOWN may not be used with DBTYPE_BYREF.</span></span>  
  
### <a name="ole-db-rowset-additions-and-changes"></a><span data-ttu-id="9634c-224">Добавления и изменения для наборов строк OLE DB</span><span class="sxs-lookup"><span data-stu-id="9634c-224">OLE DB Rowset Additions and Changes</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="9634c-225">Собственный клиент добавляет новые значения или изменения во многие базовые наборы строк схемы OLE DB.</span><span class="sxs-lookup"><span data-stu-id="9634c-225">Native Client adds new values or changes to many of the core OLE DB schema rowsets.</span></span>  
  
#### <a name="the-columns-and-procedure_parameters-schema-rowsets"></a><span data-ttu-id="9634c-226">Наборы строк схем COLUMNS и PROCEDURE_PARAMETERS</span><span class="sxs-lookup"><span data-stu-id="9634c-226">The COLUMNS and PROCEDURE_PARAMETERS Schema Rowsets</span></span>  
 <span data-ttu-id="9634c-227">К наборам строк схем COLUMNS и PROCEDURE_PARAMETERS добавлены следующие столбцы.</span><span class="sxs-lookup"><span data-stu-id="9634c-227">Additions to the COLUMNS and PROCEDURE_PARAMETERS schema rowsets include the following columns.</span></span>  
  
|<span data-ttu-id="9634c-228">Имя столбца</span><span class="sxs-lookup"><span data-stu-id="9634c-228">Column name</span></span>|<span data-ttu-id="9634c-229">Type</span><span class="sxs-lookup"><span data-stu-id="9634c-229">Type</span></span>|<span data-ttu-id="9634c-230">Описание</span><span class="sxs-lookup"><span data-stu-id="9634c-230">Description</span></span>|  
|-----------------|----------|-----------------|  
|<span data-ttu-id="9634c-231">SS_XML_SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-231">SS_XML_SCHEMACOLLECTION_CATALOGNAME</span></span>|<span data-ttu-id="9634c-232">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-232">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-233">Имя каталога, в котором определена коллекция схем XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-233">The name of a catalog in which an XML schema collection is defined.</span></span> <span data-ttu-id="9634c-234">Значение NULL для столбцов, отличных от XML или нетипизированных XML-столбцов.</span><span class="sxs-lookup"><span data-stu-id="9634c-234">NULL for a non-XML column or un-typed XML column.</span></span>|  
|<span data-ttu-id="9634c-235">SS_XML_SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="9634c-235">SS_XML_SCHEMACOLLECTION_SCHEMANAME</span></span>|<span data-ttu-id="9634c-236">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-236">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-237">Имя схемы, в которой определена коллекция схем XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-237">The name of a schema in which an XML schema collection is defined.</span></span> <span data-ttu-id="9634c-238">Значение NULL для столбцов, отличных от XML или нетипизированных XML-столбцов.</span><span class="sxs-lookup"><span data-stu-id="9634c-238">NULL for a non-XML column or un-typed XML column.</span></span>|  
|<span data-ttu-id="9634c-239">SS_XML_SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-239">SS_XML_SCHEMACOLLECTIONNAME</span></span>|<span data-ttu-id="9634c-240">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-240">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-241">Имя коллекции схем XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-241">The name of XML schema collection.</span></span> <span data-ttu-id="9634c-242">Значение NULL для столбцов, отличных от XML или нетипизированных XML-столбцов.</span><span class="sxs-lookup"><span data-stu-id="9634c-242">NULL for a non-XML column or un-typed XML column.</span></span>|  
  
#### <a name="the-provider_types-schema-rowset"></a><span data-ttu-id="9634c-243">Набор строк схемы PROVIDER_TYPES</span><span class="sxs-lookup"><span data-stu-id="9634c-243">The PROVIDER_TYPES Schema Rowset</span></span>  
 <span data-ttu-id="9634c-244">В наборе строк схемы PROVIDER_TYPES значение параметра COLUMN_SIZE для типа данных **xml** равно 0, а DATA_TYPE равен DBTYPE_XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-244">In the PROVIDER_TYPES schema rowset, the COLUMN_SIZE value is 0 for the **xml** data type, and the DATA_TYPE is DBTYPE_XML.</span></span>  
  
#### <a name="the-ss_xmlschema-schema-rowset"></a><span data-ttu-id="9634c-245">Набор строк схемы SS_XMLSCHEMA</span><span class="sxs-lookup"><span data-stu-id="9634c-245">The SS_XMLSCHEMA Schema Rowset</span></span>  
 <span data-ttu-id="9634c-246">Для клиентов добавлен новый набор строк схемы SS_XMLSCHEMA для получения информации о схеме XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-246">A new schema rowset SS_XMLSCHEMA is introduced for clients to retrieve XML schema information.</span></span> <span data-ttu-id="9634c-247">Набор строк SS_XMLSCHEMA содержит следующие столбцы.</span><span class="sxs-lookup"><span data-stu-id="9634c-247">The SS_XMLSCHEMA rowset contains the following columns.</span></span>  
  
|<span data-ttu-id="9634c-248">Имя столбца</span><span class="sxs-lookup"><span data-stu-id="9634c-248">Column name</span></span>|<span data-ttu-id="9634c-249">Type</span><span class="sxs-lookup"><span data-stu-id="9634c-249">Type</span></span>|<span data-ttu-id="9634c-250">Описание</span><span class="sxs-lookup"><span data-stu-id="9634c-250">Description</span></span>|  
|-----------------|----------|-----------------|  
|<span data-ttu-id="9634c-251">SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-251">SCHEMACOLLECTION_CATALOGNAME</span></span>|<span data-ttu-id="9634c-252">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-252">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-253">Каталог, которому принадлежит коллекция XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-253">The catalog an XML collection belongs to.</span></span>|  
|<span data-ttu-id="9634c-254">SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="9634c-254">SCHEMACOLLECTION_SCHEMANAME</span></span>|<span data-ttu-id="9634c-255">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-255">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-256">Схема, которой принадлежит коллекция XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-256">The schema an XML collection belongs to.</span></span>|  
|<span data-ttu-id="9634c-257">SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-257">SCHEMACOLLECTIONNAME</span></span>|<span data-ttu-id="9634c-258">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-258">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-259">Имя коллекции схем XML для типизированных XML-столбцов, NULL для всех остальных столбцов.</span><span class="sxs-lookup"><span data-stu-id="9634c-259">The name of an XML schema collection for typed XML columns, NULL otherwise.</span></span>|  
|<span data-ttu-id="9634c-260">TARGETNAMESPACEURI</span><span class="sxs-lookup"><span data-stu-id="9634c-260">TARGETNAMESPACEURI</span></span>|<span data-ttu-id="9634c-261">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-261">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-262">Имя целевого пространства имен схемы XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-262">The target name space of an XML schema.</span></span>|  
|<span data-ttu-id="9634c-263">SCHEMACONTENT</span><span class="sxs-lookup"><span data-stu-id="9634c-263">SCHEMACONTENT</span></span>|<span data-ttu-id="9634c-264">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-264">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-265">Содержимое схемы XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-265">The XML schema content.</span></span>|  
  
 <span data-ttu-id="9634c-266">Для каждой схемы XML область действия ограничивается именем каталога, именем схемы, именем коллекции схем и URI-идентификатором целевого пространства имен.</span><span class="sxs-lookup"><span data-stu-id="9634c-266">Each XML schema is scoped by catalog name, schema name, schema collection name, and target name space Uniform Resource Identifier (URI).</span></span> <span data-ttu-id="9634c-267">Кроме того, задан новый идентификатор GUID с именем DBSCHEMA_XML_COLLECTIONS.</span><span class="sxs-lookup"><span data-stu-id="9634c-267">In addition, a new GUID with the name DBSCHEMA_XML_COLLECTIONS is also defined.</span></span> <span data-ttu-id="9634c-268">Количество ограничений и столбцы с ограничениями для набора строк схемы SS_XMLSCHEMA определены следующим образом.</span><span class="sxs-lookup"><span data-stu-id="9634c-268">The number of restrictions and restricted columns for the SS_XMLSCHEMA schema rowset are defined as follows.</span></span>  
  
|<span data-ttu-id="9634c-269">Код GUID</span><span class="sxs-lookup"><span data-stu-id="9634c-269">GUID</span></span>|<span data-ttu-id="9634c-270">Количество ограничений</span><span class="sxs-lookup"><span data-stu-id="9634c-270">Number of restrictions</span></span>|<span data-ttu-id="9634c-271">Столбцы с ограничениями</span><span class="sxs-lookup"><span data-stu-id="9634c-271">Restricted columns</span></span>|  
|----------|----------------------------|------------------------|  
|<span data-ttu-id="9634c-272">DBSCHEMA_XML_COLLECTIONS</span><span class="sxs-lookup"><span data-stu-id="9634c-272">DBSCHEMA_XML_COLLECTIONS</span></span>|<span data-ttu-id="9634c-273">4</span><span class="sxs-lookup"><span data-stu-id="9634c-273">4</span></span>|<span data-ttu-id="9634c-274">SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-274">SCHEMACOLLECTION_CATALOGNAME</span></span><br /><br /> <span data-ttu-id="9634c-275">SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="9634c-275">SCHEMACOLLECTION_SCHEMANAME</span></span><br /><br /> <span data-ttu-id="9634c-276">SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-276">SCHEMACOLLECTIONNAME</span></span><br /><br /> <span data-ttu-id="9634c-277">TARGETNAMESPACEURI</span><span class="sxs-lookup"><span data-stu-id="9634c-277">TARGETNAMESPACEURI</span></span>|  
  
### <a name="ole-db-property-set-additions-and-changes"></a><span data-ttu-id="9634c-278">Добавления и изменения для наборов свойств OLE DB</span><span class="sxs-lookup"><span data-stu-id="9634c-278">OLE DB Property Set Additions and Changes</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="9634c-279">Собственный клиент добавляет новые значения или изменения во многие из основных наборов свойств OLE DB.</span><span class="sxs-lookup"><span data-stu-id="9634c-279">Native Client adds new values or changes to many of the core OLE DB property sets.</span></span>  
  
#### <a name="the-dbpropset_sqlserverparameter-property-set"></a><span data-ttu-id="9634c-280">Набор свойств DBPROPSET_SQLSERVERPARAMETER</span><span class="sxs-lookup"><span data-stu-id="9634c-280">The DBPROPSET_SQLSERVERPARAMETER Property Set</span></span>  
 <span data-ttu-id="9634c-281">Для поддержки типа данных **XML** с помощью OLE DB в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] собственном клиенте реализован новый набор свойств DBPROPSET_SQLSERVERPARAMETER, который содержит следующие значения.</span><span class="sxs-lookup"><span data-stu-id="9634c-281">In order to support the **xml** data type through OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client implements the new DBPROPSET_SQLSERVERPARAMETER property set, which contains the following values.</span></span>  
  
|<span data-ttu-id="9634c-282">Имя</span><span class="sxs-lookup"><span data-stu-id="9634c-282">Name</span></span>|<span data-ttu-id="9634c-283">Type</span><span class="sxs-lookup"><span data-stu-id="9634c-283">Type</span></span>|<span data-ttu-id="9634c-284">Описание</span><span class="sxs-lookup"><span data-stu-id="9634c-284">Description</span></span>|  
|----------|----------|-----------------|  
|<span data-ttu-id="9634c-285">SSPROP_PARAM_XML_SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-285">SSPROP_PARAM_XML_SCHEMACOLLECTION_CATALOGNAME</span></span>|<span data-ttu-id="9634c-286">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-286">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-287">Имя каталога (базы данных), где определена коллекция схем XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-287">The name of a catalog (database) in which an XML schema collection is defined.</span></span> <span data-ttu-id="9634c-288">Часть идентификатора трехкомпонентного имени SQL.</span><span class="sxs-lookup"><span data-stu-id="9634c-288">A part of the SQL three-part name identifier.</span></span>|  
|<span data-ttu-id="9634c-289">SSPROP_PARAM_XML_SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="9634c-289">SSPROP_PARAM_XML_SCHEMACOLLECTION_SCHEMANAME</span></span>|<span data-ttu-id="9634c-290">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-290">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-291">Имя схемы XML в коллекции схемы XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-291">The name of an XML schema within the schema collection.</span></span> <span data-ttu-id="9634c-292">Часть идентификатора трехкомпонентного имени SQL.</span><span class="sxs-lookup"><span data-stu-id="9634c-292">A part of the SQL three -part name identifier.</span></span>|  
|<span data-ttu-id="9634c-293">SSPROP_PARAM_XML_SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-293">SSPROP_PARAM_XML_SCHEMACOLLECTIONNAME</span></span>|<span data-ttu-id="9634c-294">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-294">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-295">Имя коллекции схем XML в каталоге, представляющее собой часть трехчастного идентификатора имени SQL.</span><span class="sxs-lookup"><span data-stu-id="9634c-295">The name of the XML schema collection within the catalog A part of the SQL three -part name identifier.</span></span>|  
  
#### <a name="the-dbpropset_sqlservercolumn-property-set"></a><span data-ttu-id="9634c-296">Набор свойств DBPROPSET_SQLSERVERCOLUMN</span><span class="sxs-lookup"><span data-stu-id="9634c-296">The DBPROPSET_SQLSERVERCOLUMN Property Set</span></span>  
 <span data-ttu-id="9634c-297">Для поддержки создания таблиц в интерфейсе **ITableDefinition** [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client добавляет три новых столбца в набор свойств DBPROPSET_SQLSERVERCOLUMN.</span><span class="sxs-lookup"><span data-stu-id="9634c-297">To support the creation of tables in the **ITableDefinition** interface, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client adds three new columns to the DBPROPSET_SQLSERVERCOLUMN property set.</span></span>  
  
|<span data-ttu-id="9634c-298">Имя</span><span class="sxs-lookup"><span data-stu-id="9634c-298">Name</span></span>|<span data-ttu-id="9634c-299">Type</span><span class="sxs-lookup"><span data-stu-id="9634c-299">Type</span></span>|<span data-ttu-id="9634c-300">Описание</span><span class="sxs-lookup"><span data-stu-id="9634c-300">Description</span></span>|  
|----------|----------|-----------------|  
|<span data-ttu-id="9634c-301">SSPROP_COL_XML_SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-301">SSPROP_COL_XML_SCHEMACOLLECTION_CATALOGNAME</span></span>|<span data-ttu-id="9634c-302">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-302">VT_BSTR</span></span>|<span data-ttu-id="9634c-303">Для типизированных столбцов XML данное свойство содержит строку, представляющую имя каталога, где хранится схема XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-303">For typed XML columns, this property is a string specifying the name of the catalog where the XML schema is stored.</span></span> <span data-ttu-id="9634c-304">Для других типов столбцов это свойство содержит пустую строку.</span><span class="sxs-lookup"><span data-stu-id="9634c-304">For other column types this property returns an empty string.</span></span>|  
|<span data-ttu-id="9634c-305">SSPROP_COL_XML_SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="9634c-305">SSPROP_COL_XML_SCHEMACOLLECTION_SCHEMANAME</span></span>|<span data-ttu-id="9634c-306">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-306">VT_BSTR</span></span>|<span data-ttu-id="9634c-307">Для типизированных столбцов XML данное свойство содержит строку, представляющую имя схемы XML, задающей этот столбец.</span><span class="sxs-lookup"><span data-stu-id="9634c-307">For typed XML columns, this property is a string specifying the name of XML schema that defines this column.</span></span>|  
|<span data-ttu-id="9634c-308">SSPROP_COL_XML_SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-308">SSPROP_COL_XML_SCHEMACOLLECTIONNAME</span></span>|<span data-ttu-id="9634c-309">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-309">VT_BSTR</span></span>|<span data-ttu-id="9634c-310">Для типизированных столбцов XML данное свойство содержит строку, представляющую имя коллекции схем XML, определяющей значение.</span><span class="sxs-lookup"><span data-stu-id="9634c-310">For typed XML columns, this property is a string specifying the name of the schema XML schema collection defining the value.</span></span>|  
  
 <span data-ttu-id="9634c-311">Подобно значениям SSPROP_PARAM, все эти свойства являются необязательными и по умолчанию пусты.</span><span class="sxs-lookup"><span data-stu-id="9634c-311">Like the SSPROP_PARAM values, all of these properties are optional and default to empty.</span></span> <span data-ttu-id="9634c-312">SSPROP_COL_XML_SCHEMACOLLECTION_CATALOGNAME и SSPROP_COL_XML_SCHEMACOLLECTION_SCHEMANAME можно задавать только при заданном свойстве SSPROP_COL_XML_SCHEMACOLLECTIONNAME.</span><span class="sxs-lookup"><span data-stu-id="9634c-312">SSPROP_COL_XML_SCHEMACOLLECTION_CATALOGNAME and SSPROP_COL_XML_SCHEMACOLLECTION_SCHEMANAME may only be specified if SSPROP_COL_XML_SCHEMACOLLECTIONNAME is specified.</span></span> <span data-ttu-id="9634c-313">При передаче данных в формате XML на сервер, если эти значения включены, они будут проверены на существование (допустимость) в текущей базе данных, а экземпляр данных проверяется по схеме.</span><span class="sxs-lookup"><span data-stu-id="9634c-313">When passing XML to the server, if these values are included they are checked for existence (validity) against the current database and the instance data is checked against the schema.</span></span> <span data-ttu-id="9634c-314">Во всех случаях, чтобы данные были допустимыми, эти столбцы должны быть все одновременно пусты или все одновременно заполнены.</span><span class="sxs-lookup"><span data-stu-id="9634c-314">In all cases, to be valid they are either all empty or all filled in.</span></span>  
  
### <a name="ole-db-interface-additions-and-changes"></a><span data-ttu-id="9634c-315">Добавления и изменения для интерфейсов OLE DB</span><span class="sxs-lookup"><span data-stu-id="9634c-315">OLE DB Interface Additions and Changes</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="9634c-316">Собственный клиент добавляет новые значения или изменения во многие основные OLE DB интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="9634c-316">Native Client adds new values or changes to many of the core OLE DB interfaces.</span></span>  
  
#### <a name="the-isscommandwithparameters-interface"></a><span data-ttu-id="9634c-317">Интерфейс ISSCommandWithParameters</span><span class="sxs-lookup"><span data-stu-id="9634c-317">The ISSCommandWithParameters Interface</span></span>  
 <span data-ttu-id="9634c-318">Для поддержки типа данных **XML** с помощью OLE DB в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] собственном клиенте реализован ряд изменений, включая Добавление интерфейса [ISSCommandWithParameters](../../native-client-ole-db-interfaces/isscommandwithparameters-ole-db.md) .</span><span class="sxs-lookup"><span data-stu-id="9634c-318">In order to support the **xml** data type through OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client implements a number of changes including the addition of the [ISSCommandWithParameters](../../native-client-ole-db-interfaces/isscommandwithparameters-ole-db.md) interface.</span></span> <span data-ttu-id="9634c-319">Этот новый интерфейс наследует основной интерфейс OLE DB — **ICommandWithParameters**.</span><span class="sxs-lookup"><span data-stu-id="9634c-319">This new interface inherits from the core OLE DB interface **ICommandWithParameters**.</span></span> <span data-ttu-id="9634c-320">В дополнение к трем методам, унаследованным от **ICommandWithParameters**; **GetParameterInfo**, **MapParameterNames**и **SetParameterInfo**; **ISSCommandWithParameters** предоставляет методы [GetParameterProperties](../../native-client-ole-db-interfaces/isscommandwithparameters-getparameterproperties-ole-db.md) и [SetParameterProperties](../../native-client-ole-db-interfaces/isscommandwithparameters-setparameterproperties-ole-db.md) , используемые для работы с конкретными типами данных сервера.</span><span class="sxs-lookup"><span data-stu-id="9634c-320">In addition to the three methods inherited from **ICommandWithParameters**; **GetParameterInfo**, **MapParameterNames**, and **SetParameterInfo**; **ISSCommandWithParameters** provides the [GetParameterProperties](../../native-client-ole-db-interfaces/isscommandwithparameters-getparameterproperties-ole-db.md) and [SetParameterProperties](../../native-client-ole-db-interfaces/isscommandwithparameters-setparameterproperties-ole-db.md) methods that are used to handle server specific data types.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9634c-321">Интерфейс **ISSCommandWithParameters** также задействует возможности новой структуры SSPARAMPROPS.</span><span class="sxs-lookup"><span data-stu-id="9634c-321">The **ISSCommandWithParameters** interface also makes use of the new SSPARAMPROPS structure.</span></span>  
  
#### <a name="the-icolumnsrowset-interface"></a><span data-ttu-id="9634c-322">Интерфейс IColumnsRowset</span><span class="sxs-lookup"><span data-stu-id="9634c-322">The IColumnsRowset Interface</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="9634c-323">Собственный клиент добавляет указанные ниже [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] столбцы к набору строк, возвращаемому методом **иколумнровсет:: жетколумнсровсет** .</span><span class="sxs-lookup"><span data-stu-id="9634c-323">Native Client adds the following [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]-specific columns to the rowset returned by the **IColumnRowset::GetColumnsRowset** method.</span></span> <span data-ttu-id="9634c-324">Эти столбцы содержат трехчастное имя коллекции схем XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-324">These columns contain the three-part name of an XML schema collection.</span></span> <span data-ttu-id="9634c-325">Для столбцов не в формате XML и нетипизированных столбцов XML все три данных столбца по умолчанию имеют значение NULL.</span><span class="sxs-lookup"><span data-stu-id="9634c-325">For non-XML columns or untyped XML columns, all three columns take the default value of NULL.</span></span>  
  
|<span data-ttu-id="9634c-326">Имя столбца</span><span class="sxs-lookup"><span data-stu-id="9634c-326">Column name</span></span>|<span data-ttu-id="9634c-327">Type</span><span class="sxs-lookup"><span data-stu-id="9634c-327">Type</span></span>|<span data-ttu-id="9634c-328">Описание</span><span class="sxs-lookup"><span data-stu-id="9634c-328">Description</span></span>|  
|-----------------|----------|-----------------|  
|<span data-ttu-id="9634c-329">DBCOLUMN_SS_XML_SCHEMACOLLECTION_CATALOGNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-329">DBCOLUMN_SS_XML_SCHEMACOLLECTION_CATALOGNAME</span></span>|<span data-ttu-id="9634c-330">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-330">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-331">Каталог, которому принадлежит коллекция схем XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-331">The catalog an XML schema collection belongs to,</span></span><br /><br /> <span data-ttu-id="9634c-332">В противном случае — значение NULL.</span><span class="sxs-lookup"><span data-stu-id="9634c-332">NULL otherwise.</span></span>|  
|<span data-ttu-id="9634c-333">DBCOLUMN_SS_XML_SCHEMACOLLECTION_SCHEMANAME</span><span class="sxs-lookup"><span data-stu-id="9634c-333">DBCOLUMN_SS_XML_SCHEMACOLLECTION_SCHEMANAME</span></span>|<span data-ttu-id="9634c-334">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-334">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-335">Схема, которой принадлежит коллекция схем XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-335">The schema an XML schema collection belongs to.</span></span> <span data-ttu-id="9634c-336">В противном случае — значение NULL.</span><span class="sxs-lookup"><span data-stu-id="9634c-336">NULL otherwise.</span></span>|  
|<span data-ttu-id="9634c-337">DBCOLUMN_SS_XML_SCHEMACOLLECTIONNAME</span><span class="sxs-lookup"><span data-stu-id="9634c-337">DBCOLUMN_SS_XML_SCHEMACOLLECTIONNAME</span></span>|<span data-ttu-id="9634c-338">DBTYPE_WSTR</span><span class="sxs-lookup"><span data-stu-id="9634c-338">DBTYPE_WSTR</span></span>|<span data-ttu-id="9634c-339">Имя коллекции схем XML для типизированных XML-столбцов, NULL — для всех остальных столбцов.</span><span class="sxs-lookup"><span data-stu-id="9634c-339">The name of XML schema collection for typed XML column, NULL otherwise.</span></span>|  
  
#### <a name="the-irowset-interface"></a><span data-ttu-id="9634c-340">Интерфейс IRowset</span><span class="sxs-lookup"><span data-stu-id="9634c-340">The IRowset Interface</span></span>  
 <span data-ttu-id="9634c-341">Метод **IRowset::GetData** служит для получения экземпляра XML в столбце XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-341">An XML instance in an XML column is retrieved through the **IRowset::GetData** method.</span></span> <span data-ttu-id="9634c-342">В зависимости от привязки, указанной клиентом, экземпляр XML может быть получен в виде типа DBTYPE_BSTR, DBTYPE_WSTR, DBTYPE_VARIANT, DBTYPE_XML, DBTYPE_STR, DBTYPE_BYTES или как интерфейс через DBTYPE_IUNKNOWN.</span><span class="sxs-lookup"><span data-stu-id="9634c-342">Depending on the binding specified by the client, an XML instance can be retrieved as DBTYPE_BSTR, DBTYPE_WSTR, DBTYPE_VARIANT, DBTYPE_XML, DBTYPE_STR, DBTYPE_BYTES, or as an interface via DBTYPE_IUNKNOWN.</span></span> <span data-ttu-id="9634c-343">Если потребитель задает тип DBTYPE_BSTR, DBTYPE_WSTR или DBTYPE_VARIANT, поставщик преобразует экземпляр XML в запрошенный пользователем тип и помещает в местонахождение, заданное соответствующей привязкой.</span><span class="sxs-lookup"><span data-stu-id="9634c-343">If the consumer specifies DBTYPE_BSTR, DBTYPE_WSTR, or DBTYPE_VARIANT, the provider converts the XML instance to the user requested type and put it into the location specified in the corresponding binding.</span></span>  
  
 <span data-ttu-id="9634c-344">Если потребитель задает DBTYPE_IUNKNOWN и устанавливает аргумент *pObject* равным NULL или задает для аргумента *pObject* значение IID_ISequentialStream, поставщик возвращает потребителю интерфейс **ISequentialStream**, чтобы потребитель мог получить из столбца данные XML в виде потока.</span><span class="sxs-lookup"><span data-stu-id="9634c-344">If the consumer specifies DBTYPE_IUNKNOWN and sets the *pObject* argument to NULL, or sets the *pObject* argument to IID_ISequentialStream, the provider returns an **ISequentialStream** interface to the consumer so that the consumer can stream the XML data out of the column.</span></span> <span data-ttu-id="9634c-345">Затем интерфейс **ISequentialStream** возвращает данные XML в виде потока символов в формате Юникода.</span><span class="sxs-lookup"><span data-stu-id="9634c-345">**ISequentialStream** then returns the XML data as a Unicode character stream.</span></span>  
  
 <span data-ttu-id="9634c-346">При возврате значения XML, привязанного к DBTYPE_IUNKNOWN, поставщик передает значение размера `sizeof (IUnknown *)`.</span><span class="sxs-lookup"><span data-stu-id="9634c-346">When returning an XML value bound to DBTYPE_IUNKNOWN, the provider reports a size value of `sizeof (IUnknown *)`.</span></span> <span data-ttu-id="9634c-347">Следует заметить, что это согласуется с подходом, который используется при передаче привязанного столбца как DBTYPE_IUnknown или DBTYPE_IDISPATCH, а также при передаче в формате DBTYPE_IUNKNOWN/ISequentialStream, когда точный размер столбца установить не удается.</span><span class="sxs-lookup"><span data-stu-id="9634c-347">Note that this is consistent with the approach taken when a column is bound as DBTYPE_IUnknown or DBTYPE_IDISPATCH, and by DBTYPE_IUNKNOWN/ISequentialStream when the exact column size cannot be determined.</span></span>  
  
#### <a name="the-irowsetchange-interface"></a><span data-ttu-id="9634c-348">Интерфейс IRowsetChange</span><span class="sxs-lookup"><span data-stu-id="9634c-348">The IRowsetChange Interface</span></span>  
 <span data-ttu-id="9634c-349">Потребитель может изменить экземпляр XML в столбце двумя способами.</span><span class="sxs-lookup"><span data-stu-id="9634c-349">There are two ways a consumer can update an XML instance in a column.</span></span> <span data-ttu-id="9634c-350">Первый способ использует объект хранилища с интерфейсом **ISequentialStream**, созданный поставщиком.</span><span class="sxs-lookup"><span data-stu-id="9634c-350">The first one is through the storage object **ISequentialStream** created by the provider.</span></span> <span data-ttu-id="9634c-351">Потребитель может вызвать метод **ISequentialStream::Write** для непосредственного изменения экземпляра XML, возвращенного поставщиком.</span><span class="sxs-lookup"><span data-stu-id="9634c-351">The consumer can call the **ISequentialStream::Write** method to directly update the XML instance returned by the provider.</span></span>  
  
 <span data-ttu-id="9634c-352">Второй подход использует методы **IRowsetChange::SetData** или **IRowsetChange::InsertRow**.</span><span class="sxs-lookup"><span data-stu-id="9634c-352">The second approach is through **IRowsetChange::SetData** or **IRowsetChange::InsertRow** methods.</span></span> <span data-ttu-id="9634c-353">При таком подходе экземпляр XML в буфере потребителя можно задать привязкой типа DBTYPE_BSTR, DBTYPE_WSTR, DBTYPE_VARIANT, DBTYPE_XML или DBTYPE_IUNKNOWN.</span><span class="sxs-lookup"><span data-stu-id="9634c-353">In this approach, an XML instance in the consumer's buffer can be specified in a binding of type DBTYPE_BSTR, DBTYPE_WSTR, DBTYPE_VARIANT, DBTYPE_XML or DBTYPE_IUNKNOWN.</span></span>  
  
 <span data-ttu-id="9634c-354">В случае DBTYPE_BSTR, DBTYPE_WSTR или DBTYPE_VARIANT поставщик сохраняет экземпляр XML из буфера потребителя в соответствующий столбец.</span><span class="sxs-lookup"><span data-stu-id="9634c-354">In case of DBTYPE_BSTR, DBTYPE_WSTR, or DBTYPE_VARIANT, the provider stores the XML instance residing in the consumer buffer into the proper column.</span></span>  
  
 <span data-ttu-id="9634c-355">В случае DBTYPE_IUNKNOWN/Исекуентиалстреам, если потребитель не указал какой-либо объект хранилища, потребитель должен заранее создать объект **ISequentialStream** , ПРИВЯЗАТЬ XML-документ к объекту, а затем передать объект поставщику с помощью метода **IRowsetChange:: SetData** .</span><span class="sxs-lookup"><span data-stu-id="9634c-355">In the case of DBTYPE_IUNKNOWN/ISequentialStream, if the consumer does not specify any storage object, the consumer must create an **ISequentialStream** object in advance, bind the XML document with the object, and then pass the object to the provider through the **IRowsetChange::SetData** method.</span></span> <span data-ttu-id="9634c-356">Потребитель может также создать объект хранилища, установить аргумент pObject равным IID_ISequentialStream, создать объект **ISequentialStream**, а затем передать этот объект **ISequentialStream** в метод **IRowsetChange::SetData**.</span><span class="sxs-lookup"><span data-stu-id="9634c-356">The consumer can also create a storage object, set the pObject argument to IID_ISequentialStream, create an **ISequentialStream** object and then pass the **ISequentialStream** object to the **IRowsetChange::SetData** method.</span></span> <span data-ttu-id="9634c-357">В обоих случаях поставщик может получить объект XML через объект **ISequentialStream** и вставить в нужный столбец.</span><span class="sxs-lookup"><span data-stu-id="9634c-357">In both cases, the provider can retrieve the XML object through the **ISequentialStream** object and insert it into a proper column.</span></span>  
  
#### <a name="the-irowsetupdate-interface"></a><span data-ttu-id="9634c-358">Интерфейс IRowsetUpdate</span><span class="sxs-lookup"><span data-stu-id="9634c-358">The IRowsetUpdate Interface</span></span>  
 <span data-ttu-id="9634c-359">Интерфейс **IRowsetUpdate** предоставляет функциональность отсроченных изменений.</span><span class="sxs-lookup"><span data-stu-id="9634c-359">**IRowsetUpdate** interface provides functionality for delayed updates.</span></span> <span data-ttu-id="9634c-360">Данные, доступные для наборов строк, не становятся доступными для других транзакций, пока потребитель не вызовет метод **IRowsetUpdate: Update** .</span><span class="sxs-lookup"><span data-stu-id="9634c-360">The data made available to the rowsets is not made available to other transactions until the consumer calls the **IRowsetUpdate:Update** method.</span></span>  
  
#### <a name="the-irowsetfind-interface"></a><span data-ttu-id="9634c-361">Интерфейс IRowsetFind</span><span class="sxs-lookup"><span data-stu-id="9634c-361">The IRowsetFind Interface</span></span>  
 <span data-ttu-id="9634c-362">Метод **IRowsetFind::FindNextRow** не работает с типом **xml**.</span><span class="sxs-lookup"><span data-stu-id="9634c-362">The **IRowsetFind::FindNextRow** method does not work with the **xml** data type.</span></span> <span data-ttu-id="9634c-363">При вызове **IRowsetFind::FindNextRow**, если в аргументе *hAccessor* передается столбец типа DBTYPE_XML, будет возвращен результат DB_E_BADBINDINFO.</span><span class="sxs-lookup"><span data-stu-id="9634c-363">When **IRowsetFind::FindNextRow** is called and the *hAccessor* argument specifies a column of DBTYPE_XML, DB_E_BADBINDINFO is returned.</span></span> <span data-ttu-id="9634c-364">Это происходит независимо от типа столбца, в котором производится поиск данных.</span><span class="sxs-lookup"><span data-stu-id="9634c-364">This occurs regardless of the type of column that is being searched.</span></span> <span data-ttu-id="9634c-365">Для любого другого типа привязки вызов **FindNextRow** возвращает результат DB_E_BADCOMPAREOP, если столбец, в котором производится поиск данных, имеет тип **xml**.</span><span class="sxs-lookup"><span data-stu-id="9634c-365">For any other binding type, the **FindNextRow** fails with DB_E_BADCOMPAREOP if the column to be searched is of the **xml** data type.</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="9634c-366">Драйвер ODBC для собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="9634c-366">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="9634c-367">В [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] драйвере ODBC для собственного клиента в различные функции для поддержки типа данных **XML** было внесено несколько изменений.</span><span class="sxs-lookup"><span data-stu-id="9634c-367">In the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver, a number of changes have been made to various functions to support the **xml** data type.</span></span>  
  
### <a name="sqlcolattribute"></a><span data-ttu-id="9634c-368">SQLColAttribute</span><span class="sxs-lookup"><span data-stu-id="9634c-368">SQLColAttribute</span></span>  
 <span data-ttu-id="9634c-369">Функция [SQLColAttribute](../../native-client-odbc-api/sqlcolattribute.md) имеет три новых идентификатора полей, включая SQL_CA_SS_XML_SCHEMACOLLECTION_CATALOG_NAME, SQL_CA_SS_XML_SCHEMACOLLECTION_SCHEMA_NAME и SQL_CA_SS _XML_SCHEMACOLLECTION_NAME.</span><span class="sxs-lookup"><span data-stu-id="9634c-369">The [SQLColAttribute](../../native-client-odbc-api/sqlcolattribute.md) function has three new field identifiers, including SQL_CA_SS_XML_SCHEMACOLLECTION_CATALOG_NAME, SQL_CA_SS_XML_SCHEMACOLLECTION_SCHEMA_NAME, and SQL_CA_SS _XML_SCHEMACOLLECTION_NAME.</span></span>  
  
 <span data-ttu-id="9634c-370">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента выводит SQL_SS_LENGTH_UNLIMITED для столбцов SQL_DESC_DISPLAY_SIZE и SQL_DESC_LENGTH.</span><span class="sxs-lookup"><span data-stu-id="9634c-370">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver reports SQL_SS_LENGTH_UNLIMITED for the SQL_DESC_DISPLAY_SIZE and SQL_DESC_LENGTH columns.</span></span>  
  
### <a name="sqlcolumns"></a><span data-ttu-id="9634c-371">SQLColumns</span><span class="sxs-lookup"><span data-stu-id="9634c-371">SQLColumns</span></span>  
 <span data-ttu-id="9634c-372">Функция [SQLColumns](../../native-client-odbc-api/sqlcolumns.md) содержит три новых столбца, включая SS_XML_SCHEMACOLLECTION_CATALOG_NAME, SS_XML_SCHEMACOLLECTION_SCHEMA_NAME и SS_XML_SCHEMACOLLECTION_NAME.</span><span class="sxs-lookup"><span data-stu-id="9634c-372">The [SQLColumns](../../native-client-odbc-api/sqlcolumns.md) function has three new columns including SS_XML_SCHEMACOLLECTION_CATALOG_NAME, SS_XML_SCHEMACOLLECTION_SCHEMA_NAME, and SS_XML_SCHEMACOLLECTION_NAME.</span></span> <span data-ttu-id="9634c-373">Существующий столбец TYPE_NAME используется для обозначения имени типа XML, а значение DATA_TYPE для столбца или параметра типа XML равно SQL_SS_XML.</span><span class="sxs-lookup"><span data-stu-id="9634c-373">The existing TYPE_NAME column is used to indicate the name of the XML type, and the DATA_TYPE for a XML type column or parameter is SQL_SS_XML.</span></span>  
  
 <span data-ttu-id="9634c-374">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента выводит SQL_SS_LENGTH_UNLIMITED для значений COLUMN_SIZE и CHAR_OCTET_LENGTH.</span><span class="sxs-lookup"><span data-stu-id="9634c-374">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver reports SQL_SS_LENGTH_UNLIMITED for the COLUMN_SIZE and CHAR_OCTET_LENGTH values.</span></span>  
  
### <a name="sqldescribecol"></a><span data-ttu-id="9634c-375">SQLDescribeCol</span><span class="sxs-lookup"><span data-stu-id="9634c-375">SQLDescribeCol</span></span>  
 <span data-ttu-id="9634c-376">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента сообщает SQL_SS_LENGTH_UNLIMITED, если размер столбца не может быть определен в функции [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) .</span><span class="sxs-lookup"><span data-stu-id="9634c-376">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver reports SQL_SS_LENGTH_UNLIMITED when the column size cannot be determined in the [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) function.</span></span>  
  
### <a name="sqlgettypeinfo"></a><span data-ttu-id="9634c-377">SQLGetTypeInfo</span><span class="sxs-lookup"><span data-stu-id="9634c-377">SQLGetTypeInfo</span></span>  
 <span data-ttu-id="9634c-378">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента выводит SQL_SS_LENGTH_UNLIMITED в качестве максимального COLUMN_SIZE для типа данных **XML** в функции [SQLGetTypeInfo](../../native-client-odbc-api/sqlgettypeinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="9634c-378">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver reports SQL_SS_LENGTH_UNLIMITED as the maximum COLUMN_SIZE for the **xml** data type in the [SQLGetTypeInfo](../../native-client-odbc-api/sqlgettypeinfo.md) function.</span></span>  
  
### <a name="sqlprocedurecolumns"></a><span data-ttu-id="9634c-379">SQLProcedureColumns</span><span class="sxs-lookup"><span data-stu-id="9634c-379">SQLProcedureColumns</span></span>  
 <span data-ttu-id="9634c-380">Функция [SQLProcedureColumns](../../native-client-odbc-api/sqlprocedurecolumns.md) имеет те же дополнения к столбцам, что и функция **SQLColumns** .</span><span class="sxs-lookup"><span data-stu-id="9634c-380">The [SQLProcedureColumns](../../native-client-odbc-api/sqlprocedurecolumns.md) function has the same column additions as the **SQLColumns** function.</span></span>  
  
 <span data-ttu-id="9634c-381">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента выводит SQL_SS_LENGTH_UNLIMITED в качестве максимального COLUMN_SIZE для типа данных **XML** .</span><span class="sxs-lookup"><span data-stu-id="9634c-381">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver reports SQL_SS_LENGTH_UNLIMITED as the maximum COLUMN_SIZE for the **xml** data type.</span></span>  
  
### <a name="supported-conversions"></a><span data-ttu-id="9634c-382">Поддерживаемые преобразования</span><span class="sxs-lookup"><span data-stu-id="9634c-382">Supported Conversions</span></span>  
 <span data-ttu-id="9634c-383">При преобразовании данных из типа SQL в типы языка C типы SQL_C_WCHAR, SQL_C_BINARY и SQL_C_CHAR могут быть преобразованы в SQL_SS_XML, со следующими оговорками.</span><span class="sxs-lookup"><span data-stu-id="9634c-383">When converting from SQL to C data types, SQL_C_WCHAR, SQL_C_BINARY, and SQL_C_CHAR can all be converted to SQL_SS_XML, with the following stipulations:</span></span>  
  
-   <span data-ttu-id="9634c-384">SQL_C_WCHAR: Format UTF-16, без отметки порядка следования байтов (BOM) с завершающим нулем.</span><span class="sxs-lookup"><span data-stu-id="9634c-384">SQL_C_WCHAR: Format is UTF-16, no byte-order mark (BOM), with null termination.</span></span>  
  
-   <span data-ttu-id="9634c-385">SQL_C_BINARY: Format UTF-16, без завершения null.</span><span class="sxs-lookup"><span data-stu-id="9634c-385">SQL_C_BINARY: Format is UTF-16, with no null termination.</span></span> <span data-ttu-id="9634c-386">Метка порядка байтов (BOM) добавляется к данным, получаемым с сервера.</span><span class="sxs-lookup"><span data-stu-id="9634c-386">A BOM is added to data received from the server.</span></span> <span data-ttu-id="9634c-387">Если сервер вернул пустую строку, метка порядка байтов все равно будет возвращена приложению.</span><span class="sxs-lookup"><span data-stu-id="9634c-387">If an empty string is returned by the server a BOM is still returned to the application.</span></span> <span data-ttu-id="9634c-388">Если длина буфера представляет собой нечетное число байтов, данные усекаются правильно.</span><span class="sxs-lookup"><span data-stu-id="9634c-388">If the buffer length is an odd number of bytes the data ise truncated correctly.</span></span> <span data-ttu-id="9634c-389">Если все значение возвращается по фрагментам данных, их можно объединить для восстановления правильного значения.</span><span class="sxs-lookup"><span data-stu-id="9634c-389">If the whole value is returned in chunks they can be concatenated to re-constitute the correct value</span></span>  
  
-   <span data-ttu-id="9634c-390">SQL_C_CHAR: формат многобайтовых символов кодируется в кодовой странице клиента с завершающим нулем.</span><span class="sxs-lookup"><span data-stu-id="9634c-390">SQL_C_CHAR: Format is multibyte characters encoded in client code page with null termination.</span></span> <span data-ttu-id="9634c-391">Преобразование из переданной с сервера кодировки UTF-16 может вызвать повреждение данных, поэтому такую привязку крайне не рекомендуется использовать.</span><span class="sxs-lookup"><span data-stu-id="9634c-391">Conversion from server supplied UTF-16 may cause data corruption, so this binding is strongly discouraged.</span></span>  
  
 <span data-ttu-id="9634c-392">При преобразовании данных из типов языка С в типы SQL типы SQL_C_WCHAR, SQL_C_BINARY и SQL_C_CHAR могут быть преобразованы в SQL_SS_XML, со следующими оговорками.</span><span class="sxs-lookup"><span data-stu-id="9634c-392">When converting from C to SQL data types, SQL_C_WCHAR, SQL_C_BINARY, and SQL_C_CHAR can all be converted to SQL_SS_XML, with the following stipulations:</span></span>  
  
-   <span data-ttu-id="9634c-393">SQL_C_WCHAR: в данные, отправляемые на сервер, всегда добавляется спецификация.</span><span class="sxs-lookup"><span data-stu-id="9634c-393">SQL_C_WCHAR: A BOM is always be added to data sent to the server.</span></span> <span data-ttu-id="9634c-394">Если в начале данных уже стоит метка порядка следования байтов, то в начале буфера будет две метки порядка следования байтов.</span><span class="sxs-lookup"><span data-stu-id="9634c-394">If the data already started with a BOM, this results in two BOMs at the start of the buffer.</span></span> <span data-ttu-id="9634c-395">Сервер использует первую метку для распознавания кодировки как UTF-16, а затем отбрасывает ее.</span><span class="sxs-lookup"><span data-stu-id="9634c-395">The server uses the first BOM to recognize the encoding as UTF-16 and then discard it.</span></span> <span data-ttu-id="9634c-396">Вторая метка порядка следования байтов рассматривается как символ неразрывного пробела нулевой ширины.</span><span class="sxs-lookup"><span data-stu-id="9634c-396">The second BOM is interpreted as a zero-width nonbreaking space character.</span></span>  
  
-   <span data-ttu-id="9634c-397">SQL_C_BINARY: преобразование не выполняется, и данные передаются на сервер "как есть".</span><span class="sxs-lookup"><span data-stu-id="9634c-397">SQL_C_BINARY: No conversion is performed, and the data is passed to the server "as is."</span></span> <span data-ttu-id="9634c-398">Данные в формате UTF-16 должны начинаться с метки порядка байтов. Если метка отсутствует, то кодировка может быть неправильно распознана сервером.</span><span class="sxs-lookup"><span data-stu-id="9634c-398">UTF-16 data must start with a BOM; if it does not, the encoding may not be correctly recognized by the server.</span></span>  
  
-   <span data-ttu-id="9634c-399">SQL_C_CHAR: данные преобразуются в UTF-16 на клиенте и отправляются на сервер так же, как SQL_C_WCHAR (включая добавление спецификации).</span><span class="sxs-lookup"><span data-stu-id="9634c-399">SQL_C_CHAR: The data is converted to UTF-16 on the client and sent to the server just as SQL_C_WCHAR (including the addition of a BOM).</span></span> <span data-ttu-id="9634c-400">Если кодировка XML не совпадает с клиентской кодовой страницей, это может привести к повреждению данных.</span><span class="sxs-lookup"><span data-stu-id="9634c-400">If the XML is not encoded in the client code page this can cause data corruption.</span></span>  
  
 <span data-ttu-id="9634c-401">Согласно стандарту XML, XML-документы в кодировке UTF-16 должны начинаться с метки порядка следования байтов (BOM); в UTF-16 это код символа 0xFEFF.</span><span class="sxs-lookup"><span data-stu-id="9634c-401">The XML standard requires UTF-16 encoded XML to start with a byte-order mark (BOM), UTF-16 character code 0xFEFF.</span></span> <span data-ttu-id="9634c-402">При работе с привязкой SQL_C_BINARY [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client не требует и не добавляет спецификацию, так как кодировка подразумевается привязкой.</span><span class="sxs-lookup"><span data-stu-id="9634c-402">When working with a SQL_C_BINARY binding, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client does not require or add a BOM, as the encoding is implied by the binding.</span></span> <span data-ttu-id="9634c-403">Целью является предоставить возможности для наиболее простого взаимодействия с другими обработчиками XML и хранилищами данных.</span><span class="sxs-lookup"><span data-stu-id="9634c-403">The intent is to provide simplicity in dealing with other XML processors and storage systems.</span></span> <span data-ttu-id="9634c-404">В этом случае в XML с кодировкой UTF-16 нужно включить метку порядка байтов, и приложение может не заботиться о том, какова на самом деле кодировка данных, потому что большинство обработчиков XML (в том числе [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]) выяснят кодировку по нескольким первым байтам данных.</span><span class="sxs-lookup"><span data-stu-id="9634c-404">In this case a BOM should be present with UTF-16 encoded XML, and the application need not be concerned with the actual encoding, because the majority of XML processors (including [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]) deduce the encoding by inspecting the first few bytes of the value.</span></span> <span data-ttu-id="9634c-405">XML-данные, полученные от [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] собственного клиента с помощью привязок SQL_C_BINARY, всегда кодируются в кодировке UTF – 16 с помощью BOM и без внедренного объявления кодировки.</span><span class="sxs-lookup"><span data-stu-id="9634c-405">XML data received from [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client using SQL_C_BINARY bindings are always encoded in UTF-16 with a BOM and without an embedded encoding declaration.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9634c-406">См. также:</span><span class="sxs-lookup"><span data-stu-id="9634c-406">See Also</span></span>  
 <span data-ttu-id="9634c-407">[Компоненты собственного клиента SQL Server](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="9634c-407">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="9634c-408">ISSCommandWithParameters (OLE DB)</span><span class="sxs-lookup"><span data-stu-id="9634c-408">ISSCommandWithParameters &#40;OLE DB&#41;</span></span>](../../native-client-ole-db-interfaces/isscommandwithparameters-ole-db.md)  
  
  
