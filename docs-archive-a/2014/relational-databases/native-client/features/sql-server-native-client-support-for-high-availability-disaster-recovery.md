---
title: SQL Server Native Client поддержка высокого уровня доступности, аварийного восстановления | Документация Майкрософт
ms.custom: ''
ms.date: 08/31/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
ms.assetid: 2b06186b-4090-4728-b96b-90d6ebd9f66f
author: rothja
ms.author: jroth
ms.openlocfilehash: 43c835d5c0e1c064387aee7fb0db65f577c3aa26
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87667698"
---
# <a name="sql-server-native-client-support-for-high-availability-disaster-recovery"></a><span data-ttu-id="0eb45-102">Поддержка высокого уровня доступности и аварийного восстановления собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="0eb45-102">SQL Server Native Client Support for High Availability, Disaster Recovery</span></span>
  <span data-ttu-id="0eb45-103">В этом разделе описывается поддержка Native Client [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (начиная с версии [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]) для [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0eb45-103">This topic discusses [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client support (added in [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]) for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="0eb45-104">Дополнительные сведения о [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] см. в разделах [Прослушиватели групп доступности, возможность подключения клиентов и отработка отказа приложений (SQL Server)](../../../database-engine/listeners-client-connectivity-application-failover.md), [Создание и настройка групп доступности (SQL Server)](../../../database-engine/availability-groups/windows/creation-and-configuration-of-availability-groups-sql-server.md), [Отказоустойчивая кластеризация и группы доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md) и [Активные вторичные реплики. Доступ только для чтения к вторичным репликам (группы доступности AlwaysOn)](../../../database-engine/availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="0eb45-104">For more information about [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../../database-engine/listeners-client-connectivity-application-failover.md), [Creation and Configuration of Availability Groups &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/creation-and-configuration-of-availability-groups-sql-server.md), [Failover Clustering and AlwaysOn Availability Groups &#40;SQL Server&#41;](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md), and [Active Secondaries: Readable Secondary Replicas (AlwaysOn Availability Groups)](../../../database-engine/availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md).</span></span>  
  
 <span data-ttu-id="0eb45-105">Прослушиватель для заданной группы доступности можно задать в строке подключения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-105">You can specify the availability group listener of a given availability group in the connection string.</span></span> <span data-ttu-id="0eb45-106">Если приложение Native Client [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] подключено к базе данных в группе доступности, которая выполняет переход на другой ресурс, то исходное соединение является разорванным, а приложение должно установить новое соединение, чтобы продолжить работу после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="0eb45-106">If a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client application is connected to a database in an availability group that fails over, the original connection is broken, and the application must open a new connection to continue work after the failover.</span></span>  
  
 <span data-ttu-id="0eb45-107">Если соединение с прослушивателем группы доступности не будет установлено, а с именем узла связано несколько IP-адресов, то собственный клиент Native Client [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] последовательно переберет все IP-адреса, связанные с записью DNS.</span><span class="sxs-lookup"><span data-stu-id="0eb45-107">If you are not connecting to an availability group listener, and if multiple IP addresses are associated with a hostname, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will iterate sequentially through all IP addresses associated with DNS entry.</span></span> <span data-ttu-id="0eb45-108">Это может занять много времени, если первый IP-адрес, возвращенный DNS-сервером, не привязан ни к одной из сетевых интерфейсных плат.</span><span class="sxs-lookup"><span data-stu-id="0eb45-108">This can be time consuming if the first IP address returned by DNS server is not bound to any network interface card (NIC).</span></span> <span data-ttu-id="0eb45-109">При установлении соединения с прослушивателем группы доступности [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client пытается установить соединения со всеми IP-адресами параллельно. Если одна из попыток соединения завершается успешно, то все остальные производимые попытки соединения отменяются.</span><span class="sxs-lookup"><span data-stu-id="0eb45-109">When connecting to an availability group listener, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client attempts to establish connections to all IP addresses in parallel and if a connection attempt succeeds, the driver will discard any pending connection attempts.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0eb45-110">Увеличение времени ожидания соединения и реализация логики повторного соединения позволяют повысить вероятность соединения приложения с группой доступности.</span><span class="sxs-lookup"><span data-stu-id="0eb45-110">Increasing connection timeout and implementing connection retry logic will increase the probability that an application will connect to an availability group.</span></span> <span data-ttu-id="0eb45-111">Кроме того, в связи с возможностью неудачного подключения при отработке отказа группы доступности следует реализовать логику повторного соединения, обеспечивающую неограниченное число попыток соединения до достижения успеха.</span><span class="sxs-lookup"><span data-stu-id="0eb45-111">Also, because a connection can fail because of an availability group failover, you should implement connection retry logic, retrying a failed connection until it reconnects.</span></span>  
  
## <a name="connecting-with-multisubnetfailover"></a><span data-ttu-id="0eb45-112">Соединение с помощью MultiSubnetFailover</span><span class="sxs-lookup"><span data-stu-id="0eb45-112">Connecting With MultiSubnetFailover</span></span>  
 <span data-ttu-id="0eb45-113">При установлении соединения с прослушивателем группы доступности SQL Server 2012 или экземпляром отказоустойчивого кластера SQL Server 2012 всегда необходимо указывать `MultiSubnetFailover=Yes`.</span><span class="sxs-lookup"><span data-stu-id="0eb45-113">Always specify `MultiSubnetFailover=Yes` when connecting to a SQL Server 2012 availability group listener or SQL Server 2012 Failover Cluster Instance.</span></span> <span data-ttu-id="0eb45-114">`MultiSubnetFailover` дает возможность группам доступности и экземпляру отказоустойчивого кластера в SQL Server 2012 быстрее выполнить отработку отказа, а также значительно сократить время перехода на другой ресурс для топологий AlwaysOn с одной или несколькими подсетями.</span><span class="sxs-lookup"><span data-stu-id="0eb45-114">`MultiSubnetFailover` enables faster failover for all Availability Groups and failover cluster instance in SQL Server 2012 and will significantly reduce failover time for single and multi-subnet AlwaysOn topologies.</span></span> <span data-ttu-id="0eb45-115">При отработке отказа с в нескольких подсетях клиент будет выполнять попытки соединения параллельно.</span><span class="sxs-lookup"><span data-stu-id="0eb45-115">During a multi-subnet failover, the client will attempt connections in parallel.</span></span> <span data-ttu-id="0eb45-116">Во время отработки отказа в подсети собственный клиент [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] будет активно выполнять попытки повторного TCP-соединения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-116">During a subnet failover, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will aggressively retry the TCP connection.</span></span>  
  
 <span data-ttu-id="0eb45-117">Свойство соединения `MultiSubnetFailover` указывает, что приложение развертывается в группе доступности или на экземпляре отказоустойчивого кластера, а также что собственный клиент [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client выполнит попытку соединения с базой данных в основном экземпляре [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], попытавшись установить соединение со всеми IP-адресами группы доступности.</span><span class="sxs-lookup"><span data-stu-id="0eb45-117">The `MultiSubnetFailover` connection property indicates that the application is being deployed in an availability group or Failover Cluster Instance, and that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will try to connect to the database on the primary [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance by trying to connect to all the IP addresses.</span></span> <span data-ttu-id="0eb45-118">Если `MultiSubnetFailover=Yes` для соединения задано значение, клиент повторяет попытки TCP-подключения быстрее, чем интервалы повторной передачи TCP по умолчанию для операционной системы.</span><span class="sxs-lookup"><span data-stu-id="0eb45-118">When `MultiSubnetFailover=Yes` is specified for a connection, the client retries TCP connection attempts faster than the operating system's default TCP retransmit intervals.</span></span> <span data-ttu-id="0eb45-119">Это позволяет ускорить восстановление соединения после отработки отказа в группе доступности AlwaysOn или в экземпляре отказоустойчивого кластера AlwaysOn; метод может применяться к группам доступности и экземплярам отказоустойчивых кластеров как с одной, так и с несколькими подсетями.</span><span class="sxs-lookup"><span data-stu-id="0eb45-119">This enables faster reconnection after failover of either an AlwaysOn Availability Group or an AlwaysOn Failover Cluster Instance, and is applicable to both single- and multi-subnet Availability Groups and Failover Cluster Instances.</span></span>  
  
 <span data-ttu-id="0eb45-120">Дополнительные сведения о ключевых словах строки подключения см. в статье [Использование ключевых слов строки подключения с SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span><span class="sxs-lookup"><span data-stu-id="0eb45-120">For more information about connection string keywords, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="0eb45-121">Указание параметра `MultiSubnetFailover=Yes` при соединении с объектом, отличным от прослушивателя группы доступности или экземпляра отказоустойчивого кластера, может привести к снижению производительности и не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="0eb45-121">Specifying `MultiSubnetFailover=Yes` when connecting to something other than an availability group listener or Failover Cluster Instance may result in a negative performance impact, and is not supported.</span></span>  
  
 <span data-ttu-id="0eb45-122">Следуйте приведенным ниже рекомендациям для подключения к серверу в группе доступности или экземпляру отказоустойчивого кластера.</span><span class="sxs-lookup"><span data-stu-id="0eb45-122">Use the following guidelines to connect to a server in an availability group or Failover Cluster Instance:</span></span>  
  
-   <span data-ttu-id="0eb45-123">Используйте свойство соединения `MultiSubnetFailover` при установке соединения с одной подсетью или с несколькими подсетями; производительность возрастет в любом случае.</span><span class="sxs-lookup"><span data-stu-id="0eb45-123">Use the `MultiSubnetFailover` connection property when connecting to a single subnet or multi-subnet; it will improve performance for both.</span></span>  
  
-   <span data-ttu-id="0eb45-124">Чтобы установить соединение с группой доступности, указывайте ее прослушиватель в строке подключения вместо сервера.</span><span class="sxs-lookup"><span data-stu-id="0eb45-124">To connect to an availability group, specify the availability group listener of the availability group as the server in your connection string.</span></span>  
  
-   <span data-ttu-id="0eb45-125">При установлении соединения с экземпляром [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], настроенным на работу с более чем 64 IP-адресами, будет возникать ошибка соединения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-125">Connecting to a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance configured with more than 64 IP addresses will cause a connection failure.</span></span>  
  
-   <span data-ttu-id="0eb45-126">Поведение приложения, использующего свойство Connection, не зависит от типа проверки подлинности: проверка подлинности, проверка подлинности `MultiSubnetFailover` [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Kerberos или проверка подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="0eb45-126">Behavior of an application that uses the `MultiSubnetFailover` connection property is not affected based on the type of authentication: [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Authentication, Kerberos Authentication, or Windows Authentication.</span></span>  
  
-   <span data-ttu-id="0eb45-127">Значение `loginTimeout` можно увеличить с учетом времени отработки отказа, это уменьшит количество попыток повторного соединения в приложениях.</span><span class="sxs-lookup"><span data-stu-id="0eb45-127">You can increase the value of `loginTimeout` to accommodate for failover time and reduce application connection retry attempts.</span></span>  
  
-   <span data-ttu-id="0eb45-128">Распределенные транзакции не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="0eb45-128">Distributed transactions are not supported.</span></span>  
  
 <span data-ttu-id="0eb45-129">Если маршрутизация только для чтения неактивна, то подключение к местоположению вторичной реплики в группе доступности завершится ошибкой в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="0eb45-129">If read-only routing is not in effect, connecting to a secondary replica location in an availability group will fail in the following situations:</span></span>  
  
1.  <span data-ttu-id="0eb45-130">Если местоположение вторичных реплик не настроено для приема подключений.</span><span class="sxs-lookup"><span data-stu-id="0eb45-130">If the secondary replica location is not configured to accept connections.</span></span>  
  
2.  <span data-ttu-id="0eb45-131">Если приложение использует свойство `ApplicationIntent=ReadWrite` (которое обсуждается ниже) и местоположение дополнительных реплик настроено для доступа только для чтения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-131">If an application uses `ApplicationIntent=ReadWrite` (discussed below) and the secondary replica location is configured for read-only access.</span></span>  
  
 <span data-ttu-id="0eb45-132">При соединении произойдет ошибка, если первичная реплика настроена для отклонения рабочих нагрузок только для чтения, а строка подключения содержит `ApplicationIntent=ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="0eb45-132">A connection will fail if a primary replica is configured to reject read-only workloads and the connection string contains `ApplicationIntent=ReadOnly`.</span></span>  
  
## <a name="upgrading-to-use-multi-subnet-clusters-from-database-mirroring"></a><span data-ttu-id="0eb45-133">Переход с зеркального отображения базы данных на использование кластеров с несколькими подсетями</span><span class="sxs-lookup"><span data-stu-id="0eb45-133">Upgrading to Use Multi-Subnet Clusters from Database Mirroring</span></span>  
 <span data-ttu-id="0eb45-134">Если в строке подключения содержатся ключевые слова `MultiSubnetFailover` и `Failover_Partner`, то при соединении произойдет ошибка.</span><span class="sxs-lookup"><span data-stu-id="0eb45-134">A connection error will occur if the `MultiSubnetFailover` and `Failover_Partner` connection keywords are present in the connection string.</span></span> <span data-ttu-id="0eb45-135">Ошибка возникает также в том случае, если используется `MultiSubnetFailover` и [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] возвращает ответ партнер по обеспечению отработки отказа, указывающего на то, что он является частью пары зеркального отображения базы данных.</span><span class="sxs-lookup"><span data-stu-id="0eb45-135">An error will also occur if `MultiSubnetFailover` is used and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] returns a failover partner response indicating it is part of a database mirroring pair.</span></span>  
  
 <span data-ttu-id="0eb45-136">Если производится обновление приложения собственного клиента Native Client [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], в котором в данный момент используется зеркальное отображение базы данных в сценарии с несколькими подсетями, то следует удалить свойство соединения `Failover_Partner` и заменить его свойством `MultiSubnetFailover` со значением `Yes`, а также заменить имя сервера в строке подключения на имя прослушивателя группы доступности.</span><span class="sxs-lookup"><span data-stu-id="0eb45-136">If you upgrade a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client application that currently uses database mirroring to a multi-subnet scenario, you should remove the `Failover_Partner` connection property and replace it with `MultiSubnetFailover` set to `Yes` and replace the server name in the connection string with an availability group listener.</span></span> <span data-ttu-id="0eb45-137">Если в строке подключения используются `Failover_Partner` и `MultiSubnetFailover=Yes`, то драйвер выдаст ошибку.</span><span class="sxs-lookup"><span data-stu-id="0eb45-137">If a connection string uses `Failover_Partner` and `MultiSubnetFailover=Yes`, the driver will generate an error.</span></span> <span data-ttu-id="0eb45-138">Но если в строке подключения используются параметры `Failover_Partner` и `MultiSubnetFailover=No` (или `ApplicationIntent=ReadWrite`), то приложение будет использовать зеркальное отображение базы данных.</span><span class="sxs-lookup"><span data-stu-id="0eb45-138">However, if a connection string uses `Failover_Partner` and `MultiSubnetFailover=No` (or `ApplicationIntent=ReadWrite`), the application will use database mirroring.</span></span>  
  
 <span data-ttu-id="0eb45-139">Если в базе данных-источнике группы доступности используется зеркальное отображение баз данных, то драйвер вернет ошибку. Это также произойдет в том случае, если используется параметр `MultiSubnetFailover=Yes` в строке подключения, устанавливающей соединение с базой данных-источником, а не с прослушивателем группы доступности.</span><span class="sxs-lookup"><span data-stu-id="0eb45-139">The driver will return an error if database mirroring is used on the primary database in the availability group, and if `MultiSubnetFailover=Yes` is used in the connection string that connects to a primary database instead of to an availability group listener.</span></span>  
  
## <a name="specifying-application-intent"></a><span data-ttu-id="0eb45-140">Задание намерения приложения</span><span class="sxs-lookup"><span data-stu-id="0eb45-140">Specifying Application Intent</span></span>  
 <span data-ttu-id="0eb45-141">При указании параметра `ApplicationIntent=ReadOnly` клиент запросит рабочую нагрузку чтения при установлении соединения с базой данных с поддержкой AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="0eb45-141">When `ApplicationIntent=ReadOnly`, the client requests a read workload when connecting to an AlwaysOn enabled database.</span></span> <span data-ttu-id="0eb45-142">Сервер принудительно реализует намерение в момент соединения и во время выполнения инструкции USE database, но только в базе данных с поддержкой Always On.</span><span class="sxs-lookup"><span data-stu-id="0eb45-142">The server will enforce the intent at connection time and during a USE database statement but only to an Always On enabled database.</span></span>  
  
 <span data-ttu-id="0eb45-143">Ключевое слово `ApplicationIntent` не работает с базами данных прежних версий, доступными только для чтения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-143">The `ApplicationIntent` keyword does not work with legacy, read-only databases.</span></span>  
  
 <span data-ttu-id="0eb45-144">База данных может допускать или не допускать рабочую нагрузку чтения для целевой базы данных AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="0eb45-144">A database can allow or disallow read workloads on the targeted AlwaysOn database.</span></span> <span data-ttu-id="0eb45-145">(Это выполняется с помощью предложения `ALLOW_CONNECTIONS` инструкций `PRIMARY_ROLE` и `SECONDARY_ROLE`[!INCLUDE[tsql](../../../includes/tsql-md.md)].)</span><span class="sxs-lookup"><span data-stu-id="0eb45-145">(This is done with the `ALLOW_CONNECTIONS` clause of the `PRIMARY_ROLE` and `SECONDARY_ROLE`[!INCLUDE[tsql](../../../includes/tsql-md.md)] statements.)</span></span>  
  
 <span data-ttu-id="0eb45-146">Ключевое слово `ApplicationIntent` служит для включения маршрутизации только для чтения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-146">The `ApplicationIntent` keyword is used to enable read-only routing.</span></span>  
  
## <a name="read-only-routing"></a><span data-ttu-id="0eb45-147">Маршрутизация только для чтения</span><span class="sxs-lookup"><span data-stu-id="0eb45-147">Read-Only Routing</span></span>  
 <span data-ttu-id="0eb45-148">Маршрутизация только для чтения — это функция, которая может обеспечить доступность реплики базы данных, доступной только для чтения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-148">Read-only routing is a feature that can ensure the availability of a read only replica of a database.</span></span> <span data-ttu-id="0eb45-149">Включение маршрутизации только для чтения</span><span class="sxs-lookup"><span data-stu-id="0eb45-149">To enable read-only routing:</span></span>  
  
1.  <span data-ttu-id="0eb45-150">Необходимо установить соединение с прослушивателем группы доступности Always On.</span><span class="sxs-lookup"><span data-stu-id="0eb45-150">You must connect to an Always On Availability Group availability group listener.</span></span>  
  
2.  <span data-ttu-id="0eb45-151">Ключевое слово `ApplicationIntent` строки подключения должно быть установлено в значение `ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="0eb45-151">The `ApplicationIntent` connection string keyword must be set to `ReadOnly`.</span></span>  
  
3.  <span data-ttu-id="0eb45-152">Группа доступности должна быть настроена администратором базы данных на поддержку маршрутизации только для чтения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-152">The Availability Group must be configured by the database administrator to enable read-only routing.</span></span>  
  
 <span data-ttu-id="0eb45-153">Возможно, что не все из нескольких соединений, использующих маршрутизацию только для чтения, будут подключаться к одной и той же реплике только для чтения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-153">It is possible that multiple connections using read-only routing will not all connect to the same read-only replica.</span></span> <span data-ttu-id="0eb45-154">Изменения в синхронизации баз данных или в конфигурации маршрутизации сервера могут привести к тому, что клиент будет подключаться к различным репликам только для чтения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-154">Changes in database synchronization or changes in the server's routing configuration can result in client connections to different read-only replicas.</span></span> <span data-ttu-id="0eb45-155">Чтобы гарантировать, что все запросы на подключение только для чтения будут соединяться с одной и той же репликой только для чтения, не указывайте прослушиватель группы доступности в ключевом слове строки подключения `Server`.</span><span class="sxs-lookup"><span data-stu-id="0eb45-155">To ensure that all read-only requests connect to the same read-only replica, do not pass an availability group listener to the `Server` connection string keyword.</span></span> <span data-ttu-id="0eb45-156">Вместо этого укажите имя экземпляра, доступного только для чтения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-156">Instead, specify the name of the read-only instance.</span></span>  
  
 <span data-ttu-id="0eb45-157">На маршрутизацию только для чтения может потребоваться больше времени, чем на подключение к первичной реплике, поскольку маршрутизация только для чтения предусматривает прежде всего подключение к первичной реплике, а затем поиск наиболее подходящей доступной для чтения вторичной реплики.</span><span class="sxs-lookup"><span data-stu-id="0eb45-157">Read-only routing may take longer than connecting to the primary because read only routing first connects to the primary and then looks for the best available readable secondary.</span></span> <span data-ttu-id="0eb45-158">Учитывая этот факт, следует увеличить время ожидания входа в систему.</span><span class="sxs-lookup"><span data-stu-id="0eb45-158">Because of this, you should increase your login timeout.</span></span>  
  
## <a name="odbc"></a><span data-ttu-id="0eb45-159">ODBC</span><span class="sxs-lookup"><span data-stu-id="0eb45-159">ODBC</span></span>  
 <span data-ttu-id="0eb45-160">Для поддержки [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] в собственном клиенте Native Client [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] были добавлены два ключевых слова строки подключения ODBC:</span><span class="sxs-lookup"><span data-stu-id="0eb45-160">Two ODBC connection string keywords were added to support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client:</span></span>  
  
-   `ApplicationIntent`  
  
-   `MultiSubnetFailover`  
  
 <span data-ttu-id="0eb45-161">Дополнительные сведения о ключевых словах строки подключения ODBC в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client см. в статье [Использование ключевых слов строки подключения с SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span><span class="sxs-lookup"><span data-stu-id="0eb45-161">For more information about ODBC connection string keywords in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="0eb45-162">Эквивалентными свойствами соединения являются следующие:</span><span class="sxs-lookup"><span data-stu-id="0eb45-162">The equivalent connection properties are:</span></span>  
  
-   `SQL_COPT_SS_APPLICATION_INTENT`  
  
-   `SQL_COPT_SS_MULTISUBNET_FAILOVER`  
  
 <span data-ttu-id="0eb45-163">Дополнительные сведения о свойствах соединений ODBC в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client см. в разделе [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md).</span><span class="sxs-lookup"><span data-stu-id="0eb45-163">For more information about ODBC connection properties in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client, see [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md).</span></span>  
  
 <span data-ttu-id="0eb45-164">Возможность использования ключевых слов `ApplicationIntent` и `MultiSubnetFailover` будет доступна в администраторе источников данных ODBC для имен DSN, который использует драйвер собственного клиента Native Client [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], начиная с [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0eb45-164">The functionality of the `ApplicationIntent` and `MultiSubnetFailover` keywords will be exposed in the ODBC Data Source Administrator for DSNs that use the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client driver, beginning in [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span>  
  
 <span data-ttu-id="0eb45-165">Приложение собственного клиента ODBC [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для создания соединения может использовать одну из трех функций.</span><span class="sxs-lookup"><span data-stu-id="0eb45-165">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC application can use one of three functions to make the connection:</span></span>  
  
|<span data-ttu-id="0eb45-166">Функция</span><span class="sxs-lookup"><span data-stu-id="0eb45-166">Function</span></span>|<span data-ttu-id="0eb45-167">Описание</span><span class="sxs-lookup"><span data-stu-id="0eb45-167">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="0eb45-168">SQLBrowseConnect</span><span class="sxs-lookup"><span data-stu-id="0eb45-168">SQLBrowseConnect</span></span>](../../native-client-odbc-api/sqlbrowseconnect.md)|<span data-ttu-id="0eb45-169">Список серверов, возвращаемый `SQLBrowseConnect`, не содержит имен виртуальных сетей.</span><span class="sxs-lookup"><span data-stu-id="0eb45-169">The list of servers returned by `SQLBrowseConnect` will not include VNNs.</span></span> <span data-ttu-id="0eb45-170">Будет отображен только список серверов без указания того, является ли сервер отдельным, сервером-источником или сервером-получателем в отказоустойчивом кластере, в котором содержатся два экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], включенные для [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], или более.</span><span class="sxs-lookup"><span data-stu-id="0eb45-170">You will only see a list of servers without any indication if the server is a standalone server, or a primary or secondary server in a Windows Server Failover Clustering (WSFC) cluster that contains two or more [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances that have been enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="0eb45-171">При возникновении ошибки подключения к серверу причина может заключаться в несоответствии настройки `ApplicationIntent` конфигурации сервера.</span><span class="sxs-lookup"><span data-stu-id="0eb45-171">If you connect to a server and get a failure, it may be because you have connected to a server, and the `ApplicationIntent` setting is not compatible with the server configuration.</span></span><br /><br /> <span data-ttu-id="0eb45-172">Поскольку `SQLBrowseConnect` не распознает серверы в отказоустойчивых кластерах, содержащих два или более экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], которые были включены для [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], `SQLBrowseConnect` не учитывает ключевое слово строки подключения `MultiSubnetFailover`.</span><span class="sxs-lookup"><span data-stu-id="0eb45-172">Because `SQLBrowseConnect` does not recognize servers in a Windows Server Failover Clustering (WSFC) cluster that contains two or more [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances that have been enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], `SQLBrowseConnect` ignores the `MultiSubnetFailover` connection string keyword.</span></span>|  
|[<span data-ttu-id="0eb45-173">SQLConnect</span><span class="sxs-lookup"><span data-stu-id="0eb45-173">SQLConnect</span></span>](../../native-client-odbc-api/sqlconnect.md)|<span data-ttu-id="0eb45-174">`SQLConnect` поддерживает `ApplicationIntent` и `MultiSubnetFailover` с помощью имени DSN или свойств соединения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-174">`SQLConnect` supports both `ApplicationIntent` and `MultiSubnetFailover` via a data source name (DSN) or connection properties.</span></span>|  
|[<span data-ttu-id="0eb45-175">SQLDriverConnect</span><span class="sxs-lookup"><span data-stu-id="0eb45-175">SQLDriverConnect</span></span>](../../native-client-odbc-api/sqldriverconnect.md)|<span data-ttu-id="0eb45-176">`SQLDriverConnect` поддерживает `ApplicationIntent` и `MultiSubnetFailover` с использованием ключевых слов строки подключения, свойств соединения и имени DSN.</span><span class="sxs-lookup"><span data-stu-id="0eb45-176">`SQLDriverConnect` supports `ApplicationIntent` and `MultiSubnetFailover` via connection string keywords, connection properties, or DSN.</span></span>|  
  
## <a name="ole-db"></a><span data-ttu-id="0eb45-177">OLE DB</span><span class="sxs-lookup"><span data-stu-id="0eb45-177">OLE DB</span></span>  
 <span data-ttu-id="0eb45-178">OLE DB в собственном клиенте [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не поддерживает ключевое слово `MultiSubnetFailover`.</span><span class="sxs-lookup"><span data-stu-id="0eb45-178">OLE DB in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client does not support the `MultiSubnetFailover` keyword.</span></span>  
  
 <span data-ttu-id="0eb45-179">OLE DB в собственном клиенте [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] поддерживает назначение приложения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-179">OLE DB in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will support application intent.</span></span> <span data-ttu-id="0eb45-180">Для назначений приложений OLE DB будет поддерживаться тот же режим, что и для приложений ODBC (см. выше).</span><span class="sxs-lookup"><span data-stu-id="0eb45-180">Application intent will behave the same for OLE DB applications as ODBC applications (see above).</span></span>  
  
 <span data-ttu-id="0eb45-181">В собственном клиенте [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] для поддержки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] было добавлено одно ключевое слово строки подключения OLE DB:</span><span class="sxs-lookup"><span data-stu-id="0eb45-181">One OLE DB connection string keyword added to support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client:</span></span>  
  
-   `Application Intent`  
  
 <span data-ttu-id="0eb45-182">Дополнительные сведения о ключевых словах строки подключения в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client см. в статье [Использование ключевых слов строки подключения с SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span><span class="sxs-lookup"><span data-stu-id="0eb45-182">For more information about connection string keywords in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="0eb45-183">Эквивалентными свойствами соединения являются следующие:</span><span class="sxs-lookup"><span data-stu-id="0eb45-183">The equivalent connection properties are:</span></span>  
  
-   `SSPROP_INIT_APPLICATIONINTENT`  
  
-   `DBPROP_INIT_PROVIDERSTRING`  
  
 <span data-ttu-id="0eb45-184">В приложении собственного клиента OLE DB [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для указания назначения приложения может использоваться один из следующих методов.</span><span class="sxs-lookup"><span data-stu-id="0eb45-184">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB application can use one of the methods to specify application intent:</span></span>  
  
 `IDBInitialize::Initialize`  
 <span data-ttu-id="0eb45-185">`IDBInitialize::Initialize` использует ранее настроенный набор свойств для инициализации источника данных и создания объекта источника данных.</span><span class="sxs-lookup"><span data-stu-id="0eb45-185">`IDBInitialize::Initialize` uses the previously configured set of properties to initialize the data source and create the data source object.</span></span> <span data-ttu-id="0eb45-186">Укажите назначение приложения в качестве свойства поставщика или в виде расширенной строки свойств.</span><span class="sxs-lookup"><span data-stu-id="0eb45-186">Specify application intent as a provider property or as part of the extended properties string.</span></span>  
  
 `IDataInitialize::GetDataSource`  
 <span data-ttu-id="0eb45-187">`IDataInitialize::GetDataSource` принимает строку подключения, которая может содержать ключевое слово `Application Intent`.</span><span class="sxs-lookup"><span data-stu-id="0eb45-187">`IDataInitialize::GetDataSource` takes an input connection string that can contain the `Application Intent` keyword.</span></span>  
  
 `IDBProperties::GetProperties`  
 <span data-ttu-id="0eb45-188">`IDBProperties::GetProperties` получает значение свойства, которое в настоящее время задано для источника данных.</span><span class="sxs-lookup"><span data-stu-id="0eb45-188">`IDBProperties::GetProperties` retrieves the value of the property that is currently set on the data source.</span></span>  <span data-ttu-id="0eb45-189">Значение `Application Intent` можно получить с помощью свойств DBPROP_INIT_PROVIDERSTRING и SSPROP_INIT_APPLICATIONINTENT.</span><span class="sxs-lookup"><span data-stu-id="0eb45-189">You can retrieve the `Application Intent` value through the DBPROP_INIT_PROVIDERSTRING property and SSPROP_INIT_APPLICATIONINTENT property.</span></span>  
  
 `IDBProperties::SetProperties`  
 <span data-ttu-id="0eb45-190">Чтобы задать значение свойства `ApplicationIntent`, вызовите `IDBProperties::SetProperties`, передав свойство `SSPROP_INIT_APPLICATIONINTENT` со значением `ReadWrite` или `ReadOnly` или свойство `DBPROP_INIT_PROVIDERSTRING` со значением, содержащим `ApplicationIntent=ReadOnly` или `ApplicationIntent=ReadWrite`.</span><span class="sxs-lookup"><span data-stu-id="0eb45-190">To set the `ApplicationIntent` property value, call `IDBProperties::SetProperties` passing in the `SSPROP_INIT_APPLICATIONINTENT` property with value "`ReadWrite`" or "`ReadOnly`" or `DBPROP_INIT_PROVIDERSTRING` property with value containing "`ApplicationIntent=ReadOnly`" or "`ApplicationIntent=ReadWrite`".</span></span>  
  
 <span data-ttu-id="0eb45-191">Назначение приложения можно указать в поле "Свойства назначения приложения" на вкладке "Все" в диалоговом окне **Свойства канала передачи данных**.</span><span class="sxs-lookup"><span data-stu-id="0eb45-191">You can specify application intent in the Application Intent Properties field of the All tab in the **Data Link Properties** dialog box.</span></span>  
  
 <span data-ttu-id="0eb45-192">После установки неявных соединений эти подключения будут использовать настройку назначения приложения для родительского подключения.</span><span class="sxs-lookup"><span data-stu-id="0eb45-192">When implicit connections are established, the implicit connection will use the application intent setting of the parent connection.</span></span> <span data-ttu-id="0eb45-193">Аналогичным образом несколько сеансов, созданных с использованием одного источника данных, будут наследовать настройки назначения приложения от источника данных.</span><span class="sxs-lookup"><span data-stu-id="0eb45-193">Similarly, multiple sessions created from the same data source will inherit the data source's application intent setting.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0eb45-194">См. также:</span><span class="sxs-lookup"><span data-stu-id="0eb45-194">See Also</span></span>  
 <span data-ttu-id="0eb45-195">[Компоненты собственного клиента SQL Server](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="0eb45-195">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="0eb45-196">Использование ключевых слов строки подключения с собственным клиентом SQL Server</span><span class="sxs-lookup"><span data-stu-id="0eb45-196">Using Connection String Keywords with SQL Server Native Client</span></span>](../applications/using-connection-string-keywords-with-sql-server-native-client.md)  
  
  
