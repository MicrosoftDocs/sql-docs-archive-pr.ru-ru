---
title: Работа с уведомлениями о запросах | Документация Майкрософт
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], query notifications
- rowsets [SQL Server], notifications
- SQL Server Native Client, query notifications
- notifications [SQL Server Native Client]
- query notifications [SQL Server], SQL Server Native Client
- canceling rowset changes
- IRowsetNotify interface
- SQLNCLI, query notifications
- SQL Server Native Client OLE DB provider, query notifications
- consumer notification for rowset changes [SQL Server Native Client]
ms.assetid: 2f906fff-5ed9-4527-9fd3-9c0d27c3dff7
author: rothja
ms.author: jroth
ms.openlocfilehash: ba30bfc8df05a55e297ae8fcb8e2253de57e3ca6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87666528"
---
# <a name="working-with-query-notifications"></a><span data-ttu-id="a6047-102">Работа с уведомлениями запросов</span><span class="sxs-lookup"><span data-stu-id="a6047-102">Working with Query Notifications</span></span>
  <span data-ttu-id="a6047-103">Уведомления о запросах появились в [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] и в собственном клиенте [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a6047-103">Query notifications were introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span></span> <span data-ttu-id="a6047-104">С помощью уведомлений о запросах, построенных на основе инфраструктуры компонента Service Broker, представленной в [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], приложения могут получать извещения об изменениях данных.</span><span class="sxs-lookup"><span data-stu-id="a6047-104">Built upon the Service Broker infrastructure introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], query notifications allow applications to be notified when data has changed.</span></span> <span data-ttu-id="a6047-105">Эта функция особенно полезна для приложений, которые предоставляют кэш данных из базы данных (например, для веб-приложений), и которым требуются уведомления об изменении исходных данных.</span><span class="sxs-lookup"><span data-stu-id="a6047-105">This feature is particularly useful for applications that provide a cache of information from a database, such as a Web application, and need to be notified when the source data is changed.</span></span>  
  
 <span data-ttu-id="a6047-106">С помощью уведомлений о запросах можно запрашивать уведомления в течение указанного времени ожидания при изменении базовых данных запроса.</span><span class="sxs-lookup"><span data-stu-id="a6047-106">Query notifications allow you to request notification within a specified time-out period when the underlying data of a query changes.</span></span> <span data-ttu-id="a6047-107">В запросе на уведомление указываются параметры уведомления, среди которых имя службы, текст сообщения и значение времени ожидания для сервера.</span><span class="sxs-lookup"><span data-stu-id="a6047-107">The request for notification specifies the notification options, which include the service name, message text, and time-out value to the server.</span></span> <span data-ttu-id="a6047-108">Доставка уведомлений осуществляется через очередь компонента SQL Service Broker, которую приложения могут опрашивать на предмет имеющихся уведомлений.</span><span class="sxs-lookup"><span data-stu-id="a6047-108">Notifications are delivered through a Service Broker queue that applications may poll for available notifications.</span></span>  
  
 <span data-ttu-id="a6047-109">Строка параметров уведомлений запросов имеет следующий синтаксис.</span><span class="sxs-lookup"><span data-stu-id="a6047-109">The syntax of the query notifications options string is:</span></span>  
  
 `service=<service-name>[;(local database=<database> | broker instance=<broker instance>)]`  
  
 <span data-ttu-id="a6047-110">Пример:</span><span class="sxs-lookup"><span data-stu-id="a6047-110">For example:</span></span>  
  
 `service=mySSBService;local database=mydb`  
  
 <span data-ttu-id="a6047-111">Подписки на уведомления переживают процесс, который их инициирует, поскольку приложение может создать подписку на уведомление, а затем завершиться.</span><span class="sxs-lookup"><span data-stu-id="a6047-111">Notification subscriptions outlive the process that initiates them, as an application may create a notification subscription and then terminate.</span></span> <span data-ttu-id="a6047-112">Подписка остается действительной, а уведомление будет отправлено в случае изменения данных в течение времени ожидания, указанного при создании подписки.</span><span class="sxs-lookup"><span data-stu-id="a6047-112">The subscription remains valid, and the notification will occur if the data changes within the time-out period specified when the subscription was created.</span></span> <span data-ttu-id="a6047-113">Уведомление определяется выполненным запросом, параметрами уведомления, а также текстом сообщения. Его можно отменить, установив нуль в качестве значения времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="a6047-113">A notification is identified by the query executed, the notification options, and the message text, and may be cancelled by setting its time-out value to zero.</span></span>  
  
 <span data-ttu-id="a6047-114">Уведомления отправляются только один раз.</span><span class="sxs-lookup"><span data-stu-id="a6047-114">Notifications are sent only once.</span></span> <span data-ttu-id="a6047-115">Чтобы получать постоянные уведомления об изменении данных, необходимо создавать новую подписку после обработки каждого уведомления путем повторного выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="a6047-115">For continuous notification of data change, a new subscription must be created by re-executing the query after each notification is processed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="a6047-116">Собственные клиентские приложения обычно получают уведомления с помощью [!INCLUDE[tsql](../../../includes/tsql-md.md)] команды [Receive](/sql/t-sql/statements/receive-transact-sql) для чтения уведомлений из очереди, связанной со службой, указанной в параметрах уведомления.</span><span class="sxs-lookup"><span data-stu-id="a6047-116">Native Client applications typically receive notifications by using the [!INCLUDE[tsql](../../../includes/tsql-md.md)] [RECEIVE](/sql/t-sql/statements/receive-transact-sql) command to read notifications from the queue associated with the service specified in the notification options.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a6047-117">В запросах необходимо указывать имена таблиц, для которых требуется отправлять уведомления, например `dbo.myTable`.</span><span class="sxs-lookup"><span data-stu-id="a6047-117">Table names must be qualified in queries for which notification is required, for example, `dbo.myTable`.</span></span> <span data-ttu-id="a6047-118">Имена таблиц должны состоять из двух частей.</span><span class="sxs-lookup"><span data-stu-id="a6047-118">Table names must be qualified with two part names.</span></span> <span data-ttu-id="a6047-119">Подписка будет недействительной в случае использования трех- или четырехкомпонентных имен.</span><span class="sxs-lookup"><span data-stu-id="a6047-119">Subscription is invalid if three- or four-part names are used.</span></span>  
  
 <span data-ttu-id="a6047-120">Инфраструктура уведомлений построена поверх функции запросов, которая появилась в [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a6047-120">The notification infrastructure is built on top of a queuing feature introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="a6047-121">Как правило, уведомления, формируемые на сервере, отправляются через эти запросы для последующей обработки.</span><span class="sxs-lookup"><span data-stu-id="a6047-121">In general, notifications generated at the server are sent through these queues to be processed later.</span></span>  
  
 <span data-ttu-id="a6047-122">Чтобы использовать уведомления о запросах, очередь и служба должны существовать на сервере.</span><span class="sxs-lookup"><span data-stu-id="a6047-122">To use query notifications a queue and a service must exist on the server.</span></span> <span data-ttu-id="a6047-123">Их можно создать при помощи [!INCLUDE[tsql](../../../includes/tsql-md.md)] следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a6047-123">These can be created using [!INCLUDE[tsql](../../../includes/tsql-md.md)] similar to the following:</span></span>  
  
```  
CREATE QUEUE myQueue  
CREATE SERVICE myService ON QUEUE myQueue   
  
([https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification])  
```  
  
> [!NOTE]  
>  <span data-ttu-id="a6047-124">Служба должна использовать стандартный контракт `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification`, показанный выше.</span><span class="sxs-lookup"><span data-stu-id="a6047-124">The service must use the predefined contract `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification` as shown above.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="a6047-125">Поставщик OLE DB для собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="a6047-125">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="a6047-126">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Поставщик OLE DB собственного клиента поддерживает уведомление потребителя об изменении набора строк.</span><span class="sxs-lookup"><span data-stu-id="a6047-126">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports consumer notification on rowset modification.</span></span> <span data-ttu-id="a6047-127">Потребитель получает уведомление на каждой стадии изменения набора строк, а также при каждой попытке внести изменение.</span><span class="sxs-lookup"><span data-stu-id="a6047-127">The consumer receives notification at every phase of rowset modification and on any attempted change.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a6047-128">Передача запросов уведомлений на сервер с помощью метода **ICommand:: Execute** является единственным допустимым способом подписки на уведомления о запросах с помощью [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] собственного клиента OLE DB Provider.</span><span class="sxs-lookup"><span data-stu-id="a6047-128">Passing a notifications query to the server with **ICommand::Execute** is the only valid way to subscribe to query notifications with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider.</span></span>  
  
### <a name="the-dbpropset_sqlserverrowset-property-set"></a><span data-ttu-id="a6047-129">Набор свойств DBPROPSET_SQLSERVERROWSET</span><span class="sxs-lookup"><span data-stu-id="a6047-129">The DBPROPSET_SQLSERVERROWSET Property Set</span></span>  
 <span data-ttu-id="a6047-130">Для поддержки уведомлений о запросах с помощью OLE DB [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] собственный клиент добавляет следующие новые свойства в набор свойств DBPROPSET_SQLSERVERROWSET.</span><span class="sxs-lookup"><span data-stu-id="a6047-130">In order to support query notifications through OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client adds the following new properties to the DBPROPSET_SQLSERVERROWSET property set.</span></span>  
  
|<span data-ttu-id="a6047-131">Имя</span><span class="sxs-lookup"><span data-stu-id="a6047-131">Name</span></span>|<span data-ttu-id="a6047-132">Type</span><span class="sxs-lookup"><span data-stu-id="a6047-132">Type</span></span>|<span data-ttu-id="a6047-133">Описание</span><span class="sxs-lookup"><span data-stu-id="a6047-133">Description</span></span>|  
|----------|----------|-----------------|  
|<span data-ttu-id="a6047-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="a6047-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span></span>|<span data-ttu-id="a6047-135">VT_UI4</span><span class="sxs-lookup"><span data-stu-id="a6047-135">VT_UI4</span></span>|<span data-ttu-id="a6047-136">время в секундах, в течение которого уведомление запроса должно оставаться активным.</span><span class="sxs-lookup"><span data-stu-id="a6047-136">The number of seconds that the query notification is to remain active.</span></span><br /><br /> <span data-ttu-id="a6047-137">Значение по умолчанию — 432000 секунд (5 дней).</span><span class="sxs-lookup"><span data-stu-id="a6047-137">The default is 432000 seconds (5 days).</span></span> <span data-ttu-id="a6047-138">Минимальное значение — 1 секунда, а максимальное значение — 2^31-1 секунд.</span><span class="sxs-lookup"><span data-stu-id="a6047-138">The minimum value is 1 second, and the maximum value is 2^31-1 seconds.</span></span>|  
|<span data-ttu-id="a6047-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="a6047-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span></span>|<span data-ttu-id="a6047-140">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="a6047-140">VT_BSTR</span></span>|<span data-ttu-id="a6047-141">Текст сообщения уведомления.</span><span class="sxs-lookup"><span data-stu-id="a6047-141">The message text of the notification.</span></span> <span data-ttu-id="a6047-142">Определяется пользователем и не имеет стандартного формата.</span><span class="sxs-lookup"><span data-stu-id="a6047-142">This is user defined, and has no predefined format.</span></span><br /><br /> <span data-ttu-id="a6047-143">По умолчанию эта строка пуста.</span><span class="sxs-lookup"><span data-stu-id="a6047-143">By default, the string is empty.</span></span> <span data-ttu-id="a6047-144">В сообщении можно использовать от 1 до 2000 символов.</span><span class="sxs-lookup"><span data-stu-id="a6047-144">You can specify a message using 1-2000 characters.</span></span>|  
|<span data-ttu-id="a6047-145">SSPROP_QP_NOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="a6047-145">SSPROP_QP_NOTIFICATION_OPTIONS</span></span>|<span data-ttu-id="a6047-146">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="a6047-146">VT_BSTR</span></span>|<span data-ttu-id="a6047-147">параметры уведомлений о запросах.</span><span class="sxs-lookup"><span data-stu-id="a6047-147">The query notification options.</span></span> <span data-ttu-id="a6047-148">Они указываются в строке с *name* = синтаксисом*значения* Name.</span><span class="sxs-lookup"><span data-stu-id="a6047-148">These are specified in a string with *name*=*value* syntax.</span></span> <span data-ttu-id="a6047-149">За создание службы и считывание уведомлений из очереди отвечает пользователь.</span><span class="sxs-lookup"><span data-stu-id="a6047-149">The user is responsible for creating the service and reading notifications off of the queue.</span></span><br /><br /> <span data-ttu-id="a6047-150">Значением по умолчанию является пустая строка.</span><span class="sxs-lookup"><span data-stu-id="a6047-150">The default is an empty string.</span></span>|  
  
 <span data-ttu-id="a6047-151">Подписка на уведомления всегда фиксируется независимо от того, выполнялась ли инструкция в рамках пользовательской транзакции или в режиме AUTO COMMIT, а также была ли транзакция, в рамках которой выполнялась инструкция, зафиксирована либо был выполнен ее откат.</span><span class="sxs-lookup"><span data-stu-id="a6047-151">The notification subscription is always committed, regardless of whether the statement ran in a user transaction or in auto commit or whether the transaction in which the statement ran committed or rolled back.</span></span> <span data-ttu-id="a6047-152">Уведомление сервера срабатывает при возникновении любого из следующих недопустимых условий: изменение базовых данных или схемы либо по истечении времени ожидания, в зависимости от того, что произойдет первым.</span><span class="sxs-lookup"><span data-stu-id="a6047-152">The server notification fires upon any of the following invalid notification conditions: change of underlying data or schema, or when the timeout period is reached; whichever is first.</span></span> <span data-ttu-id="a6047-153">Регистрации уведомлений удаляются сразу же после их срабатывания.</span><span class="sxs-lookup"><span data-stu-id="a6047-153">Notification registrations are deleted as soon as they are fired.</span></span> <span data-ttu-id="a6047-154">Поэтому, если приложению требуется получение уведомлений в дальнейшем, оно должно подписаться на них снова сразу после получения уведомления.</span><span class="sxs-lookup"><span data-stu-id="a6047-154">Hence upon receiving notifications, the application must subscribe again in case they want to get further updates.</span></span>  
  
 <span data-ttu-id="a6047-155">Другое соединение или поток может проверять целевую очередь на наличие уведомлений.</span><span class="sxs-lookup"><span data-stu-id="a6047-155">Another connection or thread can check the destination queue for notifications.</span></span> <span data-ttu-id="a6047-156">Пример:</span><span class="sxs-lookup"><span data-stu-id="a6047-156">For example:</span></span>  
  
```  
WAITFOR (RECEIVE * FROM MyQueue);   // Where MyQueue is the queue name.   
```  
  
 <span data-ttu-id="a6047-157">Следует отметить, что инструкция SELECT \* не удаляет какие-либо записи из очереди, а инструкция RECEIVE \* FROM удаляет.</span><span class="sxs-lookup"><span data-stu-id="a6047-157">Note that SELECT \* does not delete the entry from the Queue, however RECEIVE \* FROM does.</span></span> <span data-ttu-id="a6047-158">Если очередь пуста, поток сервера будет остановлен.</span><span class="sxs-lookup"><span data-stu-id="a6047-158">This stalls a server thread if the queue is empty.</span></span> <span data-ttu-id="a6047-159">При наличии в очереди записей в момент вызова они возвращаются мгновенно; в противном случае вызов ожидает появления записи в очереди.</span><span class="sxs-lookup"><span data-stu-id="a6047-159">If there are queue entries at the time of the call, they are returned immediately; otherwise the call waits until a queue entry is made.</span></span>  
  
```  
RECEIVE * FROM MyQueue  
```  
  
 <span data-ttu-id="a6047-160">Если очередь пуста, то эта инструкция немедленно возвращает пустой результирующий набор; в противном случае она возвращает все уведомления в очереди.</span><span class="sxs-lookup"><span data-stu-id="a6047-160">This statement immediately returns an empty result set if the queue is empty; otherwise it returns all queue notifications.</span></span>  
  
 <span data-ttu-id="a6047-161">Если значение свойств SSPROP_QP_NOTIFICATION_MSGTEXT и SSPROP_QP_NOTIFICATION_OPTIONS не равно NULL и не является пустым, то при каждом выполнении этой команды на сервер отправляется заголовок потока табличных данных уведомлений о запросах, содержащий три свойства, указанные выше.</span><span class="sxs-lookup"><span data-stu-id="a6047-161">If SSPROP_QP_NOTIFICATION_MSGTEXT and SSPROP_QP_NOTIFICATION_OPTIONS are non-NULL and non-empty, the query notifications TDS header containing the three properties defined above are sent to the server with each execution of the command.</span></span> <span data-ttu-id="a6047-162">Если значение любого из них равно NULL (или пустое), заголовок не отправляется, а формируется DB_E_ERRORSOCCURRED (или DB_S_ERRORSOCCURRED, если оба свойства обозначены, как необязательные), а значение состояния устанавливается в DBPROPSTATUS_BADVALUE.</span><span class="sxs-lookup"><span data-stu-id="a6047-162">If either of them is null (or empty), the header is not sent and DB_E_ERRORSOCCURRED is raised, (or DB_S_ERRORSOCCURRED if the properties are both marked as optional), and the status value is set to DBPROPSTATUS_BADVALUE.</span></span> <span data-ttu-id="a6047-163">Поверка выполняется в случае команды Execute/Prepare.</span><span class="sxs-lookup"><span data-stu-id="a6047-163">The validation occurs on Execute/Prepare.</span></span> <span data-ttu-id="a6047-164">Точно так же DB_S_ERRORSOCCURED формируется при задании свойств уведомлений о запросах для установления соединений с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] версий младше [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a6047-164">Similarly, DB_S_ERRORSOCCURED is raised when the query notification properties are set for connections to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="a6047-165">В этом случае значение состояния — DBPROPSTATUS_NOTSUPPORTED.</span><span class="sxs-lookup"><span data-stu-id="a6047-165">The status value in this case is DBPROPSTATUS_NOTSUPPORTED.</span></span>  
  
 <span data-ttu-id="a6047-166">Запуск подписки не гарантирует успешной доставки последующих сообщений.</span><span class="sxs-lookup"><span data-stu-id="a6047-166">Initiating a subscription does not guarantee that subsequent messages will be successfully delivered.</span></span> <span data-ttu-id="a6047-167">Кроме того, допустимость указанного имени службы также не проверяется.</span><span class="sxs-lookup"><span data-stu-id="a6047-167">In addition, no check is made as to the validity of the service name specified.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a6047-168">При подготовке инструкций подписка никогда не запускается. Запуск подписки происходит только при выполнении инструкций, а использование базовых служб OLE DB не оказывает влияния на уведомления о запросах.</span><span class="sxs-lookup"><span data-stu-id="a6047-168">Preparing statements will never cause the subscription to be initiated; only statement execution will achieve this and query notifications are not impacted by the use of OLE DB core services.</span></span>  
  
 <span data-ttu-id="a6047-169">Дополнительные сведения о наборе свойств DBPROPSET_SQLSERVERROWSET см. в разделе [Свойства и поведение набора строк](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md).</span><span class="sxs-lookup"><span data-stu-id="a6047-169">For more information about the DBPROPSET_SQLSERVERROWSET property set, see [Rowset Properties and Behaviors](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="a6047-170">Драйвер ODBC для собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="a6047-170">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="a6047-171">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента поддерживает уведомления о запросах с помощью добавления трех новых атрибутов к функциям [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) и [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) :</span><span class="sxs-lookup"><span data-stu-id="a6047-171">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports query notifications through the addition of three new attributes to the [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) and [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) functions:</span></span>  
  
-   <span data-ttu-id="a6047-172">Атрибут SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="a6047-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span></span>  
  
-   <span data-ttu-id="a6047-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="a6047-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span></span>  
  
-   <span data-ttu-id="a6047-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="a6047-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span></span>  
  
 <span data-ttu-id="a6047-175">Если значение свойств SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT и SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS не равно NULL, то при каждом выполнении этой команды на сервер отправляется заголовок потока табличных данных уведомлений о запросах, содержащий три атрибута, указанных выше.</span><span class="sxs-lookup"><span data-stu-id="a6047-175">If SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT and SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS are not NULL, the query notifications TDS header containing the three attributes defined above will be sent to the server each time the command is executed.</span></span> <span data-ttu-id="a6047-176">Если значение любого из них равно NULL, заголовок не отправляется и возвращается SQL_SUCCESS_WITH_INFO.</span><span class="sxs-lookup"><span data-stu-id="a6047-176">If either of them is null, the header is not sent, and SQL_SUCCESS_WITH_INFO is returned.</span></span> <span data-ttu-id="a6047-177">Проверка выполняется для [функции SQLPrepare](https://go.microsoft.com/fwlink/?LinkId=59360), **SqlExecDirect**и **SqlExecute**, которая завершается ошибкой, если атрибуты являются недопустимыми.</span><span class="sxs-lookup"><span data-stu-id="a6047-177">The validation occurs on [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360), **SqlExecDirect**, and **SqlExecute**, all of which fail if the attributes are not valid.</span></span> <span data-ttu-id="a6047-178">Точно так же, когда эти атрибуты уведомлений о запросах отправляются для версий [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] младше [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], выполнение завершается неудачей с SQL_SUCCESS_WITH_INFO.</span><span class="sxs-lookup"><span data-stu-id="a6047-178">Similarly, when these query notification attributes are set for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], the execution fails with SQL_SUCCESS_WITH_INFO.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a6047-179">Подготовка инструкций никогда не вызывает запуска подписки; подписка может быть запущена выполнением инструкции.</span><span class="sxs-lookup"><span data-stu-id="a6047-179">Prepare statements will never cause the subscription to be initiated; subscription can be initiated by statement execution.</span></span>  
  
## <a name="special-cases-and-restrictions"></a><span data-ttu-id="a6047-180">Особые случаи и ограничения</span><span class="sxs-lookup"><span data-stu-id="a6047-180">Special Cases and Restrictions</span></span>  
 <span data-ttu-id="a6047-181">Следующие типы данных для уведомлений не поддерживаются:</span><span class="sxs-lookup"><span data-stu-id="a6047-181">The following data types are not supported for notifications:</span></span>  
  
-   `text`  
  
-   `ntext`  
  
-   `image`  
  
 <span data-ttu-id="a6047-182">Если сделан запрос на уведомление о запросе, который возвращает один из этих типов данных, уведомление срабатывает мгновенно с указанием, что выполнить подписку на уведомление невозможно.</span><span class="sxs-lookup"><span data-stu-id="a6047-182">If a notification request is made for a query which returns any of these types, the notification fires immediately, specifying that notification subscription was not possible.</span></span>  
  
 <span data-ttu-id="a6047-183">Если запрос на подписку сделан для пакета или хранимой процедуры, для каждой инструкции, выполняемой в пакете или хранимой процедуре, будет сделан отдельный запрос на подписку.</span><span class="sxs-lookup"><span data-stu-id="a6047-183">If a subscription request is made for a batch or stored procedure, a separate subscription request is made for each statement executed within the batch or stored procedure.</span></span> <span data-ttu-id="a6047-184">Инструкция EXECUTE не регистрирует уведомление, но направляет требование об уведомлении выполняемой команде.</span><span class="sxs-lookup"><span data-stu-id="a6047-184">EXECUTE statements will not register a notification, but will send the notification request to the executed command.</span></span> <span data-ttu-id="a6047-185">Если это пакет, к выполняемым инструкциям будет применен контекст и правила, описанные выше.</span><span class="sxs-lookup"><span data-stu-id="a6047-185">If it is a batch, the context will be applied to the executed statements and the same rules described above apply.</span></span>  
  
 <span data-ttu-id="a6047-186">Отправка запроса на уведомление, отправленное одним и тем же пользователем в том же контексте базы данных и имеющее тот же самый шаблон, то же самое значение параметра, идентификатор уведомления и место доставки существующей активной подписки, обновит существующую подписку, переустановив новое заданное время ожидания. Это означает, что если уведомление запрашивается для идентичных запросов, будет отправлено только одно уведомление.</span><span class="sxs-lookup"><span data-stu-id="a6047-186">Submission of a query for notification that was submitted by the same user under the same database context and has the same template, same parameter values, same notification ID, and same delivery location of an existing active subscription, will renew the existing subscription, resetting the new specified time-out. This means that if notification is requested for identical queries, only one notification will be sent.</span></span> <span data-ttu-id="a6047-187">Данные условия применяются к запросам, повторяющимся в пакетах, или к запросам, которые вызываются несколько раз в хранимой процедуре.</span><span class="sxs-lookup"><span data-stu-id="a6047-187">This would apply to a query duplicated in a batch, or a query in a stored procedure that was called multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a6047-188">См. также:</span><span class="sxs-lookup"><span data-stu-id="a6047-188">See Also</span></span>  
 [<span data-ttu-id="a6047-189">Компоненты собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="a6047-189">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
