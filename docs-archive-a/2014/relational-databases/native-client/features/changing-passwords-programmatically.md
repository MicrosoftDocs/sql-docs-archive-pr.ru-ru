---
title: Смена пароля программным способом | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], password expiration
- SQL Server Native Client ODBC driver, passwords
- SQL Server Native Client OLE DB provider, passwords
- passwords [SQL Server], expiration
- SQLNCLI, password expiration
- expiration [SQL Server Native Client]
- passwords [SQL Server], modifying
- expired passwords [SQL Server Native Client]
- SQL Server Native Client, password expiration
- modifying passwords
ms.assetid: 624ad949-5fed-4ce5-b319-878549f9487b
author: rothja
ms.author: jroth
ms.openlocfilehash: 86085f8ba7c54cfcab1a3c7f6e8ade30ecf9d0da
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87730610"
---
# <a name="changing-passwords-programmatically"></a><span data-ttu-id="3062d-102">Смена пароля программным способом</span><span class="sxs-lookup"><span data-stu-id="3062d-102">Changing Passwords Programmatically</span></span>
  <span data-ttu-id="3062d-103">В версиях, предшествующих [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], при истечении пароля пользователя переустановить его мог только администратор.</span><span class="sxs-lookup"><span data-stu-id="3062d-103">Before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], when a user's password expired, only an administrator could reset it.</span></span> <span data-ttu-id="3062d-104">Начиная с [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] , [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] собственный клиент поддерживает обработку истечения срока действия пароля программным способом с помощью [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] собственного клиентского OLE DB поставщика и [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] драйвера ODBC собственного клиента, а также путем изменения диалоговых окон **входа в SQL Server** .</span><span class="sxs-lookup"><span data-stu-id="3062d-104">Beginning with [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client supports handling password expiration programmatically through both the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver, and through changes to the **SQL Server Login** dialog boxes.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3062d-105">По возможности следует предлагать пользователям вводить свои учетные данные во время выполнения, избегая их сохранения.</span><span class="sxs-lookup"><span data-stu-id="3062d-105">When possible, prompt users to enter their credentials at run time and avoid storing their credentials in a persisted format.</span></span> <span data-ttu-id="3062d-106">Если необходимо сохранить учетные данные пользователей, зашифруйте их с помощью [интерфейса API шифрования Win32](https://go.microsoft.com/fwlink/?LinkId=64532).</span><span class="sxs-lookup"><span data-stu-id="3062d-106">If you must persist their credentials, you should encrypt them using the [Win32 crypto API](https://go.microsoft.com/fwlink/?LinkId=64532).</span></span> <span data-ttu-id="3062d-107">Дополнительные сведения об использовании паролей см. в разделе [Надежные пароли](../../security/strong-passwords.md).</span><span class="sxs-lookup"><span data-stu-id="3062d-107">For more information about the use of passwords, see [Strong Passwords](../../security/strong-passwords.md).</span></span>  
  
## <a name="sql-server-login-error-codes"></a><span data-ttu-id="3062d-108">Коды ошибок имени входа SQL Server</span><span class="sxs-lookup"><span data-stu-id="3062d-108">SQL Server Login Error Codes</span></span>  
 <span data-ttu-id="3062d-109">Если соединение нельзя установить из-за проблем проверки подлинности, то для диагностики и восстановления приложению будет доступен один из существующих кодов ошибок SQL Server.</span><span class="sxs-lookup"><span data-stu-id="3062d-109">When a connection cannot be made because of authentication problems, one of the following SQL Server error codes will be available to the application to assist diagnosis and recovery.</span></span>  
  
|<span data-ttu-id="3062d-110">Код ошибки SQL Server</span><span class="sxs-lookup"><span data-stu-id="3062d-110">SQL Server Error Code</span></span>|<span data-ttu-id="3062d-111">Сообщение об ошибке</span><span class="sxs-lookup"><span data-stu-id="3062d-111">Error Message</span></span>|  
|---------------------------|-------------------|  
|<span data-ttu-id="3062d-112">15113</span><span class="sxs-lookup"><span data-stu-id="3062d-112">15113</span></span>|<span data-ttu-id="3062d-113">Ошибка входа пользователя "%. \* ls", причина: не удалось проверить пароль.</span><span class="sxs-lookup"><span data-stu-id="3062d-113">Login failed for user '%.\*ls' Reason: Password validation failed.</span></span> <span data-ttu-id="3062d-114">Учетная запись заблокирована.</span><span class="sxs-lookup"><span data-stu-id="3062d-114">The account is locked out.</span></span>|  
|<span data-ttu-id="3062d-115">18463</span><span class="sxs-lookup"><span data-stu-id="3062d-115">18463</span></span>|<span data-ttu-id="3062d-116">Ошибка входа пользователя «%.\*ls».</span><span class="sxs-lookup"><span data-stu-id="3062d-116">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="3062d-117">Причина: не удалось изменить пароль.</span><span class="sxs-lookup"><span data-stu-id="3062d-117">Reason: Password change failed.</span></span> <span data-ttu-id="3062d-118">В данный момент этот пароль не может быть использован.</span><span class="sxs-lookup"><span data-stu-id="3062d-118">The password cannot be used at this time.</span></span>|  
|<span data-ttu-id="3062d-119">18464</span><span class="sxs-lookup"><span data-stu-id="3062d-119">18464</span></span>|<span data-ttu-id="3062d-120">Ошибка входа пользователя «%.\*ls».</span><span class="sxs-lookup"><span data-stu-id="3062d-120">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="3062d-121">Причина: не удалось изменить пароль.</span><span class="sxs-lookup"><span data-stu-id="3062d-121">Reason: Password change failed.</span></span> <span data-ttu-id="3062d-122">Пароль слишком короткий и не отвечает требованиям политики.</span><span class="sxs-lookup"><span data-stu-id="3062d-122">The password does not meet policy requirements because it is too short.</span></span>|  
|<span data-ttu-id="3062d-123">18465</span><span class="sxs-lookup"><span data-stu-id="3062d-123">18465</span></span>|<span data-ttu-id="3062d-124">Ошибка входа пользователя «%.\*ls».</span><span class="sxs-lookup"><span data-stu-id="3062d-124">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="3062d-125">Причина: не удалось изменить пароль.</span><span class="sxs-lookup"><span data-stu-id="3062d-125">Reason: Password change failed.</span></span> <span data-ttu-id="3062d-126">Пароль слишком длинный и не отвечает требованиям политики.</span><span class="sxs-lookup"><span data-stu-id="3062d-126">The password does not meet policy requirements because it is too long.</span></span>|  
|<span data-ttu-id="3062d-127">18466</span><span class="sxs-lookup"><span data-stu-id="3062d-127">18466</span></span>|<span data-ttu-id="3062d-128">Ошибка входа пользователя «%.\*ls».</span><span class="sxs-lookup"><span data-stu-id="3062d-128">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="3062d-129">Причина: не удалось изменить пароль.</span><span class="sxs-lookup"><span data-stu-id="3062d-129">Reason: Password change failed.</span></span> <span data-ttu-id="3062d-130">Пароль недостаточно сложный и не отвечает требованиям политики.</span><span class="sxs-lookup"><span data-stu-id="3062d-130">The password does not meet policy requirements because it is not complex enough.</span></span>|  
|<span data-ttu-id="3062d-131">18467</span><span class="sxs-lookup"><span data-stu-id="3062d-131">18467</span></span>|<span data-ttu-id="3062d-132">Ошибка входа пользователя «%.\*ls».</span><span class="sxs-lookup"><span data-stu-id="3062d-132">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="3062d-133">Причина: не удалось изменить пароль.</span><span class="sxs-lookup"><span data-stu-id="3062d-133">Reason: Password change failed.</span></span> <span data-ttu-id="3062d-134">Пароль не отвечает требованиям динамической библиотеки фильтрации паролей.</span><span class="sxs-lookup"><span data-stu-id="3062d-134">The password does not meet the requirements of the password filter DLL.</span></span>|  
|<span data-ttu-id="3062d-135">18468</span><span class="sxs-lookup"><span data-stu-id="3062d-135">18468</span></span>|<span data-ttu-id="3062d-136">Ошибка входа пользователя «%.\*ls».</span><span class="sxs-lookup"><span data-stu-id="3062d-136">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="3062d-137">Причина: не удалось изменить пароль.</span><span class="sxs-lookup"><span data-stu-id="3062d-137">Reason: Password change failed.</span></span> <span data-ttu-id="3062d-138">В процессе проверки пароля произошла непредвиденная ошибка.</span><span class="sxs-lookup"><span data-stu-id="3062d-138">An unexpected error occurred during password validation.</span></span>|  
|<span data-ttu-id="3062d-139">18487</span><span class="sxs-lookup"><span data-stu-id="3062d-139">18487</span></span>|<span data-ttu-id="3062d-140">Ошибка входа пользователя «%.\*ls».</span><span class="sxs-lookup"><span data-stu-id="3062d-140">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="3062d-141">Причина: истек срок действия пароля для этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="3062d-141">Reason: The password of the account has expired.</span></span>|  
|<span data-ttu-id="3062d-142">18488</span><span class="sxs-lookup"><span data-stu-id="3062d-142">18488</span></span>|<span data-ttu-id="3062d-143">Ошибка входа пользователя «%.\*ls».</span><span class="sxs-lookup"><span data-stu-id="3062d-143">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="3062d-144">Причина: пароль для данной учетной записи необходимо изменить.</span><span class="sxs-lookup"><span data-stu-id="3062d-144">Reason: The password of the account must be changed.</span></span>|  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="3062d-145">Поставщик OLE DB для собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="3062d-145">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="3062d-146">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Поставщик OLE DB собственного клиента поддерживает истечение срока действия пароля, хотя пользовательский интерфейс и программный.</span><span class="sxs-lookup"><span data-stu-id="3062d-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration though a user interface and programmatically.</span></span>  
  
### <a name="ole-db-user-interface-password-expiration"></a><span data-ttu-id="3062d-147">Пользовательский интерфейс OLE DB для истечения срока действия пароля</span><span class="sxs-lookup"><span data-stu-id="3062d-147">OLE DB User Interface Password Expiration</span></span>  
 <span data-ttu-id="3062d-148">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Поставщик OLE DB собственного клиента поддерживает истечение срока действия пароля через изменения, внесенные в диалоговые окна **входа SQL Server** .</span><span class="sxs-lookup"><span data-stu-id="3062d-148">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration through changes made to the **SQL Server Login** dialog boxes.</span></span> <span data-ttu-id="3062d-149">Если свойство DBPROP_INIT_PROMPT установлено в значение DBPROMPT_NOPROMPT, то в случае истечения срока действия пароля попытка начального соединения завершится с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="3062d-149">If the value of DBPROP_INIT_PROMPT is set to DBPROMPT_NOPROMPT, the initial connection attempt will fail if the password has expired.</span></span>  
  
 <span data-ttu-id="3062d-150">Если свойство DBPROP_INIT_PROMPT установлено в любое другое значение, диалоговое окно **Имя входа SQL Server** появится независимо от того, истек срок действия пароля или нет.</span><span class="sxs-lookup"><span data-stu-id="3062d-150">If DBPROP_INIT_PROMPT has been set to any other value, the user sees the **SQL Server Login** dialog, regardless of whether or not the password has expired.</span></span> <span data-ttu-id="3062d-151">Чтобы сменить пароль, пользователь может нажать кнопку **Параметры** и установить флажок **Сменить пароль**.</span><span class="sxs-lookup"><span data-stu-id="3062d-151">The user can click on the **Options** button and check **Change Password** to change the password.</span></span>  
  
 <span data-ttu-id="3062d-152">Если срок действия пароля истек, а пользователь нажимает кнопку "ОК", [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предложит ему ввести и подтвердить новый пароль с помощью диалогового окна **Изменить пароль SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="3062d-152">If the user clicks OK and the password has expired, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] prompts the user to enter and confirm a new password using the **Change SQL Server Password** dialog.</span></span>  
  
#### <a name="ole-db-prompt-behavior-and-locked-accounts"></a><span data-ttu-id="3062d-153">Поведение подсказки OLE DB и заблокированные учетные записи</span><span class="sxs-lookup"><span data-stu-id="3062d-153">OLE DB Prompt Behavior and Locked Accounts</span></span>  
 <span data-ttu-id="3062d-154">Попытки соединения могут окончиться неудачей, если учетная запись заблокирована.</span><span class="sxs-lookup"><span data-stu-id="3062d-154">Connection attempts may fail due to the account being locked.</span></span> <span data-ttu-id="3062d-155">В этом случае вслед за выводом диалогового окна **Имя входа SQL Server** для пользователя отображается сообщение об ошибке сервера, и попытка соединения аварийно завершается.</span><span class="sxs-lookup"><span data-stu-id="3062d-155">If this occurs following the display of the **SQL Server Login** dialog, the server error message is displayed to the user and the connection attempt is aborted.</span></span> <span data-ttu-id="3062d-156">Это может также произойти после отображения диалогового окна **Изменить пароль SQL Server**, если пользователь неправильно ввел старый пароль.</span><span class="sxs-lookup"><span data-stu-id="3062d-156">It may also occur following the display of the **Change SQL Server Password** dialog if the user enters a bad value for the old password.</span></span> <span data-ttu-id="3062d-157">В этом случае будет выведено то же сообщение об ошибке, а попытка соединения отменяется.</span><span class="sxs-lookup"><span data-stu-id="3062d-157">In this case the same error message is displayed, and the connection attempt is aborted.</span></span>  
  
#### <a name="ole-db-connection-pooling-password-expiration-and-locked-accounts"></a><span data-ttu-id="3062d-158">Пул соединений OLE DB, истечение срока действия пароля и заблокированные учетные записи</span><span class="sxs-lookup"><span data-stu-id="3062d-158">OLE DB Connection Pooling, Password Expiration, and Locked Accounts</span></span>  
 <span data-ttu-id="3062d-159">Учетная запись может оказаться заблокированной или может истечь срок действия пароля, в то время как соединение останется активным в пуле соединений.</span><span class="sxs-lookup"><span data-stu-id="3062d-159">An account may be locked or its password may expire while the connection is still active in a connection pool.</span></span> <span data-ttu-id="3062d-160">Сервер проверяет наличие паролей с истекшим сроком действия и заблокированных учетных записей в двух случаях.</span><span class="sxs-lookup"><span data-stu-id="3062d-160">The server checks for expired passwords and locked accounts on two occasions.</span></span> <span data-ttu-id="3062d-161">Во-первых, при первоначальном создании соединения.</span><span class="sxs-lookup"><span data-stu-id="3062d-161">The first is when a connection is first created.</span></span> <span data-ttu-id="3062d-162">Во-вторых, после восстановления соединения, при получении соединения из пула.</span><span class="sxs-lookup"><span data-stu-id="3062d-162">The second occasion is upon connection reset, when the connection is taken from the pool.</span></span>  
  
 <span data-ttu-id="3062d-163">Если попытка восстановления завершилась неудачно, то соединение удаляется из пула и возвращается ошибка.</span><span class="sxs-lookup"><span data-stu-id="3062d-163">When the reset attempt fails, the connection is removed from the pool and an error is returned.</span></span>  
  
### <a name="ole-db-programmatic-password-expiration"></a><span data-ttu-id="3062d-164">Программное истечение срока действия пароля OLE DB</span><span class="sxs-lookup"><span data-stu-id="3062d-164">OLE DB Programmatic Password Expiration</span></span>  
 <span data-ttu-id="3062d-165">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Поставщик OLE DB собственного клиента поддерживает истечение срока действия пароля с помощью добавления свойства SSPROP_AUTH_OLD_PASSWORD (типа VT_BSTR), добавленного в набор свойств DBPROPSET_SQLSERVERDBINIT.</span><span class="sxs-lookup"><span data-stu-id="3062d-165">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration through the addition of the SSPROP_AUTH_OLD_PASSWORD (type VT_BSTR) property that has been added to the DBPROPSET_SQLSERVERDBINIT property set.</span></span>  
  
 <span data-ttu-id="3062d-166">Существующее свойство «Password» ссылается на свойство DBPROP_AUTH_PASSWORD и используется для хранения нового пароля.</span><span class="sxs-lookup"><span data-stu-id="3062d-166">The existing "Password" property refers to DBPROP_AUTH_PASSWORD and is used to store the new password.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3062d-167">В строке подключения свойство «Old Password» устанавливает значение свойства SSPROP_AUTH_OLD_PASSWORD, являющееся текущим паролем (возможно, с истекшим сроком действия), недоступным через свойство строки поставщика.</span><span class="sxs-lookup"><span data-stu-id="3062d-167">In the connection string, the "Old Password" property sets SSPROP_AUTH_OLD_PASSWORD, which is the current (possibly expired) password that is not available via a provider string property.</span></span>  
  
 <span data-ttu-id="3062d-168">Поставщик не сохраняет значение этого свойства.</span><span class="sxs-lookup"><span data-stu-id="3062d-168">The provider does not persist the value of this property.</span></span> <span data-ttu-id="3062d-169">Когда это свойство установлено, при первом соединении поставщик не использует пул соединений, поскольку это вызовет новое соединение.</span><span class="sxs-lookup"><span data-stu-id="3062d-169">When this property is set, the provider does not use the connection pool for the first connection because a new connection will occur.</span></span> <span data-ttu-id="3062d-170">Если пароль успешно изменен, текущее соединение нельзя использовать повторно, поскольку оно все еще содержит старый пароль, который будет недопустимым после изменения пароля.</span><span class="sxs-lookup"><span data-stu-id="3062d-170">If the password change is successful, the current connection cannot be reused since it still contains the old password, which will be invalid after the password change.</span></span> <span data-ttu-id="3062d-171">Кроме того, при успешном входе поставщик очистит данное свойство.</span><span class="sxs-lookup"><span data-stu-id="3062d-171">Also, if the login succeeds, the provider clears this property.</span></span> <span data-ttu-id="3062d-172">Дальнейшие попытки получения старого пароля вернут значение VT_EMPTY.</span><span class="sxs-lookup"><span data-stu-id="3062d-172">Subsequent attempts to retrieve the old password return VT_EMPTY.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="3062d-173">Свойство SSPROP_AUTH_OLD_PASSWORD не нужно сохранять, поскольку оно используется только при истечении срока действия пароля.</span><span class="sxs-lookup"><span data-stu-id="3062d-173">SSPROP_AUTH_OLD_PASSWORD should never be persisted since it is only used when a password has expired.</span></span>  
  
 <span data-ttu-id="3062d-174">Обратите внимание, что при установке свойства «Old Password» поставщик предполагает, что была сделана попытка изменить пароль, если не была также указана проверка подлинности Windows, имеющая приоритет.</span><span class="sxs-lookup"><span data-stu-id="3062d-174">Note that whenever the "Old Password" property is set, the provider assumes that an attempt to change the password is being made, unless Windows Authentication is also specified, in which case it always takes precedence.</span></span>  
  
 <span data-ttu-id="3062d-175">Если используется проверка подлинности Windows, при указании старого пароля возвращается либо DB_E_ERRORSOCCURRED, либо DB_S_ERRORSOCCURRED в зависимости от того, был ли указан старый пароль как REQUIRED или OPTIONAL соответственно, а значение состояния DBPROPSTATUS_CONFLICTINGBADVALUE возвращается в параметре *dwStatus*.</span><span class="sxs-lookup"><span data-stu-id="3062d-175">If Windows Authentication is used, specifying the old password results in either DB_E_ERRORSOCCURRED or DB_S_ERRORSOCCURRED depending on whether the old password was specified as REQUIRED or OPTIONAL respectively, and the status value of DBPROPSTATUS_CONFLICTINGBADVALUE is returned in *dwStatus*.</span></span> <span data-ttu-id="3062d-176">Это определяется при вызове метода **IDBInitialize::Initialize**.</span><span class="sxs-lookup"><span data-stu-id="3062d-176">This is detected when **IDBInitialize::Initialize** is called.</span></span>  
  
 <span data-ttu-id="3062d-177">Если попытка смены пароля завершилась непредвиденной ошибкой, то сервер возвращает код ошибки 18468.</span><span class="sxs-lookup"><span data-stu-id="3062d-177">If an attempt to change the password fails unexpectedly, the server returns error code 18468.</span></span> <span data-ttu-id="3062d-178">Попытка соединения возвращает стандартный код ошибки OLEDB.</span><span class="sxs-lookup"><span data-stu-id="3062d-178">A standard OLEDB error is returned from the connection attempt.</span></span>  
  
 <span data-ttu-id="3062d-179">Дополнительные сведения о наборе свойств DBPROPSET_SQLSERVERDBINIT см. в статье [Свойства инициализации и авторизации](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span><span class="sxs-lookup"><span data-stu-id="3062d-179">For more information about the DBPROPSET_SQLSERVERDBINIT property set, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="3062d-180">Драйвер ODBC для собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="3062d-180">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="3062d-181">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Поставщик OLE DB собственного клиента поддерживает истечение срока действия пароля, хотя пользовательский интерфейс и программный.</span><span class="sxs-lookup"><span data-stu-id="3062d-181">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration though a user interface and programmatically.</span></span>  
  
### <a name="odbc-user-interface-password-expiration"></a><span data-ttu-id="3062d-182">Пользовательский интерфейс ODBC истечения срока действия пароля</span><span class="sxs-lookup"><span data-stu-id="3062d-182">ODBC User Interface Password Expiration</span></span>  
 <span data-ttu-id="3062d-183">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента поддерживает истечение срока действия пароля через изменения, внесенные в диалоговые окна **SQL Server login** .</span><span class="sxs-lookup"><span data-stu-id="3062d-183">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports password expiration through changes made to the **SQL Server Login** dialog boxes.</span></span>  
  
 <span data-ttu-id="3062d-184">Если [SQLDriverConnect](../../native-client-odbc-api/sqldriverconnect.md) вызывается и для параметра **DriverCompletion** задано значение SQL_DRIVER_NOPROMPT, то попытка первоначального подключения завершится неудачей, если срок действия пароля истек.</span><span class="sxs-lookup"><span data-stu-id="3062d-184">If [SQLDriverConnect](../../native-client-odbc-api/sqldriverconnect.md) is called and the value of **DriverCompletion** is set to SQL_DRIVER_NOPROMPT, the initial connection attempt fails if the password has expired.</span></span> <span data-ttu-id="3062d-185">При последующих вызовах **SqlError** или **SQLGETDIAGREC**возвращаются значение SQLSTATE 28000 и значение машинного кода ошибки 18487.</span><span class="sxs-lookup"><span data-stu-id="3062d-185">The SQLSTATE value 28000 and the native error code value 18487 are returned by subsequent calls to **SQLError** or **SQLGetDiagRec**.</span></span>  
  
 <span data-ttu-id="3062d-186">Если для **DriverCompletion** задано любое другое значение, пользователь видит диалоговое окно **входа SQL Server** , независимо от того, истек ли срок действия пароля.</span><span class="sxs-lookup"><span data-stu-id="3062d-186">If **DriverCompletion** has been set to any other value, the user sees the **SQL Server Login** dialog, regardless of whether or not the password has expired.</span></span> <span data-ttu-id="3062d-187">Чтобы сменить пароль, пользователь может нажать кнопку **Параметры** и установить флажок **Сменить пароль**.</span><span class="sxs-lookup"><span data-stu-id="3062d-187">The user can click on the **Options** button and check **Change Password** to change the password.</span></span>  
  
 <span data-ttu-id="3062d-188">Если пользователь нажмет кнопку ОК и срок действия пароля истек, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] запрашивает ввод и подтверждение нового пароля с помощью диалогового окна **изменить SQL Server пароль** .</span><span class="sxs-lookup"><span data-stu-id="3062d-188">If the user clicks OK and the password has expired, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] prompts to enter and confirm a new password using the **Change SQL Server Password** dialog.</span></span>  
  
#### <a name="odbc-prompt-behavior-and-locked-accounts"></a><span data-ttu-id="3062d-189">Поведение подсказки ODBC и заблокированные учетные записи</span><span class="sxs-lookup"><span data-stu-id="3062d-189">ODBC Prompt Behavior and Locked Accounts</span></span>  
 <span data-ttu-id="3062d-190">Попытки соединения могут окончиться неудачей, если учетная запись заблокирована.</span><span class="sxs-lookup"><span data-stu-id="3062d-190">Connection attempts may fail due to the account being locked.</span></span> <span data-ttu-id="3062d-191">В этом случае вслед за выводом диалогового окна **Имя входа SQL Server** для пользователя отображается сообщение об ошибке сервера, и попытка соединения аварийно завершается.</span><span class="sxs-lookup"><span data-stu-id="3062d-191">If this occurs following the display of the **SQL Server Login** dialog, the server error message is displayed to the user and the connection attempt is aborted.</span></span> <span data-ttu-id="3062d-192">Это может также произойти после отображения диалогового окна **Изменить пароль SQL Server**, если пользователь неправильно ввел старый пароль.</span><span class="sxs-lookup"><span data-stu-id="3062d-192">It may also occur following the display of the **Change SQL Server Password** dialog if the user enters a bad value for the old password.</span></span> <span data-ttu-id="3062d-193">В этом случае будет выведено то же сообщение об ошибке, а попытка соединения отменяется.</span><span class="sxs-lookup"><span data-stu-id="3062d-193">In this case the same error message is displayed, and the connection attempt is aborted.</span></span>  
  
#### <a name="odbc-connection-pooling-password-expiry-and-locked-accounts"></a><span data-ttu-id="3062d-194">Пул соединений ODBC, истечение срока действия пароля и заблокированные учетные записи</span><span class="sxs-lookup"><span data-stu-id="3062d-194">ODBC Connection Pooling, Password Expiry, and Locked Accounts</span></span>  
 <span data-ttu-id="3062d-195">Учетная запись может оказаться заблокированной или может истечь срок действия пароля, в то время как соединение останется активным в пуле соединений.</span><span class="sxs-lookup"><span data-stu-id="3062d-195">An account may be locked or its password may expire while the connection is still active in a connection pool.</span></span> <span data-ttu-id="3062d-196">Сервер проверяет наличие паролей с истекшим сроком действия и заблокированных учетных записей в двух случаях.</span><span class="sxs-lookup"><span data-stu-id="3062d-196">The server checks for expired passwords and locked accounts on two occasions.</span></span> <span data-ttu-id="3062d-197">Во-первых, при первоначальном создании соединения.</span><span class="sxs-lookup"><span data-stu-id="3062d-197">The first is when a connection is first created.</span></span> <span data-ttu-id="3062d-198">Во-вторых, после восстановления соединения, при получении соединения из пула.</span><span class="sxs-lookup"><span data-stu-id="3062d-198">The second occasion is upon connection reset, when the connection is taken from the pool.</span></span>  
  
 <span data-ttu-id="3062d-199">Если попытка восстановления завершилась неудачно, то соединение удаляется из пула и возвращается ошибка.</span><span class="sxs-lookup"><span data-stu-id="3062d-199">When the reset attempt fails, the connection is removed from the pool and an error is returned.</span></span>  
  
### <a name="odbc-programmatic-password-expiration"></a><span data-ttu-id="3062d-200">Программное истечение срока действия пароля ODBC</span><span class="sxs-lookup"><span data-stu-id="3062d-200">ODBC Programmatic Password Expiration</span></span>  
 <span data-ttu-id="3062d-201">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента поддерживает истечение срока действия пароля с помощью добавления атрибута SQL_COPT_SS_OLDPWD, который задается перед подключением к серверу с помощью функции [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) .</span><span class="sxs-lookup"><span data-stu-id="3062d-201">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports password expiration through the addition of the SQL_COPT_SS_OLDPWD attribute which is set before connecting to the server using the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) function.</span></span>  
  
 <span data-ttu-id="3062d-202">Атрибут SQL_COPT_SS_OLDPWD дескриптора соединения ссылается на пароль с истекшим сроком действия.</span><span class="sxs-lookup"><span data-stu-id="3062d-202">The SQL_COPT_SS_OLDPWD attribute of the connection handle refers to the expired password.</span></span> <span data-ttu-id="3062d-203">Для этого атрибута не существует атрибута строки соединения, поскольку это может повлиять на пул соединений.</span><span class="sxs-lookup"><span data-stu-id="3062d-203">There is no connection string attribute for this attribute, as this would interfere with connection pooling.</span></span> <span data-ttu-id="3062d-204">При успешном входе драйвер очищает этот атрибут.</span><span class="sxs-lookup"><span data-stu-id="3062d-204">If the login succeeds, the driver clears this attribute.</span></span>  
  
 <span data-ttu-id="3062d-205">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента возвращает SQL_ERROR в четырех случаях для этой функции: истечение срока действия пароля, конфликт политики паролей, блокировка учетной записи и при установке свойства старого пароля при использовании проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="3062d-205">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver returns SQL_ERROR in four cases for this feature: password expiration, password policy conflict, account lockout, and when the old password property is set while using Windows Authentication.</span></span> <span data-ttu-id="3062d-206">Драйвер возвращает пользователю соответствующие сообщения об ошибках при вызове [SQLGetDiagField](../../native-client-odbc-api/sqlgetdiagfield.md) .</span><span class="sxs-lookup"><span data-stu-id="3062d-206">The driver returns the appropriate error messages to the user when [SQLGetDiagField](../../native-client-odbc-api/sqlgetdiagfield.md) is invoked.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3062d-207">См. также</span><span class="sxs-lookup"><span data-stu-id="3062d-207">See Also</span></span>  
 [<span data-ttu-id="3062d-208">Компоненты собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="3062d-208">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
