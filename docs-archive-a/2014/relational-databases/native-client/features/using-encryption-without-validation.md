---
title: Использование шифрования без проверки | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], encryption
- cryptography [SQL Server Native Client]
- SQLNCLI, encryption
- encryption [SQL Server Native Client]
- SQL Server Native Client, encryption
ms.assetid: f4c63206-80bb-4d31-84ae-ccfcd563effa
author: rothja
ms.author: jroth
ms.openlocfilehash: 0a6d2e8b3d696a92e3fa3e1b7de7604551d4f9ce
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87656372"
---
# <a name="using-encryption-without-validation"></a><span data-ttu-id="4407e-102">Использование шифрования без проверки</span><span class="sxs-lookup"><span data-stu-id="4407e-102">Using Encryption Without Validation</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="4407e-103">всегда шифрует сетевые пакеты, связанные со входом в систему.</span><span class="sxs-lookup"><span data-stu-id="4407e-103">always encrypts network packets associated with logging in.</span></span> <span data-ttu-id="4407e-104">Если сертификат не был предоставлен на сервере при запуске, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] создает самозаверенный сертификат, который используется для шифрования пакетов входа.</span><span class="sxs-lookup"><span data-stu-id="4407e-104">If no certificate has been provisioned on the server when it starts up, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] generates a self-signed certificate which is used to encrypt login packets.</span></span>  
  
 <span data-ttu-id="4407e-105">Приложения могут также запрашивать шифрование всего сетевого трафика путем использования ключевых слов строк соединения или свойств соединения.</span><span class="sxs-lookup"><span data-stu-id="4407e-105">Applications may also request encryption of all network traffic by using connection string keywords or connection properties.</span></span> <span data-ttu-id="4407e-106">Ключевые слова: "encrypted" для ODBC и OLE DB при использовании строки поставщика с **IDbInitialize:: Initialize**, или "использование шифрования для данных" для ADO и OLE DB при использовании строки инициализации с **IDataInitialize**.</span><span class="sxs-lookup"><span data-stu-id="4407e-106">The keywords are "Encrypt" for ODBC and OLE DB when using a provider string with **IDbInitialize::Initialize**, or "Use Encryption for Data" for ADO and OLE DB when using an initialization string with **IDataInitialize**.</span></span> <span data-ttu-id="4407e-107">Это также можно настроить, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager с помощью параметра **принудительное шифрование протокола** .</span><span class="sxs-lookup"><span data-stu-id="4407e-107">This may also be configured by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager using the **Force Protocol Encryption** option.</span></span> <span data-ttu-id="4407e-108">По умолчанию для шифрования всего сетевого трафика соединения требуется, чтобы сертификат присутствовал на сервере.</span><span class="sxs-lookup"><span data-stu-id="4407e-108">By default, encryption of all network traffic for a connection requires that a certificate be provisioned on the server.</span></span>  
  
 <span data-ttu-id="4407e-109">Дополнительные сведения о ключевых словах строки подключения см. в разделе [Использование ключевых слов строки подключения с SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span><span class="sxs-lookup"><span data-stu-id="4407e-109">For information about connection string keywords, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="4407e-110">Для включения шифрования, которое будет использоваться, если сертификат отсутствует на сервере, можно использовать диспетчер конфигурации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для установки как параметра **Принудительное шифрование протокола**, так и параметра **Надежный сертификат сервера**.</span><span class="sxs-lookup"><span data-stu-id="4407e-110">To enable encryption to be used when a certificate has not been provisioned on the server, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager can be used to set both the **Force Protocol Encryption** and the **Trust Server Certificate** options.</span></span> <span data-ttu-id="4407e-111">В этом случае шифрование будет использовать самозаверяющий сертификат сервера, не проверяя наличия подтверждаемого сертификата сервера.</span><span class="sxs-lookup"><span data-stu-id="4407e-111">In this case, encryption will use a self-signed server certificate without validation if no verifiable certificate has been provisioned on the server.</span></span>  
  
 <span data-ttu-id="4407e-112">Приложения могут также использовать ключевое слово «TrustServerCertificate» или его атрибут связанного соединения, чтобы гарантировать применение шифрования.</span><span class="sxs-lookup"><span data-stu-id="4407e-112">Applications may also use the "TrustServerCertificate" keyword or its associated connection attribute to guarantee that encryption takes place.</span></span> <span data-ttu-id="4407e-113">Параметры приложения никогда не снижают уровень безопасности, установленный клиентским диспетчером конфигурации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], но могут повысить его.</span><span class="sxs-lookup"><span data-stu-id="4407e-113">Application settings never reduce the level of security set by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Client Configuration Manager, but may strengthen it.</span></span> <span data-ttu-id="4407e-114">Например, если параметр **Принудительное шифрование протокола** не установлен для клиента, приложение может само запросить шифрование.</span><span class="sxs-lookup"><span data-stu-id="4407e-114">For example, if **Force Protocol Encryption** is not set for the client, an application may request encryption itself.</span></span> <span data-ttu-id="4407e-115">Чтобы гарантировать применение шифрования, даже если сертификат сервера не был предоставлен, приложение может запросить шифрование и ключевое слово «TrustServerCertificate».</span><span class="sxs-lookup"><span data-stu-id="4407e-115">To guarantee encryption even when a server certificate has not been provisioned, an application may request encryption and "TrustServerCertificate".</span></span> <span data-ttu-id="4407e-116">Однако если ключевое слово «TrustServerCertificate» не включено в конфигурации клиента, предоставление сертификата сервера по-прежнему необходимо.</span><span class="sxs-lookup"><span data-stu-id="4407e-116">However, if "TrustServerCertificate" is not enabled in the client configuration, a provisioned server certificate is still required.</span></span> <span data-ttu-id="4407e-117">В следующей таблице описываются все случаи:</span><span class="sxs-lookup"><span data-stu-id="4407e-117">The following table describes all cases:</span></span>  
  
|<span data-ttu-id="4407e-118">Параметр «Принудительное шифрование протокола» на клиенте</span><span class="sxs-lookup"><span data-stu-id="4407e-118">Force Protocol Encryption client setting</span></span>|<span data-ttu-id="4407e-119">Параметр «Доверять сертификату сервера» на клиенте</span><span class="sxs-lookup"><span data-stu-id="4407e-119">Trust Server Certificate client setting</span></span>|<span data-ttu-id="4407e-120">Строка соединения или атрибут соединения «Шифрование/использовать шифрование для данных»</span><span class="sxs-lookup"><span data-stu-id="4407e-120">Connection string/connection attribute Encrypt/Use Encryption for Data</span></span>|<span data-ttu-id="4407e-121">Строка соединения или атрибут соединения «Надежный сертификат сервера»</span><span class="sxs-lookup"><span data-stu-id="4407e-121">Connection string/connection attribute Trust Server Certificate</span></span>|<span data-ttu-id="4407e-122">Результат</span><span class="sxs-lookup"><span data-stu-id="4407e-122">Result</span></span>|  
|----------------------------------------------|---------------------------------------------|------------------------------------------------------------------------------|----------------------------------------------------------------------|------------|  
|<span data-ttu-id="4407e-123">Нет</span><span class="sxs-lookup"><span data-stu-id="4407e-123">No</span></span>|<span data-ttu-id="4407e-124">Недоступно</span><span class="sxs-lookup"><span data-stu-id="4407e-124">N/A</span></span>|<span data-ttu-id="4407e-125">Нет (по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="4407e-125">No (default)</span></span>|<span data-ttu-id="4407e-126">Не учитывается</span><span class="sxs-lookup"><span data-stu-id="4407e-126">Ignored</span></span>|<span data-ttu-id="4407e-127">Шифрование отсутствует.</span><span class="sxs-lookup"><span data-stu-id="4407e-127">No encryption occurs.</span></span>|  
|<span data-ttu-id="4407e-128">Нет</span><span class="sxs-lookup"><span data-stu-id="4407e-128">No</span></span>|<span data-ttu-id="4407e-129">Недоступно</span><span class="sxs-lookup"><span data-stu-id="4407e-129">N/A</span></span>|<span data-ttu-id="4407e-130">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-130">Yes</span></span>|<span data-ttu-id="4407e-131">Нет (по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="4407e-131">No (default)</span></span>|<span data-ttu-id="4407e-132">Шифрование применяется только при наличии подтверждаемого сертификата сервера, в противном случае попытка соединения завершается неудачно.</span><span class="sxs-lookup"><span data-stu-id="4407e-132">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="4407e-133">Нет</span><span class="sxs-lookup"><span data-stu-id="4407e-133">No</span></span>|<span data-ttu-id="4407e-134">Недоступно</span><span class="sxs-lookup"><span data-stu-id="4407e-134">N/A</span></span>|<span data-ttu-id="4407e-135">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-135">Yes</span></span>|<span data-ttu-id="4407e-136">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-136">Yes</span></span>|<span data-ttu-id="4407e-137">Шифрование производится всегда, однако при этом может использоваться самозаверяющий сертификат сервера.</span><span class="sxs-lookup"><span data-stu-id="4407e-137">Encryption always occurs, but may use a self-signed server certificate.</span></span>|  
|<span data-ttu-id="4407e-138">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-138">Yes</span></span>|<span data-ttu-id="4407e-139">Нет</span><span class="sxs-lookup"><span data-stu-id="4407e-139">No</span></span>|<span data-ttu-id="4407e-140">Не учитывается</span><span class="sxs-lookup"><span data-stu-id="4407e-140">Ignored</span></span>|<span data-ttu-id="4407e-141">Не учитывается</span><span class="sxs-lookup"><span data-stu-id="4407e-141">Ignored</span></span>|<span data-ttu-id="4407e-142">Шифрование применяется только при наличии подтверждаемого сертификата сервера, в противном случае попытка соединения завершается неудачно.</span><span class="sxs-lookup"><span data-stu-id="4407e-142">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="4407e-143">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-143">Yes</span></span>|<span data-ttu-id="4407e-144">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-144">Yes</span></span>|<span data-ttu-id="4407e-145">Нет (по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="4407e-145">No (default)</span></span>|<span data-ttu-id="4407e-146">Не учитывается</span><span class="sxs-lookup"><span data-stu-id="4407e-146">Ignored</span></span>|<span data-ttu-id="4407e-147">Шифрование производится всегда, однако при этом может использоваться самозаверяющий сертификат сервера.</span><span class="sxs-lookup"><span data-stu-id="4407e-147">Encryption always occurs, but may use a self-signed server certificate.</span></span>|  
|<span data-ttu-id="4407e-148">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-148">Yes</span></span>|<span data-ttu-id="4407e-149">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-149">Yes</span></span>|<span data-ttu-id="4407e-150">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-150">Yes</span></span>|<span data-ttu-id="4407e-151">Нет (по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="4407e-151">No (default)</span></span>|<span data-ttu-id="4407e-152">Шифрование применяется только при наличии подтверждаемого сертификата сервера, в противном случае попытка соединения завершается неудачно.</span><span class="sxs-lookup"><span data-stu-id="4407e-152">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="4407e-153">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-153">Yes</span></span>|<span data-ttu-id="4407e-154">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-154">Yes</span></span>|<span data-ttu-id="4407e-155">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-155">Yes</span></span>|<span data-ttu-id="4407e-156">Да</span><span class="sxs-lookup"><span data-stu-id="4407e-156">Yes</span></span>|<span data-ttu-id="4407e-157">Шифрование производится всегда, однако при этом может быть использован самозаверяющий сертификат сервера.</span><span class="sxs-lookup"><span data-stu-id="4407e-157">Encryption always occurs, but might use a self-signed server certificate.</span></span>|  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="4407e-158">Поставщик OLE DB для собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="4407e-158">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="4407e-159">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Поставщик OLE DB собственного клиента поддерживает шифрование без проверки посредством добавления свойства инициализации источника данных SSPROP_INIT_TRUST_SERVER_CERTIFICATE, которое реализуется в наборе свойств DBPROPSET_SQLSERVERDBINIT.</span><span class="sxs-lookup"><span data-stu-id="4407e-159">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports encryption without validation through the addition of the SSPROP_INIT_TRUST_SERVER_CERTIFICATE data source initialization property, which is implemented in the DBPROPSET_SQLSERVERDBINIT property set.</span></span> <span data-ttu-id="4407e-160">Кроме того, добавлено новое ключевое слово строки соединения «TrustServerCertificate».</span><span class="sxs-lookup"><span data-stu-id="4407e-160">In addition, a new connection string keyword, "TrustServerCertificate", as been added.</span></span> <span data-ttu-id="4407e-161">Оно принимает значения «yes» и «no», значение по умолчанию — «no».</span><span class="sxs-lookup"><span data-stu-id="4407e-161">It accepts yes or no values; no is the default.</span></span> <span data-ttu-id="4407e-162">При использовании компонентов службы оно принимает значения true и false, значение по умолчанию — false.</span><span class="sxs-lookup"><span data-stu-id="4407e-162">When using service components, it accepts true or false values; false is the default.</span></span>  
  
 <span data-ttu-id="4407e-163">Дополнительные сведения об улучшениях, появившихся в наборе свойств DBPROPSET_SQLSERVERDBINIT, см. в статье [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md) (Свойства инициализации и авторизации).</span><span class="sxs-lookup"><span data-stu-id="4407e-163">For more information about enhancements made to the DBPROPSET_SQLSERVERDBINIT property set, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="4407e-164">Драйвер ODBC для собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="4407e-164">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="4407e-165">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]Драйвер ODBC для собственного клиента поддерживает шифрование без проверки с помощью дополнений к функциям [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) и [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) .</span><span class="sxs-lookup"><span data-stu-id="4407e-165">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports encryption without validation through additions to the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) functions.</span></span> <span data-ttu-id="4407e-166">Добавлен параметр SQL_COPT_SS_TRUST_SERVER_CERTIFICATE, который может принимать значения SQL_TRUST_SERVER_CERTIFICATE_YES или SQL_TRUST_SERVER_CERTIFICATE_NO, где SQL_TRUST_SERVER_CERTIFICATE_NO является значением по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4407e-166">SQL_COPT_SS_TRUST_SERVER_CERTIFICATE has been added to accept either SQL_TRUST_SERVER_CERTIFICATE_YES or SQL_TRUST_SERVER_CERTIFICATE_NO, with SQL_TRUST_SERVER_CERTIFICATE_NO being the default.</span></span> <span data-ttu-id="4407e-167">Кроме того, добавлено новое ключевое слово строки соединения «TrustServerCertificate».</span><span class="sxs-lookup"><span data-stu-id="4407e-167">In addition, a new connection string keyword, "TrustServerCertificate", has been added.</span></span> <span data-ttu-id="4407e-168">Оно принимает значения «yes» и «no», значение по умолчанию — «no».</span><span class="sxs-lookup"><span data-stu-id="4407e-168">It accepts yes or no values; "no" is the default.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4407e-169">См. также:</span><span class="sxs-lookup"><span data-stu-id="4407e-169">See Also</span></span>  
 [<span data-ttu-id="4407e-170">Компоненты собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="4407e-170">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
