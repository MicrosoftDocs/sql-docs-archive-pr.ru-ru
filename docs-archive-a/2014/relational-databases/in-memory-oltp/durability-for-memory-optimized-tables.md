---
title: Устойчивость оптимизированных для памяти таблиц | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: d304c94d-3ab4-47b0-905d-3c8c2aba9db6
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 1d48d671b23d7b7b17557e7829d6f2522c375acd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87738405"
---
# <a name="durability-for-memory-optimized-tables"></a><span data-ttu-id="f2925-102">Устойчивость таблиц, оптимизированных для памяти</span><span class="sxs-lookup"><span data-stu-id="f2925-102">Durability for Memory-Optimized Tables</span></span>
  [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] <span data-ttu-id="f2925-103">обеспечивает полную устойчивость хранения для таблиц, оптимизированных для памяти.</span><span class="sxs-lookup"><span data-stu-id="f2925-103">provides full durability for memory-optimized tables.</span></span> <span data-ttu-id="f2925-104">При фиксации транзакции, которая изменила таблицу, оптимизированную для памяти, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (как и для дисковых таблиц) гарантирует, что изменения будут необратимы (выдержат перезапуск базы данных) при доступности используемого хранилища.</span><span class="sxs-lookup"><span data-stu-id="f2925-104">When a transaction that changed a memory-optimized table commits, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (as it does for disk-based tables), guarantees that the changes are permanent (will survive a database restart), provided the underlying storage is available.</span></span> <span data-ttu-id="f2925-105">Есть два ключевых компонента устойчивости таблицы: ведение журнала транзакций и сохранение изменений данных в хранилище на диске.</span><span class="sxs-lookup"><span data-stu-id="f2925-105">There are two key components of durability: transaction logging and persisting data changes to on-disk storage.</span></span>

## <a name="transaction-log"></a><span data-ttu-id="f2925-106">Журнал транзакций</span><span class="sxs-lookup"><span data-stu-id="f2925-106">Transaction Log</span></span>
 <span data-ttu-id="f2925-107">Все изменения, внесенные в таблицы на диске или устойчивые таблицы, оптимизированные для памяти, заносятся в одну или несколько записей журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="f2925-107">All changes made to disk-based tables or durable memory-optimized tables are captured in one or more transaction log records.</span></span> <span data-ttu-id="f2925-108">При фиксации транзакции службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] сохраняют записи журнала, связанные с этой транзакцией, на диск до отправки приложению или сеансу пользователя сообщению о завершении фиксации транзакции.</span><span class="sxs-lookup"><span data-stu-id="f2925-108">When a transaction commits, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] writes the log records associated with the transaction to disk before communicating to the application or user session that the transaction has committed.</span></span> <span data-ttu-id="f2925-109">Это гарантирует, что изменения, внесенные транзакцией, будут устойчивы.</span><span class="sxs-lookup"><span data-stu-id="f2925-109">This guarantees that changes made by the transaction are durable.</span></span> <span data-ttu-id="f2925-110">Журнал транзакций для оптимизированных для памяти таблиц полностью интегрирован с тем же потоком журнала, который используется дисковыми таблицами.</span><span class="sxs-lookup"><span data-stu-id="f2925-110">The transaction log for memory-optimized tables is fully integrated with the same log stream used by disk-based tables.</span></span> <span data-ttu-id="f2925-111">Такая интеграция обеспечивает продолжение работы существующих операций резервного копирования, восстановления и воссоздания журнала транзакций без каких-либо дополнительных шагов.</span><span class="sxs-lookup"><span data-stu-id="f2925-111">This integration allows existing transaction log backup, recover, and restore operations to continue to work without requiring any additional steps.</span></span> <span data-ttu-id="f2925-112">Однако [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] может значительно увеличивать пропускную способность по отношению к рабочей нагрузке транзакций, поэтому необходимо убедиться, что хранилище журнала транзакций настроено правильно, с учетом увеличения количества операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="f2925-112">However, since [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] can increase transaction throughput of your workload significantly, you need to make sure that transaction log storage is configured appropriately to handle the increased IO requirements.</span></span>

## <a name="data-and-delta-files"></a><span data-ttu-id="f2925-113">Файлы данных и разностные файлы</span><span class="sxs-lookup"><span data-stu-id="f2925-113">Data and Delta Files</span></span>
 <span data-ttu-id="f2925-114">Данные в таблицах, оптимизированных для памяти, хранятся в строках данных свободной формы, которые связаны с помощью одного или нескольких индексов в памяти.</span><span class="sxs-lookup"><span data-stu-id="f2925-114">The data in memory-optimized tables is stored as free-form data rows that are linked through one or more in-memory indexes, in memory.</span></span> <span data-ttu-id="f2925-115">Для строк данных нет структур страниц, которые, в частности, используются для дисковых таблиц.</span><span class="sxs-lookup"><span data-stu-id="f2925-115">There are no page structures for data rows, such as those used for disk-based tables.</span></span> <span data-ttu-id="f2925-116">Когда приложение готово зафиксировать транзакцию, [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] создает записи журнала для транзакции.</span><span class="sxs-lookup"><span data-stu-id="f2925-116">When the application is ready to commit the transaction, the [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] generates the log records for the transaction.</span></span> <span data-ttu-id="f2925-117">Сохраняемость оптимизированных для памяти таблиц достигается за счет набора данных и разностных файлов с использованием фонового потока.</span><span class="sxs-lookup"><span data-stu-id="f2925-117">The persistence of memory-optimized tables is done with a set of data and delta files using a background thread.</span></span> <span data-ttu-id="f2925-118">Файлы данных и разностные файлы содержатся в одном или нескольких контейнерах (при этом используется тот же механизм, что и для данных FILESTREAM).</span><span class="sxs-lookup"><span data-stu-id="f2925-118">The data and delta files are located in one or more containers (using the same mechanism used for FILESTREAM data).</span></span> <span data-ttu-id="f2925-119">Эти контейнеры сопоставляются с новым типом файловой группы, который называется файловой группой, оптимизированной для памяти.</span><span class="sxs-lookup"><span data-stu-id="f2925-119">These containers are mapped to a new type of filegroup, called a memory-optimized filegroup.</span></span>

 <span data-ttu-id="f2925-120">Данные в эти файлы записываются строго последовательно, что минимизирует задержку вращающихся дисков.</span><span class="sxs-lookup"><span data-stu-id="f2925-120">Data is written to these files in a strictly sequential fashion, which minimizes disk latency for spinning media.</span></span> <span data-ttu-id="f2925-121">Можно использовать несколько контейнеров на разных дисках для распределения операций ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="f2925-121">You can use multiple containers on different disks to distribute the I/O activity.</span></span> <span data-ttu-id="f2925-122">Файлы данных и разностные файлы в нескольких контейнерах на разных дисках позволяют повысить производительность восстановления при считывании данных из файлов данных и разностных файлов на диске в память.</span><span class="sxs-lookup"><span data-stu-id="f2925-122">Data and delta files in multiple containers on different disks will increase recovery performance when data is read from the data and delta files on disk, into memory.</span></span>

 <span data-ttu-id="f2925-123">Приложение напрямую не обращается к файлам данным и разностным файлам.</span><span class="sxs-lookup"><span data-stu-id="f2925-123">An application does not directly access data and delta files.</span></span> <span data-ttu-id="f2925-124">Все операции чтения и записи используют данные в памяти.</span><span class="sxs-lookup"><span data-stu-id="f2925-124">All data reads and writes use in-memory data.</span></span>

### <a name="the-data-file"></a><span data-ttu-id="f2925-125">Файл данных</span><span class="sxs-lookup"><span data-stu-id="f2925-125">The Data File</span></span>
 <span data-ttu-id="f2925-126">Файл данных содержит строки из одной или нескольких оптимизированных для памяти таблиц, которые были вставлены несколькими транзакциями как часть операций INSERT или UPDATE.</span><span class="sxs-lookup"><span data-stu-id="f2925-126">A data file contains rows from one or more memory-optimized tables that were inserted by multiple transactions as part of INSERT or UPDATE operations.</span></span> <span data-ttu-id="f2925-127">Например, одна строка может быть из оптимизированной для памяти таблицы T1, а следующая строка — из таблицы T2.</span><span class="sxs-lookup"><span data-stu-id="f2925-127">For example, one row can be from memory-optimized table T1 and the next row can be from memory-optimized table T2.</span></span> <span data-ttu-id="f2925-128">Строки добавляются в файл данных в порядке транзакций в журнале транзакций и обеспечивают последовательный доступ к данным.</span><span class="sxs-lookup"><span data-stu-id="f2925-128">The rows are appended to the data file in the order of transactions in the transaction log, making data access sequential.</span></span> <span data-ttu-id="f2925-129">Это на порядок увеличивает пропускную способность ввода-вывода по сравнению с операциями ввода-вывода с произвольным доступом.</span><span class="sxs-lookup"><span data-stu-id="f2925-129">This enables an order of magnitude better I/O throughput compared to random I/O.</span></span> <span data-ttu-id="f2925-130">Каждый файл данных имеет размер примерно в 128 МБ для компьютеров с памятью больше 16 ГБ и 16 МБ для компьютеров с памятью, меньшей или равной 16 ГБ.</span><span class="sxs-lookup"><span data-stu-id="f2925-130">Each data file is sized approximately to 128MB for computers with memory greater than 16GB, and 16MB for computers with less than or equal to 16GB.</span></span> <span data-ttu-id="f2925-131">После заполнения файла данных строки, вставляемые новыми транзакциями, сохраняются в другом файле данных.</span><span class="sxs-lookup"><span data-stu-id="f2925-131">Once the data file is full, the rows inserted by new transactions are stored in another data file.</span></span> <span data-ttu-id="f2925-132">Со временем строки из устойчивых, оптимизированных для памяти таблиц сохраняются в одном из нескольких файлов данных и каждый файл данных содержит строки из разного, но сопряженного набора транзакций.</span><span class="sxs-lookup"><span data-stu-id="f2925-132">Over time, the rows from durable memory-optimized tables are stored in one of more data files and each data file containing rows from a disjoint but contiguous range of transactions.</span></span> <span data-ttu-id="f2925-133">Например, файл данных с диапазоном метки времени фиксации (100, 200) содержит все строки, вставленные транзакциями с меткой времени фиксации, большей 100 и меньшей или равной 200.</span><span class="sxs-lookup"><span data-stu-id="f2925-133">For example a data file with transaction commit timestamp in the range of (100, 200) has all the rows inserted by transactions that have commit timestamp greater than 100 and less than or equal to 200.</span></span> <span data-ttu-id="f2925-134">Метка времени фиксации — монотонно возрастающее число, назначаемое транзакции в тот момент, когда она готова для фиксации.</span><span class="sxs-lookup"><span data-stu-id="f2925-134">The commit timestamp is a monotonically increasing number assigned to a transaction when it is ready to commit.</span></span> <span data-ttu-id="f2925-135">Каждая транзакция имеет уникальную метку времени фиксации.</span><span class="sxs-lookup"><span data-stu-id="f2925-135">Each transaction has a unique commit timestamp.</span></span>

 <span data-ttu-id="f2925-136">После удаления или обновления строки эта строка не удаляется и не изменяется на месте в файле данных, а удаленные строки отслеживаются в другом файле, например в разностном файле.</span><span class="sxs-lookup"><span data-stu-id="f2925-136">When a row is deleted or updated, the row is not removed or changed in-place in the data file but the deleted rows are tracked in another type of file: the delta file.</span></span> <span data-ttu-id="f2925-137">Операции обновления обрабатываются как набор операций вставки и удаления для каждой строки.</span><span class="sxs-lookup"><span data-stu-id="f2925-137">Update operations are processed as a tuple of delete and insert operations for each row.</span></span> <span data-ttu-id="f2925-138">Это позволяет исключить произвольные операции ввода-вывода для файла данных.</span><span class="sxs-lookup"><span data-stu-id="f2925-138">This eliminates random IO on the data file.</span></span>

### <a name="the-delta-file"></a><span data-ttu-id="f2925-139">Разностный файл</span><span class="sxs-lookup"><span data-stu-id="f2925-139">The Delta File</span></span>
 <span data-ttu-id="f2925-140">Каждый файл данных сопряжен с разностным файлом с таким же диапазоном транзакций и отслеживает удаленные строки, вставленные транзакциями в этом диапазоне.</span><span class="sxs-lookup"><span data-stu-id="f2925-140">Each data file is paired with a delta file that has the same transaction range and tracks the deleted rows inserted by transactions in the transaction range.</span></span> <span data-ttu-id="f2925-141">Эти данные и разностный файл называются парой файлов контрольных точек и являются единицей выделения и перераспределения, а также единицей операций слияния.</span><span class="sxs-lookup"><span data-stu-id="f2925-141">This data and delta file is referred to as a Checkpoint File Pair (CFP) and it is the unit of allocation and deallocation as well as the unit for Merge operations.</span></span> <span data-ttu-id="f2925-142">Например, разностный файл, соответствующий диапазону транзакций (100, 200), будет хранить удаленные строки, вставленные транзакциями в диапазоне (100, 200).</span><span class="sxs-lookup"><span data-stu-id="f2925-142">For example, a delta file corresponding to transaction range (100, 200) will store deleted rows that were inserted by transactions in the range (100, 200).</span></span> <span data-ttu-id="f2925-143">Как и файлы данных, доступ к разностному файлу осуществляется последовательно.</span><span class="sxs-lookup"><span data-stu-id="f2925-143">Like data files, the delta file is accessed sequentially.</span></span>

 <span data-ttu-id="f2925-144">При удалении строки эта строка не удаляется. Вместо этого добавляется ссылка к строке в разностный файл данных, связанный с диапазоном транзакций, в который вставлена эта строка данных.</span><span class="sxs-lookup"><span data-stu-id="f2925-144">When a row is deleted, the row is not removed from the data file but a reference to the row is appended to the delta file associated with the transaction range where this data row was inserted.</span></span> <span data-ttu-id="f2925-145">Поскольку удаляемая строка уже существует в файле данных, разностный файл только сохраняет информацию о ссылке `{inserting_tx_id, row_id, deleting_tx_id }` , следуя порядку в журнале транзакций с исходными операциями удаления или обновления.</span><span class="sxs-lookup"><span data-stu-id="f2925-145">Since the row to be deleted already exists in the data file, the delta file only stores the reference information `{inserting_tx_id, row_id, deleting_tx_id }` and it follows the transactional log order of the originating delete or update operations.</span></span>

## <a name="populating-data-and-delta-files"></a><span data-ttu-id="f2925-146">Отобразить файлы данных и разностные файлы</span><span class="sxs-lookup"><span data-stu-id="f2925-146">Populating Data and Delta Files</span></span>
 <span data-ttu-id="f2925-147">Файл данных и разностный файл заполняются фоновым потоком, который называется автономной контрольной точкой.</span><span class="sxs-lookup"><span data-stu-id="f2925-147">Data and delta file are populated by a background thread called offline checkpoint.</span></span> <span data-ttu-id="f2925-148">Этот поток считывает записи журнала транзакций, которые выполнялись с оптимизированными для памяти таблицами, и добавляет сведения о вставленных и удаленных строках в соответствующий файл данных и разностный файл.</span><span class="sxs-lookup"><span data-stu-id="f2925-148">This thread reads the transaction log records generated by committed transactions on memory-optimized tables and appends information about the inserted and deleted rows into appropriate data and delta files.</span></span> <span data-ttu-id="f2925-149">В отличие от дисковых таблиц, для которых страницы данных и индексов заполняются случайным вводом и выводом при достижении контрольной точки, сохранение оптимизированной для памяти таблицы — это непрерывная фоновая операция.</span><span class="sxs-lookup"><span data-stu-id="f2925-149">Unlike disk-based tables where data/index pages are flushed with random I/O when checkpoint is done, the persistence of memory-optimized table is continuous background operation.</span></span> <span data-ttu-id="f2925-150">Выполняется обращение к нескольким разностным файлам, поскольку транзакция может удалить или обновить любую строку, вставленную предыдущей транзакцией.</span><span class="sxs-lookup"><span data-stu-id="f2925-150">Multiple delta files are accessed because a transaction can delete or update any row that was inserted by any previous transaction.</span></span> <span data-ttu-id="f2925-151">Сведения об удалении всегда добавляются в конец разностного файла.</span><span class="sxs-lookup"><span data-stu-id="f2925-151">Deletion information is always appended at the end of the delta file.</span></span> <span data-ttu-id="f2925-152">Например, транзакция с меткой времени фиксации 600 вставляет одну новую строку и удаляет строки, вставленные транзакциями с меткой времени фиксации 150, 250 и 450, как показано на рисунке ниже.</span><span class="sxs-lookup"><span data-stu-id="f2925-152">For example, a transaction with a commit timestamp of 600 inserts one new row and deletes rows inserted by transactions with a commit timestamp of 150, 250 and 450 as shown in the picture below.</span></span> <span data-ttu-id="f2925-153">Все операции ввода-вывода с четырьмя файлами (три для удаленных строк и один для вставленных строк) — это операции, дополняющие соответствующие файлы данных и разностные файлы.</span><span class="sxs-lookup"><span data-stu-id="f2925-153">All 4 file I/O operations (three for deleted rows and 1 for the newly inserted rows), are append-only operations to the corresponding delta and data files.</span></span>

 <span data-ttu-id="f2925-154">![Чтение записей журнала для таблиц, оптимизированных для памяти.](../../database-engine/media/read-logs-hekaton.gif "Чтение записей журнала для таблиц, оптимизированных для памяти.")</span><span class="sxs-lookup"><span data-stu-id="f2925-154">![Read log records for memory-optimized tables.](../../database-engine/media/read-logs-hekaton.gif "Read log records for memory-optimized tables.")</span></span>

## <a name="accessing-data-and-delta-files"></a><span data-ttu-id="f2925-155">Доступ к файлам данных и разностным файлам</span><span class="sxs-lookup"><span data-stu-id="f2925-155">Accessing Data and Delta Files</span></span>
 <span data-ttu-id="f2925-156">Доступ к парам файлов данных и разностных файлов осуществляется в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="f2925-156">Data and delta file pairs are accessed when the following occurs.</span></span>

 <span data-ttu-id="f2925-157">Поток контрольных точек вне сети. Этот поток добавляет операции вставки и удаления в строки оптимизированных для памяти данных с соответствующими парами данных и разностных файлов.</span><span class="sxs-lookup"><span data-stu-id="f2925-157">Offline checkpoint thread This thread appends inserts and deletes to memory-optimized data rows, to the corresponding data and delta file pairs.</span></span>

 <span data-ttu-id="f2925-158">Операция Merge операция выполняет слияние одной или нескольких пар файлов данных и разностного файла и создает новую пару данных и разностных файлов.</span><span class="sxs-lookup"><span data-stu-id="f2925-158">Merge operation The operation merges one or more data and delta file pairs and creates a new data and delta file pair.</span></span>

 <span data-ttu-id="f2925-159">При восстановлении после сбоя при [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] перезапуске или переходе базы данных в режим «в сети» данные, оптимизированные для памяти, заполняются с помощью пар файлов данных и разностного файла.</span><span class="sxs-lookup"><span data-stu-id="f2925-159">During crash recovery When [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is restarted or the database is brought back online, the memory-optimized data is populated using the data and delta file pairs.</span></span> <span data-ttu-id="f2925-160">Разностный файл выступает в качестве фильтра для удаленных строк при чтении строк из соответствующего файла данных.</span><span class="sxs-lookup"><span data-stu-id="f2925-160">The delta file acts as a filter for the deleted rows when reading the rows from the corresponding data file.</span></span> <span data-ttu-id="f2925-161">Поскольку каждая пара файлов данных и разностных файлов не зависит друг от друга, эти файлы загружаются одновременно для уменьшения времени, затраченного для добавления данных в память.</span><span class="sxs-lookup"><span data-stu-id="f2925-161">Because each data and delta file pair is independent, these files are loaded in parallel to reduce the time taken to populate data into memory.</span></span> <span data-ttu-id="f2925-162">После загрузки данных в память подсистема OLTP в памяти применяет записи активного журнала транзакций, которые еще не были включены в файлы контрольных точек, чтобы полностью восстановить последнее состояние оптимизированных для памяти данных.</span><span class="sxs-lookup"><span data-stu-id="f2925-162">Once the data has been loaded into memory, the In-Memory OLTP engine applies the active transaction log records not yet covered by the checkpoint files so that the memory-optimized data is complete.</span></span>

 <span data-ttu-id="f2925-163">Во время операции восстановления файлы контрольных точек выполняющейся в памяти OLTP создаются из резервной копии базы данных, а затем применяются одна или несколько резервных копий журналов транзакций.</span><span class="sxs-lookup"><span data-stu-id="f2925-163">During restore operation The In-Memory OLTP checkpoint files are created from the database backup, and then one or more transaction log backups are applied.</span></span> <span data-ttu-id="f2925-164">Как и при восстановлении после сбоя, подсистема In-Memory OLTP загружает данные в память параллельно, чтобы свести к минимуму влияние на время восстановления.</span><span class="sxs-lookup"><span data-stu-id="f2925-164">As with crash recovery, the In-Memory OLTP engine loads data into memory in parallel, to minimize the impact on recovery time.</span></span>

## <a name="merging-data-and-delta-files"></a><span data-ttu-id="f2925-165">Объединение файлов данных и разностных файлов</span><span class="sxs-lookup"><span data-stu-id="f2925-165">Merging Data and Delta Files</span></span>
 <span data-ttu-id="f2925-166">Данные для оптимизированных для памяти таблиц хранятся в одной паре файла данных и разностного файла или в нескольких парах (которые также называют парой файлов контрольных точек или CFP).</span><span class="sxs-lookup"><span data-stu-id="f2925-166">The data for memory optimized tables is stored in one or more data and delta file pairs (also called a checkpoint file pair, or CFP).</span></span> <span data-ttu-id="f2925-167">Файлы данных хранят вставленные строки, а разностные файлы содержат ссылки на удаленные строки.</span><span class="sxs-lookup"><span data-stu-id="f2925-167">Data files store inserted rows and delta files reference deleted rows.</span></span> <span data-ttu-id="f2925-168">Во время выполнения рабочей нагрузки OLTP, пока операции DML обновляют, вставляют и удаляют строки, формируются новые пары файлов для сохранения новых строк, а ссылки на удаленные строки вводятся в разностные файлы.</span><span class="sxs-lookup"><span data-stu-id="f2925-168">During the execution of an OLTP workload, as the DML operations update, insert, and delete rows, new CFPs are created to persist the new rows, and the reference to the deleted rows is appended to delta files.</span></span>

 <span data-ttu-id="f2925-169">Метаданные всех ранее закрытых и активных пар файлов хранятся во внутреннем массиве, который называется массивом хранения.</span><span class="sxs-lookup"><span data-stu-id="f2925-169">The metadata of all previously-closed and currently active CFPs is stored in an internal array structure referred to as the storage array.</span></span> <span data-ttu-id="f2925-170">Это массив CFP из 8192 записей.</span><span class="sxs-lookup"><span data-stu-id="f2925-170">It is a finitely sized (8,192 entries) array of CFPs.</span></span> <span data-ttu-id="f2925-171">Записи в массиве хранения упорядочены по диапазону транзакций.</span><span class="sxs-lookup"><span data-stu-id="f2925-171">The entries in the storage array are ordered by transaction range.</span></span> <span data-ttu-id="f2925-172">Пары файлов в массиве хранения (вместе с порядком журнала) представляют все дисковые состояния, необходимые для восстановления базы данных с помощью оптимизированных для памяти таблиц.</span><span class="sxs-lookup"><span data-stu-id="f2925-172">The CFPs in the storage array (along with the tail of the log) represent all the on-disk state required to recover a database with memory-optimized tables.</span></span>

 <span data-ttu-id="f2925-173">Со временем при выполнении операций DML увеличивается число CFP, что исчерпывает предел массива хранилища и ведет к появлению следующих сложностей.</span><span class="sxs-lookup"><span data-stu-id="f2925-173">Over time, with DML operations, the number of CFPs grow causing the storage array to reach capacity, which introduces the following challenges:</span></span>

-   <span data-ttu-id="f2925-174">Удаленные строки.</span><span class="sxs-lookup"><span data-stu-id="f2925-174">Deleted rows.</span></span>  <span data-ttu-id="f2925-175">Удаленные строки остаются в файле данных, но отмечаются как удаленные в соответствующем разностном файле.</span><span class="sxs-lookup"><span data-stu-id="f2925-175">Deleted rows remain in the data file but are marked as deleted in the corresponding delta file.</span></span> <span data-ttu-id="f2925-176">Эти строки больше не требуются и будут удалены из хранилища.</span><span class="sxs-lookup"><span data-stu-id="f2925-176">These rows are no longer needed and will be removed from the storage.</span></span> <span data-ttu-id="f2925-177">Если удаленные строки не были удалены из пар файлов, то они будут занимать свободное место и увеличивать время восстановления.</span><span class="sxs-lookup"><span data-stu-id="f2925-177">If deleted rows were not removed from CFPs, they would use space unnecessarily and make recovery time slower.</span></span>

-   <span data-ttu-id="f2925-178">Полный массив хранения.</span><span class="sxs-lookup"><span data-stu-id="f2925-178">Storage array full.</span></span> <span data-ttu-id="f2925-179">Когда в массиве хранения выделено 8000 записей (192 записи в массиве зарезервированы для завершения существующих слияний либо для того, чтобы у вас была возможность выполнения слияний вручную), новые транзакции DML с устойчивыми, оптимизированными для памяти таблицами, не выполняются.</span><span class="sxs-lookup"><span data-stu-id="f2925-179">When there 8,000 entries in the storage array are allocated (192 entries in the array are reserved for existing merges to compete or to allow you to do manual merges), no new DML transactions can be executed on durable memory-optimized tables.</span></span> <span data-ttu-id="f2925-180">Только операции контрольной точки и слияния могут использовать оставшиеся записи.</span><span class="sxs-lookup"><span data-stu-id="f2925-180">Only checkpoint and merge operations are allowed to consume the remaining entries.</span></span> <span data-ttu-id="f2925-181">Благодаря этому операции DML не заполняют массив и некоторые записи в массиве могут объединять существующие файлы и получат место в массиве.</span><span class="sxs-lookup"><span data-stu-id="f2925-181">This ensures that DML transactions do not fill the array and that some entries in the array are reserved to merge existing files and to reclaim space in the array.</span></span>

-   <span data-ttu-id="f2925-182">Издержки управления массивом хранения.</span><span class="sxs-lookup"><span data-stu-id="f2925-182">Storage array manipulation overhead.</span></span> <span data-ttu-id="f2925-183">Внутренние процессы ищут в массиве хранения такие операции, как поиск разностного файла, чтобы добавить сведения об удаленной строке.</span><span class="sxs-lookup"><span data-stu-id="f2925-183">Internal processes search the storage array for operations such as finding the delta file to append information about a deleted row.</span></span> <span data-ttu-id="f2925-184">Чем больше число записей, тем больше ресурсов нужно на выполнение этих операций.</span><span class="sxs-lookup"><span data-stu-id="f2925-184">The cost of these operations increases with the number of entries.</span></span>

 <span data-ttu-id="f2925-185">Чтобы избавиться от неэффективности, старые закрытые пары файлов объединяются на основе рассмотренной ниже политике слияния, так что массив хранения сжимается и представляет тот же набор данных при меньшем числе пар файлов</span><span class="sxs-lookup"><span data-stu-id="f2925-185">To help prevent these inefficiencies, the older closed CFPs are merged, based on a merge policy described below, so the storage array is compacted to represent the same set of data, with a reduced number of CFPs.</span></span>

 <span data-ttu-id="f2925-186">Общий объем памяти всех устойчивых таблиц в базе данных не должен превышать 250 ГБ.</span><span class="sxs-lookup"><span data-stu-id="f2925-186">The total in-memory size of all durable tables in a database should not exceed 250 GB.</span></span> <span data-ttu-id="f2925-187">Устойчивые таблицы, использующие до 250 ГБ памяти, занимают на диске в среднем 500 ГБ пространства (с учетом операций вставки, удаления и обновления).</span><span class="sxs-lookup"><span data-stu-id="f2925-187">Durable tables that use up to 250 GB of memory will, assuming insert, delete, and update operations, require on average 500 GB of storage space.</span></span> <span data-ttu-id="f2925-188">Для поддержки 500 ГБ в хранилище необходимо 4000 пар файлов данных и разностных файлов в оптимизированной для памяти файловой группе.</span><span class="sxs-lookup"><span data-stu-id="f2925-188">4,000 data and delta file pairs in the memory-optimized file group are required to support the 500 GB of storage space.</span></span>

 <span data-ttu-id="f2925-189">Короткие всплески активности базы данных могут вызвать фиксацию контрольной точки и задержку операций слияния, что повышает требуемое количество пар разностных файлов.</span><span class="sxs-lookup"><span data-stu-id="f2925-189">Short-term surges in database activity may cause checkpoint and merge operations lag, which will increase the number of required data and delta file pairs.</span></span> <span data-ttu-id="f2925-190">Для учета коротких всплесков активности базы данных система хранения может выделить до 8000 пар разностных файлов объемом до 1 ТБ.</span><span class="sxs-lookup"><span data-stu-id="f2925-190">To accommodate short-term surges spikes in database activity, the storage system can allocate up to 8,000 data and delta file pairs up to a total of 1TB of storage.</span></span> <span data-ttu-id="f2925-191">При достижении этого предела новые транзакции в базе данных не разрешены, пока не завершатся операции контрольной точки.</span><span class="sxs-lookup"><span data-stu-id="f2925-191">When that limit is reached, there will be no new transactions allowed on the database until checkpoint operations catch up.</span></span> <span data-ttu-id="f2925-192">Если размер устойчивых таблиц в памяти превышает 250 ГБ в течение длительного времени, то есть вероятность достижения предела в 8000 пар разностных файлов.</span><span class="sxs-lookup"><span data-stu-id="f2925-192">If the size of durable tables in memory exceeds 250GB for long periods of time, there is a chance of reaching the 8,000 file pair limit.</span></span>

 <span data-ttu-id="f2925-193">Операция слияния принимает в качестве входа один или более смежных закрытых файлов (источник слияния), исходя из внутренней политики слияния, и создает одну результирующую пару файлов (цель слияния).</span><span class="sxs-lookup"><span data-stu-id="f2925-193">The merge operation takes as input one or more adjacent closed CFPs (called merge source) based on an internally defined merge policy, and produces one resultant CFP, called the merge target.</span></span> <span data-ttu-id="f2925-194">Записи в каждом разностном файле исходных пар файлов используются для фильтрации строк из соответствующего файла данных для удаления строк данных, которые больше не нужны.</span><span class="sxs-lookup"><span data-stu-id="f2925-194">The entries in each delta file of the source CFPs are used to filter rows from the corresponding data file to remove the data rows that are not needed.</span></span> <span data-ttu-id="f2925-195">Оставшиеся строки в исходных файлах объединяются в одну целевую пару файлов.</span><span class="sxs-lookup"><span data-stu-id="f2925-195">The remaining rows in the source CFPs are consolidated into one target CFP.</span></span> <span data-ttu-id="f2925-196">После слияния результирующая пара файлов заменяет исходную.</span><span class="sxs-lookup"><span data-stu-id="f2925-196">After the merge is complete, the resultant merge-target CFP replaces the source CFPs (merge sources).</span></span> <span data-ttu-id="f2925-197">Объединяемые исходные пары файлов проходят промежуточный этап, прежде чем будут удалены из хранилища.</span><span class="sxs-lookup"><span data-stu-id="f2925-197">The merge-source CFPs go through a transition phase before they are removed from storage.</span></span>

 <span data-ttu-id="f2925-198">В приведенном ниже примере у оптимизированной для памяти файловой группы таблицы четыре пары файлов данных и разностных файлов с меткой времени 500. Файлы содержат данные предыдущих транзакций.</span><span class="sxs-lookup"><span data-stu-id="f2925-198">In the example below, the memory-optimized table file group has four data and delta file pairs at timestamp 500 containing data from previous transactions.</span></span> <span data-ttu-id="f2925-199">Например, строки в первом файле данных соответствуют транзакциям с меткой времени больше 100 и меньше или равной 200. Это также можно записать в виде (100, 200].</span><span class="sxs-lookup"><span data-stu-id="f2925-199">For example, the rows in the first data file correspond to transactions with timestamp greater than 100 and less than or equal to 200; alternatively represented as (100, 200].</span></span> <span data-ttu-id="f2925-200">Как видим, второй и третий файлы данных заполнены меньше чем на 50 % после учета более 50 % строк, отмеченных как удаленные.</span><span class="sxs-lookup"><span data-stu-id="f2925-200">The second and third data files are shown to be less than 50 percent full after accounting for the rows marked as deleted.</span></span> <span data-ttu-id="f2925-201">Операция слияния объединяет эти две пары файлов и создает новую пару, содержащую транзакции с меткой времени больше 200 и меньше или равной 400, т. е. объединенный диапазон двух пар файлов.</span><span class="sxs-lookup"><span data-stu-id="f2925-201">The merge operation combines these two CFPs and creates a new CFP containing transactions with timestamp greater than 200 and less than or equal to 400, which is the combined range of these two CFPs.</span></span> <span data-ttu-id="f2925-202">Очевидно, что другая пара файлов с диапазоном (500, 600] и непустой разностный файл для диапазона транзакций (200, 400] показывают, что слияние может быть выполнено параллельно с транзакциями, включая удаление других строк из исходных пар файлов.</span><span class="sxs-lookup"><span data-stu-id="f2925-202">You see another CFP with range (500, 600] and non-empty delta file for transaction range (200, 400] shows that merge operation can be done concurrently with transactional activity including deleting more rows from the source CFPs.</span></span>

 <span data-ttu-id="f2925-203">![Диаграмма показывает файловую группу оптимизированной для памяти таблицы](../../database-engine/media/storagediagram-hekaton.png "Диаграмма показывает файловую группу оптимизированной для памяти таблицы")</span><span class="sxs-lookup"><span data-stu-id="f2925-203">![Diagram shows memory optimized table file group](../../database-engine/media/storagediagram-hekaton.png "Diagram shows memory optimized table file group")</span></span>

 <span data-ttu-id="f2925-204">Фоновый поток оценивает все закрытые пары файлов с помощью политики слияния и затем запускает один или несколько запросов слияния для выбранных пар файлов.</span><span class="sxs-lookup"><span data-stu-id="f2925-204">A background thread evaluates all closed CFPs using a merge policy and then initiates one or more merge requests for the qualifying CFPs.</span></span> <span data-ttu-id="f2925-205">Эти запросы слияния обрабатываются отдельным потоком контрольной точки вне сети.</span><span class="sxs-lookup"><span data-stu-id="f2925-205">These merge requests are processed by the offline checkpoint thread.</span></span> <span data-ttu-id="f2925-206">Оценка политики слияния выполняется периодически, а также когда закрывается контрольная точка.</span><span class="sxs-lookup"><span data-stu-id="f2925-206">The evaluation of merge policy is done periodically and also when a checkpoint is closed.</span></span>

### <a name="sssql14-merge-policy"></a>[!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] <span data-ttu-id="f2925-207">Политика слияния</span><span class="sxs-lookup"><span data-stu-id="f2925-207">Merge Policy</span></span>
 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] <span data-ttu-id="f2925-208">реализует описанную ниже политику слияния.</span><span class="sxs-lookup"><span data-stu-id="f2925-208">implements the following merge policy:</span></span>

-   <span data-ttu-id="f2925-209">Слияние добавляется в план, если две или более последовательные пары файлов могут быть объединены после учета удаленных строк, при этом результирующие строки должны войти в одну пару файлов идеального размера.</span><span class="sxs-lookup"><span data-stu-id="f2925-209">A merge is scheduled if 2 or more consecutive CFPs can be consolidated, after accounting for deleted rows, such that the resultant rows can fit into 1 CFP of ideal size.</span></span> <span data-ttu-id="f2925-210">Идеальный размер CFP определяется следующим образом.</span><span class="sxs-lookup"><span data-stu-id="f2925-210">The ideal size of CFP is determined as follows:</span></span>

    -   <span data-ttu-id="f2925-211">Если объем памяти компьютера меньше или равен 16 ГБ, то размер файла данных составляет 16 МБ, а разностного файла ― 1 МБ.</span><span class="sxs-lookup"><span data-stu-id="f2925-211">If a computer has less than or equal to 16GB of memory, the data file is 16MB and delta file is 1MB.</span></span>

    -   <span data-ttu-id="f2925-212">Если объем памяти компьютера больше 16 ГБ, то размер файла данных составляет 128 MБ, а разностного файла ― 16 МБ.</span><span class="sxs-lookup"><span data-stu-id="f2925-212">If a computer has greater than 16GB of memory, the data file is 128MB and delta file is 16MB.</span></span>

-   <span data-ttu-id="f2925-213">Может производиться слияние одного CFP с самим собой, если размер файла данных превышает 256 МБ и при этом удаляется более половины строк.</span><span class="sxs-lookup"><span data-stu-id="f2925-213">A single CFP can be self-merged if the data file exceeds 256 MB and more than half of the rows are deleted.</span></span> <span data-ttu-id="f2925-214">Размер файла данных может превысить 128 МБ, если, например, одна транзакция или несколько параллельных транзакций вставляют или обновляют большой объем данных, из-за чего размер файла данных превышает идеальное значение, так как транзакция не может охватывать несколько CFP.</span><span class="sxs-lookup"><span data-stu-id="f2925-214">A data file can grow larger than 128MB if, for example, a single transaction or multiple concurrent transactions inserts or updates large amount of data, forcing the data file to grow beyond its ideal size because a transaction cannot span multiple CFPs.</span></span>

 <span data-ttu-id="f2925-215">Ниже приведены некоторые примеры, которые показывают пары файлов, которые будут выбраны политикой слияния.</span><span class="sxs-lookup"><span data-stu-id="f2925-215">Here are some examples that show the CFPs that will be merged under the merge policy:</span></span>

|<span data-ttu-id="f2925-216">Смежные исходные пары файлов (% заполнения)</span><span class="sxs-lookup"><span data-stu-id="f2925-216">Adjacent CFPs Source Files (% full)</span></span>|<span data-ttu-id="f2925-217">Выборка при слиянии</span><span class="sxs-lookup"><span data-stu-id="f2925-217">Merge Selection</span></span>|
|-------------------------------------------|---------------------|
|<span data-ttu-id="f2925-218">CFP0 (30 %), CFP1 (50 %), CFP2 (50 %), CFP3 (90 %)</span><span class="sxs-lookup"><span data-stu-id="f2925-218">CFP0 (30%), CFP1 (50%), CFP2 (50%), CFP3 (90%)</span></span>|<span data-ttu-id="f2925-219">(CFP0, CFP1)</span><span class="sxs-lookup"><span data-stu-id="f2925-219">(CFP0, CFP1)</span></span><br /><br /> <span data-ttu-id="f2925-220">Пара файлов CFP2 не выбрана, так как результирующий файл данных будет более 100 % от идеального размера.</span><span class="sxs-lookup"><span data-stu-id="f2925-220">CFP2 is not chosen as it will make resultant data file greater than 100% of the ideal size.</span></span>|
|<span data-ttu-id="f2925-221">CFP0 (30 %), CFP1 (20 %), CFP2 (50 %), CFP3 (10 %)</span><span class="sxs-lookup"><span data-stu-id="f2925-221">CFP0 (30%), CFP1 (20%), CFP2 (50%), CFP3 (10%)</span></span>|<span data-ttu-id="f2925-222">(CFP0, CFP1, CFP2).</span><span class="sxs-lookup"><span data-stu-id="f2925-222">(CFP0, CFP1, CFP2).</span></span> <span data-ttu-id="f2925-223">Файлы выбираются, начиная слева.</span><span class="sxs-lookup"><span data-stu-id="f2925-223">Files are chosen starting from left.</span></span><br /><br /> <span data-ttu-id="f2925-224">Пара файлов CTP3 не выбрана, так как результирующий файл данных будет более 100 % от идеального размера.</span><span class="sxs-lookup"><span data-stu-id="f2925-224">CTP3 is not chosen as it will make resultant data file greater than 100% of the ideal size.</span></span>|
|<span data-ttu-id="f2925-225">CFP0 (80 %), CFP1 (30 %), CFP2 (10 %), CFP3 (40 %)</span><span class="sxs-lookup"><span data-stu-id="f2925-225">CFP0 (80%), CFP1 (30%), CFP2 (10%), CFP3 (40%)</span></span>|<span data-ttu-id="f2925-226">(CFP1, CFP2, CFP3).</span><span class="sxs-lookup"><span data-stu-id="f2925-226">(CFP1, CFP2, CFP3).</span></span> <span data-ttu-id="f2925-227">Файлы выбираются, начиная слева.</span><span class="sxs-lookup"><span data-stu-id="f2925-227">Files are chosen starting from left.</span></span><br /><br /> <span data-ttu-id="f2925-228">Пара файлов CFP0 пропущена, так как после объединения с CFP1 результирующий файл данных будет больше 100 % от идеального размера.</span><span class="sxs-lookup"><span data-stu-id="f2925-228">CFP0 is skipped because if combined with CFP1, the resultant data file will be greater than 100% of the ideal size.</span></span>|

 <span data-ttu-id="f2925-229">Не все пары файлов со свободным пространством подходят для слияния.</span><span class="sxs-lookup"><span data-stu-id="f2925-229">Not all CFPs with available space qualify for merge.</span></span> <span data-ttu-id="f2925-230">Например, если две смежные пары заполнены на 60 %, они не подходят для слияния, при этом у каждой пары остается 40 % неиспользованного пространства.</span><span class="sxs-lookup"><span data-stu-id="f2925-230">For example, if two adjacent CFPs are 60% full, they will not qualify for merge and each of these CFPs will have 40% storage unused.</span></span> <span data-ttu-id="f2925-231">В худшем случае все пары файлов будут заполнены на 50 %, т. е. использование хранилища будет равно 50 %.</span><span class="sxs-lookup"><span data-stu-id="f2925-231">In the worst case, all CFPs will be 50% full, a storage utilization of only 50%.</span></span> <span data-ttu-id="f2925-232">В то время как удаленные строки могут существовать в хранилище, поскольку пары файлов не подходят для слияния, они могли уже быть удалены из памяти в процессе внутренней сборки мусора.</span><span class="sxs-lookup"><span data-stu-id="f2925-232">While the deleted rows may exist in storage because the CFPs don't qualify for merge, the deleted rows may have already been removed from memory by in-memory garbage collection.</span></span> <span data-ttu-id="f2925-233">Управление хранением и памятью происходит независимо от сборки мусора.</span><span class="sxs-lookup"><span data-stu-id="f2925-233">The management of storage and the memory is independent from garbage collection.</span></span> <span data-ttu-id="f2925-234">Хранение, принятое активными парами файлов (не все пары файлов обновляются), может быть в 2 раза больше размера устойчивых таблиц в памяти.</span><span class="sxs-lookup"><span data-stu-id="f2925-234">Storage taken by active CFPs (not all CFPs are being updated) can be up to 2 times larger than the size of durable tables in memory.</span></span>

 <span data-ttu-id="f2925-235">При необходимости ручное слияние можно выполнить явным образом, вызвав [sys. sp_xtp_merge_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-xtp-merge-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f2925-235">If needed, a manual merge can be explicitly performed by calling [sys.sp_xtp_merge_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-xtp-merge-checkpoint-files-transact-sql).</span></span>

### <a name="life-cycle-of-a-cfp"></a><span data-ttu-id="f2925-236">Жизненный цикл пары файлов контрольной точки CFP</span><span class="sxs-lookup"><span data-stu-id="f2925-236">Life Cycle of a CFP</span></span>
 <span data-ttu-id="f2925-237">Пары файлов проходят несколько этапов, прежде чем они могут быть удалены из памяти.</span><span class="sxs-lookup"><span data-stu-id="f2925-237">CPFs transition through several states before they can be deallocated.</span></span> <span data-ttu-id="f2925-238">В любой момент времени пары файлов находятся на одной из этих стадий: PRECREATED, UNDER CONSTRUCTION, ACTIVE, MERGE TARGET, MERGED SOURCE, REQUIRED FOR BACKUP/HA, IN TRANSITION TO TOMBSTONE и TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="f2925-238">At any given time, the CFPs are in one of the following phases: PRECREATED, UNDER CONSTRUCTION, ACTIVE, MERGE TARGET, MERGED SOURCE, REQUIRED FOR BACKUP/HA, IN TRANSITION TO TOMBSTONE, and TOMBSTONE.</span></span> <span data-ttu-id="f2925-239">Описание этих этапов см. в разделе [sys.dm_db_xtp_checkpoint_files (Transact-SQL)](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f2925-239">For a description of these phases, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>

 <span data-ttu-id="f2925-240">После учета памяти, занимаемой парами файлов на различных стадиях, общий объем памяти, занимаемой устойчивыми, оптимизированными для памяти таблицами, может быть в 2 раза больше размера таблиц в памяти.</span><span class="sxs-lookup"><span data-stu-id="f2925-240">After accounting for the storage taken by CFPs in various states, the overall storage taken by durable memory-optimized tables can be much larger than 2 times the size of the tables in memory.</span></span> <span data-ttu-id="f2925-241">Можно выполнить запрос к&#41;у динамического административного представления [sys. dm_db_xtp_checkpoint_files &#40;Transact-SQL](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql) , чтобы получить список всех пары файлов в оптимизированной для памяти файловой группе, включая их этап.</span><span class="sxs-lookup"><span data-stu-id="f2925-241">The DMV [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql) can be queried to list all the CFPs in the memory-optimized filegroup, including their phase.</span></span> <span data-ttu-id="f2925-242">На переход CFP от состояния MERGE SOURCE к состоянию TOMBSTONE и сборку мусора может уйти до пяти контрольных точек, за каждой из которых следует создание резервной копии журнала транзакций, если в базе данных настроена модель полного восстановления или модель восстановления с неполным протоколированием.</span><span class="sxs-lookup"><span data-stu-id="f2925-242">Transitioning CFPs from MERGE SOURCE state to TOMBSTONE and ultimately garbage collection can take up five checkpoints, with each checkpoint followed by a transaction log backup, if the database is configured for full or bulk-logged recovery model.</span></span>

 <span data-ttu-id="f2925-243">Можно вручную создать контрольную точку и затем резервную копию журнала, чтобы ускорить сборку мусора, однако в этом случае будет добавлено 5 пустых пар файлов (5 пар файлов данных и разностных файлов по 128 МБ каждый).</span><span class="sxs-lookup"><span data-stu-id="f2925-243">You can manually force the checkpoint followed by log backup to expedite the garbage collection but then this will add 5 empty CFPs (5 data/delta file pairs with data file of size 128MB each).</span></span> <span data-ttu-id="f2925-244">В рабочих сценариях автоматические контрольные точки и резервные копии журналов в рамках стратегии резервного копирования будут безупречно проводить пары файлов по этим этапам без участия пользователя.</span><span class="sxs-lookup"><span data-stu-id="f2925-244">In production scenarios, the automatic checkpoints and log backups taken as part of backup strategy will seamlessly transition CFPs through these phases without requiring any manual intervention.</span></span> <span data-ttu-id="f2925-245">Влияние процесса сборки мусора заключается в том, что базы данных с оптимизированными для памяти таблицами могут иметь больший размер хранения по сравнению с размером в памяти.</span><span class="sxs-lookup"><span data-stu-id="f2925-245">The impact of the garbage collection process is that databases with memory-optimized tables may have a larger storage size compared to its size in memory.</span></span> <span data-ttu-id="f2925-246">Нередко встречаются CFP, размер которых по сравнению с устойчивыми, оптимизированными для памяти таблицами может быть вплоть до четырех раз больше.</span><span class="sxs-lookup"><span data-stu-id="f2925-246">It is not uncommon for CFPs to be up to four times the size of the durable memory-optimized tables in memory.</span></span>

## <a name="see-also"></a><span data-ttu-id="f2925-247">См. также:</span><span class="sxs-lookup"><span data-stu-id="f2925-247">See Also</span></span>
 [<span data-ttu-id="f2925-248">Создание и управление хранилищем для оптимизированных для памяти объектов</span><span class="sxs-lookup"><span data-stu-id="f2925-248">Creating and Managing Storage for Memory-Optimized Objects</span></span>](creating-and-managing-storage-for-memory-optimized-objects.md)


