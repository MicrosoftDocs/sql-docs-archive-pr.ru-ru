---
title: Оптимизированная для памяти файловая группа | Документация Майкрософт
ms.custom: ''
ms.date: 11/19/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 14106cc9-816b-493a-bcb9-fe66a1cd4630
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: a4ab6423159d0ba5a27af152cc5578905f57eec6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87668325"
---
# <a name="the-memory-optimized-filegroup"></a><span data-ttu-id="185f0-102">Оптимизированная для памяти файловая группа</span><span class="sxs-lookup"><span data-stu-id="185f0-102">The Memory Optimized Filegroup</span></span>
  <span data-ttu-id="185f0-103">Для создания оптимизированных для памяти таблиц необходимо сначала создать оптимизированную для памяти файловую группу.</span><span class="sxs-lookup"><span data-stu-id="185f0-103">To create memory-optimized tables, you must first create a memory-optimized filegroup.</span></span> <span data-ttu-id="185f0-104">Оптимизированная для памяти файловая группа содержит один или несколько контейнеров.</span><span class="sxs-lookup"><span data-stu-id="185f0-104">The memory-optimized filegroup holds one or more containers.</span></span> <span data-ttu-id="185f0-105">В каждом контейнере содержатся файлы данных или разностных файлы (или и те и другие).</span><span class="sxs-lookup"><span data-stu-id="185f0-105">Each container contains data files or delta files or both.</span></span>  
  
 <span data-ttu-id="185f0-106">Даже если строки данных из таблиц `SCHEMA_ONLY` не сохраняются, а метаданные оптимизированных для памяти таблиц и компилированных в собственном коде хранимых процедур хранятся в традиционных каталогах, модулю [!INCLUDE[hek_2](../../includes/hek-2-md.md)] все равно требуется оптимизированная для памяти файловая группа для оптимизированных для памяти таблиц `SCHEMA_ONLY`, чтобы обеспечить согласованную работу баз данных, в которых есть оптимизированные для памяти таблицы.</span><span class="sxs-lookup"><span data-stu-id="185f0-106">Even though data rows from `SCHEMA_ONLY` tables are not persisted and the metadata for memory-optimized tables and natively compiled stored procedures is stored in the traditional catalogs, the [!INCLUDE[hek_2](../../includes/hek-2-md.md)] engine still requires a memory-optimized filegroup for `SCHEMA_ONLY` memory-optimized tables to provide a uniform experience for databases with memory-optimized tables.</span></span>  
  
 <span data-ttu-id="185f0-107">В основе оптимизированной для памяти файловой группы лежит файловая группа FILESTREAM, но при этом имеются следующие отличия.</span><span class="sxs-lookup"><span data-stu-id="185f0-107">The memory-optimized filegroup is based on filestream filegroup, with the following differences:</span></span>  
  
-   <span data-ttu-id="185f0-108">Можно создать только одну оптимизированную для памяти файловую группу для одной базы данных.</span><span class="sxs-lookup"><span data-stu-id="185f0-108">You can only create one memory-optimized filegroup per database.</span></span> <span data-ttu-id="185f0-109">Необходимо явно пометить файловую группу как содержащую данные memory_optimized_data.</span><span class="sxs-lookup"><span data-stu-id="185f0-109">You need to explicitly mark the filegroup as containing memory_optimized_data.</span></span> <span data-ttu-id="185f0-110">Файловую группу можно создать при создании базы данных или же добавить ее позднее.</span><span class="sxs-lookup"><span data-stu-id="185f0-110">You can create the filegroup when you create the database or you can add it later:</span></span>  
  
    ```sql  
    ALTER DATABASE imoltp ADD FILEGROUP imoltp_mod CONTAINS MEMORY_OPTIMIZED_DATA  
    ```  
  
-   <span data-ttu-id="185f0-111">В файловую группу MEMORY_OPTIMIZED_DATA необходимо добавить один или несколько контейнеров.</span><span class="sxs-lookup"><span data-stu-id="185f0-111">You need to add one or more containers to the MEMORY_OPTIMIZED_DATA filegroup.</span></span> <span data-ttu-id="185f0-112">Пример:</span><span class="sxs-lookup"><span data-stu-id="185f0-112">For example:</span></span>  
  
    ```sql  
    ALTER DATABASE imoltp ADD FILE (name='imoltp_mod1', filename='c:\data\imoltp_mod1') TO FILEGROUP imoltp_mod  
    ```  
  
-   <span data-ttu-id="185f0-113">Для создания оптимизированной для памяти файловой группы не требуется включать файловый поток ([Включение и настройка FILESTREAM](../blob/enable-and-configure-filestream.md)).</span><span class="sxs-lookup"><span data-stu-id="185f0-113">You do not need to enable filestream ([Enable and Configure FILESTREAM](../blob/enable-and-configure-filestream.md)) to create a memory-optimized filegroup.</span></span> <span data-ttu-id="185f0-114">Сопоставление с файловым потоком выполняется модулем [!INCLUDE[hek_2](../../includes/hek-2-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="185f0-114">The mapping to filestream is done by the [!INCLUDE[hek_2](../../includes/hek-2-md.md)] engine.</span></span>  
  
-   <span data-ttu-id="185f0-115">В оптимизированную для памяти файловую группу можно добавлять новые контейнеры.</span><span class="sxs-lookup"><span data-stu-id="185f0-115">You can add new containers to a memory-optimized filegroup.</span></span> <span data-ttu-id="185f0-116">Вам может потребоваться новый контейнер для расширения хранилища, необходимого для устойчивой таблицы, оптимизированной для памяти, а также для распределения операций ввода-вывода по нескольким контейнерам.</span><span class="sxs-lookup"><span data-stu-id="185f0-116">You may need a new container to expand the storage needed for durable memory-optimized table and also to distribute I/O across multiple containers.</span></span>  
  
-   <span data-ttu-id="185f0-117">Перемещение данных в оптимизированной для памяти файловой группе оптимизировано в конфигурации группы доступности AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="185f0-117">Data movement with a memory-optimized filegroup is optimized in an AlwaysOn Availability Group configuration.</span></span> <span data-ttu-id="185f0-118">В отличие от файлов FILESTREAM, которые отправляются во вторичные реплики, файлы контрольных точек (файлы данных и разностные файлы) из оптимизированной для памяти файловой группы не отправляются во вторичные реплики.</span><span class="sxs-lookup"><span data-stu-id="185f0-118">Unlike filestream files that are sent to secondary replicas, the checkpoint files (both data and delta) within the memory-optimized filegroup are not sent to secondary replicas.</span></span> <span data-ttu-id="185f0-119">Файлы данных и разностные файлы формируются на вторичной реплике с помощью журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="185f0-119">The data and delta files are constructed using the transaction log on the secondary replica.</span></span>  
  
<span data-ttu-id="185f0-120">Далее приведены ограничения оптимизированной для памяти файловой группы.</span><span class="sxs-lookup"><span data-stu-id="185f0-120">The following limitations of memory-optimized filegroup,</span></span>  
  
-   <span data-ttu-id="185f0-121">После создания оптимизированной для памяти файловой группы удалить ее можно только после удаления базы данных.</span><span class="sxs-lookup"><span data-stu-id="185f0-121">Once you create a memory-optimized filegroup, you can only remove it by dropping the database.</span></span> <span data-ttu-id="185f0-122">В рабочей среде возникновение необходимости в удалении оптимизированной для памяти файловой группы маловероятно.</span><span class="sxs-lookup"><span data-stu-id="185f0-122">In a production environment, it is unlikely that you will need to remove the memory-optimized filegroup.</span></span>  
  
-   <span data-ttu-id="185f0-123">Невозможно удалить контейнер, который не является пустым, или перемещать пары, состоящие из файла данных и разностного файла, в другой контейнер в оптимизированной для памяти файловой группе.</span><span class="sxs-lookup"><span data-stu-id="185f0-123">You cannot drop a non-empty container or move data and delta file pairs to another container in the memory-optimized filegroup.</span></span>  
  
## <a name="configuring-a-memory-optimized-filegroup"></a><span data-ttu-id="185f0-124">Настройка оптимизированной для памяти файловой группы</span><span class="sxs-lookup"><span data-stu-id="185f0-124">Configuring a Memory-Optimized Filegroup</span></span>  
<span data-ttu-id="185f0-125">Рекомендуется создать несколько контейнеров в оптимизированной для памяти файловой группе и разместить их на разных дисках, чтобы получить большую пропускную способность по потоковой передаче данных в память.</span><span class="sxs-lookup"><span data-stu-id="185f0-125">Consider creating multiple containers in the memory-optimized filegroup and distribute them on different drives to achieve more bandwidth to stream the data into memory.</span></span>  
  
<span data-ttu-id="185f0-126">При настройке хранилища необходимо обеспечить наличие свободного места на диске, которое будет в четыре раза больше размера надежных, оптимизированных для памяти таблиц.</span><span class="sxs-lookup"><span data-stu-id="185f0-126">When configuring storage, you must provide free disk space that is four times the size of durable memory-optimized tables.</span></span> <span data-ttu-id="185f0-127">Убедитесь, что в подсистеме ввода-вывода поддерживаются требуемые для вашей рабочей нагрузки операции ввода в секунду.</span><span class="sxs-lookup"><span data-stu-id="185f0-127">Ensure that your I/O subsystem supports the required IOPS for your workload.</span></span> <span data-ttu-id="185f0-128">Если пары файлов данных и разностных файлов заполняются при данном IOPS, необходимо в три раза увеличить IOPS с учетом операций сортировки и объединения.</span><span class="sxs-lookup"><span data-stu-id="185f0-128">If data and delta file pairs are populated at a given IOPS, you need three times that IOPS to account for storing and merge operations.</span></span> <span data-ttu-id="185f0-129">Можно увеличить объем хранилища и IOPS путем добавления в оптимизированную для памяти файловую группу одного или нескольких контейнеров.</span><span class="sxs-lookup"><span data-stu-id="185f0-129">You can add storage capacity and IOPS by adding one or more containers to the memory-optimized filegroup.</span></span>  
  
<span data-ttu-id="185f0-130">При использовании нескольких контейнеров, размещенных на нескольких дисках, файлы данных и разностные файлы распределяются по контейнерам путем циклического перебора.</span><span class="sxs-lookup"><span data-stu-id="185f0-130">In a multiple container, multiple drive scenario, data and delta files are allocated in a round-robin fashion into containers.</span></span> <span data-ttu-id="185f0-131">Первый файл данных выделяется из первого контейнера, разностный файл — из следующего контейнера, после чего дальнейшее выделение производится таким же образом.</span><span class="sxs-lookup"><span data-stu-id="185f0-131">The first data file is allocated from the first container and the delta file is allocated from the next container and this allocation pattern repeats.</span></span> <span data-ttu-id="185f0-132">Эта схема выделения позволяет равномерно распределять файлы данных и разностные файлы по контейнерам при наличии нечетного числа дисков, каждый из которых сопоставлен с одним контейнером.</span><span class="sxs-lookup"><span data-stu-id="185f0-132">This allocation scheme distributes data and delta files evenly across containers if you have an odd number of drives, each mapped to one container.</span></span> <span data-ttu-id="185f0-133">Однако при наличии четного числа дисков, каждый из которых сопоставлен с одним контейнером, хранилище может получиться несбалансированным, когда файлы данных будут сопоставляться с нечетными дисками, а разностные файлы — с четными.</span><span class="sxs-lookup"><span data-stu-id="185f0-133">However, if you have an even number of drives, each mapped to a container, it can result in imbalanced storage with data files mapped to odd drives and delta files mapped to even drives.</span></span> <span data-ttu-id="185f0-134">Чтобы получить сбалансированный поток операций ввода-вывода при восстановлении, рассмотрите возможность размещения пар данных и разностных файлов на тех же дисках и хранилищах, как описано в примере ниже.</span><span class="sxs-lookup"><span data-stu-id="185f0-134">To obtain a balanced stream of I/O on recovery, consider placing pairs of data and delta files on the same spindles/storage as described in the example below.</span></span>  

> [!CAUTION]
> <span data-ttu-id="185f0-135">Если значение `MAXSIZE` задается для оптимизированной для памяти файловой группы и файлы контрольных точек превышают максимальный размер контейнера, база данных будет помечена как подозрительная (SUSPECT).</span><span class="sxs-lookup"><span data-stu-id="185f0-135">If a `MAXSIZE` value is set for the memory-optimized filegroup, and checkpoint files exceed the max size of the container, then the database will become SUSPECT.</span></span>   
> <span data-ttu-id="185f0-136">В этом случае не пытайтесь задать для базы данных режим OFFLINE и ONLINE, так как это приведет к переходу базы данных в состояние RECOVERY_PENDING.</span><span class="sxs-lookup"><span data-stu-id="185f0-136">In this case do not attempt to set the database OFFLINE and ONLINE, causing the database to stay in RECOVERY_PENDING state.</span></span>
  
### <a name="example"></a><span data-ttu-id="185f0-137">Пример</span><span class="sxs-lookup"><span data-stu-id="185f0-137">Example</span></span> 
<span data-ttu-id="185f0-138">Рассмотрим оптимизированную для памяти файловую группу с двумя контейнерами: контейнер 1 на диске X и контейнер 2 на дисках Y.</span><span class="sxs-lookup"><span data-stu-id="185f0-138">Consider a memory-optimized filegroup with two containers: container 1 on drive X and container 2 on drives Y.</span></span>  
<span data-ttu-id="185f0-139">Поскольку размещение файлов данных и разностных файлов осуществляется путем циклического перебора, в контейнере 1 будут находиться только файлы данных, а в контейнере 2 — только разностные файлы, что ведет к дисбалансу операций сохранения и ввода-вывода в секунду, поскольку файлы данных значительно больше, чем разностные файлы.</span><span class="sxs-lookup"><span data-stu-id="185f0-139">Since the allocation of data and delta files is done in round-robin fashion, container 1 will only have data files and container 2 will only have delta files, which leads to imbalanced persistence for storage as well as input/output operations per second, as data files are significantly larger than the delta files.</span></span>    
<span data-ttu-id="185f0-140">Чтобы равномерно распределить данные и разностные файлы на дисках X и Y, создайте четыре контейнера вместо двух и сопоставьте первые два контейнера с диском X, а следующие два контейнера — с диском Y.</span><span class="sxs-lookup"><span data-stu-id="185f0-140">To distribute data and delta files uniformly across drives X and Y, create four containers instead of two, and map the first two containers to drive X and the next two containers to drive Y.</span></span>  
<span data-ttu-id="185f0-141">При использовании циклического перебора сначала будут выделены данные и первый разностный файл из контейнера-1 и контейнера-2 соответственно, которые сопоставляются с диском X.</span><span class="sxs-lookup"><span data-stu-id="185f0-141">With round-robin allocation, the first data and first delta file will be allocated from container-1 and container-2 respectively, which are mapped to drive X.</span></span>   
<span data-ttu-id="185f0-142">Аналогичным образом следующие файлы данных и разностного файла будут выделены из контейнеров-3 и контейнеров-4, сопоставленных с диском Y. Это позволяет равномерно распространять данные и разностные файлы по двум дискам.</span><span class="sxs-lookup"><span data-stu-id="185f0-142">Similarly, the next data and delta file will be allocated from container-3 and container-4 which are mapped to drive Y. This allows distributing data and delta files across two drives uniformly.</span></span>  
 
  
## <a name="see-also"></a><span data-ttu-id="185f0-143">См. также:</span><span class="sxs-lookup"><span data-stu-id="185f0-143">See Also</span></span>  
<span data-ttu-id="185f0-144">[Создание и управление хранилищем для оптимизированных для памяти объектов](creating-and-managing-storage-for-memory-optimized-objects.md)   </span><span class="sxs-lookup"><span data-stu-id="185f0-144">[Creating and Managing Storage for Memory-Optimized Objects](creating-and-managing-storage-for-memory-optimized-objects.md)   </span></span>  
[<span data-ttu-id="185f0-145">Файлы и файловые группы базы данных</span><span class="sxs-lookup"><span data-stu-id="185f0-145">Database Files and Filegroups</span></span>](../../relational-databases/databases/database-files-and-filegroups.md)    
  
