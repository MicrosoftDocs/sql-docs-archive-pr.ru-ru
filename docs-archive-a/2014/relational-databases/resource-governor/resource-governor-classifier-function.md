---
title: Функция-классификатор регулятора ресурсов | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- Resource Governor, classifier function
- user-defined functions [SQL Server], classifier function
- classifier function [SQL Server]
- classifier function [SQL Server], overview
ms.assetid: 64c25012-7068-476f-afa2-0b4f3adde9a4
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 69b6fd10ac0adc6f76925e0d41f110b917111466
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87731466"
---
# <a name="resource-governor-classifier-function"></a>Resource Governor Classifier Function
  Процесс классификации регулятора ресурсов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] назначает входящие сеансы группе рабочей нагрузки с учетом характеристик сеанса. Логику классификации можно адаптировать путем написания определяемой пользователем функции, называемой функцией-классификатором.  
  
## <a name="classification"></a>Классификация  
 Регулятор ресурсов поддерживает классификацию входящих сеансов. Классификация основывается на наборе пользовательских критериев, содержащихся в функции. Результаты логики функции позволяют регулятору ресурсов классифицировать сеансы по существующим группам рабочей нагрузки.  
  
> [!NOTE]  
>  Внутренняя группа рабочей нагрузки наполняется запросами, предназначенными только для внутреннего использования. Критерии, используемые для перенаправления этих запросов, изменить нельзя, так же как нельзя классифицировать запросы во внутреннюю группу рабочей нагрузки.  
  
 Можно написать скалярную функцию с логикой, которая будет использоваться для назначения входящих сеансов в группу рабочей нагрузки. Перед использованием этой функции необходимо выполнить следующие действия.  
  
-   Создать и зарегистрировать функцию с помощью инструкции ALTER RESOURCE GOVERNOR. Дополнительные сведения см. в разделе [ALTER RESOURCE GOVERNOR (Transact-SQL)](/sql/t-sql/statements/alter-resource-governor-transact-sql).  
  
-   Обновить конфигурацию регулятора ресурсов с помощью инструкции ALTER RESOURCE GOVERNOR с параметром RECONFIGURE.  
  
 После создания функции и применения изменений в конфигурации классифицирующая функция регулятора ресурсов будет использовать возвращаемое этой функцией имя группы рабочей нагрузки для передачи нового запроса в соответствующую группу рабочей нагрузки.  
  
> [!IMPORTANT]  
>  Время ожидания клиентского сеанса истекает, если классифицирующая функция не завершается в течение заданного времени ожидания входа в систему. Время ожидания входа в систему — это клиентское свойство, поэтому серверу оно неизвестно. Долго выполняемая функция-классификатор может оставлять на сервере потерянные соединения в течение долгого времени. Важно создавать функции-классификаторы, выполнение которых завершается до истечения времени ожидания соединения.  
  
 Определяемая пользователем функция имеет следующие характеристики и поведение.  
  
-   Определяемая пользователем функция вычисляется для каждого нового сеанса, даже если включен пул соединений.  
  
-   Определяемая пользователем функция предоставляет контекст группы рабочей нагрузки для сеанса. После определения членства в группе сеанс привязывается к группе рабочей нагрузки на все время его существования.  
  
-   Если определяемая пользователем функция возвращает значение NULL, значение по умолчанию или имя несуществующей группы, то сеансу предоставляется контекст группы рабочей нагрузки по умолчанию. Кроме того, сеансу предоставляется контекст по умолчанию, если функция по какой-либо причине завершается неуспешно.  
  
-   Функция должна быть определена на уровне сервера (базы данных master).  
  
-   Обозначение определяемой пользователем функции-классификатора вступает в силу только после выполнения команды ALTER RESOURCE GOVERNOR RECONFIGURE.  
  
-   Одновременно в качестве классифицирующей функции может быть обозначена только одна определяемая пользователем функция.  
  
-   Определяемую пользователем функцию-классификатор можно удалить или изменить только после снятия с нее статуса «classifier».  
  
-   В отсутствие определяемой пользователем функции-классификатора все сеансы классифицируются в группу по умолчанию.  
  
-   Группа рабочей нагрузки, возвращенная классифицирующей функцией, выходит за пределы ограничений на привязку к схеме. Например, нельзя удалить таблицу, тогда как группу рабочей нагрузки удалить можно.  
  
> [!IMPORTANT]  
>  Рекомендуется включить на сервере выделенное административное соединение (DAC). Выделенное административное соединение не подлежит классификации регулятором ресурсов и может использоваться для наблюдения за неполадками классифицирующей функции и их устранения. Дополнительные сведения см. в разделе [Диагностическое соединение для администраторов баз данных](../../database-engine/configure-windows/diagnostic-connection-for-database-administrators.md). Если выделенное административное соединение недоступно для устранения неполадок, другой вариант — перезапустить систему в однопользовательском режиме. Хотя однопользовательский режим не подлежит классификации, он не дает возможности выполнить диагностику классификации регулятора ресурсов, если тот запущен.  
  
### <a name="classification-process"></a>Процесс классификации  
 В контексте регулятора ресурсов процесс входа в сеанс состоит из следующих этапов.  
  
1.  Проверка подлинности имени входа.  
  
2.  Выполнение триггера LOGON.  
  
3.  Классификация  
  
 После запуска сеанса классификатор регулятора ресурсов назначает этот сеанс группе рабочей нагрузки, и этот сеанс должен функционировать с использованием ресурсов, назначенных этой группе рабочей нагрузки.  
  
> [!NOTE]  
>  Сведения о выполнении классифицирующей функции и триггеров LOGON содержатся в представлениях [sys.dm_exec_sessions](/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-sessions-transact-sql) и [sys.dm_exec_requests](/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-requests-transact-sql).  
  
## <a name="classification-function-tasks"></a>Задачи классифицирующей функции  
  
|Описание задачи|Раздел|  
|----------------------|-----------|  
|Описывает, как создать и проверить определяемую пользователем функцию-классификатор.|[Создание и тестирование пользовательской функции-классификатора](create-and-test-a-classifier-user-defined-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [регулятор ресурсов](resource-governor.md)   
 [Активация регулятора ресурсов](enable-resource-governor.md)   
 [Пул ресурсов регулятора ресурсов](resource-governor-resource-pool.md)   
 [Группа рабочей нагрузки регулятора ресурсов](resource-governor-workload-group.md)   
 [Настройка регулятора ресурсов с помощью шаблона](configure-resource-governor-using-a-template.md)   
 [Просмотр свойств регулятора ресурсов](view-resource-governor-properties.md)  
  
  
