---
title: Хранилище данных управления | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- data collector [SQL Server], management data warehouse
- data warehouse
- management data warehouse
ms.assetid: 9874a8b2-7ccd-494a-944c-ad33b30b5499
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 96eb26c3e273832aead4aa0421304df17dc5b8ff
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87657816"
---
# <a name="management-data-warehouse"></a>хранилище данных управления
  Хранилище данных управления — это реляционная база данных, собираемых с сервера, который при сборе данных является целевым. Эти данные используются при подготовке отчетов для наборов сбора системных данных и могут быть использованы для создания настраиваемых отчетов.  
  
 Инфраструктура сборщика данных определяет планы выполнения заданий и планы обслуживания, необходимые для реализации политик хранения, определенных администратором базы данных.  
  
> [!IMPORTANT]  
>  В этой версии сборщика данных хранилище данных управления создается с помощью простой модели восстановления с целью минимизации объемов журнала. Для каждой организации следует реализовывать подходящую модель восстановления.  
  
## <a name="deploying-and-using-the-data-warehouse"></a>Развертывание и использование хранилища данных  
 Хранилище данных управления можно установить на том же экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , на котором работает сборщик данных. Однако, если ресурсы или производительность контролируемого сервера недостаточны, то хранилище данных управления можно установить на другом компьютере.  
  
 При создании хранилища данных управления создаются необходимые схемы и их объекты для стандартных системных наборов сбора. Создаются схемы core и snapshots. Третья схема, custom_snapshots, создается при создании наборов сбора (определенных пользователем), в которые входят элементы сбора, использующие тип сборщика "Универсальный запрос T-SQL".  
  
###### <a name="core-schema"></a>Схема core  
 Схема core определяет таблицы, хранимые процедуры и представления, используемые для организации и идентификации собранных данных. Эти таблицы являются общими для всех таблиц данных, созданных для конкретных типов сборщика. Эта схема заблокирована и может изменяться только владельцем базы данных хранилища данных управления. Имена таблиц в этой схеме дополняются префиксом «core».  
  
 В следующей таблице описаны таблицы базы данных в схеме core. Эти таблицы базы данных позволяют сборщику данных отслеживать источники данных, пользователей, вставивших данные, и время передачи в хранилище данных.  
  
|Имя таблицы|Описание|  
|----------------|-----------------|  
|core.performance_counter_report_group_items|Хранит сведения о группировке отчетов из хранилища данных управления, а также статистику счетчиков производительности.|  
|core.snapshots_internal|Определяет каждый новый моментальный снимок. Новая строка вставляется в эту таблицу каждый раз, когда пакет передачи начинает передачу нового пакета данных.|  
|core.snapshot_timetable_internal|Хранит сведения о времени создания моментальных снимков. Время создания моментального снимка хранится в отдельной таблице, поскольку множество моментальных снимков может быть создано почти в одно и то же время.|  
|core.source.info_internal|В этой таблице хранятся сведения об источнике данных. Эта таблица обновляется каждый раз, когда новый набор элементов сбора начинает передачу данных в хранилище данных.|  
|core.supported_collector_types_internal|Содержит идентификаторы зарегистрированных типов сборщика, которые могут передавать данные в хранилище данных управления. Эта таблица обновляется только в тех случаях, когда схема хранилища обновляется для поддержки нового типа сборщика. При создании хранилища данных управления эта таблица заполняется идентификаторами типов сборщика, предоставленными сборщиком данных.|  
|core.wait_categories|Содержит категории, используемые для группирования типов ожидания в соответствии с характеристикой wait_type.|  
|core.wait_types|Содержит типы ожидания, распознаваемые сборщиком данных.|  
|core.purge_info_internal|Указывает, что был сделан запрос с целью остановить очистку хранилища данных управления.|  
  
 Предшествующие таблицы используются с таблицами типа сборщика для хранения данных. Например, тип сборщика «Универсальная трассировка SQL» использует следующие таблицы для хранения данных трассировки:  
  
-   core.source_info_internal  
  
-   core.snapshots_internal  
  
-   snapshots.trace_info  
  
-   snapshots.trace_data  
  
###### <a name="snapshots-schema"></a>Схема snapshots  
 Схема snapshots определяет объекты, необходимые для хранения и обслуживания данных, собранных предоставленными типами сборщиков. Таблицы этой схемы являются постоянными, и в течение времени жизни типа сборщика их изменение не требуется. Если необходимы изменения, то данная схема может изменяться только членами роли mdw_admin. Эти таблицы создаются для хранения данных, собранных наборами сбора системных данных.  
  
 Следующие таблицы иллюстрируют фрагмент схемы хранилища управляющих данных, необходимый для наборов сбора активности сервера и статистики запросов.  
  
-   Таблицы ресурсов системного уровня  
  
    -   **snapshots.os_wait_stats**  
  
    -   **snapshots.os_latch_stats**  
  
    -   **snapshots.os_schedulers**  
  
    -   `snapshots.os_memory_clerks`  
  
    -   **snapshots.os_memory_nodes**  
  
    -   snapshots.sql_process_and_system_memory  
  
-   Активность в системе  
  
    -   snapshots.active_sessions_and_requests  
  
-   Статистика запросов  
  
    -   snapshots.query_stats  
  
-   Статистика ввода-вывода  
  
    -   `snapshots.io_virtual_file_stats`  
  
-   Текст и план запроса  
  
    -   snapshots.notable_query_text  
  
    -   snapshots.notable_query_plan  
  
-   Статистика нормализованных запросов  
  
    -   snapshots.distinct_queries  
  
    -   snapshots.distinct_query_to_handle  
  
 **Схема custom_snapshots**  
  
 Схема custom_snapshots описывает новые таблицы и представления, которые создаются, когда стандартные или сторонние типы сборщика используются для создания пользовательских наборов сбора. Любой тип сборщика, которому необходима новая таблица данных для элемента сбора, может создать ее в этой схеме. Новые таблицы могут быть добавлены в эту схему членами роли mdw_writer. Любые другие изменения схемы могут выполнять только члены роли mdw_admin.  
  
 Подробные сведения о типе данных и содержимом столбцов таблиц базы данных можно получить из документации или с помощью соответствующей хранимой процедуры сборщика данных для каждой таблицы.  
  
### <a name="best-practices"></a>Рекомендации  
 При работе с хранилищем управляющих данных рекомендуется следовать данным рекомендациям.  
  
-   Не изменяйте метаданные в таблицах хранилища управляющих данных за исключением тех случаев, когда происходит добавление нового типа сборщика.  
  
-   Не изменяйте данные в хранилище управляющих данных напрямую. Изменение собранных данных делает их недействительными.  
  
-   Вместо непосредственного использования таблиц следует использовать документированные хранимые процедуры и функции, предоставляемые сборщиком данных для доступа к данным экземпляров и приложений. Имена таблиц и определений могут меняться в процессе работы, изменяются при обновлении приложения и, возможно, изменятся в следующих версиях.  
  
## <a name="change-history"></a>Журнал изменений  
  
|Обновленное содержимое|  
|---------------------|  
|В раздел «Схема core» добавлена таблица core.performance_counter_report_group_items.|  
|Обновлен список таблиц в разделе «Схема snapshots». Добавлены таблицы snapshots.os_memory_clerks, snapshots.sql_process_and_system_memory и snapshots.io_virtual_file_stats. Удалены таблицы snapshots.os_process_memory и snapshots.distinct_query_stats.|  
  
## <a name="see-also"></a>См. также:  
 [Хранимые процедуры хранилища данных управления (Transact-SQL)](/sql/relational-databases/system-stored-procedures/management-data-warehouse-stored-procedures-transact-sql)   
 [Хранимые процедуры сборщика данных (Transact-SQL)](/sql/relational-databases/system-stored-procedures/data-collector-stored-procedures-transact-sql)   
 [Сбор данных](data-collection.md)   
 [Просмотр отчета о наборе элементов сбора (среда SQL Server Management Studio)](view-a-collection-set-report-sql-server-management-studio.md)  
  
  
