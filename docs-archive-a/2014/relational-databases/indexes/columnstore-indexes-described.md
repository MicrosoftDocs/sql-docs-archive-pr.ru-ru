---
title: Описание индексов columnstore | Документация Майкрософт
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- indexes creation, columnstore
- indexes [SQL Server], columnstore
- columnstore index
- columnstore index, described
- xVelocity, columnstore indexes
ms.assetid: f98af4a5-4523-43b1-be8d-1b03c3217839
author: mikeraymsft
ms.author: mikeray
ms.openlocfilehash: 80a29b8e8cc5b53c09369156a5cf5f717e9447a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87749859"
---
# <a name="columnstore-indexes-described"></a><span data-ttu-id="39a9a-102">Columnstore Indexes Described</span><span class="sxs-lookup"><span data-stu-id="39a9a-102">Columnstore Indexes Described</span></span>
  <span data-ttu-id="39a9a-103">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] *Индекс columnstore в памяти* хранит данные и управляет ими с помощью хранилища данных на основе столбцов и обработки запросов на основе столбцов.</span><span class="sxs-lookup"><span data-stu-id="39a9a-103">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] *in-memory columnstore index* stores and manages data by using column-based data storage and column-based query processing.</span></span> <span data-ttu-id="39a9a-104">Индексы Columnstore подходят для рабочих нагрузок хранилища данных, которые выполняют в основном массовую загрузку и запросы только для чтения.</span><span class="sxs-lookup"><span data-stu-id="39a9a-104">Columnstore indexes work well for data warehousing workloads that primarily perform bulk loads and read-only queries.</span></span> <span data-ttu-id="39a9a-105">Используйте индекс columnstore для повышения **производительности запросов максимум в 10 раз** относительно традиционного хранилища, основанного на строках, и **повышения эффективности сжатия данных до 7 раз** относительно несжатых данных.</span><span class="sxs-lookup"><span data-stu-id="39a9a-105">Use the columnstore index to achieve up to **10x query performance** gains over traditional row-oriented storage, and up to **7x data compression** over the uncompressed data size.</span></span>

> [!NOTE]
>  <span data-ttu-id="39a9a-106">Кластеризованный индекс columnstore рассматривается как стандартный для хранения таблиц фактов с большим объемом данных; ожидается, что он будет полезен в большинстве сценариев хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="39a9a-106">We view the clustered columnstore index as the standard for storing large data warehousing fact tables, and expect it will be used in most data warehousing scenarios.</span></span> <span data-ttu-id="39a9a-107">Поскольку кластеризованный индекс columnstore может обновляться, рабочая нагрузка может также выполнять большое число операций вставки, обновления и удаления.</span><span class="sxs-lookup"><span data-stu-id="39a9a-107">Since the clustered columnstore index is updateable, your workload can perform a large number of insert, update, and delete operations.</span></span>

## <a name="contents"></a><span data-ttu-id="39a9a-108">Содержимое</span><span class="sxs-lookup"><span data-stu-id="39a9a-108">Contents</span></span>

-   [<span data-ttu-id="39a9a-109">Основы</span><span class="sxs-lookup"><span data-stu-id="39a9a-109">Basics</span></span>](#basics)

-   [<span data-ttu-id="39a9a-110">Загрузка данных</span><span class="sxs-lookup"><span data-stu-id="39a9a-110">Loading Data</span></span>](#dataload)

-   [<span data-ttu-id="39a9a-111">Советы по производительности .NET</span><span class="sxs-lookup"><span data-stu-id="39a9a-111">Performance Tips</span></span>](#performance)

-   [<span data-ttu-id="39a9a-112">Связанные задачи и разделы</span><span class="sxs-lookup"><span data-stu-id="39a9a-112">Related Tasks and Topics</span></span>](#related)

##  <a name="basics"></a><a name="basics"></a><span data-ttu-id="39a9a-113">Основы</span><span class="sxs-lookup"><span data-stu-id="39a9a-113">Basics</span></span>
 <span data-ttu-id="39a9a-114">*columnstore index* — это технология хранения, получения данных и управления ими с помощью формата хранения данных в один столбец, называемого columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-114">A *columnstore index* is a technology for storing, retrieving and managing data by using a columnar data format, called a columnstore.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="39a9a-115">поддерживает как кластеризованные, так и некластеризованные индексы columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-115">supports both clustered and nonclustered columnstore indexes.</span></span> <span data-ttu-id="39a9a-116">В обоих используется одна и та же технология columnstore в памяти, но имеются некоторые различия в целях и в поддерживаемых функциях.</span><span class="sxs-lookup"><span data-stu-id="39a9a-116">Both use the same in-memory columnstore technology, but they do have differences in purpose and in features they support.</span></span>

###  <a name="benefits"></a><a name="benefits"></a> <span data-ttu-id="39a9a-117">Преимущества</span><span class="sxs-lookup"><span data-stu-id="39a9a-117">Benefits</span></span>
 <span data-ttu-id="39a9a-118">Индексы columnstore подходят для главным образом для запросов только для чтения, которые используют для анализа большие наборы данных.</span><span class="sxs-lookup"><span data-stu-id="39a9a-118">Columnstore indexes work well for mostly read-only queries that perform analysis on large data sets.</span></span> <span data-ttu-id="39a9a-119">Часто эти запросы используются для рабочих нагрузок хранилищ данных.</span><span class="sxs-lookup"><span data-stu-id="39a9a-119">Often, these are queries for data warehousing workloads.</span></span> <span data-ttu-id="39a9a-120">Индексы columnstore обеспечивают значительное повышение производительности для запросов с полным сканированием таблицы и неоптимально подходят для запросов, которые выполняют поиск конкретного значения.</span><span class="sxs-lookup"><span data-stu-id="39a9a-120">Columnstore indexes give high performance gains for queries that use full table scans, and are not well-suited for queries that seek into the data, searching for a particular value.</span></span>

 <span data-ttu-id="39a9a-121">Преимущества использования индекса columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-121">Columnstore Index benefits:</span></span>

-   <span data-ttu-id="39a9a-122">Столбцы часто содержат схожие данные, что приводит к высокой степени сжатия.</span><span class="sxs-lookup"><span data-stu-id="39a9a-122">Columns often have similar data, which results in high compression rates.</span></span>

-   <span data-ttu-id="39a9a-123">Высокие степени сжатия повышают производительность запросов с помощью малого отпечатка в памяти.</span><span class="sxs-lookup"><span data-stu-id="39a9a-123">High compression rates improve query performance by using a smaller in-memory footprint.</span></span> <span data-ttu-id="39a9a-124">В свою очередь, может повышаться производительность запросов, так как [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] может выполнять больше операций с запросами и данными в памяти.</span><span class="sxs-lookup"><span data-stu-id="39a9a-124">In turn, query performance can improve because [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can perform more query and data operations in-memory.</span></span>

-   <span data-ttu-id="39a9a-125">Новый механизм выполнения запроса, который называется пакетным выполнением. Появление этого режима в SQL Server позволило значительно снизить загрузку ЦП.</span><span class="sxs-lookup"><span data-stu-id="39a9a-125">A new query execution mechanism called batch-mode execution has been added to SQL Server that reduces CPU usage by a large amount.</span></span> <span data-ttu-id="39a9a-126">Выполнение пакета тесно интегрировано и оптимизировано для взаимодействия с форматом хранения columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-126">Batch-mode execution is closely integrated with, and optimized around, the columnstore storage format.</span></span> <span data-ttu-id="39a9a-127">Выполнение пакета иногда называется выполнением на основе векторов или векторизированным.</span><span class="sxs-lookup"><span data-stu-id="39a9a-127">Batch-mode execution is sometimes known as vector-based or vectorized execution.</span></span>

-   <span data-ttu-id="39a9a-128">Часто запросы выбирают только несколько столбцов из таблицы, что сокращает общее число операций ввода-вывода для физического носителя.</span><span class="sxs-lookup"><span data-stu-id="39a9a-128">Queries often select only a few columns from a table, which reduces total I/O from the physical media.</span></span>

### <a name="columnstore-versions"></a><span data-ttu-id="39a9a-129">Версии columnstore</span><span class="sxs-lookup"><span data-stu-id="39a9a-129">Columnstore Versions</span></span>
 <span data-ttu-id="39a9a-130">SQL Server 2012, SQL Server 2012 Parallel Data Warehouse и SQL Server 2014 используют индексы columnstore для ускорения выполнения общих запросов хранилищ данных.</span><span class="sxs-lookup"><span data-stu-id="39a9a-130">SQL Server 2012, SQL Server 2012 Parallel Data Warehouse, and SQL Server 2014 all use columnstore indexes to accelerate common data warehouse queries.</span></span> <span data-ttu-id="39a9a-131">В SQL Server 2012 реализованы две новые функции: некластеризованный индекс columnstore и поддержка выполнения запросов на основе вектора, которые используются для обработки данных в единицах, называемых «пакеты».</span><span class="sxs-lookup"><span data-stu-id="39a9a-131">SQL Server 2012 introduced two new features: a nonclustered columnstore index and a vector-based query execution capability that processes data in units called "batches."</span></span> <span data-ttu-id="39a9a-132">SQL Server 2014 поддерживает функции SQL Server 2012, а также обновленные кластеризованные индексы columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-132">SQL Server 2014 has the features of SQL Server 2012 plus updateable clustered columnstore indexes.</span></span>

### <a name="key-characteristics"></a><span data-ttu-id="39a9a-133">Ключевые характеристики</span><span class="sxs-lookup"><span data-stu-id="39a9a-133">Key Characteristics</span></span>

||
|-|
|<span data-ttu-id="39a9a-134">**Применимо к**: с [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] до [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="39a9a-134">**Applies to**: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] through [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|

 <span data-ttu-id="39a9a-135">В [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]кластеризованный индекс columnstore:</span><span class="sxs-lookup"><span data-stu-id="39a9a-135">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a clustered columnstore index:</span></span>

-   <span data-ttu-id="39a9a-136">Доступен в выпусках Enterprise, Developer и Evaluation.</span><span class="sxs-lookup"><span data-stu-id="39a9a-136">Is available in Enterprise, Developer, and Evaluation editions.</span></span>

-   <span data-ttu-id="39a9a-137">Обновляется.</span><span class="sxs-lookup"><span data-stu-id="39a9a-137">Is updateable.</span></span>

-   <span data-ttu-id="39a9a-138">Это основной метод хранения для всей таблицы.</span><span class="sxs-lookup"><span data-stu-id="39a9a-138">Is the primary storage method for the entire table.</span></span>

-   <span data-ttu-id="39a9a-139">Не имеет ключевых столбцов.</span><span class="sxs-lookup"><span data-stu-id="39a9a-139">Has no key columns.</span></span> <span data-ttu-id="39a9a-140">Все столбцы являются включенными.</span><span class="sxs-lookup"><span data-stu-id="39a9a-140">All columns are included columns.</span></span>

-   <span data-ttu-id="39a9a-141">Является единственным индексом для таблицы.</span><span class="sxs-lookup"><span data-stu-id="39a9a-141">Is the only index on the table.</span></span> <span data-ttu-id="39a9a-142">Не поддается объединению с другими индексами.</span><span class="sxs-lookup"><span data-stu-id="39a9a-142">It cannot be combined with any other indexes.</span></span>

-   <span data-ttu-id="39a9a-143">Можно настроить для использования columnstore или архивного сжатия columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-143">Can be configured to use columnstore or columnstore archival compression.</span></span>

-   <span data-ttu-id="39a9a-144">Физически не хранит столбцы в отсортированном порядке.</span><span class="sxs-lookup"><span data-stu-id="39a9a-144">Does not physically store columns in a sorted order.</span></span> <span data-ttu-id="39a9a-145">Вместо этого хранит данные для повышения сжатия и производительности.</span><span class="sxs-lookup"><span data-stu-id="39a9a-145">Instead, it stores data to improve compression and performance.</span></span>

||
|-|
|<span data-ttu-id="39a9a-146">**Применимо к**: с [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] до [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="39a9a-146">**Applies to**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] through [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|

 <span data-ttu-id="39a9a-147">В [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]некластеризованный индекс columnstore:</span><span class="sxs-lookup"><span data-stu-id="39a9a-147">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a nonclustered columnstore index:</span></span>

-   <span data-ttu-id="39a9a-148">Поддерживается индексация подмножества столбцов в кластеризованном индексе или куче.</span><span class="sxs-lookup"><span data-stu-id="39a9a-148">Can index a subset of columns in the clustered index or heap.</span></span> <span data-ttu-id="39a9a-149">Например, его можно использовать для индексации часто используемых столбцов.</span><span class="sxs-lookup"><span data-stu-id="39a9a-149">For example, it can index the frequently used columns.</span></span>

-   <span data-ttu-id="39a9a-150">Требует дополнительного места для хранения копии столбцов в индексе.</span><span class="sxs-lookup"><span data-stu-id="39a9a-150">Requires extra storage to store a copy of the columns in the index.</span></span>

-   <span data-ttu-id="39a9a-151">Обновляется путем перестроения индекса или переключения секций в и обратно. Обновление не поддерживается с помощью операций DML, таких как вставка, обновление и удаление.</span><span class="sxs-lookup"><span data-stu-id="39a9a-151">Is updated by rebuilding the index or switching partitions in and out. It is not updateable by using the DML operations such as insert, update, and delete.</span></span>

-   <span data-ttu-id="39a9a-152">Может быть совмещен с другими индексами из таблицы.</span><span class="sxs-lookup"><span data-stu-id="39a9a-152">Can be combined with other indexes on the table.</span></span>

-   <span data-ttu-id="39a9a-153">Можно настроить для использования columnstore или архивного сжатия columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-153">Can be configured to use columnstore or columnstore archival compression.</span></span>

-   <span data-ttu-id="39a9a-154">Физически не хранит столбцы в отсортированном порядке.</span><span class="sxs-lookup"><span data-stu-id="39a9a-154">Does not physically store columns in a sorted order.</span></span> <span data-ttu-id="39a9a-155">Вместо этого хранит данные для повышения сжатия и производительности.</span><span class="sxs-lookup"><span data-stu-id="39a9a-155">Instead, it stores data to improve compression and performance.</span></span> <span data-ttu-id="39a9a-156">Предварительная сортировка данных перед созданием индекса columnstore не является обязательной, но повышает уровень сжатия columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-156">Pre-sorting the data before creating the columnstore index is not required, but can improve columnstore compression.</span></span>

###  <a name="key-concepts-and-terms"></a><a name="Concepts"></a><span data-ttu-id="39a9a-157">Основные понятия и термины</span><span class="sxs-lookup"><span data-stu-id="39a9a-157">Key Concepts and Terms</span></span>
 <span data-ttu-id="39a9a-158">Следующие основные концепции и понятия связаны с индексами columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-158">The following key terms and concepts are associated with columnstore indexes.</span></span>

 <span data-ttu-id="39a9a-159">индекс columnstore. *индекс columnstore* — это технология хранения, извлечения данных и управления ими с помощью формата данных по столбцам, называемого columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-159">columnstore index A *columnstore index* is a technology for storing, retrieving and managing data by using a columnar data format, called a columnstore.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="39a9a-160">поддерживает как кластеризованные, так и некластеризованные индексы columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-160">supports both clustered and nonclustered columnstore indexes.</span></span> <span data-ttu-id="39a9a-161">В обоих используется одна и та же технология columnstore в памяти, но имеются некоторые различия в целях и в поддерживаемых функциях.</span><span class="sxs-lookup"><span data-stu-id="39a9a-161">Both use the same in-memory columnstore technology, but they do have differences in purpose and in features they support.</span></span>

 <span data-ttu-id="39a9a-162">columnstore. *columnstore* — это данные, логически организованные в виде таблицы со строками и столбцами, которые физически хранятся в формате данных на уровне столбца.</span><span class="sxs-lookup"><span data-stu-id="39a9a-162">columnstore A *columnstore* is data that is logically organized as a table with rows and columns, and physically stored in a column-wise data format.</span></span>

 <span data-ttu-id="39a9a-163">rowstore *rowstore* — это данные, логически организованные в виде таблицы со строками и столбцами, которые физически хранятся в формате данных на уровне строк.</span><span class="sxs-lookup"><span data-stu-id="39a9a-163">rowstore A *rowstore* is data that is logically organized as a table with rows and columns, and then physically stored in a row-wise data format.</span></span> <span data-ttu-id="39a9a-164">Это стандартный способ хранения реляционных данных таблиц.</span><span class="sxs-lookup"><span data-stu-id="39a9a-164">This has been the traditional way to store relational table data.</span></span>

 <span data-ttu-id="39a9a-165">групп строк и сегменты столбцов для высокой производительности и высокой степени сжатия, индекс columnstore разделяет таблицу на группы строк, называемые группами строк, а затем сжимает каждую группу строк на уровне столбцов.</span><span class="sxs-lookup"><span data-stu-id="39a9a-165">rowgroups and column segments For high performance and high compression rates, the columnstore index slices the table into groups of rows, called row groups, and then compresses each row group in a column-wise manner.</span></span> <span data-ttu-id="39a9a-166">Число строк в группе строк должно быть достаточно большим, чтобы повысить скорость сжатия, и достаточно малым для использования преимуществ использования операций в памяти.</span><span class="sxs-lookup"><span data-stu-id="39a9a-166">The number of rows in the row group must be large enough to improve compression rates, and small enough to benefit from in-memory operations.</span></span>

 <span data-ttu-id="39a9a-167">Группа строк A *группы строк* — это группа строк, которые сжимаются в формате columnstore одновременно.</span><span class="sxs-lookup"><span data-stu-id="39a9a-167">row group A *rowgroup* is a group of rows that are compressed into columnstore format at the same time.</span></span>

 <span data-ttu-id="39a9a-168">сегмент столбца. *сегмент столбца* — это столбец данных в группы строк.</span><span class="sxs-lookup"><span data-stu-id="39a9a-168">column segment A *column segment* is a column of data from within the rowgroup.</span></span>

-   <span data-ttu-id="39a9a-169">Группа строк обычно содержит максимальное число строк для группы строк, 1 048 576 строк.</span><span class="sxs-lookup"><span data-stu-id="39a9a-169">A rowgroup usually contains the maximum number of rows per rowgroup which is 1,048,576 rows.</span></span>

-   <span data-ttu-id="39a9a-170">Каждая rowgroup содержит один сегмент столбца для каждого столбца в таблице.</span><span class="sxs-lookup"><span data-stu-id="39a9a-170">Each rowgroup contains one column segment for every column in the table.</span></span>

-   <span data-ttu-id="39a9a-171">Каждый сегмент столбца сжимается одновременно и сохраняется на физическом носителе.</span><span class="sxs-lookup"><span data-stu-id="39a9a-171">Each column segment is compressed together and stored on physical media.</span></span>

 <span data-ttu-id="39a9a-172">![Сегмент столбца](../../database-engine/media/sql-server-pdw-columnstore-columnsegment.gif "Сегмент столбца")</span><span class="sxs-lookup"><span data-stu-id="39a9a-172">![Column segment](../../database-engine/media/sql-server-pdw-columnstore-columnsegment.gif "Column segment")</span></span>

 <span data-ttu-id="39a9a-173">некластеризованный индекс columnstore. *некластеризованный индекс columnstore* является индексом только для чтения, созданным в существующем кластеризованном индексе или таблице кучи.</span><span class="sxs-lookup"><span data-stu-id="39a9a-173">nonclustered columnstore index A *nonclustered columnstore index* is a read-only index created on an existing clustered index or heap table.</span></span> <span data-ttu-id="39a9a-174">Он содержит копию подмножества столбцов вплоть до включения всех столбцов в таблице.</span><span class="sxs-lookup"><span data-stu-id="39a9a-174">It contains a copy of a subset of columns, up to and including all of the columns in the table..</span></span> <span data-ttu-id="39a9a-175">Таблица доступна только для чтения, если она содержит некластеризованный индекс columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-175">The table is read-only while it contains a nonclustered columnstore index.</span></span>

 <span data-ttu-id="39a9a-176">Некластеризованный индекс columnstore дает возможность использования индекса columnstore для выполнения запросов анализа, выполняемых одновременно с операциями только для чтения в исходной таблице.</span><span class="sxs-lookup"><span data-stu-id="39a9a-176">A nonclustered columnstore index provides a way to have a columnstore index for running analysis queries while at the same time performing read-only operations on the original table.</span></span>

 <span data-ttu-id="39a9a-177">![некластеризованный индекс columnstore](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage-nonclustered.gif "некластеризованный индекс columnstore")</span><span class="sxs-lookup"><span data-stu-id="39a9a-177">![Nonclustered columnstore index](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage-nonclustered.gif "Nonclustered columnstore index")</span></span>

 <span data-ttu-id="39a9a-178">кластеризованный индекс columnstore. *кластеризованный индекс columnstore* является физическим хранилищем для всей таблицы и является единственным индексом для таблицы.</span><span class="sxs-lookup"><span data-stu-id="39a9a-178">clustered columnstore index A *clustered columnstore index* is the physical storage for the entire table and is the only index for the table.</span></span> <span data-ttu-id="39a9a-179">Кластеризованный индекс можно обновлять.</span><span class="sxs-lookup"><span data-stu-id="39a9a-179">The clustered index is updateable.</span></span> <span data-ttu-id="39a9a-180">Можно выполнять операции вставки, удаления и обновления индекса, а также выполнять массовую загрузку данных в индекс.</span><span class="sxs-lookup"><span data-stu-id="39a9a-180">You can perform insert, delete, and update operations on the index and you can bulk load data into the index.</span></span>

 <span data-ttu-id="39a9a-181">![Кластеризованный индекс columnstore](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage.gif "Кластеризованный индекс columnstore")</span><span class="sxs-lookup"><span data-stu-id="39a9a-181">![Clustered Columnstore Index](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage.gif "Clustered Columnstore Index")</span></span>

 <span data-ttu-id="39a9a-182">Чтобы снизить фрагментацию сегментов столбцов и повысить производительность, индекс columnstore может некоторые данные сохранить временно в таблице, которая называется deltastore, и использовать сбалансированное дерево идентификаторов для удаленных строк.</span><span class="sxs-lookup"><span data-stu-id="39a9a-182">To reduce fragmentation of the column segments and improve performance, the columnstore index might store some data temporarily into a rowstore table, called a deltastore, plus a B-Tree of IDs for deleted rows.</span></span> <span data-ttu-id="39a9a-183">Операции deltastore обрабатываются в фоновом режиме.</span><span class="sxs-lookup"><span data-stu-id="39a9a-183">The deltastore operations are handled behind the scenes.</span></span> <span data-ttu-id="39a9a-184">Для получения правильных результатов запросов кластеризованные индексы columnstore объединяют результаты запроса от columnstore и deltastore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-184">To return the correct query results, the clustered columnstore index combines query results from both the columnstore and the deltastore.</span></span>

 <span data-ttu-id="39a9a-185">deltastore используется только с кластеризованными индексами columnstore, *deltastore* — это rowstore таблица, в которой хранятся строки до тех пор, пока количество строк не станет достаточно большим для перемещения в columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-185">deltastore Used with clustered columnstore indexes only, a *deltastore* is a rowstore table that stores rows until the number of rows is large enough to be moved into the columnstore.</span></span> <span data-ttu-id="39a9a-186">Deltastore используется с кластеризованными индексами columnstore для повышения производительности при загрузке и других операциях DML.</span><span class="sxs-lookup"><span data-stu-id="39a9a-186">A deltastore is used with clustered columnstore indexes to improve performance for loading and other DML operations.</span></span>

 <span data-ttu-id="39a9a-187">При крупной массовой загрузке большинство строк переходят непосредственно в columnstore без промежуточного помещения в deltastore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-187">During a large bulk load, most of the rows go directly to the columnstore without passing through the deltastore.</span></span> <span data-ttu-id="39a9a-188">Некоторых строк в конце массовой загрузки может оказаться слишком мало для соответствия минимальному размеру rowgroup, составляющему 102 400 строк.</span><span class="sxs-lookup"><span data-stu-id="39a9a-188">Some rows at the end of the bulk load might be too few in number to meet the minimum size of a rowgroup which is 102,400 rows.</span></span> <span data-ttu-id="39a9a-189">В этом случае последние строки переходят в deltastore вместо columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-189">When this happens, the final rows go to the deltastore instead of the columnstore.</span></span> <span data-ttu-id="39a9a-190">Для небольших массовых загрузок с менее 102 400 строк, все строки перемещаются напрямую в deltastore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-190">For small bulk loads with less than 102,400 rows, all of the rows go directly to the deltastore.</span></span>

 <span data-ttu-id="39a9a-191">Когда объем deltastore достигает максимального числа строк, оно закрывается.</span><span class="sxs-lookup"><span data-stu-id="39a9a-191">When the deltastore reaches the maximum number of rows, it becomes closed.</span></span> <span data-ttu-id="39a9a-192">Процесс перемещения кортежей выполняет проверку на наличие закрытых групп строк.</span><span class="sxs-lookup"><span data-stu-id="39a9a-192">A tuple-move process checks for closed row groups.</span></span> <span data-ttu-id="39a9a-193">При обнаружении закрытой группы строк оно уменьшает его и сохраняет в columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-193">When it finds the closed rowgroup, it compresses it and stores it into the columnstore.</span></span>

##  <a name="loading-data"></a><a name="dataload"></a><span data-ttu-id="39a9a-194">Загрузка данных</span><span class="sxs-lookup"><span data-stu-id="39a9a-194">Loading Data</span></span>

###  <a name="loading-data-into-a-nonclustered-columnstore-index"></a><a name="dataload_nci"></a><span data-ttu-id="39a9a-195">Загрузка данных в некластеризованный индекс columnstore</span><span class="sxs-lookup"><span data-stu-id="39a9a-195">Loading Data into a Nonclustered Columnstore Index</span></span>
 <span data-ttu-id="39a9a-196">Чтобы загрузить данные в некластеризованный индекс columnstore, сначала загрузите данные в традиционную таблицу rowstore, хранящуюся в виде кучи или кластеризованного индекса, а затем создайте некластеризованный индекс columnstore с помощью [инструкции CREATE COLUMNSTORE index &#40;&#41;Transact-SQL ](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="39a9a-196">To load data into a nonclustered columnstore index, first load data into a traditional rowstore table stored as a heap or clustered index, and then create the nonclustered columnstore index with [CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span></span>

 <span data-ttu-id="39a9a-197">![Загрузка данных в индекс columnstore](../../database-engine/media/sql-server-pdw-columnstore-loadprocess-nonclustered.gif "Загрузка данных в индекс columnstore")</span><span class="sxs-lookup"><span data-stu-id="39a9a-197">![Loading data into a columnstore index](../../database-engine/media/sql-server-pdw-columnstore-loadprocess-nonclustered.gif "Loading data into a columnstore index")</span></span>

 <span data-ttu-id="39a9a-198">Таблица с некластеризованным индексом columnstore доступна только для чтения до тех пор, пока индекс не будет удален или отключен.</span><span class="sxs-lookup"><span data-stu-id="39a9a-198">A table with a nonclustered columnstore index is read-only until the index is dropped or disabled.</span></span> <span data-ttu-id="39a9a-199">Для обновления таблицы и некластеризованного индекса columnstore можно переключать секции в и из. Можно также отключить индекс, обновить таблицу, а затем перестроить индекс.</span><span class="sxs-lookup"><span data-stu-id="39a9a-199">To update the table and the nonclustered columnstore index you can switch partitions in and out. You can also disable the index, update the table, and then rebuild the index.</span></span>

 <span data-ttu-id="39a9a-200">Дополнительные сведения см. в разделе [Using Nonclustered Columnstore Indexes](indexes.md).</span><span class="sxs-lookup"><span data-stu-id="39a9a-200">For more information see [Using Nonclustered Columnstore Indexes](indexes.md)</span></span>

###  <a name="loading-data-into-a-clustered-columnstore-index"></a><a name="dataload_cci"></a><span data-ttu-id="39a9a-201">Загрузка данных в кластеризованный индекс columnstore</span><span class="sxs-lookup"><span data-stu-id="39a9a-201">Loading Data into a Clustered Columnstore Index</span></span>
 <span data-ttu-id="39a9a-202">![Загрузка в кластеризованный индекс columnstore](../../database-engine/media/sql-server-pdw-columnstore-loadprocess.gif "Загрузка в кластеризованный индекс columnstore")</span><span class="sxs-lookup"><span data-stu-id="39a9a-202">![Loading into a clustered columnstore index](../../database-engine/media/sql-server-pdw-columnstore-loadprocess.gif "Loading into a clustered columnstore index")</span></span>

 <span data-ttu-id="39a9a-203">Согласно указаниям диаграммы, для загрузки данных в кластеризованный индекс columnstore [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="39a9a-203">As the diagram suggests, to load data into a clustered columnstore index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>

1.  <span data-ttu-id="39a9a-204">Вставляет rowgroup максимального размера непосредственно в columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-204">Inserts maximum-size rowgroups directly into the columnstore.</span></span> <span data-ttu-id="39a9a-205">По мере загрузки данных компонент [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] назначает строки данных в порядке FIFO в открытую группу строк.</span><span class="sxs-lookup"><span data-stu-id="39a9a-205">As the data is loaded, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] assigns the data rows in a first-come first-serve order into an open rowgroup.</span></span>

2.  <span data-ttu-id="39a9a-206">Для каждой группы строк после достижения максимального размера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="39a9a-206">For each rowgroup, after it reaches the maximum size, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>

    1.  <span data-ttu-id="39a9a-207">Отмечает rowgroup как CLOSED.</span><span class="sxs-lookup"><span data-stu-id="39a9a-207">Marks the rowgroup as CLOSED.</span></span>

    2.  <span data-ttu-id="39a9a-208">Обходит deltastore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-208">Bypasses the deltastore.</span></span>

    3.  <span data-ttu-id="39a9a-209">Сжимает каждый сегмент столбца в rowgroup сжатием columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-209">Compresses each column segment with the rowgroup with columnstore compression.</span></span>

    4.  <span data-ttu-id="39a9a-210">Физически сохраняет каждый сжатый сегмент столбца в columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-210">Physically stores each compressed column segment into the columnstore.</span></span>

3.  <span data-ttu-id="39a9a-211">Вставляет оставшиеся строки в columnstore или deltastore следующим образом.</span><span class="sxs-lookup"><span data-stu-id="39a9a-211">Inserts the remaining rows into the columnstore or the deltastore as follows:</span></span>

    1.  <span data-ttu-id="39a9a-212">Если число строк удовлетворяет требованию к минимальному числу строк для rowgroup, строки добавляются к columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-212">If the number of rows meets the minimum rows per rowgroup requirement, the rows are added to the columnstore.</span></span>

    2.  <span data-ttu-id="39a9a-213">Если число строк меньше минимального числа строк для rowgroup, строки добавляются к deltastore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-213">If the number of rows is less than the minimum rows per rowgroup, the rows are added to the deltastore.</span></span>

 <span data-ttu-id="39a9a-214">Дополнительные сведения о задачах и процессах deltastore см. в разделе [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="39a9a-214">For more information about deltastore tasks and processes, see [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md)</span></span>

##  <a name="performance-tips"></a><a name="performance"></a><span data-ttu-id="39a9a-215">Советы по повышению производительности</span><span class="sxs-lookup"><span data-stu-id="39a9a-215">Performance Tips</span></span>

### <a name="plan-for-enough-memory-to-create-columnstore-indexes-in-parallel"></a><span data-ttu-id="39a9a-216">Планирование достаточного объема памяти для параллельного создания индексов columnstore</span><span class="sxs-lookup"><span data-stu-id="39a9a-216">Plan for enough memory to create columnstore indexes in parallel</span></span>
 <span data-ttu-id="39a9a-217">Создание индекса columnstore по умолчанию является параллельно выполняемой операцией, если ресурсы памяти неограниченны.</span><span class="sxs-lookup"><span data-stu-id="39a9a-217">Creating a columnstore index is by default a parallel operation unless memory is constrained.</span></span> <span data-ttu-id="39a9a-218">При создании индекса параллельно требуется больше памяти, чем при последовательном создании индекса.</span><span class="sxs-lookup"><span data-stu-id="39a9a-218">Creating the index in parallel requires more memory than creating the index serially.</span></span> <span data-ttu-id="39a9a-219">При достаточном объеме памяти создание индекса columnstore выполняется в 1,5 раза дольше, чем создание сбалансированного дерева для тех же столбцов.</span><span class="sxs-lookup"><span data-stu-id="39a9a-219">When there is ample memory, creating a columnstore index takes on the order of 1.5 times as long as building a B-tree on the same columns.</span></span>

 <span data-ttu-id="39a9a-220">Объем памяти, необходимый для создания индекса columnstore, зависит от количества столбцов, числа столбцов строкового типа, степени параллелизма (DOP) и характеристик данных.</span><span class="sxs-lookup"><span data-stu-id="39a9a-220">The memory required for creating a columnstore index depends on the number of columns, the number of string columns, the degree of parallelism (DOP), and the characteristics of the data.</span></span> <span data-ttu-id="39a9a-221">Например, если в таблице есть менее миллиона строк, то SQL Server будет использовать всего один поток для создания индекса columnstore.</span><span class="sxs-lookup"><span data-stu-id="39a9a-221">For example, if your table has fewer than one million rows, SQL Server will use only one thread to create the columnstore index.</span></span>

 <span data-ttu-id="39a9a-222">Если в таблице более миллиона строк, но SQL Server не может получить объем памяти, достаточный для создания индекса с помощью MAXDOP, то SQL Server автоматически уменьшит MAXDOP в соответствии с наличием памяти.</span><span class="sxs-lookup"><span data-stu-id="39a9a-222">If your table has more than one million rows, but SQL Server cannot get a large enough memory grant to create the index using MAXDOP, SQL Server will automatically decrease MAXDOP as needed to fit into the available memory grant.</span></span>  <span data-ttu-id="39a9a-223">В некоторых случаях необходимо уменьшить DOP до одного для создания индекса в условиях нехватки памяти.</span><span class="sxs-lookup"><span data-stu-id="39a9a-223">In some cases, DOP must be decreased to one in order to build the index under constrained memory.</span></span>

##  <a name="related-tasks-and-topics"></a><a name="related"></a><span data-ttu-id="39a9a-224">Связанные задачи и разделы</span><span class="sxs-lookup"><span data-stu-id="39a9a-224">Related Tasks and Topics</span></span>

### <a name="nonclustered-columnstore-indexes"></a><span data-ttu-id="39a9a-225">Некластеризованные индексы columnstore</span><span class="sxs-lookup"><span data-stu-id="39a9a-225">Nonclustered Columnstore Indexes</span></span>
 <span data-ttu-id="39a9a-226">Дополнительные сведения о стандартных задачах см. в разделе [Using Nonclustered Columnstore Indexes](../../database-engine/using-nonclustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="39a9a-226">For common tasks, see [Using Nonclustered Columnstore Indexes](../../database-engine/using-nonclustered-columnstore-indexes.md).</span></span>

-   [<span data-ttu-id="39a9a-227">CREATE COLUMNSTORE INDEX (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="39a9a-227">CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-columnstore-index-transact-sql)

-   <span data-ttu-id="39a9a-228">[ALTER INDEX &#40;&#41;Transact-SQL](/sql/t-sql/statements/alter-index-transact-sql) с перестроением.</span><span class="sxs-lookup"><span data-stu-id="39a9a-228">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) with REBUILD.</span></span>

-   [<span data-ttu-id="39a9a-229">DROP INDEX (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="39a9a-229">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)

### <a name="clustered-columnstore-indexes"></a><span data-ttu-id="39a9a-230">Кластеризованные индексы columnstore</span><span class="sxs-lookup"><span data-stu-id="39a9a-230">Clustered Columnstore Indexes</span></span>
 <span data-ttu-id="39a9a-231">Дополнительные сведения о стандартных задачах см. в разделе [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="39a9a-231">For common tasks, see [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span></span>

-   [<span data-ttu-id="39a9a-232">Создание КЛАСТЕРИЗОВАНного индекса COLUMNSTORE &#40;&#41;Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="39a9a-232">CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-columnstore-index-transact-sql)

-   <span data-ttu-id="39a9a-233">[ALTER INDEX &#40;&#41;Transact-SQL](/sql/t-sql/statements/alter-index-transact-sql) с перестроением или реорганизацию.</span><span class="sxs-lookup"><span data-stu-id="39a9a-233">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) with REBUILD or REORGANIZE.</span></span>

-   [<span data-ttu-id="39a9a-234">DROP INDEX (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="39a9a-234">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)

-   [<span data-ttu-id="39a9a-235">INSERT (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="39a9a-235">INSERT &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/insert-transact-sql)

-   [<span data-ttu-id="39a9a-236">UPDATE (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="39a9a-236">UPDATE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/queries/update-transact-sql)

-   [<span data-ttu-id="39a9a-237">DELETE (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="39a9a-237">DELETE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/delete-transact-sql)

### <a name="metadata"></a><span data-ttu-id="39a9a-238">Метаданные</span><span class="sxs-lookup"><span data-stu-id="39a9a-238">Metadata</span></span>
 <span data-ttu-id="39a9a-239">Все столбцы в индексе columnstore хранятся в метаданных как включенные столбцы.</span><span class="sxs-lookup"><span data-stu-id="39a9a-239">All of the columns in a columnstore index are stored in the metadata as included columns.</span></span> <span data-ttu-id="39a9a-240">Индекс columnstore не имеет ключевых столбцов.</span><span class="sxs-lookup"><span data-stu-id="39a9a-240">The columnstore index does not have key columns.</span></span>

-   [<span data-ttu-id="39a9a-241">sys.indexes (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="39a9a-241">sys.indexes &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-indexes-transact-sql)

-   [<span data-ttu-id="39a9a-242">sys.index_columns (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="39a9a-242">sys.index_columns &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-index-columns-transact-sql)

-   [<span data-ttu-id="39a9a-243">sys.partitions (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="39a9a-243">sys.partitions &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-partitions-transact-sql)

-   [<span data-ttu-id="39a9a-244">sys.column_store_segments (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="39a9a-244">sys.column_store_segments &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-segments-transact-sql)

-   [<span data-ttu-id="39a9a-245">sys.column_store_dictionaries &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="39a9a-245">sys.column_store_dictionaries &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-dictionaries-transact-sql)

-   [<span data-ttu-id="39a9a-246">sys.column_store_row_groups &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="39a9a-246">sys.column_store_row_groups &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-row-groups-transact-sql)


