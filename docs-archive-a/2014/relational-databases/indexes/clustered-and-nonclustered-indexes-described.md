---
title: Описание кластеризованных и некластеризованных индексов | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- query optimizer [SQL Server], index usage
- index concepts [SQL Server]
ms.assetid: b7d6b323-728d-4763-a987-92e6292f6f7a
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: c9eb51a24000b8af4a466fe4330644a722ad325b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87749867"
---
# <a name="clustered-and-nonclustered-indexes-described"></a><span data-ttu-id="bc161-102">Описания кластеризованных и некластеризованных индексов</span><span class="sxs-lookup"><span data-stu-id="bc161-102">Clustered and Nonclustered Indexes Described</span></span>
  <span data-ttu-id="bc161-103">Индекс является структурой на диске, которая связана с таблицей или представлением и ускоряет получение строк из таблицы или представления.</span><span class="sxs-lookup"><span data-stu-id="bc161-103">An index is an on-disk structure associated with a table or view that speeds retrieval of rows from the table or view.</span></span> <span data-ttu-id="bc161-104">Индекс содержит ключи, построенные из одного или нескольких столбцов в таблице или представлении.</span><span class="sxs-lookup"><span data-stu-id="bc161-104">An index contains keys built from one or more columns in the table or view.</span></span> <span data-ttu-id="bc161-105">Эти ключи хранятся в виде структуры сбалансированного дерева, которая поддерживает быстрый поиск строк по их ключевым значениям в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="bc161-105">These keys are stored in a structure (B-tree) that enables [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to find the row or rows associated with the key values quickly and efficiently.</span></span>  
  
 <span data-ttu-id="bc161-106">Таблица или представление может иметь индексы следующих типов.</span><span class="sxs-lookup"><span data-stu-id="bc161-106">A table or view can contain the following types of indexes:</span></span>  
  
-   <span data-ttu-id="bc161-107">Кластеризованный</span><span class="sxs-lookup"><span data-stu-id="bc161-107">Clustered</span></span>  
  
    -   <span data-ttu-id="bc161-108">Кластеризованные индексы сортируют и хранят строки данных в таблицах или представлениях на основе их ключевых значений.</span><span class="sxs-lookup"><span data-stu-id="bc161-108">Clustered indexes sort and store the data rows in the table or view based on their key values.</span></span> <span data-ttu-id="bc161-109">Этими значениями являются столбцы, включенные в определение индекса.</span><span class="sxs-lookup"><span data-stu-id="bc161-109">These are the columns included in the index definition.</span></span> <span data-ttu-id="bc161-110">Существует только один кластеризованный индекс для каждой таблицы, потому что строки данных могут быть отсортированы только в единственном порядке.</span><span class="sxs-lookup"><span data-stu-id="bc161-110">There can be only one clustered index per table, because the data rows themselves can be sorted in only one order.</span></span>  
  
    -   <span data-ttu-id="bc161-111">Строки данных в таблице хранятся в порядке сортировки только в том случае, если таблица содержит кластеризованный индекс.</span><span class="sxs-lookup"><span data-stu-id="bc161-111">The only time the data rows in a table are stored in sorted order is when the table contains a clustered index.</span></span> <span data-ttu-id="bc161-112">Если у таблицы есть кластеризованный индекс, то таблица называется кластеризованной.</span><span class="sxs-lookup"><span data-stu-id="bc161-112">When a table has a clustered index, the table is called a clustered table.</span></span> <span data-ttu-id="bc161-113">Если у таблицы нет кластеризованного индекса, то строки данных хранятся в неупорядоченной структуре, которая называется кучей.</span><span class="sxs-lookup"><span data-stu-id="bc161-113">If a table has no clustered index, its data rows are stored in an unordered structure called a heap.</span></span>  
  
-   <span data-ttu-id="bc161-114">Некластеризованный</span><span class="sxs-lookup"><span data-stu-id="bc161-114">Nonclustered</span></span>  
  
    -   <span data-ttu-id="bc161-115">Некластеризованные индексы имеют структуру, отдельную от строк данных.</span><span class="sxs-lookup"><span data-stu-id="bc161-115">Nonclustered indexes have a structure separate from the data rows.</span></span> <span data-ttu-id="bc161-116">В некластеризованном индексе содержатся значения ключа некластеризованного индекса, и каждая запись значения ключа содержит указатель на строку данных, содержащую значение ключа.</span><span class="sxs-lookup"><span data-stu-id="bc161-116">A nonclustered index contains the nonclustered index key values and each key value entry has a pointer to the data row that contains the key value.</span></span>  
  
    -   <span data-ttu-id="bc161-117">Указатель из строки индекса в некластеризованном индексе, который указывает на строку данных, называется указателем строки.</span><span class="sxs-lookup"><span data-stu-id="bc161-117">The pointer from an index row in a nonclustered index to a data row is called a row locator.</span></span> <span data-ttu-id="bc161-118">Структура указателя строки зависит от того, хранятся ли страницы данных в куче или в кластеризованной таблице.</span><span class="sxs-lookup"><span data-stu-id="bc161-118">The structure of the row locator depends on whether the data pages are stored in a heap or a clustered table.</span></span> <span data-ttu-id="bc161-119">Для кучи указатель строки является указателем на строку.</span><span class="sxs-lookup"><span data-stu-id="bc161-119">For a heap, a row locator is a pointer to the row.</span></span> <span data-ttu-id="bc161-120">Для кластеризованной таблицы указатель строки данных является ключом кластеризованного индекса.</span><span class="sxs-lookup"><span data-stu-id="bc161-120">For a clustered table, the row locator is the clustered index key.</span></span>  
  
    -   <span data-ttu-id="bc161-121">Можно добавить неключевые столбцы на конечный уровень некластеризованного индекса и обойти существующее ограничение на ключи индексов (900 байт и 16 ключевых столбцов) и выполнять полностью индексированные запросы.</span><span class="sxs-lookup"><span data-stu-id="bc161-121">You can add nonkey columns to the leaf level of the nonclustered index to by-pass existing index key limits, 900 bytes and 16 key columns, and execute fully covered, indexed, queries.</span></span> <span data-ttu-id="bc161-122">Дополнительные сведения см. в статье [Create Indexes with Included Columns](create-indexes-with-included-columns.md).</span><span class="sxs-lookup"><span data-stu-id="bc161-122">For more information, see [Create Indexes with Included Columns](create-indexes-with-included-columns.md).</span></span>  
  
 <span data-ttu-id="bc161-123">Как кластеризованные, так и некластеризованные индексы могут быть уникальными.</span><span class="sxs-lookup"><span data-stu-id="bc161-123">Both clustered and nonclustered indexes can be unique.</span></span> <span data-ttu-id="bc161-124">Это означает, что никакие две строки не имеют одинаковое значение для ключа индекса.</span><span class="sxs-lookup"><span data-stu-id="bc161-124">This means no two rows can have the same value for the index key.</span></span> <span data-ttu-id="bc161-125">В противном случае индекс не является уникальным, и несколько строк могут содержать одно и то же значение.</span><span class="sxs-lookup"><span data-stu-id="bc161-125">Otherwise, the index is not unique and multiple rows can share the same key value.</span></span> <span data-ttu-id="bc161-126">Дополнительные сведения см. в статье [Создание уникальных индексов](create-unique-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="bc161-126">For more information, see [Create Unique Indexes](create-unique-indexes.md).</span></span>  
  
 <span data-ttu-id="bc161-127">Обслуживание индексов таблиц и представлений происходит автоматически при любом изменении данных в таблице.</span><span class="sxs-lookup"><span data-stu-id="bc161-127">Indexes are automatically maintained for a table or view whenever the table data is modified.</span></span>  
  
 <span data-ttu-id="bc161-128">Дополнительные типы специальных индексов см. в разделе [Indexes](indexes.md) .</span><span class="sxs-lookup"><span data-stu-id="bc161-128">See [Indexes](indexes.md) for additional types of special purpose indexes.</span></span>  
  
## <a name="indexes-and-constraints"></a><span data-ttu-id="bc161-129">Индексы и ограничения</span><span class="sxs-lookup"><span data-stu-id="bc161-129">Indexes and Constraints</span></span>  
 <span data-ttu-id="bc161-130">Индексы создаются автоматически при определении ограничений PRIMARY KEY или UNIQUE на основе столбцов таблицы.</span><span class="sxs-lookup"><span data-stu-id="bc161-130">Indexes are automatically created when PRIMARY KEY and UNIQUE constraints are defined on table columns.</span></span> <span data-ttu-id="bc161-131">Например, при создании таблицы и указании конкретного столбца в качестве первичного ключа, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] автоматически создает на основе этого столбца ограничение PRIMARY KEY и индекс.</span><span class="sxs-lookup"><span data-stu-id="bc161-131">For example, when you create a table and identify a particular column to be the primary key, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] automatically creates a PRIMARY KEY constraint and index on that column.</span></span> <span data-ttu-id="bc161-132">Дополнительные сведения см. в разделах [Create Primary Keys](../tables/create-primary-keys.md) и [Create Unique Constraints](../tables/create-unique-constraints.md).</span><span class="sxs-lookup"><span data-stu-id="bc161-132">For more information, see [Create Primary Keys](../tables/create-primary-keys.md) and [Create Unique Constraints](../tables/create-unique-constraints.md).</span></span>  
  
## <a name="how-indexes-are-used-by-the-query-optimizer"></a><span data-ttu-id="bc161-133">Как оптимизатор запросов использует индексы</span><span class="sxs-lookup"><span data-stu-id="bc161-133">How Indexes Are Used by the Query Optimizer</span></span>  
 <span data-ttu-id="bc161-134">Правильно построенные индексы могут сократить количество дисковых операций ввода-вывода, уменьшить потребление системных ресурсов, таким образом улучшая производительность запроса.</span><span class="sxs-lookup"><span data-stu-id="bc161-134">Well-designed indexes can reduce disk I/O operations and consume fewer system resources therefore improving query performance.</span></span> <span data-ttu-id="bc161-135">Индексы могут быть полезны во множестве запросов, содержащих инструкции SELECT, UPDATE, DELETE или MERGE.</span><span class="sxs-lookup"><span data-stu-id="bc161-135">Indexes can be helpful for a variety of queries that contain SELECT, UPDATE, DELETE, or MERGE statements.</span></span> <span data-ttu-id="bc161-136">Рассмотрим запрос `SELECT Title, HireDate FROM HumanResources.Employee WHERE EmployeeID = 250` в базе данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="bc161-136">Consider the query `SELECT Title, HireDate FROM HumanResources.Employee WHERE EmployeeID = 250` in the [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database.</span></span> <span data-ttu-id="bc161-137">При выполнении этого запроса оптимизатор запросов оценивает все доступные методы получения данных и выбирает наиболее эффективный метод.</span><span class="sxs-lookup"><span data-stu-id="bc161-137">When this query is executed, the query optimizer evaluates each available method for retrieving the data and selects the most efficient method.</span></span> <span data-ttu-id="bc161-138">Этим методом может являться просмотр таблицы или просмотр одного или более индексов, если они существуют.</span><span class="sxs-lookup"><span data-stu-id="bc161-138">The method may be a table scan, or may be scanning one or more indexes if they exist.</span></span>  
  
 <span data-ttu-id="bc161-139">При выполнении просмотра таблицы оптимизатор запросов считывает все строки таблицы и извлекает строки, удовлетворяющие критериям запроса.</span><span class="sxs-lookup"><span data-stu-id="bc161-139">When performing a table scan, the query optimizer reads all the rows in the table, and extracts the rows that meet the criteria of the query.</span></span> <span data-ttu-id="bc161-140">Просмотр таблицы формирует много дисковых операций ввода-вывода и может быть ресурсоемкой операцией.</span><span class="sxs-lookup"><span data-stu-id="bc161-140">A table scan generates many disk I/O operations and can be resource intensive.</span></span> <span data-ttu-id="bc161-141">Но если результирующий набор запроса содержит высокий процент строк таблицы, то просмотр таблицы может оказаться самым эффективным методом.</span><span class="sxs-lookup"><span data-stu-id="bc161-141">However, a table scan could be the most efficient method if, for example, the result set of the query is a high percentage of rows from the table.</span></span>  
  
 <span data-ttu-id="bc161-142">Когда оптимизатор запросов использует индекс, он выполняет поиск по ключевым столбцам индекса, находит место хранения запрашиваемых строк и извлекает оттуда совпадающие строки.</span><span class="sxs-lookup"><span data-stu-id="bc161-142">When the query optimizer uses an index, it searches the index key columns, finds the storage location of the rows needed by the query and extracts the matching rows from that location.</span></span> <span data-ttu-id="bc161-143">В основном поиск по индексу протекает намного быстрее, чем поиск по таблице, так как в отличие от таблицы индекс часто содержит мало столбцов в каждой строке и строки расположены в отсортированном порядке.</span><span class="sxs-lookup"><span data-stu-id="bc161-143">Generally, searching the index is much faster than searching the table because unlike a table, an index frequently contains very few columns per row and the rows are in sorted order.</span></span>  
  
 <span data-ttu-id="bc161-144">Оптимизатор запросов обычно выбирает наиболее эффективный метод при выполнении запросов.</span><span class="sxs-lookup"><span data-stu-id="bc161-144">The query optimizer typically selects the most efficient method when executing queries.</span></span> <span data-ttu-id="bc161-145">Но если отсутствуют доступные индексы, оптимизатор запросов должен использовать просмотр таблицы.</span><span class="sxs-lookup"><span data-stu-id="bc161-145">However, if no indexes are available, the query optimizer must use a table scan.</span></span> <span data-ttu-id="bc161-146">Ваша задача — спроектировать и создать индексы, которые лучше всего подходят для конкретной среды, чтобы оптимизатор запросов мог выбирать из нескольких эффективных индексов.</span><span class="sxs-lookup"><span data-stu-id="bc161-146">Your task is to design and create indexes that are best suited to your environment so that the query optimizer has a selection of efficient indexes from which to select.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="bc161-147">включает [помощник по настройке ядра СУБД](../performance/database-engine-tuning-advisor.md) , который может помочь при анализе среды базы данных и при выборе соответствующих индексов.</span><span class="sxs-lookup"><span data-stu-id="bc161-147">provides the [Database Engine Tuning Advisor](../performance/database-engine-tuning-advisor.md) to help with the analysis of your database environment and in the selection of appropriate indexes.</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="bc161-148">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="bc161-148">Related Tasks</span></span>  
 [<span data-ttu-id="bc161-149">Создание кластеризованных индексов</span><span class="sxs-lookup"><span data-stu-id="bc161-149">Create Clustered Indexes</span></span>](create-clustered-indexes.md)  
  
 [<span data-ttu-id="bc161-150">Создание некластеризованных индексов</span><span class="sxs-lookup"><span data-stu-id="bc161-150">Create Nonclustered Indexes</span></span>](create-nonclustered-indexes.md)  
  
  
