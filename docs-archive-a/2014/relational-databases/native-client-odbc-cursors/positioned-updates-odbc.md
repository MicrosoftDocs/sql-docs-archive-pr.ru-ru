---
title: Позиционированные обновления (ODBC) | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client ODBC driver, cursors
- SQLSetPos function
- SQLSetCursorName function
- ODBC applications, cursors
- cursors [ODBC], positioned updates
- positioned updates [ODBC]
- ODBC cursors, positioned updates
ms.assetid: ff404e02-630f-474d-b5d4-06442b756991
author: rothja
ms.author: jroth
ms.openlocfilehash: 20272014e32632117e6282e5929d1d21789852df
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87657776"
---
# <a name="positioned-updates-odbc"></a><span data-ttu-id="61c22-102">Позиционированное обновление (ODBC)</span><span class="sxs-lookup"><span data-stu-id="61c22-102">Positioned Updates (ODBC)</span></span>
  <span data-ttu-id="61c22-103">ODBC поддерживает два метода выполнения позиционированных обновлений в курсоре:</span><span class="sxs-lookup"><span data-stu-id="61c22-103">ODBC supports two methods for performing positioned updates in a cursor:</span></span>  
  
-   <span data-ttu-id="61c22-104">**функция SQLSetPos;**</span><span class="sxs-lookup"><span data-stu-id="61c22-104">**SQLSetPos**</span></span>  
  
-   <span data-ttu-id="61c22-105">предложение WHERE CURRENT OF.</span><span class="sxs-lookup"><span data-stu-id="61c22-105">WHERE CURRENT OF clause</span></span>  
  
 <span data-ttu-id="61c22-106">Наиболее распространенный подход заключается в использовании функции **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="61c22-106">The more common approach is to use **SQLSetPos**.</span></span> <span data-ttu-id="61c22-107">Она имеет следующие параметры.</span><span class="sxs-lookup"><span data-stu-id="61c22-107">It has the following options.</span></span>  
  
 <span data-ttu-id="61c22-108">SQL_POSITION</span><span class="sxs-lookup"><span data-stu-id="61c22-108">SQL_POSITION</span></span>  
 <span data-ttu-id="61c22-109">Позиционирует курсор в определенной строке в текущем наборе строк.</span><span class="sxs-lookup"><span data-stu-id="61c22-109">Positions the cursor on a specific row in the current rowset.</span></span>  
  
 <span data-ttu-id="61c22-110">SQL_REFRESH</span><span class="sxs-lookup"><span data-stu-id="61c22-110">SQL_REFRESH</span></span>  
 <span data-ttu-id="61c22-111">Обновляет программные переменные, привязанные к столбцам результирующего набора, присваивая им новые значения из строки, в которой в настоящий момент позиционирован курсор.</span><span class="sxs-lookup"><span data-stu-id="61c22-111">Refreshes program variables bound to the result set columns with the values from the row the cursor is currently positioned on.</span></span>  
  
 <span data-ttu-id="61c22-112">SQL_UPDATE</span><span class="sxs-lookup"><span data-stu-id="61c22-112">SQL_UPDATE</span></span>  
 <span data-ttu-id="61c22-113">Обновляет текущую строку в курсоре значениями, хранимыми в программных переменных, которые привязаны к столбцам результирующего набора.</span><span class="sxs-lookup"><span data-stu-id="61c22-113">Updates the current row in the cursor with the values stored in the program variables bound to the result set columns.</span></span>  
  
 <span data-ttu-id="61c22-114">SQL_DELETE</span><span class="sxs-lookup"><span data-stu-id="61c22-114">SQL_DELETE</span></span>  
 <span data-ttu-id="61c22-115">Удаляет текущую строку в курсоре.</span><span class="sxs-lookup"><span data-stu-id="61c22-115">Deletes the current row in the cursor.</span></span>  
  
 <span data-ttu-id="61c22-116">Функцию **SQLSetPos** можно использовать с любым результирующим набором инструкций, когда инструкция обрабатывает атрибуты курсора для использования серверных курсоров.</span><span class="sxs-lookup"><span data-stu-id="61c22-116">**SQLSetPos** can be used with any statement result set when the statement handle cursor attributes are set to use server cursors.</span></span> <span data-ttu-id="61c22-117">Столбцы результирующего набора должны быть привязаны к переменным программы.</span><span class="sxs-lookup"><span data-stu-id="61c22-117">The result set columns must be bound to program variables.</span></span> <span data-ttu-id="61c22-118">После того как приложение выберет строку, она вызывает функцию **SQLSetPos**(SQL_POSTION) для позиционирования курсора в строке.</span><span class="sxs-lookup"><span data-stu-id="61c22-118">As soon as the application has fetched a row it calls **SQLSetPos**(SQL_POSTION) to position the cursor on the row.</span></span> <span data-ttu-id="61c22-119">Затем приложение может вызвать функцию SQLSetPos(SQL_DELETE) для удаления текущей строки или изменить значения привязанных переменных программы и вызвать функцию SQLSetPos(SQL_UPDATE) для обновления текущей строки.</span><span class="sxs-lookup"><span data-stu-id="61c22-119">The application could then call SQLSetPos(SQL_DELETE) to delete the current row, or it can move new data values into the bound program variables and call SQLSetPos(SQL_UPDATE) to update the current row.</span></span>  
  
 <span data-ttu-id="61c22-120">Приложения могут обновлять или удалять любую строку в наборе строк с помощью функции **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="61c22-120">Applications can update or delete any row in the rowset with **SQLSetPos**.</span></span> <span data-ttu-id="61c22-121">Вызов **SQLSetPos** — это удобная альтернатива созданию и выполнению инструкции SQL.</span><span class="sxs-lookup"><span data-stu-id="61c22-121">Calling **SQLSetPos** is a convenient alternative to constructing and executing an SQL statement.</span></span> <span data-ttu-id="61c22-122">Функция **SQLSetPos** работает с текущим набором строк и может использоваться только после вызова [SQLFetchScroll](../native-client-odbc-api/sqlfetchscroll.md).</span><span class="sxs-lookup"><span data-stu-id="61c22-122">**SQLSetPos** operates on the current rowset and can be used only after a call to [SQLFetchScroll](../native-client-odbc-api/sqlfetchscroll.md).</span></span>  
  
 <span data-ttu-id="61c22-123">Размер набора строк задается вызовом [SQLSetStmtAttr](../native-client-odbc-api/sqlsetstmtattr.md) с аргументом атрибута SQL_ATTR_ROW_ARRAY_SIZE.</span><span class="sxs-lookup"><span data-stu-id="61c22-123">Rowset size is set by a call to [SQLSetStmtAttr](../native-client-odbc-api/sqlsetstmtattr.md) with an attribute argument of SQL_ATTR_ROW_ARRAY_SIZE.</span></span> <span data-ttu-id="61c22-124">В **SQLSetPos** используется новый размер набора строк, но только после вызова **SQLFetch** или **SQLFetchScroll**.</span><span class="sxs-lookup"><span data-stu-id="61c22-124">**SQLSetPos** uses a new rowset size, but only after a call to **SQLFetch** or **SQLFetchScroll**.</span></span> <span data-ttu-id="61c22-125">Например, если изменяется размер набора строк, вызывается функция **SQLSetPos** , а затем вызывается **SQLFetch** или **SQLFetchScroll** .</span><span class="sxs-lookup"><span data-stu-id="61c22-125">For example, if the rowset size is changed, **SQLSetPos** is called and then **SQLFetch** or **SQLFetchScroll** is called.</span></span> <span data-ttu-id="61c22-126">При вызове функции **SQLSetPos** используется старый размер набора строк, но **SQLFetch** или **SQLFetchScroll** использует новый размер набора строк.</span><span class="sxs-lookup"><span data-stu-id="61c22-126">The call to **SQLSetPos** uses the old rowset size, but **SQLFetch** or **SQLFetchScroll** uses the new rowset size.</span></span>  
  
 <span data-ttu-id="61c22-127">Первая строка в наборе строк имеет номер 1.</span><span class="sxs-lookup"><span data-stu-id="61c22-127">The first row in the rowset is row number 1.</span></span> <span data-ttu-id="61c22-128">Аргумент RowNumber в **SQLSetPos** должен указывать строку в наборе строк; то есть его значение должно находиться в диапазоне от 1 до количества недавно выбранных строк.</span><span class="sxs-lookup"><span data-stu-id="61c22-128">The RowNumber argument in **SQLSetPos** must identify a row in the rowset; that is, its value must be in the range between 1 and the number of rows that were most recently fetched.</span></span> <span data-ttu-id="61c22-129">Оно может быть меньше размера набора строк.</span><span class="sxs-lookup"><span data-stu-id="61c22-129">This may be less than the rowset size.</span></span> <span data-ttu-id="61c22-130">Если аргумент RowNumber имеет значение 0, то операция применяется к каждой строке набора строк.</span><span class="sxs-lookup"><span data-stu-id="61c22-130">If RowNumber is 0, the operation applies to every row in the rowset.</span></span>  
  
 <span data-ttu-id="61c22-131">Операция удаления функции **SQLSetPos** позволяет источнику данных удалить одну или несколько выбранных строк таблицы.</span><span class="sxs-lookup"><span data-stu-id="61c22-131">The delete operation of **SQLSetPos** makes the data source delete one or more selected rows of a table.</span></span> <span data-ttu-id="61c22-132">Чтобы удалить строки с помощью функции **SQLSetPos**, приложение вызывает функцию **SQLSetPos** с набором операций SQL_DELETE, а функция RowNumber задает номер удаляемой строки.</span><span class="sxs-lookup"><span data-stu-id="61c22-132">To delete rows with **SQLSetPos**, the application calls **SQLSetPos** with Operation set to SQL_DELETE and RowNumber set to the number of the row to delete.</span></span> <span data-ttu-id="61c22-133">Если аргумент RowNumber имеет значение 0, то из набора строк удаляются все строки.</span><span class="sxs-lookup"><span data-stu-id="61c22-133">If RowNumber is 0, all rows in the rowset are deleted.</span></span>  
  
 <span data-ttu-id="61c22-134">После возврата функции **SQLSetPos** удаленная строка будет текущей строкой, а ее состояние будет SQL_ROW_DELETED.</span><span class="sxs-lookup"><span data-stu-id="61c22-134">After **SQLSetPos** returns, the deleted row is the current row and its status is SQL_ROW_DELETED.</span></span> <span data-ttu-id="61c22-135">Строку нельзя использовать в дополнительных позиционированных операциях, например в вызовах [SQLGetData](../native-client-odbc-api/sqlgetdata.md) или **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="61c22-135">The row cannot be used in any additional positioned operations, such as calls to [SQLGetData](../native-client-odbc-api/sqlgetdata.md) or **SQLSetPos**.</span></span>  
  
 <span data-ttu-id="61c22-136">При удалении всех строк набора строк (RowNumber равен 0) приложение может запретить драйверу удалять определенные строки с помощью массива операций строк, как и для операции обновления **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="61c22-136">When you delete all rows of the rowset (RowNumber is equal to 0), the application can prevent the driver from deleting certain rows by using the row operation array just like for the update operation of **SQLSetPos**.</span></span>  
  
 <span data-ttu-id="61c22-137">Каждая удаляемая строка должна существовать в результирующем наборе.</span><span class="sxs-lookup"><span data-stu-id="61c22-137">Every row that is deleted should be a row that exists in the result set.</span></span> <span data-ttu-id="61c22-138">Если буферы приложения заполняются выборкой, а массив состояния строк сохраняется, то значения каждой из этих позиций строк не должны иметь значение SQL_ROW_DELETED, SQL_ROW_ERROR, или SQL_ROW_NOROW.</span><span class="sxs-lookup"><span data-stu-id="61c22-138">If the application buffers were filled by fetching, and if a row status array has been maintained, its values at each of these row positions should not be SQL_ROW_DELETED, SQL_ROW_ERROR, or SQL_ROW_NOROW.</span></span>  
  
 <span data-ttu-id="61c22-139">Позиционированные обновления также можно выполнить с помощью предложения WHERE CURRENT OF инструкций UPDATE, DELETE и INSERT.</span><span class="sxs-lookup"><span data-stu-id="61c22-139">Positioned updates can also be performed using the WHERE CURRENT OF clause on UPDATE, DELETE, and INSERT statements.</span></span> <span data-ttu-id="61c22-140">Если для CURRENT из требуется имя курсора, создаваемое ODBC при вызове функции [SQLGetCursorName](../native-client-odbc-api/sqlgetcursorname.md) , или которое можно указать путем вызова **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="61c22-140">WHERE CURRENT OF requires a cursor name that ODBC will generate when the [SQLGetCursorName](../native-client-odbc-api/sqlgetcursorname.md) function is called, or which you can specify by calling **SQLSetCursorName**.</span></span> <span data-ttu-id="61c22-141">Для обновления с помощью предложения WHERE CURRENT OF в предложении ODBC используются следующие основные шаги.</span><span class="sxs-lookup"><span data-stu-id="61c22-141">The following are general steps used to perform a WHERE CURRENT OF update in an ODBC application:</span></span>  
  
-   <span data-ttu-id="61c22-142">Вызовите **SQLSetCursorName** , чтобы установить имя курсора для маркера инструкции.</span><span class="sxs-lookup"><span data-stu-id="61c22-142">Call **SQLSetCursorName** to establish a cursor name for the statement handle.</span></span>  
  
-   <span data-ttu-id="61c22-143">Создайте инструкцию SELECT с предложением FOR UPDATE OF и выполните ее.</span><span class="sxs-lookup"><span data-stu-id="61c22-143">Build a SELECT statement with a FOR UPDATE OF clause and execute it.</span></span>  
  
-   <span data-ttu-id="61c22-144">Вызовите **SQLFetchScroll** , чтобы получить набор строк или **SQLFetch** для получения строки.</span><span class="sxs-lookup"><span data-stu-id="61c22-144">Call **SQLFetchScroll** to retrieve a rowset or **SQLFetch** to retrieve a row.</span></span>  
  
-   <span data-ttu-id="61c22-145">Вызовите функцию **SQLSetPos** (SQL_POSITION), чтобы поместить курсор в строку.</span><span class="sxs-lookup"><span data-stu-id="61c22-145">Call **SQLSetPos** (SQL_POSITION) to position the cursor on the row.</span></span>  
  
-   <span data-ttu-id="61c22-146">Создайте и выполните инструкцию UPDATE с предложением WHERE CURRENT OF, используя имя курсора, заданное с помощью **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="61c22-146">Build and execute an UPDATE statement with a WHERE CURRENT OF clause using the cursor name set with **SQLSetCursorName**.</span></span>  
  
 <span data-ttu-id="61c22-147">Кроме того, можно вызвать **SQLGetCursorName** после выполнения инструкции SELECT вместо вызова **SQLSetCursorName** перед выполнением инструкции SELECT.</span><span class="sxs-lookup"><span data-stu-id="61c22-147">Alternatively, you could call **SQLGetCursorName** after you execute the SELECT statement instead of calling **SQLSetCursorName** before executing the SELECT statement.</span></span> <span data-ttu-id="61c22-148">**SQLGetCursorName** возвращает имя курсора по умолчанию, назначаемое ODBC, если не задано имя курсора с помощью **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="61c22-148">**SQLGetCursorName** returns a default cursor name assigned by ODBC if you do not set a cursor name using **SQLSetCursorName**.</span></span>  
  
 <span data-ttu-id="61c22-149">Параметр **SQLSetPos** предпочтительнее, чем при использовании серверных курсоров.</span><span class="sxs-lookup"><span data-stu-id="61c22-149">**SQLSetPos** is preferred over WHERE CURRENT OF when you are using server cursors.</span></span> <span data-ttu-id="61c22-150">Если используется статический обновляемый курсор с библиотекой курсоров ODBC, то данная библиотека реализует обновления предложения WHERE CURRENT OF путем добавления предложения WHERE с ключевыми значениями базовой таблицы.</span><span class="sxs-lookup"><span data-stu-id="61c22-150">If you are using a static, updatable cursor with the ODBC cursor library, the cursor library implements WHERE CURRENT OF updates by adding a WHERE clause with the key values for the underlying table.</span></span> <span data-ttu-id="61c22-151">Это может вызвать непреднамеренные обновления, если ключи в таблице не являются уникальными.</span><span class="sxs-lookup"><span data-stu-id="61c22-151">This can cause unintended updates if the keys in the table are not unique.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="61c22-152">См. также:</span><span class="sxs-lookup"><span data-stu-id="61c22-152">See Also</span></span>  
 [<span data-ttu-id="61c22-153">Использование курсоров &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="61c22-153">Using Cursors &#40;ODBC&#41;</span></span>](using-cursors-odbc.md)  
  
  
