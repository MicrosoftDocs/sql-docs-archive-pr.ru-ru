---
title: Создание набора строк возвращающего табличное значение параметра | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters, rowset creation
ms.assetid: ffe213ca-cc0e-465e-b31c-a8272324c4fe
author: rothja
ms.author: jroth
ms.openlocfilehash: a22ccbd583d95c41daa0a113363985828cf1e9d6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87657736"
---
# <a name="table-valued-parameter-rowset-creation"></a><span data-ttu-id="5c2aa-102">Создание набора строк возвращающего табличное значение параметра</span><span class="sxs-lookup"><span data-stu-id="5c2aa-102">Table-Valued Parameter Rowset Creation</span></span>
  <span data-ttu-id="5c2aa-103">Несмотря на то, что потребители могут предоставить для возвращающих табличные значения параметров любой объект набора строк, типичные объекты наборов строк реализуются для конечных хранилищ данных и таким образом предоставляют ограниченную производительность.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-103">Although consumers can provide any rowset object for table-valued parameters, typical rowset objects are implemented against back-end data stores, and therefore provide limited performance.</span></span> <span data-ttu-id="5c2aa-104">По этой причине поставщик OLE DB собственного клиента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] разрешает пользователям создавать специализированный объект набора строк на основе данных в памяти.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-104">For this reason, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider enables consumers to create a specialized rowset object on top of in-memory data.</span></span> <span data-ttu-id="5c2aa-105">Этот специальный объект набора строк в памяти — это новый COM-объект, называемый набором строк возвращающего табличное значение параметра.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-105">This special, in-memory rowset object is a new COM object called a table-valued parameter rowset .</span></span> <span data-ttu-id="5c2aa-106">Он предлагает функциональные возможности, аналогичные набору параметров.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-106">It provides functionality similar to parameter sets.</span></span>  
  
 <span data-ttu-id="5c2aa-107">Объекты набора строк возвращающего табличное значение параметра создаются явным образом поставщиком для входных параметров через несколько интерфейсов уровня сеанса.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-107">Table-valued parameter rowset objects are created explicitly by the consumer for input parameters through multiple session-level interfaces.</span></span> <span data-ttu-id="5c2aa-108">Для одного возвращающего значение параметра существует один объект набора строк.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-108">There is one instance of a table-valued parameter rowset object per table-valued parameter.</span></span> <span data-ttu-id="5c2aa-109">Потребитель может создавать объекты набора строк возвращающего табличное значение параметра либо путем предоставления уже известных метаданных (статический сценарий), либо путем его обнаружения через интерфейсы поставщика (динамический сценарий).</span><span class="sxs-lookup"><span data-stu-id="5c2aa-109">The consumer can create the table-valued parameter rowset objects either by providing metadata information that is already known (static scenario), or by discovering it through provider interfaces (dynamic scenario).</span></span> <span data-ttu-id="5c2aa-110">Эти два сценария описаны в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-110">The following sections describe these two scenarios.</span></span>  
  
## <a name="static-scenario"></a><span data-ttu-id="5c2aa-111">Статический сценарий</span><span class="sxs-lookup"><span data-stu-id="5c2aa-111">Static Scenario</span></span>  
 <span data-ttu-id="5c2aa-112">Когда сведения о типе известны, потребитель использует метод ITableDefinitionWithConstraints::CreateTableWithConstraints для создания экземпляра объекта набора строк, соответствующего возвращающему табличное значение параметру.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-112">When the type information is known, the consumer uses ITableDefinitionWithConstraints::CreateTableWithConstraints to instantiate a table-valued parameter rowset object that corresponds to a table-valued parameter.</span></span>  
  
 <span data-ttu-id="5c2aa-113">Поле *guid* (параметр *pTableID*) содержит специальный идентификатор GUID (CLSID_ROWSET_TVP).</span><span class="sxs-lookup"><span data-stu-id="5c2aa-113">The *guid* field (*pTableID* parameter) contains the special GUID (CLSID_ROWSET_TVP).</span></span> <span data-ttu-id="5c2aa-114">Элемент *pwszName* содержит имя типа возвращающего табличное значение параметра, который потребитель хочет создать.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-114">The *pwszName* member contains the name of the table-valued parameter type that the consumer wants to instantiate.</span></span> <span data-ttu-id="5c2aa-115">Поле *eKind* будет установлено в значение DBKIND_GUID_NAME.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-115">The *eKind* field will be set to DBKIND_GUID_NAME.</span></span> <span data-ttu-id="5c2aa-116">Данное имя требуется при использовании нерегламентированной инструкции SQL. При вызове процедуры имя является необязательным.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-116">This name is required when the statement is ad hoc SQL; the name is optional if it is a procedure call.</span></span>  
  
 <span data-ttu-id="5c2aa-117">Для статистической обработки потребитель передает параметр *pUnkOuter* и управляющий интерфейс IUnknown.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-117">For aggregation, the consumer passes the *pUnkOuter* parameter with the controlling IUnknown.</span></span>  
  
 <span data-ttu-id="5c2aa-118">Свойства объекта набора строк возвращающего табличное значение параметра доступны только для чтения, поэтому потребитель не должен устанавливать какие-либо свойства в *rgPropertySets*.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-118">The table-valued parameter rowset object properties are read only, so the consumer is not expected to set any properties in *rgPropertySets*.</span></span>  
  
 <span data-ttu-id="5c2aa-119">Для элемента *rgPropertySets* каждой структуры DBCOLUMNDESC потребитель может указать дополнительные свойства для каждого столбца.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-119">For the *rgPropertySets* member of each DBCOLUMNDESC structure, the consumer can specify additional properties for each column.</span></span> <span data-ttu-id="5c2aa-120">Эти свойства принадлежат набору свойств DBPROPSET_SQLSERVERCOLUMN.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-120">These properties belong to the DBPROPSET_SQLSERVERCOLUMN property set.</span></span> <span data-ttu-id="5c2aa-121">Они позволяют указать для каждого столбца вычисляемые настройки и настройки по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-121">They enable you to specify computed and default settings for each column.</span></span> <span data-ttu-id="5c2aa-122">Также они поддерживают существующие свойства столбца, например допустимость значений NULL и идентификатор.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-122">They also support existing column properties, such as nullability and identity.</span></span>  
  
 <span data-ttu-id="5c2aa-123">Для получения соответствующих сведений от объекта набора строк возвращающего табличные значения параметра потребитель использует метод IRowsetInfo::GetProperties.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-123">To retrieve corresponding information from a table-valued parameter rowset object, the consumer uses IRowsetInfo::GetProperties.</span></span>  
  
 <span data-ttu-id="5c2aa-124">Чтобы получить сведения об нулевом, уникальном, вычисляемом и обновленном состоянии каждого столбца, потребитель использует IColumnsRowset:: Жетколумнсровсет или IColumnsInfo:: GetColumnInfo.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-124">To retrieve information about the null, unique, computed, and update status of each column, the consumer use IColumnsRowset::GetColumnsRowset or IColumnsInfo::GetColumnInfo.</span></span> <span data-ttu-id="5c2aa-125">Эти методы предоставляют подробные сведения о каждом столбце набора строк возвращающего табличные значения параметра.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-125">These methods provide detailed information about each table-valued parameter rowset column.</span></span>  
  
 <span data-ttu-id="5c2aa-126">Потребитель указывает тип каждого столбца возвращающего табличные значения параметра.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-126">The consumer specifies the type of each column of the table-valued parameter.</span></span> <span data-ttu-id="5c2aa-127">Это действие аналогично тому, как указываются столбцы при создании таблицы в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5c2aa-127">This is similar to how columns are specified when a table is created in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="5c2aa-128">Потребитель получает объект набора строк возвращающего табличное значение параметра от [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поставщика собственного клиента OLE DB с помощью выходного параметра *ппровсет* .</span><span class="sxs-lookup"><span data-stu-id="5c2aa-128">The consumer obtains a table-valued parameter rowset object from the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider through the *ppRowset* output parameter.</span></span>  
  
## <a name="dynamic-scenario"></a><span data-ttu-id="5c2aa-129">Динамический сценарий</span><span class="sxs-lookup"><span data-stu-id="5c2aa-129">Dynamic Scenario</span></span>  
 <span data-ttu-id="5c2aa-130">Если потребитель не имеет сведений о типе, он должен использовать IOpenRowset:: OpenRowset для создания экземпляров объектов набора строк возвращающего табличное значение параметра.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-130">When the consumer does not have type information, it should use IOpenRowset::OpenRowset to instantiate table-valued parameter rowset objects.</span></span> <span data-ttu-id="5c2aa-131">Потребитель должен предоставить поставщику имя типа.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-131">All the consumer has to provide to the provider is the type name.</span></span>  
  
 <span data-ttu-id="5c2aa-132">В этом сценарии поставщик получает сведения о типе объекта набора строк возвращающего табличные значения параметра из сервера от лица потребителя.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-132">In this scenario, the provider obtains type information about a table-valued parameter rowset object from the server on behalf of the consumer.</span></span>  
  
 <span data-ttu-id="5c2aa-133">Параметры *pTableID* и *pUnkOuter* устанавливаются так же, как и в статическом сценарии.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-133">The *pTableID* and *pUnkOuter* parameters should be set as in the static scenario.</span></span> <span data-ttu-id="5c2aa-134">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]Поставщик OLE DB собственного клиента получает сведения о типе (сведения о столбцах и ограничениях) с сервера и возвращает объект набора строк возвращающего табличное значение параметра через параметр *ппровсет* .</span><span class="sxs-lookup"><span data-stu-id="5c2aa-134">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider then obtains the type information (column information and constraints) from the server, and return a table-valued parameter rowset object through the *ppRowset* parameter.</span></span> <span data-ttu-id="5c2aa-135">Данная операция требует связи с сервером, поэтому выполняется не так быстро, как статический сценарий.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-135">This operation requires communication with the server, and therefore does not perform as well as the static scenario.</span></span> <span data-ttu-id="5c2aa-136">Динамический сценарий работает только с параметризованными вызовами процедур.</span><span class="sxs-lookup"><span data-stu-id="5c2aa-136">The dynamic scenario works only with parameterized procedure calls.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5c2aa-137">См. также:</span><span class="sxs-lookup"><span data-stu-id="5c2aa-137">See Also</span></span>  
 <span data-ttu-id="5c2aa-138">[Возвращающие табличное значение параметры &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="5c2aa-138">[Table-Valued Parameters &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span></span>  
 [<span data-ttu-id="5c2aa-139">Использование возвращающих табличные значения параметров &#40;OLE DB&#41;</span><span class="sxs-lookup"><span data-stu-id="5c2aa-139">Use Table-Valued Parameters &#40;OLE DB&#41;</span></span>](../native-client-ole-db-how-to/use-table-valued-parameters-ole-db.md)  
  
  
