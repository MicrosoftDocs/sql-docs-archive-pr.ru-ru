---
title: Ключи шифрования базы данных и SQL Server (ядро СУБД) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- keys [SQL Server], database encryption
ms.assetid: 15c0a5e8-9177-484c-ae75-8c552dc0dac0
author: jaszymas
ms.author: jaszymas
ms.openlocfilehash: f846e74e0afd89c6bb10a4aa9a23a6420b6a613a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87752052"
---
# <a name="sql-server-and-database-encryption-keys-database-engine"></a><span data-ttu-id="04710-102">Ключи шифрования базы данных и SQL Server (компонент Database Engine)</span><span class="sxs-lookup"><span data-stu-id="04710-102">SQL Server and Database Encryption Keys (Database Engine)</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="04710-103">используются ключи шифрования для защиты данных, информации об учетных данных и соединениях, которые хранятся в серверной базе данных.</span><span class="sxs-lookup"><span data-stu-id="04710-103">uses encryption keys to help secure data, credentials, and connection information that is stored in a server database.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="04710-104">существует два вида ключей: *симметричный* и *aсимметричный*.</span><span class="sxs-lookup"><span data-stu-id="04710-104">has two kinds of keys: *symmetric* and *asymmetric*.</span></span> <span data-ttu-id="04710-105">В симметричных ключах для шифрования и расшифровки данных используется одинаковый пароль.</span><span class="sxs-lookup"><span data-stu-id="04710-105">Symmetric keys use the same password to encrypt and decrypt data.</span></span> <span data-ttu-id="04710-106">При использовании асимметричных ключей один пароль применяется для шифрования данных ( *открытый* ключ), а другой для расшифровки данных ( *закрытый* ключ).</span><span class="sxs-lookup"><span data-stu-id="04710-106">Asymmetric keys use one password to encrypt data (called the *public* key) and another to decrypt data (called the *private* key).</span></span>  
  
 <span data-ttu-id="04710-107">Используемые в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]ключи шифрования представляют собой сочетание открытых, закрытых и симметричных ключей, которые используются для защиты конфиденциальных данных.</span><span class="sxs-lookup"><span data-stu-id="04710-107">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], encryption keys include a combination of public, private, and symmetric keys that are used to protect sensitive data.</span></span> <span data-ttu-id="04710-108">Симметричный ключ создается во время инициализации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , при первом запуске экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="04710-108">The symmetric key is created during [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] initialization when you first start the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="04710-109">Этот ключ используется [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для шифрования конфиденциальных данных, которые хранятся в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="04710-109">The key is used by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to encrypt sensitive data that is stored in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="04710-110">Открытые и закрытые ключи создаются операционной системой и используются для защиты симметричного ключа.</span><span class="sxs-lookup"><span data-stu-id="04710-110">Public and private keys are created by the operating system and they are used to protect the symmetric key.</span></span> <span data-ttu-id="04710-111">Пара из открытого и закрытого ключей создается для каждого экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , который сохраняет конфиденциальные данные в базе данных.</span><span class="sxs-lookup"><span data-stu-id="04710-111">A public and private key pair is created for each [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance that stores sensitive data in a database.</span></span>  
  
## <a name="applications-for-sql-server-and-database-keys"></a><span data-ttu-id="04710-112">Применения ключей шифрования SQL Server и базы данных</span><span class="sxs-lookup"><span data-stu-id="04710-112">Applications for SQL Server and Database Keys</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="04710-113">поддерживает два основных варианта применения ключей: *главный ключ службы* (SMK) создается на экземпляре [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и для этого экземпляра, а *главный ключ базы данных* (DMK) используется для базы данных.</span><span class="sxs-lookup"><span data-stu-id="04710-113">has two primary applications for keys: a *service master key* (SMK) generated on and for a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance, and a *database master key* (DMK) used for a database.</span></span>  
  
 <span data-ttu-id="04710-114">Главный ключ службы автоматически создается при первом запуске экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и используется для шифрования пароля связанного сервера, учетных данных или главного ключа базы данных.</span><span class="sxs-lookup"><span data-stu-id="04710-114">The SMK is automatically generated the first time the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is started and is used to encrypt a linked server password, credentials, and the database master key.</span></span> <span data-ttu-id="04710-115">Главный ключ службы шифруется с помощью ключа локального компьютера и API-интерфейса защиты данных Windows.</span><span class="sxs-lookup"><span data-stu-id="04710-115">The SMK is encrypted by using the local computer key using the Windows Data Protection API (DPAPI).</span></span> <span data-ttu-id="04710-116">Этот API-интерфейс использует ключ, получаемый из учетных данных Windows, которые соответствуют учетной записи службы для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и учетным данным компьютера.</span><span class="sxs-lookup"><span data-stu-id="04710-116">The DPAPI uses a key that is derived from the Windows credentials of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] service account and the computer's credentials.</span></span> <span data-ttu-id="04710-117">Главный ключ службы может быть расшифрован лишь той учетной записью службы, под которой он был создан, или участником, имеющим доступ к учетным данным компьютера.</span><span class="sxs-lookup"><span data-stu-id="04710-117">The service master key can only be decrypted by the service account under which it was created or by a principal that has access to the machine's credentials.</span></span>  
  
 <span data-ttu-id="04710-118">Главный ключ базы данных — это симметричный ключ, который применяется для защиты закрытых ключей сертификатов и асимметричный ключей, которые есть в базе данных.</span><span class="sxs-lookup"><span data-stu-id="04710-118">The database master key is a symmetric key that is used to protect the private keys of certificates and asymmetric keys that are present in the database.</span></span> <span data-ttu-id="04710-119">Он также может использоваться для шифрования данных, но из-за ограниченной длины не может применяться на практике для шифрования данных так же широко, как симметричный ключ.</span><span class="sxs-lookup"><span data-stu-id="04710-119">It can also be used to encrypt data, but it has length limitations that make it less practical for data than using a symmetric key.</span></span>  
  
 <span data-ttu-id="04710-120">При создании этот ключ зашифровывается с помощью алгоритма «Triple DES» и пользовательского пароля.</span><span class="sxs-lookup"><span data-stu-id="04710-120">When it is created, the master key is encrypted by using the Triple DES algorithm and a user-supplied password.</span></span> <span data-ttu-id="04710-121">Чтобы разрешить автоматическое шифрование главного ключа, копия этого ключа зашифровывается с помощью главного ключа службы.</span><span class="sxs-lookup"><span data-stu-id="04710-121">To enable the automatic decryption of the master key, a copy of the key is encrypted by using the SMK.</span></span> <span data-ttu-id="04710-122">Ключ хранится как в базе данных, где используется ключ, так и в системной базе данных `master`.</span><span class="sxs-lookup"><span data-stu-id="04710-122">It is stored in both the database where it is used and in the `master` system database.</span></span>  
  
 <span data-ttu-id="04710-123">Копия, которая хранится в базе данных `master`, автоматически обновляется при каждом изменении главного ключа.</span><span class="sxs-lookup"><span data-stu-id="04710-123">The copy of the DMK stored in the `master` system database is silently updated whenever the DMK is changed.</span></span> <span data-ttu-id="04710-124">Но это поведение по умолчанию может быть изменено с помощью параметра `DROP ENCRYPTION BY SERVICE MASTER KEY` инструкции `ALTER MASTER KEY`.</span><span class="sxs-lookup"><span data-stu-id="04710-124">However, this default can be changed by using the `DROP ENCRYPTION BY SERVICE MASTER KEY` option of the `ALTER MASTER KEY` statement.</span></span> <span data-ttu-id="04710-125">Главный ключ базы данных, который не зашифрован с помощью главного ключа службы, следует открывать с помощью инструкции `OPEN MASTER KEY` и пароля.</span><span class="sxs-lookup"><span data-stu-id="04710-125">A DMK that is not encrypted by the service master key must be opened by using the `OPEN MASTER KEY` statement and a password.</span></span>  
  
## <a name="managing-sql-server-and-database-keys"></a><span data-ttu-id="04710-126">Управление ключами SQL Server и базы данных</span><span class="sxs-lookup"><span data-stu-id="04710-126">Managing SQL Server and Database Keys</span></span>  
 <span data-ttu-id="04710-127">Управление ключами шифрования заключается в создании новых ключей базы данных, создании резервной копии ключей сервера и базы данных и знании порядка восстановления, удаления и смены ключей.</span><span class="sxs-lookup"><span data-stu-id="04710-127">Managing encryption keys consists of creating new database keys, creating a backup of the server and database keys, and knowing when and how to restore, delete, or change the keys.</span></span>  
  
 <span data-ttu-id="04710-128">Чтобы управлять симметричными ключами, можно использовать средства, входящие в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , для выполнения следующих действий:</span><span class="sxs-lookup"><span data-stu-id="04710-128">To manage symmetric keys, you can use the tools included in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to do the following:</span></span>  
  
-   <span data-ttu-id="04710-129">Резервное копирование копии ключа сервера и базы данных, чтобы использовать их при восстановлении установки сервера или в ходе запланированного переноса.</span><span class="sxs-lookup"><span data-stu-id="04710-129">Back up a copy of the server and database keys so that you can use them to recover a server installation, or as part of a planned migration.</span></span>  
  
-   <span data-ttu-id="04710-130">Восстановление ранее сохраненного ключа в базе данных.</span><span class="sxs-lookup"><span data-stu-id="04710-130">Restore a previously saved key to a database.</span></span> <span data-ttu-id="04710-131">Это позволяет новому экземпляру сервера обращаться к существующим данным, которые первоначально шифровались не им.</span><span class="sxs-lookup"><span data-stu-id="04710-131">This enables a new server instance to access existing data that it did not originally encrypt.</span></span>  
  
-   <span data-ttu-id="04710-132">Удаление зашифрованных данных из базы данных в маловероятной ситуации, когда не удается обратиться к зашифрованным данным.</span><span class="sxs-lookup"><span data-stu-id="04710-132">Delete the encrypted data in a database in the unlikely event that you can no longer access encrypted data.</span></span>  
  
-   <span data-ttu-id="04710-133">Повторное создание ключей и повторное шифрование данных в маловероятной ситуации, когда ключ становится известен посторонним.</span><span class="sxs-lookup"><span data-stu-id="04710-133">Re-create keys and re-encrypt data in the unlikely event that the key is compromised.</span></span> <span data-ttu-id="04710-134">Для повышения безопасности следует периодически повторно создавать ключи (например, раз в несколько месяцев) для защиты сервера от атак с целью расшифровки ключа.</span><span class="sxs-lookup"><span data-stu-id="04710-134">As a security best practice, you should re-create the keys periodically (for example, every few months) to protect the server from attacks that try to decipher the keys.</span></span>  
  
-   <span data-ttu-id="04710-135">Добавление или удаление экземпляра сервера из масштабного развертывания, когда несколько серверов используют одну базу данных и ключ, допускающий обратимое шифрование для этой базы данных.</span><span class="sxs-lookup"><span data-stu-id="04710-135">Add or remove a server instance from a server scale-out deployment where multiple servers share both a single database and the key that provides reversible encryption for that database.</span></span>  
  
## <a name="important-security-information"></a><span data-ttu-id="04710-136">Важная информация по безопасности</span><span class="sxs-lookup"><span data-stu-id="04710-136">Important Security Information</span></span>  
 <span data-ttu-id="04710-137">Для доступа к объектам, защищенным главным ключом службы, необходима учетная запись службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , которая использовалась для создания ключа, или учетная запись компьютера.</span><span class="sxs-lookup"><span data-stu-id="04710-137">Accessing objects secured by the service master key requires either the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Service account that was used to create the key or the computer (machine) account.</span></span> <span data-ttu-id="04710-138">То есть, компьютер привязан к системе, в которой был создан ключ.</span><span class="sxs-lookup"><span data-stu-id="04710-138">That is, the computer is tied to the system where the key was created.</span></span> <span data-ttu-id="04710-139">Можно изменить учетную запись службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]*или* учетную запись компьютера, не теряя доступа к ключу.</span><span class="sxs-lookup"><span data-stu-id="04710-139">You can change the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Service account *or* the computer account without losing access to the key.</span></span> <span data-ttu-id="04710-140">Однако если изменить обе учетные записи, доступ к главному ключу службы будет потерян.</span><span class="sxs-lookup"><span data-stu-id="04710-140">However, if you change both, you will lose access to the service master key.</span></span> <span data-ttu-id="04710-141">Если доступ к главному ключу службы будет потерян без одного из этих элементов, то не удастся расшифровать данные и объекты, зашифрованные с помощью первоначального ключа.</span><span class="sxs-lookup"><span data-stu-id="04710-141">If you lose access to the service master key without one of these two elements, you be unable to decrypt data and objects encrypted by using the original key.</span></span>  
  
 <span data-ttu-id="04710-142">Соединения, защищенные с помощью главного ключа службы, не могут быть восстановлены без него.</span><span class="sxs-lookup"><span data-stu-id="04710-142">Connections secured with the service master key cannot be restored without the service master key.</span></span>  
  
 <span data-ttu-id="04710-143">Для доступа к объектам и данным, защищенным главным ключом базы данных, требуется только пароль, использованный для защиты ключа.</span><span class="sxs-lookup"><span data-stu-id="04710-143">Access to objects and data secured with the database master key require only the password that is used to help secure the key.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="04710-144">Если любой доступ к описанным выше ключам потерян, будет потерян доступ к объектам, соединениям и данным, защищенным этими ключами.</span><span class="sxs-lookup"><span data-stu-id="04710-144">If you lose all access to the keys described earlier, you will lose access to the objects, connections, and data secured by those keys.</span></span> <span data-ttu-id="04710-145">Можно восстановить главный ключ службы, как описано в приведенных ссылках, или вернуться к первоначальной системе шифрования, чтобы восстановить доступ.</span><span class="sxs-lookup"><span data-stu-id="04710-145">You can restore the service master key, as described in the links that are shown here, or you can go back to the original encrypting system to recover the access.</span></span> <span data-ttu-id="04710-146">Не существует аварийного способа восстановления доступа.</span><span class="sxs-lookup"><span data-stu-id="04710-146">There is no "back-door" to recover the access.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="04710-147">в этом разделе</span><span class="sxs-lookup"><span data-stu-id="04710-147">In This Section</span></span>  
 [<span data-ttu-id="04710-148">Главный ключ службы</span><span class="sxs-lookup"><span data-stu-id="04710-148">Service Master Key</span></span>](service-master-key.md)  
 <span data-ttu-id="04710-149">Дано краткое объяснение главного ключа службы и рекомендации.</span><span class="sxs-lookup"><span data-stu-id="04710-149">Provides a brief explanation for the service master key and its best practices.</span></span>  
  
 [<span data-ttu-id="04710-150">Расширенное управление ключами &#40;EKM&#41;</span><span class="sxs-lookup"><span data-stu-id="04710-150">Extensible Key Management &#40;EKM&#41;</span></span>](extensible-key-management-ekm.md)  
 <span data-ttu-id="04710-151">Объясняется, как использовать сторонние системы управления ключами с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="04710-151">Explains how to use third-party key management systems with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="04710-152">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="04710-152">Related Tasks</span></span>  
 [<span data-ttu-id="04710-153">Создание резервной копии главного ключа службы</span><span class="sxs-lookup"><span data-stu-id="04710-153">Back Up the Service Master Key</span></span>](back-up-the-service-master-key.md)  
  
 [<span data-ttu-id="04710-154">Восстановление главного ключа службы</span><span class="sxs-lookup"><span data-stu-id="04710-154">Restore the Service Master Key</span></span>](restore-the-service-master-key.md)  
  
 [<span data-ttu-id="04710-155">Создание главного ключа базы данных</span><span class="sxs-lookup"><span data-stu-id="04710-155">Create a Database Master Key</span></span>](create-a-database-master-key.md)  
  
 [<span data-ttu-id="04710-156">Создание резервной копии главного ключа базы данных</span><span class="sxs-lookup"><span data-stu-id="04710-156">Back Up a Database Master Key</span></span>](back-up-a-database-master-key.md)  
  
 [<span data-ttu-id="04710-157">Восстановление главного ключа базы данных</span><span class="sxs-lookup"><span data-stu-id="04710-157">Restore a Database Master Key</span></span>](restore-a-database-master-key.md)  
  
 [<span data-ttu-id="04710-158">Создание идентичных симметричных ключей на двух серверах</span><span class="sxs-lookup"><span data-stu-id="04710-158">Create Identical Symmetric Keys on Two Servers</span></span>](create-identical-symmetric-keys-on-two-servers.md)  
  
 [<span data-ttu-id="04710-159">Расширенное управление ключами с помощью хранилища ключей Azure (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="04710-159">Extensible Key Management Using Azure Key Vault &#40;SQL Server&#41;</span></span>](extensible-key-management-using-azure-key-vault-sql-server.md)  
  
 [<span data-ttu-id="04710-160">Включение TDE с помощью расширенного управления ключами</span><span class="sxs-lookup"><span data-stu-id="04710-160">Enable TDE Using EKM</span></span>](enable-tde-on-sql-server-using-ekm.md)  
  
## <a name="related-content"></a><span data-ttu-id="04710-161">См. также</span><span class="sxs-lookup"><span data-stu-id="04710-161">Related Content</span></span>  
 [<span data-ttu-id="04710-162">CREATE MASTER KEY (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="04710-162">CREATE MASTER KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-master-key-transact-sql)  
  
 [<span data-ttu-id="04710-163">ALTER SERVICE MASTER KEY (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="04710-163">ALTER SERVICE MASTER KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-service-master-key-transact-sql)  
  
 [<span data-ttu-id="04710-164">Восстановление главного ключа базы данных</span><span class="sxs-lookup"><span data-stu-id="04710-164">Restore a Database Master Key</span></span>](restore-a-database-master-key.md)  
  
## <a name="see-also"></a><span data-ttu-id="04710-165">См. также:</span><span class="sxs-lookup"><span data-stu-id="04710-165">See Also</span></span>  
 <span data-ttu-id="04710-166">[Резервное копирование и восстановление ключей шифрования служб Reporting Services](../../../reporting-services/install-windows/ssrs-encryption-keys-back-up-and-restore-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="04710-166">[Back Up and Restore Reporting Services Encryption Keys](../../../reporting-services/install-windows/ssrs-encryption-keys-back-up-and-restore-encryption-keys.md) </span></span>  
 <span data-ttu-id="04710-167">[Удаление и повторное создание ключей шифрования (диспетчер конфигурации служб SSRS)](../../../reporting-services/install-windows/ssrs-encryption-keys-delete-and-re-create-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="04710-167">[Delete and Re-create Encryption Keys  &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/ssrs-encryption-keys-delete-and-re-create-encryption-keys.md) </span></span>  
 <span data-ttu-id="04710-168">[Добавление и удаление ключей шифрования для масштабного развертывания (диспетчер конфигурации служб SSRS)](../../../reporting-services/install-windows/add-and-remove-encryption-keys-for-scale-out-deployment.md) </span><span class="sxs-lookup"><span data-stu-id="04710-168">[Add and Remove Encryption Keys for Scale-Out Deployment &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/add-and-remove-encryption-keys-for-scale-out-deployment.md) </span></span>  
 [<span data-ttu-id="04710-169">Прозрачное шифрование данных (TDE)</span><span class="sxs-lookup"><span data-stu-id="04710-169">Transparent Data Encryption &#40;TDE&#41;</span></span>](transparent-data-encryption.md)  
  
  
