---
title: Иерархия средств шифрования | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- encryption [SQL Server], hierarchies
- cryptography [SQL Server], hierarchies
- encryption keys [SQL Server]
- security [SQL Server], encryption
- hierarchies [SQL Server], encryption
ms.assetid: 96c276d5-1bba-4e95-b678-10f059f1fbcf
author: jaszymas
ms.author: jaszymas
ms.openlocfilehash: d38bb83c2f6a2487e547c4686be5c65bc012e33e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750591"
---
# <a name="encryption-hierarchy"></a><span data-ttu-id="d7c71-102">Иерархия средств шифрования</span><span class="sxs-lookup"><span data-stu-id="d7c71-102">Encryption Hierarchy</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="d7c71-103">шифрует данные, используя иерархическую структуру средств шифрования и управления ключами.</span><span class="sxs-lookup"><span data-stu-id="d7c71-103">encrypts data with a hierarchical encryption and key management infrastructure.</span></span> <span data-ttu-id="d7c71-104">На каждом уровне данные низшего уровня шифруются на основе комбинации сертификатов, асимметричных ключей и симметричных ключей.</span><span class="sxs-lookup"><span data-stu-id="d7c71-104">Each layer encrypts the layer below it by using a combination of certificates, asymmetric keys, and symmetric keys.</span></span> <span data-ttu-id="d7c71-105">Асимметричные и симметричные ключи можно хранить вне модуля расширенного управления ключами [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d7c71-105">Asymmetric keys and symmetric keys can be stored outside of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] in an Extensible Key Management (EKM) module.</span></span>  
  
 <span data-ttu-id="d7c71-106">На следующем рисунке показано, что на каждом уровне иерархии средств шифрования шифруются данные более нижнего уровня и отображаются наиболее распространенные конфигурации шифрования.</span><span class="sxs-lookup"><span data-stu-id="d7c71-106">The following illustration shows that each layer of the encryption hierarchy encrypts the layer beneath it, and displays the most common encryption configurations.</span></span> <span data-ttu-id="d7c71-107">Доступ к началу иерархии, как правило, защищается паролем.</span><span class="sxs-lookup"><span data-stu-id="d7c71-107">The access to the start of the hierarchy is usually protected by a password.</span></span>  
  
 <span data-ttu-id="d7c71-108">![Отображает некоторые сочетания методов шифрования в виде стека.](../../../database-engine/media/encryption-hierarchy-stack.gif "Отображает некоторые сочетания методов шифрования в виде стека.")</span><span class="sxs-lookup"><span data-stu-id="d7c71-108">![Displays some encryption combinations in a stack.](../../../database-engine/media/encryption-hierarchy-stack.gif "Displays some encryption combinations in a stack.")</span></span>  
  
 <span data-ttu-id="d7c71-109">Следует учитывать следующие основные понятия.</span><span class="sxs-lookup"><span data-stu-id="d7c71-109">Keep in mind the following concepts:</span></span>  
  
-   <span data-ttu-id="d7c71-110">Для лучшей производительности данные следует шифровать с помощью симметричных ключей, а не с помощью сертификатов и асимметричных ключей.</span><span class="sxs-lookup"><span data-stu-id="d7c71-110">For best performance, encrypt data using symmetric keys instead of certificates or asymmetric keys.</span></span>  
  
-   <span data-ttu-id="d7c71-111">Главные ключи базы данных защищены главным ключом службы.</span><span class="sxs-lookup"><span data-stu-id="d7c71-111">Database master keys are protected by the Service Master Key.</span></span> <span data-ttu-id="d7c71-112">Главный ключ службы создается при установке [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и шифруется API-интерфейсом защиты данных Windows (DPAPI).</span><span class="sxs-lookup"><span data-stu-id="d7c71-112">The Service Master Key is created by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] setup and is encrypted with the Windows Data Protection API (DPAPI).</span></span>  
  
-   <span data-ttu-id="d7c71-113">Возможны другие иерархии шифрования с дополнительными уровнями.</span><span class="sxs-lookup"><span data-stu-id="d7c71-113">Other encryption hierarchies stacking additional layers are possible.</span></span>  
  
-   <span data-ttu-id="d7c71-114">Модуль расширенного управления ключами хранит симметричные или асимметричные ключи вне SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d7c71-114">An Extensible Key Management (EKM) module holds symmetric or asymmetric keys outside of SQL Server.</span></span>  
  
-   <span data-ttu-id="d7c71-115">Прозрачное шифрование данных (TDE) должно использовать симметричный ключ, который называется ключом шифрования базы данных, защищенный сертификатом, который, в свою очередь защищается главным ключом базы данных master или асимметричным ключом, хранящимся в модуле расширенного управления ключами.</span><span class="sxs-lookup"><span data-stu-id="d7c71-115">Transparent Data Encryption (TDE) must use a symmetric key called the database encryption key which is protected by either a certificate protected by the database master key of the master database, or by an asymmetric key stored in an EKM.</span></span>  
  
-   <span data-ttu-id="d7c71-116">Главный ключ службы и все главные ключи базы данных являются симметричными ключами.</span><span class="sxs-lookup"><span data-stu-id="d7c71-116">The Service Master Key and all Database Master Keys are symmetric keys.</span></span>  
  
 <span data-ttu-id="d7c71-117">На следующем рисунке показаны те же сведения другим образом.</span><span class="sxs-lookup"><span data-stu-id="d7c71-117">The following illustration shows the same information in an alternative manner.</span></span>  
  
 <span data-ttu-id="d7c71-118">![Отображает некоторые сочетания методов шифрования в виде колеса.](../../../database-engine/media/encryption-hierarchy-wheel.gif "Отображает некоторые сочетания методов шифрования в виде колеса.")</span><span class="sxs-lookup"><span data-stu-id="d7c71-118">![Displays some encryption combinations in a wheel.](../../../database-engine/media/encryption-hierarchy-wheel.gif "Displays some encryption combinations in a wheel.")</span></span>  
  
 <span data-ttu-id="d7c71-119">Диаграмма иллюстрирует следующие дополнительные основные понятия.</span><span class="sxs-lookup"><span data-stu-id="d7c71-119">This diagram illustrates the following additional concepts:</span></span>  
  
-   <span data-ttu-id="d7c71-120">На этом рисунке стрелки указывают стандартные иерархии шифрования.</span><span class="sxs-lookup"><span data-stu-id="d7c71-120">In this illustration, arrows indicate common encryption hierarchies.</span></span>  
  
-   <span data-ttu-id="d7c71-121">Симметричные и асимметричные ключи в модуле расширенного управления ключами защищают доступ к симметричным и асимметричным ключам, хранящимся в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d7c71-121">Symmetric and asymmetric keys in the EKM can protect access to the symmetric and asymmetric keys stored in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="d7c71-122">Пунктирная линия, связанная с модулем расширенного управления ключами, указывает, что ключи в модуле расширенного управления ключами могут заменять симметричные и асимметричные ключи, хранящиеся в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d7c71-122">The dotted line associated with EKM indicates that keys in the EKM could replace the symmetric and asymmetric keys stored in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="encryption-mechanisms"></a><span data-ttu-id="d7c71-123">Механизмы шифрования</span><span class="sxs-lookup"><span data-stu-id="d7c71-123">Encryption Mechanisms</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="d7c71-124">поддерживает следующие механизмы шифрования:</span><span class="sxs-lookup"><span data-stu-id="d7c71-124">provides the following mechanisms for encryption:</span></span>  
  
-   [!INCLUDE[tsql](../../../includes/tsql-md.md)] <span data-ttu-id="d7c71-125">;</span><span class="sxs-lookup"><span data-stu-id="d7c71-125">functions</span></span>  
  
-   <span data-ttu-id="d7c71-126">асимметричные ключи;</span><span class="sxs-lookup"><span data-stu-id="d7c71-126">Asymmetric keys</span></span>  
  
-   <span data-ttu-id="d7c71-127">симметричные ключи;</span><span class="sxs-lookup"><span data-stu-id="d7c71-127">Symmetric keys</span></span>  
  
-   <span data-ttu-id="d7c71-128">Сертификаты</span><span class="sxs-lookup"><span data-stu-id="d7c71-128">Certificates</span></span>  
  
-   <span data-ttu-id="d7c71-129">прозрачное шифрование данных.</span><span class="sxs-lookup"><span data-stu-id="d7c71-129">Transparent Data Encryption</span></span>  
  
### <a name="transact-sql-functions"></a><span data-ttu-id="d7c71-130">Функции Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d7c71-130">Transact-SQL Functions</span></span>  
 <span data-ttu-id="d7c71-131">Отдельные элементы можно шифровать по мере того, как они вставляются или обновляются, с помощью функций [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d7c71-131">Individual items can be encrypted as they are inserted or updated using [!INCLUDE[tsql](../../../includes/tsql-md.md)] functions.</span></span> <span data-ttu-id="d7c71-132">Дополнительные сведения см. в статьях [ENCRYPTBYPASSPHRASE (Transact-SQL)](/sql/t-sql/functions/encryptbypassphrase-transact-sql) и [DECRYPTBYPASSPHRASE (Transact-SQL)](/sql/t-sql/functions/decryptbypassphrase-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d7c71-132">For more information, see [ENCRYPTBYPASSPHRASE &#40;Transact-SQL&#41;](/sql/t-sql/functions/encryptbypassphrase-transact-sql) and [DECRYPTBYPASSPHRASE &#40;Transact-SQL&#41;](/sql/t-sql/functions/decryptbypassphrase-transact-sql).</span></span>  
  
### <a name="certificates"></a><span data-ttu-id="d7c71-133">Сертификаты</span><span class="sxs-lookup"><span data-stu-id="d7c71-133">Certificates</span></span>  
 <span data-ttu-id="d7c71-134">Сертификат открытого ключа, или просто сертификат, представляет собой подписанную цифровой подписью инструкцию, которая связывает значение открытого ключа с идентификатором пользователя, устройства или службы, имеющей соответствующий закрытый ключ.</span><span class="sxs-lookup"><span data-stu-id="d7c71-134">A public key certificate, usually just called a certificate, is a digitally-signed statement that binds the value of a public key to the identity of the person, device, or service that holds the corresponding private key.</span></span> <span data-ttu-id="d7c71-135">Сертификаты поставляются и подписываются центром сертификации (certification authority, CA).</span><span class="sxs-lookup"><span data-stu-id="d7c71-135">Certificates are issued and signed by a certification authority (CA).</span></span> <span data-ttu-id="d7c71-136">Сущность, получающая сертификат от центра сертификации, является субъектом этого сертификата.</span><span class="sxs-lookup"><span data-stu-id="d7c71-136">The entity that receives a certificate from a CA is the subject of that certificate.</span></span> <span data-ttu-id="d7c71-137">Как правило, сертификаты содержат следующие сведения.</span><span class="sxs-lookup"><span data-stu-id="d7c71-137">Typically, certificates contain the following information.</span></span>  
  
-   <span data-ttu-id="d7c71-138">Открытый ключ субъекта.</span><span class="sxs-lookup"><span data-stu-id="d7c71-138">The public key of the subject.</span></span>  
  
-   <span data-ttu-id="d7c71-139">Идентификационные данные субъекта, например имя и адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="d7c71-139">The identifier information of the subject, such as the name and e-mail address.</span></span>  
  
-   <span data-ttu-id="d7c71-140">Срок действия,</span><span class="sxs-lookup"><span data-stu-id="d7c71-140">The validity period.</span></span> <span data-ttu-id="d7c71-141">то есть интервал времени, на протяжении которого сертификат будет считаться действительным.</span><span class="sxs-lookup"><span data-stu-id="d7c71-141">This is the length of time that the certificate is considered valid.</span></span>  
  
     <span data-ttu-id="d7c71-142">Сертификат действителен только в течение указанного в нем периода, который задается в каждом сертификате при помощи дат ( **Valid From** и **Valid To** ),</span><span class="sxs-lookup"><span data-stu-id="d7c71-142">A certificate is valid only for the period of time specified within it; every certificate contains **Valid From** and **Valid To** dates.</span></span> <span data-ttu-id="d7c71-143">определяющих начало и окончание срока действия.</span><span class="sxs-lookup"><span data-stu-id="d7c71-143">These dates set the boundaries of the validity period.</span></span> <span data-ttu-id="d7c71-144">По истечении срока действия сертификата его субъект должен запросить новый сертификат.</span><span class="sxs-lookup"><span data-stu-id="d7c71-144">When the validity period for a certificate has passed, a new certificate must be requested by the subject of the now-expired certificate.</span></span>  
  
-   <span data-ttu-id="d7c71-145">Идентификационные данные поставщика сертификата.</span><span class="sxs-lookup"><span data-stu-id="d7c71-145">Issuer identifier information.</span></span>  
  
-   <span data-ttu-id="d7c71-146">Цифровая подпись поставщика.</span><span class="sxs-lookup"><span data-stu-id="d7c71-146">The digital signature of the issuer.</span></span>  
  
     <span data-ttu-id="d7c71-147">Эта подпись подтверждает действительность связи между открытым ключом и идентификационными данными субъекта.</span><span class="sxs-lookup"><span data-stu-id="d7c71-147">This signature attests to the validity of the binding between the public key and the identifier information of the subject.</span></span> <span data-ttu-id="d7c71-148">(В процессе создания цифровой подписи данные, вместе с некоторыми секретными данными отправителя, преобразуются в тег, называемый подписью.)</span><span class="sxs-lookup"><span data-stu-id="d7c71-148">(The process of digitally signing information entails transforming the information, as well as some secret information held by the sender, into a tag called a signature.)</span></span>  
  
 <span data-ttu-id="d7c71-149">Главное преимущество сертификатов в том, что они позволяют не хранить на узлах совокупность паролей отдельных субъектов.</span><span class="sxs-lookup"><span data-stu-id="d7c71-149">A primary benefit of certificates is that they relieve hosts of the need to maintain a set of passwords for individual subjects.</span></span> <span data-ttu-id="d7c71-150">Вместо этого узел просто устанавливает доверительные отношения с поставщиком сертификата; после этого поставщик может подписать неограниченное количество сертификатов.</span><span class="sxs-lookup"><span data-stu-id="d7c71-150">Instead, the host merely establishes trust in a certificate issuer, which may then sign an unlimited number of certificates.</span></span>  
  
 <span data-ttu-id="d7c71-151">Когда узел (например, защищенный веб-сервер) указывает, что конкретный поставщик сертификата является доверенным корневым центром сертификации, он неявно выражает доверие к политикам, которые поставщик использовал при определении связей для изданных им сертификатов.</span><span class="sxs-lookup"><span data-stu-id="d7c71-151">When a host, such as a secure Web server, designates an issuer as a trusted root authority, the host implicitly trusts the policies that the issuer has used to establish the bindings of certificates it issues.</span></span> <span data-ttu-id="d7c71-152">Таким образом, узел выражает уверенность в том, что поставщик проверил идентификационные данные субъекта сертификата.</span><span class="sxs-lookup"><span data-stu-id="d7c71-152">In effect, the host trusts that the issuer has verified the identity of the certificate subject.</span></span> <span data-ttu-id="d7c71-153">Узел делает поставщика доверенным корневым центром сертификации, помещая самостоятельно подписанный сертификат поставщика, содержащий открытый ключ поставщика, в хранилище сертификатов доверенного корневого центра сертификации на главном компьютере.</span><span class="sxs-lookup"><span data-stu-id="d7c71-153">A host designates an issuer as a trusted root authority by putting the self-signed certificate of the issuer, which contains the public key of the issuer, into the trusted root certification authority certificate store of the host computer.</span></span> <span data-ttu-id="d7c71-154">Промежуточные или подчиненные центры сертификации являются доверенными только в том случае, если к ним ведет правильный путь от доверенного корневого центра сертификации.</span><span class="sxs-lookup"><span data-stu-id="d7c71-154">Intermediate or subordinate certification authorities are trusted only if they have a valid certification path from a trusted root certification authority.</span></span>  
  
 <span data-ttu-id="d7c71-155">Поставщик может отозвать сертификат до истечения срока его действия.</span><span class="sxs-lookup"><span data-stu-id="d7c71-155">The issuer can revoke a certificate before it expires.</span></span> <span data-ttu-id="d7c71-156">При этом отменяется связь открытого ключа с идентификационными данными, указанными в сертификате.</span><span class="sxs-lookup"><span data-stu-id="d7c71-156">Revocation cancels the binding of a public key to an identity that is asserted in the certificate.</span></span> <span data-ttu-id="d7c71-157">Каждый поставщик ведет список отозванных сертификатов, который можно использовать для проверки конкретного сертификата.</span><span class="sxs-lookup"><span data-stu-id="d7c71-157">Each issuer maintains a certificate revocation list that can be used by programs when they are checking the validity of any given certificate.</span></span>  
  
 <span data-ttu-id="d7c71-158">Самостоятельно подписанные сертификаты, созданные [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , соответствуют стандарту X.509 и поддерживают поля X.509 v1.</span><span class="sxs-lookup"><span data-stu-id="d7c71-158">The self-signed certificates created by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] follow the X.509 standard and support the X.509 v1 fields.</span></span>  
  
### <a name="asymmetric-keys"></a><span data-ttu-id="d7c71-159">Асимметричные ключи</span><span class="sxs-lookup"><span data-stu-id="d7c71-159">Asymmetric Keys</span></span>  
 <span data-ttu-id="d7c71-160">Асимметричный ключ состоит из закрытого ключа и соответствующего открытого ключа.</span><span class="sxs-lookup"><span data-stu-id="d7c71-160">An asymmetric key is made up of a private key and the corresponding public key.</span></span> <span data-ttu-id="d7c71-161">Каждый из этих ключей позволяет дешифровать данные, зашифрованные другим ключом.</span><span class="sxs-lookup"><span data-stu-id="d7c71-161">Each key can decrypt data encrypted by the other.</span></span> <span data-ttu-id="d7c71-162">На выполнение асимметричных операций шифрования и дешифрования требуется сравнительно много ресурсов, но они обеспечивают более надежную защиту, чем симметричное шифрование.</span><span class="sxs-lookup"><span data-stu-id="d7c71-162">Asymmetric encryption and decryption are relatively resource-intensive, but they provide a higher level of security than symmetric encryption.</span></span> <span data-ttu-id="d7c71-163">Асимметричный ключ можно использовать для шифрования симметричного ключа перед его сохранением в базе данных.</span><span class="sxs-lookup"><span data-stu-id="d7c71-163">An asymmetric key can be used to encrypt a symmetric key for storage in a database.</span></span>  
  
### <a name="symmetric-keys"></a><span data-ttu-id="d7c71-164">симметричные ключи;</span><span class="sxs-lookup"><span data-stu-id="d7c71-164">Symmetric Keys</span></span>  
 <span data-ttu-id="d7c71-165">Симметричный ключ — это ключ, используемый и для шифрования, и для дешифрования данных.</span><span class="sxs-lookup"><span data-stu-id="d7c71-165">A symmetric key is one key that is used for both encryption and decryption.</span></span> <span data-ttu-id="d7c71-166">Данные при использовании симметричного ключа шифруются и дешифруются быстро, и он вполне подходит для повседневной защиты конфиденциальных данных, хранящихся в базе данных.</span><span class="sxs-lookup"><span data-stu-id="d7c71-166">Encryption and decryption by using a symmetric key is fast, and suitable for routine use with sensitive data in the database.</span></span>  
  
### <a name="transparent-data-encryption"></a><span data-ttu-id="d7c71-167">прозрачное шифрование данных.</span><span class="sxs-lookup"><span data-stu-id="d7c71-167">Transparent Data Encryption</span></span>  
 <span data-ttu-id="d7c71-168">Прозрачное шифрование данных (TDE) является особым случаем шифрования с использованием симметричного ключа.</span><span class="sxs-lookup"><span data-stu-id="d7c71-168">Transparent Data Encryption (TDE) is a special case of encryption using a symmetric key.</span></span> <span data-ttu-id="d7c71-169">TDE шифрует всю базу данных, используя симметричный ключ, который называется ключом шифрования базы данных.</span><span class="sxs-lookup"><span data-stu-id="d7c71-169">TDE encrypts an entire database using that symmetric key called the database encryption key.</span></span> <span data-ttu-id="d7c71-170">Ключ шифрования базы данных защищен другими ключами или сертификатами, которые, в свою очередь, защищаются главным ключом базы данных или асимметричным ключом, хранящимся в модуле расширенного управления ключами.</span><span class="sxs-lookup"><span data-stu-id="d7c71-170">The database encryption key is protected by other keys or certificates which are protected either by the database master key or by an asymmetric key stored in an EKM module.</span></span> <span data-ttu-id="d7c71-171">Дополнительные сведения см. в статье [Прозрачное шифрование данных (TDE)](transparent-data-encryption.md).</span><span class="sxs-lookup"><span data-stu-id="d7c71-171">For more information, see [Transparent Data Encryption &#40;TDE&#41;](transparent-data-encryption.md).</span></span>  
  
## <a name="related-content"></a><span data-ttu-id="d7c71-172">См. также</span><span class="sxs-lookup"><span data-stu-id="d7c71-172">Related Content</span></span>  
 [<span data-ttu-id="d7c71-173">Обеспечение безопасности SQL Server</span><span class="sxs-lookup"><span data-stu-id="d7c71-173">Securing SQL Server</span></span>](../securing-sql-server.md)  
  
 [<span data-ttu-id="d7c71-174">Функции безопасности &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d7c71-174">Security Functions &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/functions/security-functions-transact-sql)  
  
## <a name="see-also"></a><span data-ttu-id="d7c71-175">См. также:</span><span class="sxs-lookup"><span data-stu-id="d7c71-175">See Also</span></span>  
 <span data-ttu-id="d7c71-176">[Иерархия разрешений (ядро СУБД)](../permissions-hierarchy-database-engine.md) </span><span class="sxs-lookup"><span data-stu-id="d7c71-176">[Permissions Hierarchy &#40;Database Engine&#41;](../permissions-hierarchy-database-engine.md) </span></span>  
 [<span data-ttu-id="d7c71-177">Защищаемые объекты</span><span class="sxs-lookup"><span data-stu-id="d7c71-177">Securables</span></span>](../securables.md)  
  
  
