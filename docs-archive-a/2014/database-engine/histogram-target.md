---
title: Целевой объект гистограммы | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
helpviewer_keywords:
- bucketing target [SQL Server extended events]
- event bucketing target
- targets [SQL Server extended events], bucketing
ms.assetid: 2ea39141-7eb0-4c74-abf8-114c2c106a19
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: acb124ef949849561a6bca0ba4016b40c1343384
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87732010"
---
# <a name="histogram-target"></a><span data-ttu-id="2e55f-102">Цель гистограммы</span><span class="sxs-lookup"><span data-stu-id="2e55f-102">Histogram Target</span></span>
  <span data-ttu-id="2e55f-103">Цель гистограммы группирует вхождения определенного типа событий на основе данных о событии.</span><span class="sxs-lookup"><span data-stu-id="2e55f-103">The histogram target groups occurrences of a specific event type based on event data.</span></span> <span data-ttu-id="2e55f-104">Группирование событий основано на определенном столбце событий или действии.</span><span class="sxs-lookup"><span data-stu-id="2e55f-104">The groupings of events are counted based on a specified event column or action.</span></span> <span data-ttu-id="2e55f-105">Цель гистограммы вы можете использовать для поиска и устранения проблем с производительностью.</span><span class="sxs-lookup"><span data-stu-id="2e55f-105">You can use the histogram target to troubleshoot performance issues.</span></span> <span data-ttu-id="2e55f-106">Найдя наиболее часто происходящие события, можно найти «горячие точки», показывающие потенциальную причину возникновения проблемы производительности.</span><span class="sxs-lookup"><span data-stu-id="2e55f-106">By identifying which events are occurring most frequently, you can find "hotspots" that indicate a potential cause of a performance problem.</span></span>  
  
 <span data-ttu-id="2e55f-107">В следующей таблице описываются параметры, которые можно использовать для настройки цели гистограммы.</span><span class="sxs-lookup"><span data-stu-id="2e55f-107">The following table describes the options that can be used to configure the histogram target.</span></span>  
  
|<span data-ttu-id="2e55f-108">Параметр</span><span class="sxs-lookup"><span data-stu-id="2e55f-108">Option</span></span>|<span data-ttu-id="2e55f-109">Допустимые значения</span><span class="sxs-lookup"><span data-stu-id="2e55f-109">Allowed values</span></span>|<span data-ttu-id="2e55f-110">Описание</span><span class="sxs-lookup"><span data-stu-id="2e55f-110">Description</span></span>|  
|------------|--------------------|-----------------|  
|<span data-ttu-id="2e55f-111">slots</span><span class="sxs-lookup"><span data-stu-id="2e55f-111">slots</span></span>|<span data-ttu-id="2e55f-112">Любое целочисленное значение.</span><span class="sxs-lookup"><span data-stu-id="2e55f-112">Any integer value.</span></span> <span data-ttu-id="2e55f-113">Это значение является необязательным.</span><span class="sxs-lookup"><span data-stu-id="2e55f-113">This value is optional.</span></span>|<span data-ttu-id="2e55f-114">Заданное пользователем значение, указывающее максимальное число группирований.</span><span class="sxs-lookup"><span data-stu-id="2e55f-114">A user-specified value indicating the maximum number of groupings to retain.</span></span> <span data-ttu-id="2e55f-115">При достижении этого значения новые события, не принадлежащие к существующим группам, пропускаются.</span><span class="sxs-lookup"><span data-stu-id="2e55f-115">When this value is reached, new events that do not belong to the existing groups are ignored.</span></span><br /><br /> <span data-ttu-id="2e55f-116">Обратите внимание, что для повышение производительности, номер слота округляется до следующей степени числа 2.</span><span class="sxs-lookup"><span data-stu-id="2e55f-116">Note that to improve performance, the slot number is rounded up to the next power of 2.</span></span>|  
|<span data-ttu-id="2e55f-117">filtering_event_name</span><span class="sxs-lookup"><span data-stu-id="2e55f-117">filtering_event_name</span></span>|<span data-ttu-id="2e55f-118">Любое событие, участвующее в сеансе расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="2e55f-118">Any event present in the Extended Events session.</span></span> <span data-ttu-id="2e55f-119">Это значение является необязательным.</span><span class="sxs-lookup"><span data-stu-id="2e55f-119">This value is optional.</span></span>|<span data-ttu-id="2e55f-120">Пользовательское значение, которое используется для идентификации класса событий.</span><span class="sxs-lookup"><span data-stu-id="2e55f-120">A user-specified value that is used to identify a class of events.</span></span> <span data-ttu-id="2e55f-121">Группируются только экземпляры указанного события.</span><span class="sxs-lookup"><span data-stu-id="2e55f-121">Only instances of the specified event are bucketed.</span></span> <span data-ttu-id="2e55f-122">Все остальные события не учитываются.</span><span class="sxs-lookup"><span data-stu-id="2e55f-122">All other events are ignored.</span></span><br /><br /> <span data-ttu-id="2e55f-123">Если указывается это значение, то следует использовать формат *имя_пакета*.*имя_события*, например `'sqlserver.checkpoint_end'`.</span><span class="sxs-lookup"><span data-stu-id="2e55f-123">If you specify this value, you must use the format: *package_name*.*event_name*, for example `'sqlserver.checkpoint_end'`.</span></span> <span data-ttu-id="2e55f-124">Определить имя пакета можно с помощью следующего запроса:</span><span class="sxs-lookup"><span data-stu-id="2e55f-124">You can identify the package name by using the following query:</span></span><br /><br /> <span data-ttu-id="2e55f-125">Выберите p.name, SE. event_name</span><span class="sxs-lookup"><span data-stu-id="2e55f-125">SELECT p.name, se.event_name</span></span><br /><span data-ttu-id="2e55f-126">ИЗ sys. dm_xe_session_events SE</span><span class="sxs-lookup"><span data-stu-id="2e55f-126">FROM sys.dm_xe_session_events se</span></span><br /><span data-ttu-id="2e55f-127">СОЕДИНЕНИЕ с sys. dm_xe_packages p</span><span class="sxs-lookup"><span data-stu-id="2e55f-127">JOIN sys.dm_xe_packages p</span></span><br /><span data-ttu-id="2e55f-128">В se_event_package_guid = p. GUID</span><span class="sxs-lookup"><span data-stu-id="2e55f-128">ON se_event_package_guid = p.guid</span></span><br /><span data-ttu-id="2e55f-129">УПОРЯДОЧЕНие по p.name, SE. event_name</span><span class="sxs-lookup"><span data-stu-id="2e55f-129">ORDER BY p.name, se.event_name</span></span><br /><br /> <br /><br /> <span data-ttu-id="2e55f-130">Если не указывается значение параметра filtering_event_name, то для параметра source_type следует установить значение 1 (значение по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="2e55f-130">If you do not specify the filtering_event_name value, source_type must be set to 1 (the default).</span></span>|  
|<span data-ttu-id="2e55f-131">source_type</span><span class="sxs-lookup"><span data-stu-id="2e55f-131">source_type</span></span>|<span data-ttu-id="2e55f-132">Тип объекта, на котором основан сегмент.</span><span class="sxs-lookup"><span data-stu-id="2e55f-132">The type of object that the bucket is based on.</span></span> <span data-ttu-id="2e55f-133">Это значение необязательно. Когда оно не задано, по умолчанию равно 1.</span><span class="sxs-lookup"><span data-stu-id="2e55f-133">This value is optional and if not specified has a default value of 1.</span></span>|<span data-ttu-id="2e55f-134">Может иметь одно из следующих значений:</span><span class="sxs-lookup"><span data-stu-id="2e55f-134">Can have one of the following values:</span></span><br /><br /> <span data-ttu-id="2e55f-135">0 для события</span><span class="sxs-lookup"><span data-stu-id="2e55f-135">0 for an event</span></span><br /><br /> <span data-ttu-id="2e55f-136">1 для действия</span><span class="sxs-lookup"><span data-stu-id="2e55f-136">1 for an action</span></span>|  
|<span data-ttu-id="2e55f-137">source</span><span class="sxs-lookup"><span data-stu-id="2e55f-137">source</span></span>|<span data-ttu-id="2e55f-138">Имя столбца событий или действия.</span><span class="sxs-lookup"><span data-stu-id="2e55f-138">Event column or action name.</span></span>|<span data-ttu-id="2e55f-139">Имя столбца событий или действия, которое используется в качестве источника данных.</span><span class="sxs-lookup"><span data-stu-id="2e55f-139">The event column or action name that is used as the data source.</span></span><br /><br /> <span data-ttu-id="2e55f-140">При указании столбца событий для источника необходимо указать столбец из события, которое указывается в качестве значения для параметра filtering_event_name.</span><span class="sxs-lookup"><span data-stu-id="2e55f-140">When you specify an event column for source, you must specify a column from the event that is used for the filtering_event_name value.</span></span> <span data-ttu-id="2e55f-141">Определить потенциальные столбцы можно с помощью следующего запроса:</span><span class="sxs-lookup"><span data-stu-id="2e55f-141">You can identify the potential columns by using the following query:</span></span><br /><br /> <span data-ttu-id="2e55f-142">Выберите имя из sys. dm_xe_object_columns</span><span class="sxs-lookup"><span data-stu-id="2e55f-142">SELECT name FROM sys.dm_xe_object_columns</span></span><br /><span data-ttu-id="2e55f-143">ГДЕ object_name = " \<eventname> "</span><span class="sxs-lookup"><span data-stu-id="2e55f-143">WHERE object_name = '\<eventname>'</span></span><br /><span data-ttu-id="2e55f-144">И column_type! = ' ReadOnly '</span><span class="sxs-lookup"><span data-stu-id="2e55f-144">AND column_type != 'readonly'</span></span><br /><br /> <span data-ttu-id="2e55f-145">При указании столбца события для источника нет необходимости включать имя пакета в значение источника.</span><span class="sxs-lookup"><span data-stu-id="2e55f-145">When you specify an event column for source, you do not have to include the package name in the source value.</span></span><br /><br /> <span data-ttu-id="2e55f-146">При указании имени действия для источника необходимо использовать одно из действий, которые были настроены для коллекции в сеансе события, для которого используется данная цель.</span><span class="sxs-lookup"><span data-stu-id="2e55f-146">When you specify an action name for source, you must use one of the actions that is configured for collection in the event session for which this target is being used.</span></span> <span data-ttu-id="2e55f-147">Чтобы найти потенциальные значения для имени действия, можно выполнить запрос к столбцу action_name представления sys.dm_xe_sesssion_event_actions.</span><span class="sxs-lookup"><span data-stu-id="2e55f-147">To find potential values for the action name, you can query the action_name column of the sys.dm_xe_sesssion_event_actions view.</span></span><br /><br /> <span data-ttu-id="2e55f-148">Если имя действия используется в качестве источника данных, необходимо указать исходное значение в следующем формате: *имя_пакета*.*имя_действия*.</span><span class="sxs-lookup"><span data-stu-id="2e55f-148">If you are using an action name as the data source, you must specify the source value by using the format: *package_name*.*action_name*.</span></span>|  
  
 <span data-ttu-id="2e55f-149">В следующем примере на высоком уровне показывается, как цель гистограммы собирает данные.</span><span class="sxs-lookup"><span data-stu-id="2e55f-149">The following example illustrates at a high level how the histogram target collects data.</span></span> <span data-ttu-id="2e55f-150">В данном примере цель гистограммы будет использоваться для подсчета количества возникших случаев ожидания для каждого типа ожидания.</span><span class="sxs-lookup"><span data-stu-id="2e55f-150">In this example, you want to use the histogram target to count how many waits of each wait type occurred.</span></span> <span data-ttu-id="2e55f-151">Для этого при определении цели гистограммы необходимо указать следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="2e55f-151">To do this, you would specify the following options when you define the histogram target:</span></span>  
  
-   <span data-ttu-id="2e55f-152">filtering_event_name = 'wait_info'</span><span class="sxs-lookup"><span data-stu-id="2e55f-152">filtering_event_name = 'wait_info'</span></span>  
  
-   <span data-ttu-id="2e55f-153">source = 'wait_type'</span><span class="sxs-lookup"><span data-stu-id="2e55f-153">source = 'wait_type'</span></span>  
  
-   <span data-ttu-id="2e55f-154">source_type = 0 (поскольку wait_type — это столбец события)</span><span class="sxs-lookup"><span data-stu-id="2e55f-154">source_type = 0 (because wait_type is an event column)</span></span>  
  
 <span data-ttu-id="2e55f-155">В сценарии примера для источника wait_type записаны следующие данные.</span><span class="sxs-lookup"><span data-stu-id="2e55f-155">In the example scenario, the following data is recorded for the wait_type source.</span></span>  
  
|<span data-ttu-id="2e55f-156">Фильтрация имени события</span><span class="sxs-lookup"><span data-stu-id="2e55f-156">Filtering event name</span></span>|<span data-ttu-id="2e55f-157">Значение столбца источника</span><span class="sxs-lookup"><span data-stu-id="2e55f-157">Source column value</span></span>|  
|--------------------------|-------------------------|  
|<span data-ttu-id="2e55f-158">wait_info</span><span class="sxs-lookup"><span data-stu-id="2e55f-158">wait_info</span></span>|<span data-ttu-id="2e55f-159">file_io</span><span class="sxs-lookup"><span data-stu-id="2e55f-159">file_io</span></span>|  
|<span data-ttu-id="2e55f-160">wait_info</span><span class="sxs-lookup"><span data-stu-id="2e55f-160">wait_info</span></span>|<span data-ttu-id="2e55f-161">file_io</span><span class="sxs-lookup"><span data-stu-id="2e55f-161">file_io</span></span>|  
|<span data-ttu-id="2e55f-162">wait_info</span><span class="sxs-lookup"><span data-stu-id="2e55f-162">wait_info</span></span>|<span data-ttu-id="2e55f-163">network</span><span class="sxs-lookup"><span data-stu-id="2e55f-163">network</span></span>|  
|<span data-ttu-id="2e55f-164">wait_info</span><span class="sxs-lookup"><span data-stu-id="2e55f-164">wait_info</span></span>|<span data-ttu-id="2e55f-165">network</span><span class="sxs-lookup"><span data-stu-id="2e55f-165">network</span></span>|  
|<span data-ttu-id="2e55f-166">wait_info</span><span class="sxs-lookup"><span data-stu-id="2e55f-166">wait_info</span></span>|<span data-ttu-id="2e55f-167">sleep</span><span class="sxs-lookup"><span data-stu-id="2e55f-167">sleep</span></span>|  
  
 <span data-ttu-id="2e55f-168">Значения типа ожидания будут разделены на три слота со следующими значениями и числом слотов.</span><span class="sxs-lookup"><span data-stu-id="2e55f-168">The wait type values would be categorized into three slots, with the following values and slot counts:</span></span>  
  
|<span data-ttu-id="2e55f-169">Значение</span><span class="sxs-lookup"><span data-stu-id="2e55f-169">Value</span></span>|<span data-ttu-id="2e55f-170">Число слотов</span><span class="sxs-lookup"><span data-stu-id="2e55f-170">Slot count</span></span>|  
|-----------|----------------|  
|<span data-ttu-id="2e55f-171">file_io</span><span class="sxs-lookup"><span data-stu-id="2e55f-171">file_io</span></span>|<span data-ttu-id="2e55f-172">2</span><span class="sxs-lookup"><span data-stu-id="2e55f-172">2</span></span>|  
|<span data-ttu-id="2e55f-173">network</span><span class="sxs-lookup"><span data-stu-id="2e55f-173">network</span></span>|<span data-ttu-id="2e55f-174">2</span><span class="sxs-lookup"><span data-stu-id="2e55f-174">2</span></span>|  
|<span data-ttu-id="2e55f-175">sleep</span><span class="sxs-lookup"><span data-stu-id="2e55f-175">sleep</span></span>|<span data-ttu-id="2e55f-176">1</span><span class="sxs-lookup"><span data-stu-id="2e55f-176">1</span></span>|  
  
 <span data-ttu-id="2e55f-177">Цель гистограммы сохраняет только данные о событии для указанного источника.</span><span class="sxs-lookup"><span data-stu-id="2e55f-177">The histogram target only retains event data for the specified source.</span></span> <span data-ttu-id="2e55f-178">Иногда данные событий могут оказаться слишком большими, чтобы их можно было сохранить полностью, в этих случаях данные усекаются.</span><span class="sxs-lookup"><span data-stu-id="2e55f-178">In some cases the event data may be too large to retain completely, in which case the data is truncated.</span></span> <span data-ttu-id="2e55f-179">Если данные событий усекаются, число байт записывается и отображается в виде XML-выхода.</span><span class="sxs-lookup"><span data-stu-id="2e55f-179">When event data is truncated, the number of bytes is recorded and displayed as XML output.</span></span>  
  
## <a name="adding-the-target-to-a-session"></a><span data-ttu-id="2e55f-180">Добавление цели к сеансу</span><span class="sxs-lookup"><span data-stu-id="2e55f-180">Adding the Target to a Session</span></span>  
 <span data-ttu-id="2e55f-181">Для добавления цели гистограммы в сеанс расширенных событий, в зависимости от нужного типа целевого объекта следует использовать одну из следующих инструкций при создании или изменении сеанса события.</span><span class="sxs-lookup"><span data-stu-id="2e55f-181">To add the histogram target to an Extended Events session, you must include either of the following statements when you create or alter an event session, depending on the desired target type:</span></span>  
  
```  
ADD TARGET package0.histogram  
```  
  
 <span data-ttu-id="2e55f-182">Для задания различных параметров можно использовать инструкцию SET.</span><span class="sxs-lookup"><span data-stu-id="2e55f-182">You can use the SET statement to set the various options.</span></span> <span data-ttu-id="2e55f-183">В приведенном ниже примере показано добавление цели гистограммы, в которой собираются данные для события sqlserver.checkpoint_end.</span><span class="sxs-lookup"><span data-stu-id="2e55f-183">The following example shows the addition of the histogram target, where data for the sqlserver.checkpoint_end event is collected.</span></span>  
  
```  
ADD TARGET package0.histogram  
(SET slots = 32, filtering_event_name = 'sqlserver.checkpoint_end', source_type = 0, source = 'database_id')  
```  
  
 <span data-ttu-id="2e55f-184">Дополнительные сведения см. в разделах [Поиск объектов, на которые наложено наибольшее число блокировок](../relational-databases/extended-events/find-the-objects-that-have-the-most-locks-taken-on-them.md)и [Отслеживание активности системы с помощью расширенных событий](../relational-databases/extended-events/monitor-system-activity-using-extended-events.md).</span><span class="sxs-lookup"><span data-stu-id="2e55f-184">For more information, see [Find the Objects That Have the Most Locks Taken on Them](../relational-databases/extended-events/find-the-objects-that-have-the-most-locks-taken-on-them.md), and [Monitor System Activity Using Extended Events](../relational-databases/extended-events/monitor-system-activity-using-extended-events.md).</span></span>  
  
## <a name="reviewing-the-target-output"></a><span data-ttu-id="2e55f-185">Просмотр целевого вывода</span><span class="sxs-lookup"><span data-stu-id="2e55f-185">Reviewing the Target Output</span></span>  
 <span data-ttu-id="2e55f-186">Цель гистограммы сериализует данные для вызывающей программы или процедуры в формате XML.</span><span class="sxs-lookup"><span data-stu-id="2e55f-186">The histogram target serializes data to a calling program or procedure in XML format.</span></span> <span data-ttu-id="2e55f-187">Результат цели не соответствует ни одной схеме.</span><span class="sxs-lookup"><span data-stu-id="2e55f-187">The target output does not conform to any schema.</span></span>  
  
 <span data-ttu-id="2e55f-188">Для просмотра выходных данных цели гистограммы можно воспользоваться следующим запросом, заменив параметр *session_name* на имя сеанса события:</span><span class="sxs-lookup"><span data-stu-id="2e55f-188">To review the output from the histogram target, you can use the following query, replacing *session_name* with the name of the event session.</span></span>  
  
```  
SELECT name, target_name, CAST(xet.target_data AS xml)  
FROM sys.dm_xe_session_targets AS xet  
JOIN sys.dm_xe_sessions AS xe  
   ON (xe.address = xet.event_session_address)  
WHERE xe.name = 'session_name'  
```  
  
 <span data-ttu-id="2e55f-189">В следующем примере показан формат вывода цели гистограммы.</span><span class="sxs-lookup"><span data-stu-id="2e55f-189">The following example illustrates histogram target output format.</span></span>  
  
```  
<Slots truncated = "0" buckets=[count]>  
    <Slot count=[count] trunc=[truncated bytes]>  
        <value>  
        </value>  
    </Slot>  
</Slots>  
```  
  
## <a name="see-also"></a><span data-ttu-id="2e55f-190">См. также:</span><span class="sxs-lookup"><span data-stu-id="2e55f-190">See Also</span></span>  
 <span data-ttu-id="2e55f-191">[Цели расширенных событий SQL Server](../../2014/database-engine/sql-server-extended-events-targets.md) </span><span class="sxs-lookup"><span data-stu-id="2e55f-191">[SQL Server Extended Events Targets](../../2014/database-engine/sql-server-extended-events-targets.md) </span></span>  
 <span data-ttu-id="2e55f-192">[sys.dm_xe_session_targets (Transact-SQL)](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="2e55f-192">[sys.dm_xe_session_targets &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql) </span></span>  
 <span data-ttu-id="2e55f-193">[CREATE EVENT SESSION (Transact-SQL)](/sql/t-sql/statements/create-event-session-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="2e55f-193">[CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql) </span></span>  
 [<span data-ttu-id="2e55f-194">ALTER EVENT SESSION (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="2e55f-194">ALTER EVENT SESSION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-event-session-transact-sql)  
  
  
