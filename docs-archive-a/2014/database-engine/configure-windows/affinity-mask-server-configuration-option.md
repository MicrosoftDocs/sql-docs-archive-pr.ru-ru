---
title: Параметр конфигурации сервера "affinity mask" | Документы Майкрософт
ms.custom: ''
ms.date: 10/20/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- default affinity mask option
- reloading processor cache
- processor cache [SQL Server]
- CPU [SQL Server], licensing
- deferred process call
- affinity mask option
- processor affinity [SQL Server]
- SMP
- DPC
ms.assetid: 5823ba29-a75d-4b3e-ba7b-421c07ab3ac1
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: dfebde8a9431026e8faedb2a1e76eb2f2d82e207
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87665571"
---
# <a name="affinity-mask-server-configuration-option"></a><span data-ttu-id="0f092-102">Параметр конфигурации сервера «affinity mask»</span><span class="sxs-lookup"><span data-stu-id="0f092-102">affinity mask Server Configuration Option</span></span>
    
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureDontUse](../../includes/ssnotedepfuturedontuse-md.md)] <span data-ttu-id="0f092-103">Используйте вместо него инструкцию [ALTER SERVER CONFIGURATION (Transact-SQL)](/sql/t-sql/statements/alter-server-configuration-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="0f092-103">Use [ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-server-configuration-transact-sql) instead.</span></span>  
  
 <span data-ttu-id="0f092-104">Для одновременного выполнения множества задач [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows иногда распределяет потоки процессов между разными процессорами.</span><span class="sxs-lookup"><span data-stu-id="0f092-104">To carry out multitasking, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows sometimes move process threads among different processors.</span></span> <span data-ttu-id="0f092-105">Безусловно, такая организация работы эффективна с точки зрения операционной системы, но может привести к снижению производительности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] при больших нагрузках системы, поскольку в кэше каждого процессора неоднократно перезагружаются данные.</span><span class="sxs-lookup"><span data-stu-id="0f092-105">Although efficient from an operating system point of view, this activity can reduce [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] performance under heavy system loads, as each processor cache is repeatedly reloaded with data.</span></span> <span data-ttu-id="0f092-106">В этих условиях назначение процессорам определенных потоков может повысить производительность, устраняя повторную загрузку процессоров и уменьшая количество переносов потоков между процессорами (а значит, уменьшая число переключений контекста). Такая связь между потоком и процессором называется соответствием процессоров.</span><span class="sxs-lookup"><span data-stu-id="0f092-106">Assigning processors to specific threads can improve performance under these conditions by eliminating processor reloads and reducing thread migration across processors (thereby reducing context switching); such an association between a thread and a processor is called processor affinity.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]<span data-ttu-id="0f092-107">поддерживает соответствие процессоров с помощью двух параметров сходства: маска сходства (также известная как **маска сходства ЦП**) и маска ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="0f092-107">supports processor affinity by means of two affinity mask options: affinity mask (also known as **CPU affinity mask**) and affinity I/O mask.</span></span> <span data-ttu-id="0f092-108">Дополнительные сведения о параметре affinity I/O mask см. в разделе [Параметр конфигурации сервера "affinity Input-Output mask"](affinity-input-output-mask-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="0f092-108">For more information on the affinity I/O maskoption, see [affinity Input-Output mask Server Configuration Option](affinity-input-output-mask-server-configuration-option.md).</span></span> <span data-ttu-id="0f092-109">Поддержка соответствия процессоров и ввода-вывода для серверов с числом ЦП от 33 до 64 требует также использования параметров [Параметр конфигурации сервера "affinity64 mask"](affinity64-mask-server-configuration-option.md) и [Параметр конфигурации сервера "affinity64 Input-Output mask"](affinity64-input-output-mask-server-configuration-option.md)соответственно.</span><span class="sxs-lookup"><span data-stu-id="0f092-109">CPU and I/O affinity support for servers with 33 to 64 processors requires the additional use of the [affinity64 mask Server Configuration Option](affinity64-mask-server-configuration-option.md) and [affinity64 Input-Output mask Server Configuration Option](affinity64-input-output-mask-server-configuration-option.md), respectively.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0f092-110">Поддержка соответствия процессоров для серверов с числом процессоров от 33 до 64 доступна только в 64-разрядных версиях операционных систем.</span><span class="sxs-lookup"><span data-stu-id="0f092-110">Affinity support for servers with 33 to 64 processors is only available on 64-bit operating systems.</span></span>  
  
 <span data-ttu-id="0f092-111">Параметр affinity mask, который существовал в предыдущих версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], динамически управляет соответствием ЦП.</span><span class="sxs-lookup"><span data-stu-id="0f092-111">The affinity mask option, which existed in earlier releases of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], dynamically controls CPU affinity.</span></span>  
  
 <span data-ttu-id="0f092-112">В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]параметр affinity mask можно настраивать без последующей перезагрузки экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0f092-112">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the affinity mask option can be configured without requiring a restart of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="0f092-113">После установки параметра конфигурации с помощью хранимой процедуры sp_configure необходимо выполнить инструкцию RECONFIGURE или RECONFIGURE WITH OVERRIDE.</span><span class="sxs-lookup"><span data-stu-id="0f092-113">When you are using sp_configure, you must run either RECONFIGURE or RECONFIGURE WITH OVERRIDE after setting a configuration option.</span></span> <span data-ttu-id="0f092-114">Если же используется выпуск [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], то после изменения значения параметра affinity mask требуется перезагрузка.</span><span class="sxs-lookup"><span data-stu-id="0f092-114">When you are using [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], changing the affinity mask option does require a restart.</span></span>  
  
 <span data-ttu-id="0f092-115">Изменения масок сходства происходят динамически, что дает пользователям возможность запускать планировщики процессоров, связывающие процессы в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]и завершать их работу по требованию.</span><span class="sxs-lookup"><span data-stu-id="0f092-115">Changes to the affinity masks occur dynamically, allowing for on-demand startup and shutdown of the CPU schedulers that bind process threads within [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="0f092-116">Это может происходить при изменении условий работы сервера.</span><span class="sxs-lookup"><span data-stu-id="0f092-116">This can occur as conditions change on the server.</span></span> <span data-ttu-id="0f092-117">Например, если к серверу добавляется новый экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , то может потребоваться внести изменения в параметр affinity mask, чтобы перераспределить нагрузку процессоров.</span><span class="sxs-lookup"><span data-stu-id="0f092-117">For example, if a new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is added to the server, it may be necessary to make adjustments to the affinity mask option to redistribute processor load.</span></span>  
  
 <span data-ttu-id="0f092-118">Изменения битовых масок соответствия требуют, чтобы [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] запустил новый планировщик процессора и завершил работу текущего планировщика.</span><span class="sxs-lookup"><span data-stu-id="0f092-118">Modifications to the affinity bitmasks require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to enable a new CPU scheduler and disable the existing CPU scheduler.</span></span> <span data-ttu-id="0f092-119">После этого новые пакеты могут обрабатываться новым или оставшимися планировщиками.</span><span class="sxs-lookup"><span data-stu-id="0f092-119">New batches can then be processed on the new or remaining schedulers.</span></span>  
  
 <span data-ttu-id="0f092-120">Чтобы запустить новый планировщик процессора, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] создает новый планировщик и добавляет его в список стандартных планировщиков.</span><span class="sxs-lookup"><span data-stu-id="0f092-120">To start a new CPU scheduler, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] creates a new scheduler and adds it to the list of its standard schedulers.</span></span> <span data-ttu-id="0f092-121">Новый планировщик используется только для обработки новых входящих пакетов.</span><span class="sxs-lookup"><span data-stu-id="0f092-121">The new scheduler is considered only for the new incoming batches.</span></span> <span data-ttu-id="0f092-122">Текущие пакеты обрабатываются старым планировщиком.</span><span class="sxs-lookup"><span data-stu-id="0f092-122">Current batches continue to run on the same scheduler.</span></span> <span data-ttu-id="0f092-123">Рабочие потоки переходят на новый планировщик по мере освобождения или по мере создания новых рабочих потоков.</span><span class="sxs-lookup"><span data-stu-id="0f092-123">The workers migrate to the new scheduler as they free up, or as new workers are created.</span></span>  
  
 <span data-ttu-id="0f092-124">Для завершения работы планировщика необходимо, чтобы все пакеты завершили свою работу.</span><span class="sxs-lookup"><span data-stu-id="0f092-124">Shutting down a scheduler requires all batches on the scheduler to complete their activities and exit.</span></span> <span data-ttu-id="0f092-125">Планировщик, чья работа завершена, помечается как находящийся в режиме «вне сети», чтобы ему не были назначены новые пакеты.</span><span class="sxs-lookup"><span data-stu-id="0f092-125">A scheduler that has been shut down is marked as offline so that no new batch is scheduled on it.</span></span>  
  
 <span data-ttu-id="0f092-126">При добавлении или удалении нового планировщика постоянные системные задачи, например lockmonitor, checkpoint, поток системной задачи (обрабатывающей DTC) и обработчик сигналов, продолжают работать на планировщике, пока сервер находится в режиме «в сети».</span><span class="sxs-lookup"><span data-stu-id="0f092-126">Whether a new scheduler is added or removed, the permanent system tasks such as lockmonitor, checkpoint, system task thread (processing DTC), and signal process continue to run on the scheduler while the server is operational.</span></span> <span data-ttu-id="0f092-127">Эти постоянные системные задачи не перемещаются динамически.</span><span class="sxs-lookup"><span data-stu-id="0f092-127">These permanent system tasks do not dynamically migrate.</span></span> <span data-ttu-id="0f092-128">Для перераспределения процессорной нагрузки этих задач между планировщиками необходимо перезапустить экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0f092-128">To redistribute processor load for these system tasks across schedulers, it is necessary to restart the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="0f092-129">Если [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] попытается завершить работу планировщика, связанного с постоянной системной задачей, задача будет продолжать выполняться даже если планировщик будет работать в режиме «вне сети» (и не будет перенесена).</span><span class="sxs-lookup"><span data-stu-id="0f092-129">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] attempts to shut down a scheduler associated with a permanent system task, the task continues to run on the offline scheduler (no migration).</span></span> <span data-ttu-id="0f092-130">Этот планировщик привязан к процессорам измененной маской сходства, он не должен нагружать процессор, с которым он был приведен в соответствие до изменения.</span><span class="sxs-lookup"><span data-stu-id="0f092-130">This scheduler is bound to the processors in the modified affinity mask and should not put any load on the processor it was affinitized with before the change.</span></span> <span data-ttu-id="0f092-131">Использование дополнительных планировщиков, работающих в режиме «вне сети», не должно значительно влиять на нагрузку системы.</span><span class="sxs-lookup"><span data-stu-id="0f092-131">Having extra offline schedulers, should not significantly affect the load of the system.</span></span> <span data-ttu-id="0f092-132">Если это не так, то для повторной настройки этих задач нужно будет перезагрузить сервер баз данных.</span><span class="sxs-lookup"><span data-stu-id="0f092-132">If this is not the case, a database server reboot is required to reconfigure these tasks.</span></span>  
  
 <span data-ttu-id="0f092-133">Маска привязки ввода-вывода напрямую влияет на задачи привязки ввода-вывода (например, на lazywriter и logwriter).</span><span class="sxs-lookup"><span data-stu-id="0f092-133">The I/O affinity tasks (such as lazywriter and logwriter) are directly affected by the I/O affinity mask.</span></span> <span data-ttu-id="0f092-134">Если задачи lazywriter и logwriter не приведены в соответствие с процессорами, они следуют общим правилам постоянных задач, например lockmonitor или checkpoint.</span><span class="sxs-lookup"><span data-stu-id="0f092-134">If the lazywriter and logwriter tasks are not affinitized, they follow the same rules defined for the other permanent tasks such as lockmonitor or checkpoint.</span></span>  
  
 <span data-ttu-id="0f092-135">Чтобы гарантировать, что новая маска сходства допустима, команда RECONFIGURE проверяет, чтобы нормальные соответствия процессоров и ввода-вывода были взаимно исключающими.</span><span class="sxs-lookup"><span data-stu-id="0f092-135">To ensure that the new affinity mask is valid, the RECONFIGURE command verifies that the normal CPU and I/O affinities are mutually exclusive.</span></span> <span data-ttu-id="0f092-136">Если это не так, то сообщение об ошибке будет отправлено в сеанс клиента и записано в журнал ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , сигнализируя о том, что такая настройка не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="0f092-136">If this is not the case, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, indicating that such a setting is not recommended.</span></span> <span data-ttu-id="0f092-137">Запуск с параметром RECONFIGURE WITH OVERRIDE позволяет соответствиям процессоров и ввода-вывода не быть взаимоисключающими.</span><span class="sxs-lookup"><span data-stu-id="0f092-137">Running RECONFIGURE WITH OVERRIDE options allows CPU and I/O affinities that are not mutually exclusive.</span></span>  
  
 <span data-ttu-id="0f092-138">Если указать маску сходства, которая попытается сопоставить поток несуществующему процессору, то команда RECONFIGURE отправит сообщение об ошибке в сеанс клиента и в журнал ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0f092-138">If you specify an affinity mask that attempts to map to a nonexistent CPU, the RECONFIGURE command reports an error message to both the client session and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span> <span data-ttu-id="0f092-139">Использование параметра RECONFIGURE WITH OVERRIDE в этом случае ничего не изменит, и будет создано еще одно сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="0f092-139">Using the RECONFIGURE WITH OVERRIDE option has no effect in this case, and the same configuration error is reported again.</span></span>  
  
 <span data-ttu-id="0f092-140">Можно также исключить работу [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на процессорах, получивших специальные рабочие нагрузки от операционной системы Windows 2000 или Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="0f092-140">You can also exclude [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] activity from processors assigned specific workload assignments by the Windows 2000 or Windows Server 2003 operating system.</span></span> <span data-ttu-id="0f092-141">Если установить значение бита, представляющего процессор, в 1, этот процессор будет выбран ядром СУБД [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для назначения потоков.</span><span class="sxs-lookup"><span data-stu-id="0f092-141">If you set a bit representing a processor to 1, that processor is selected by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Database Engine for thread assignment.</span></span> <span data-ttu-id="0f092-142">Если задано значение `affinity mask` 0 (по умолчанию), алгоритмы планирования Microsoft windows 2000 или Windows Server 2003 устанавливают сходство потоков.</span><span class="sxs-lookup"><span data-stu-id="0f092-142">When you set `affinity mask` to 0 (the default), the Microsoft Windows 2000 or Windows Server 2003 scheduling algorithms set the thread's affinity.</span></span> <span data-ttu-id="0f092-143">Если в качестве `affinity mask` задано любое ненулевое значение, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] интерпретирует это значение схожести как битовую маску, определяющую процессоры, годные для выбора.</span><span class="sxs-lookup"><span data-stu-id="0f092-143">When you set `affinity mask` to any nonzero value, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] affinity interprets the value as a bitmask that specifies those processors eligible for selection.</span></span>  
  
 <span data-ttu-id="0f092-144">Если потокам [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] запрещено выполняться на определенных процессорах, ОС Microsoft Windows 2000 или Windows Server 2003 может лучше обрабатывать процессы, характерные для Windows.</span><span class="sxs-lookup"><span data-stu-id="0f092-144">By segregating [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] threads from running on particular processors, Microsoft Windows 2000 or Windows Server 2003 can better evaluate the system's handling of processes specific to Windows.</span></span> <span data-ttu-id="0f092-145">Например, на сервере с 8 процессорами, на котором работают два экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (экземпляры A и B), системный администратор может использовать параметр affinity mask для назначения первого набора из 4 процессоров экземпляру A и второго набора из 4 процессоров экземпляру B. Чтобы выполнить настройку больше чем для 32 процессоров, задавайте и параметр affinity mask, и параметр affinity64 mask.</span><span class="sxs-lookup"><span data-stu-id="0f092-145">For example, on an 8-CPU server running two instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (instance A and B), the system administrator could use the affinity mask option to assign the first set of 4 CPUs to instance A and the second set of 4 to instance B. To configure more than 32 processors, set both the affinity mask and the affinity64 mask.</span></span> <span data-ttu-id="0f092-146">Возможны следующие значения `affinity mask`.</span><span class="sxs-lookup"><span data-stu-id="0f092-146">The values for `affinity mask` are as follows:</span></span>  
  
-   <span data-ttu-id="0f092-147">Однобайтовое значение `affinity mask` обеспечивает управление компьютерами, содержащими до 8 процессоров.</span><span class="sxs-lookup"><span data-stu-id="0f092-147">A one-byte `affinity mask` covers up to 8 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="0f092-148">Двухбайтовое значение `affinity mask` обеспечивает управление компьютерами, содержащими до 16 процессоров.</span><span class="sxs-lookup"><span data-stu-id="0f092-148">A two-byte `affinity mask` covers up to 16 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="0f092-149">Трехбайтовое значение `affinity mask` обеспечивает управление компьютерами, содержащими до 24 процессоров.</span><span class="sxs-lookup"><span data-stu-id="0f092-149">A three-byte `affinity mask` covers up to 24 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="0f092-150">Четырехбайтовое значение `affinity mask` обеспечивает управление компьютерами, содержащими до 32 процессоров.</span><span class="sxs-lookup"><span data-stu-id="0f092-150">A four-byte `affinity mask` covers up to 32 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="0f092-151">Для управления большим числом процессоров для первых 32 процессоров используется четырехбайтовая маска соответствия, а для оставшихся — четырехбайтовое значение параметра affinity64 mask.</span><span class="sxs-lookup"><span data-stu-id="0f092-151">To cover more than 32 CPUs, configure a four-byte affinity mask for the first 32 CPUs and up to a four-byte affinity64 mask for the remaining CPUs.</span></span>  
  
 <span data-ttu-id="0f092-152">Так как задание соответствия процессоров [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] — специализированная операция, выполнять ее рекомендуется только при необходимости.</span><span class="sxs-lookup"><span data-stu-id="0f092-152">Because setting [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] processor affinity is a specialized operation, it is recommended that it be used only when necessary.</span></span> <span data-ttu-id="0f092-153">В большинстве случаев соответствие по умолчанию, назначаемое Microsoft Windows 2000 или Windows Server 2003, гарантирует оптимальную производительность.</span><span class="sxs-lookup"><span data-stu-id="0f092-153">In most cases, the Microsoft Windows 2000 or Windows Server 2003 default affinity provides the best performance.</span></span> <span data-ttu-id="0f092-154">При задании масок соответствия следует также учитывать требования к ЦП других приложений.</span><span class="sxs-lookup"><span data-stu-id="0f092-154">You should also consider the CPU requirements for other applications when setting the affinity masks.</span></span> <span data-ttu-id="0f092-155">Дополнительные сведения см. в документации по операционной системе Windows.</span><span class="sxs-lookup"><span data-stu-id="0f092-155">For more information, see your Windows operating system documentation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0f092-156">Для просмотра и анализа нагрузки на отдельные процессоры можно использовать системный монитор Windows.</span><span class="sxs-lookup"><span data-stu-id="0f092-156">You can use the Windows System Monitor to view and analyze individual processor usage.</span></span>  
  
 <span data-ttu-id="0f092-157">При задании параметра affinity I/O mask его необходимо использовать в сочетании с параметром конфигурации affinity mask.</span><span class="sxs-lookup"><span data-stu-id="0f092-157">When specifying the affinity I/O mask option, you must use it in connection with the affinity mask configuration option.</span></span> <span data-ttu-id="0f092-158">Не включайте один и тот же ЦП и в параметре `affinity mask`, и в параметре affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="0f092-158">Do not enable the same CPU in both the `affinity mask` switch and the affinity I/O mask option.</span></span> <span data-ttu-id="0f092-159">Биты, соответствующие каждому ЦП, должны находиться в одном из трех состояний.</span><span class="sxs-lookup"><span data-stu-id="0f092-159">The bits corresponding to each CPU should be in one of these three states:</span></span>  
  
-   <span data-ttu-id="0f092-160">значение 0 для обоих параметров, affinity mask и affinity I/O mask;</span><span class="sxs-lookup"><span data-stu-id="0f092-160">0 in both the affinity mask option and the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="0f092-161">значение 1 для параметра affinity mask и 0 для параметра affinity I/O mask;</span><span class="sxs-lookup"><span data-stu-id="0f092-161">1 in the affinity mask option and 0 in the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="0f092-162">значение 0 для параметра affinity mask и 1 для параметра affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="0f092-162">0 in the affinity mask option and 1 in the affinity I/O mask option.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="0f092-163">Не используйте маску привязки процессоров в операционной системе Windows и маску привязки в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]одновременно.</span><span class="sxs-lookup"><span data-stu-id="0f092-163">Do not configure CPU affinity in the Windows operating system and also configure the affinity mask in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="0f092-164">Эти настройки предназначены для достижения одного результата, и если их значения будут несогласованными, результат может быть непредсказуем.</span><span class="sxs-lookup"><span data-stu-id="0f092-164">These settings are attempting to achieve the same result, and if the configurations are inconsistent, you may have unpredictable results.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="0f092-165">Соответствие процессоров лучше всего настраивать с помощью параметра хранимой процедуры sp_configure в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0f092-165">CPU affinity is best configured using the sp_configure option in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="example"></a><span data-ttu-id="0f092-166">Пример</span><span class="sxs-lookup"><span data-stu-id="0f092-166">Example</span></span>  
 <span data-ttu-id="0f092-167">Если процессоры 1, 2 и 5 выбраны как доступные путем установки битов 1, 2 и 5 равными 1, а биты 0, 3, 4, 6 и 7 установлены равными 0, то в качестве значения параметра affinity mask должно быть указано шестнадцатеричное значение 0x26 или его десятичный эквивалент `38` .</span><span class="sxs-lookup"><span data-stu-id="0f092-167">As an example of setting the affinity mask option, if processors 1, 2, and 5 are selected as available with bits 1, 2, and 5 set to 1 and bits 0, 3, 4, 6, and 7 set to 0, a hexadecimal value of 0x26 or the decimal equivalent of `38` is specified.</span></span> <span data-ttu-id="0f092-168">Биты нумеруются справа налево.</span><span class="sxs-lookup"><span data-stu-id="0f092-168">Number the bits from right to left.</span></span> <span data-ttu-id="0f092-169">В параметре affinity mask начинается отсчет процессоров от 0 до 31, поэтому в следующем примере счетчик `1` представляет второй процессор на сервере.</span><span class="sxs-lookup"><span data-stu-id="0f092-169">The affinity mask option starts counting processors from 0 to 31, so that in the following example the counter `1` represents the second processor on the server.</span></span>  
  
```  
sp_configure 'show advanced options', 1;  
RECONFIGURE;  
GO  
sp_configure 'affinity mask', 38;  
RECONFIGURE;  
GO  
```  
  
 <span data-ttu-id="0f092-170">Это значения `affinity mask` для компьютера с 8 процессорами.</span><span class="sxs-lookup"><span data-stu-id="0f092-170">These are `affinity mask` values for an 8-CPU system.</span></span>  
  
|<span data-ttu-id="0f092-171">Десятичное значение</span><span class="sxs-lookup"><span data-stu-id="0f092-171">Decimal value</span></span>|<span data-ttu-id="0f092-172">Битовая маска</span><span class="sxs-lookup"><span data-stu-id="0f092-172">Binary bit mask</span></span>|<span data-ttu-id="0f092-173">Количество допустимых потоков SQL Server в процессорах</span><span class="sxs-lookup"><span data-stu-id="0f092-173">Allow SQL Server threads on processors</span></span>|  
|-------------------|---------------------|--------------------------------------------|  
|<span data-ttu-id="0f092-174">1</span><span class="sxs-lookup"><span data-stu-id="0f092-174">1</span></span>|<span data-ttu-id="0f092-175">00000001</span><span class="sxs-lookup"><span data-stu-id="0f092-175">00000001</span></span>|<span data-ttu-id="0f092-176">0</span><span class="sxs-lookup"><span data-stu-id="0f092-176">0</span></span>|  
|<span data-ttu-id="0f092-177">3</span><span class="sxs-lookup"><span data-stu-id="0f092-177">3</span></span>|<span data-ttu-id="0f092-178">00000011</span><span class="sxs-lookup"><span data-stu-id="0f092-178">00000011</span></span>|<span data-ttu-id="0f092-179">0 и 1</span><span class="sxs-lookup"><span data-stu-id="0f092-179">0 and 1</span></span>|  
|<span data-ttu-id="0f092-180">7</span><span class="sxs-lookup"><span data-stu-id="0f092-180">7</span></span>|<span data-ttu-id="0f092-181">00000111</span><span class="sxs-lookup"><span data-stu-id="0f092-181">00000111</span></span>|<span data-ttu-id="0f092-182">0, 1 и 2</span><span class="sxs-lookup"><span data-stu-id="0f092-182">0, 1, and 2</span></span>|  
|<span data-ttu-id="0f092-183">15</span><span class="sxs-lookup"><span data-stu-id="0f092-183">15</span></span>|<span data-ttu-id="0f092-184">00001111</span><span class="sxs-lookup"><span data-stu-id="0f092-184">00001111</span></span>|<span data-ttu-id="0f092-185">0, 1, 2 и 3</span><span class="sxs-lookup"><span data-stu-id="0f092-185">0, 1, 2, and 3</span></span>|  
|<span data-ttu-id="0f092-186">31</span><span class="sxs-lookup"><span data-stu-id="0f092-186">31</span></span>|<span data-ttu-id="0f092-187">00011111</span><span class="sxs-lookup"><span data-stu-id="0f092-187">00011111</span></span>|<span data-ttu-id="0f092-188">0, 1, 2, 3 и 4</span><span class="sxs-lookup"><span data-stu-id="0f092-188">0, 1, 2, 3, and 4</span></span>|  
|<span data-ttu-id="0f092-189">63</span><span class="sxs-lookup"><span data-stu-id="0f092-189">63</span></span>|<span data-ttu-id="0f092-190">00111111</span><span class="sxs-lookup"><span data-stu-id="0f092-190">00111111</span></span>|<span data-ttu-id="0f092-191">0, 1, 2, 3, 4 и 5</span><span class="sxs-lookup"><span data-stu-id="0f092-191">0, 1, 2, 3, 4, and 5</span></span>|  
|<span data-ttu-id="0f092-192">127</span><span class="sxs-lookup"><span data-stu-id="0f092-192">127</span></span>|<span data-ttu-id="0f092-193">01111111</span><span class="sxs-lookup"><span data-stu-id="0f092-193">01111111</span></span>|<span data-ttu-id="0f092-194">0, 1, 2, 3, 4, 5 и 6</span><span class="sxs-lookup"><span data-stu-id="0f092-194">0, 1, 2, 3, 4, 5, and 6</span></span>|  
|<span data-ttu-id="0f092-195">255</span><span class="sxs-lookup"><span data-stu-id="0f092-195">255</span></span>|<span data-ttu-id="0f092-196">11111111</span><span class="sxs-lookup"><span data-stu-id="0f092-196">11111111</span></span>|<span data-ttu-id="0f092-197">0, 1, 2, 3, 4, 5, 6 и 7</span><span class="sxs-lookup"><span data-stu-id="0f092-197">0, 1, 2, 3, 4, 5, 6, and 7</span></span>|  
  
 <span data-ttu-id="0f092-198">Параметр affinity mask является дополнительным.</span><span class="sxs-lookup"><span data-stu-id="0f092-198">The affinity mask option is an advanced option.</span></span> <span data-ttu-id="0f092-199">При использовании системной хранимой процедуры sp_configure для изменения параметра можно изменить `affinity mask` только в том случае, если параметру **Показывать дополнительные параметры** присвоено значение 1.</span><span class="sxs-lookup"><span data-stu-id="0f092-199">If you are using the sp_configure system stored procedure to change the setting, you can change `affinity mask` only when **show advanced options** is set to 1.</span></span> <span data-ttu-id="0f092-200">После выполнения команды [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE изменения параметров вступают в силу немедленно и не требуют перезапуска экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0f092-200">After executing the [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, the new setting takes effect immediately without requiring a restart of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
## <a name="non-uniform-memory-access-numa"></a><span data-ttu-id="0f092-201">Доступ к неоднородной памяти (NUMA)</span><span class="sxs-lookup"><span data-stu-id="0f092-201">Non-uniform Memory Access (NUMA)</span></span>  
 <span data-ttu-id="0f092-202">При использовании аппаратного доступа к неоднородной памяти (NUMA), если установлена маска сходства, каждый планировщик в узле сопоставляется своему собственному ЦП.</span><span class="sxs-lookup"><span data-stu-id="0f092-202">When using hardware based non-uniform memory access (NUMA) and the affinity mask is set, every scheduler in a node will be affinitized to its own CPU.</span></span> <span data-ttu-id="0f092-203">Когда маска сходства не установлена, каждый планировщик соответствует группе процессоров в пределах узла NUMA, и планировщик, сопоставленный с узлом NUMA N1, может планировать работу на любом процессоре в узле, но не на процессорах, связанных с другим узлом.</span><span class="sxs-lookup"><span data-stu-id="0f092-203">When the affinity mask is not set, each scheduler is affinitized to the group of CPUs within the NUMA node and a scheduler mapped to NUMA node N1 can schedule work on any CPU in the node, but not on CPUs associated with another node.</span></span>  
  
 <span data-ttu-id="0f092-204">Любая операция, выполняющаяся на одиночном узле NUMA, может использовать страницы буфера этого узла.</span><span class="sxs-lookup"><span data-stu-id="0f092-204">Any operation running on a single NUMA node can only use buffer pages from that node.</span></span> <span data-ttu-id="0f092-205">Когда операция выполняется параллельно на процессорах из нескольких узлов, может использоваться память любого задействованного узла.</span><span class="sxs-lookup"><span data-stu-id="0f092-205">When an operation is run in parallel on CPUs from multiple nodes, memory can be used from any node involved.</span></span>  
  
## <a name="licensing-issues"></a><span data-ttu-id="0f092-206">Вопросы лицензирования</span><span class="sxs-lookup"><span data-stu-id="0f092-206">Licensing Issues</span></span>  
 <span data-ttu-id="0f092-207">Динамическое изменение схожести жестко ограничивается лицензированием по процессорам.</span><span class="sxs-lookup"><span data-stu-id="0f092-207">Dynamic affinity is tightly constrained by CPU licensing.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="0f092-208">не позволяет использовать любые конфигурации параметров affinity mask, нарушающие политику лицензирования.</span><span class="sxs-lookup"><span data-stu-id="0f092-208">does not allow any configuration of affinity mask options that violates the licensing policy.</span></span>  
  
### <a name="startup"></a><span data-ttu-id="0f092-209">Запуск</span><span class="sxs-lookup"><span data-stu-id="0f092-209">Startup</span></span>  
 <span data-ttu-id="0f092-210">Если применение заданного значения affinity mask приводит к нарушению политики лицензирования во время запуска [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или во время присоединения базы данных, то уровень ядра завершает процесс запуска либо операцию присоединения или восстановления базы данных, а затем сбрасывает текущее значение sp_configure для параметра affinity mask в нуль, передавая сообщение об ошибке в журнал ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0f092-210">If a specified affinity mask violates the licensing policy during [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] startup or during database attach, the engine layer will complete the startup process or database attach/restore operation, and then it will reset the sp_configure run value for the affinity mask to zero, issuing an error message to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span>  
  
### <a name="reconfigure"></a><span data-ttu-id="0f092-211">Перенастройка</span><span class="sxs-lookup"><span data-stu-id="0f092-211">Reconfigure</span></span>  
 <span data-ttu-id="0f092-212">Если применение указанного значения affinity mask приводит к нарушению политики лицензирования при выполнении команды [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE, то сообщение об ошибке с требованием к администратору базы данных перенастроить значение affinity mask отправляется в сеанс клиента и в журнал ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0f092-212">If a specified affinity mask violates the licensing policy when running [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, requiring the database administrator to reconfigure the affinity mask.</span></span> <span data-ttu-id="0f092-213">В этом случае команда RECONFIGURE WITH OVERRIDE принята не будет.</span><span class="sxs-lookup"><span data-stu-id="0f092-213">No RECONFIGURE WITH OVERRIDE command is accepted in this case.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0f092-214">См. также:</span><span class="sxs-lookup"><span data-stu-id="0f092-214">See Also</span></span>  
 <span data-ttu-id="0f092-215">[Наблюдение за использованием ресурсов (системный монитор)](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span><span class="sxs-lookup"><span data-stu-id="0f092-215">[Monitor Resource Usage &#40;System Monitor&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span></span>  
 <span data-ttu-id="0f092-216">[RECONFIGURE (Transact-SQL)](/sql/t-sql/language-elements/reconfigure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="0f092-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span></span>  
 <span data-ttu-id="0f092-217">[Параметры конфигурации сервера (SQL Server)](server-configuration-options-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="0f092-217">[Server Configuration Options &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span></span>  
 <span data-ttu-id="0f092-218">[sp_configure (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="0f092-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span></span>  
 [<span data-ttu-id="0f092-219">ALTER SERVER CONFIGURATION (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="0f092-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-server-configuration-transact-sql)  
  
  
