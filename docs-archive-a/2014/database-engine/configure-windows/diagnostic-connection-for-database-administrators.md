---
title: Диагностическое соединение для администраторов баз данных | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- server management [SQL Server], connections
- administrator connections [SQL Server]
- ports [SQL Server], DAC
- DAC
- network connections [SQL Server], dedicated administrator
- diagnostic connections [SQL Server]
- connections [SQL Server], dedicated administrator
- ports [SQL Server]
- dedicated administrator connections [SQL Server]
ms.assetid: 993e0820-17f2-4c43-880c-d38290bf7abc
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 0d452ca155a5187136c910e81e8bd073e34cad56
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87665120"
---
# <a name="diagnostic-connection-for-database-administrators"></a><span data-ttu-id="f0783-102">Диагностическое соединение для администраторов баз данных</span><span class="sxs-lookup"><span data-stu-id="f0783-102">Diagnostic Connection for Database Administrators</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="f0783-103">предоставляет специальное диагностическое соединение для администраторов, когда стандартное соединение с сервером невозможно.</span><span class="sxs-lookup"><span data-stu-id="f0783-103">provides a special diagnostic connection for administrators when standard connections to the server are not possible.</span></span> <span data-ttu-id="f0783-104">Это диагностическое соединение позволяет администратору получить доступ к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для выполнения диагностических запросов и устранения проблем, даже когда [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не отвечает на стандартные запросы на соединение.</span><span class="sxs-lookup"><span data-stu-id="f0783-104">This diagnostic connection allows an administrator to access [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to execute diagnostic queries and troubleshoot problems even when [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is not responding to standard connection requests.</span></span>  
  
 <span data-ttu-id="f0783-105">Такое выделенное административное соединение (DAC) поддерживает шифрование и другие средства безопасности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f0783-105">This dedicated administrator connection (DAC) supports encryption and other security features of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f0783-106">Выделенное административное соединение позволяет только изменять контекст пользователя на другого пользователя с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="f0783-106">The DAC only allows changing the user context to another admin user.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="f0783-107">делает все возможное для успешного установления выделенного административного соединения, но в чрезвычайных ситуациях это может не дать результата.</span><span class="sxs-lookup"><span data-stu-id="f0783-107">makes every attempt to make DAC connect successfully, but under extreme situations it may not be successful.</span></span>  
  
||  
|-|  
|<span data-ttu-id="f0783-108">**Применимо к**: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ( [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] до [текущей версии](https://go.microsoft.com/fwlink/p/?LinkId=299658)), [!INCLUDE[sqldbesa](../../includes/sqldbesa-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f0783-108">**Applies to**: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ([!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] through [current version](https://go.microsoft.com/fwlink/p/?LinkId=299658)), [!INCLUDE[sqldbesa](../../includes/sqldbesa-md.md)].</span></span>|  
  
## <a name="connecting-with-dac"></a><span data-ttu-id="f0783-109">Соединение с помощью выделенного административного соединения</span><span class="sxs-lookup"><span data-stu-id="f0783-109">Connecting with DAC</span></span>  
 <span data-ttu-id="f0783-110">По умолчанию, соединение разрешено только из клиента, запущенного на сервере.</span><span class="sxs-lookup"><span data-stu-id="f0783-110">By default, the connection is only allowed from a client running on the server.</span></span> <span data-ttu-id="f0783-111">Сетевые подключения не разрешаются, пока они не настроены с помощью хранимой процедуры sp_configure с параметром [remote admin connections](remote-admin-connections-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="f0783-111">Network connections are not permitted unless they are configured by using the sp_configure stored procedure with the [remote admin connections option](remote-admin-connections-server-configuration-option.md).</span></span>  
  
 <span data-ttu-id="f0783-112">Только члены роли [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sysadmin могут подключаться с использованием выделенного административного соединения.</span><span class="sxs-lookup"><span data-stu-id="f0783-112">Only members of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sysadmin role can connect using the DAC.</span></span>  
  
 <span data-ttu-id="f0783-113">Выделенное административное соединение доступно и поддерживается через программу командной строки **sqlcmd** со специальным административным параметром (**-A**).</span><span class="sxs-lookup"><span data-stu-id="f0783-113">The DAC is available and supported through the **sqlcmd** command-prompt utility using a special administrator switch (**-A**).</span></span> <span data-ttu-id="f0783-114">Дополнительные сведения об использовании **sqlcmd** см. в разделе [Использование программы sqlcmd с переменными скрипта](../../relational-databases/scripting/sqlcmd-use-with-scripting-variables.md).</span><span class="sxs-lookup"><span data-stu-id="f0783-114">For more information about using **sqlcmd**, see [Use sqlcmd with Scripting Variables](../../relational-databases/scripting/sqlcmd-use-with-scripting-variables.md).</span></span> <span data-ttu-id="f0783-115">Можно также подсоединить префикс `admin:` к имени экземпляра в формате **sqlcmd-садмин:** _<instance_name>._</span><span class="sxs-lookup"><span data-stu-id="f0783-115">You can also connect prefixing `admin:`to the instance name in the format **sqlcmd -Sadmin:**_<instance_name>._</span></span> <span data-ttu-id="f0783-116">Кроме того, приложение уровня данных можно запустить из [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] редактора запросов, подключившись к `admin:` \<*instance_name*> .</span><span class="sxs-lookup"><span data-stu-id="f0783-116">You can also initiate a DAC from a [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] Query Editor by connecting to `admin:`\<*instance_name*>.</span></span>  
  
## <a name="restrictions"></a><span data-ttu-id="f0783-117">Ограничения</span><span class="sxs-lookup"><span data-stu-id="f0783-117">Restrictions</span></span>  
 <span data-ttu-id="f0783-118">Так как выделенное административное соединение существует только для диагностики проблем на сервере в редких обстоятельствах, у подключения есть некоторые ограничения.</span><span class="sxs-lookup"><span data-stu-id="f0783-118">Because the DAC exists solely for diagnosing server problems in rare circumstances, there are some restrictions on the connection:</span></span>  
  
-   <span data-ttu-id="f0783-119">Чтобы гарантировать, что для подключения есть доступные ресурсы, на один экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]разрешено только одно выделенное административное соединение.</span><span class="sxs-lookup"><span data-stu-id="f0783-119">To guarantee that there are resources available for the connection, only one DAC is allowed per instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f0783-120">Если выделенное административное соединение уже активно, любой новый запрос на соединение через DAC отклоняется с ошибкой 17810.</span><span class="sxs-lookup"><span data-stu-id="f0783-120">If a DAC connection is already active, any new request to connect through the DAC is denied with error 17810.</span></span>  
  
-   <span data-ttu-id="f0783-121">Для экономии ресурсов [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)] прослушивает порт выделенного административного соединения только при запуске с флагом трассировки 7806.</span><span class="sxs-lookup"><span data-stu-id="f0783-121">To conserve resources, [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)] does not listen on the DAC port unless started with a trace flag 7806.</span></span>  
  
-   <span data-ttu-id="f0783-122">Сначала выделенное административное соединение подключается к базе данных по умолчанию, связанной с именем входа.</span><span class="sxs-lookup"><span data-stu-id="f0783-122">The DAC initially attempts to connect to the default database associated with the login.</span></span> <span data-ttu-id="f0783-123">После успешного соединения можно подключиться к базе данных master.</span><span class="sxs-lookup"><span data-stu-id="f0783-123">After it is successfully connected, you can connect to the master database.</span></span> <span data-ttu-id="f0783-124">Если база данных по умолчанию находится в режиме вне сети или недоступна по другой причине, соединение вернет ошибку 4060.</span><span class="sxs-lookup"><span data-stu-id="f0783-124">If the default database is offline or otherwise not available, the connection will return error 4060.</span></span> <span data-ttu-id="f0783-125">При этом соединение будет успешным, если вместо базы данных по умолчанию подключиться к базе данных master с помощью следующей команды:</span><span class="sxs-lookup"><span data-stu-id="f0783-125">However, it will succeed if you override the default database to connect to the master database instead using the following command:</span></span>  
  
     <span data-ttu-id="f0783-126">**Мастер SQLCMD-A-d**</span><span class="sxs-lookup"><span data-stu-id="f0783-126">**sqlcmd -A -d master**</span></span>  
  
     <span data-ttu-id="f0783-127">Рекомендуется подключаться через выделенное административное соединение к базе данных master, так как база данных master будет в любом случае доступна, если запущен экземпляр компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f0783-127">We recommend that you connect to the master database with the DAC because master is guaranteed to be available if the instance of the [!INCLUDE[ssDE](../../includes/ssde-md.md)] is started.</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="f0783-128">запрещает выполнение параллельных запросов или команд через выделенное административное соединение.</span><span class="sxs-lookup"><span data-stu-id="f0783-128">prohibits running parallel queries or commands with the DAC.</span></span> <span data-ttu-id="f0783-129">Например, ошибка 3637 возникает при выполнении через выделенное административное соединение любой из следующих инструкций:</span><span class="sxs-lookup"><span data-stu-id="f0783-129">For example, error 3637 is generated if you execute either of the following statements with the DAC:</span></span>  
  
    -   <span data-ttu-id="f0783-130">RESTORE</span><span class="sxs-lookup"><span data-stu-id="f0783-130">RESTORE</span></span>  
  
    -   <span data-ttu-id="f0783-131">BACKUP</span><span class="sxs-lookup"><span data-stu-id="f0783-131">BACKUP</span></span>  
  
-   <span data-ttu-id="f0783-132">Через выделенное административное соединение гарантированно доступны только ограниченные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="f0783-132">Only limited resources are guaranteed to be available with the DAC.</span></span> <span data-ttu-id="f0783-133">Не используйте выделенное административное соединение для запуска ресурсоемких запросов (например,</span><span class="sxs-lookup"><span data-stu-id="f0783-133">Do not use the DAC to run resource-intensive queries (for example.</span></span> <span data-ttu-id="f0783-134">сложного соединения для большой таблицы) или запросов, которые могут блокироваться.</span><span class="sxs-lookup"><span data-stu-id="f0783-134">a complex join on large table) or queries that may block.</span></span> <span data-ttu-id="f0783-135">Это позволяет обезопасить выделенное административное соединение от осложнения любыми существующими проблемами на сервере.</span><span class="sxs-lookup"><span data-stu-id="f0783-135">This helps prevent the DAC from compounding any existing server problems.</span></span> <span data-ttu-id="f0783-136">Чтобы избежать сценариев, которые могут приводить к блокировке, следует при возможности запускать запросы, которые могут вызвать блокировку, на уровне изоляции моментального снимка. В противном случае следует установить уровень изоляции транзакций READ UNCOMMITTED и малое значение LOCK_TIMEOUT, например 2000 миллисекунд. Можно также использовать оба способа одновременно.</span><span class="sxs-lookup"><span data-stu-id="f0783-136">To avoid potential blocking scenarios, if you have to run queries that may block, run the query under snapshot-based isolation levels if possible; otherwise, set the transaction isolation level to READ UNCOMMITTED and set the LOCK_TIMEOUT value to a short value such as 2000 milliseconds, or both.</span></span> <span data-ttu-id="f0783-137">Это позволит предотвратить блокировку сеанса выделенного административного соединения.</span><span class="sxs-lookup"><span data-stu-id="f0783-137">This will prevent the DAC session from getting blocked.</span></span> <span data-ttu-id="f0783-138">Но в зависимости от состояния [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] сеанс выделенного административного соединения может быть заблокирован с помощью кратковременной блокировки.</span><span class="sxs-lookup"><span data-stu-id="f0783-138">However, depending on the state that the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is in, the DAC session might get blocked on a latch.</span></span> <span data-ttu-id="f0783-139">Возможно, удастся прекратить сеанс выделенного административного соединения с помощью комбинации клавиш CTRL-C, но это не гарантируется.</span><span class="sxs-lookup"><span data-stu-id="f0783-139">You might be able to terminate the DAC session using CNTRL-C but it is not guaranteed.</span></span> <span data-ttu-id="f0783-140">В таком случае единственным вариантом остается перезапуск [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f0783-140">In that case, your only option may be to restart [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="f0783-141">Чтобы гарантировать соединение и устранение неполадок через выделенное административное соединение, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] резервирует ограниченные ресурсы для обработки команд, запущенных через него.</span><span class="sxs-lookup"><span data-stu-id="f0783-141">To guarantee connectivity and troubleshooting with the DAC, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] reserves limited resources to process commands run on the DAC.</span></span> <span data-ttu-id="f0783-142">Этих ресурсов обычно хватает только для простых диагностических функций и устранения неполадок, которые приведены ниже.</span><span class="sxs-lookup"><span data-stu-id="f0783-142">These resources are typically only enough for simple diagnostic and troubleshooting functions, such as those listed below.</span></span>  
  
 <span data-ttu-id="f0783-143">Теоретически можно запустить любую инструкцию [!INCLUDE[tsql](../../includes/tsql-md.md)] , которая не должна исполняться параллельно через выделенное административное соединение, но корпорация Майкрософт настоятельно рекомендует ограничиться применением следующих команд диагностики и устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="f0783-143">Although you can theoretically run any [!INCLUDE[tsql](../../includes/tsql-md.md)] statement that does not have to execute in parallel on the DAC, we strongly recommend that you restrict usage to the following diagnostic and troubleshooting commands:</span></span>  
  
-   <span data-ttu-id="f0783-144">Запрос таких динамических административных представлений (DMV) для базовой диагностики, как sys.dm_tran_locks для состояния блокировки, sys.dm_os_memory_cache_counters для проверки исправности кэша, а sys.dm_exec_requests и sys.dm_exec_sessions для активных сеансов и запросов.</span><span class="sxs-lookup"><span data-stu-id="f0783-144">Querying dynamic management views for basic diagnostics such as sys.dm_tran_locks for the locking status, sys.dm_os_memory_cache_counters to check the health of caches, and sys.dm_exec_requests and sys.dm_exec_sessions for active sessions and requests.</span></span> <span data-ttu-id="f0783-145">Старайтесь не использовать динамические административные представления DMV, потребляющие много ресурсов (например, представление sys.dm_tran_version_store полностью просматривает хранилище версий, что может привести к резкому увеличению объема ввода-вывода) или использующие сложные соединения.</span><span class="sxs-lookup"><span data-stu-id="f0783-145">Avoid dynamic management views that are resource intensive (for example, sys.dm_tran_version_store scans the full version store and can cause extensive I/O) or that use complex joins.</span></span> <span data-ttu-id="f0783-146">Сведения о влиянии на производительность см. в документации к конкретному [динамическому административному представлению](../../relational-databases/views/views.md).</span><span class="sxs-lookup"><span data-stu-id="f0783-146">For information about performance implications, see the documentation for the specific [dynamic management view](../../relational-databases/views/views.md).</span></span>  
  
-   <span data-ttu-id="f0783-147">Запрос представлений каталога.</span><span class="sxs-lookup"><span data-stu-id="f0783-147">Querying catalog views.</span></span>  
  
-   <span data-ttu-id="f0783-148">Основные команды DBCC, например DBCC FREEPROCCACHE, DBCC FREESYSTEMCACHE, DBCC DROPCLEANBUFFERS`,` а также DBCC SQLPERF.</span><span class="sxs-lookup"><span data-stu-id="f0783-148">Basic DBCC commands such as DBCC FREEPROCCACHE, DBCC FREESYSTEMCACHE, DBCC DROPCLEANBUFFERS`,` and DBCC SQLPERF.</span></span> <span data-ttu-id="f0783-149">Не запускайте ресурсоемкие команды, такие как **DBCC** CHECKDB, DBCC DBREINDEX или DBCC SHRINKDATABASE.</span><span class="sxs-lookup"><span data-stu-id="f0783-149">Do not run resource-intensive commands such as **DBCC** CHECKDB, DBCC DBREINDEX, or DBCC SHRINKDATABASE.</span></span>  
  
-   <span data-ttu-id="f0783-150">Команда [!INCLUDE[tsql](../../includes/tsql-md.md)]KILL *\<spid>* .</span><span class="sxs-lookup"><span data-stu-id="f0783-150">[!INCLUDE[tsql](../../includes/tsql-md.md)] KILL*\<spid>* command.</span></span> <span data-ttu-id="f0783-151">В зависимости от состояния [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]команда KILL не всегда выполняется успешно. В этом случае единственным выходом остается перезапуск [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f0783-151">Depending on the state of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the KILL command might not always succeed; then the only option may be to restart [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f0783-152">Рассмотрим несколько общих правил.</span><span class="sxs-lookup"><span data-stu-id="f0783-152">The following are some general guidelines:</span></span>  
  
    -   <span data-ttu-id="f0783-153">С помощью запроса `SELECT * FROM sys.dm_exec_sessions WHERE session_id = <spid>`убедитесь, что SPID был действительно отключен.</span><span class="sxs-lookup"><span data-stu-id="f0783-153">Verify that the SPID was actually killed by querying `SELECT * FROM sys.dm_exec_sessions WHERE session_id = <spid>`.</span></span> <span data-ttu-id="f0783-154">Если строки не возвращаются, значит, сеанс был остановлен.</span><span class="sxs-lookup"><span data-stu-id="f0783-154">If it returns no rows, it means the session was killed.</span></span>  
  
    -   <span data-ttu-id="f0783-155">Если сеанс продолжается, проверьте с помощью запроса `SELECT * FROM sys.dm_os_tasks WHERE session_id = <spid>`наличие задач, назначенных для этого сеанса.</span><span class="sxs-lookup"><span data-stu-id="f0783-155">If the session is still there, verify whether there are tasks assigned to this session by running the query `SELECT * FROM sys.dm_os_tasks WHERE session_id = <spid>`.</span></span> <span data-ttu-id="f0783-156">Если задача присутствует, то, скорее всего, сеанс закрывается в настоящий момент.</span><span class="sxs-lookup"><span data-stu-id="f0783-156">If you see the task there, most likely your session is currently being killed.</span></span> <span data-ttu-id="f0783-157">Заметьте, что это может занять немало времени и завершиться неуспешно.</span><span class="sxs-lookup"><span data-stu-id="f0783-157">Note that this may take considerable amount of time and may not succeed at all.</span></span>  
  
    -   <span data-ttu-id="f0783-158">Если в sys.dm_os_tasks нет задач, связанных с данным сеансом, но сеанс остается в sys.dm_exec_sessions после выполнения команды KILL, это означает, что отсутствует доступный рабочий процессор.</span><span class="sxs-lookup"><span data-stu-id="f0783-158">If there are no tasks in the sys.dm_os_tasks associated with this session, but the session remains in sys.dm_exec_sessions after executing the KILL command, it means that you do not have a worker available.</span></span> <span data-ttu-id="f0783-159">Чтобы освободить рабочий поток, выберите одну из текущих задач (задача в представлении sys.dm_os_tasks со значением `sessions_id <> NULL`) и остановите связанный с ней сеанс.</span><span class="sxs-lookup"><span data-stu-id="f0783-159">Select one of the currently running tasks (a task listed in the sys.dm_os_tasks view with a `sessions_id <> NULL`), and kill the session associated with it to free up the worker.</span></span> <span data-ttu-id="f0783-160">Заметьте, что остановка одного сеанса может оказаться недостаточной: может потребоваться остановить несколько сеансов.</span><span class="sxs-lookup"><span data-stu-id="f0783-160">Note that it may not be enough to kill a single session: you may have to kill multiple ones.</span></span>  
  
## <a name="dac-port"></a><span data-ttu-id="f0783-161">Порт выделенного административного соединения</span><span class="sxs-lookup"><span data-stu-id="f0783-161">DAC Port</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="f0783-162">для выделенных административных соединений прослушивает TCP-порт 1434, если он доступен, или TCP-порт, динамически назначаемый при запуске компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f0783-162">listens for the DAC on TCP port 1434 if available or a TCP port dynamically assigned upon [!INCLUDE[ssDE](../../includes/ssde-md.md)] startup.</span></span> <span data-ttu-id="f0783-163">Журнал ошибок содержит номер порта, на котором ожидается выделенное административное соединение.</span><span class="sxs-lookup"><span data-stu-id="f0783-163">The error log contains the port number the DAC is listening on.</span></span> <span data-ttu-id="f0783-164">По умолчанию, выделенное административное соединение ожидается только на местном порте.</span><span class="sxs-lookup"><span data-stu-id="f0783-164">By default the DAC listener accepts connection on only the local port.</span></span> <span data-ttu-id="f0783-165">Образец кода, активирующего удаленные административные соединения, см. в разделе [Параметр конфигурации сервера "remote admin connections"](remote-admin-connections-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="f0783-165">For a code sample that activates remote administration connections, see [remote admin connections Server Configuration Option](remote-admin-connections-server-configuration-option.md).</span></span>  
  
 <span data-ttu-id="f0783-166">После настройки административного соединения средство прослушивания выделенных административных соединений включается без необходимости перезапуска [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , и клиент может удаленно подключиться к DAC.</span><span class="sxs-lookup"><span data-stu-id="f0783-166">After the remote administration connection is configured, the DAC listener is enabled without requiring a restart of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and a client can now connect to the DAC remotely.</span></span> <span data-ttu-id="f0783-167">Средству прослушивания соединений DAC можно разрешить прием удаленных соединений, даже если [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не отвечает. Для этого можно сначала подключиться к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] локально посредством выделенного административного соединения, а затем выполнить хранимую процедуру sp_configure для приема удаленных соединений.</span><span class="sxs-lookup"><span data-stu-id="f0783-167">You can enable the DAC listener to accept connections remotely even if [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is unresponsive by first connecting to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] using the DAC locally, and then executing the sp_configure stored procedure to accept connection from remote connections.</span></span>  
  
 <span data-ttu-id="f0783-168">В кластерных конфигурациях выделенное административное соединение по умолчанию выключено.</span><span class="sxs-lookup"><span data-stu-id="f0783-168">On cluster configurations, the DAC will be off by default.</span></span> <span data-ttu-id="f0783-169">Обеспечить доступ к удаленным соединениям средству прослушивания DAC пользователи могут с помощью хранимой процедуры sp_configure с параметром remote admin connection.</span><span class="sxs-lookup"><span data-stu-id="f0783-169">Users can execute the remote admin connection option of sp_configure to enable the DAC listener to access a remote connection.</span></span> <span data-ttu-id="f0783-170">Если [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не отвечает, а средство прослушивания выделенных административных соединений отключено, то для подключения к DAC, возможно, потребуется перезапустить [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f0783-170">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is unresponsive and the DAC listener is not enabled, you might have to restart [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to connect with the DAC.</span></span> <span data-ttu-id="f0783-171">Поэтому корпорация Майкрософт рекомендует включать вариант конфигурации remote admin connections в кластеризованных системах.</span><span class="sxs-lookup"><span data-stu-id="f0783-171">Therefore, we recommend that you enable the remote admin connections configuration option on clustered systems.</span></span>  
  
 <span data-ttu-id="f0783-172">Порт выделенных административных соединений присваивается [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] динамически во время запуска.</span><span class="sxs-lookup"><span data-stu-id="f0783-172">The DAC port is assigned dynamically by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] during startup.</span></span> <span data-ttu-id="f0783-173">При соединении с экземпляром по умолчанию DAC стремится не использовать запрос протокола разрешения [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (SSRP) к службе обозревателя SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f0783-173">When connecting to the default instance, the DAC avoids using a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Resolution Protocol (SSRP) request to the SQL Server Browser Service when connecting.</span></span> <span data-ttu-id="f0783-174">Сначала выполняется попытка подключиться через TCP-порт 1434.</span><span class="sxs-lookup"><span data-stu-id="f0783-174">It first connects over TCP port 1434.</span></span> <span data-ttu-id="f0783-175">В случае ошибки следует вызов SSRP на получение порта.</span><span class="sxs-lookup"><span data-stu-id="f0783-175">If that fails, it makes an SSRP call to get the port.</span></span> <span data-ttu-id="f0783-176">Если браузер [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не ожидает запросов SSRP, запрос на подключение возвращает ошибку.</span><span class="sxs-lookup"><span data-stu-id="f0783-176">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Browser is not listening for SSRP requests, the connection request returns an error.</span></span> <span data-ttu-id="f0783-177">Обратитесь к журналу ошибок, чтобы найти номер порта, на котором ожидается выделенное административное соединение.</span><span class="sxs-lookup"><span data-stu-id="f0783-177">Refer to the error log to find the port number DAC is listening on.</span></span> <span data-ttu-id="f0783-178">Если [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] настроен для приема удаленных административных подключений, выделенное административное соединение должно быть инициировано с явно указанным номером порта:</span><span class="sxs-lookup"><span data-stu-id="f0783-178">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is configured to accept remote administration connections, the DAC must be initiated with an explicit port number:</span></span>  
  
 <span data-ttu-id="f0783-179">**sqlcmd-stcp:** _ \<server> , \<port> _</span><span class="sxs-lookup"><span data-stu-id="f0783-179">**sqlcmd-Stcp:** _\<server>,\<port>_</span></span>  
  
 <span data-ttu-id="f0783-180">Журнал ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] приводит номер порта для выделенного административного соединения; по умолчанию он равен 1434.</span><span class="sxs-lookup"><span data-stu-id="f0783-180">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log lists the port number for the DAC, which is 1434 by default.</span></span> <span data-ttu-id="f0783-181">Если [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] настроен для приема только локальных выделенных административных соединений, подключайтесь через адаптер замыкания на себя с использованием следующей команды:</span><span class="sxs-lookup"><span data-stu-id="f0783-181">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is configured to accept local DAC connections only, connect using the loopback adapter using the following command:</span></span>  
  
 <span data-ttu-id="f0783-182">**sqlcmd-s 127.0.0.1**,`1434`</span><span class="sxs-lookup"><span data-stu-id="f0783-182">**sqlcmd-S127.0.0.1**,`1434`</span></span>  
  
## <a name="example"></a><span data-ttu-id="f0783-183">Пример</span><span class="sxs-lookup"><span data-stu-id="f0783-183">Example</span></span>  
 <span data-ttu-id="f0783-184">В этом примере администратор видит, что сервер `URAN123` не отвечает, и пытается определить неполадку.</span><span class="sxs-lookup"><span data-stu-id="f0783-184">In this example, an administrator notices that server `URAN123` is not responding and wants to diagnose the problem.</span></span> <span data-ttu-id="f0783-185">Для этого пользователь активирует программу командной строки `sqlcmd` и подключается к серверу `URAN123` с помощью ключа `-A` , чтобы обозначить выделенное административное соединение.</span><span class="sxs-lookup"><span data-stu-id="f0783-185">To do this, the user activates the `sqlcmd` command prompt utility and connects to server `URAN123` using `-A` to indicate the DAC.</span></span>  
  
 `sqlcmd -S URAN123 -U sa -P <xxx> -A`  
  
 <span data-ttu-id="f0783-186">Теперь администратор может запускать запросы для определения проблемы и, возможно, прекращения не отвечающих сеансов.</span><span class="sxs-lookup"><span data-stu-id="f0783-186">The administrator can now execute queries to diagnose the problem and possibly terminate the unresponsive sessions.</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="f0783-187">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="f0783-187">Related Tasks</span></span>  
  
## <a name="related-content"></a><span data-ttu-id="f0783-188">См. также</span><span class="sxs-lookup"><span data-stu-id="f0783-188">Related Content</span></span>  
 [<span data-ttu-id="f0783-189">Использование программы sqlcmd с переменными скрипта</span><span class="sxs-lookup"><span data-stu-id="f0783-189">Use sqlcmd with Scripting Variables</span></span>](../../relational-databases/scripting/sqlcmd-use-with-scripting-variables.md)  
  
 [<span data-ttu-id="f0783-190">Программа sqlcmd</span><span class="sxs-lookup"><span data-stu-id="f0783-190">sqlcmd Utility</span></span>](../../tools/sqlcmd-utility.md)  
  
 [<span data-ttu-id="f0783-191">SELECT (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f0783-191">SELECT &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/queries/select-transact-sql)  
  
 [<span data-ttu-id="f0783-192">sp_who (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f0783-192">sp_who &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-who-transact-sql)  
  
 [<span data-ttu-id="f0783-193">sp_lock (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f0783-193">sp_lock &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-lock-transact-sql)  
  
 [<span data-ttu-id="f0783-194">KILL (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f0783-194">KILL &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/language-elements/kill-transact-sql)  
  
 [<span data-ttu-id="f0783-195">DBCC CHECKALLOC (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f0783-195">DBCC CHECKALLOC &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-checkalloc-transact-sql)  
  
 [<span data-ttu-id="f0783-196">DBCC CHECKDB (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f0783-196">DBCC CHECKDB &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql)  
  
 [<span data-ttu-id="f0783-197">DBCC OPENTRAN (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f0783-197">DBCC OPENTRAN &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-opentran-transact-sql)  
  
 [<span data-ttu-id="f0783-198">DBCC INPUTBUFFER (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f0783-198">DBCC INPUTBUFFER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-inputbuffer-transact-sql)  
  
 [<span data-ttu-id="f0783-199">Параметры конфигурации сервера (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="f0783-199">Server Configuration Options &#40;SQL Server&#41;</span></span>](server-configuration-options-sql-server.md)  
  
 [<span data-ttu-id="f0783-200">Динамические административные представления и функции, связанные с транзакциями (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f0783-200">Transaction Related Dynamic Management Views and Functions &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/transaction-related-dynamic-management-views-and-functions-transact-sql)  
  
 [<span data-ttu-id="f0783-201">Флаги трассировки (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f0783-201">Trace Flags &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql)  
  
  
