---
title: Создание сеанса расширенных событий с помощью диалогового окна "Создание сеанса" | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
f1_keywords:
- SQL12.SSMS.XEDISPLAY.GROUPING.F1
- SQL12.SSMS.XEDISPLAY.AGGREGATION.F1
- SQL12.SSMS.XEDISPLAY.NEWMERGEDCOLUMN.F1
- SQL12.SSMS.XENEWEVENTSESSION.GENERAL.F1
- SQL12.SSMS.XEDISPLAY.EDITCOLUMNS.F1
- SQL12.SSMS.XEDISPLAY.FILTERS.F1
helpviewer_keywords:
- Extended Events Dialog Box
ms.assetid: 6b2244bc-df6a-4b0a-990e-ddd8d42f7907
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: d42eb23afdf7e8e284a44b10564f5e6c3568a307
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87664474"
---
# <a name="create-an-extended-events-session-using-the-new-session-dialog"></a>Создание сеанса расширенных событий в диалоговом окне «Создание сеанса»
  В диалоговом окне «Создание сеанса» можно определить сеанс расширенных событий, в котором будет осуществляться сбор, отображение и анализ данных. Диалоговое окно «Создание сеанса» включает все функции расширенных событий.  
  
 Кроме того, определить сеанс расширенных событий также поможет [мастер нового сеанса](../ssms/object/object-explorer.md) . Он поддерживает большинство функций расширенных событий.  
  
## <a name="before-you-begin"></a>Перед началом работы  
 Чтобы открыть диалоговое окно нового сеанса, разверните в обозревателе объектов узел **Управление** , а затем узел **Расширенные события**. Щелкните правой кнопкой мыши **Сеансы**и выберите **Создать сеанс**.  
  
##  <a name="permissions"></a><a name="BeforeYouBegin"></a> Permissions  
 Для создания сеанса расширенных событий требуется разрешение ALTER ANY EVENT SESSION.  
  
## <a name="to-create-an-extended-events-session-using-the-new-session-dialog"></a>Создание сеанса расширенных событий в диалоговом окне «Создание сеанса»  
 Выберите шаблон и расписание сеанса событий на странице **Общие** .  
  
#### <a name="to-select-a-template-and-schedule-an-event-session"></a>Выберите шаблон и расписание сеанса событий  
  
1.  В обозревателе объектов разверните узел **Управление** , затем узел **Расширенные события**. Щелкните правой кнопкой мыши **Сеансы**и выберите **Создать сеанс**.  
  
2.  На странице **Общие** в поле **Имя сеанса** введите для сеанса события осмысленное имя.  
  
3.  В поле **Шаблон** выберите необходимый шаблон из раскрывающегося списка.  
  
     Можно выбрать набор предварительно настроенных шаблонов для распространенных проблем либо щелкнуть **Из файла** , чтобы использовать файл шаблона, экспортированный из определения предыдущего сеанса. Обратите внимание, что можно также изменить конфигурацию сеанса после применения шаблона.  
  
4.  Если требуется начать сеанс при запуске сервера, то в разделе **Расписание** установите флажок для пункта **Начать сеанс события при запуске сервера** .  
  
     Если нужно начать сеанс после создания сеанса, установите флажок для пункта **Начать сеанс события сразу после создания сеанса** .  
  
5.  Для просмотра данных сеанса событий, передаваемых в режиме реального времени, нажмите кнопку **Смотреть данные, передаваемые в режиме реального времени, на экране по мере их захвата**. Данные, передаваемые в режиме реального времени, будут отображаться сразу после создания сеанса.  
  
6.  В разделе **Отслеживание причинности** установите флажок для пункта **Следить за тем, как события связаны друг с другом** , чтобы отслеживать взаимосвязи между несколькими задачами.  
  
     Дополнительные сведения об отслеживании причинности см. в разделе "содержимое и характеристики сеанса" раздела [SQL Server расширенные события сеансы](../relational-databases/extended-events/sql-server-extended-events-sessions.md) .  
  
     Чтобы добавить события в сеанс, в разделе **Выбор страницы** нажмите кнопку **События**.  
  
    > [!NOTE]  
    >  Не нажимайте кнопку **ОК** до завершения создания сеанса событий.  
  
 На странице **События** найдите и добавьте события, которые необходимо отслеживать в сеансе.  
  
#### <a name="to-add-events-to-a-session"></a>Добавление событий к сеансу  
  
1.  В диалоговом окне нового сеанса в разделе **Выбор страницы** выберите **События**.  
  
2.  На странице **События** нажмите кнопку **Выбор** (кнопка **Выбор** недоступна, если экран **Выбор событий для отслеживания** уже открыт).  
  
     Поддерживается поиск любых слов в таблице путем ввода текста для поиска в поле **Библиотека событий** . Например, если необходимо найти событие **lock_acquired** , можно ввести команду **lock** или **lock acquire**.  
  
3.  В разделе **Библиотека событий** выберите в раскрывающемся списке способ поиска событий для отслеживания. Например, можно выполнить поиск имен событий или имен событий и их описаний. Введите условия поиска в поле **Поиск** .  
  
    > [!NOTE]  
    >  События из канала **Debug** скрыты по умолчанию. Чтобы просмотреть события отладки, выберите **Отладка** в раскрывающемся списке **Каналы** .  
  
     Сведения о выбранных событиях отображаются на панели «Сведения» в разделе **Библиотека событий**.  
  
     События сортируются по именам в алфавитном порядке. Можно выбрать другие характеристики событий в качестве параметров сортировки, щелкнув соответствующий заголовок столбца. Например, можно выбрать для сортировки столбец **Категория** или **Канал** .  
  
4.  Выберите события, которые требуется отслеживать, и щелкните стрелку вправо, чтобы переместить события в раздел **Выбранные события** .  
  
    > [!NOTE]  
    >  В разделе **Библиотека событий** можно выбрать несколько событий одновременно с помощью клавиш CTRL или SHIFT.  
  
     Для настройки выбранных событий нажмите кнопку **Настройка**.  
  
    > [!NOTE]  
    >  Не нажимайте кнопку **ОК** до завершения создания сеанса событий.  
  
 Добавление целевых объектов в сеанс событий производится на странице **Хранение данных** . Целевые объекты хранят данные и могут выполнять действия, такие как сохранение событий в файл для дальнейшего просмотра и статистической обработки данных сеанса. Дополнительные сведения о целевых объектах расширенных событий см. в разделе [SQL Server Extended Events Targets](../../2014/database-engine/sql-server-extended-events-targets.md).  
  
 Ниже приведены целевые объекты, которые могут быть использованы для сеанса расширенных событий.  
  
-   **etw_classic_sync_target**. Служит для согласования событий SQL Server с данными событий приложений и операционной системы Windows.  
  
-   **event_counter**. Относится ко всем событиям, происходящими после запуска сеанса расширенных событий. Эта цель используется для получения сведений о характеристиках рабочей нагрузки без затрат на сбор всех событий.  
  
-   **event_file**. Используется для записи выходных данных сеанса событий из полных буферов памяти на диск.  
  
-   **гистограмма**. Используется для подсчета количества указанных событий на основании указанного действия или столбца события.  
  
-   **pair_matching**. Эта цель позволяет определить, что указанное парное событие не произошло в правильной последовательности.  
  
-   **ring_buffer**. Используется для хранения данных о событиях в памяти по принципу очереди (FIFO) или по принципу FIFO для каждого события.  
  
#### <a name="to-configure-global-fields-for-a-session"></a>Настройка глобальных полей для сеанса  
  
1.  На странице **События** после выбора события или событий, которые необходимо добавить к сеансу событий, нажмите кнопку **Настройка**.  
  
     После нажатия кнопки **Настройка**раскроется раздел **Библиотека событий** , а раздел **Выбранные события** перейдет в левую часть страницы. Раздел **Параметры конфигурации событий** , который служит для настройки событий, появится в правой части страницы. Используйте вкладки на этой странице для настройки действий для сеанса события.  
  
2.  На вкладке **Глобальные поля** выберите поля, которые необходимо применить к выбранным событиям.  
  
     Для каждого события можно выбрать несколько полей.  
  
    > [!NOTE]  
    >  Если два уже выбранных события имеют разные настроенные действия, то в области «Расширенные события» будут отображаться частично проверенные действия. Чтобы можно было быстро найти включенные действия, отсортируйте их по состоянию «вкл./выкл.», щелкнув по заголовку столбца над полями выбора.  
  
3.  На вкладке  **Фильтры** примените фильтры (также называемые предикатами) для ограничения событий, которые необходимо записывать.  
  
     Если фильтр применен к выбранному событию, то в столбце появляется флажок.  
  
    > [!NOTE]  
    >  С помощью клавиш SHIFT или CTRL можно выбрать несколько событий, к которым необходимо применить фильтр. Но при этом для настройки будут доступны только общие поля событий. Если два выбранных события имеют различные настроенные фильтры, то такие фильтры уже не отображаются. Повторная настройка фильтров перезапишет существующие значения фильтра.  
  
    > [!NOTE]  
    >  При настройке предложения группирования для фильтра лишние круглые скобки будут удалены из фильтра после сохранения результата. Например, при создании фильтра группирования **Предложения 1** и **Предложения 2**предложения будут заключаться в круглые скобки. После сохранения фильтра лишние круглые скобки будут удалены. Удаление круглых скобок не влияет на логику фильтрации.  
  
4.  На вкладке **Поля событий** выберите поля событий, которые необходимо применить к выбранному событию.  
  
     События содержат число полей, которые собираются всегда и отображаются на вкладке **Поля событий** без флажка. Событие также может иметь дополнительные поля, сбор которых по умолчанию не выполняется (например, не производится сбор ресурсоемких необязательных полей). Дополнительные поля также приводятся на вкладке **Поля событий** с флажками. Чтобы производился сбор для дополнительного поля, установите для него флажок.  
  
    > [!NOTE]  
    >  В параметрах поля события отображаются поля, которые будут записываться и которые можно будет просмотреть в результатах трассировки. (Расширенные события отображают только типы данных полей событий. Например, поля только для чтения не отображаются.) Если выбрано несколько событий, то диалоговое окно «Создание сеанса» на вкладке **Поля событий** будет отображаться пустым.  
  
5.  Чтобы добавить в сеанс событий целевые объекты, в разделе **Выбор страницы** выберите **Хранение данных**.  
  
    > [!NOTE]  
    >  Не нажимайте кнопку **ОК** до завершения создания сеанса событий.  
  
#### <a name="to-add-targets-to-an-event-session"></a>Добавление целевых объектов в сеанс событий  
  
1.  В диалоговом окне «Новый сеанс» в разделе **Выбор страницы** выберите **Хранение данных**.  
  
2.  На странице **Хранение данных** выберите тип целевого объекта из раскрывающегося списка.  
  
     После выбора типа целевого объекта будет выведено его описание. За один раз можно добавить только один целевой объект. Если целевой объект уже добавлен в сеанс, то он не будет отображаться в раскрывающемся списке.  
  
3.  Нажмите кнопку **Добавить** , чтобы добавить целевой объект в сеанс событий. Если необходимо удалить целевой объект, нажмите кнопку **Удалить**.  
  
     Свойства целевого объекта отображаются в разделе **Целевые объекты** . Их набор зависит от выбранного целевого объекта.  
  
4.  Ниже перечислены свойства, которые можно указать в зависимости от выбранного целевого объекта.  
  
    |Назначение|Свойства целевого объекта|  
    |------------|-----------------------|  
    |**etw_classic_sync_target**|**Имя файла журнала сеанса на сервере**. Введите имя файла журнала и папки на сервере или нажмите кнопку **Обзор** , чтобы найти и выбрать файл журнала.<br /><br /> **Максимальный размер файла журнала**. Введите максимальный размер файла журнала для отслеживания событий для события Windows (ETW). По умолчанию он составляет 20 мегабайт (МБ). Другую единицу хранения можно выбрать в раскрывающемся списке.<br /><br /> **Размер буфера**. Введите размер встроенного буфера для сеанса событий. Значение по умолчанию — 128 КБ. Другую единицу хранения можно выбрать в раскрывающемся списке.<br /><br /> **Имя сеанса**. Введите понятное имя сеанса трассировки событий Windows.<br /><br /> **Повторить при появлении ошибки записи в сеанс трассировки событий Windows**. Установите этот флажок, чтобы производилась попытка повторной публикации события в подсистеме трассировки событий Windows.<br /><br /> **Максимальное число попыток**. Введите максимальное число попыток публикации события в подсистеме ETW, прежде чем это событие будет удалено. По умолчанию число попыток равно нулю (0). Для этого свойства целевого объекта нуль (0) означает нулевое количество попыток.|  
    |**event_counter**|Нет свойств целевого объекта для счетчика событий.|  
    |**event_file**|**Имя файла на сервере**. Введите имя файла целевого объекта и имя папки на сервере или нажмите кнопку **Обзор** , чтобы найти и выбрать его.<br /><br /> **Максимальный размер файла**. Укажите максимальный размер файла целевого объекта. Если максимальный размер файла не задан, файл будет увеличиваться до заполнения диска. Размер файла по умолчанию составляет 1 ГБ. Другую единицу хранения можно выбрать в раскрывающемся списке.<br /><br /> **Включение переключения на файл продолжения**. Установите этот флажок, чтобы включить переключение файлов для файла целевого объекта.<br /><br /> **Максимальное число файлов**. Введите максимальное число файлов, которые необходимо хранить в файловой системе.|  
    |**отображения**|**События для фильтрации**. Выберите событие для фильтрации из раскрывающегося списка. Можно выполнить фильтрацию по любому событию в сеансе событий. Можно также выбрать **\<None>** из раскрывающегося списка все события и базовые контейнеры для действия.<br /><br /> **На основе сегментов: действие** Выберите этот параметр, чтобы создать сегменты на имя действия, которое используется в качестве источника данных, а затем выберите действие из раскрывающегося списка.<br /><br /> **На основе сегментов: поле** Выберите этот параметр, чтобы создать сегменты по полю события, которое используется в качестве источника данных, а затем выберите поле из раскрывающегося списка.<br /><br /> **Максимальное число сегментов**. Введите максимальное число сегментов, которые необходимо сохранять. При достижении этого значения сеанс событий будет пропускать новые события, не принадлежащие к существующему сегменту.|  
    |**pair_matching**|**События: начиная с**. Выберите имя события из раскрывающегося списка, которое задает событие начала в парной последовательности.<br /><br /> **События: заканчивая**. Выберите имя события из раскрывающегося списка, которое задает событие конца в парной последовательности.<br /><br /> **Поля и действия: начиная с** Выберите поле начала или действие в парной последовательности из раскрывающегося списка.<br /><br /> **Поля и действия: заканчивая** Выберите поле конца или действие в парной последовательности из раскрывающегося списка.<br /><br /> **Отменить новые непарные события при нехватке памяти**. Установите этот флажок, чтобы остановить сбор событий по целевому объекту pair_matching при нехватке свободной памяти. Как только памяти будет достаточно, сбор событий продолжится.<br /><br /> **Максимальное число потерянных событий**. Укажите максимальное число потерянных событий, которые необходимо хранить в памяти.|  
    |**ring_buffer**|**Число событий, которые необходимо хранить**. С помощью стрелок вверх и вниз задайте число событий, которые необходимо сохранять. Значение по умолчанию — 1000.<br /><br /> **Максимальный размер буферной памяти**. Введите максимальный объем используемой памяти. При достижении этого значения существующие события будут удалены. Объем памяти по умолчанию равен 0 МБ, объем памяти неограничен. Другую единицу хранения можно выбрать в раскрывающемся списке.<br /><br /> **Оставить заданное число событий (каждого типа) при переполнении буфера**. Выберите этот параметр, чтобы сохранить заданное число событий каждого типа в буфере.<br /><br /> **Число событий, которые необходимо хранить (каждого типа)**. Введите нужное число событий каждого типа, которые необходимо хранить в буфере.|  
  
5.  Чтобы задать дополнительные свойства конфигурации, выберите вкладку **Дополнительно** в разделе **Выбор страницы** .  
  
    > [!NOTE]  
    >  Не нажимайте кнопку **ОК** до завершения создания сеанса событий.  
  
#### <a name="to-set-advanced-configurations"></a>Установка дополнительных параметров  
  
1.  В диалоговом окне «Создание сеанса» в разделе **Выбор страницы** выберите **Дополнительно**.  
  
2.  На странице **Дополнительно** выполните следующие действия, чтобы задать параметры **Режима хранения событий** для сеанса событий.  
  
    1.  **Потеря одиночных событий**. Выберите этот параметр, чтобы разрешить потерю одиночного события.  
  
    2.  **Потеря нескольких событий**. Выберите этот параметр, чтобы разрешить потерю нескольких событий.  
  
    3.  **Без потери событий**. Выберите этот параметр, если требуется предотвратить потерю событий. Выбирать этот параметр не рекомендуется.  
  
        > [!NOTE]  
        >  Некоторые события, например **sqlos.wait_info** , несовместимы с режимом хранения **Без потери событий** .  
  
3.  Чтобы задать параметры **Максимальной задержки диспетчеризации** для сеанса событий, выполните следующие действия.  
  
    1.  **В секундах**. Выберите этот параметр, чтобы увеличить или сократить максимальную задержку диспетчеризации. Задайте максимальную задержку диспетчеризации в секундах с помощью стрелок вверх и вниз.  
  
    2.  **Без ограничений**. Выберите этот параметр, если требуется, чтобы события отправлялись только при заполнении буфера событий.  
  
4.  В поле **Максимальный размер памяти** введите максимальный размер памяти. При достижении этого значения существующие события будут удалены. Другую единицу хранения можно выбрать в раскрывающемся списке.  
  
5.  В поле **Максимальный размер события** введите максимальный размер для событий, размер которых превышает **Максимальный размер памяти**. Этот параметр можно не настраивать, если собирать очень большие события не планируется. Другую единицу хранения можно выбрать в раскрывающемся списке.  
  
6.  Чтобы задать параметры **Режима секционирования памяти** для сеанса событий, выполните следующие действия.  
  
    1.  **Нет**. Выберите этот параметр, если требуется отключить режим секционирования памяти.  
  
    2.  **На узел**. Выберите этот параметр, если требуется выделить память на каждый узел.  
  
    3.  **На ЦП**. Выберите этот параметр, если требуется выделить память на каждый ЦП.  
  
 Чтобы восстановить значения конфигурации по умолчанию для свойств предыдущего сеанса, нажмите кнопку **Восстановить значения по умолчанию**.  
  
## <a name="see-also"></a>См. также:  
 [Создание сеанса расширенных событий с помощью редактора запросов](../../2014/database-engine/create-an-extended-events-session-using-query-editor.md)   
 [Создание сеанса расширенных событий с помощью мастера &#40;обозревателе объектов&#41;](../ssms/object/object-explorer.md)   
 [создать скрипт сеанса расширенных событий](../../2014/database-engine/script-an-extended-event-session.md)  
  
  
