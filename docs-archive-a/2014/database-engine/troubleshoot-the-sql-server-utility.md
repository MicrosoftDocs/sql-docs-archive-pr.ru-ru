---
title: Устранение неполадок служебная программа SQL Server | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
ms.assetid: f5f47c2a-38ea-40f8-9767-9bc138d14453
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: 3c139f9f084374aeb711e905ac0c315acc25c6ac
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87735534"
---
# <a name="troubleshoot-the-sql-server-utility"></a><span data-ttu-id="cf5cf-102">Устранение неполадок служебной программы SQL Server</span><span class="sxs-lookup"><span data-stu-id="cf5cf-102">Troubleshoot the SQL Server Utility</span></span>
  <span data-ttu-id="cf5cf-103">При устранении неполадок служебной программы [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] может понадобиться устранить причину ошибок при регистрации экземпляра SQL Server в пункте управления программой, устранить неполадки, связанные с ошибками при сборе данных и вызывающие отображение серых значков в представлении списка управляемых экземпляров в пункте управления программой, устранить «узкие места» производительности или разрешить проблемы, связанные с исправностью ресурсов.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-103">Troubleshooting [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Utility issues might include resolving a failed operation to enroll an instance of SQL Server with a UCP, troubleshooting failed data collection resulting in gray icons in the managed instance list view on a UCP, mitigating performance bottlenecks, or resolving resource health issues.</span></span> <span data-ttu-id="cf5cf-104">Дополнительные сведения об устранении проблем с работоспособностью ресурсов, обнаруженных в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] точке управления служебной программой, см. в разделе [Устранение неполадок SQL Server Работоспособность ресурсов &#40;служебная программа SQL Server&#41;](../relational-databases/manage/troubleshoot-sql-server-resource-health-sql-server-utility.md).</span><span class="sxs-lookup"><span data-stu-id="cf5cf-104">For more information about mitigating resource health issues identified by a [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] UCP, see [Troubleshoot SQL Server Resource Health &#40;SQL Server Utility&#41;](../relational-databases/manage/troubleshoot-sql-server-resource-health-sql-server-utility.md).</span></span>  
  
## <a name="failed-operation-to-enroll-an-instance-of-sql-server-into-a-sql-server-utility"></a><span data-ttu-id="cf5cf-105">Неудачная операция регистрации экземпляра SQL Server в служебной программе SQL Server</span><span class="sxs-lookup"><span data-stu-id="cf5cf-105">Failed Operation to Enroll an Instance of SQL Server into a SQL Server Utility</span></span>  
 <span data-ttu-id="cf5cf-106">Если при подключении к экземпляру [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] для регистрации используется проверка подлинности [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , а указанная при этом учетная запись-посредник принадлежит домену Active Directory, отличному от домена, в котором находится пункт управления программой, то проверка экземпляра завершится успешно, но во время операции регистрации произойдет ошибка и отобразится следующее сообщение об ошибке:</span><span class="sxs-lookup"><span data-stu-id="cf5cf-106">If you connect to the instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to enroll using [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Authentication, and you specify a proxy account that belongs to a different Active Directory domain than the domain where the UCP is located, instance validation succeeds, but the enrollment operation fails with the following error message:</span></span>  
  
 <span data-ttu-id="cf5cf-107">Возникло исключение при выполнении пакета или инструкции Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-107">An exception occurred while executing a Transact-SQL statement or batch.</span></span> <span data-ttu-id="cf5cf-108">(Microsoft.SqlServer.ConnectionInfo)</span><span class="sxs-lookup"><span data-stu-id="cf5cf-108">(Microsoft.SqlServer.ConnectionInfo)</span></span>  
  
 <span data-ttu-id="cf5cf-109">Дополнительные сведения:  Не удалось получить сведения о пользователе/группе Windows NT «\<DomainName\AccountName>», код ошибки 0x5.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-109">Additional information:  Could not obtain information about Windows NT group/user '\<DomainName\AccountName>', error code 0x5.</span></span> <span data-ttu-id="cf5cf-110">(Microsoft SQL Server, ошибка: 15404)</span><span class="sxs-lookup"><span data-stu-id="cf5cf-110">(Microsoft SQL Server, Error: 15404)</span></span>  
  
 <span data-ttu-id="cf5cf-111">Например, эта проблема может возникнуть в следующих сценариях.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-111">This issue occurs in the following example scenario:</span></span>  
  
1.  <span data-ttu-id="cf5cf-112">Пункт управления программой входит в «Домен_1».</span><span class="sxs-lookup"><span data-stu-id="cf5cf-112">The UCP is a member of "Domain_1."</span></span>  
  
2.  <span data-ttu-id="cf5cf-113">Между доменами существует одностороннее отношение доверия, то есть «Домен_1» не является доверенным для «Домен_2», но «Домен_2» является доверенным для «Домен_1».</span><span class="sxs-lookup"><span data-stu-id="cf5cf-113">A one-way domain trust relationship is in place: that is, "Domain_1" is not trusted by "Domain_2" but "Domain_2" is trusted by "Domain_1."</span></span>  
  
3.  <span data-ttu-id="cf5cf-114">Экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , который следует зарегистрировать в служебной программе [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , также входит в «Домен_1».</span><span class="sxs-lookup"><span data-stu-id="cf5cf-114">The instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to enroll into the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Utility is also a member of "Domain_1."</span></span>  
  
4.  <span data-ttu-id="cf5cf-115">Во время операции регистрации подключитесь к экземпляру [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] для регистрации с помощью "SA".</span><span class="sxs-lookup"><span data-stu-id="cf5cf-115">During the enroll operation, connect to the instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to enroll using "sa".</span></span> <span data-ttu-id="cf5cf-116">Укажите учетную запись-посредник из домена «Домен_2».</span><span class="sxs-lookup"><span data-stu-id="cf5cf-116">Specify a proxy account from "Domain_2."</span></span>  
  
5.  <span data-ttu-id="cf5cf-117">Проверка пройдет успешно, но при регистрации возникнет ошибка.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-117">Validation succeeds but enrollment fails.</span></span>  
  
 <span data-ttu-id="cf5cf-118">Чтобы решить эту проблему, используйте приведенный выше пример, чтобы подключиться к экземпляру [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] для регистрации в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] программе с помощью "SA" и предоставить учетную запись-посредник из "Domain_1".</span><span class="sxs-lookup"><span data-stu-id="cf5cf-118">The workaround for this issue, using the example above, is to connect to the instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to enroll into the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Utility using "sa" and provide a proxy account from "Domain_1."</span></span>  
  
## <a name="failed-wmi-validation"></a><span data-ttu-id="cf5cf-119">Сбой проверки WMI</span><span class="sxs-lookup"><span data-stu-id="cf5cf-119">Failed WMI Validation</span></span>  
 <span data-ttu-id="cf5cf-120">Если в экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]WMI настроена неправильно, то при операциях создания пункта управления программой и регистрации управляемого экземпляра будет отображаться предупреждение, но операция не будет прервана.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-120">If WMI is not properly configured on an instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], the Create UCP and Enroll Managed Instance operations display a warning, but the operation is not blocked.</span></span> <span data-ttu-id="cf5cf-121">Кроме того, при изменении настройки учетной записи агента [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] таким образом, что у агента [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] будут отсутствовать разрешения на доступ к требуемым классам WMI, передача собираемых данных из затронутого изменением управляемого экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] в пункте управления программой прекратится.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-121">Additionally, if you change the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Agent account configuration so that [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Agent does not have permission to required WMI classes, data collection on the affected managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] fails to upload to the UCP.</span></span> <span data-ttu-id="cf5cf-122">В результате в пункте управления программой будет отображаться серый значок.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-122">This results in gray icons in the UCP.</span></span>  
  
 <span data-ttu-id="cf5cf-123">Сбой при сборе данных вызывает отображение серых значков состояния в списке пункта управления программой для затронутых управляемых экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="cf5cf-123">Failed data collection results in gray status icons in the UCP list view for affected managed instances of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="cf5cf-124">Из журнала выполняемых заданий на управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] будет видно, что в sysutility_mi_collect_and_upload происходит сбой на шаге 2 (сбор данных из скрипта PowerShell).</span><span class="sxs-lookup"><span data-stu-id="cf5cf-124">The job history on the managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] shows that sysutility_mi_collect_and_upload fails on step 2 (Stage Data Collected from PowerShell Script).</span></span>  
  
 <span data-ttu-id="cf5cf-125">Возможны следующие сокращенные сообщения об ошибках.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-125">The simplified error messages are:</span></span>  
  
 <span data-ttu-id="cf5cf-126">Выполнение команды прервано, так как для переменной среды "ErrorActionPreference" установлено значение Stop: Access denied.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-126">Command execution stopped because the shell variable "ErrorActionPreference" is set to Stop: Access denied.</span></span>  
  
 <span data-ttu-id="cf5cf-127">Ошибка: \<Date-time (MM/DD/YYYY HH:MM:SS)> : перехвачено исключение при сборе свойств ЦП.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-127">ERROR: \<Date-time (MM/DD/YYYY HH:MM:SS)>: Caught exception while collecting cpu properties.</span></span>  <span data-ttu-id="cf5cf-128">Возможно, произошла ошибка запроса WMI.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-128">A WMI query might have failed.</span></span>  <span data-ttu-id="cf5cf-129">ВНИМАНИЕ.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-129">WARNING.</span></span>  
  
 <span data-ttu-id="cf5cf-130">Чтобы устранить эту проблему, проверьте следующие параметры конфигурации.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-130">To resolve this issue, verify the following configuration settings:</span></span>  
  
-   <span data-ttu-id="cf5cf-131">В Windows Server 2003 служебная учетная запись службы агента SQL Server должна быть членом группы наблюдения за производительностью Windows в управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="cf5cf-131">On Windows Server 2003, the SQL Server Agent service must be part of the Windows Performance Monitoring group on the managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="cf5cf-132">Служба WMI в управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]должна быть включена и настроена.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-132">The WMI service must be enabled and configured on the managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="cf5cf-133">Возможно, репозиторий WMI на управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]поврежден.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-133">The WMI repository might be corrupt on the managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="cf5cf-134">Возможно, библиотека производительности на управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]повреждена или отсутствует.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-134">The performance library might be missing or corrupt on the managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="cf5cf-135">Чтобы проверить правильность настройки указанного экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] для передачи данных в пункт управления программой, убедитесь, что указанные ниже классы присутствуют на указанном экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]и доступны для учетной записи службы агента SQL Server.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-135">To verify that the specified instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] is configured properly to report data to the UCP, verify that the following classes are available on the specified instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], and that they are accessible to SQL Server Agent service account:</span></span>  
  
-   <span data-ttu-id="cf5cf-136">Win32_MountPoint</span><span class="sxs-lookup"><span data-stu-id="cf5cf-136">Win32_MountPoint</span></span>  
  
-   <span data-ttu-id="cf5cf-137">Win32_PerfRawData_PerfProc_Process</span><span class="sxs-lookup"><span data-stu-id="cf5cf-137">Win32_PerfRawData_PerfProc_Process</span></span>  
  
-   <span data-ttu-id="cf5cf-138">Win32_PerfRawData_PerfOS_Processor</span><span class="sxs-lookup"><span data-stu-id="cf5cf-138">Win32_PerfRawData_PerfOS_Processor</span></span>  
  
-   <span data-ttu-id="cf5cf-139">Win32_Processor</span><span class="sxs-lookup"><span data-stu-id="cf5cf-139">Win32_Processor</span></span>  
  
-   <span data-ttu-id="cf5cf-140">Win32_Volume</span><span class="sxs-lookup"><span data-stu-id="cf5cf-140">Win32_Volume</span></span>  
  
-   <span data-ttu-id="cf5cf-141">Win32_LogicalDisk</span><span class="sxs-lookup"><span data-stu-id="cf5cf-141">Win32_LogicalDisk</span></span>  
  
 <span data-ttu-id="cf5cf-142">Проверить доступность каждого из классов можно, применив командлет PowerShell Get-WmiObject к этому классу.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-142">You can use the Get-WmiObject PowerShell cmdlet on each of the classes to verify that each class is accessible.</span></span> <span data-ttu-id="cf5cf-143">Выполните следующие командлеты в управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="cf5cf-143">Run the following cmdlets on the managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>  
  
```  
Get-WmiObject Win32_MountPoint -ErrorAction Stop | Out-Null  
Get-WmiObject Win32_PerfRawData_PerfProc_Process -ErrorAction Stop| Out-Null  
Get-WmiObject Win32_PerfRawData_PerfOS_Processor -ErrorAction Stop | Out-Null  
Get-WmiObject Win32_Processor -ErrorAction Stop | Out-Null  
Get-WmiObject Win32_Volume -ErrorAction Stop | Out-Null  
Get-WmiObject Win32_LogicalDisk -ErrorAction Stop | Out-Null  
```  
  
 <span data-ttu-id="cf5cf-144">Дополнительные сведения об устранении неполадок WMI см. на странице [Устранение неполадок WMI](https://go.microsoft.com/fwlink/?LinkId=178250).</span><span class="sxs-lookup"><span data-stu-id="cf5cf-144">For more information about troubleshooting WMI, see [Troubleshooting WMI](https://go.microsoft.com/fwlink/?LinkId=178250).</span></span> <span data-ttu-id="cf5cf-145">Обратите внимание, что запросы при этих операциях служебной программы SQL Server выполняются локально, поэтому сведения по удаленному устранению неполадок и устранению неполадок DCOM в таких случаях неприменимы.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-145">Note that queries in these SQL Server Utility operations are running locally, so the DCOM and remote troubleshooting content does not apply.</span></span>  
  
## <a name="failed-data-collection"></a><span data-ttu-id="cf5cf-146">Сбой сбора данных</span><span class="sxs-lookup"><span data-stu-id="cf5cf-146">Failed Data Collection</span></span>  
 <span data-ttu-id="cf5cf-147">В случае неуспешного завершения событий сбора данных в служебной программе [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] возможны следующие решения:</span><span class="sxs-lookup"><span data-stu-id="cf5cf-147">If [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Utility data collection events fail, consider the following possibilities:</span></span>  
  
-   <span data-ttu-id="cf5cf-148">Не меняйте свойства набора элементов сбора "Сведения о программе" на управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], не включайте и не выключайте сбор данных вручную, так как сбор данных происходит под управлением задания агента программы.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-148">Do not change any properties of the "Utility Information" collection set on a managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], and do not turn data collection on/off manually, as data collection is controlled by a Utility agent job.</span></span>  
  
-   <span data-ttu-id="cf5cf-149">Сбой или отсутствие поддержки проверки WMI.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-149">Failed or unsupported WMI validation.</span></span> <span data-ttu-id="cf5cf-150">Дополнительные сведения см. в подразделе «Сбой проверки WMI» этого раздела.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-150">For more information, see the Failed WMI Validation section earlier in this topic.</span></span>  
  
-   <span data-ttu-id="cf5cf-151">Обновите данные в списке управляемых экземпляров, поскольку данные с точках просмотра служебной программы [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] не обновляются автоматически.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-151">Refresh data in the managed instance list view, as data in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Utility viewpoints does not refresh automatically.</span></span> <span data-ttu-id="cf5cf-152">Чтобы обновить данные, щелкните правой кнопкой мыши узел **Управляемые экземпляры** на панели навигации **Обозревателя программ** и выберите команду **Обновить**либо щелкните правой кнопкой мыши имя экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] в представлении списка и выберите **Обновить**.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-152">To refresh data, right-click the **Managed Instances** node in the **Utility Explorer Navigation** pane, then select **Refresh**, or right-click on the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instance name in the list view, then select **Refresh**.</span></span> <span data-ttu-id="cf5cf-153">Обратите внимание, что после регистрации экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] в UCP до появления первых данных на панели мониторинга и точках просмотра панели содержимого обозревателя программ может пройти до 30 минут.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-153">Note that after an instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] has been enrolled with a UCP, it can take up to 30 minutes for data to first appear in the dashboard and viewpoints in the Utility Explorer content pane.</span></span>  
  
-   <span data-ttu-id="cf5cf-154">С помощью диспетчера конфигурации SQL Server проверьте, что этот экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] работает.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-154">Use SQL Server Configuration Manager to verify that the instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] is running.</span></span>  
  
-   <span data-ttu-id="cf5cf-155">Если произошел сбой передачи или сбора данных в связи со временем ожидания, нужно обновить функцию dbo.fn_sysutility_mi_get_collect_script() в базе данных MSDB.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-155">If data collection or data upload fail due to timeout issues, update the function dbo.fn_sysutility_mi_get_collect_script() in the MSDB database.</span></span> <span data-ttu-id="cf5cf-156">В частности, в функцию «Invoke-BulkCopyCommand()» нужно добавить строку:</span><span class="sxs-lookup"><span data-stu-id="cf5cf-156">Specifically, in the function "Invoke-BulkCopyCommand()" add line:</span></span>  
  
    ```
    $bulkCopy.BulkCopyTimeout=180  
    ```  
  
     <span data-ttu-id="cf5cf-157">По умолчанию время ожидания составляет 30 секунд.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-157">The default timeout value is 30 seconds.</span></span>  
  
-   <span data-ttu-id="cf5cf-158">Если экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] не кластеризован, проверьте, что служба агента [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] работает и настроена на автоматический запуск на UCP и управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="cf5cf-158">If the instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] is not clustered, verify that the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Agent service is running and that the service is set to start automatically on the UCP and on the managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="cf5cf-159">Удостоверьтесь, что для выполнения сбора данных на управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]используется допустимая учетная запись.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-159">Verify that a valid account is being used to run data collection on the managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="cf5cf-160">Например, срок действия пароля может истечь.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-160">For example, the password may have expired.</span></span> <span data-ttu-id="cf5cf-161">Если срок действия пароля к учетной записи-посреднику истек, обновите пароль учетных данных в среде SSMS следующим образом.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-161">If the proxy password has expired, update password credentials in SSMS, as follows:</span></span>  
  
    1.  <span data-ttu-id="cf5cf-162">В **обозревателе объектов**среды SSMS разверните узел **Безопасность** , а затем узел **Учетные данные** .</span><span class="sxs-lookup"><span data-stu-id="cf5cf-162">In SSMS **Object Explorer**, expand the **Security** node, then expand the **Credentials** node.</span></span>  
  
    2.  <span data-ttu-id="cf5cf-163">Щелкните правой кнопкой мыши \*\*UtilityAgentProxyCredential_ \<GUID> \*\* и выберите пункт **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-163">Right-click on **UtilityAgentProxyCredential_\<GUID>** and select **Properties**.</span></span>  
  
    3.  <span data-ttu-id="cf5cf-164">В диалоговом окне Свойства учетных данных обновите учетные данные, необходимые для \*\*UtilityAgentProxyCredential_ \<GUID> \*\* учетных данных.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-164">On the Credential Properties dialog, update credentials as necessary for the **UtilityAgentProxyCredential_\<GUID>** credential.</span></span>  
  
    4.  <span data-ttu-id="cf5cf-165">Нажмите кнопку **ОК**, чтобы подтвердить изменение.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-165">Click **OK** to confirm the change.</span></span>  
  
-   <span data-ttu-id="cf5cf-166">В пункте управления программой и управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]должен быть включен протокол TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-166">TCP/IP should be enabled on the UCP and on the managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="cf5cf-167">Включите протокол TCP/IP с помощью диспетчера конфигурации [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="cf5cf-167">Enable TCP/IP through [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Configuration Manager.</span></span>  
  
-   <span data-ttu-id="cf5cf-168">Служба обозревателя SQL Server должна быть запущена на UCP и настроена для автоматического запуска.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-168">The SQL Server Browser service on the UCP should be started and configured to start automatically.</span></span> <span data-ttu-id="cf5cf-169">Если в организации запрещено использование службы обозревателя SQL Server, то для обеспечения подключения управляемого экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] к UCP выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-169">If your organization prevents use of the SQL Server Browser service, use the following steps to allow a managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to connect to the UCP:</span></span>  
  
    1.  <span data-ttu-id="cf5cf-170">На панели задач Windows на управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] нажмите кнопку **Пуск**и выберите команду **выполнить...**.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-170">On the Windows taskbar on the managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], click **Start**, then click **Run...**.</span></span>  
  
    2.  <span data-ttu-id="cf5cf-171">Введите «cliconfg.exe» в соответствующем поле и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-171">Type "cliconfg.exe" in the space provided, then click **OK**.</span></span>  
  
    3.  <span data-ttu-id="cf5cf-172">При запросе разрешить запуск «Средства настройки клиента SQL» нажмите кнопку**Продолжить**.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-172">If prompted to allow "SQL Client Configuration Utility EXE" to start, click "**Continue**."</span></span>  
  
    4.  <span data-ttu-id="cf5cf-173">В диалоговом окне **SQL Server клиентская сетевая программа** » перейдите на вкладку **псевдоним** и нажмите кнопку **Добавить...**.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-173">On the **SQL Server Client Network Utility** dialog box, select the **Alias** tab, then click **Add...**.</span></span>  
  
    5.  <span data-ttu-id="cf5cf-174">В диалоговом окне **Добавление конфигурации сетевой библиотеки** .</span><span class="sxs-lookup"><span data-stu-id="cf5cf-174">On the **Add Network Library Configuration** dialog box:</span></span>  
  
    6.  <span data-ttu-id="cf5cf-175">В списке сетевых библиотек укажите TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-175">Specify TCP/IP from the list of network libraries.</span></span>  
  
    7.  <span data-ttu-id="cf5cf-176">В текстовом поле **Псевдоним сервера** укажите «ИмяКомпьютера\ИмяЭкземпляра UCP».</span><span class="sxs-lookup"><span data-stu-id="cf5cf-176">Specify the ComputerName\InstanceName of the UCP in the **Server Alias** text box.</span></span>  
  
    8.  <span data-ttu-id="cf5cf-177">В текстовом поле **Имя сервера** укажите «ИмяКомпьютера UCP».</span><span class="sxs-lookup"><span data-stu-id="cf5cf-177">Specify the ComputerName of the UCP in the **Server Name** text box.</span></span>  
  
    9. <span data-ttu-id="cf5cf-178">Снимите флажок **Определять порт динамически** .</span><span class="sxs-lookup"><span data-stu-id="cf5cf-178">Uncheck the **Dynamically determine port** checkbox.</span></span>  
  
    10. <span data-ttu-id="cf5cf-179">В текстовом поле **Номер порта** укажите номер порта, который прослушивает UCP.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-179">Specify the port number that the UCP is listening on in the **Port number** text box.</span></span>  
  
    11. <span data-ttu-id="cf5cf-180">Нажмите кнопку **ОК** , чтобы сохранить внесенные изменения.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-180">Click **OK** to save your changes.</span></span>  
  
    12. <span data-ttu-id="cf5cf-181">Повторите эти действия для каждого управляемого экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , который подключается к UCP при выключенной службе обозревателя SQL Server.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-181">Repeat these steps for each managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] that connects to a UCP where the SQL Server Browser service is not enabled.</span></span>  
  
-   <span data-ttu-id="cf5cf-182">Управляемые экземпляры [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] должны быть подключены к сети.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-182">Ensure that managed instances of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] are connected to the network.</span></span>  
  
-   <span data-ttu-id="cf5cf-183">При наличии на управляемом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]баз данных с таким же именем, но другими параметрами учета регистра идентификация между базой данных и ее точками просмотра может быть неверной, в результате чего могут возникнуть ошибки при сборе данных.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-183">If there are databases with the same name but different case-sensitivity settings on a managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], the identification between the database and its viewpoints can be incorrect, resulting in failed data collection.</span></span> <span data-ttu-id="cf5cf-184">Например, база данных «МОЯБАЗАДАННЫХ» может показывать состояния исправности базы данных «МояБазаДанных».</span><span class="sxs-lookup"><span data-stu-id="cf5cf-184">For example, a database named "MYDATABASE" might show health states for a database named "MyDatabase".</span></span> <span data-ttu-id="cf5cf-185">В этом сценарии ошибки не формируются.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-185">No error is generated in this scenario.</span></span> <span data-ttu-id="cf5cf-186">Ошибки при сборе данных также могут возникнуть при несоответствиях учета регистра и в других отображаемых в пункте управления программой объектах, таких как имена файлов баз данных и групп файлов.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-186">Failed data collection can also result from case-sensitivity mismatches in other objects displayed in the UCP, like database file and file group names.</span></span>  
  
-   <span data-ttu-id="cf5cf-187">Если управляемый экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] расположен на компьютере под управлением Windows Server 2003, то учетная запись службы агента [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] должна входить в группу безопасности пользователей системного монитора или группу локальных администраторов.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-187">If a managed instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] is hosted on a Windows Server 2003 computer, then the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Agent service account must belong to the Performance Monitor Users security group or the local Administrators group.</span></span> <span data-ttu-id="cf5cf-188">В противном случае сбор данных выполнить не удастся из-за отказа в доступе.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-188">Otherwise, data collection will fail with an access denied error.</span></span> <span data-ttu-id="cf5cf-189">Чтобы добавить учетную запись службы агента [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] в группу безопасности пользователей системного монитора, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-189">To add a [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Agent service account to the Performance Monitor Users security group, use the following steps:</span></span>  
  
    1.  <span data-ttu-id="cf5cf-190">Откройте оснастку **Управление компьютером**, затем **Локальные пользователи и группы**, выберите **Группы**.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-190">Open **Computer Management**, then **Local Users and Groups**, then **Groups**.</span></span>  
  
    2.  <span data-ttu-id="cf5cf-191">Щелкните правой кнопкой мыши **Пользователи системного монитора** и выберите **Добавить в группу**.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-191">Right-click **Performance Monitor Users** and select **Add to Group**.</span></span>  
  
    3.  <span data-ttu-id="cf5cf-192">Нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-192">Click **Add**.</span></span>  
  
    4.  <span data-ttu-id="cf5cf-193">Введите учетную запись, под которой работает служба агента SQL Server, и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="cf5cf-193">Enter the account that the SQL Server Agent service is running under, then click **OK**.</span></span>  
  
    5.  <span data-ttu-id="cf5cf-194">Если экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] уже был зарегистрирован в UCP до добавления пользователя в эту группу, перезапустите службу агента [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="cf5cf-194">If the instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] was already enrolled with the UCP before adding the user to this group, restart the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Agent service.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cf5cf-195">См. также:</span><span class="sxs-lookup"><span data-stu-id="cf5cf-195">See Also</span></span>  
 <span data-ttu-id="cf5cf-196">[Функции и задачи служебной программы SQL Server](../relational-databases/manage/sql-server-utility-features-and-tasks.md) </span><span class="sxs-lookup"><span data-stu-id="cf5cf-196">[SQL Server Utility Features and Tasks](../relational-databases/manage/sql-server-utility-features-and-tasks.md) </span></span>  
 [<span data-ttu-id="cf5cf-197">Устранение неполадок исправности ресурсов SQL Server (служебная программа SQL Server)</span><span class="sxs-lookup"><span data-stu-id="cf5cf-197">Troubleshoot SQL Server Resource Health &#40;SQL Server Utility&#41;</span></span>](../relational-databases/manage/troubleshoot-sql-server-resource-health-sql-server-utility.md)
