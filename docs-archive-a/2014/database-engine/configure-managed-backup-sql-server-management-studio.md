---
title: Настройка управляемого резервного копирования (SQL Server Management Studio) | Документация Майкрософт
description: Используйте диалоговое окно управляемое резервное копирование, чтобы настроить параметр SQL Server управляемое резервное копирование в Azure по умолчанию. Узнайте о параметрах, которые необходимо учитывать.
ms.custom: ''
ms.date: 08/23/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
f1_keywords:
- sql12.swb.managedbackup.configure.f1
ms.assetid: 79397cf6-0611-450a-b0d8-e784a76e3091
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: e952ef1102ac67bd0ed9f72d0c201d54b320b5ca
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87654504"
---
# <a name="configure-managed-backup-sql-server-management-studio"></a><span data-ttu-id="264df-104">Настройка управляемого резервного копирования (SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="264df-104">Configure Managed Backup (SQL Server Management Studio)</span></span>
  <span data-ttu-id="264df-105">Диалоговое окно **управляемое резервное копирование** позволяет настроить [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] значения по умолчанию для экземпляра.</span><span class="sxs-lookup"><span data-stu-id="264df-105">The **Managed Backup** dialog allows you to configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] defaults for the instance.</span></span> <span data-ttu-id="264df-106">В этом разделе описывается, как использовать это диалоговое окно для настройки значений [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] по умолчанию для экземпляра, а также рассматриваются параметры, которые необходимо учитывать при этом.</span><span class="sxs-lookup"><span data-stu-id="264df-106">This topic describes how to use this dialog to configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] default settings for the instance and options you must consider when doing so.</span></span> <span data-ttu-id="264df-107">Если для экземпляра настроен [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], параметры применяются для любой новой базы данных, создаваемой в дальнейшем.</span><span class="sxs-lookup"><span data-stu-id="264df-107">When [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is configured for the instance, the settings are applied to any new database created thereafter.</span></span>  
  
 <span data-ttu-id="264df-108">Если вы хотите настроить [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] для конкретной базы данных, см. статью [Включение и настройка SQL Server управляемого резервного копирования в Azure для базы данных](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-retention-and-storage-settings.md#DatabaseConfigure).</span><span class="sxs-lookup"><span data-stu-id="264df-108">If you want to configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for a specific database, see [Enable and Configure SQL Server Managed Backup to Azure for a Database](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-retention-and-storage-settings.md#DatabaseConfigure).</span></span>  
 
> [!NOTE] 
> <span data-ttu-id="264df-109">Управляемое резервное копирование SQL Server не поддерживается для прокси-серверов.</span><span class="sxs-lookup"><span data-stu-id="264df-109">SQL Server Managed Backup is not supported with proxy servers.</span></span> 
  
## <a name="task-list"></a><span data-ttu-id="264df-110">Список задач</span><span class="sxs-lookup"><span data-stu-id="264df-110">Task List</span></span>  
  
## <a name="ss_smartbackup-functions-using-managed-backup-interface-in-sql-server-management-studio"></a><span data-ttu-id="264df-111">Функции [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], использующие интерфейс управляемого резервного копирования в SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="264df-111">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] Functions Using Managed Backup Interface in SQL Server Management Studio</span></span>  
 <span data-ttu-id="264df-112">В этом выпуске можно настроить параметры по умолчанию на уровне экземпляра с помощью интерфейса **резервного копирования управления** .</span><span class="sxs-lookup"><span data-stu-id="264df-112">In this release, you can only configure instance level default settings using the **Management Backup** interface.</span></span> <span data-ttu-id="264df-113">Невозможно настроить [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] для базы данных, приостановить или возобновить операции [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] или настроить уведомления по почте.</span><span class="sxs-lookup"><span data-stu-id="264df-113">You cannot configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for a database, pause or resume [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] operations, or setup email notifications.</span></span> <span data-ttu-id="264df-114">Сведения о том, как выполнять операции, не поддерживаемые в **управляемом интерфейсе резервного копирования** , см. в разделе [SQL Server управляемое резервное копирование в Azure — параметры хранения и хранилища](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-retention-and-storage-settings.md).</span><span class="sxs-lookup"><span data-stu-id="264df-114">For information on how to perform operations not currently supported through the **Managed Backup** interface, see [SQL Server Managed Backup to Azure - Retention and Storage Settings](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-retention-and-storage-settings.md).</span></span>  
  
## <a name="permissions"></a><span data-ttu-id="264df-115">Разрешения</span><span class="sxs-lookup"><span data-stu-id="264df-115">Permissions</span></span>  
 <span data-ttu-id="264df-116">**SQL Server Management Studio Просмотреть управляемый узел резервного копирования:** Для просмотра **управляемого узла резервного копирования** в **обозревателе объектов**необходимо быть системным администратором или иметь следующие разрешения, специально предоставленные учетной записи пользователя:</span><span class="sxs-lookup"><span data-stu-id="264df-116">**View Managed Backup Node is SQL Server Management Studio:** To view  **Managed Backup** node in **Object Explorer**, you must either be a System Admin or have the following permissions specifically granted to your user account:</span></span>  
  
-   `db_backupoperator`  
  
-   `VIEW SERVER STATE`  
  
-   `ALTER ANY CREDENTIAL`  
  
-   `VIEW ANY DEFINITION`  
  
-   <span data-ttu-id="264df-117">`EXECUTE` в `smart_admin.fn_is_master_switch_on`.</span><span class="sxs-lookup"><span data-stu-id="264df-117">`EXECUTE` on `smart_admin.fn_is_master_switch_on`.</span></span>  
  
-   <span data-ttu-id="264df-118">`SELECT` в `smart_admin.fn_backup_instance_config`.</span><span class="sxs-lookup"><span data-stu-id="264df-118">`SELECT` on `smart_admin.fn_backup_instance_config`.</span></span>  
  
 <span data-ttu-id="264df-119">**Настройка управляемого резервного копирования:** для настройки [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] в SQL Server Management Studio необходимо быть системным администратором или иметь следующие разрешения.</span><span class="sxs-lookup"><span data-stu-id="264df-119">**To Configure Managed Backup:** to configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] in SQL Server Management Studio, you must be a System Administrator or have the following permissions:</span></span>  
  
 <span data-ttu-id="264df-120">Членство в роли базы данных `db_backupoperator` с разрешениями `ALTER ANY CREDENTIAL` и разрешениями `EXECUTE` для хранимой процедуры `sp_delete_backuphistory`.</span><span class="sxs-lookup"><span data-stu-id="264df-120">Membership in `db_backupoperator` database role, with `ALTER ANY CREDENTIAL` permissions, and `EXECUTE` permissions on `sp_delete_backuphistory` stored procedure.</span></span>  
  
 <span data-ttu-id="264df-121">`SELECT`разрешения на `smart_admin.fn_get_current_xevent_settings` функцию.</span><span class="sxs-lookup"><span data-stu-id="264df-121">`SELECT` permissions on the `smart_admin.fn_get_current_xevent_settings` function.</span></span>  
  
 <span data-ttu-id="264df-122">`EXECUTE`разрешения на `smart_admin.sp_get_backup_diagnostics` хранимую процедуру.</span><span class="sxs-lookup"><span data-stu-id="264df-122">`EXECUTE` permissions on the `smart_admin.sp_get_backup_diagnostics` stored procedure.</span></span> <span data-ttu-id="264df-123">Кроме того, необходимы разрешения `VIEW SERVER STATE`, так как процедура автоматически вызывает другие системные объекты, которым требуется это разрешение.</span><span class="sxs-lookup"><span data-stu-id="264df-123">In addition, it requires `VIEW SERVER STATE` permissions as it internally calls other system objects that require this permission.</span></span>  
  
 <span data-ttu-id="264df-124">Разрешения `EXECUTE` для `smart_admin.sp_set_instance_backup` и `smart_admin.sp_backup_master_switch`.</span><span class="sxs-lookup"><span data-stu-id="264df-124">`EXECUTE` permissions on `smart_admin.sp_set_instance_backup`, and `smart_admin.sp_backup_master_switch`.</span></span>  
  
## <a name="configure-ss_smartbackup-using-sql-server-management-studio"></a><span data-ttu-id="264df-125">Настройка [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] с помощью среды SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="264df-125">Configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] using SQL Server Management Studio</span></span>  
 <span data-ttu-id="264df-126">В **обозревателе объектов**разверните узел **Управление** и щелкните правой кнопкой мыши **управляемое резервное копирование**.</span><span class="sxs-lookup"><span data-stu-id="264df-126">From the **object explorer**, expand the **Management** node, and right click on **Managed Backup**.</span></span> <span data-ttu-id="264df-127">Нажмите кнопку **Настроить**.</span><span class="sxs-lookup"><span data-stu-id="264df-127">Select **Configure**.</span></span> <span data-ttu-id="264df-128">Откроется диалоговое окно **Управляемое резервное копирование** .</span><span class="sxs-lookup"><span data-stu-id="264df-128">This opens the **Managed Backup** dialog.</span></span>  
  
 <span data-ttu-id="264df-129">Установите флажок **Включить управляемое резервное копирование** и укажите значения конфигурации.</span><span class="sxs-lookup"><span data-stu-id="264df-129">Check **Enable Managed Backup** option and specify the configuration values:</span></span>  
  
 <span data-ttu-id="264df-130">**Срок хранения файла** указывается в днях и должен находиться в диапазоне от 1 до 30.</span><span class="sxs-lookup"><span data-stu-id="264df-130">The **File retention** period is specified in days and should be between 1 and 30.</span></span>  
  
 <span data-ttu-id="264df-131">Выбранные **учетные данные SQL** должны соответствовать учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="264df-131">The **SQL Credential** you select should match the storage account.</span></span> <span data-ttu-id="264df-132">Если в настоящее время у вас нет учетных данных SQL, в которых хранятся данные проверки подлинности, можно создать ее, нажав кнопку **создать**.</span><span class="sxs-lookup"><span data-stu-id="264df-132">If you currently do not have a SQL Credential that stores the authentication information, you can create one by clicking **Create**.</span></span> <span data-ttu-id="264df-133">Вы также можете создать учетные данные с помощью инструкции CREATE CREDENTIAL Transact-SQL. При этом укажите имя учетной записи хранения для удостоверения и ключ доступа для параметров SECRET.</span><span class="sxs-lookup"><span data-stu-id="264df-133">You can also create credential by using the CREATE CREDENTIAL Transact-SQL statement, and provide the storage account name for Identity and the access key for the SECRET parameters.</span></span> <span data-ttu-id="264df-134">Дополнительные сведения см. [в разделе Создание учетных данных](../relational-databases/backup-restore/sql-server-backup-to-url.md#credential).</span><span class="sxs-lookup"><span data-stu-id="264df-134">For more information, see [Create a Credential](../relational-databases/backup-restore/sql-server-backup-to-url.md#credential).</span></span>  
  
 <span data-ttu-id="264df-135">Укажите **URL-адрес хранилища** для учетной записи хранения Azure, учетные данные SQL, в которых хранятся данные проверки подлинности для учетной записи хранения, а также срок хранения файлов резервной копии.</span><span class="sxs-lookup"><span data-stu-id="264df-135">Specify the **Storage URL** for the Azure storage account, the SQL Credential that stores the authentication information for the storage account, and the retention period for the backup files.</span></span>  
  
 <span data-ttu-id="264df-136">Формат URL-адреса хранилища: https:// \<StorageAccount> . BLOB.Core.Windows.NET/</span><span class="sxs-lookup"><span data-stu-id="264df-136">The storage URL format is: https://\<StorageAccount>.blob.core.windows.net/</span></span>  
  
 <span data-ttu-id="264df-137">Чтобы задать параметры шифрования на уровне экземпляра, установите флажок **шифровать резервную копию** и укажите алгоритм и сертификат или асимметричный ключ, используемые для шифрования.</span><span class="sxs-lookup"><span data-stu-id="264df-137">To set the encryption settings at the instance level, check **Encrypt Backup** option, and specify the algorithm and a Certificate or Asymmetric Key to use for the encryption.</span></span>  <span data-ttu-id="264df-138">Эти параметры устанавливаются на уровне экземпляра и используются для всех создаваемых баз данных после применения этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="264df-138">This is set at the instance level is used for all the new databases created once this configuration has been applied.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="264df-139">Это диалоговое окно не может использоваться для указания параметров шифрования без настройки [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="264df-139">This dialog cannot be used to specify the encryption options without configuring [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="264df-140">Эти параметры шифрования применяются только к операциям [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="264df-140">These encryption options only apply to [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] operations.</span></span> <span data-ttu-id="264df-141">Чтобы использовать шифрование для других процедур резервного копирования, см. раздел [Шифрование резервной копии](../relational-databases/backup-restore/backup-encryption.md).</span><span class="sxs-lookup"><span data-stu-id="264df-141">To use encryption for other backup procedures, see [Backup Encryption](../relational-databases/backup-restore/backup-encryption.md).</span></span>  
  
### <a name="considerations"></a><span data-ttu-id="264df-142">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="264df-142">Considerations</span></span>  
 <span data-ttu-id="264df-143">Если для экземпляра настроен [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], параметры применяются для любой новой базы данных, создаваемой в дальнейшем.</span><span class="sxs-lookup"><span data-stu-id="264df-143">If you configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] at the instance level, the settings are applied to any new database created thereafter.</span></span>  <span data-ttu-id="264df-144">Однако существующая база данных не наследует эти параметры автоматически.</span><span class="sxs-lookup"><span data-stu-id="264df-144">However, existing database will not automatically inherit these settings.</span></span> <span data-ttu-id="264df-145">Чтобы настроить [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] для ранее созданных баз данных, необходимо отдельно настроить каждую базу данных.</span><span class="sxs-lookup"><span data-stu-id="264df-145">To configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] on previously existing databases, you must configure each database specifically.</span></span> <span data-ttu-id="264df-146">Дополнительные сведения см. в статье [Включение и настройка SQL Server управляемого резервного копирования в Azure для базы данных](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-retention-and-storage-settings.md#DatabaseConfigure).</span><span class="sxs-lookup"><span data-stu-id="264df-146">For more information, see [Enable and Configure SQL Server Managed Backup to Azure for a Database](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-retention-and-storage-settings.md#DatabaseConfigure).</span></span>  
  
 <span data-ttu-id="264df-147">Если работа [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] приостановлена с помощью `smart_admin.sp_backup_master_switch` , появится предупреждение "управляемое резервное копирование отключено и текущие конфигурации не вступят в силу..." При попытке завершить настройку.</span><span class="sxs-lookup"><span data-stu-id="264df-147">If [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] has been paused using the `smart_admin.sp_backup_master_switch`, you will see a warning message " Managed Backup is disabled and the current configurations will not take effect..." when you try to complete the configuration.</span></span> <span data-ttu-id="264df-148">Используйте `smart_admin.sp_backup_master_switch` хранимый параметр и задайте значение @new_state = 1.</span><span class="sxs-lookup"><span data-stu-id="264df-148">Use the `smart_admin.sp_backup_master_switch` stored and set the @new_state=1.</span></span> <span data-ttu-id="264df-149">Работа служб [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] будет возобновлена, а параметры конфигурации вступят в силу.</span><span class="sxs-lookup"><span data-stu-id="264df-149">This will resume [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] services and the configuration settings will take into effect.</span></span> <span data-ttu-id="264df-150">Дополнительные сведения о хранимой процедуре см. в разделе [smart_admin. sp_ backup_master_switch &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-master-switch-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="264df-150">For more information on the stored procedure, see [smart_admin.sp_ backup_master_switch &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-master-switch-transact-sql).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="264df-151">См. также:</span><span class="sxs-lookup"><span data-stu-id="264df-151">See Also</span></span>  
 [<span data-ttu-id="264df-152">Управляемое резервное копирование SQL Server в Azure: Возможности взаимодействия и совместной работы</span><span class="sxs-lookup"><span data-stu-id="264df-152">SQL Server Managed Backup to Azure: Interoperability and Coexistence</span></span>](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-interoperability-and-coexistence.md)  
  
  
