---
title: Обновление реплицируемых баз данных | Документы Майкрософт
ms.custom: ''
ms.date: 05/24/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: install
ms.topic: conceptual
helpviewer_keywords:
- merge replication database upgrades [SQL Server replication]
- replication [SQL Server], upgrading
- transactional replication, upgrading databases
- snapshot replication [SQL Server], upgrading databases
- upgrading replicated databases
ms.assetid: 9926a4f7-bcd8-4b9b-9dcf-5426a5857116
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 326a94820876b40128428aac58e47c650ce122b8
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87657859"
---
# <a name="upgrade-replicated-databases"></a><span data-ttu-id="c45c5-102">Обновление реплицируемых баз данных</span><span class="sxs-lookup"><span data-stu-id="c45c5-102">Upgrade Replicated Databases</span></span>
  [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] <span data-ttu-id="c45c5-103">поддерживает обновление реплицируемых баз данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] предыдущих версий, при этом на время обновления узла прекращать работу с другими узлами не требуется.</span><span class="sxs-lookup"><span data-stu-id="c45c5-103">supports upgrading replicated databases from previous versions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]; it is not required to stop activity at other nodes while a node is being upgraded.</span></span> <span data-ttu-id="c45c5-104">Соблюдайте следующие правила, определяющие допустимые версии объектов репликации.</span><span class="sxs-lookup"><span data-stu-id="c45c5-104">Ensure that you adhere to the rules regarding which versions are supported in a topology:</span></span>  
  
-   <span data-ttu-id="c45c5-105">Версия распространителя не должна быть ниже версии издателя (во многих случаях распространителем и издателем является один и тот же экземпляр).</span><span class="sxs-lookup"><span data-stu-id="c45c5-105">A Distributor can be any version as long as it is greater than or equal to the Publisher version (in many cases the Distributor is the same instance as the Publisher).</span></span>  
  
-   <span data-ttu-id="c45c5-106">Версия издателя не должна превышать версию распространителя.</span><span class="sxs-lookup"><span data-stu-id="c45c5-106">A Publisher can be any version as long as it less than or equal to the Distributor version.</span></span>  
  
-   <span data-ttu-id="c45c5-107">Версия подписчика зависит от типа публикации следующим образом.</span><span class="sxs-lookup"><span data-stu-id="c45c5-107">Subscriber version depends on the type of publication:</span></span>  
  
    -   <span data-ttu-id="c45c5-108">Подписчик на публикацию транзакций может иметь любую версию, отличающуюся от версии издателя, но не более, чем на две версии.</span><span class="sxs-lookup"><span data-stu-id="c45c5-108">A Subscriber to a transactional publication can be any version within two versions of the Publisher version.</span></span> <span data-ttu-id="c45c5-109">Например, издатель [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] может работать с подписчиками [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], а издатель [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] — с подписчиками [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c45c5-109">For example: a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] Publisher running can have [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] Subscribers; and a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] Publisher can have [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] Subscribers.</span></span>  
  
    -   <span data-ttu-id="c45c5-110">Версия подписчика на публикацию слиянием не должна превышать версию издателя.</span><span class="sxs-lookup"><span data-stu-id="c45c5-110">A Subscriber to a merge publication can be any version less than or equal to the Publisher version.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c45c5-111">Этот раздел доступен в справочной документации по программе установки, а также в электронной документации по [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="c45c5-111">This topic is available in the Setup Help documentation and in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Books Online.</span></span> <span data-ttu-id="c45c5-112">Ссылки на разделы, выделенные полужирным шрифтом в справке по установке, относятся к разделам, доступным только в электронной документации.</span><span class="sxs-lookup"><span data-stu-id="c45c5-112">Topic links that appear as bold text in the Setup Help documentation refer to topics that are only available in Books Online.</span></span>  
  
## <a name="run-the-log-reader-agent-for-transactional-replication-before-upgrade"></a><span data-ttu-id="c45c5-113">Запуск агента чтения журнала для репликации транзакций перед обновлением</span><span class="sxs-lookup"><span data-stu-id="c45c5-113">Run the Log Reader Agent for Transactional Replication Before Upgrade</span></span>  
 <span data-ttu-id="c45c5-114">Перед обновлением до [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]необходимо убедиться, что все зафиксированные транзакции из опубликованных таблиц были обработаны агентом чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="c45c5-114">Before you upgrade to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], you must make sure that all committed transactions from published tables have been processed by the Log Reader Agent.</span></span> <span data-ttu-id="c45c5-115">Чтобы это обеспечить, для каждой базы данных, содержащей публикации транзакций, необходимо выполнить следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="c45c5-115">To make sure that all transactions have been processed, perform the following steps for each database that contains transactional publications:</span></span>  
  
1.  <span data-ttu-id="c45c5-116">Убедитесь, что в базе данных запущен агент чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="c45c5-116">Make sure that the Log Reader Agent is running for the database.</span></span> <span data-ttu-id="c45c5-117">По умолчанию агент работает постоянно.</span><span class="sxs-lookup"><span data-stu-id="c45c5-117">By default, the agent runs continuously.</span></span>  
  
2.  <span data-ttu-id="c45c5-118">Остановите активность пользователей в опубликованных таблицах.</span><span class="sxs-lookup"><span data-stu-id="c45c5-118">Stop user activity on published tables.</span></span>  
  
3.  <span data-ttu-id="c45c5-119">Подождите, пока агент чтения журнала не скопирует транзакции в базу данных распространителя, затем остановите агент.</span><span class="sxs-lookup"><span data-stu-id="c45c5-119">Allow time for the Log Reader Agent to copy transactions to the distribution database, and then stop the agent.</span></span>  
  
4.  <span data-ttu-id="c45c5-120">Чтобы убедиться, что все транзакции были обработаны, выполните процедуру [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="c45c5-120">Execute [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql) to verify that all transactions have been processed.</span></span> <span data-ttu-id="c45c5-121">Результирующий набор от этой процедуры должен быть пустым.</span><span class="sxs-lookup"><span data-stu-id="c45c5-121">The result set from this procedure should be empty.</span></span>  
  
5.  <span data-ttu-id="c45c5-122">Чтобы закрыть соединение процедуры sp_replcmds, выполните процедуру [sp_replflush](/sql/relational-databases/system-stored-procedures/sp-replflush-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="c45c5-122">Execute [sp_replflush](/sql/relational-databases/system-stored-procedures/sp-replflush-transact-sql) to close the connection from sp_replcmds.</span></span>  
  
6.  <span data-ttu-id="c45c5-123">Выполните обновление сервера до версии [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c45c5-123">Perform the server upgrade to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>  
  
7.  <span data-ttu-id="c45c5-124">Перезапустите агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и агент чтения журнала, если после обновления они не запустятся автоматически.</span><span class="sxs-lookup"><span data-stu-id="c45c5-124">Restart [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent and the Log Reader Agent if they do not start automatically after the upgrade.</span></span>  
  
## <a name="run-agents-for-merge-replication-after-upgrade"></a><span data-ttu-id="c45c5-125">Выполнение агентов для репликации слиянием после обновления</span><span class="sxs-lookup"><span data-stu-id="c45c5-125">Run Agents for Merge Replication After Upgrade</span></span>  
 <span data-ttu-id="c45c5-126">После обновления запустите агент моментальных снимков для каждой публикации слиянием и агент слияния для каждой подписки, чтобы обновить метаданные репликации.</span><span class="sxs-lookup"><span data-stu-id="c45c5-126">After upgrade, run the Snapshot Agent for each merge publication and the Merge Agent for each subscription to update replication metadata.</span></span> <span data-ttu-id="c45c5-127">Применять новый моментальный снимок не требуется, потому что заново инициализировать подписки не нужно.</span><span class="sxs-lookup"><span data-stu-id="c45c5-127">You do not have to apply the new snapshot, because it is not necessary to reinitialize subscriptions.</span></span> <span data-ttu-id="c45c5-128">Метаданные подписки обновляются при первом запуске агента слияния после обновления.</span><span class="sxs-lookup"><span data-stu-id="c45c5-128">Subscription metadata is updated the first time the Merge Agent is run after upgrade.</span></span> <span data-ttu-id="c45c5-129">Это означает, что база данных подписки может оставаться в сети в активном режиме во время обновления издателя.</span><span class="sxs-lookup"><span data-stu-id="c45c5-129">This means that the subscription database can remain online and active during the Publisher upgrade.</span></span>  
  
 <span data-ttu-id="c45c5-130">Механизм репликации слиянием хранит метаданные публикации и подписки в нескольких системных таблицах баз данных публикации и подписки.</span><span class="sxs-lookup"><span data-stu-id="c45c5-130">Merge replication stores publication and subscription metadata in a number of system tables in the publication and subscription databases.</span></span> <span data-ttu-id="c45c5-131">При запуске агента моментальных снимков обновляются метаданные публикации, а при запуске агента слияния — метаданные подписки.</span><span class="sxs-lookup"><span data-stu-id="c45c5-131">Running the Snapshot Agent updates publication metadata and running the Merge Agent updates subscription metadata.</span></span> <span data-ttu-id="c45c5-132">Пользователь должен только сформировать моментальный снимок публикации.</span><span class="sxs-lookup"><span data-stu-id="c45c5-132">It is only required to generate a publication snapshot.</span></span> <span data-ttu-id="c45c5-133">Если при публикации слиянием используются параметризованные фильтры, каждой секции также соответствует моментальный снимок.</span><span class="sxs-lookup"><span data-stu-id="c45c5-133">If a merge publication uses parameterized filters, each partition also has a snapshot.</span></span> <span data-ttu-id="c45c5-134">Обновлять эти секционированные снимки не требуется.</span><span class="sxs-lookup"><span data-stu-id="c45c5-134">It is not necessary to update these partitioned snapshots.</span></span>  
  
 <span data-ttu-id="c45c5-135">Для выполнения агентов можно использовать среду [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], монитор репликации и окно командной строки.</span><span class="sxs-lookup"><span data-stu-id="c45c5-135">Run the agents from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], Replication Monitor, or from the command line.</span></span> <span data-ttu-id="c45c5-136">Дополнительные сведения о выполнении агента моментальных снимков см. в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="c45c5-136">For more information about running the Snapshot Agent, see the following topics:</span></span>  
  
-   [<span data-ttu-id="c45c5-137">Создание и применение исходного моментального снимка</span><span class="sxs-lookup"><span data-stu-id="c45c5-137">Create and Apply the Initial Snapshot</span></span>](../../../2014/relational-databases/replication/create-and-apply-the-initial-snapshot.md)  
  
-   [<span data-ttu-id="c45c5-138">Запуск и остановка агента репликации (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="c45c5-138">Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;</span></span>](../../relational-databases/replication/agents/start-and-stop-a-replication-agent-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="c45c5-139">Создание и применение исходного моментального снимка</span><span class="sxs-lookup"><span data-stu-id="c45c5-139">Create and Apply the Initial Snapshot</span></span>](../../../2014/relational-databases/replication/create-and-apply-the-initial-snapshot.md)  
  
-   [<span data-ttu-id="c45c5-140">Replication Agent Executables Concepts</span><span class="sxs-lookup"><span data-stu-id="c45c5-140">Replication Agent Executables Concepts</span></span>](../../../2014/relational-databases/replication/concepts/replication-agent-executables-concepts.md)  
  
 <span data-ttu-id="c45c5-141">Дополнительные сведения о выполнении агента слияния см. в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="c45c5-141">For more information about running the Merge Agent, see the following topics:</span></span>  
  
-   [<span data-ttu-id="c45c5-142">Синхронизация подписки по запросу</span><span class="sxs-lookup"><span data-stu-id="c45c5-142">Synchronize a Pull Subscription</span></span>](../../../2014/relational-databases/replication/synchronize-a-pull-subscription.md)  
  
-   [<span data-ttu-id="c45c5-143">Синхронизация принудительной подписки</span><span class="sxs-lookup"><span data-stu-id="c45c5-143">Synchronize a Push Subscription</span></span>](../../../2014/relational-databases/replication/synchronize-a-push-subscription.md)  
  
 <span data-ttu-id="c45c5-144">Если после обновления [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в топологии, в которой используется репликация слиянием, необходимо использовать новые возможности, измените уровень совместимости всех публикаций.</span><span class="sxs-lookup"><span data-stu-id="c45c5-144">After upgrading [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] in a topology that uses merge replication, change the publication compatibility level of any publications if you want to use new features.</span></span>  
  
## <a name="upgrading-to-standard-workgroup-or-express-editions"></a><span data-ttu-id="c45c5-145">Обновление до выпусков Standard Edition, Workgroup Edition и Express Edition</span><span class="sxs-lookup"><span data-stu-id="c45c5-145">Upgrading to Standard, Workgroup, or Express Editions</span></span>  
 <span data-ttu-id="c45c5-146">Перед обновлением с одного выпуска [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] до другого проверьте, что используемые функции поддерживаются в выпуске, до которого производится обновление.</span><span class="sxs-lookup"><span data-stu-id="c45c5-146">Before upgrading from one edition of [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] to another, verify that the functionality you are currently using is supported in the edition to which you are upgrading.</span></span> <span data-ttu-id="c45c5-147">Дополнительные сведения см. в разделе о репликации в [функциях, поддерживаемых Выпусками SQL Server 2014](../../../2014/getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span><span class="sxs-lookup"><span data-stu-id="c45c5-147">For more information, see the section on Replication in [Features Supported by the Editions of SQL Server 2014](../../../2014/getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>  
  
## <a name="web-synchronization-for-merge-replication"></a><span data-ttu-id="c45c5-148">Веб-синхронизация для репликации слиянием</span><span class="sxs-lookup"><span data-stu-id="c45c5-148">Web Synchronization for Merge Replication</span></span>  
 <span data-ttu-id="c45c5-149">Для использования веб-синхронизации репликации слиянием необходимо скопировать в виртуальный каталог служб IIS, используемый для синхронизации, прослушиватель репликации [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (replisapi.dll).</span><span class="sxs-lookup"><span data-stu-id="c45c5-149">The Web synchronization option for merge replication requires that the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener (replisapi.dll) be copied to the virtual directory on the Internet Information Services (IIS) server used for synchronization.</span></span> <span data-ttu-id="c45c5-150">При настройке веб-синхронизации этот файл копируется в виртуальный каталог мастером настройки веб-синхронизации.</span><span class="sxs-lookup"><span data-stu-id="c45c5-150">When you configure Web synchronization, the file is copied to the virtual directory by the Configure Web Synchronization Wizard.</span></span> <span data-ttu-id="c45c5-151">Для обновления компонентов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , установленных на сервере IIS, необходимо вручную скопировать библиотеку replisapi.dll из каталога COM в виртуальный каталог сервера IIS.</span><span class="sxs-lookup"><span data-stu-id="c45c5-151">If you upgrade the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] components installed on the IIS server, you must manually copy replisapi.dll from the COM directory to the virtual directory on the IIS server.</span></span> <span data-ttu-id="c45c5-152">Дополнительные сведения о конфигурации см. в статье [Настройка веб-синхронизации](../../../2014/relational-databases/replication/configure-web-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="c45c5-152">For more information about configuring Web synchronization, see [Configure Web Synchronization](../../../2014/relational-databases/replication/configure-web-synchronization.md).</span></span>  
  
## <a name="restoring-a-replicated-database-from-an-earlier-version"></a><span data-ttu-id="c45c5-153">Восстановление из копии реплицированной базы данных из предыдущей версии</span><span class="sxs-lookup"><span data-stu-id="c45c5-153">Restoring a Replicated Database from an Earlier Version</span></span>  
 <span data-ttu-id="c45c5-154">Чтобы обеспечить неизменность параметров репликации при восстановлении реплицированной базы данных, имеющей более раннюю версию, выполните восстановление на сервер и в базу данных, имеющих те же имена, что и у сервера или базы данных, для которых была сделана резервная копия.</span><span class="sxs-lookup"><span data-stu-id="c45c5-154">To ensure replication settings are retained when restoring a backup of a replicated database from a previous version: restore to a server and database with the same names as the server and database at which the backup was taken.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c45c5-155">См. также:</span><span class="sxs-lookup"><span data-stu-id="c45c5-155">See Also</span></span>  
 <span data-ttu-id="c45c5-156">[Вопросы и ответы об администрировании репликации](../../relational-databases/replication/administration/frequently-asked-questions-for-replication-administrators.md) </span><span class="sxs-lookup"><span data-stu-id="c45c5-156">[Replication Administration FAQ](../../relational-databases/replication/administration/frequently-asked-questions-for-replication-administrators.md) </span></span>  
 <span data-ttu-id="c45c5-157">[Обратная совместимость репликации](../../../2014/relational-databases/replication/replication-backward-compatibility.md) </span><span class="sxs-lookup"><span data-stu-id="c45c5-157">[Replication Backward Compatibility](../../../2014/relational-databases/replication/replication-backward-compatibility.md) </span></span>  
 <span data-ttu-id="c45c5-158">[Поддерживаемые обновления версий и выпусков](../../database-engine/install-windows/supported-version-and-edition-upgrades.md) </span><span class="sxs-lookup"><span data-stu-id="c45c5-158">[Supported Version and Edition Upgrades](../../database-engine/install-windows/supported-version-and-edition-upgrades.md) </span></span>  
 [<span data-ttu-id="c45c5-159">Обновление до SQL Server 2014</span><span class="sxs-lookup"><span data-stu-id="c45c5-159">Upgrade to SQL Server 2014</span></span>](upgrade-sql-server.md)  
  
  
