---
title: Зеркальное отображение баз данных и доставка журналов (SQL Server) | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- log shipping [SQL Server], database mirroring
ms.assetid: 53e98134-e274-4dfd-8b72-0cc0fd5c800e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: fe11f4244eff98923a6f4ee291caca9c094237f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87657283"
---
# <a name="database-mirroring-and-log-shipping-sql-server"></a><span data-ttu-id="a225b-102">Зеркальное отображение баз данных и доставка журналов (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="a225b-102">Database Mirroring and Log Shipping (SQL Server)</span></span>
  <span data-ttu-id="a225b-103">Для каждой базы данных может быть создано зеркальное отображение и доставка журналов; они также могут существовать одновременно.</span><span class="sxs-lookup"><span data-stu-id="a225b-103">A given database can be mirrored or log shipped; it can also be simultaneously mirrored and log shipped.</span></span> <span data-ttu-id="a225b-104">При выборе подхода примите во внимание следующее.</span><span class="sxs-lookup"><span data-stu-id="a225b-104">To choose what approach to use, consider the following:</span></span>  
  
-   <span data-ttu-id="a225b-105">Сколько требуется целевых серверов?</span><span class="sxs-lookup"><span data-stu-id="a225b-105">How many destination servers do you require?</span></span>  
  
     <span data-ttu-id="a225b-106">Если требуется только одна целевая база данных, рекомендуется использовать зеркальное отображение базы данных.</span><span class="sxs-lookup"><span data-stu-id="a225b-106">If you require only a single destination database, database mirroring is the recommended solution.</span></span>  
  
     <span data-ttu-id="a225b-107">Если требуется несколько целевых баз данных, нужно использовать доставку журналов вместе с зеркальным отображением или без него.</span><span class="sxs-lookup"><span data-stu-id="a225b-107">If you require more than one destination database, you need to use log shipping, either alone or with database mirroring.</span></span> <span data-ttu-id="a225b-108">Комбинирование этих подходов дает преимущества зеркального отображения базы данных вместе с поддержкой нескольких целевых серверов, предоставляемой доставкой журналов.</span><span class="sxs-lookup"><span data-stu-id="a225b-108">Combining these approaches gives you the benefits of database mirroring along with the support for multiple destinations provided by log shipping.</span></span>  
  
-   <span data-ttu-id="a225b-109">Если на целевом сервере баз данных нужно задержать процесс восстановления (обычно для защиты от логических ошибок), используйте доставку журналов отдельно или совместно с зеркальным отображением.</span><span class="sxs-lookup"><span data-stu-id="a225b-109">If you need to delay restoring log on the destination database (typically, to protect against logical errors), use log shipping, alone or with database mirroring.</span></span>  
  
 <span data-ttu-id="a225b-110">В этом разделе описываются причины комбинирования доставки журналов и зеркального отображения баз данных.</span><span class="sxs-lookup"><span data-stu-id="a225b-110">This topic discusses considerations for combining log shipping and database mirroring.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a225b-111">Общие сведения об этих технологиях см. в разделе [Зеркальное отображение базы данных (SQL Server)](database-mirroring-sql-server.md) и [Сведения о доставке журналов (SQL Server)](../log-shipping/about-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="a225b-111">For introductions to these technologies, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) and [About Log Shipping &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md).</span></span>  
  
## <a name="combining-log-shipping-and-database-mirroring"></a><span data-ttu-id="a225b-112">Сочетание доставки журналов и зеркальных отображений баз данных</span><span class="sxs-lookup"><span data-stu-id="a225b-112">Combining Log Shipping and Database Mirroring</span></span>  
 <span data-ttu-id="a225b-113">Основная база данных сеанса зеркального отображения может также играть роль базы данных-источника в доставке журналов, или наоборот, так как ресурс резервных копий для доставки журналов остается неизменным.</span><span class="sxs-lookup"><span data-stu-id="a225b-113">The principal database in a mirroring session can also act as the primary database in a log shipping configuration, or vice versa, as the log shipping backup share is intact.</span></span> <span data-ttu-id="a225b-114">Сеанс зеркального отображения базы данных может выполняться в любом режиме работы: синхронном (полная безопасность транзакций) или асинхронном (безопасность транзакций не обеспечивается).</span><span class="sxs-lookup"><span data-stu-id="a225b-114">The database mirroring session run in any operating mode, whether synchronous (with transaction safety set to FULL) or asynchronous (with transaction safety set to OFF).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a225b-115">Чтобы использовать зеркальное отображение базы данных, всегда необходима полная модель восстановления.</span><span class="sxs-lookup"><span data-stu-id="a225b-115">To use database mirroring on a database, the full recovery model is always required.</span></span>  
  
 <span data-ttu-id="a225b-116">Обычно при сочетании доставки журналов и зеркального отображения баз данных сеанс отображения устанавливается перед доставкой журналов, но это необязательно.</span><span class="sxs-lookup"><span data-stu-id="a225b-116">Typically, when combining log shipping and database mirroring, the mirroring session is established before log shipping, although this is not required.</span></span> <span data-ttu-id="a225b-117">Затем текущая основная база данных настраивается в качестве источника для доставки журналов ( *основная база данных-источник*) вместе с одной или несколькими базами данных-получателями.</span><span class="sxs-lookup"><span data-stu-id="a225b-117">Then the current principal database is configured as the log shipping primary (the *principal/primary database*), along with one or more remote secondary databases.</span></span> <span data-ttu-id="a225b-118">Зеркальная база данных также должна быть настроена как источник в доставке журналов ( *зеркальная база данных-источник*).</span><span class="sxs-lookup"><span data-stu-id="a225b-118">Also, the mirror database must be configured as a log shipping primary (the *mirror/primary database*).</span></span> <span data-ttu-id="a225b-119">Базы данных-получатели должны находиться на экземплярах серверов, отличных от экземпляров основного сервера-источника и зеркального сервера-источника.</span><span class="sxs-lookup"><span data-stu-id="a225b-119">The log shipping secondary databases should be on different server instances than either the principal/primary server or mirror/primary server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a225b-120">Параметры чувствительности к регистру серверов, участвующих в доставке журналов, должны совпадать.</span><span class="sxs-lookup"><span data-stu-id="a225b-120">The case sensitivity settings of the servers involved in log shipping should match.</span></span>  
  
 <span data-ttu-id="a225b-121">Во время сеанса доставки журналов задания резервного копирования на базе данных-источнике создают резервные копии журналов в папке резервных копий.</span><span class="sxs-lookup"><span data-stu-id="a225b-121">During a log shipping session, backup jobs on the primary database create log backups in a backup folder.</span></span> <span data-ttu-id="a225b-122">Оттуда резервные копии копируются заданиями копирования на серверы-получатели.</span><span class="sxs-lookup"><span data-stu-id="a225b-122">From there, the backups are copied by the copy jobs of the secondary servers.</span></span> <span data-ttu-id="a225b-123">Чтобы задания создания и копирования резервных копий могли быть выполнены успешно, у них должен быть доступ к папке резервных копий журналов для доставки.</span><span class="sxs-lookup"><span data-stu-id="a225b-123">For the backup jobs and copy jobs to succeed, they must have access to the log shipping backup folder.</span></span> <span data-ttu-id="a225b-124">Чтобы максимизировать доступность сервера-источника, рекомендуется создавать папку резервных копий на общем резервном ресурсе главного компьютера.</span><span class="sxs-lookup"><span data-stu-id="a225b-124">To maximize availability of the primary server, we recommend that you establish the backup folder in a shared backup location on a separate host computer.</span></span> <span data-ttu-id="a225b-125">Убедитесь, что все серверы, задействованные в доставке журналов, включая зеркальный сервер-источник, имеют доступ к этому ресурсу ( *ресурсу резервных копий*).</span><span class="sxs-lookup"><span data-stu-id="a225b-125">Ensure that all the log shipping servers, including the mirror/primary server, can access the shared backup location (known as a *backup share*).</span></span>  
  
 <span data-ttu-id="a225b-126">Чтобы отправка журналов могла продолжаться после переключения на другой ресурс в сеансе зеркального отображения, зеркальный сервер также нужно настроить как сервер-источник, используя ту же конфигурацию, что и у основной базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="a225b-126">To allow log shipping to continue after database mirroring fails over, you must also configure the mirror server as a primary server, using the same configuration you use for the primary on the principal database.</span></span> <span data-ttu-id="a225b-127">Зеркальная база данных находится в состоянии восстановления, поэтому задания резервного копирования не будут создавать резервные копии журналов на зеркальной базе данных.</span><span class="sxs-lookup"><span data-stu-id="a225b-127">The mirror database is in the restoring state, which prevents the backup jobs from backing up the log on the mirror database.</span></span> <span data-ttu-id="a225b-128">Это гарантирует, что зеркальная база данных-источник не будет мешать работе основной базы данных-источника, резервные копии журналов которой копируются на серверы-получатели.</span><span class="sxs-lookup"><span data-stu-id="a225b-128">This ensures that the mirror/primary database does not interfere with the principal/primary database whose log backups are currently being copied by secondary servers.</span></span> <span data-ttu-id="a225b-129">Чтобы предотвратить появление ложных предупреждений, по завершении резервного копирования на зеркальной базе данных-источнике задание резервного копирования записывает сообщение в таблицу**log_shipping_monitor_history_detail** , а задание агента сообщает об успешном завершении работы.</span><span class="sxs-lookup"><span data-stu-id="a225b-129">To prevent spurious alerts, after the backup job executes on the mirror/primary database, the backup job logs a message to the l**og_shipping_monitor_history_detail** table, and the agent job returns a status of success.</span></span>  
  
 <span data-ttu-id="a225b-130">Зеркальная база данных-источник в сеансе доставки журналов неактивна.</span><span class="sxs-lookup"><span data-stu-id="a225b-130">The mirror/primary database is inactive in the log shipping session.</span></span> <span data-ttu-id="a225b-131">Однако при переходе на зеркальную базу данных она становится доступной в режиме «в сети» как основная.</span><span class="sxs-lookup"><span data-stu-id="a225b-131">However, if mirroring fails over, the former mirror database comes online as the principal database.</span></span> <span data-ttu-id="a225b-132">В этот момент она также становится активной базой данных-источником для доставки журналов.</span><span class="sxs-lookup"><span data-stu-id="a225b-132">At that point, that database also becomes active as the log shipping primary database.</span></span> <span data-ttu-id="a225b-133">Задания резервного копирования в доставке журналов, которые раньше не могли доставлять журналы с этой базы данных, начинают работу.</span><span class="sxs-lookup"><span data-stu-id="a225b-133">The log shipping backup jobs that were previously unable to ship log on that database, begin shipping log.</span></span> <span data-ttu-id="a225b-134">И наоборот, при отработке отказа с переходом на зеркальную базу данных бывшая основная база данных становится новой зеркальной базой данных-источником и входит в состояние восстановления, а задания резервного копирования на ней перестают создавать резервные копии журналов.</span><span class="sxs-lookup"><span data-stu-id="a225b-134">Conversely, a failover causes the former principal/primary database to become the new mirror/primary database and enter the restoring state, and backup jobs on that database cease to backup log.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a225b-135">В случае автоматической отработки отказа с переходом на зеркальную базу данных происходит, когда бывшая основная база данных-источник вновь подключается к сеансу зеркального отображения.</span><span class="sxs-lookup"><span data-stu-id="a225b-135">In the event of an automatic failover, the switch to the mirror role occurs when the former principal/primary database rejoins the mirroring session.</span></span>  
  
 <span data-ttu-id="a225b-136">Чтобы работать в режиме высокой безопасности с автоматической отработкой отказа, сеанс зеркального отображения базы данных должен быть настроен для использования дополнительного экземпляра сервера, называющегося *следящим*.</span><span class="sxs-lookup"><span data-stu-id="a225b-136">To run in high-safety mode with automatic failover the mirroring session is configured with an additional server instance known as the *witness*.</span></span> <span data-ttu-id="a225b-137">Если по какой-то причине после синхронизации основная база данных недоступна, а зеркальный и следящий серверы по-прежнему могут взаимодействовать друг с другом, происходит автоматическая отработка отказа с переходом на зеркальный сервер.</span><span class="sxs-lookup"><span data-stu-id="a225b-137">If the principal database is lost for any reason after the database is synchronized and if the mirror server and witness can still communicate with each other, automatic failover occurs.</span></span> <span data-ttu-id="a225b-138">После автоматической отработки отказа зеркальный сервер берет на себя роль основного, и его база данных становится доступной в режиме «в сети» как основная.</span><span class="sxs-lookup"><span data-stu-id="a225b-138">An automatic failover causes mirror server to assume the principal role and bring its database online as the principal database.</span></span> <span data-ttu-id="a225b-139">Если ресурс для хранения резервных копий журналов доступен новому основному серверу-источнику, его задания резервного копирования начинают отправлять туда резервные копии журналов.</span><span class="sxs-lookup"><span data-stu-id="a225b-139">If the log shipping backup location is accessible to the new principal/primary server, its backup jobs begin to ship log backups to that location.</span></span> <span data-ttu-id="a225b-140">Синхронный режим отображения базы данных гарантирует, что отработка отказа с переходом на зеркальный сервер не повлияет на последовательность журналов и что будут восстанавливаться только допустимые журналы.</span><span class="sxs-lookup"><span data-stu-id="a225b-140">The database mirroring synchronous mode guarantees that the log chain is unaffected by a mirroring failover and that only valid log is restored.</span></span> <span data-ttu-id="a225b-141">Серверы-получатели продолжают копировать резервные копии журналов, не зная о том, что основным стал другой экземпляр сервера.</span><span class="sxs-lookup"><span data-stu-id="a225b-141">The secondary servers continue to copy log backups without knowing that a different server instance has become the primary server.</span></span>  
  
 <span data-ttu-id="a225b-142">Для реализации этого сценария при использовании монитора доставки журналов никаких особых действий предпринимать не нужно.</span><span class="sxs-lookup"><span data-stu-id="a225b-142">When using a local log shipping monitor, no special considerations are necessary to accommodate this scenario.</span></span> <span data-ttu-id="a225b-143">Сведения об использовании удаленного экземпляра сервера мониторинга в этом сценарии см. в статье «Влияние зеркального отображения базы данных на удаленный экземпляр сервера мониторинга» далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="a225b-143">For information about using a remote monitoring instance with this scenario, see, "The Impact of Database Mirroring on a Remote Monitoring Instance," later in this topic.</span></span>  
  
## <a name="failing-over-from-the-principal-to-the-mirror-database"></a><span data-ttu-id="a225b-144">Переход с основной базы данных на зеркальную</span><span class="sxs-lookup"><span data-stu-id="a225b-144">Failing over from the Principal to the Mirror database</span></span>  
 <span data-ttu-id="a225b-145">На следующем рисунке показано, как доставка журналов и зеркальное отображение базы данных работают вместе, если зеркальное отображение производится в режиме высокого уровня безопасности с автоматической отработкой отказа.</span><span class="sxs-lookup"><span data-stu-id="a225b-145">The following figure shows how log shipping and database mirroring work together when mirroring is running in high-safety mode with automatic failover.</span></span> <span data-ttu-id="a225b-146">Изначально **Server_A** является одновременно и основным сервером зеркального отображения, и сервером-источником в доставке журналов.</span><span class="sxs-lookup"><span data-stu-id="a225b-146">Initially, **Server_A** is both the principal server for mirroring and the primary server for log shipping.</span></span> <span data-ttu-id="a225b-147">**Server_B** — зеркальный сервер, также настроенный как сервер-источник, в данный момент неактивный.</span><span class="sxs-lookup"><span data-stu-id="a225b-147">**Server_B** is the mirror server and is also configured as a primary server, which is currently inactive.</span></span> <span data-ttu-id="a225b-148">**Server_C** и **Server_D** — серверы-получатели в доставке журналов.</span><span class="sxs-lookup"><span data-stu-id="a225b-148">**Server_C** and **Server_D** are log shipping secondary servers.</span></span> <span data-ttu-id="a225b-149">Чтобы добиться максимальной доступности в сеансе доставки журналов, ресурс резервных копий находится в общей папке на главном компьютере.</span><span class="sxs-lookup"><span data-stu-id="a225b-149">To maximize availability of the log shipping session, the backup location is on a share directory on a separate host computer.</span></span>  
  
 <span data-ttu-id="a225b-150">![Доставка журналов и зеркальное отображение баз данных](../media/logshipping-and-dbm-automatic-failover.gif "Доставка журналов и зеркальное отображение баз данных")</span><span class="sxs-lookup"><span data-stu-id="a225b-150">![Log shipping and database mirroring](../media/logshipping-and-dbm-automatic-failover.gif "Log shipping and database mirroring")</span></span>  
  
 <span data-ttu-id="a225b-151">После отработки отказа с переходом на зеркальный сервер имя сервера-источника, определенное на серверах-получателях, не меняется.</span><span class="sxs-lookup"><span data-stu-id="a225b-151">After a mirroring failover, the primary server name defined on the secondary server is unchanged.</span></span> <span data-ttu-id="a225b-152">.</span><span class="sxs-lookup"><span data-stu-id="a225b-152">.</span></span>  
  
## <a name="the-impact-of-database-mirroring-on-a-remote-monitoring-instance"></a><span data-ttu-id="a225b-153">Влияние зеркального отображения базы данных на удаленный экземпляр сервера мониторинга</span><span class="sxs-lookup"><span data-stu-id="a225b-153">The Impact of Database Mirroring on a Remote Monitoring Instance</span></span>  
 <span data-ttu-id="a225b-154">При использовании удаленного экземпляра сервера мониторинга сочетание доставки журналов и зеркального отображения баз данных влияет на информацию, хранящуюся в таблицах монитора.</span><span class="sxs-lookup"><span data-stu-id="a225b-154">When log shipping uses with a remote monitoring instance, combining the log shipping session and database mirroring affects the information in the monitor tables.</span></span> <span data-ttu-id="a225b-155">Информация о сервере-источнике представляет собой комбинацию данных об основном сервере-источнике и мониторах, настроенных на каждом сервере-получателе.</span><span class="sxs-lookup"><span data-stu-id="a225b-155">The information about the primary is a combination of the one configured at the principal/primary and the monitor configured on each secondary.</span></span>  
  
 <span data-ttu-id="a225b-156">Чтобы сделать мониторинг как можно менее заметным, при использовании удаленного монитора рекомендуется указывать имя исходного сервера-отправителя во время описания источника на сервере-получателе.</span><span class="sxs-lookup"><span data-stu-id="a225b-156">To keep monitoring as seamless as possible, when you use a remote monitor, we recommend that you specify the original primary name when configuring the primary at the secondary.</span></span> <span data-ttu-id="a225b-157">Такой подход также упрощает изменение конфигурации доставки журналов из агента Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a225b-157">This approach also facilitates changing the log shipping configuration from Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="a225b-158">Дополнительные сведения о мониторинге см. в разделе [Наблюдение за доставкой журналов (Transact-SQL)](../log-shipping/monitor-log-shipping-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="a225b-158">For more information about monitoring, see [Monitor Log Shipping &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md).</span></span>  
  
## <a name="setting-up-mirroring-and-log-shipping-together"></a><span data-ttu-id="a225b-159">Совместная настройка зеркального отображения и доставки журналов</span><span class="sxs-lookup"><span data-stu-id="a225b-159">Setting Up Mirroring and Log Shipping Together</span></span>  
 <span data-ttu-id="a225b-160">Чтобы совместно настроить зеркальное отображение и доставку журналов, выполните следующие шаги:</span><span class="sxs-lookup"><span data-stu-id="a225b-160">To set up database mirroring and log shipping together, the following steps are required:</span></span>  
  
1.  <span data-ttu-id="a225b-161">Восстановите резервные копии основной базы данных-источника с параметром NORECOVERY на другой экземпляр сервера, который затем будет использоваться как зеркальная база данных основной базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="a225b-161">Restore backups of the principal/primary database with NORECOVERY onto another server instance to be later used as database mirroring mirror database for the principal/primary database.</span></span> <span data-ttu-id="a225b-162">Дополнительные сведения см. в статье [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="a225b-162">For more information, see [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="a225b-163">Настройте зеркальное отображение базы данных.</span><span class="sxs-lookup"><span data-stu-id="a225b-163">Set up database mirroring.</span></span> <span data-ttu-id="a225b-164">Дополнительные сведения см. в статьях [Создание сеанса зеркального отображения базы данных с использованием проверки подлинности Windows (среда SQL Server Management Studio)](establish-database-mirroring-session-windows-authentication.md) и [Настройка зеркального отображения базы данных (SQL Server)](setting-up-database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="a225b-164">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) or [Setting Up Database Mirroring &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="a225b-165">Восстановите резервные копии основной базы данных-источника на другие экземпляры сервера, которые затем будут использоваться как серверы-получатели в доставке журналов.</span><span class="sxs-lookup"><span data-stu-id="a225b-165">Restore backups of the principal/primary database to other server instances to be later used as log shipping secondary databases for the primary database.</span></span>  
  
4.  <span data-ttu-id="a225b-166">Настройте доставку журналов на основной базе данных как на базе данных-источнике для одной или более баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="a225b-166">Set up log shipping on the principal database as the primary database for one or more secondary databases.</span></span>  
  
     <span data-ttu-id="a225b-167">Создайте общий ресурс для каталога резервных копий (ресурс резервных копий).</span><span class="sxs-lookup"><span data-stu-id="a225b-167">You should set up a single share as the backup directory (a backup share).</span></span> <span data-ttu-id="a225b-168">Это гарантирует, что после переключения ролей между основным и зеркальным серверами задания резервного копирования будут продолжать вести запись в тот же каталог, что и ранее.</span><span class="sxs-lookup"><span data-stu-id="a225b-168">This ensures that after role switching between the principal and mirror servers, backup jobs continue to write to the same directory as before.</span></span> <span data-ttu-id="a225b-169">Рекомендуется также убедиться, что этот ресурс находится на физическом сервере, отличном от тех серверов, на которых находятся серверы баз данных, участвующие в зеркальном отображении и доставке журналов.</span><span class="sxs-lookup"><span data-stu-id="a225b-169">A best practice is to ensure that this share is located on a different physical server from the servers hosting the databases involved in mirroring and log shipping.</span></span>  
  
     <span data-ttu-id="a225b-170">Дополнительные сведения см. в разделе [Настройка доставки журналов (SQL Server)](../log-shipping/configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="a225b-170">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md).</span></span>  
  
5.  <span data-ttu-id="a225b-171">Отработка отказа вручную при сбое с основного сервера на зеркальный.</span><span class="sxs-lookup"><span data-stu-id="a225b-171">Manually failover from the principal to the mirror.</span></span>  
  
     <span data-ttu-id="a225b-172">Отработка отказа вручную.</span><span class="sxs-lookup"><span data-stu-id="a225b-172">To perform a manual failover:</span></span>  
  
    -   [<span data-ttu-id="a225b-173">Переключение сеанса зеркального отображения базы данных на другой ресурс вручную (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="a225b-173">Manually Fail Over a Database Mirroring Session &#40;SQL Server Management Studio&#41;</span></span>](manually-fail-over-a-database-mirroring-session-sql-server-management-studio.md)  
  
    -   [<span data-ttu-id="a225b-174">Переключение сеанса зеркального отображения базы данных на другой ресурс вручную (язык Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="a225b-174">Manually Fail Over a Database Mirroring Session &#40;Transact-SQL&#41;</span></span>](manually-fail-over-a-database-mirroring-session-transact-sql.md)  
  
6.  <span data-ttu-id="a225b-175">Настройте доставку журналов в главной (ранее зеркальной) базе данных как в базе данных-источнике.</span><span class="sxs-lookup"><span data-stu-id="a225b-175">Set up log shipping on the new principal (previously mirror) as the primary database.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="a225b-176">Не выполняйте никаких действий со вторичной базой данных.</span><span class="sxs-lookup"><span data-stu-id="a225b-176">Do not perform any setup from a secondary.</span></span>  
  
     <span data-ttu-id="a225b-177">Укажите ту же папку резервных копий, которая использовалась на шаге 4.</span><span class="sxs-lookup"><span data-stu-id="a225b-177">You must use the same backup share that you used in step 4.</span></span>  
  
     <span data-ttu-id="a225b-178">Интерфейс **Доставки журналов транзакций** среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] поддерживает работу только с одной базой данных-источником для каждой конфигурации доставки журналов.</span><span class="sxs-lookup"><span data-stu-id="a225b-178">The **Transaction Log Shipping** interface in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] supports only one primary database per log shipping configuration.</span></span> <span data-ttu-id="a225b-179">Следовательно, чтобы настроить нового участника в качестве сервера-источника, нужно использовать хранимые процедуры.</span><span class="sxs-lookup"><span data-stu-id="a225b-179">Therefore, you must use stored procedures to set up the new principal as primary.</span></span>  
  
7.  <span data-ttu-id="a225b-180">При необходимости можно вручную выполнить отработку отказа, чтобы вернуться к исходному участнику.</span><span class="sxs-lookup"><span data-stu-id="a225b-180">Perform another manual failover to fail back to the original principal.</span></span>  
  
  
