---
title: Экземпляры зеркального отображения баз данных и отказоустойчивых кластеров (SQL Server) | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- failover clustering [SQL Server], database mirroring
- database mirroring [SQL Server], failover
- high-availability mode [SQL Server]
ms.assetid: f1dd6a79-698b-4e31-b923-6bfc3ea0b617
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 378f834b4482f44f6a84abf419f027b353c7771a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87736758"
---
# <a name="database-mirroring-and-sql-server-failover-cluster-instances"></a><span data-ttu-id="2bed5-102">Экземпляры зеркального отображения баз данных и отказоустойчивых кластеров (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="2bed5-102">Database Mirroring and SQL Server Failover Cluster Instances</span></span>
  <span data-ttu-id="2bed5-103">Отказоустойчивый кластер представляет собой сочетание одного или нескольких физических дисков в группе кластеров службы кластеров [!INCLUDE[msCoName](../../includes/msconame-md.md)] , называемой группой ресурсов, которые являются узлами-участниками кластера.</span><span class="sxs-lookup"><span data-stu-id="2bed5-103">A failover cluster is a combination of one or more physical disks in a [!INCLUDE[msCoName](../../includes/msconame-md.md)] Cluster Service (MSCS) cluster group, known as a resource group, that are participating nodes of the cluster.</span></span> <span data-ttu-id="2bed5-104">Группа ресурсов настраивается как экземпляр кластера отработки отказа, на котором запускается экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2bed5-104">The resource group is configured as a failover clustered instance that hosts an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="2bed5-105">Экземпляр кластера отработки отказа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] регистрируется в сети как одиночный компьютер, при этом он обладает функциональными возможностями, обеспечивающими отработку отказа с одного узла на другой, если один из узлов становится недоступным.</span><span class="sxs-lookup"><span data-stu-id="2bed5-105">A [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover clustered instance appears on the network as if it were a single computer, but has functionality that provides failover from one node to another if one node becomes unavailable.</span></span> <span data-ttu-id="2bed5-106">Дополнительные сведения см. в статье [Экземпляры отказоустойчивого кластера (режим AlwaysOn) (SQL Server)](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="2bed5-106">For more information, see [AlwaysOn Failover Cluster Instances (SQL Server)](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
 <span data-ttu-id="2bed5-107">Отказоустойчивые кластеры обеспечивают поддержку высокого уровня доступности для всего экземпляра [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в противовес зеркальному отображению базы данных, которое обеспечивает поддержку высокого уровня доступности для отдельной базы данных.</span><span class="sxs-lookup"><span data-stu-id="2bed5-107">Failover clusters provide high-availability support for an entire [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance, in contrast to database mirroring, which provides high-availability support for a single database.</span></span> <span data-ttu-id="2bed5-108">Зеркальное отображение базы данных может работать между отказоустойчивыми кластерами, а также между отказоустойчивым кластером и некластеризованным узлом.</span><span class="sxs-lookup"><span data-stu-id="2bed5-108">Database mirroring works between failover clusters and, also, between a failover cluster and a nonclustered host.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="2bed5-109">Базовые сведения о зеркальном отображении базы данных см. в разделе [Зеркальное отображение базы данных (SQL Server)](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="2bed5-109">For an introduction to database mirroring, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
## <a name="mirroring-and-clustering"></a><span data-ttu-id="2bed5-110">Зеркальное отображение и кластер</span><span class="sxs-lookup"><span data-stu-id="2bed5-110">Mirroring and Clustering</span></span>  
 <span data-ttu-id="2bed5-111">Однако обычно при использовании зеркального отображения с кластеризацией основной и зеркальный серверы располагаются на кластерах, при этом основной сервер работает на экземпляре кластера отработки отказа одного кластера, а зеркальный сервер — на экземпляре кластера отработки отказа другого кластера.</span><span class="sxs-lookup"><span data-stu-id="2bed5-111">Typically, when mirroring is used with clustering, the principal server and mirror server both reside on clusters, with the principal server running on the failover clustered instance of one cluster and the mirror server running on the failover clustered instance of a different cluster.</span></span> <span data-ttu-id="2bed5-112">Можно установить сеанс зеркального отображения, в котором один участник находится на экземпляре кластера отработки отказа, а другой — на отдельном компьютере вне кластера.</span><span class="sxs-lookup"><span data-stu-id="2bed5-112">You can establish a mirroring session in which one partner resides on the failover clustered instance of a cluster and the other partner resides on a separate, unclustered computer, however.</span></span>  
  
 <span data-ttu-id="2bed5-113">Если при отработке отказа кластера основной сервер становится временно недоступным, клиентские соединения с базой данных разрываются.</span><span class="sxs-lookup"><span data-stu-id="2bed5-113">If a cluster failover makes a principal server temporarily unavailable, client connections are disconnected from the database.</span></span> <span data-ttu-id="2bed5-114">После завершения отработки отказа кластера клиенты могут повторно установить соединение с основным сервером на том же или на другом кластере (либо на компьютере вне кластера) в зависимости от [режима работы](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="2bed5-114">After the cluster failover completes, clients can reconnect to the principal server on the same cluster, or on a different cluster or an unclustered computer, depending on the [operating mode](database-mirroring-operating-modes.md).</span></span> <span data-ttu-id="2bed5-115">Поэтому при настройке зеркального отображения базы данных в кластерной среде существенным является режим работы, используемый для зеркального отображения.</span><span class="sxs-lookup"><span data-stu-id="2bed5-115">Therefore, when deciding how to configure database mirroring in a clustered environment, the operating mode you use for mirroring is significant.</span></span>  
  
### <a name="high-safety-mode-session-with-automatic-failover"></a><span data-ttu-id="2bed5-116">Сеанс в режиме высокой безопасности с автоматическим отработкой отказа</span><span class="sxs-lookup"><span data-stu-id="2bed5-116">High-Safety mode Session with Automatic Failover</span></span>  
 <span data-ttu-id="2bed5-117">Если необходимо реализовать зеркальное отображение базы данных в режиме высокой безопасности с автоматической отработкой отказа, для участников рекомендуется двухкластерная конфигурация.</span><span class="sxs-lookup"><span data-stu-id="2bed5-117">If you intend to mirror a database in high-safety mode with automatic failover, a two-cluster configuration is recommended for the partners.</span></span> <span data-ttu-id="2bed5-118">Эта конфигурация обеспечивает максимальный уровень доступности.</span><span class="sxs-lookup"><span data-stu-id="2bed5-118">This configuration provides maximum availability.</span></span> <span data-ttu-id="2bed5-119">Следящий сервер может располагаться либо в третьем кластере, либо на компьютере вне кластера.</span><span class="sxs-lookup"><span data-stu-id="2bed5-119">The witness can reside either on a third cluster or on an unclustered computer.</span></span>  
  
 <span data-ttu-id="2bed5-120">В случае сбоя узла, работающего на текущем основном сервере, через несколько секунд начинается автоматическая отработка отказа на другой ресурс, в то время как кластер также продолжает переход на другой узел.</span><span class="sxs-lookup"><span data-stu-id="2bed5-120">If the node running the current principal server fails, automatic failover of the database begins within a few seconds, while the cluster is still failing over to another node.</span></span> <span data-ttu-id="2bed5-121">Сеанс зеркального отображения базы данных переводится на зеркальный сервер в другом кластере (или на компьютер вне кластера), а бывший зеркальный сервер становится основным.</span><span class="sxs-lookup"><span data-stu-id="2bed5-121">The database mirroring session fails over to the mirror server on the other cluster or unclustered computer, and the former mirror server becomes the principal server.</span></span> <span data-ttu-id="2bed5-122">Новый основной сервер выполняет накат своей копии базы данных как можно быстрее и переводит ее в режим в сети в качестве основной базы данных.</span><span class="sxs-lookup"><span data-stu-id="2bed5-122">The new principal server rolls forward its copy of the database as quickly as possible and brings it online as the principal database.</span></span> <span data-ttu-id="2bed5-123">После выполнения отработки отказа кластера, что обычно занимает несколько минут, экземпляр кластера отработки отказа, который раньше был основным, становится зеркальным.</span><span class="sxs-lookup"><span data-stu-id="2bed5-123">After the cluster failover completes, which typically takes several minutes, the failover clustered instance that was formerly the principal server becomes the mirror server.</span></span>  
  
 <span data-ttu-id="2bed5-124">Следующая схема показывает автоматическую отработку отказа между кластерами в ходе сеанса зеркального отображения, запущенного в режиме высокой безопасности со следящим сервером (который поддерживает автоматическую отработку отказа).</span><span class="sxs-lookup"><span data-stu-id="2bed5-124">The following illustration shows an automatic failover between clusters in a mirroring session running in high-safety mode with a witness (which supports automatic failover).</span></span>  
  
 <span data-ttu-id="2bed5-125">![Отработка отказа на кластер](../media/dbm-and-failover-clustering.gif "Отработка отказа на кластер")</span><span class="sxs-lookup"><span data-stu-id="2bed5-125">![A failover on a cluster](../media/dbm-and-failover-clustering.gif "A failover on a cluster")</span></span>  
  
 <span data-ttu-id="2bed5-126">Три экземпляра сервера в сеансе зеркального отображения расположены на трех различных кластерах: **Кластер_А**, **Кластер_Б** и **Кластер_В**.</span><span class="sxs-lookup"><span data-stu-id="2bed5-126">The three server instances in the mirroring session reside on three distinct clusters: **Cluster_A**, **Cluster_B**, and **Cluster_C**.</span></span> <span data-ttu-id="2bed5-127">На каждом кластере экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] по умолчанию работает как экземпляр кластера отработки отказа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="2bed5-127">On each cluster, a default instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running as a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover clustered instance.</span></span> <span data-ttu-id="2bed5-128">В начале сеанса зеркального отображения экземпляр кластера отработки отказа в кластере **Кластер_А** является основным сервером, экземпляр кластера отработки отказа в кластере **Кластер_Б** — зеркальным сервером, а экземпляр кластера отработки отказа в кластере **Кластер_В** — следящим сервером сеанса зеркального отображения.</span><span class="sxs-lookup"><span data-stu-id="2bed5-128">When the mirroring session starts, the failover clustered instance on **Cluster_A** is the principal server, the failover clustered instance on **Cluster_B** is the mirror server, and the failover clustered instance on **Cluster_C** is the witness in the mirroring session.</span></span> <span data-ttu-id="2bed5-129">Предположим, что происходит сбой активного узла в кластере **Кластер_А** , что приводит к недоступности основного сервера.</span><span class="sxs-lookup"><span data-stu-id="2bed5-129">Eventually, the active node on **Cluster_A** fails, which causes the principal server to become unavailable.</span></span>  
  
 <span data-ttu-id="2bed5-130">Перед началом перехода кластера на другой ресурс зеркальный сервер обнаруживает сбой основного сервера с помощью следящего сервера.</span><span class="sxs-lookup"><span data-stu-id="2bed5-130">Before the cluster has time to fail over, the loss of the principal server is detected by the mirror server, with the help of the witness.</span></span> <span data-ttu-id="2bed5-131">Зеркальный сервер как можно быстрее выполняет накат своей базы данных и переводит ее в режим в сети в качестве основной базы данных.</span><span class="sxs-lookup"><span data-stu-id="2bed5-131">The mirror server rolls forward its database and brings it online as the new principal database as quickly as possible.</span></span> <span data-ttu-id="2bed5-132">После завершения перехода кластера **Кластер_А** на другой ресурс бывший основной сервер становится уже зеркальным и синхронизирует свою базу данных с текущей основной базой данных в кластере **Кластер_Б**.</span><span class="sxs-lookup"><span data-stu-id="2bed5-132">When **Cluster_A** finishes failing over, the former principal server is now the mirror server, and it synchronizes its database with the current principal database on **Cluster_B**.</span></span>  
  
### <a name="high-safety-mode-session-without-automatic-failover"></a><span data-ttu-id="2bed5-133">Сеанс в режиме высокой безопасности без автоматической отработки отказа на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="2bed5-133">High-Safety Mode Session Without Automatic Failover</span></span>  
 <span data-ttu-id="2bed5-134">При выполнении зеркального отображения базы данных в режиме высокой безопасности без автоматической отработки отказа в случае сбоя узла, работающего как основной сервер, другой узел кластера будет работать в качестве основного сервера.</span><span class="sxs-lookup"><span data-stu-id="2bed5-134">If you are mirroring a database in high-safety mode without automatic failover, another node in the cluster will act as the principal server if the node running the current principal server fails.</span></span> <span data-ttu-id="2bed5-135">Обратите внимание, что пока кластер недоступен, база данных также недоступна.</span><span class="sxs-lookup"><span data-stu-id="2bed5-135">Note that while the cluster is unavailable, the database is unavailable.</span></span>  
  
### <a name="high-performance-mode-session"></a><span data-ttu-id="2bed5-136">Сеанс в режиме высокой производительности</span><span class="sxs-lookup"><span data-stu-id="2bed5-136">High-Performance Mode Session</span></span>  
 <span data-ttu-id="2bed5-137">Если необходимо реализовать зеркальное отображение базы данных в режиме высокой производительности, следует расположить основной сервер на экземпляре кластера отработки отказа в кластере, а зеркальный сервер — на удаленном сервере вне кластера.</span><span class="sxs-lookup"><span data-stu-id="2bed5-137">If you intend to mirror a database in high-performance mode, consider placing the principal server on the failover clustered instance of a cluster and placing the mirror server on an unclustered server in a remote location.</span></span> <span data-ttu-id="2bed5-138">В случае перехода кластера на другой узел экземпляр кластера отработки отказа будет продолжать работу в качестве основного сервера сеанса зеркального отображения.</span><span class="sxs-lookup"><span data-stu-id="2bed5-138">If the cluster fails over to a different node, the failover clustered instance will continue as the principal server in the mirroring session.</span></span> <span data-ttu-id="2bed5-139">Если существуют проблемы на всем кластере, можно принудительно перевести обслуживание на зеркальный сервер.</span><span class="sxs-lookup"><span data-stu-id="2bed5-139">If the entire cluster has problems, you can force service onto the mirror server.</span></span>  
  
 <span data-ttu-id="2bed5-140">**Установка нового отказоустойчивого кластера SQL Server**</span><span class="sxs-lookup"><span data-stu-id="2bed5-140">**To set up a new SQL Server failover cluster**</span></span>  
  
-   [<span data-ttu-id="2bed5-141">Создание отказоустойчивого кластера SQL Server (программа установки)</span><span class="sxs-lookup"><span data-stu-id="2bed5-141">Create a New SQL Server Failover Cluster &#40;Setup&#41;</span></span>](../../sql-server/failover-clusters/install/create-a-new-sql-server-failover-cluster-setup.md)  
  
 <span data-ttu-id="2bed5-142">**Настройка зеркального отображения базы данных**</span><span class="sxs-lookup"><span data-stu-id="2bed5-142">**To set up database mirroring**</span></span>  
  
-   [<span data-ttu-id="2bed5-143">Настройка зеркального отображения базы данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="2bed5-143">Setting Up Database Mirroring &#40;SQL Server&#41;</span></span>](setting-up-database-mirroring-sql-server.md)  
  
-   [<span data-ttu-id="2bed5-144">Создание сеанса зеркального отображения базы данных с использованием проверки подлинности Windows (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="2bed5-144">Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;</span></span>](establish-database-mirroring-session-windows-authentication.md)  
  
## <a name="see-also"></a><span data-ttu-id="2bed5-145">См. также:</span><span class="sxs-lookup"><span data-stu-id="2bed5-145">See Also</span></span>  
 <span data-ttu-id="2bed5-146">[Зеркальное отображение базы данных (SQL Server)](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="2bed5-146">[Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 <span data-ttu-id="2bed5-147">[Режимы работы зеркального отображения базы данных](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="2bed5-147">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 [<span data-ttu-id="2bed5-148">Экземпляры отказоустойчивого кластера (режим AlwaysOn) (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="2bed5-148">AlwaysOn Failover Cluster Instances (SQL Server)</span></span>](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) 
  
  
