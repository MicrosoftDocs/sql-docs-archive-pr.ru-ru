---
title: Следящий сервер зеркального отображения базы данных | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- witness [SQL Server], about witness
- witness [SQL Server]
- database mirroring [SQL Server], witness
ms.assetid: 05606de8-90c3-451a-938d-1ed34211dad7
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 6ac02e2a5dbe86af72c15c07e14de70b12892b48
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655923"
---
# <a name="database-mirroring-witness"></a><span data-ttu-id="7ffe8-102">Database Mirroring Witness</span><span class="sxs-lookup"><span data-stu-id="7ffe8-102">Database Mirroring Witness</span></span>
  <span data-ttu-id="7ffe8-103">Для поддержки автоматической отработки отказа сеанс зеркального отображения базы данных должен быть настроен на использование режима высокой безопасности, а также должен присутствовать третий экземпляр, называемый *следящим сервером*.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-103">To support automatic failover, a database mirroring session must be configured in high-safety mode and also possess a third server instance, known as the *witness*.</span></span> <span data-ttu-id="7ffe8-104">Следящий сервер это дополнительный экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , позволяющий зеркальному серверу в сеансе режима высокой безопасности определить, следует ли начать процедуру автоматической отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-104">The witness is an optional instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that enables the mirror server in a high-safety mode session to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="7ffe8-105">В отличие от двух участников зеркального отображения, следящий сервер не обслуживает базу данных.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-105">Unlike the two partners, the witness does not serve the database.</span></span> <span data-ttu-id="7ffe8-106">Его единственная функция заключается в поддержке автоматического перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-106">Supporting automatic failover is the only role of the witness.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7ffe8-107">В режиме высокой производительности следящий сервер может неблагоприятно повлиять на доступность ресурсов.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-107">In high-performance mode, the witness can adversely affect availability.</span></span> <span data-ttu-id="7ffe8-108">Если для сеанса зеркального отображения базы данных настроен следящий сервер, то основной сервер должен быть подключен по крайней мере к одному из двух других экземпляров сервера — зеркальному или следящему серверу.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-108">If a witness is configured for a database mirroring session, the principal server must be connected at least to one of the other server instances, the mirror server or the witness, or both of them.</span></span> <span data-ttu-id="7ffe8-109">В противном случае база данных становится недоступной, а принудительное восстановление службы невозможным, при этом могут быть потеряны данные.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-109">Otherwise, the database becomes unavailable and forcing service (with possible data loss) is impossible.</span></span> <span data-ttu-id="7ffe8-110">Таким образом, в режиме высокой производительности настоятельно рекомендуется всегда поддерживать параметр WITNESS в значении OFF.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-110">Therefore, for high-performance mode, we strongly recommend that you always keep the witness set to OFF.</span></span> <span data-ttu-id="7ffe8-111">Дополнительные сведения о том, каким образом следящий сервер влияет на режим высокой производительности, см. в разделе [Режимы работы зеркального отображения базы данных](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="7ffe8-111">For information about the impact of a witness on high-performance mode, see [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span></span>  
  
 <span data-ttu-id="7ffe8-112">Следующий рисунок иллюстрирует сеанс в режиме высокого уровня безопасности с участием следящего сервера.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-112">The following illustration shows a high-safety mode session with a witness.</span></span>  
  
 <span data-ttu-id="7ffe8-113">![Сеанс зеркального отображения со следящим сервером](../media/dbm-3-way-session-intro.gif "Сеанс зеркального отображения со следящим сервером")</span><span class="sxs-lookup"><span data-stu-id="7ffe8-113">![Mirroring session with a witness](../media/dbm-3-way-session-intro.gif "Mirroring session with a witness")</span></span>  
  
 <span data-ttu-id="7ffe8-114">**В этом разделе:**</span><span class="sxs-lookup"><span data-stu-id="7ffe8-114">**In This Topic:**</span></span>  
  
-   [<span data-ttu-id="7ffe8-115">Использование следящего сервера в нескольких сеансах</span><span class="sxs-lookup"><span data-stu-id="7ffe8-115">Using a Witness in Multiple Sessions</span></span>](#InMultipleSessions)  
  
-   [<span data-ttu-id="7ffe8-116">Рекомендации к выбору оборудования и программного обеспечения</span><span class="sxs-lookup"><span data-stu-id="7ffe8-116">Software and Hardware Recommendations</span></span>](#SwHwRecommendations)  
  
-   [<span data-ttu-id="7ffe8-117">Роль следящего сервера в автоматический переход на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="7ffe8-117">Role of the Witness in Automatic Failover</span></span>](#InAutoFo)  
  
-   [<span data-ttu-id="7ffe8-118">Добавление или удаление следящего сервера</span><span class="sxs-lookup"><span data-stu-id="7ffe8-118">To Add or Remove a Witness</span></span>](#AddRemoveWitness)  
  
##  <a name="using-a-witness-in-multiple-sessions"></a><a name="InMultipleSessions"></a> <span data-ttu-id="7ffe8-119">Использование следящего сервера в нескольких сеансах</span><span class="sxs-lookup"><span data-stu-id="7ffe8-119">Using a Witness in Multiple Sessions</span></span>  
 <span data-ttu-id="7ffe8-120">Заданный экземпляр сервера может выступать в роли следящего сервера в нескольких параллельных сеансах зеркального отображения базы данных для разных баз данных.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-120">A specific server instance can act as a witness in concurrent database mirroring sessions, each for a different database.</span></span> <span data-ttu-id="7ffe8-121">В этих сеансах могут присутствовать различные участники.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-121">Different sessions can be with different partners.</span></span> <span data-ttu-id="7ffe8-122">На следующем рисунке показан экземпляр сервера, который является следящим в двух сеансах зеркального отображения базы данных с различными участниками.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-122">The following illustration shows a server instance that is a witness in two database mirroring sessions with different partners.</span></span>  
  
 <span data-ttu-id="7ffe8-123">![Экземпляр следящего сервера для двух баз данных](../media/dbm-witness-in-2-sessions.gif "Экземпляр следящего сервера для двух баз данных")</span><span class="sxs-lookup"><span data-stu-id="7ffe8-123">![Server instance that is a witness for 2 databases](../media/dbm-witness-in-2-sessions.gif "Server instance that is a witness for 2 databases")</span></span>  
  
 <span data-ttu-id="7ffe8-124">Кроме того, один и тот же экземпляр сервера может одновременно выступать в качестве следящего сервера в одних сеансах и в качестве участника зеркального отображения в других.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-124">A single-server instance can also function at the same time as a witness in some sessions and a partner in other sessions.</span></span> <span data-ttu-id="7ffe8-125">Однако на практике экземпляр сервера обычно выступает либо в качестве следящего сервера, либо в качестве участника зеркального отображения,</span><span class="sxs-lookup"><span data-stu-id="7ffe8-125">However, in practice, a server instance typically functions as either a witness or a partner.</span></span> <span data-ttu-id="7ffe8-126">так как для обслуживания производственной базы данных участники требуют мощных и сложных систем с серьезными требованиями к оборудованию, в то время как следящий сервер может работать на любой доступной системе Windows, обеспечивающей работу [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7ffe8-126">This is because the partners require sophisticated computers that have enough hardware to support a production database, whereas the witness can run on any available Windows system that supports [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>  
  
##  <a name="software-and-hardware-recommendations"></a><a name="SwHwRecommendations"></a> <span data-ttu-id="7ffe8-127">Рекомендации к выбору оборудования и программного обеспечения</span><span class="sxs-lookup"><span data-stu-id="7ffe8-127">Software and Hardware Recommendations</span></span>  
 <span data-ttu-id="7ffe8-128">Рекомендуется располагать следящий сервер на отдельном компьютере, который не используется участниками зеркального отображения.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-128">We strongly recommend that the witness reside on a separate computer from the partners.</span></span> <span data-ttu-id="7ffe8-129">Участники зеркального отображения баз данных поддерживаются только выпусками [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard и [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-129">Database mirroring partners are supported only by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard edition and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise edition.</span></span> <span data-ttu-id="7ffe8-130">Однако следящие серверы поддерживаются также в выпусках [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup и [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-130">Witnesses, in contrast, are also supported by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express.</span></span> <span data-ttu-id="7ffe8-131">Кроме как во время обновления предыдущей версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], на всех экземплярах серверов в сеансе зеркального отображения должна работать одна и та же версия [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7ffe8-131">Except during an upgrade from an earlier version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the server instances in a mirroring session must all be running the same version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7ffe8-132">Например, в [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] следящий сервер при обновлении от конфигурации зеркального отображения [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] поддерживается, но не может быть добавлен в существующую или новую конфигурацию зеркального отображения [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] или более поздних версий.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-132">For example, a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] witness is supported when you are upgrading from a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] mirroring configuration but cannot be added to an existing or new [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] or later mirroring configuration.</span></span>  
  
 <span data-ttu-id="7ffe8-133">Следящий сервер может работать на любой надежной компьютерной системе, поддерживающей любой из этих выпусков [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7ffe8-133">A witness can run on any reliable computer system that supports any of these editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="7ffe8-134">Однако рекомендуется, чтобы каждый экземпляр следящего сервера соответствовал минимальным требованиям к конфигурации, необходимым для используемой версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-134">However, we recommend that every server instance that is used as a witness correspond to the minimum configuration that is required for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard version that you are running.</span></span> <span data-ttu-id="7ffe8-135">Дополнительные сведения об этих требованиях см. в разделе [требования к оборудованию и программному обеспечению для установки SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="7ffe8-135">For more information about these requirements, see [Hardware and Software Requirements for Installing SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span></span>  
  
##  <a name="role-of-the-witness-in-automatic-failover"></a><a name="InAutoFo"></a> <span data-ttu-id="7ffe8-136">Роль следящего сервера в автоматический переход на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="7ffe8-136">Role of the Witness in Automatic Failover</span></span>  
 <span data-ttu-id="7ffe8-137">На всем протяжении сеанса зеркального отображения базы данных все экземпляры сервера отслеживают свое состояние соединения.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-137">Throughout a database mirroring session, all the server instances monitor their connection status.</span></span> <span data-ttu-id="7ffe8-138">Если произошло отсоединение участников друг от друга, то они, чтобы гарантировать, что в данный момент только один из них обслуживает базу данных, полагаются на следящий сервер.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-138">If the partners become disconnected from each other, they rely on the witness to make sure that only one of them is currently serving the database.</span></span> <span data-ttu-id="7ffe8-139">Если синхронизированный зеркальный сервер теряет соединение с основным сервером, но остается соединенным со следящим сервером, зеркальный сервер обращается к следящему серверу, чтобы определить, потерял ли следящий сервер соединение с основным сервером.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-139">If a synchronized mirror server loses its connection to the principal server but remains connected to the witness, the mirror server contacts the witness to determine whether the witness has lost its connection to the principal server:</span></span>  
  
-   <span data-ttu-id="7ffe8-140">Если основной сервер до сих пор подключен к следящему серверу, то автоматическая отработка отказа не производится.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-140">If the principal server is still connected to the witness, automatic failover does not occur.</span></span> <span data-ttu-id="7ffe8-141">Вместо этого основной сервер продолжает обслуживать базу данных, накапливая записи журнала для отправки на зеркальный сервер при повторном соединении участников.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-141">Instead, the principal server continues to server the database while accumulating log records to send the mirror server when the partners reconnect.</span></span>  
  
-   <span data-ttu-id="7ffe8-142">Если следящий сервер также отключен от основного сервера, то зеркальный сервер считает, что основная база данных стала недоступна.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-142">If the witness is also disconnected from the principal server, the mirror server knows that principal database has become unavailable.</span></span> <span data-ttu-id="7ffe8-143">В этом случае зеркальный сервер инициирует немедленную автоматическую отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-143">In this case, the mirror server immediately initiates an automatic failover.</span></span>  
  
-   <span data-ttu-id="7ffe8-144">Если зеркальный сервер отключен от следящего и основного серверов, то автоматическая отработка отказа невозможна вне зависимости от состояния основного сервера.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-144">If the mirror server is disconnected from the witness and also from the principal server, automatic failover is not possible, regardless of the state of the principal server.</span></span>  
  
 <span data-ttu-id="7ffe8-145">Требование, которое заключается в том, чтобы по крайней мере два экземпляра сервера оставались подключенными, называется *кворумом*.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-145">The requirement that at least two of the server instances be connected is known as *quorum*.</span></span> <span data-ttu-id="7ffe8-146">Кворум гарантирует, что в каждый момент времени база данных может обслуживаться только одним участником.</span><span class="sxs-lookup"><span data-stu-id="7ffe8-146">Quorum makes sure that the database can only be served by one partner at a time.</span></span> <span data-ttu-id="7ffe8-147">Дополнительные сведения о кворуме и влиянии, которое он оказывает на сеанс, см. в разделе [Кворум. Как следящий сервер влияет на доступность базы данных &#40;зеркальное отображение базы данных&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="7ffe8-147">For information about how quorum works and its impact on a session, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
##  <a name="to-add-or-remove-a-witness"></a><a name="AddRemoveWitness"></a> <span data-ttu-id="7ffe8-148">Добавление или удаление следящего сервера</span><span class="sxs-lookup"><span data-stu-id="7ffe8-148">To Add or Remove a Witness</span></span>  
 <span data-ttu-id="7ffe8-149">**Добавление следящего сервера**</span><span class="sxs-lookup"><span data-stu-id="7ffe8-149">**To add a witness**</span></span>  
  
-   [<span data-ttu-id="7ffe8-150">Добавление или замена следящего сервера зеркального отображения базы данных (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="7ffe8-150">Add or Replace a Database Mirroring Witness &#40;SQL Server Management Studio&#41;</span></span>](../database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="7ffe8-151">Добавление следящего сервера для зеркального отображения базы данных с использованием проверки подлинности Windows (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="7ffe8-151">Add a Database Mirroring Witness Using Windows Authentication &#40;Transact-SQL&#41;</span></span>](add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
 <span data-ttu-id="7ffe8-152">**Удаление следящего сервера**</span><span class="sxs-lookup"><span data-stu-id="7ffe8-152">**To remove the witness**</span></span>  
  
-   [<span data-ttu-id="7ffe8-153">Удаление следящего сервера из сеанса зеркального отображения базы данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="7ffe8-153">Remove the Witness from a Database Mirroring Session &#40;SQL Server&#41;</span></span>](remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="7ffe8-154">См. также:</span><span class="sxs-lookup"><span data-stu-id="7ffe8-154">See Also</span></span>  
 <span data-ttu-id="7ffe8-155">[Переключение ролей во время сеанса зеркального отображения базы данных (SQL Server)](role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="7ffe8-155">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 <span data-ttu-id="7ffe8-156">[Режимы работы зеркального отображения базы данных](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="7ffe8-156">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 <span data-ttu-id="7ffe8-157">[Кворум. Как следящий сервер влияет на доступность базы данных (зеркальное отображение базы данных)](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="7ffe8-157">[Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span></span>  
 <span data-ttu-id="7ffe8-158">[Возможные неполадки при зеркальном отображении базы данных](possible-failures-during-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="7ffe8-158">[Possible Failures During Database Mirroring](possible-failures-during-database-mirroring.md) </span></span>  
 [<span data-ttu-id="7ffe8-159">Состояния зеркального отображения (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="7ffe8-159">Mirroring States &#40;SQL Server&#41;</span></span>](mirroring-states-sql-server.md)  
  
  
