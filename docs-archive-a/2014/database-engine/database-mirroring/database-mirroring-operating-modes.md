---
title: Режимы работы зеркального отображения базы данных | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], operating modes
ms.assetid: f8a579c2-55d7-4278-8088-f1da1de5b2e6
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: c944b402b8b1ba9b78036d667ec728ccaf561a91
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655937"
---
# <a name="database-mirroring-operating-modes"></a><span data-ttu-id="c9307-102">Режимы работы зеркального отображения базы данных</span><span class="sxs-lookup"><span data-stu-id="c9307-102">Database Mirroring Operating Modes</span></span>
  <span data-ttu-id="c9307-103">В этом разделе описываются синхронный и асинхронный режимы работы для сеансов зеркального отображения базы данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-103">This topic describes the synchronous and asynchronous operating modes for database mirroring sessions.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c9307-104">Базовые сведения о зеркальном отображении базы данных см. в разделе [Зеркальное отображение базы данных (SQL Server)](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-104">For an introduction to database mirroring, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
 
  
##  <a name="terms-and-definitions"></a><a name="TermsAndDefinitions"></a> <span data-ttu-id="c9307-105">Термины и определения</span><span class="sxs-lookup"><span data-stu-id="c9307-105">Terms and Definitions</span></span>  
 <span data-ttu-id="c9307-106">В данном разделе описывается несколько терминов, которые имеют центральное значение для этой темы.</span><span class="sxs-lookup"><span data-stu-id="c9307-106">This section introduces a few terms that are central to this topic.</span></span>  
  
 <span data-ttu-id="c9307-107">Высокопроизводительный режим</span><span class="sxs-lookup"><span data-stu-id="c9307-107">High-performance mode</span></span>  
 <span data-ttu-id="c9307-108">Сеанс зеркального отображения базы данных работает асинхронно и использует только основной сервер и зеркальный сервер.</span><span class="sxs-lookup"><span data-stu-id="c9307-108">The database mirroring session operates asynchronously and uses only the principal server and mirror server.</span></span> <span data-ttu-id="c9307-109">Единственной формой переключения ролей является принудительное обслуживание (с возможной потерей данных).</span><span class="sxs-lookup"><span data-stu-id="c9307-109">The only form of role switching is forced service (with possible data loss).</span></span>  
  
 <span data-ttu-id="c9307-110">Режим высокой безопасности</span><span class="sxs-lookup"><span data-stu-id="c9307-110">High-safety mode</span></span>  
 <span data-ttu-id="c9307-111">Сеанс зеркального отображения базы данных работает синхронно, и в нем в случае необходимости используются следящий сервер, а также основной сервер и зеркальный сервер.</span><span class="sxs-lookup"><span data-stu-id="c9307-111">The database mirroring session operates synchronously and, optionally, uses a witness, as well as the principal server and mirror server.</span></span>  
  
 <span data-ttu-id="c9307-112">Безопасность транзакций</span><span class="sxs-lookup"><span data-stu-id="c9307-112">Transaction safety</span></span>  
 <span data-ttu-id="c9307-113">Характерное для зеркального отображения свойство базы данных, которое определяет, будет работать сеанс зеркального отображения базы данных в синхронном или асинхронном режиме.</span><span class="sxs-lookup"><span data-stu-id="c9307-113">A mirroring-specific database property that determines whether a database mirroring session operates synchronously or asynchronously.</span></span> <span data-ttu-id="c9307-114">Существует два уровня безопасности: FULL и OFF.</span><span class="sxs-lookup"><span data-stu-id="c9307-114">There are two safety levels: FULL and OFF.</span></span>  
  
 <span data-ttu-id="c9307-115">Свидетель</span><span class="sxs-lookup"><span data-stu-id="c9307-115">Witness</span></span>  
 <span data-ttu-id="c9307-116">Дополнительный экземпляр SQL Server для использования только в режиме повышенной безопасности, который позволяет зеркальному серверу узнавать время начала автоматического перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="c9307-116">For use only with high-safety mode, an optional instance of SQL Server that enables the mirror server to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="c9307-117">В отличие от двух партнеров по обеспечению отработки отказа, следящий сервер не обслуживает базу данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-117">Unlike the two failover partners, the witness does not serve the database.</span></span> <span data-ttu-id="c9307-118">Его единственная функция заключается в поддержке автоматического перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="c9307-118">Supporting automatic failover is the only role of the witness.</span></span>  
  
##  <a name="asynchronous-database-mirroring-high-performance-mode"></a><a name="VisualElement"></a><span data-ttu-id="c9307-119">Асинхронное зеркальное отображение базы данных (режим высокой производительности)</span><span class="sxs-lookup"><span data-stu-id="c9307-119">Asynchronous Database Mirroring (High-Performance Mode)</span></span>  
 <span data-ttu-id="c9307-120">В этом разделе описываются принципы работы асинхронного зеркального отображения базы данных, ситуации, когда можно использовать режим высокой производительности, и меры, принимаемые в случае сбоя основного сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-120">This section describes how asynchronous database mirroring works, when it is appropriate to use high-performance mode, and how to respond if the principal server fails.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c9307-121">В большинстве выпусков [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] поддерживается только синхронное зеркальное отображение базы данных (только в режиме полной безопасности).</span><span class="sxs-lookup"><span data-stu-id="c9307-121">Most editions of [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] support only synchronous database mirroring ("Safety Full Only").</span></span> <span data-ttu-id="c9307-122">Сведения о выпусках, полностью поддерживающих зеркальное отображение базы данных, см. в разделе "высокий уровень доступности (AlwaysOn)" статьи [функции, поддерживаемые Выпусками SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-122">For information about editions that fully support database mirroring, see "High Availability (AlwaysOn)" in [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>  
  
 <span data-ttu-id="c9307-123">Если безопасность транзакций отключена, сеанс зеркального отображения базы данных выполняется в асинхронном режиме.</span><span class="sxs-lookup"><span data-stu-id="c9307-123">When transaction safety is set to OFF, the database mirroring session operates asynchronously.</span></span> <span data-ttu-id="c9307-124">Асинхронные операции поддерживаются только в режиме высокой производительности.</span><span class="sxs-lookup"><span data-stu-id="c9307-124">Asynchronous operation supports only one operating mode-high-performance mode.</span></span> <span data-ttu-id="c9307-125">В этом режиме производительность повышается за счет высокого уровня доступности.</span><span class="sxs-lookup"><span data-stu-id="c9307-125">This mode enhances performance at the expense of high availability.</span></span> <span data-ttu-id="c9307-126">В режиме высокой производительности задействованы только основной сервер и зеркальный сервер.</span><span class="sxs-lookup"><span data-stu-id="c9307-126">High-performance mode uses just the principal server and the mirror server.</span></span> <span data-ttu-id="c9307-127">Проблемы, возникающие на зеркальном сервере, никогда не влияют на основной сервер.</span><span class="sxs-lookup"><span data-stu-id="c9307-127">Problems on the mirror server never impact the principal server.</span></span> <span data-ttu-id="c9307-128">При потере соединения с основным сервером зеркальная база данных переходит в состояние DISCONNECTED, но остается доступной в режиме «горячего» резервирования.</span><span class="sxs-lookup"><span data-stu-id="c9307-128">On the loss of the principal server, the mirror database is marked DISCONNECTED but is available as a warm standby.</span></span>  
  
 <span data-ttu-id="c9307-129">Режим высокой производительности поддерживает только одну форму переключения ролей: принудительное обслуживание (с возможной потерей данных), при котором зеркальный сервер используется в качестве сервера «горячего» резервирования.</span><span class="sxs-lookup"><span data-stu-id="c9307-129">High-performance mode, supports only one form of role switching: forced service (with possible data loss), which uses the mirror server as a warm standby server.</span></span> <span data-ttu-id="c9307-130">Принудительное обслуживание — одна из возможных реакций на ошибку основного сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-130">Forced service is one of the possible responses to the failure of the principal server.</span></span> <span data-ttu-id="c9307-131">Так как при этом возможна потеря данных, перед переходом в режим вынужденного обслуживания зеркальным сервером следует рассмотреть другие возможности.</span><span class="sxs-lookup"><span data-stu-id="c9307-131">Because data loss is possible, you should consider other alternatives before forcing service to the mirror.</span></span> <span data-ttu-id="c9307-132">Дополнительные сведения см. в подразделе [Реакция на ошибку основного сервера](#WhenPrincipalFails)далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="c9307-132">For more information, see [Responding to Failure of the Principal](#WhenPrincipalFails), later in this topic.</span></span>  
  
 <span data-ttu-id="c9307-133">На следующем рисунке показана конфигурация сеанса в режиме высокой производительности.</span><span class="sxs-lookup"><span data-stu-id="c9307-133">The following figure shows the configuration of a session using high-performance mode.</span></span>  
  
 <span data-ttu-id="c9307-134">![Конфигурация сеанса только с участниками](../media/dbm-high-performance-mode.gif "Конфигурация сеанса только с участниками")</span><span class="sxs-lookup"><span data-stu-id="c9307-134">![Partner-only configuration of a session](../media/dbm-high-performance-mode.gif "Partner-only configuration of a session")</span></span>  
  
 <span data-ttu-id="c9307-135">В режиме высокой производительности, как только основной сервер отправляет журнал транзакций зеркальному серверу, основной сервер отправляет подтверждение клиенту, не дожидаясь ответа от зеркального сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-135">In high-performance mode, as soon as the principal server sends the log for a transaction to the mirror server, the principal server sends a confirmation to the client, without waiting for an acknowledgement from the mirror server.</span></span> <span data-ttu-id="c9307-136">Транзакции фиксируются без ожидания записи журнала на диск на зеркальном сервере.</span><span class="sxs-lookup"><span data-stu-id="c9307-136">Transactions commit without waiting for the mirror server to write the log to disk.</span></span> <span data-ttu-id="c9307-137">Асинхронный режим позволяет основному серверу работать с минимальной задержкой транзакций.</span><span class="sxs-lookup"><span data-stu-id="c9307-137">Asynchronous operation permits the principal server to run with minimum transaction latency.</span></span>  
  
 <span data-ttu-id="c9307-138">Зеркальный сервер пытается соответствовать записям в журнале, отправляемым основным сервером.</span><span class="sxs-lookup"><span data-stu-id="c9307-138">The mirror server attempts to keep up with the log records sent by the principal server.</span></span> <span data-ttu-id="c9307-139">Но зеркальная база данных может отражать предыдущее состояние основной базы данных, однако разрыв между базами данных, как правило, небольшой.</span><span class="sxs-lookup"><span data-stu-id="c9307-139">But the mirror database might lag somewhat behind the principal database, though typically the gap between the databases is small.</span></span> <span data-ttu-id="c9307-140">Однако этот разрыв может стать существенным, если основной сервер сильно загружен или перегружена система зеркального сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-140">However, the gap can become substantial if the principal server is under a heavy work load or the system of the mirror server is over loaded.</span></span>  
  
 
  
###  <a name="when-is-high-performance-mode-appropriate"></a><a name="WhenUseHighPerf"></a> <span data-ttu-id="c9307-141">Когда рекомендуется использовать режим высокой производительности?</span><span class="sxs-lookup"><span data-stu-id="c9307-141">When Is High-Performance Mode Appropriate?</span></span>  
 <span data-ttu-id="c9307-142">Режим высокой производительности может быть полезен в сценарии аварийного восстановления, когда основной и зеркальный серверы значительно удалены друг от друга и когда необходимо, чтобы мелкие ошибки не влияли на основной сервер.</span><span class="sxs-lookup"><span data-stu-id="c9307-142">High-performance mode can be useful in a disaster-recovery scenario in which the principal and mirror servers are separated by a significant distance and where you do not want small errors to impact the principal server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c9307-143">Доставка журналов может дополнять зеркальное отображение базы данных и является подходящей альтернативой для асинхронного зеркального отображения базы данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-143">Log shipping can be a supplement to database mirroring and is a favorable alternative to asynchronous database mirroring.</span></span> <span data-ttu-id="c9307-144">Дополнительные сведения о преимуществах применения доставки журналов см. в разделе [Решения высокого уровня доступности (SQL Server)](../../sql-server/failover-clusters/high-availability-solutions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-144">For information about the advantages of log shipping, see [High Availability Solutions &#40;SQL Server&#41;](../../sql-server/failover-clusters/high-availability-solutions-sql-server.md).</span></span> <span data-ttu-id="c9307-145">Сведения об использовании доставки журналов совместно с зеркальным отображением базы данных см. в разделе [Зеркальное отображение баз данных и доставка журналов (SQL Server)](database-mirroring-and-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-145">For information on using log shipping with database mirroring, see [Database Mirroring and Log Shipping &#40;SQL Server&#41;](database-mirroring-and-log-shipping-sql-server.md).</span></span>  
  
###  <a name="the-impact-of-a-witness-on-high-performance-mode"></a><a name="WitnessImpactOnHighPerf"></a> <span data-ttu-id="c9307-146">Влияние следящего сервера на высокопроизводительный режим</span><span class="sxs-lookup"><span data-stu-id="c9307-146">The Impact of a Witness on High-Performance Mode</span></span>  
 <span data-ttu-id="c9307-147">При использовании Transact-SQL для настройки высокопроизводительного режима, если для параметра SAFETY установлено значение OFF, настоятельно рекомендуется также установить параметр WITNESS в значение OFF.</span><span class="sxs-lookup"><span data-stu-id="c9307-147">If you use Transact-SQL to configure high-performance mode, whenever the SAFETY property is set to OFF, we strongly recommend that the WITNESS property also be set to OFF.</span></span> <span data-ttu-id="c9307-148">Следящий сервер может использоваться с высокопроизводительным режимом, но это не принесет пользы и представляет риск.</span><span class="sxs-lookup"><span data-stu-id="c9307-148">A witness can coexist with high-performance mode, but the witness provides no benefit and introduces risk.</span></span>  
  
 <span data-ttu-id="c9307-149">Если следящий сервер отключен от сеанса и любой партнер завершает работу, база данных становится недоступной.</span><span class="sxs-lookup"><span data-stu-id="c9307-149">If the witness is disconnected from the session when either partner goes down, the database becomes unavailable.</span></span> <span data-ttu-id="c9307-150">Это происходит потому, что если следящий сервер установлен, сеансу необходим кворум, состоящий из двух или более экземпляров сервера, даже если для высокопроизводительного режима не требуется следящий сервер.</span><span class="sxs-lookup"><span data-stu-id="c9307-150">This is because, even though high-performance mode does not require a witness, if one is set, the session requires a quorum consisting of two or more server instances.</span></span> <span data-ttu-id="c9307-151">Если сеанс теряет кворум, он не может обслуживать базу данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-151">If the session losses quorum, it cannot serve the database.</span></span>  
  
 <span data-ttu-id="c9307-152">Если следящий сервер установлен для сеанса с высокопроизводительным режимом, принудительное исполнение кворума означает, что:</span><span class="sxs-lookup"><span data-stu-id="c9307-152">When a witness is set in a high-performance mode session, the enforcement of quorum means that:</span></span>  
  
-   <span data-ttu-id="c9307-153">если соединение с зеркальным сервером теряется, основной сервер должен быть подключен к следящему.</span><span class="sxs-lookup"><span data-stu-id="c9307-153">If the mirror server is lost, the principal server must be connected to the witness.</span></span> <span data-ttu-id="c9307-154">В противном случае основной сервер переводит свою базу данных в режим «вне сети» до тех пор, пока следящий или зеркальный сервер не восстановит соединение с сеансом;</span><span class="sxs-lookup"><span data-stu-id="c9307-154">Otherwise, the principal server takes its database offline until either the witness or mirror server rejoins the session.</span></span>  
  
-   <span data-ttu-id="c9307-155">если потеряно соединение с основным сервером, для переключения на зеркальный сервер необходимо, чтобы зеркальный сервер был подключен к следящему.</span><span class="sxs-lookup"><span data-stu-id="c9307-155">If the principal server is lost, forcing service to the mirror server requires that the mirror server be connected to the witness.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c9307-156">Сведения о типах кворума см. в разделе [Кворум. Как следящий сервер влияет на доступность базы данных &#40;зеркальное отображение базы данных&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-156">For information about the types of quorums, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
###  <a name="responding-to-failure-of-the-principal"></a><a name="WhenPrincipalFails"></a> <span data-ttu-id="c9307-157">Реакция на ошибку основного сервера</span><span class="sxs-lookup"><span data-stu-id="c9307-157">Responding to Failure of the Principal</span></span>  
 <span data-ttu-id="c9307-158">Если на основном сервере произошла ошибка, у владельца базы данных есть несколько вариантов действия:</span><span class="sxs-lookup"><span data-stu-id="c9307-158">When the principal fails, the database owner has several choices, as follows:</span></span>  
  
-   <span data-ttu-id="c9307-159">Оставить базу данных недоступной, пока основной сервер снова не станет доступным.</span><span class="sxs-lookup"><span data-stu-id="c9307-159">Leave the database unavailable until the principal becomes available again.</span></span>  
  
     <span data-ttu-id="c9307-160">Если основная база данных и ее журнал транзакций остаются неизменными, в этом случае все зафиксированные транзакции сохраняются за счет доступности.</span><span class="sxs-lookup"><span data-stu-id="c9307-160">If the principal database and its transaction log are intact, this choice preserves all of the committed transactions at the expense of availability.</span></span>  
  
-   <span data-ttu-id="c9307-161">Завершить сеанс зеркального отображения базы данных, вручную обновив базу данных, а затем начать новый сеанс зеркального отображения.</span><span class="sxs-lookup"><span data-stu-id="c9307-161">Stop the database mirroring session, manually update the database, and then begin a new database mirroring session.</span></span>  
  
     <span data-ttu-id="c9307-162">Если основная база данных недоступна, но основной сервер все еще запущен, попытайтесь сразу сохранить резервную копию заключительного фрагмента журнала основной базы данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-162">If the principal database is lost but the principal server is still running, immediately attempt to back up the tail of the log on the principal database.</span></span> <span data-ttu-id="c9307-163">Если эта операция завершится успешно, удаление зеркального отображения может быть лучшим вариантом.</span><span class="sxs-lookup"><span data-stu-id="c9307-163">If the tail-log backup succeeds, removing mirroring may be your best alternative.</span></span> <span data-ttu-id="c9307-164">После удаления зеркального отображения можно восстановить журнал на бывшей зеркальной базе данных, сохранив при этом все данные.</span><span class="sxs-lookup"><span data-stu-id="c9307-164">After removing mirroring, you can restore the log onto the former mirror database, which preserves all of the data.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="c9307-165">Если создать резервную копию заключительного фрагмента журнала не удается и нельзя ждать восстановления основного сервера, можно воспользоваться режимом вынужденного обслуживания, преимущество которого в продолжении сеанса в текущем состоянии.</span><span class="sxs-lookup"><span data-stu-id="c9307-165">If the tail-log backup failed and you cannot wait for the principal server to recover, consider forcing service, which has the advantage of maintaining the session state.</span></span>  
  
-   <span data-ttu-id="c9307-166">Принудительное обслуживание (с возможной потерей данных) зеркальным сервером.</span><span class="sxs-lookup"><span data-stu-id="c9307-166">Force service (with possible data loss) on the mirror server.</span></span>  
  
     <span data-ttu-id="c9307-167">Принудительное обслуживание является исключительно методом аварийного восстановления и должно использоваться ограниченно.</span><span class="sxs-lookup"><span data-stu-id="c9307-167">Forced service is strictly a disaster recovery method and should be used sparingly.</span></span> <span data-ttu-id="c9307-168">Принудительное обслуживание возможно, только если основной сервер выключен, сеанс асинхронный (безопасность транзакций отключена) и нет следящих серверов (параметр WITNESS установлен в OFF) или следящий сервер подключен к зеркальному серверу (то есть они имеют кворум).</span><span class="sxs-lookup"><span data-stu-id="c9307-168">Forcing service is possible only if the principal server is down, the session is asynchronous (transaction safety is set to OFF), and either the session does not have any witness (the WITNESS property is set to OFF) or the witness is connected to the mirror server (that is, they have quorum).</span></span>  
  
     <span data-ttu-id="c9307-169">При принудительном обслуживании зеркальный сервер играет роль основного и предоставляет клиентам свою копию базы данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-169">Forcing service causes the mirror server to assume the role of principal and serve its copy of the database for clients.</span></span> <span data-ttu-id="c9307-170">В этом случае все журналы транзакций, которые основной сервер еще не отправил зеркальному, будут утеряны.</span><span class="sxs-lookup"><span data-stu-id="c9307-170">When service is forced, whatever transaction logs the principal has not yet sent to the mirror server are lost.</span></span> <span data-ttu-id="c9307-171">Поэтому принудительное обслуживание следует ограничить ситуациями, когда возможная потеря данных приемлема, но важна доступность базы данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-171">Therefore, you should limit forced service to situations where possible data loss is acceptable and immediate database availability is critical.</span></span> <span data-ttu-id="c9307-172">Сведения о том, как выполняется принудительное обслуживание, и об оптимальных методах его использования см. в разделе [Переключение ролей во время сеанса зеркального отображения базы данных (SQL Server)](role-switching-during-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-172">For information on how forced service works and on best practices for using it, see [Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span></span>  
  
##  <a name="synchronous-database-mirroring-high-safety-mode"></a><a name="Sync"></a> <span data-ttu-id="c9307-173">Синхронное зеркальное отображение базы данных (режим высокой безопасности)</span><span class="sxs-lookup"><span data-stu-id="c9307-173">Synchronous Database Mirroring (High-Safety Mode)</span></span>  
 <span data-ttu-id="c9307-174">В этом разделе описываются принципы работы синхронного зеркального отображения базы данных, включая альтернативные режимы повышенной безопасности (с автоматическим переходом на другой ресурс и без автоматического перехода на другой ресурс), а также содержатся сведения о роли следящего сервера в автоматическом переходе на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="c9307-174">This section describes how synchronous database mirroring works, including the alternative high-safety modes (with automatic failover and without automatic failover), and contains information about the role of the witness in automatic failover.</span></span>  
  
 <span data-ttu-id="c9307-175">Если параметр безопасности транзакций установлен в значение FULL, сеанс зеркального отображения базы данных выполняется в режиме высокой безопасности и после начальной синхронизации работает в синхронном режиме.</span><span class="sxs-lookup"><span data-stu-id="c9307-175">When transaction safety is set to FULL, the database mirroring session runs in high-safety mode and operates synchronously after an initial synchronizing phase.</span></span> <span data-ttu-id="c9307-176">В этом разделе описываются подробности сеансов зеркального отображения базы данных, которые конфигурируются для выполнения в синхронном режиме.</span><span class="sxs-lookup"><span data-stu-id="c9307-176">This section describes the details of database mirroring sessions that are configured for synchronous operation.</span></span>  
  
 <span data-ttu-id="c9307-177">Чтобы сеанс проходил в синхронном режиме, зеркальный сервер должен синхронизировать зеркальную базу данных с основной базой данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-177">To achieve synchronous operation for a session, the mirror server must synchronize the mirror database with the principal database.</span></span> <span data-ttu-id="c9307-178">С началом сеанса сервер участника начинает передачу своего активного журнала зеркальному серверу.</span><span class="sxs-lookup"><span data-stu-id="c9307-178">When the session begins, the principal server begins sending its active log to the mirror server.</span></span> <span data-ttu-id="c9307-179">Зеркальный сервер записывает все поступающие записи журнала на диск с максимально возможной скоростью.</span><span class="sxs-lookup"><span data-stu-id="c9307-179">The mirror server writes all of the incoming log records to disk as quickly as possible.</span></span> <span data-ttu-id="c9307-180">Как только все полученные записи журнала оказываются записанными на диск, происходит синхронизация баз данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-180">As soon as all of the received log records have been written to disk, the databases are synchronized.</span></span> <span data-ttu-id="c9307-181">До тех пор пока связь между участниками не прекращается, синхронизация баз данных сохраняется.</span><span class="sxs-lookup"><span data-stu-id="c9307-181">As long as the partners remain in communication, the databases remain synchronized.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c9307-182">Для контроля за изменениями состояния в сеансе зеркального отображения базы данных воспользуйтесь классом событий **Database Mirroring State Change** .</span><span class="sxs-lookup"><span data-stu-id="c9307-182">To monitor state changes in a database mirroring session, use the **Database Mirroring State Change** event class.</span></span> <span data-ttu-id="c9307-183">Дополнительные сведения см. в статье [Database Mirroring State Change Event Class](../../relational-databases/event-classes/database-mirroring-state-change-event-class.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-183">For more information, see [Database Mirroring State Change Event Class](../../relational-databases/event-classes/database-mirroring-state-change-event-class.md).</span></span>  
  
 <span data-ttu-id="c9307-184">После завершения синхронизации любая транзакция, зафиксированная в основной базе данных, фиксируется и на зеркальном сервере, что гарантирует защиту данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-184">After synchronization finishes, every transaction committed on the principal database is also committed on the mirror server, guaranteeing protection of the data.</span></span> <span data-ttu-id="c9307-185">Это достигается за счет того, что транзакция не фиксируется в базе данных участника до тех пор, пока сервер участника не получит от зеркального сервера сообщение, подтверждающее, что последний записал журнал транзакции на диск.</span><span class="sxs-lookup"><span data-stu-id="c9307-185">This is achieved by waiting to commit a transaction on the principal database, until the principal server receives a message from the mirror server stating that it has hardened the transaction's log to disk.</span></span> <span data-ttu-id="c9307-186">Отметим, что время ожидания этого сообщения приводит к увеличению задержки транзакции.</span><span class="sxs-lookup"><span data-stu-id="c9307-186">Note the wait for this message increases the latency of the transaction.</span></span>  
  
 <span data-ttu-id="c9307-187">Время, необходимое для выполнения синхронизации, зависит главным образом от того, насколько зеркальная база данных отставала от базы данных участника в начале сеанса (отставание измеряется числом журнальных записей, первоначально полученных от сервера участника), от рабочей нагрузки на базу данных участника и от быстродействия системы зеркального отображения.</span><span class="sxs-lookup"><span data-stu-id="c9307-187">The time required for synchronization depends essentially on how far the mirror database was behind the principal database at the start of the session (measured by the number of log records initially received from the principal server), the work load on the principal database, and the speed of the mirror system.</span></span> <span data-ttu-id="c9307-188">По завершении синхронизации сеанса зафиксированный журнал, который еще должен быть перезаписан в зеркальную базу данных, остается в очереди повтора.</span><span class="sxs-lookup"><span data-stu-id="c9307-188">After a session is synchronized, the hardened log that has yet to be redone on the mirror database remains in the redo queue.</span></span>  
  
 <span data-ttu-id="c9307-189">Как только процесс синхронизации зеркальной базы данных завершается, состояние обеих копий базы данных изменяется на SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="c9307-189">As soon as the mirror database becomes synchronized, the state of both the copies of the database changes to SYNCHRONIZED.</span></span>  
  
 <span data-ttu-id="c9307-190">Синхронность операции достигается следующим образом.</span><span class="sxs-lookup"><span data-stu-id="c9307-190">Synchronous operation is maintained in the following manner:</span></span>  
  
1.  <span data-ttu-id="c9307-191">Получив транзакцию от клиента, основной сервер записывает ее в журнал транзакций.</span><span class="sxs-lookup"><span data-stu-id="c9307-191">On receiving a transaction from a client, the principal server writes the log for the transaction to the transaction log.</span></span>  
  
2.  <span data-ttu-id="c9307-192">Основной сервер записывает транзакцию в базу данных и одновременно направляет журнальную запись зеркальному серверу.</span><span class="sxs-lookup"><span data-stu-id="c9307-192">The principal server writes the transaction to the database and, concurrently, sends the log record to the mirror server.</span></span> <span data-ttu-id="c9307-193">Основной сервер ждет, пока от зеркального сервера поступит подтверждение, после чего направляет клиенту одно из следующих подтверждений: о фиксации или откате транзакции.</span><span class="sxs-lookup"><span data-stu-id="c9307-193">The principal server waits for an acknowledgement from the mirror server before confirming either of the following to the client: a transaction commit or a rollback.</span></span>  
  
3.  <span data-ttu-id="c9307-194">Зеркальный сервер записывает журнал на диск и возвращает подтверждение основному серверу.</span><span class="sxs-lookup"><span data-stu-id="c9307-194">The mirror server hardens the log to disk and returns an acknowledgement to the principal server.</span></span>  
  
4.  <span data-ttu-id="c9307-195">Получив подтверждение от зеркального сервера, основной сервер направляет клиенту сообщение с подтверждением.</span><span class="sxs-lookup"><span data-stu-id="c9307-195">On receiving the acknowledgement from the mirror server, the principal server sends a confirmation message to the client.</span></span>  
  
 <span data-ttu-id="c9307-196">В режиме высокой безопасности данные защищаются за счет их синхронизации в двух местах хранения.</span><span class="sxs-lookup"><span data-stu-id="c9307-196">High-safety mode protects your data by requiring the data to be synchronized between two places.</span></span> <span data-ttu-id="c9307-197">Гарантируется запись всех зафиксированных транзакций на диск зеркального сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-197">All the committed transactions are guaranteed to be written to disk on the mirror server.</span></span>  
  

  
###  <a name="high-safety-mode-without-automatic-failover"></a><a name="HighSafetyWithOutAutoFailover"></a> <span data-ttu-id="c9307-198">Режим высокой безопасности без автоматического перехода на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="c9307-198">High-Safety Mode Without Automatic Failover</span></span>  
 <span data-ttu-id="c9307-199">На следующем рисунке показана конфигурация режима высокой безопасности без автоматического перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="c9307-199">The following figure shows the configuration of high-safety mode without automatic failover.</span></span> <span data-ttu-id="c9307-200">Эта конфигурация содержит только двух участников.</span><span class="sxs-lookup"><span data-stu-id="c9307-200">The configuration consists of only the two partners.</span></span>  
  
 <span data-ttu-id="c9307-201">![Взаимодействие участников без следящего сервера](../media/dbm-high-protection-mode.gif "Взаимодействие участников без следящего сервера")</span><span class="sxs-lookup"><span data-stu-id="c9307-201">![Partners communicating without a witness](../media/dbm-high-protection-mode.gif "Partners communicating without a witness")</span></span>  
  
 <span data-ttu-id="c9307-202">Если между участниками имеется соединение, а база данных синхронизирована, поддерживается отработка отказа вручную.</span><span class="sxs-lookup"><span data-stu-id="c9307-202">When the partners are connected and the database is already synchronized, manual failover is supported.</span></span> <span data-ttu-id="c9307-203">Если экземпляр зеркального сервера отключен, это не влияет на экземпляр основного сервера, который остается работать в незащищенном режиме (без зеркального отображения данных).</span><span class="sxs-lookup"><span data-stu-id="c9307-203">If the mirror server instance goes down, the principal server instance is unaffected and runs exposed (that is without mirroring the data).</span></span> <span data-ttu-id="c9307-204">При выходе из строя основного сервера зеркальный сервер приостанавливается, но обслуживание может быть принудительно перенесено на него (с возможной потерей данных).</span><span class="sxs-lookup"><span data-stu-id="c9307-204">If the principal server is lost, the mirror is suspended, but service can be forced to the mirror server (with possible data loss).</span></span> <span data-ttu-id="c9307-205">Дополнительные сведения см. в статье [Переключение ролей во время сеанса зеркального отображения базы данных (SQL Server)](role-switching-during-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-205">For more information, see [Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span></span>  
  
###  <a name="high-safety-mode-with-automatic-failover"></a><a name="HighSafetyWithAutoFailover"></a> <span data-ttu-id="c9307-206">Режим высокой безопасности с автоматическим переходом на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="c9307-206">High-Safety Mode with Automatic Failover</span></span>  
 <span data-ttu-id="c9307-207">Автоматический переход на другой ресурс обеспечивает высокий уровень доступности за счет того, что обслуживание базы данных продолжается после выхода из строя одного сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-207">Automatic failover provides high availability by ensuring that the database is still served after the loss of one server.</span></span> <span data-ttu-id="c9307-208">При использовании режима автоматической отработки отказа в сеансе должен присутствовать третий экземпляр сервера, *следящий сервер*, который в идеальном случае должен находиться на третьем компьютере.</span><span class="sxs-lookup"><span data-stu-id="c9307-208">Automatic failover requires that the session possess a third server instance, the *witness*, which ideally resides on a third computer.</span></span> <span data-ttu-id="c9307-209">На следующем рисунке показана конфигурация сеанса режима высокой безопасности с автоматической отработкой отказа.</span><span class="sxs-lookup"><span data-stu-id="c9307-209">The following figure shows the configuration of a high-safety mode session that supports automatic failover.</span></span>  
  
 <span data-ttu-id="c9307-210">![Следящий сервер и два участника сеанса](../media/dbm-high-availability-mode.gif "Следящий сервер и два участника сеанса")</span><span class="sxs-lookup"><span data-stu-id="c9307-210">![The witness and two partners of a session](../media/dbm-high-availability-mode.gif "The witness and two partners of a session")</span></span>  
  
 <span data-ttu-id="c9307-211">В отличие от двух участников зеркального отображения, следящий сервер не обслуживает базу данных.</span><span class="sxs-lookup"><span data-stu-id="c9307-211">Unlike the two partners, the witness does not serve the database.</span></span> <span data-ttu-id="c9307-212">Следящий сервер только поддерживает автоматическую отработку отказа, проверяя готовность и функциональность основного сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-212">The witness simply supports automatic failover by verifying whether the principal server is up and functioning.</span></span> <span data-ttu-id="c9307-213">Зеркальный сервер запускает автоматический переход на другой ресурс только в случае сохранения связи между зеркальным и следящим серверами после отключения обоих серверов от основного сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-213">The mirror server initiates automatic failover only if the mirror and the witness remain connected to each other after both have been disconnected from the principal server.</span></span>  
  
 <span data-ttu-id="c9307-214">При наличии следящего сервера для сеанса должен быть установлен *кворум* — связь между как минимум двумя экземплярами сервера, которая позволяет перевести базу данных в доступный режим.</span><span class="sxs-lookup"><span data-stu-id="c9307-214">When a witness is set, the session requires *quorum*-a relationship between at least two server instances that allows the database to be made available.</span></span> <span data-ttu-id="c9307-215">Дополнительные сведения см. в разделе [Следящий сервер зеркального отображения базы данных](database-mirroring-witness.md) и [Кворум. Как следящий сервер влияет на доступность базы данных &#40;зеркальное отображение базы данных&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-215">For more information, see [Database Mirroring Witness](database-mirroring-witness.md) and [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
 <span data-ttu-id="c9307-216">Чтобы произвести автоматический переход на другой ресурс, необходимо выполнение следующих условий.</span><span class="sxs-lookup"><span data-stu-id="c9307-216">Automatic failover requires the following conditions:</span></span>  
  
-   <span data-ttu-id="c9307-217">База данных должна быть синхронизирована.</span><span class="sxs-lookup"><span data-stu-id="c9307-217">The database is already synchronized.</span></span>  
  
-   <span data-ttu-id="c9307-218">Сбой должен произойти, когда все три экземпляра серверов соединены, при этом после сбоя должно остаться соединение между следящим и зеркальным серверами.</span><span class="sxs-lookup"><span data-stu-id="c9307-218">The failure occurs while all three server instances are connected, and the witness and mirror server remain connected.</span></span>  
  
 <span data-ttu-id="c9307-219">Потеря участника приведет к следующим последствиям.</span><span class="sxs-lookup"><span data-stu-id="c9307-219">The loss of a partner has the following effect:</span></span>  
  
-   <span data-ttu-id="c9307-220">Если основной сервер становится недоступным при описанных выше условиях, происходит автоматическая отработка отказа.</span><span class="sxs-lookup"><span data-stu-id="c9307-220">If the principal server becomes unavailable under the above conditions, automatic failover occurs.</span></span> <span data-ttu-id="c9307-221">Зеркальный сервер начинает выполнять функции сервера участника и предлагает свою базу данных как основную.</span><span class="sxs-lookup"><span data-stu-id="c9307-221">The mirror server switches to the role of principal, and it offers its database as the principal database.</span></span>  
  
-   <span data-ttu-id="c9307-222">Если основной сервер становится недоступным, а описанные выше условия не выполняются, возможно принудительное обслуживание (с возможной потерей данных).</span><span class="sxs-lookup"><span data-stu-id="c9307-222">If the principal server becomes unavailable when those conditions are not met, forcing service (with possible data loss) might be possible.</span></span> <span data-ttu-id="c9307-223">Дополнительные сведения см. в статье [Переключение ролей во время сеанса зеркального отображения базы данных (SQL Server)](role-switching-during-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-223">For more information, see [Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span></span>  
  
-   <span data-ttu-id="c9307-224">Если становится недоступным только зеркальный сервер, сервер участника и следящий сервер продолжают работу.</span><span class="sxs-lookup"><span data-stu-id="c9307-224">If the only mirror server becomes unavailable, the principal and witness continue.</span></span>  
  
 <span data-ttu-id="c9307-225">Если сеанс теряет следящий сервер, для кворума необходимы оба участника.</span><span class="sxs-lookup"><span data-stu-id="c9307-225">If the session loses its witness, quorum requires both partners.</span></span> <span data-ttu-id="c9307-226">Если один из участников теряет кворум, то кворум теряется обоими участниками, и база данных становится недоступной до восстановления кворума.</span><span class="sxs-lookup"><span data-stu-id="c9307-226">If either partner loses quorum, both partners lose quorum, and the database becomes unavailable until quorum is re-established.</span></span> <span data-ttu-id="c9307-227">Эти требования для кворума гарантируют, что при отсутствии следящего сервера база данных никогда не будет работать *в незащищенном режиме*, т.е. без зеркального отображения.</span><span class="sxs-lookup"><span data-stu-id="c9307-227">This quorum requirement makes sure that in the absence of a witness the database never runs *exposed*, that is without being mirrored.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c9307-228">Если ожидается, что следящий сервер будет оставаться отключенным в течение значительного промежутка времени, рекомендуется удалить следящий сервер из сеанса до тех пор, пока он не будет доступен.</span><span class="sxs-lookup"><span data-stu-id="c9307-228">If you expect the witness to remain disconnected for a significant amount of time, we recommend that you remove the witness from the session until it becomes available.</span></span>  
  
##  <a name="transact-sql-settings-and-database-mirroring-operating-modes"></a><a name="TsqlSettingsAndOpModes"></a> <span data-ttu-id="c9307-229">Настройки Transact-SQL и режимы зеркального отображения базы данных</span><span class="sxs-lookup"><span data-stu-id="c9307-229">Transact-SQL Settings and Database Mirroring Operating Modes</span></span>  
 <span data-ttu-id="c9307-230">В этом разделе описывается сеанс зеркального отображения базы данных в терминах параметров инструкции ALTER DATABASE, а также состояния зеркальной базы данных и следящего сервера, если они присутствуют.</span><span class="sxs-lookup"><span data-stu-id="c9307-230">This section describes a database mirroring session in terms of the ALTER DATABASE settings and states of the mirrored database and witness, if any.</span></span> <span data-ttu-id="c9307-231">Раздел предназначен для пользователей, которые управляют зеркальным отображением базы данных целиком или частично с помощью [!INCLUDE[tsql](../../includes/tsql-md.md)], а не в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c9307-231">The section is aimed at users who manage database mirroring primarily or exclusively using [!INCLUDE[tsql](../../includes/tsql-md.md)], rather than using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="c9307-232">В качестве альтернативы языку [!INCLUDE[tsql](../../includes/tsql-md.md)]управление рабочим режимом сеанса в обозревателе объектов может осуществляться на странице **Зеркальное отображение** диалогового окна **Свойства базы данных** .</span><span class="sxs-lookup"><span data-stu-id="c9307-232">As an alternative to using [!INCLUDE[tsql](../../includes/tsql-md.md)], you can control the operating mode of a session in Object Explorer using the **Mirroring** page of the **Database Properties** dialog box.</span></span> <span data-ttu-id="c9307-233">Дополнительные сведения см. в подразделе [Создание сеанса зеркального отображения базы данных с использованием проверки подлинности Windows (среда SQL Server Management Studio)](establish-database-mirroring-session-windows-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-233">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span></span>  
  

  
###  <a name="how-transaction-safety-and-witness-state-affect-the-operating-mode"></a><a name="TxnSafetyAndWitness"></a> <span data-ttu-id="c9307-234">Влияние безопасности транзакций и состояния следящего сервера на режим работы</span><span class="sxs-lookup"><span data-stu-id="c9307-234">How Transaction Safety and Witness State Affect the Operating Mode</span></span>  
 <span data-ttu-id="c9307-235">Режим работы сеанса определяется сочетанием его настройки безопасности транзакций и состояния следящего сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-235">The operating mode of a session is determined by the combination of its transaction safety setting and the state of the witness.</span></span> <span data-ttu-id="c9307-236">Владелец базы данных может в любой момент изменить уровень безопасности транзакций, а также добавить или удалить следящий сервер.</span><span class="sxs-lookup"><span data-stu-id="c9307-236">At any time, the database owner can change the transaction safety level, and can add or remove the witness.</span></span>  
  

  
####  <a name="transaction-safety"></a><a name="TxnSafety"></a> <span data-ttu-id="c9307-237">Transaction Safety</span><span class="sxs-lookup"><span data-stu-id="c9307-237">Transaction Safety</span></span>  
 <span data-ttu-id="c9307-238">Безопасность транзакций — специфичное для зеркального отображения свойство базы данных, которое определяет, будет ли работать сеанс зеркального отображения базы данных в синхронном или асинхронном режиме.</span><span class="sxs-lookup"><span data-stu-id="c9307-238">Transaction safety is a mirroring-specific database property that determines whether a database mirroring session operates synchronously or asynchronously.</span></span> <span data-ttu-id="c9307-239">Существует два уровня безопасности: FULL и OFF.</span><span class="sxs-lookup"><span data-stu-id="c9307-239">There are two safety levels: FULL and OFF.</span></span>  
  
-   <span data-ttu-id="c9307-240">SAFETY FULL</span><span class="sxs-lookup"><span data-stu-id="c9307-240">SAFETY FULL</span></span>  
  
     <span data-ttu-id="c9307-241">При обеспечении полной безопасности транзакций (уровень FULL) сеанс работает синхронно, в режиме высокой безопасности.</span><span class="sxs-lookup"><span data-stu-id="c9307-241">Full transaction safety causes the session to operate synchronously in high-safety mode.</span></span> <span data-ttu-id="c9307-242">При наличии следящего сервера поддерживается автоматическая отработка отказа сеанса на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="c9307-242">If a witness is present, a session supports automatic failover.</span></span>  
  
     <span data-ttu-id="c9307-243">При создании сеанса инструкцией ALTER DATABASE он начинается с установки SAFETY в значение FULL. Это означает, что сеанс начинается в режиме высокой безопасности.</span><span class="sxs-lookup"><span data-stu-id="c9307-243">When you establish a session using ALTER DATABASE statements, the session begins with the SAFETY property set to FULL; that is, the session begins in high-safety mode.</span></span> <span data-ttu-id="c9307-244">После начала сеанса можно добавить следящий сервер.</span><span class="sxs-lookup"><span data-stu-id="c9307-244">After the session begins, you can add a witness.</span></span>  
  
     <span data-ttu-id="c9307-245">Дополнительные сведения см. в подразделе [Синхронное зеркальное отображение базы данных (режим повышенной безопасности)](#Sync)ранее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="c9307-245">For more information, see [Synchronous Database Mirroring (High-Safety Mode)](#Sync), earlier in this topic.</span></span>  
  
-   <span data-ttu-id="c9307-246">SAFETY OFF</span><span class="sxs-lookup"><span data-stu-id="c9307-246">SAFETY OFF</span></span>  
  
     <span data-ttu-id="c9307-247">При отключении обеспечения безопасности транзакций (уровень OFF) сеанс работает асинхронно, в высокопроизводительном режиме.</span><span class="sxs-lookup"><span data-stu-id="c9307-247">Turning off transaction safety causes the session to operate asynchronously, in high-performance mode.</span></span> <span data-ttu-id="c9307-248">Если параметр SAFETY установлен в OFF, параметр WITNESS также должен быть установлен в OFF (значение по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="c9307-248">If the SAFETY property is set to OFF, the WITNESS property should also be set to OFF (the default).</span></span> <span data-ttu-id="c9307-249">Сведения о влиянии следящего сервера на режим высокой производительности см. в подразделе [Состояние следящего сервера](#WitnessState)далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="c9307-249">For information about the impact of the witness in high-performance mode, see [The State of the Witness](#WitnessState), later in this topic.</span></span> <span data-ttu-id="c9307-250">Дополнительные сведения об эксплуатации с выключенным режимом безопасности транзакций см. в подразделе [Асинхронное зеркальное отображение баз данных (режим высокой производительности)](#VisualElement)выше в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="c9307-250">For more information about running with transaction safety turned off, see [Asynchronous Database Mirroring (High-Performance Mode)](#VisualElement), earlier in this topic.</span></span>  
  
 <span data-ttu-id="c9307-251">Параметры безопасности транзакций для каждого участника на экземпляре сервера доступны через представление каталога **sys.database_mirroring**, в столбцах **mirroring_safety_level** и **mirroring_safety_level_desc**.</span><span class="sxs-lookup"><span data-stu-id="c9307-251">The transaction safety setting of the database is recorded on each partner in the **sys.database_mirroring** catalog view in the **mirroring_safety_level** and **mirroring_safety_level_desc** columns.</span></span> <span data-ttu-id="c9307-252">Дополнительные сведения см. в разделе [sys.database_mirroring (Transact-SQL)](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c9307-252">For more information, see [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
 <span data-ttu-id="c9307-253">Владелец базы данных может в любой момент изменить уровень безопасности транзакций.</span><span class="sxs-lookup"><span data-stu-id="c9307-253">The database owner can change the transaction safety level at any time.</span></span>  
  
####  <a name="the-state-of-the-witness"></a><a name="WitnessState"></a> <span data-ttu-id="c9307-254">Состояние следящего сервера</span><span class="sxs-lookup"><span data-stu-id="c9307-254">The State of the Witness</span></span>  
 <span data-ttu-id="c9307-255">Если установлен следящий сервер, требуется кворум, поэтому состояние следящего сервера всегда имеет значение.</span><span class="sxs-lookup"><span data-stu-id="c9307-255">If a witness has been set, quorum is required, so the state of the witness is always significant.</span></span>  
  
 <span data-ttu-id="c9307-256">При наличии следящего сервера он может находиться в одном из двух состояний:</span><span class="sxs-lookup"><span data-stu-id="c9307-256">If it exists, the witness has one of two states:</span></span>  
  
-   <span data-ttu-id="c9307-257">Если следящий сервер подключен к участнику, относительно этого участника следящий сервер находится в состоянии CONNECTED и с этим участником образуется кворум.</span><span class="sxs-lookup"><span data-stu-id="c9307-257">When the witness is connected to a partner, the witness is in the CONNECTED state relative to that partner and has quorum with that partner.</span></span> <span data-ttu-id="c9307-258">В этом случае базу данных можно сделать доступной даже в случае, если один из участников недоступен.</span><span class="sxs-lookup"><span data-stu-id="c9307-258">In this case, the database can be made available, even if one of the partners is unavailable.</span></span>  
  
-   <span data-ttu-id="c9307-259">Если следящий сервер существует, но не подключен к участнику, относительно этого участника следящий сервер находится в состоянии UNKNOWN или DISCONNECTED.</span><span class="sxs-lookup"><span data-stu-id="c9307-259">When the witness exists but is not connected to a partner, the witness is in the UNKOWN or DISCONNECTED state relative to that partner.</span></span> <span data-ttu-id="c9307-260">В этом случае кворум следящего сервера с этим участником отсутствует, и если участники не подключены друг к другу, база данных становится недоступной.</span><span class="sxs-lookup"><span data-stu-id="c9307-260">In this case, the witness lacks quorum with that partner, and if the partners are not connected to each other, the database becomes unavailable.</span></span>  
  
 <span data-ttu-id="c9307-261">Дополнительные сведения о кворуме см. в разделе [Кворум. Как следящий сервер влияет на доступность базы данных &#40;зеркальное отображение базы данных&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-261">For information about quorum, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
 <span data-ttu-id="c9307-262">Состояние каждого из следящих серверов на экземпляре сервера доступно через представление каталога **sys.database_mirroring**, в столбцах **mirroring_witness_state** и **mirroring_witness_state_desc**.</span><span class="sxs-lookup"><span data-stu-id="c9307-262">The state of each witness on a server instance is recorded in the **sys.database_mirroring** catalog view in the **mirroring_witness_state** and **mirroring_witness_state_desc** columns.</span></span> <span data-ttu-id="c9307-263">Дополнительные сведения см. в разделе [sys.database_mirroring (Transact-SQL)](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c9307-263">For more information, see [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
 <span data-ttu-id="c9307-264">В следующей таблице приведены сводные данные о том, как режим работы сеанса зависит от его установки безопасности транзакций и от состояния следящего сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-264">The following table summarizes how the operating mode of a session depends upon its transaction safety setting and on state of the witness.</span></span>  
  
|<span data-ttu-id="c9307-265">Режим работы</span><span class="sxs-lookup"><span data-stu-id="c9307-265">Operating mode</span></span>|<span data-ttu-id="c9307-266">Безопасность транзакций</span><span class="sxs-lookup"><span data-stu-id="c9307-266">Transaction safety</span></span>|<span data-ttu-id="c9307-267">Состояние следящего сервера</span><span class="sxs-lookup"><span data-stu-id="c9307-267">Witness state</span></span>|  
|--------------------|------------------------|-------------------|  
|<span data-ttu-id="c9307-268">Высокопроизводительный режим</span><span class="sxs-lookup"><span data-stu-id="c9307-268">High-performance mode</span></span>|<span data-ttu-id="c9307-269">OFF</span><span class="sxs-lookup"><span data-stu-id="c9307-269">OFF</span></span>|<span data-ttu-id="c9307-270">NULL (нет следящего сервера)<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="c9307-270">NULL (no witness)<sup>2</sup></span></span>|  
|<span data-ttu-id="c9307-271">Режим высокой безопасности без автоматического перехода на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="c9307-271">High-safety mode without automatic failover</span></span>|<span data-ttu-id="c9307-272">FULL</span><span class="sxs-lookup"><span data-stu-id="c9307-272">FULL</span></span>|<span data-ttu-id="c9307-273">NULL (нет следящего сервера)</span><span class="sxs-lookup"><span data-stu-id="c9307-273">NULL (no witness)</span></span>|  
|<span data-ttu-id="c9307-274">Режим высокой безопасности с автоматической отработкой отказа<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="c9307-274">High-safety mode with automatic failover<sup>1</sup></span></span>|<span data-ttu-id="c9307-275">FULL</span><span class="sxs-lookup"><span data-stu-id="c9307-275">FULL</span></span>|<span data-ttu-id="c9307-276">CONNECTED</span><span class="sxs-lookup"><span data-stu-id="c9307-276">CONNECTED</span></span>|  
  
 <span data-ttu-id="c9307-277"><sup>1</sup> Если следящий сервер будет отключен, рекомендуется установить параметр WITNESS в OFF, пока экземпляр следящего сервера не станет доступным.</span><span class="sxs-lookup"><span data-stu-id="c9307-277"><sup>1</sup> If the witness becomes disconnected, we recommend that you set WITNESS OFF until the witness server instance becomes available.</span></span>  
  
 <span data-ttu-id="c9307-278"><sup>2</sup> если в высокопроизводительном режиме имеется следящий сервер, следящий сервер не участвует в сеансе.</span><span class="sxs-lookup"><span data-stu-id="c9307-278"><sup>2</sup> If a witness is present in high-performance mode, the witness does not participate in the session.</span></span> <span data-ttu-id="c9307-279">Но для обеспечения доступности базы данных необходимо, чтобы по крайней мере два экземпляра сервера оставались подключенными.</span><span class="sxs-lookup"><span data-stu-id="c9307-279">However, to make the database available, at least two of the server instances must remain connected.</span></span> <span data-ttu-id="c9307-280">Поэтому для сеансов, выполняющихся в высокопроизводительном режиме, рекомендуется оставить параметр WITNESS в состоянии OFF.</span><span class="sxs-lookup"><span data-stu-id="c9307-280">Therefore, we recommend keeping the WITNESS property set to OFF in high-performance mode sessions.</span></span> <span data-ttu-id="c9307-281">Дополнительные сведения см. в статье [Кворум. Как следящий сервер влияет на доступность базы данных &#40;зеркальное отображение базы данных&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="c9307-281">For more information, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
###  <a name="viewing-the-safety-setting-and-state-of-the-witness"></a><a name="ViewWitness"></a> <span data-ttu-id="c9307-282">Просмотр установки безопасности и состояния следящего сервера</span><span class="sxs-lookup"><span data-stu-id="c9307-282">Viewing the Safety Setting and State of the Witness</span></span>  
 <span data-ttu-id="c9307-283">Для просмотра настройки безопасности и состояния следящего сервера для базы данных используется представление каталога **sys.database_mirroring** .</span><span class="sxs-lookup"><span data-stu-id="c9307-283">To view the safety setting and the state of the witness for a database, use the **sys.database_mirroring** catalog view.</span></span> <span data-ttu-id="c9307-284">Соответствующие данные отображаются в следующих столбцах:</span><span class="sxs-lookup"><span data-stu-id="c9307-284">The relevant columns are as follows:</span></span>  
  
|<span data-ttu-id="c9307-285">Фактор</span><span class="sxs-lookup"><span data-stu-id="c9307-285">Factor</span></span>|<span data-ttu-id="c9307-286">Столбцы</span><span class="sxs-lookup"><span data-stu-id="c9307-286">Columns</span></span>|<span data-ttu-id="c9307-287">Описание</span><span class="sxs-lookup"><span data-stu-id="c9307-287">Description</span></span>|  
|------------|-------------|-----------------|  
|<span data-ttu-id="c9307-288">Безопасность транзакций</span><span class="sxs-lookup"><span data-stu-id="c9307-288">Transaction safety</span></span>|<span data-ttu-id="c9307-289">**mirroring_safety_level** или **mirroring_safety_level_desc**</span><span class="sxs-lookup"><span data-stu-id="c9307-289">**mirroring_safety_level** or **mirroring_safety_level_desc**</span></span>|<span data-ttu-id="c9307-290">Установка безопасности транзакций для обновления на зеркальной базе данных. Может принимать одно из следующих значений:</span><span class="sxs-lookup"><span data-stu-id="c9307-290">Transaction safety setting for updates on the mirror database, one of:</span></span><br /><br /> <span data-ttu-id="c9307-291">UNKNOWN</span><span class="sxs-lookup"><span data-stu-id="c9307-291">UNKNOWN</span></span><br /><br /> <span data-ttu-id="c9307-292">OFF</span><span class="sxs-lookup"><span data-stu-id="c9307-292">OFF</span></span><br /><br /> <span data-ttu-id="c9307-293">FULL</span><span class="sxs-lookup"><span data-stu-id="c9307-293">FULL</span></span><br /><br /> <span data-ttu-id="c9307-294">NULL = база данных находится не в режиме в сети.</span><span class="sxs-lookup"><span data-stu-id="c9307-294">NULL= database is not online.</span></span>|  
|<span data-ttu-id="c9307-295">Существует ли следящий сервер?</span><span class="sxs-lookup"><span data-stu-id="c9307-295">Does a witness exist?</span></span>|<span data-ttu-id="c9307-296">**mirroring_witness_name**</span><span class="sxs-lookup"><span data-stu-id="c9307-296">**mirroring_witness_name**</span></span>|<span data-ttu-id="c9307-297">Имя следящего сервера зеркального отображения базы данных или значение NULL, означающее, что следящий сервер не существует.</span><span class="sxs-lookup"><span data-stu-id="c9307-297">Server name of the database mirroring witness or NULL, indicating that no witness exists.</span></span>|  
|<span data-ttu-id="c9307-298">Состояние следящего сервера</span><span class="sxs-lookup"><span data-stu-id="c9307-298">Witness state</span></span>|<span data-ttu-id="c9307-299">**mirroring_witness_state** или **mirroring_witness_state_desc**</span><span class="sxs-lookup"><span data-stu-id="c9307-299">**mirroring_witness_state** or **mirroring_witness_state_desc**</span></span>|<span data-ttu-id="c9307-300">Состояние следящего сервера в базе данных этого участника:</span><span class="sxs-lookup"><span data-stu-id="c9307-300">State of the witness in the database on a given partner:</span></span><br /><br /> <span data-ttu-id="c9307-301">UNKNOWN</span><span class="sxs-lookup"><span data-stu-id="c9307-301">UNKNOWN</span></span><br /><br /> <span data-ttu-id="c9307-302">CONNECTED</span><span class="sxs-lookup"><span data-stu-id="c9307-302">CONNECTED</span></span><br /><br /> <span data-ttu-id="c9307-303">DISCONNECTED</span><span class="sxs-lookup"><span data-stu-id="c9307-303">DISCONNECTED</span></span><br /><br /> <span data-ttu-id="c9307-304">NULL = нет следящего сервера, либо база данных находится не в режиме в сети.</span><span class="sxs-lookup"><span data-stu-id="c9307-304">NULL = no witness exists or the database is not online.</span></span>|  
  
 <span data-ttu-id="c9307-305">Например, на основном или на зеркальном сервере введите:</span><span class="sxs-lookup"><span data-stu-id="c9307-305">For example, on either the principal or mirror server, enter:</span></span>  
  
```  
SELECT mirroring_safety_level_desc, mirroring_witness_name, mirroring_witness_state_desc FROM sys.database_mirroring  
```  
  
 <span data-ttu-id="c9307-306">Дополнительные сведения о представлении каталога см. в разделе [sys.database_mirroring (Transact-SQL)](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c9307-306">For more information about this catalog view, see [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
###  <a name="factors-affecting-behavior-on-loss-of-the-principal-server"></a><a name="FactorsOnLossOfPrincipal"></a> <span data-ttu-id="c9307-307">Факторы, влияющие на работу в случае потери основного сервера</span><span class="sxs-lookup"><span data-stu-id="c9307-307">Factors Affecting Behavior on Loss of the Principal Server</span></span>  
 <span data-ttu-id="c9307-308">В следующей таблице сведены данные о воздействии установки безопасности транзакций, состояния базы данных и состояния следящего сервера на работу сеанса зеркального отображения при потере основного сервера.</span><span class="sxs-lookup"><span data-stu-id="c9307-308">The following table summarizes the combined effect of the transaction safety setting, the state of the database, and the state of the witness on the behavior of a mirroring session on the loss of the principal server.</span></span>  
  
|<span data-ttu-id="c9307-309">Безопасность транзакций</span><span class="sxs-lookup"><span data-stu-id="c9307-309">Transaction safety</span></span>|<span data-ttu-id="c9307-310">Состояние зеркального отображения зеркальной базы данных</span><span class="sxs-lookup"><span data-stu-id="c9307-310">Mirroring state of mirror database</span></span>|<span data-ttu-id="c9307-311">Состояние следящего сервера</span><span class="sxs-lookup"><span data-stu-id="c9307-311">Witness state</span></span>|<span data-ttu-id="c9307-312">Действия в случае потери связи с основным сервером</span><span class="sxs-lookup"><span data-stu-id="c9307-312">Behavior when principal is lost</span></span>|  
|------------------------|----------------------------------------|-------------------|-------------------------------------|  
|<span data-ttu-id="c9307-313">FULL</span><span class="sxs-lookup"><span data-stu-id="c9307-313">FULL</span></span>|<span data-ttu-id="c9307-314">SYNCHRONIZED</span><span class="sxs-lookup"><span data-stu-id="c9307-314">SYNCHRONIZED</span></span>|<span data-ttu-id="c9307-315">CONNECTED</span><span class="sxs-lookup"><span data-stu-id="c9307-315">CONNECTED</span></span>|<span data-ttu-id="c9307-316">Производится автоматическая отработка отказа.</span><span class="sxs-lookup"><span data-stu-id="c9307-316">Automatic failover occurs.</span></span>|  
|<span data-ttu-id="c9307-317">FULL</span><span class="sxs-lookup"><span data-stu-id="c9307-317">FULL</span></span>|<span data-ttu-id="c9307-318">SYNCHRONIZED</span><span class="sxs-lookup"><span data-stu-id="c9307-318">SYNCHRONIZED</span></span>|<span data-ttu-id="c9307-319">DISCONNECTED</span><span class="sxs-lookup"><span data-stu-id="c9307-319">DISCONNECTED</span></span>|<span data-ttu-id="c9307-320">Зеркальный сервер останавливается; отработка отказа невозможна, и база данных не может стать доступной.</span><span class="sxs-lookup"><span data-stu-id="c9307-320">Mirror server stops; failover is not possible, and the database cannot be made available.</span></span>|  
|<span data-ttu-id="c9307-321">OFF</span><span class="sxs-lookup"><span data-stu-id="c9307-321">OFF</span></span>|<span data-ttu-id="c9307-322">SUSPENDED или DISCONNECTED</span><span class="sxs-lookup"><span data-stu-id="c9307-322">SUSPENDED or DISCONNECTED</span></span>|<span data-ttu-id="c9307-323">NULL (нет следящего сервера)</span><span class="sxs-lookup"><span data-stu-id="c9307-323">NULL (no witness)</span></span>|<span data-ttu-id="c9307-324">Обслуживание может быть принудительно переключено на зеркальный сервер (с возможностью потери данных).</span><span class="sxs-lookup"><span data-stu-id="c9307-324">Service can be forced to the mirror server (with possible data loss).</span></span>|  
|<span data-ttu-id="c9307-325">FULL</span><span class="sxs-lookup"><span data-stu-id="c9307-325">FULL</span></span>|<span data-ttu-id="c9307-326">SYNCHRONIZING или SUSPENDED</span><span class="sxs-lookup"><span data-stu-id="c9307-326">SYNCHRONIZING or SUSPENDED</span></span>|<span data-ttu-id="c9307-327">NULL (нет следящего сервера)</span><span class="sxs-lookup"><span data-stu-id="c9307-327">NULL (no witness)</span></span>|<span data-ttu-id="c9307-328">Обслуживание может быть принудительно переключено на зеркальный сервер (с возможностью потери данных).</span><span class="sxs-lookup"><span data-stu-id="c9307-328">Service can be forced to the mirror server (with possible data loss).</span></span>|  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="c9307-329">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="c9307-329">Related Tasks</span></span>  
  
-   [<span data-ttu-id="c9307-330">Добавление или замена следящего сервера зеркального отображения базы данных (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="c9307-330">Add or Replace a Database Mirroring Witness &#40;SQL Server Management Studio&#41;</span></span>](../database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="c9307-331">Создание сеанса зеркального отображения базы данных с использованием проверки подлинности Windows (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="c9307-331">Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;</span></span>](establish-database-mirroring-session-windows-authentication.md)  
  
-   [<span data-ttu-id="c9307-332">Добавление следящего сервера для зеркального отображения базы данных с использованием проверки подлинности Windows (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="c9307-332">Add a Database Mirroring Witness Using Windows Authentication &#40;Transact-SQL&#41;</span></span>](add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
-   [<span data-ttu-id="c9307-333">Удаление следящего сервера из сеанса зеркального отображения базы данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c9307-333">Remove the Witness from a Database Mirroring Session &#40;SQL Server&#41;</span></span>](remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
-   [<span data-ttu-id="c9307-334">Изменение безопасности транзакций в сеансах зеркального отображения базы данных (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="c9307-334">Change Transaction Safety in a Database Mirroring Session &#40;Transact-SQL&#41;</span></span>](change-transaction-safety-in-a-database-mirroring-session-transact-sql.md)  
  
## <a name="see-also"></a><span data-ttu-id="c9307-335">См. также:</span><span class="sxs-lookup"><span data-stu-id="c9307-335">See Also</span></span>  
 <span data-ttu-id="c9307-336">[Мониторинг зеркального отображения базы данных (SQL Server)](monitoring-database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="c9307-336">[Monitoring Database Mirroring &#40;SQL Server&#41;](monitoring-database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="c9307-337">Следящий сервер зеркального отображения базы данных</span><span class="sxs-lookup"><span data-stu-id="c9307-337">Database Mirroring Witness</span></span>](database-mirroring-witness.md)  
