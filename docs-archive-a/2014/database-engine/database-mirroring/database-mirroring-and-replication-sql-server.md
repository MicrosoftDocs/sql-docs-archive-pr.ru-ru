---
title: Зеркальное отображение и репликация баз данных (SQL Server) | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- replication [SQL Server], database mirroring and
ms.assetid: 82796217-02e2-4bc5-9ab5-218bae11a2d6
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: b126aeb8ccd24932706b8798ebfe7088308918e2
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87736767"
---
# <a name="database-mirroring-and-replication-sql-server"></a><span data-ttu-id="cb398-102">Зеркальное отображение и репликация баз данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="cb398-102">Database Mirroring and Replication (SQL Server)</span></span>
  <span data-ttu-id="cb398-103">Зеркальное отображение базы данных может использоваться совместно с репликацией для повышения доступности базы данных публикации.</span><span class="sxs-lookup"><span data-stu-id="cb398-103">Database mirroring can be used in conjunction with replication to improve availability for the publication database.</span></span> <span data-ttu-id="cb398-104">В зеркальном отображении базы данных участвуют две копии одной базы данных, которые обычно расположены на разных компьютерах.</span><span class="sxs-lookup"><span data-stu-id="cb398-104">Database mirroring involves two copies of a single database that typically reside on different computers.</span></span> <span data-ttu-id="cb398-105">В любой момент только одна копия базы данных доступна клиентам.</span><span class="sxs-lookup"><span data-stu-id="cb398-105">At any given time, only one copy of the database is currently available to clients.</span></span> <span data-ttu-id="cb398-106">Эта копия называется основной базой данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-106">This copy is known as the principal database.</span></span> <span data-ttu-id="cb398-107">Обновления, вносимые клиентами в основную базу данных, применяются к другой копии базы данных, называемой зеркальной базой данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-107">Updates made by clients to the principal database are applied on the other copy of the database, known as the mirror database.</span></span> <span data-ttu-id="cb398-108">Зеркальное отображение включает применение к зеркальной базе данных журнала транзакций всех вставок, обновлений или удалений, выполненных в основной базе данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-108">Mirroring involves applying the transaction log from every insertion, update, or deletion made on the principal database onto the mirror database.</span></span>  
  
 <span data-ttu-id="cb398-109">Переход репликации на зеркальную базу данных полностью поддерживается для баз данных публикации, с ограниченной поддержкой для баз данных подписки.</span><span class="sxs-lookup"><span data-stu-id="cb398-109">Replication failover to a mirror is fully supported for publication databases, with limited support for subscription databases.</span></span> <span data-ttu-id="cb398-110">Зеркальное отображение баз данных не поддерживается для базы данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="cb398-110">Database mirroring is not supported for the distribution database.</span></span> <span data-ttu-id="cb398-111">Сведения о восстановлении базы данных распространителя или базы данных подписки без перенастройки репликации см. в статье [Создание резервной копии и восстановление из копий реплицируемых баз данных](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span><span class="sxs-lookup"><span data-stu-id="cb398-111">For information about recovering a distribution database or subscription database without any need to reconfigure replication, see [Back Up and Restore Replicated Databases](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span></span> <span data-ttu-id="cb398-112">Дополнительные сведения о зеркальном отображении базы данных подписчика см. в разделе</span><span class="sxs-lookup"><span data-stu-id="cb398-112">For information about mirroring the subscriber database, see the</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="cb398-113">После перехода на зеркальную базу данных в результате отработки отказа основной базы данных зеркальная база данных становится основной.</span><span class="sxs-lookup"><span data-stu-id="cb398-113">After a failover, the mirror becomes the principal.</span></span> <span data-ttu-id="cb398-114">В этом разделе термины «основная» и «зеркальная» всегда относятся к исходной основной и зеркальной базе данных соответственно.</span><span class="sxs-lookup"><span data-stu-id="cb398-114">In this topic, "principal" and "mirror" always refer to the original principal and mirror.</span></span>  
  
## <a name="requirements-and-considerations-for-using-replication-with-database-mirroring"></a><span data-ttu-id="cb398-115">Требования и дополнительные соображения по использованию репликации с зеркальным отображением базы данных</span><span class="sxs-lookup"><span data-stu-id="cb398-115">Requirements and Considerations for Using Replication with Database Mirroring</span></span>  
 <span data-ttu-id="cb398-116">При использовании репликации совместно с зеркальным отображением базы данных помните о следующих требованиях и правилах.</span><span class="sxs-lookup"><span data-stu-id="cb398-116">Be aware of the following requirements and considerations when using replication with database mirroring:</span></span>  
  
-   <span data-ttu-id="cb398-117">Основная и зеркальная базы данных должны совместно использовать распространитель.</span><span class="sxs-lookup"><span data-stu-id="cb398-117">The principal and mirror must share a Distributor.</span></span> <span data-ttu-id="cb398-118">Рекомендуется, чтобы это был удаленный распространитель, который обеспечивает большую устойчивость к отказам в ситуации, когда на издателе при сбое происходит незапланированная отработка отказа.</span><span class="sxs-lookup"><span data-stu-id="cb398-118">We recommend that this be a remote Distributor, which provides greater fault tolerance if the Publisher has an unplanned failover.</span></span>  
  
-   <span data-ttu-id="cb398-119">Репликация поддерживает зеркальное отображение базы данных публикации для репликации слиянием и репликации транзакций с подписчиками, доступными только для чтения, или с подписчиками, обновляемыми посредством очередей.</span><span class="sxs-lookup"><span data-stu-id="cb398-119">Replication supports mirroring the publication database for merge replication and for transactional replication with read-only Subscribers or queued updating Subscribers.</span></span> <span data-ttu-id="cb398-120">Подписчики с немедленным обновлением, издатели Oracle, издатели в одноранговой топологии, а также переиздание не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="cb398-120">Immediate updating Subscribers, Oracle Publishers, Publishers in a peer-to-peer topology, and republishing are not supported.</span></span>  
  
-   <span data-ttu-id="cb398-121">Метаданные и объекты, которые существуют за пределами базы данных, не копируются на зеркало. Это касается имен входа, заданий, связанных серверов и так далее.</span><span class="sxs-lookup"><span data-stu-id="cb398-121">Metadata and objects that exist outside the database are not copied to the mirror, including logins, jobs, linked servers, and so on.</span></span> <span data-ttu-id="cb398-122">Если в зеркальной базе данных нужны метаданные и объекты, их необходимо скопировать вручную.</span><span class="sxs-lookup"><span data-stu-id="cb398-122">If you require the metadata and objects at the mirror, you must copy them manually.</span></span> <span data-ttu-id="cb398-123">Дополнительные сведения см. в статье [Управление именами входа и заданиями после переключения ролей (SQL Server)](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="cb398-123">For more information, see [Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span></span>  
  
## <a name="configuring-replication-with-database-mirroring"></a><span data-ttu-id="cb398-124">Настройка репликации с зеркальным отображением базы данных</span><span class="sxs-lookup"><span data-stu-id="cb398-124">Configuring Replication with Database Mirroring</span></span>  
 <span data-ttu-id="cb398-125">Настройка репликации и зеркального отображения базы данных состоит из пяти шагов.</span><span class="sxs-lookup"><span data-stu-id="cb398-125">Configuring replication and database mirroring involves five steps.</span></span> <span data-ttu-id="cb398-126">Каждый шаг описывается в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="cb398-126">Each step is described in more detail in the following section.</span></span>  
  
1.  <span data-ttu-id="cb398-127">Настройка издателя.</span><span class="sxs-lookup"><span data-stu-id="cb398-127">Configure the Publisher.</span></span>  
  
2.  <span data-ttu-id="cb398-128">Настройка зеркального отображения базы данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-128">Configure database mirroring.</span></span>  
  
3.  <span data-ttu-id="cb398-129">Настройка зеркала для использования вместе с основной базой данных одного и того же распространителя.</span><span class="sxs-lookup"><span data-stu-id="cb398-129">Configure the mirror to use the same Distributor as the principal.</span></span>  
  
4.  <span data-ttu-id="cb398-130">Настройка агентов репликации для перехода на зеркальную базу в случае отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="cb398-130">Configure replication agents for failover.</span></span>  
  
5.  <span data-ttu-id="cb398-131">Добавление основной и зеркальной базы данных в монитор репликации.</span><span class="sxs-lookup"><span data-stu-id="cb398-131">Add the principal and mirror to Replication Monitor.</span></span>  
  
 <span data-ttu-id="cb398-132">Шаги 1 и 2 могут быть выполнены в обратном порядке.</span><span class="sxs-lookup"><span data-stu-id="cb398-132">Steps 1 and 2 can also be performed in the opposite order.</span></span>  
  
#### <a name="to-configure-database-mirroring-for-a-publication-database"></a><span data-ttu-id="cb398-133">Настройка зеркального отображения базы данных для базы данных публикации</span><span class="sxs-lookup"><span data-stu-id="cb398-133">To configure database mirroring for a publication database</span></span>  
  
1.  <span data-ttu-id="cb398-134">Настройте издатель.</span><span class="sxs-lookup"><span data-stu-id="cb398-134">Configure the Publisher:</span></span>  
  
    1.  <span data-ttu-id="cb398-135">Рекомендуется использовать удаленный распространитель.</span><span class="sxs-lookup"><span data-stu-id="cb398-135">We recommend using a remote Distributor.</span></span> <span data-ttu-id="cb398-136">Дополнительные сведения о настройке распространения см. в статье [Настройка распространения](../../relational-databases/replication/configure-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="cb398-136">For more information about configuring distribution, see [Configure Distribution](../../relational-databases/replication/configure-distribution.md).</span></span>  
  
    2.  <span data-ttu-id="cb398-137">Базу данных можно активировать для использования публикаций моментальных снимков, публикаций транзакций или публикаций слиянием.</span><span class="sxs-lookup"><span data-stu-id="cb398-137">You can enable a database for snapshot and transactional publications and/or merge publications.</span></span> <span data-ttu-id="cb398-138">Для зеркальных баз данных, которые будут содержать более одного типа публикаций, базу данных при помощи процедуры [sp_replicationdboption](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql)следует активировать для обоих типов публикаций на том же узле.</span><span class="sxs-lookup"><span data-stu-id="cb398-138">For mirrored databases that will contain more than one type of publication, you must enable the database for both types at the same node using [sp_replicationdboption](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="cb398-139">Например, можно было бы выполнить следующие вызовы хранимых процедур в основной базе данных:</span><span class="sxs-lookup"><span data-stu-id="cb398-139">For example, you could execute the following stored procedure calls at the principal:</span></span>  
  
        ```  
        exec sp_replicationdboption @dbname='<PublicationDatabase>', @optname='publish', @value=true;  
        exec sp_replicationdboption @dbname='<PublicationDatabase>', @optname='mergepublish', @value=true;  
        ```  
  
         <span data-ttu-id="cb398-140">Дополнительные сведения о создании публикаций см. в статье [Публикация данных и объектов базы данных](../../relational-databases/replication/publish/publish-data-and-database-objects.md).</span><span class="sxs-lookup"><span data-stu-id="cb398-140">For more information about creating publications, see [Publish Data and Database Objects](../../relational-databases/replication/publish/publish-data-and-database-objects.md).</span></span>  
  
2.  <span data-ttu-id="cb398-141">Настройка зеркального отображения базы данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-141">Configure database mirroring.</span></span> <span data-ttu-id="cb398-142">Дополнительные сведения см. в статьях [Создание сеанса зеркального отображения базы данных с использованием проверки подлинности Windows (среда SQL Server Management Studio)](establish-database-mirroring-session-windows-authentication.md) и [Настройка зеркального отображения базы данных (SQL Server)](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="cb398-142">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) and [Setting Up Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="cb398-143">Настройте распространение для зеркальной базы данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-143">Configure distribution for the mirror.</span></span> <span data-ttu-id="cb398-144">Укажите имя зеркальной базы данных в качестве имени издателя и укажите те же самые распространитель и папку моментальных снимков, которые используются основной базой данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-144">Specify the mirror name as the Publisher, and specify the same Distributor and snapshot folder that the principal uses.</span></span> <span data-ttu-id="cb398-145">Например, если проводится настройка репликации с помощью хранимых процедур, выполните [sp_adddistpublisher](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql) на распространителе, а затем [sp_adddistributor](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) на зеркальном сервере.</span><span class="sxs-lookup"><span data-stu-id="cb398-145">For example, if you are configuring replication with stored procedures, execute [sp_adddistpublisher](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql) at the Distributor; and then execute [sp_adddistributor](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the mirror.</span></span> <span data-ttu-id="cb398-146">Для **sp_adddistpublisher**выполните следующее:</span><span class="sxs-lookup"><span data-stu-id="cb398-146">For **sp_adddistpublisher**:</span></span>  
  
    -   <span data-ttu-id="cb398-147">Присвойте **@publisher** параметру значение сетевого имени зеркала.</span><span class="sxs-lookup"><span data-stu-id="cb398-147">Set the value of the **@publisher** parameter to the network name of the mirror.</span></span>  
  
    -   <span data-ttu-id="cb398-148">Установите значение **@working_directory** параметра в папку моментальных снимков, используемую основным сервером.</span><span class="sxs-lookup"><span data-stu-id="cb398-148">Set the value of the **@working_directory** parameter to the snapshot folder used by the principal.</span></span>  
  
4.  <span data-ttu-id="cb398-149">Укажите имя зеркала в параметре агента **–PublisherFailoverPartner**.</span><span class="sxs-lookup"><span data-stu-id="cb398-149">Specify the mirror name for the **-PublisherFailoverPartner** agent parameter.</span></span> <span data-ttu-id="cb398-150">Этот параметр требуется следующим агентам для определения зеркала после отработки отказа:</span><span class="sxs-lookup"><span data-stu-id="cb398-150">Agent This parameter is required for the following agents to identify the mirror after failover:</span></span>  
  
    -   <span data-ttu-id="cb398-151">агенту моментальных снимков (для всех публикаций);</span><span class="sxs-lookup"><span data-stu-id="cb398-151">Snapshot Agent (for all publications)</span></span>  
  
    -   <span data-ttu-id="cb398-152">агенту чтения журнала (для всех публикаций транзакций);</span><span class="sxs-lookup"><span data-stu-id="cb398-152">Log Reader Agent (for all transactional publications)</span></span>  
  
    -   <span data-ttu-id="cb398-153">агенту чтения очереди (для публикаций транзакций, которые поддерживают подписки, обновляемые посредством очередей);</span><span class="sxs-lookup"><span data-stu-id="cb398-153">Queue Reader Agent (for transactional publications that support queued updating subscriptions)</span></span>  
  
    -   <span data-ttu-id="cb398-154">агенту слияния (для подписок на публикацию слиянием);</span><span class="sxs-lookup"><span data-stu-id="cb398-154">Merge Agent (for merge subscriptions)</span></span>  
  
    -   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="cb398-155">прослушивателю репликации (replisapi.dll: для подписок на публикацию слиянием, синхронизируемых с помощью веб-синхронизации);</span><span class="sxs-lookup"><span data-stu-id="cb398-155">replication listener (replisapi.dll: for merge subscriptions synchronized using Web synchronization)</span></span>  
  
    -   <span data-ttu-id="cb398-156">элементу управления ActiveX слияния SQL (для подписок на публикацию слиянием, синхронизируемых с помощью этого элемента управления).</span><span class="sxs-lookup"><span data-stu-id="cb398-156">SQL Merge ActiveX Control (for merge subscriptions synchronized with the control)</span></span>  
  
     <span data-ttu-id="cb398-157">Агент распространителя и элемент управления ActiveX распространения не имеют этого параметра, потому что они не подключаются к издателю.</span><span class="sxs-lookup"><span data-stu-id="cb398-157">The Distribution Agent and Distribution ActiveX Control do not have this parameter because they do not connect to the Publisher.</span></span>  
  
     <span data-ttu-id="cb398-158">Изменения параметров агента вступают в действие при следующем запуске агента.</span><span class="sxs-lookup"><span data-stu-id="cb398-158">Agent parameter changes take effect the next time the agent is started.</span></span> <span data-ttu-id="cb398-159">Если агент выполняется в непрерывном режиме, следует остановить и перезапустить агент.</span><span class="sxs-lookup"><span data-stu-id="cb398-159">If the agent runs continuously, you must stop and restart the agent.</span></span> <span data-ttu-id="cb398-160">Параметры могут быть заданы в профилях агента или из командной строки.</span><span class="sxs-lookup"><span data-stu-id="cb398-160">Parameters can be specified in agent profiles and from the command prompt.</span></span> <span data-ttu-id="cb398-161">Дополнительные сведения см. в разделе:</span><span class="sxs-lookup"><span data-stu-id="cb398-161">For more information, see:</span></span>  
  
    -   [<span data-ttu-id="cb398-162">Просмотр и изменение параметров командной строки агента репликации (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="cb398-162">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../../relational-databases/replication/agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
    -   [<span data-ttu-id="cb398-163">Replication Agent Executables Concepts</span><span class="sxs-lookup"><span data-stu-id="cb398-163">Replication Agent Executables Concepts</span></span>](../../relational-databases/replication/concepts/replication-agent-executables-concepts.md)  
  
     <span data-ttu-id="cb398-164">Рекомендуется добавить параметр **–PublisherFailoverPartner** в профиль агента, а затем указать в профиле имя зеркала.</span><span class="sxs-lookup"><span data-stu-id="cb398-164">We recommend adding the **-PublisherFailoverPartner** to an agent profile, and then specifying the mirror name in the profile.</span></span> <span data-ttu-id="cb398-165">Например, если настраивается репликация с помощью хранимых процедур:</span><span class="sxs-lookup"><span data-stu-id="cb398-165">For example, if you are configuring replication with stored procedures:</span></span>  
  
    ```  
    -- Execute sp_help_agent_profile in the context of the distribution database to get the list of profiles.  
    -- Select the profile id of the profile that needs to be updated from the result set.  
    -- In the agent_type column returned by sp_help_agent_profile:   
    -- 1 = Snapshot Agent; 2 = Log Reader Agent; 3 = Distribution Agent; 4 = Merge Agent; 9 = Queue Reader Agent.  
  
    exec sp_help_agent_profile;  
  
    -- Setting the -PublisherFailoverPartner parameter in the default Snapshot Agent profile (profile 1).  
    -- Execute sp_add_agent_parameter in the context of the distribution database.  
    exec sp_add_agent_parameter @profile_id = 1, @parameter_name = N'-PublisherFailoverPartner', @parameter_value = N'<Failover Partner Name>';  
  
    -- Setting the -PublisherFailoverPartner parameter in the default Merge Agent profile (profile 6).  
    -- Execute sp_add_agent_parameter in the context of the distribution database.  
    exec sp_add_agent_parameter @profile_id = 6, @parameter_name = N'-PublisherFailoverPartner', @parameter_value = N'<Failover Partner Name>';  
    ```  
  
5.  <span data-ttu-id="cb398-166">Добавление основной и зеркальной базы данных в монитор репликации.</span><span class="sxs-lookup"><span data-stu-id="cb398-166">Add the principal and mirror to Replication Monitor.</span></span> <span data-ttu-id="cb398-167">Дополнительные сведения см. в статье [Добавление и удаление издателей в мониторе репликации](../../relational-databases/replication/monitor/add-and-remove-publishers-from-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="cb398-167">For more information, see [Add and Remove Publishers from Replication Monitor](../../relational-databases/replication/monitor/add-and-remove-publishers-from-replication-monitor.md).</span></span>  
  
## <a name="maintaining-a-mirrored-publication-database"></a><span data-ttu-id="cb398-168">Обслуживание зеркальной базы данных публикации</span><span class="sxs-lookup"><span data-stu-id="cb398-168">Maintaining a Mirrored Publication Database</span></span>  
 <span data-ttu-id="cb398-169">Обслуживание зеркальной базы данных публикации существенно не отличается от обслуживания незеркальной базы данных, со следующими оговорками.</span><span class="sxs-lookup"><span data-stu-id="cb398-169">Maintaining a mirrored publication database is essentially the same as maintaining a non-mirrored database, with the following considerations:</span></span>  
  
-   <span data-ttu-id="cb398-170">Администрирование и наблюдение должны выполняться на активном сервере.</span><span class="sxs-lookup"><span data-stu-id="cb398-170">Administration and monitoring must occur at the active server.</span></span> <span data-ttu-id="cb398-171">В среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]в папке **Локальные публикации** находятся публикации только для активного сервера.</span><span class="sxs-lookup"><span data-stu-id="cb398-171">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], publications appear under the **Local Publications** folder only for the active server.</span></span> <span data-ttu-id="cb398-172">Например, если в результате отработки отказа выполнен переход на зеркало, публикации будут отображаться на зеркале и больше не будут отображаться в основной базе данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-172">For example, if you failover to the mirror, the publications are displayed at the mirror and are no longer displayed at the principal.</span></span> <span data-ttu-id="cb398-173">Если база данных переходит на зеркальный сервер, возможно, понадобится вручную обновить среду [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] и монитор репликации, чтобы в них отображалось произошедшее изменение.</span><span class="sxs-lookup"><span data-stu-id="cb398-173">If the database fails over to the mirror, you might need to manually refresh [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] and Replication Monitor for the change to be reflected.</span></span>  
  
-   <span data-ttu-id="cb398-174">Монитор репликации отображает узлы издателя в дереве объектов как для основного, так и для зеркального сервера.</span><span class="sxs-lookup"><span data-stu-id="cb398-174">Replication Monitor displays Publisher nodes in the object tree for both the principal and the mirror.</span></span> <span data-ttu-id="cb398-175">Если активным является основной сервер, сведения о публикации отображаются в мониторе репликации только на главном узле.</span><span class="sxs-lookup"><span data-stu-id="cb398-175">If the principal is the active server, publication information is displayed only under the principal node in Replication Monitor.</span></span>  
  
     <span data-ttu-id="cb398-176">Если активным является зеркальный сервер:</span><span class="sxs-lookup"><span data-stu-id="cb398-176">If the mirror is the active server:</span></span>  
  
    -   <span data-ttu-id="cb398-177">если возникла ошибка агента, эта ошибка показывается только в основном узле и не отображается в зеркальном узле;</span><span class="sxs-lookup"><span data-stu-id="cb398-177">If an agent has an error, the error is indicated only on the principal node, not on the mirror node.</span></span>  
  
    -   <span data-ttu-id="cb398-178">если основной сервер недоступен, то в основном и зеркальном узлах отображаются идентичные списки публикаций.</span><span class="sxs-lookup"><span data-stu-id="cb398-178">If the principal is unavailable, the principal and mirror nodes display identical lists of publications.</span></span> <span data-ttu-id="cb398-179">Наблюдение должно выполняться только для публикаций на зеркальном узле.</span><span class="sxs-lookup"><span data-stu-id="cb398-179">Monitoring should be performed on the publications under the mirror node.</span></span>  
  
-   <span data-ttu-id="cb398-180">Если для администрирования репликации на зеркале используются хранимые процедуры или объекты RMO, то для случаев, когда указывается имя издателя, необходимо указать имя экземпляра, на котором база данных активирована для репликации.</span><span class="sxs-lookup"><span data-stu-id="cb398-180">When using stored procedures or Replication Management Objects (RMO) to administer replication at the mirror, for cases in which you specify the Publisher name, you must specify the name of the instance on which the database was enabled for replication.</span></span> <span data-ttu-id="cb398-181">Чтобы определить соответствующее имя, воспользуйтесь функцией [publishingservername](/sql/t-sql/functions/replication-functions-publishingservername).</span><span class="sxs-lookup"><span data-stu-id="cb398-181">To determine the appropriate name, use the function [publishingservername](/sql/t-sql/functions/replication-functions-publishingservername).</span></span>  
  
     <span data-ttu-id="cb398-182">Когда база данных публикации зеркально отображается, метаданные репликации, хранимые в зеркальной базе данных, идентичны метаданным, хранимым в основной базе данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-182">When a publication database is mirrored, the replication metadata stored in the mirrored database is identical to the metadata stored in the principal database.</span></span> <span data-ttu-id="cb398-183">Поэтому для баз данных публикации, активированных для репликации на основном сервере, имя экземпляра издателя, хранимое в системных таблицах на зеркале, является именем основного сервера, а не именем зеркала.</span><span class="sxs-lookup"><span data-stu-id="cb398-183">Consequently, for publication databases enabled for replication at the principal, the Publisher instance name stored in system tables at the mirror is the name of the principal, not the mirror.</span></span> <span data-ttu-id="cb398-184">Если в результате сбоя база данных публикации переходит на зеркальный сервер, это повлияет на настройку и обслуживание репликации.</span><span class="sxs-lookup"><span data-stu-id="cb398-184">This affects replication configuration and maintenance if the publication database fails over to the mirror.</span></span> <span data-ttu-id="cb398-185">Например, если вы настраиваете репликацию с хранимыми процедурами на зеркальном сервере после отработки отказа и хотите добавить подписку по запросу в базу данных публикации, которая была включена на основном сервере, необходимо указать имя участника, а не имя зеркала для **@publisher** параметра **sp_addpullsubscription** или **sp_addmergepullsubscription**.</span><span class="sxs-lookup"><span data-stu-id="cb398-185">For example, if you are configuring replication with stored procedures on the mirror after a failover, and you want to add a pull subscription to a publication database that was enabled at the principal, you must specify the principal name rather than the mirror name for the **@publisher** parameter of **sp_addpullsubscription** or **sp_addmergepullsubscription**.</span></span>  
  
     <span data-ttu-id="cb398-186">Если база данных публикации включается на зеркальном сервере после отработки отказа на зеркало, то имя экземпляра издателя, хранящееся в системных таблицах, является именем зеркала. в этом случае следует использовать имя зеркала для **@publisher** параметра.</span><span class="sxs-lookup"><span data-stu-id="cb398-186">If you enable a publication database at the mirror after failover to the mirror, the Publisher instance name stored in system tables is the name of the mirror; in this case, you would use the name of the mirror for the **@publisher** parameter.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="cb398-187">В некоторых случаях, например в процедуре **sp_addpublication**, параметр **@publisher** поддерживается только для издателей, не относящихся к[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , и не влияет на зеркальное отображение базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="cb398-187">In some cases, such as **sp_addpublication**, the **@publisher** parameter is supported only for non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Publishers; in these cases, it is not relevant for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database mirroring.</span></span>  
  
-   <span data-ttu-id="cb398-188">Для синхронизации подписки в среде [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] после отработки отказа необходимо синхронизировать подписки по запросу от подписчика и синхронизировать принудительные подписки от активного издателя.</span><span class="sxs-lookup"><span data-stu-id="cb398-188">To synchronize a subscription in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] after a failover: synchronize pull subscriptions from the Subscriber; and synchronize push subscriptions from the active Publisher.</span></span>  
  
### <a name="replication-behavior-if-mirroring-is-removed"></a><span data-ttu-id="cb398-189">Поведение репликации, когда зеркальное отображение удалено</span><span class="sxs-lookup"><span data-stu-id="cb398-189">Replication Behavior if Mirroring is Removed</span></span>  
 <span data-ttu-id="cb398-190">Если зеркальное отображение базы данных удаляется из опубликованной базы данных, необходимо учитывать следующие моменты.</span><span class="sxs-lookup"><span data-stu-id="cb398-190">Keep the following issues in mind if database mirroring is removed from a published database:</span></span>  
  
-   <span data-ttu-id="cb398-191">Если зеркальное отображение опубликованной базы данных на основном сервере больше не выполняется, репликация продолжает работать без изменений для исходной основной базы данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-191">If the publication database at the principal is no longer mirrored, replication continues to work unchanged against the original principal.</span></span>  
  
-   <span data-ttu-id="cb398-192">Если опубликованная база данных в результате сбоя переключается с основной на зеркальную базу данных и если связи зеркального отображения затем отключаются или удаляются, агенты репликации не будут функционировать в зеркальной базе данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-192">If the publication database fails over from the principal to the mirror and the mirroring relationship is subsequently disabled or removed, replication agents will not function against the mirror.</span></span> <span data-ttu-id="cb398-193">Если основная база данных бесповоротно утеряна, отключите, а затем перенастройте репликацию с зеркалом, указанным в качестве издателя.</span><span class="sxs-lookup"><span data-stu-id="cb398-193">If the principal is permanently lost, disable and then reconfigure replication with the mirror specified as the Publisher.</span></span>  
  
-   <span data-ttu-id="cb398-194">Если зеркальное отображение базы данных полностью удаляется, зеркальная база данных находится в состоянии восстановления и должна быть восстановлена, чтобы стать функционирующей.</span><span class="sxs-lookup"><span data-stu-id="cb398-194">If database mirroring is removed completely, the mirror database is in a recovery state and must be restored in order to become functional.</span></span> <span data-ttu-id="cb398-195">Поведение восстановленной базы данных в отношении репликации зависит от того, задан ли параметр KEEP_REPLICATION.</span><span class="sxs-lookup"><span data-stu-id="cb398-195">The behavior of the recovered database with respect to replication depends on whether the KEEP_REPLICATION option is specified.</span></span> <span data-ttu-id="cb398-196">Этот параметр принудительно запускает операцию восстановления, чтобы сохранить настройки репликации при восстановлении опубликованной базы данных на сервер, отличный от того, на котором была создана резервная копия.</span><span class="sxs-lookup"><span data-stu-id="cb398-196">This option forces the restore operation to preserve replication settings when restoring a published database to a server other than that on which the backup was created.</span></span> <span data-ttu-id="cb398-197">Используйте параметр KEEP_REPLICATION, только когда недоступна другая база данных публикации.</span><span class="sxs-lookup"><span data-stu-id="cb398-197">Use the KEEP_REPLICATION option only when the other publication database is unavailable.</span></span> <span data-ttu-id="cb398-198">Этот параметр не поддерживается, если другая база данных публикации не повреждена и реплицируется.</span><span class="sxs-lookup"><span data-stu-id="cb398-198">The option is not supported if the other publication database is still intact and replicating.</span></span> <span data-ttu-id="cb398-199">Дополнительные сведения о параметре KEEP_REPLICATION см. в разделе [RESTORE (Transact-SQL)](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="cb398-199">For more information about KEEP_REPLICATION, see [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
## <a name="log-reader-agent-behavior"></a><span data-ttu-id="cb398-200">Поведение агента чтения журнала</span><span class="sxs-lookup"><span data-stu-id="cb398-200">Log Reader Agent Behavior</span></span>  
 <span data-ttu-id="cb398-201">В следующей таблице описывается поведение агента чтения журнала для различных режимов зеркального отображения базы данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-201">The following table describes Log Reader Agent behavior for the various operating modes of database mirroring.</span></span>  
  
|<span data-ttu-id="cb398-202">Режим работы</span><span class="sxs-lookup"><span data-stu-id="cb398-202">Operating mode</span></span>|<span data-ttu-id="cb398-203">Поведение агента чтения журнала, когда зеркальная база данных недоступна</span><span class="sxs-lookup"><span data-stu-id="cb398-203">Log Reader Agent behavior if the mirror is unavailable</span></span>|  
|--------------------|------------------------------------------------------------|  
|<span data-ttu-id="cb398-204">Режим высокого уровня защиты с автоматической отработкой отказа</span><span class="sxs-lookup"><span data-stu-id="cb398-204">High-safety mode with automatic failover</span></span>|<span data-ttu-id="cb398-205">Если зеркало недоступно, агент чтения журнала передает команды в базу данных распространителя.</span><span class="sxs-lookup"><span data-stu-id="cb398-205">If the mirror is unavailable, the Log Reader Agent propagates commands to the distribution database.</span></span> <span data-ttu-id="cb398-206">При отработке отказа основная база данных не сможет переключиться на зеркало, пока зеркальная база данных не вернется в режим «в сети» и не получит все транзакции из основной базы данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-206">The principal cannot failover to the mirror until the mirror is back online and has all transactions from the principal.</span></span>|  
|<span data-ttu-id="cb398-207">Высокопроизводительный режим</span><span class="sxs-lookup"><span data-stu-id="cb398-207">High-performance mode</span></span>|<span data-ttu-id="cb398-208">Если зеркало недоступно, основная база данных выполняется без поддержки (т. е. без зеркальной базы данных).</span><span class="sxs-lookup"><span data-stu-id="cb398-208">If the mirror is unavailable, the principal database is running exposed (that is, unmirrored).</span></span> <span data-ttu-id="cb398-209">Однако агент чтения журнала реплицирует только те транзакции, которые записаны в зеркальную базу данных.</span><span class="sxs-lookup"><span data-stu-id="cb398-209">However, the Log Reader Agent only replicates those transactions that are hardened on the mirror.</span></span> <span data-ttu-id="cb398-210">Если служба включена принудительно и зеркальный сервер принимает роль основного, агент чтения журнала начнет работать на зеркале и будет собирать на нем новые транзакции.</span><span class="sxs-lookup"><span data-stu-id="cb398-210">If service is forced and the mirror server assumes the role of the principal, the Log Reader Agent will work against the mirror and start picking up the new transactions.</span></span><br /><br /> <span data-ttu-id="cb398-211">Имейте в виду, что задержка репликации увеличится, если зеркальная база данных отстает от основной базы данных в изменениях.</span><span class="sxs-lookup"><span data-stu-id="cb398-211">Be aware that replication latency will increase if the mirror falls behind the principal.</span></span>|  
|<span data-ttu-id="cb398-212">Режим высокой безопасности без автоматического перехода на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="cb398-212">High-safety mode without automatic failover</span></span>|<span data-ttu-id="cb398-213">Гарантируется, что все зафиксированные транзакции будут записаны на диск зеркального сервера.</span><span class="sxs-lookup"><span data-stu-id="cb398-213">All committed transactions are guaranteed to be hardened to disk on the mirror.</span></span> <span data-ttu-id="cb398-214">Однако агент чтения журнала реплицирует только те транзакции, которые записаны на зеркале.</span><span class="sxs-lookup"><span data-stu-id="cb398-214">The Log Reader Agent replicates only those transactions that are hardened on the mirror.</span></span> <span data-ttu-id="cb398-215">Если зеркало недоступно, основной сервер запрещает дальнейшую активность в базе данных. Поэтому агент чтения журнала не имеет транзакций для репликации.</span><span class="sxs-lookup"><span data-stu-id="cb398-215">If the mirror is unavailable, the principal disallows further activity in the database; therefore the Log Reader Agent has no transactions to replicate.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="cb398-216">См. также:</span><span class="sxs-lookup"><span data-stu-id="cb398-216">See Also</span></span>  
 <span data-ttu-id="cb398-217">[Репликация SQL Server](../../relational-databases/replication/sql-server-replication.md) </span><span class="sxs-lookup"><span data-stu-id="cb398-217">[SQL Server Replication](../../relational-databases/replication/sql-server-replication.md) </span></span>  
 [<span data-ttu-id="cb398-218">Репликация и доставка журналов (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="cb398-218">Log Shipping and Replication &#40;SQL Server&#41;</span></span>](../log-shipping/log-shipping-and-replication-sql-server.md)  
  
  
