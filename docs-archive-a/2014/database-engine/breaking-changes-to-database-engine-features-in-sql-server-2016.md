---
title: Критические изменения в функциях ядро СУБД в SQL Server 2014 | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2019
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: release-landing
ms.topic: conceptual
helpviewer_keywords:
- Database Engine [SQL Server], what's new
- breaking changes [SQL Server]
ms.assetid: 47edefbd-a09b-4087-937a-453cd5c6e061
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: bf1a25aabde1e684407218da7365ae7a2b4265a7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751483"
---
# <a name="breaking-changes-to-database-engine-features-in-sql-server-2014"></a><span data-ttu-id="f3a91-102">Критические изменения в функциях компонента ядра СУБД в SQL Server 2014</span><span class="sxs-lookup"><span data-stu-id="f3a91-102">Breaking Changes to Database Engine Features in SQL Server 2014</span></span>
  <span data-ttu-id="f3a91-103">В этом разделе описаны критические изменения в [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] [!INCLUDE[ssDE](../includes/ssde-md.md)] и более ранних версиях [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f3a91-103">This topic describes breaking changes in the [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] [!INCLUDE[ssDE](../includes/ssde-md.md)] and earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f3a91-104">Эти изменения могут нарушать работу приложений, скриптов или механизмов, основанных на более ранних версиях [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3a91-104">These changes might break applications, scripts, or functionalities that are based on earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f3a91-105">При обновлении могут возникнуть следующие проблемы.</span><span class="sxs-lookup"><span data-stu-id="f3a91-105">You might encounter these issues when you upgrade.</span></span> <span data-ttu-id="f3a91-106">Дополнительные сведения см. в разделе [Use Upgrade Advisor to Prepare for Upgrades](../sql-server/install/use-upgrade-advisor-to-prepare-for-upgrades.md).</span><span class="sxs-lookup"><span data-stu-id="f3a91-106">For more information, see [Use Upgrade Advisor to Prepare for Upgrades](../sql-server/install/use-upgrade-advisor-to-prepare-for-upgrades.md).</span></span>  
  
##  <a name="breaking-changes-in-sssql14"></a><a name="SQL14"></a> <span data-ttu-id="f3a91-107">Критические изменения в [!INCLUDE[ssSQL14](../includes/sssql14-md.md)]</span><span class="sxs-lookup"><span data-stu-id="f3a91-107">Breaking Changes in [!INCLUDE[ssSQL14](../includes/sssql14-md.md)]</span></span>  
 <span data-ttu-id="f3a91-108">Новые версии отсутствуют.</span><span class="sxs-lookup"><span data-stu-id="f3a91-108">No new issues.</span></span>  
  
##  <a name="breaking-changes-in-sssql11"></a><a name="Denali"></a><span data-ttu-id="f3a91-109">Критические изменения в[!INCLUDE[ssSQL11](../includes/sssql11-md.md)]</span><span class="sxs-lookup"><span data-stu-id="f3a91-109">Breaking Changes in [!INCLUDE[ssSQL11](../includes/sssql11-md.md)]</span></span>  
  
### <a name="transact-sql"></a><span data-ttu-id="f3a91-110">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="f3a91-110">Transact-SQL</span></span>  
  
|<span data-ttu-id="f3a91-111">Компонент</span><span class="sxs-lookup"><span data-stu-id="f3a91-111">Feature</span></span>|<span data-ttu-id="f3a91-112">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-112">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="f3a91-113">Выбор в столбцах и таблицах с именем NEXT</span><span class="sxs-lookup"><span data-stu-id="f3a91-113">Selecting from columns or tables named NEXT</span></span>|<span data-ttu-id="f3a91-114">Последовательности используют функцию ANSI NEXT VALUE FOR стандарта ANSI.</span><span class="sxs-lookup"><span data-stu-id="f3a91-114">Sequences use the ANSI standard NEXT VALUE FOR function.</span></span> <span data-ttu-id="f3a91-115">Если таблица или столбец имеют имя NEXT, а таблица или столбец имеет псевдоним в виде значения, и если стандарт ANSI опущен, то результирующая инструкция может вызвать ошибку.</span><span class="sxs-lookup"><span data-stu-id="f3a91-115">If a table or a column is named NEXT and the table or column is aliased as VALUE, and if the ANSI standard AS is omitted, the resultant statement can cause an error.</span></span> <span data-ttu-id="f3a91-116">Чтобы избежать этой проблемы, используйте ключевое слово AS по стандарту ANSI.</span><span class="sxs-lookup"><span data-stu-id="f3a91-116">To work around, include the ANSI standard AS keyword.</span></span> <span data-ttu-id="f3a91-117">Например, запрос `SELECT NEXT VALUE FROM Table` следует переписать в виде `SELECT NEXT AS VALUE FROM Table`, а запрос `SELECT Col1 FROM NEXT VALUE` ― в виде `SELECT Col1 FROM NEXT AS VALUE`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-117">For example, `SELECT NEXT VALUE FROM Table` should be rewritten as `SELECT NEXT AS VALUE FROM Table` and `SELECT Col1 FROM NEXT VALUE` should be rewritten as `SELECT Col1 FROM NEXT AS VALUE`.</span></span>|  
|<span data-ttu-id="f3a91-118">Оператор PIVOT</span><span class="sxs-lookup"><span data-stu-id="f3a91-118">PIVOT operator</span></span>|<span data-ttu-id="f3a91-119">Оператор PIVOT запрещен в запросах рекурсивного обобщенного табличного выражения (CTE), если уровень совместимости базы данных установлен в значение 110.</span><span class="sxs-lookup"><span data-stu-id="f3a91-119">The PIVOT operator is not allowed in a recursive common table expression (CTE) query when the database compatibility level is set to 110.</span></span> <span data-ttu-id="f3a91-120">Перепишите запрос или измените уровень совместимости на 100 или ниже.</span><span class="sxs-lookup"><span data-stu-id="f3a91-120">Rewrite the query, or change the compatibility level to 100 or lower.</span></span> <span data-ttu-id="f3a91-121">Использование оператора PIVOT в запросах рекурсивного обобщенного табличного выражения (CTE) приводит к неверным результатам, если на каждое группирование приходится больше одной строки.</span><span class="sxs-lookup"><span data-stu-id="f3a91-121">Using PIVOT in a recursive CTE query produces incorrect results when there is more than a single row per grouping.</span></span>|  
|<span data-ttu-id="f3a91-122">sp_setapprole и sp_unsetapprole</span><span class="sxs-lookup"><span data-stu-id="f3a91-122">sp_setapprole and sp_unsetapprole</span></span>|<span data-ttu-id="f3a91-123">Параметр `OUTPUT` куки-файла для `sp_setapprole` в настоящее время описан в документации как `varbinary(8000)`, что верно определяет его максимальную длину.</span><span class="sxs-lookup"><span data-stu-id="f3a91-123">The cookie `OUTPUT` parameter for `sp_setapprole` is currently documented as `varbinary(8000)` which is the correct maximum length.</span></span> <span data-ttu-id="f3a91-124">Однако текущая реализация возвращает `varbinary(50)`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-124">However the current implementation returns `varbinary(50)`.</span></span> <span data-ttu-id="f3a91-125">Дальнейшее резервирование `varbinary(8000)` в приложениях необходимо для обеспечения правильного продолжения работы в случае увеличения размера куки-файлов в последующих выпусках.</span><span class="sxs-lookup"><span data-stu-id="f3a91-125">Applications should continue to reserve `varbinary(8000)` so that the application continues to operate correctly if the cookie return size increases in a future release.</span></span> <span data-ttu-id="f3a91-126">Дополнительные сведения см. в разделе [sp_setapprole (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-setapprole-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3a91-126">For more information, see [sp_setapprole &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-setapprole-transact-sql).</span></span>|  
|<span data-ttu-id="f3a91-127">EXECUTE AS</span><span class="sxs-lookup"><span data-stu-id="f3a91-127">EXECUTE AS</span></span>|<span data-ttu-id="f3a91-128">Параметр OUTPUT куки-файла для инструкции EXECUTE AS в настоящее время описан в документации как `varbinary(8000)`, что верно определяет его максимальную длину.</span><span class="sxs-lookup"><span data-stu-id="f3a91-128">The cookie OUTPUT parameter for EXECUTE AS is currently documented as `varbinary(8000)` which is the correct maximum length.</span></span> <span data-ttu-id="f3a91-129">Однако текущая реализация возвращает `varbinary(100)`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-129">However the current implementation returns `varbinary(100)`.</span></span> <span data-ttu-id="f3a91-130">Дальнейшее резервирование `varbinary(8000)` в приложениях необходимо для обеспечения правильного продолжения работы в случае увеличения размера куки-файлов в последующих выпусках.</span><span class="sxs-lookup"><span data-stu-id="f3a91-130">Applications should continue to reserve `varbinary(8000)` so that the application continues to operate correctly if the cookie return size increases in a future release.</span></span> <span data-ttu-id="f3a91-131">Дополнительные сведения см. в разделе [EXECUTE AS (Transact-SQL)](/sql/t-sql/statements/execute-as-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3a91-131">For more information, see [EXECUTE AS &#40;Transact-SQL&#41;](/sql/t-sql/statements/execute-as-transact-sql).</span></span>|  
|<span data-ttu-id="f3a91-132">sys.fn_get_audit_file, функция</span><span class="sxs-lookup"><span data-stu-id="f3a91-132">sys.fn_get_audit_file function</span></span>|<span data-ttu-id="f3a91-133">Для поддержки пользовательских событий аудита были добавлены два дополнительных столбца (**user_defined_event_id** и **user_defined_information**).</span><span class="sxs-lookup"><span data-stu-id="f3a91-133">Two additional columns (**user_defined_event_id** and **user_defined_information**) have been added to support user-defined audit events.</span></span> <span data-ttu-id="f3a91-134">Приложения, не выбирающие столбцы по имени, могут возвращать больше столбцов, чем ожидается.</span><span class="sxs-lookup"><span data-stu-id="f3a91-134">Applications that do not select columns by name might return more columns than expected.</span></span> <span data-ttu-id="f3a91-135">Либо выбирайте столбцы по имени, либо доработайте приложение, чтобы оно принимало эти дополнительные столбцы.</span><span class="sxs-lookup"><span data-stu-id="f3a91-135">Either select columns by name, or adjust the application to accept these additional columns.</span></span>|  
|<span data-ttu-id="f3a91-136">Зарезервированное ключевое слово WITHIN</span><span class="sxs-lookup"><span data-stu-id="f3a91-136">WITHIN reserved keyword</span></span>|<span data-ttu-id="f3a91-137">WITHIN теперь является зарезервированным ключевым словом.</span><span class="sxs-lookup"><span data-stu-id="f3a91-137">WITHIN is now a reserved keyword.</span></span> <span data-ttu-id="f3a91-138">Ссылки на объекты или столбцы с именем «within» работать не будут.</span><span class="sxs-lookup"><span data-stu-id="f3a91-138">References to objects or columns named 'within' will fail.</span></span> <span data-ttu-id="f3a91-139">Переименуйте объект или столбец либо заключите имя столбца в разграничители с помощью квадратных скобок или кавычек.</span><span class="sxs-lookup"><span data-stu-id="f3a91-139">Rename the object or column name or delimit the name by using brackets or quotes.</span></span>  <span data-ttu-id="f3a91-140">Например, `SELECT * FROM [within]`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-140">For example, `SELECT * FROM [within]`.</span></span>|  
|<span data-ttu-id="f3a91-141">Операции CAST и CONVERT над вычисляемыми столбцами типа `time` или `datetime2`</span><span class="sxs-lookup"><span data-stu-id="f3a91-141">CAST and CONVERT operations on computed columns of type `time` or `datetime2`</span></span>|<span data-ttu-id="f3a91-142">В предыдущих версиях [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] используемый по умолчанию стиль для операций CAST и CONVERT над типами данных `time` и `datetime2` — 121, кроме случая, когда любой из типов используется в выражении вычисляемого столбца.</span><span class="sxs-lookup"><span data-stu-id="f3a91-142">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], the default style for CAST and CONVERT operations on `time` and `datetime2` data types is 121 except when either type is used in a computed column expression.</span></span> <span data-ttu-id="f3a91-143">Для вычисляемых столбцов используемый по умолчанию стиль — 0.</span><span class="sxs-lookup"><span data-stu-id="f3a91-143">For computed columns, the default style is 0.</span></span> <span data-ttu-id="f3a91-144">Это поведение влияет на вычисляемые столбцы при их создании и использовании в запросах с автоматической параметризацией, а также при использовании в определениях ограничений.</span><span class="sxs-lookup"><span data-stu-id="f3a91-144">This behavior impacts computed columns when they are created, used in queries involving auto-parameterization, or used in constraint definitions.</span></span><br /><br /> <span data-ttu-id="f3a91-145">При уровне совместимости 110 стиль по умолчанию для операций CAST и CONVERT над типами данных `time` и `datetime2` всегда имеет значение 121.</span><span class="sxs-lookup"><span data-stu-id="f3a91-145">Under compatibility level 110, the default style for CAST and CONVERT operations on `time` and `datetime2` data types is always 121.</span></span> <span data-ttu-id="f3a91-146">Если запрос основан на прежнем поведении, следует использовать уровень совместимости ниже 110, либо явно задать в затрагиваемом запросе стиль 0.</span><span class="sxs-lookup"><span data-stu-id="f3a91-146">If your query relies on the old behavior, use a compatibility level less than 110, or explicitly specify the 0 style in the affected query.</span></span><br /><br /> <span data-ttu-id="f3a91-147">Обновление базы данных до уровня совместимости 110 не приведет к изменению пользовательских данных, сохраненных на диске.</span><span class="sxs-lookup"><span data-stu-id="f3a91-147">Upgrading the database to compatibility level 110 will not change user data that has been stored to disk.</span></span> <span data-ttu-id="f3a91-148">Следует исправить эти данных соответствующим образом вручную.</span><span class="sxs-lookup"><span data-stu-id="f3a91-148">You must manually correct this data as appropriate.</span></span> <span data-ttu-id="f3a91-149">Например, если бы вы использовали предложение SELECT INTO для создания таблицы на основе источника, содержащего описанное выше выражение вычисляемого столбца, то сохранялись бы данные (благодаря стилю 0), а не само определение вычисляемого столбца.</span><span class="sxs-lookup"><span data-stu-id="f3a91-149">For example, if you used SELECT INTO to create a table from a source that contained a computed column expression described above, the data (using style 0) would be stored rather than the computed column definition itself.</span></span> <span data-ttu-id="f3a91-150">Потребовалось бы вручную обновлять эти данные в соответствии со стилем 121.</span><span class="sxs-lookup"><span data-stu-id="f3a91-150">You would need to manually update this data to match style 121.</span></span>|  
|<span data-ttu-id="f3a91-151">ALTER TABLE</span><span class="sxs-lookup"><span data-stu-id="f3a91-151">ALTER TABLE</span></span>|<span data-ttu-id="f3a91-152">В инструкции ALTER TABLE разрешается использовать только имена таблиц, составленные из двух частей (схема.объект).</span><span class="sxs-lookup"><span data-stu-id="f3a91-152">The ALTER TABLE statement allows only two-part (schema.object) table names.</span></span> <span data-ttu-id="f3a91-153">Указание имени таблицы в следующих форматах теперь завершается ошибкой во время компиляции с ошибкой 117:</span><span class="sxs-lookup"><span data-stu-id="f3a91-153">Specifying a table name using the following formats now fails at compile time with error 117:</span></span><br /><br /> <span data-ttu-id="f3a91-154">«сервер.база_данных.схема.таблица»</span><span class="sxs-lookup"><span data-stu-id="f3a91-154">server.database.schema.table</span></span><br /><br /> <span data-ttu-id="f3a91-155">«.база_данных.схема.таблица»</span><span class="sxs-lookup"><span data-stu-id="f3a91-155">.database.schema.table</span></span><br /><br /> <span data-ttu-id="f3a91-156">«..схема.таблица»</span><span class="sxs-lookup"><span data-stu-id="f3a91-156">..schema.table</span></span><br /><br /> <span data-ttu-id="f3a91-157">В предыдущих версиях при задании формата «сервер.база_данных.схема.таблица» возникала ошибка 4902.</span><span class="sxs-lookup"><span data-stu-id="f3a91-157">In earlier versions specifying the format server.database.schema.table returned error 4902.</span></span> <span data-ttu-id="f3a91-158">Формат «.база_данных.схема.таблица» или «..схема.таблица» обрабатывался успешно.</span><span class="sxs-lookup"><span data-stu-id="f3a91-158">Specifying the format .database.schema.table or the format ..schema.table succeeded.</span></span> <span data-ttu-id="f3a91-159">Чтобы устранить эту проблему, используйте четырехкомпонентный префикс.</span><span class="sxs-lookup"><span data-stu-id="f3a91-159">To resolve the problem, remove the use of a 4-part prefix.</span></span>|  
|<span data-ttu-id="f3a91-160">Просмотр метаданных</span><span class="sxs-lookup"><span data-stu-id="f3a91-160">Browsing metadata</span></span>|<span data-ttu-id="f3a91-161">Запросы к представлению с помощью предложения FOR BROWSE или SET NO_BROWSETABLE ON теперь возвращают метаданные представления, а не метаданные базового объекта.</span><span class="sxs-lookup"><span data-stu-id="f3a91-161">Querying a view using FOR BROWSE or SET NO_BROWSETABLE ON now returns the metadata of the view, not the metadata of the underlying object.</span></span> <span data-ttu-id="f3a91-162">Это поведение теперь такое же, как и у других методов просмотра метаданных.</span><span class="sxs-lookup"><span data-stu-id="f3a91-162">This behavior now matches other methods of browsing metadata.</span></span>|  
|<span data-ttu-id="f3a91-163">SOUNDEX</span><span class="sxs-lookup"><span data-stu-id="f3a91-163">SOUNDEX</span></span>|<span data-ttu-id="f3a91-164">При уровне совместимости базы данных 110 функция SOUNDEX реализует новые правила, при применении которых значения, вычисляемые функцией, могут отличаться от тех значений, которые были вычислены при другом уровне совместимости.</span><span class="sxs-lookup"><span data-stu-id="f3a91-164">Under database compatibility level 110, the SOUNDEX function implements new rules that may cause the values computed by the function to be different than the values computed under earlier compatibility levels.</span></span> <span data-ttu-id="f3a91-165">После обновления до уровня совместимости 110, возможно, придется перестроить индексы, кучи или ограничения CHECK, в которых используется функция SOUNDEX.</span><span class="sxs-lookup"><span data-stu-id="f3a91-165">After upgrading to compatibility level 110, you may need to rebuild the indexes, heaps, or CHECK constraints that use the SOUNDEX function.</span></span> <span data-ttu-id="f3a91-166">Дополнительные сведения см. в статье [SOUNDEX (Transact-SQL)](/sql/t-sql/functions/soundex-transact-sql)</span><span class="sxs-lookup"><span data-stu-id="f3a91-166">For more information, see [SOUNDEX &#40;Transact-SQL&#41;](/sql/t-sql/functions/soundex-transact-sql)</span></span>
|<span data-ttu-id="f3a91-167">Сообщение о количестве строк для инструкций DML, завершившихся ошибкой</span><span class="sxs-lookup"><span data-stu-id="f3a91-167">Row count message for failed DML statements</span></span>|<span data-ttu-id="f3a91-168">В [!INCLUDE[ssSQL11](../includes/sssql11-md.md)][!INCLUDE[ssDE](../includes/ssde-md.md)] будет постоянно отправлять клиентам токен TDS DONE со значением «RowCount: 0» при неуспешном завершении инструкции DML.</span><span class="sxs-lookup"><span data-stu-id="f3a91-168">In [!INCLUDE[ssSQL11](../includes/sssql11-md.md)], the [!INCLUDE[ssDE](../includes/ssde-md.md)] will consistently send the TDS DONE token with RowCount: 0 to clients when a DML statement fails.</span></span> <span data-ttu-id="f3a91-169">В предыдущих версиях [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] клиенту отправляется неверное значение -1, когда инструкция DML, завершившаяся ошибкой, содержится в блоке TRY-CATCH и либо автопараметризуется компонентом [!INCLUDE[ssDE](../includes/ssde-md.md)], либо блок TRY-CATCH находится на разных уровнях с инструкцией, завершившейся ошибкой.</span><span class="sxs-lookup"><span data-stu-id="f3a91-169">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], an incorrect value of -1 is sent to the client when the DML statement that fails is contained in a TRY-CATCH block and is either autoparameterized by the [!INCLUDE[ssDE](../includes/ssde-md.md)] or the TRY-CATCH block is not on the same level as the failed statement.</span></span> <span data-ttu-id="f3a91-170">Например, если блок TRY-CATCH вызывает хранимую процедуру и инструкция DML в процедуре завершается ошибкой, клиент получит ошибочное значение -1.</span><span class="sxs-lookup"><span data-stu-id="f3a91-170">For example, if a TRY-CATCH block calls a stored procedure and a DML statement in the procedure fails, the client will incorrectly receive a -1 value.</span></span><br /><br /> <span data-ttu-id="f3a91-171">Приложения, работа которых зависит от этого неверного поведения, будут завершены с ошибками.</span><span class="sxs-lookup"><span data-stu-id="f3a91-171">Applications that rely on this incorrect behavior will fail.</span></span>|  
|<span data-ttu-id="f3a91-172">SERVERPROPERTY (' выпуск ')</span><span class="sxs-lookup"><span data-stu-id="f3a91-172">SERVERPROPERTY ('Edition')</span></span>|<span data-ttu-id="f3a91-173">Установленный выпуск экземпляра [!INCLUDE[ssSQL11](../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3a91-173">Installed product edition of the instance of [!INCLUDE[ssSQL11](../includes/sssql11-md.md)].</span></span> <span data-ttu-id="f3a91-174">Используйте значения этого свойства для определения возможностей и ограничений, таких как максимальное количество процессоров, которые поддерживаются установленным продуктом.</span><span class="sxs-lookup"><span data-stu-id="f3a91-174">Use the value of this property to determine the features and the limits, such as maximum number of CPUs that are supported by the installed product.</span></span><br /><br /> <span data-ttu-id="f3a91-175">В зависимости от установленного выпуска Enterprise Edition это может вернуть "Enterprise Edition" или "Enterprise Edition: лицензирование на основе ядра".</span><span class="sxs-lookup"><span data-stu-id="f3a91-175">Based on the installed Enterprise edition, this can return 'Enterprise Edition' or 'Enterprise Edition: Core-based Licensing'.</span></span> <span data-ttu-id="f3a91-176">Выпуски Enterprise Edition различаются по максимальной вычислительной мощности на один экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3a91-176">The Enterprise editions are differentiated based on the maximum compute capacity by a single instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f3a91-177">Дополнительные сведения об ограничениях на вычисление емкости в см [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] . в разделе [ограничения емкости вычислений по выпуску SQL Server](../sql-server/compute-capacity-limits-by-edition-of-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f3a91-177">For more information on Compute capacity limits in [!INCLUDE[ssSQL11](../includes/sssql11-md.md)], see [Compute Capacity Limits by Edition of SQL Server](../sql-server/compute-capacity-limits-by-edition-of-sql-server.md).</span></span>|  
|<span data-ttu-id="f3a91-178">CREATE LOGIN</span><span class="sxs-lookup"><span data-stu-id="f3a91-178">CREATE LOGIN</span></span>|<span data-ttu-id="f3a91-179">Параметр `CREATE LOGIN WITH PASSWORD = '` *Password* `' HASHED` не может использоваться с хэшами, созданными [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 7 или более ранними версиями.</span><span class="sxs-lookup"><span data-stu-id="f3a91-179">The `CREATE LOGIN WITH PASSWORD = '`*password*`' HASHED` option cannot be used with hashes created by [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 7 or earlier.</span></span>|  
|<span data-ttu-id="f3a91-180">Для операций CAST и CONVERT `datetimeoffset`</span><span class="sxs-lookup"><span data-stu-id="f3a91-180">CAST and CONVERT operations for `datetimeoffset`</span></span>|<span data-ttu-id="f3a91-181">При преобразовании типов даты и времени в `datetimeoffset` поддерживаются только стили 0 и 1.</span><span class="sxs-lookup"><span data-stu-id="f3a91-181">The only styles that are supported when converting from date and time types to `datetimeoffset` are 0 or 1.</span></span> <span data-ttu-id="f3a91-182">Все другие стили преобразования возвращают ошибку 9809.</span><span class="sxs-lookup"><span data-stu-id="f3a91-182">All other conversion styles return error 9809.</span></span> <span data-ttu-id="f3a91-183">Например, следующий код возвращает ошибку 9809.</span><span class="sxs-lookup"><span data-stu-id="f3a91-183">For example, the following code returns error 9809.</span></span><br /><br /> `SELECT CONVERT(date, CAST('7070-11-25 16:25:01.00986 -02:07' as datetimeoffset(5)), 107);`|  
  
### <a name="dynamic-management-views"></a><span data-ttu-id="f3a91-184">Динамические административные представления</span><span class="sxs-lookup"><span data-stu-id="f3a91-184">Dynamic Management Views</span></span>  
  
|<span data-ttu-id="f3a91-185">Просмотр</span><span class="sxs-lookup"><span data-stu-id="f3a91-185">View</span></span>|<span data-ttu-id="f3a91-186">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-186">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="f3a91-187">sys.dm_exec_requests</span><span class="sxs-lookup"><span data-stu-id="f3a91-187">sys.dm_exec_requests</span></span>|<span data-ttu-id="f3a91-188">Тип столбца command меняется с `nvarchar(16)` на `nvarchar(32)`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-188">The command column changes from `nvarchar(16)` to `nvarchar(32)`.</span></span>|  
|<span data-ttu-id="f3a91-189">sys.dm_os_memory_cache_counters</span><span class="sxs-lookup"><span data-stu-id="f3a91-189">sys.dm_os_memory_cache_counters</span></span>|<span data-ttu-id="f3a91-190">Следующие столбцы были переименованы:</span><span class="sxs-lookup"><span data-stu-id="f3a91-190">The following columns have been renamed:</span></span><br /><br /> <span data-ttu-id="f3a91-191">single_pages_kb теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-191">single_pages_kb is now:</span></span> <br />                          <span data-ttu-id="f3a91-192">pages_kb</span><span class="sxs-lookup"><span data-stu-id="f3a91-192">pages_kb</span></span><br /><br /> <span data-ttu-id="f3a91-193">multi_pages_kb</span><span class="sxs-lookup"><span data-stu-id="f3a91-193">multi_pages_kb</span></span><br />                           <span data-ttu-id="f3a91-194">Теперь: pages_in_use_kb</span><span class="sxs-lookup"><span data-stu-id="f3a91-194">is now: pages_in_use_kb</span></span>|  
|<span data-ttu-id="f3a91-195">sys.dm_os_memory_cache_entries</span><span class="sxs-lookup"><span data-stu-id="f3a91-195">sys.dm_os_memory_cache_entries</span></span>|<span data-ttu-id="f3a91-196">Столбец pages_allocated_count столбца был переименован pages_kb.</span><span class="sxs-lookup"><span data-stu-id="f3a91-196">The column pages_allocated_count column has been renamed pages_kb.</span></span>|  
|<span data-ttu-id="f3a91-197">sys.dm_os_memory_clerks</span><span class="sxs-lookup"><span data-stu-id="f3a91-197">sys.dm_os_memory_clerks</span></span>|<span data-ttu-id="f3a91-198">Столбец multi_pages_kb был удален.</span><span class="sxs-lookup"><span data-stu-id="f3a91-198">The column multi_pages_kb has been removed.</span></span><br /><br /> <span data-ttu-id="f3a91-199">Столбец single_pages_kb столбца был переименован pages_kb.</span><span class="sxs-lookup"><span data-stu-id="f3a91-199">The column single_pages_kb column has been renamed pages_kb.</span></span>|  
|<span data-ttu-id="f3a91-200">sys.dm_os_memory_nodes</span><span class="sxs-lookup"><span data-stu-id="f3a91-200">sys.dm_os_memory_nodes</span></span>|<span data-ttu-id="f3a91-201">Следующие столбцы были переименованы:</span><span class="sxs-lookup"><span data-stu-id="f3a91-201">The following columns have been renamed:</span></span><br /><br /> <span data-ttu-id="f3a91-202">single_pages_kb теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-202">single_pages_kb is now:</span></span> <br />                            <span data-ttu-id="f3a91-203">pages_kb</span><span class="sxs-lookup"><span data-stu-id="f3a91-203">pages_kb</span></span><br /><br /> <span data-ttu-id="f3a91-204">multi_pages_kb теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-204">multi_pages_kb is now:</span></span> <br />                            <span data-ttu-id="f3a91-205">foreign_committed_kb</span><span class="sxs-lookup"><span data-stu-id="f3a91-205">foreign_committed_kb</span></span>|  
|<span data-ttu-id="f3a91-206">sys.dm_os_memory_objects</span><span class="sxs-lookup"><span data-stu-id="f3a91-206">sys.dm_os_memory_objects</span></span>|<span data-ttu-id="f3a91-207">Следующие столбцы были переименованы.</span><span class="sxs-lookup"><span data-stu-id="f3a91-207">The following columns have been renamed.</span></span><br /><br /> <span data-ttu-id="f3a91-208">pages_allocated_count теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-208">pages_allocated_count is now:</span></span><br />                            <span data-ttu-id="f3a91-209">pages_in_bytes</span><span class="sxs-lookup"><span data-stu-id="f3a91-209">pages_in_bytes</span></span><br /><br /> <span data-ttu-id="f3a91-210">max_pages_allocated_count теперь: max_pages_in_bytes</span><span class="sxs-lookup"><span data-stu-id="f3a91-210">max_pages_allocated_count is now: max_pages_in_bytes</span></span>|  
|<span data-ttu-id="f3a91-211">sys.dm_os_sys_info</span><span class="sxs-lookup"><span data-stu-id="f3a91-211">sys.dm_os_sys_info</span></span>|<span data-ttu-id="f3a91-212">Следующие столбцы были переименованы:</span><span class="sxs-lookup"><span data-stu-id="f3a91-212">The following columns have been renamed:</span></span><br /><br /> <span data-ttu-id="f3a91-213">physical_memory_in_bytes теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-213">physical_memory_in_bytes is now:</span></span> <br />                            <span data-ttu-id="f3a91-214">physical_memory_kb</span><span class="sxs-lookup"><span data-stu-id="f3a91-214">physical_memory_kb</span></span><br /><br /> <span data-ttu-id="f3a91-215">bpool_commit_target теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-215">bpool_commit_target is now:</span></span> <br />                            <span data-ttu-id="f3a91-216">committed_target_kb</span><span class="sxs-lookup"><span data-stu-id="f3a91-216">committed_target_kb</span></span><br /><br /> <span data-ttu-id="f3a91-217">bpool_visible теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-217">bpool_visible is now:</span></span> <br />                            <span data-ttu-id="f3a91-218">visible_target_kb</span><span class="sxs-lookup"><span data-stu-id="f3a91-218">visible_target_kb</span></span><br /><br /> <span data-ttu-id="f3a91-219">virtual_memory_in_bytes теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-219">virtual_memory_in_bytes is now:</span></span> <br />                            <span data-ttu-id="f3a91-220">virtual_memory_kb</span><span class="sxs-lookup"><span data-stu-id="f3a91-220">virtual_memory_kb</span></span><br /><br /> <span data-ttu-id="f3a91-221">bpool_commited теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-221">bpool_commited is now:</span></span><br />                            <span data-ttu-id="f3a91-222">committed_kb</span><span class="sxs-lookup"><span data-stu-id="f3a91-222">committed_kb</span></span>|  
|<span data-ttu-id="f3a91-223">sys.dm_os_workers</span><span class="sxs-lookup"><span data-stu-id="f3a91-223">sys.dm_os_workers</span></span>|<span data-ttu-id="f3a91-224">Столбец локали был удален.</span><span class="sxs-lookup"><span data-stu-id="f3a91-224">The locale column has been removed.</span></span>|  
  
### <a name="catalog-views"></a><span data-ttu-id="f3a91-225">Представления каталога</span><span class="sxs-lookup"><span data-stu-id="f3a91-225">Catalog Views</span></span>  
  
|<span data-ttu-id="f3a91-226">Просмотр</span><span class="sxs-lookup"><span data-stu-id="f3a91-226">View</span></span>|<span data-ttu-id="f3a91-227">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-227">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="f3a91-228">sys.data_spaces</span><span class="sxs-lookup"><span data-stu-id="f3a91-228">sys.data_spaces</span></span><br /><br /> <span data-ttu-id="f3a91-229">sys.partition_schemes</span><span class="sxs-lookup"><span data-stu-id="f3a91-229">sys.partition_schemes</span></span><br /><br /> <span data-ttu-id="f3a91-230">sys.filegroups</span><span class="sxs-lookup"><span data-stu-id="f3a91-230">sys.filegroups</span></span><br /><br /> <span data-ttu-id="f3a91-231">sys.partition_functions</span><span class="sxs-lookup"><span data-stu-id="f3a91-231">sys.partition_functions</span></span>|<span data-ttu-id="f3a91-232">В функции sys.data_spaces и sys.partition_functions добавлен новый столбец is_system.</span><span class="sxs-lookup"><span data-stu-id="f3a91-232">A new column, is_system, has been added to sys.data_spaces and sys.partition_functions.</span></span> <span data-ttu-id="f3a91-233">(sys.partition_schemes и sys.filegroups наследуют столбцы от sys.data_spaces.)</span><span class="sxs-lookup"><span data-stu-id="f3a91-233">(sys.partition_schemes and sys.filegroups inherit the columns of sys.data_spaces.)</span></span><br /><br /> <span data-ttu-id="f3a91-234">Значение 1 в этом столбце показывает, что объект используется для фрагментов полнотекстового индекса.</span><span class="sxs-lookup"><span data-stu-id="f3a91-234">A value of 1 in this column indicates that the object is used for full-text index fragments.</span></span><br /><br /> <span data-ttu-id="f3a91-235">В sys.partition_functions, sys.partition_schemes и sys.filegroups новый столбец не является последним.</span><span class="sxs-lookup"><span data-stu-id="f3a91-235">In sys.partition_functions, sys.partition_schemes, and sys.filegroups, the new column is not the last column.</span></span> <span data-ttu-id="f3a91-236">Проверьте существующие запросы, в которых большое значение имеет порядок столбцов, возвращаемых из этих представлений каталогов.</span><span class="sxs-lookup"><span data-stu-id="f3a91-236">Revise existing queries that rely on the order of columns returned from these catalog views.</span></span>|  
  
### <a name="sql-clr-data-types-geometry-geography-and-hierarchyid"></a><span data-ttu-id="f3a91-237">Типы данных среды CLR в SQL (geometry, geography и hierarchyid)</span><span class="sxs-lookup"><span data-stu-id="f3a91-237">SQL CLR Data Types (geometry, geography, and hierarchyid)</span></span>  
 <span data-ttu-id="f3a91-238">Сборка **Microsoft.SqlServer.Types.dll**, содержащая типы пространственных данных и тип hierarchyid, была обновлена с версии 10,0 до версии 11,0.</span><span class="sxs-lookup"><span data-stu-id="f3a91-238">The assembly **Microsoft.SqlServer.Types.dll**, which contains the spatial data types and the hierarchyid type, has been upgraded from version 10.0 to version 11.0.</span></span> <span data-ttu-id="f3a91-239">Пользовательские приложения, ссылающиеся на эту сборку, могут завершаться с ошибками, если выполняются следующие условия.</span><span class="sxs-lookup"><span data-stu-id="f3a91-239">Custom applications that reference this assembly may fail when the following conditions are true.</span></span>  
  
-   <span data-ttu-id="f3a91-240">При перемещении пользовательского приложения с компьютера, на котором установлено приложение [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] , на компьютер, на котором [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] установлено только приложение, произойдет сбой приложения из-за отсутствия ссылки на версию 10,0 для сборки **sqltypes** .</span><span class="sxs-lookup"><span data-stu-id="f3a91-240">When you move a custom application from a computer on which [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] was installed to a computer on which only [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] is installed, the application will fail because the referenced version 10.0 of the **SqlTypes** assembly is not present.</span></span> <span data-ttu-id="f3a91-241">Может отображаться следующее сообщение об ошибке: `"Could not load file or assembly 'Microsoft.SqlServer.Types, Version=10.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91' or one of its dependencies. The system cannot find the file specified."`</span><span class="sxs-lookup"><span data-stu-id="f3a91-241">You may see this error message: `"Could not load file or assembly 'Microsoft.SqlServer.Types, Version=10.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91' or one of its dependencies. The system cannot find the file specified."`</span></span>  
  
-   <span data-ttu-id="f3a91-242">Если также установлена ссылка на сборку **sqltypes** версии 11,0 и версия 10,0, может появиться следующее сообщение об ошибке:`"System.InvalidCastException: Unable to cast object of type 'Microsoft.SqlServer.Types.SqlGeometry' to type 'Microsoft.SqlServer.Types.SqlGeometry'."`</span><span class="sxs-lookup"><span data-stu-id="f3a91-242">When you reference the **SqlTypes** assembly version 11.0, and version 10.0 is also installed, you may see this error message: `"System.InvalidCastException: Unable to cast object of type 'Microsoft.SqlServer.Types.SqlGeometry' to type 'Microsoft.SqlServer.Types.SqlGeometry'."`</span></span>  
  
-   <span data-ttu-id="f3a91-243">При ссылке на сборку **sqltypes** версии 11,0 из пользовательского приложения, предназначенного для .NET 3,5, 4 или 4,5, происходит сбой приложения, так как SqlClient по проектированию загружает версию 10,0 сборки.</span><span class="sxs-lookup"><span data-stu-id="f3a91-243">When you reference the **SqlTypes** assembly version 11.0 from a custom application that targets .NET 3.5, 4, or 4.5, the application will fail because SqlClient by design loads version 10.0 of the assembly.</span></span> <span data-ttu-id="f3a91-244">Эта ошибка возникает, когда приложение вызывает один из следующих методов:</span><span class="sxs-lookup"><span data-stu-id="f3a91-244">This failure occurs when the application calls one of the following methods:</span></span>  
  
    -   <span data-ttu-id="f3a91-245">Метод `GetValue` класса `SqlDataReader`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-245">`GetValue` method of the `SqlDataReader` class</span></span>  
  
    -   <span data-ttu-id="f3a91-246">Метод `GetValues` класса `SqlDataReader`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-246">`GetValues` method of the `SqlDataReader` class</span></span>  
  
    -   <span data-ttu-id="f3a91-247">индексный оператор квадратных скобок [] из класса `SqlDataReader`</span><span class="sxs-lookup"><span data-stu-id="f3a91-247">bracket index operator [] of the `SqlDataReader` class</span></span>  
  
    -   <span data-ttu-id="f3a91-248">Метод `ExecuteScalar` класса `SqlCommand`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-248">`ExecuteScalar` method of the `SqlCommand` class</span></span>  
  
 <span data-ttu-id="f3a91-249">Для разрешения этой проблемы можно воспользоваться одним из следующих методов:</span><span class="sxs-lookup"><span data-stu-id="f3a91-249">You can work around this issue by using one of the following methods:</span></span>  
  
-   <span data-ttu-id="f3a91-250">Для разрешения этой проблемы в коде можно вызвать метод `GetSqlBytes` вместо перечисленных выше методов Get для получения системных типов CLR [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="f3a91-250">You can work around this issue in your code by calling the `GetSqlBytes` method, instead of the Get methods listed above, to retrieve CLR [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] system types, as shown in the following example:</span></span>  
  
    ```csharp  
    string query = "SELECT [SpatialColumn] FROM [SpatialTable]";  
          using (SqlConnection conn = new SqlConnection("..."))  
          {  
                SqlCommand cmd = new SqlCommand(query, conn);  
  
                conn.Open();  
                SqlDataReader reader = cmd.ExecuteReader();  
  
                while (reader.Read())  
                {  
                      // In version 11.0 only  
                      SqlGeometry g =   
    SqlGeometry.Deserialize(reader.GetSqlBytes(0));  
  
                      // In version 10.0 or 11.0  
                      SqlGeometry g2 = new SqlGeometry();  
                      g.Read(new BinaryReader(reader.GetSqlBytes(0).Stream));  
                }  
          }  
    ```  
  
-   <span data-ttu-id="f3a91-251">Для разрешения этой проблемы можно воспользоваться перенаправлением сборок в файле конфигурации, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="f3a91-251">You can work around this issue by using assembly redirection in the application configuration file, as shown in the following example:</span></span>  
  
    ```xml  
    <runtime>  
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">  
        ...  
        <dependentAssembly>  
            <assemblyIdentity name="Microsoft.SqlServer.Types" publicKeyToken="89845dcd8080cc91" culture="neutral" />  
            <bindingRedirect oldVersion="10.0.0.0" newVersion="11.0.0.0" />  
        </dependentAssembly>  
        ...  
    </assemblyBinding>  
    <runtime>  
    ```  
  
-   <span data-ttu-id="f3a91-252">Для разрешения этой проблемы в строке подключения можно указать значение «SQL Server 2012» для атрибута «Type System Version», что обеспечивает в SqlClient принудительную загрузку версии 11.0 сборки.</span><span class="sxs-lookup"><span data-stu-id="f3a91-252">You can work around this issue in your connection string by specifying a value of "SQL Server 2012" for the "Type System Version" attribute to force SqlClient to load version 11.0 of the assembly.</span></span> <span data-ttu-id="f3a91-253">Этот атрибут строки подключения доступен только в платформе .NET 4.5 и выше.</span><span class="sxs-lookup"><span data-stu-id="f3a91-253">This connection string attribute is available only in .NET 4.5 and above.</span></span>  
  
-   <span data-ttu-id="f3a91-254">Тег `assemblyBinding` должен быть заключен в тег `runtime`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-254">The `assemblyBinding` tag should be wrapped under the `runtime` tag.</span></span>  
  
### <a name="support-for-awe"></a><span data-ttu-id="f3a91-255">Поддержка AWE</span><span class="sxs-lookup"><span data-stu-id="f3a91-255">Support for AWE</span></span>  
 <span data-ttu-id="f3a91-256">Поддержка 32-разрядных расширений AWE прекращена.</span><span class="sxs-lookup"><span data-stu-id="f3a91-256">32-bit Address Windowing Extensions (AWE) support is discontinued.</span></span> <span data-ttu-id="f3a91-257">Это может приводить к снижению производительности в 32-разрядных операционных системах.</span><span class="sxs-lookup"><span data-stu-id="f3a91-257">This might result in slower performance on 32-bit operating systems.</span></span> <span data-ttu-id="f3a91-258">Для установок, где используется большой объем памяти, следует выполнить переход на 64-разрядную операционную систему.</span><span class="sxs-lookup"><span data-stu-id="f3a91-258">For installations using large amounts of memory, migrate to a 64-bit operating system.</span></span>  
  
### <a name="xquery-functions-are-surrogate-aware"></a><span data-ttu-id="f3a91-259">В функциях XQuery учитываются суррогаты</span><span class="sxs-lookup"><span data-stu-id="f3a91-259">XQuery Functions Are Surrogate-Aware</span></span>  
 <span data-ttu-id="f3a91-260">Рекомендация W3C для функций и операторов XQuery требует, чтобы суррогатная пара в них, представляющая символ Юникода из старших диапазонов, считалась единым глифом в кодировке UTF-16.</span><span class="sxs-lookup"><span data-stu-id="f3a91-260">The W3C recommendation for XQuery functions and operators requires them to count a surrogate pair that represents a high-range Unicode character as a single glyph in UTF-16 encoding.</span></span> <span data-ttu-id="f3a91-261">Однако в версиях [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] до [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] строковые функции не определяли суррогатные пары как один символ.</span><span class="sxs-lookup"><span data-stu-id="f3a91-261">However, in versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] prior to [!INCLUDE[ssSQL11](../includes/sssql11-md.md)], string functions did not recognize surrogate pairs as a single character.</span></span> <span data-ttu-id="f3a91-262">Некоторые операции со строками, такие как вычисления длины строки и извлечения подстрок, возвращают неверные результаты.</span><span class="sxs-lookup"><span data-stu-id="f3a91-262">Some string operations - such as string length calculations and substring extractions - returned incorrect results.</span></span> <span data-ttu-id="f3a91-263">Теперь [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] полностью поддерживает UTF-16 и правильную обработку суррогатных пар.</span><span class="sxs-lookup"><span data-stu-id="f3a91-263">[!INCLUDE[ssSQL11](../includes/sssql11-md.md)] now fully supports UTF-16 and the correct handling of surrogate pairs.</span></span>  
  
 <span data-ttu-id="f3a91-264">Для типа данных XML в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] разрешены только суррогатные пары правильного формата.</span><span class="sxs-lookup"><span data-stu-id="f3a91-264">The XML data type in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] only allows well-formed surrogate pairs.</span></span> <span data-ttu-id="f3a91-265">Однако некоторые функции все еще могут в некоторых обстоятельствах возвращать неопределенные или непредвиденные результаты, поскольку может оказаться, что в функцию XQuery в качестве строковых значений переданы неправильные или неполные суррогатные пары.</span><span class="sxs-lookup"><span data-stu-id="f3a91-265">However, some functions can still return undefined or unexpected results in certain circumstances, since it is possible to pass invalid or partial surrogate pairs to XQuery functions as string values.</span></span> <span data-ttu-id="f3a91-266">Рассмотрим следующие методы создания строковых значений при использовании XQuery в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="f3a91-266">Consider the following methods for generating string values when using XQuery in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>  
  
-   <span data-ttu-id="f3a91-267">Предоставление константного строкового значения в качестве двоичного значения.</span><span class="sxs-lookup"><span data-stu-id="f3a91-267">Provide a constant string value as a binary value.</span></span> <span data-ttu-id="f3a91-268">При использовании этого метода по-прежнему остается возможность передачи недопустимых или неполных суррогатных пар.</span><span class="sxs-lookup"><span data-stu-id="f3a91-268">When using this method, it remains possible to pass invalid or partial surrogate pairs.</span></span>  
  
-   <span data-ttu-id="f3a91-269">Предоставление константного строкового значения путем передачи сущностей-символов.</span><span class="sxs-lookup"><span data-stu-id="f3a91-269">Provide a constant string value by providing character entities.</span></span> <span data-ttu-id="f3a91-270">При использовании этого метода передача недопустимых суррогатных пар становится невозможной.</span><span class="sxs-lookup"><span data-stu-id="f3a91-270">When using this method, it is not possible to pass invalid surrogate pairs.</span></span> <span data-ttu-id="f3a91-271">В функциях XQuery для каждого символа верхнего диапазона требуется одна сущность-символ.</span><span class="sxs-lookup"><span data-stu-id="f3a91-271">The XQuery functions require a single character entity for the high-level character.</span></span> <span data-ttu-id="f3a91-272">Эти функции вызывают ошибку, если символы-сущности предоставляются для символов суррогатных пар.</span><span class="sxs-lookup"><span data-stu-id="f3a91-272">These functions raise an error if the character entities for the surrogate pair characters are provided.</span></span>  
  
-   <span data-ttu-id="f3a91-273">Импортируйте внешние значения с помощью **SQL: column** или **SQL: variable**.</span><span class="sxs-lookup"><span data-stu-id="f3a91-273">Import external values by using **sql:column** or **sql:variable**.</span></span> <span data-ttu-id="f3a91-274">При использовании этих методов по-прежнему остается возможность введения недопустимых или неполных суррогатных пар.</span><span class="sxs-lookup"><span data-stu-id="f3a91-274">When using these methods, it remains possible to introduce invalid or partial surrogate pairs.</span></span>  
  
#### <a name="affected-xquery-functions-and-operators"></a><span data-ttu-id="f3a91-275">Затрагиваемые функции и операторы XQuery</span><span class="sxs-lookup"><span data-stu-id="f3a91-275">Affected XQuery Functions and Operators</span></span>  
 <span data-ttu-id="f3a91-276">Следующие функции и операторы XQuery теперь правильно обрабатывают суррогатные пары UTF-16 в [!INCLUDE[ssSQL11](../includes/sssql11-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="f3a91-276">The following XQuery functions and operators now handle UTF-16 surrogate pairs correctly in [!INCLUDE[ssSQL11](../includes/sssql11-md.md)]:</span></span>  
  
-   <span data-ttu-id="f3a91-277">**fn: длина строки**.</span><span class="sxs-lookup"><span data-stu-id="f3a91-277">**fn:string-length**.</span></span> <span data-ttu-id="f3a91-278">Однако если в качестве аргумента передается Недопустимая или неполная суррогатная пара, поведение **строки String** не определено.</span><span class="sxs-lookup"><span data-stu-id="f3a91-278">However, if an invalid or partial surrogate pair is passed as an argument, the behavior of **string-length** is undefined.</span></span>  
  
-   <span data-ttu-id="f3a91-279">**fn: подстрока**.</span><span class="sxs-lookup"><span data-stu-id="f3a91-279">**fn:substring**.</span></span>  
  
-   <span data-ttu-id="f3a91-280">**fn: содержит**.</span><span class="sxs-lookup"><span data-stu-id="f3a91-280">**fn:contains**.</span></span> <span data-ttu-id="f3a91-281">Однако если в качестве значения передается частичная суррогатная пара, то **содержит** может возвращать непредвиденные результаты, так как она может найти частичную суррогатную пару, содержащуюся в суррогатной паре правильного формата.</span><span class="sxs-lookup"><span data-stu-id="f3a91-281">However, if a partial surrogate pair is passed as a value, **contains** may return unexpected results, since it may find the partial surrogate pair contained in well-formed surrogate pair.</span></span>  
  
-   <span data-ttu-id="f3a91-282">**fn: Concat**.</span><span class="sxs-lookup"><span data-stu-id="f3a91-282">**fn:concat**.</span></span> <span data-ttu-id="f3a91-283">Однако если в качестве значения передается частичная суррогатная пара, то **concat** может создать неверные суррогатные пары или частичные суррогатные пары.</span><span class="sxs-lookup"><span data-stu-id="f3a91-283">However, if a partial surrogate pair is passed as a value, **concat** can produce incorrect surrogate pairs or partial surrogate pairs.</span></span>  
  
-   <span data-ttu-id="f3a91-284">Операторы сравнения и предложение **ORDER BY** .</span><span class="sxs-lookup"><span data-stu-id="f3a91-284">Comparison operators and the **order by** clause.</span></span> <span data-ttu-id="f3a91-285">Операторы сравнения включают +, \<, > , \<=, > =, `eq` , `lt` , `gt` , `le` и `ge` .</span><span class="sxs-lookup"><span data-stu-id="f3a91-285">Comparison operators include +, \<, >, \<=, >=, `eq`, `lt`, `gt`, `le`, and `ge`.</span></span>  
  
#### <a name="distributed-query-calls-to-a-system-procedure"></a><span data-ttu-id="f3a91-286">Вызовы распределенных запросов к системной процедуре</span><span class="sxs-lookup"><span data-stu-id="f3a91-286">Distributed Query Calls to a System Procedure</span></span>  
 <span data-ttu-id="f3a91-287">Вызовы распределенных запросов через `OPENQUERY` к некоторым системным процедурам завершаются ошибкой, если они выполняются от одного сервера [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] к другому.</span><span class="sxs-lookup"><span data-stu-id="f3a91-287">Distributed query calls through `OPENQUERY` to some system procedures will fail when called from one [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] server to another.</span></span> <span data-ttu-id="f3a91-288">Это происходит тогда, когда компоненту [!INCLUDE[ssDE](../includes/ssde-md.md)] не удается обнаружить метаданные для процедуры.</span><span class="sxs-lookup"><span data-stu-id="f3a91-288">This occurs when the [!INCLUDE[ssDE](../includes/ssde-md.md)] cannot discovery metadata for a procedure.</span></span> <span data-ttu-id="f3a91-289">Например, `SELECT * FROM OPENQUERY(..., 'EXEC xp_loginfo')`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-289">For example, `SELECT * FROM OPENQUERY(..., 'EXEC xp_loginfo')`.</span></span>  
  
#### <a name="isolation-level-and-sp_reset_connection"></a><span data-ttu-id="f3a91-290">Уровень изоляции и sp_reset_connection</span><span class="sxs-lookup"><span data-stu-id="f3a91-290">Isolation Level and sp_reset_connection</span></span>  
 <span data-ttu-id="f3a91-291">Уровень изоляции для подключений обрабатывается драйверами клиента следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f3a91-291">The isolation level for connections is handled in the following way by client drivers:</span></span>  
  
-   <span data-ttu-id="f3a91-292">Все собственные драйверы (SNAC, MDAC, ODBC) задают уровень изоляции (на основании параметров приложения) при sp_reset_connection.</span><span class="sxs-lookup"><span data-stu-id="f3a91-292">All of the native drivers (SNAC, MDAC, ODBC) set the isolation level (based on app setting) upon sp_reset_connection.</span></span>  
  
-   <span data-ttu-id="f3a91-293">Для ADO.NET можно по сути получить случайный уровень изоляции в зависимости от того, какое подключение можно получить из пула (и того, использует ли приложение другой уровень изоляции).</span><span class="sxs-lookup"><span data-stu-id="f3a91-293">For ADO.NET you will essentially get a random isolation level depending on which connection you get from the pool (and if the application uses different isolation level).</span></span> <span data-ttu-id="f3a91-294">Так как пул ADO.NET может повторно использовать подключения внутренне и незаметно для пользователей, невозможно предсказать результат работы пула.</span><span class="sxs-lookup"><span data-stu-id="f3a91-294">Since ADO.NET pool can recycle connections internally and transparently, you cannot predict what will come out of the pool.</span></span>  
  
-   <span data-ttu-id="f3a91-295">Для драйвера JDBC характерно такое же поведение, что и для ADO.NET</span><span class="sxs-lookup"><span data-stu-id="f3a91-295">For the JDBC driver you get same behavior as ADO.NET</span></span>  
  
     <span data-ttu-id="f3a91-296">Приложение должно всегда явно задавать уровень изоляции после открытия соединения, чтобы получить необходимое.</span><span class="sxs-lookup"><span data-stu-id="f3a91-296">The application must always explicitly set isolation level after opening the connection to get what it wants.</span></span>  
  
     <span data-ttu-id="f3a91-297">Подключение JDBC может быть в составе пула, поэтому приложение может получить случайный уровень изоляции и не узнать об этом.</span><span class="sxs-lookup"><span data-stu-id="f3a91-297">The JDBC connection can be pooled, so the application may get a random isolation level and not know about it.</span></span>  
  
 <span data-ttu-id="f3a91-298">Для сохранения обратной совместимости это новое поведение применяется только для последних клиентов, начиная с TDS 7.4.</span><span class="sxs-lookup"><span data-stu-id="f3a91-298">To preserve backward compatibility this new behavior only applies for recent clients beginning with TDS 7.4.</span></span>  
  
#### <a name="backward-compatibility"></a><span data-ttu-id="f3a91-299">Backward Compatibility</span><span class="sxs-lookup"><span data-stu-id="f3a91-299">Backward Compatibility</span></span>  
 <span data-ttu-id="f3a91-300">**Применение нового поведения зависит от уровня совместимости**</span><span class="sxs-lookup"><span data-stu-id="f3a91-300">**New behavior depends on compatibility level**</span></span>  
  
 <span data-ttu-id="f3a91-301">Следующие функции и операторы ведут себя описанным выше образом (по-новому) только при уровне совместимости 110 и выше.</span><span class="sxs-lookup"><span data-stu-id="f3a91-301">The following functions and operators demonstrate the new behavior described above only when the compatibility level is 110 or higher:</span></span>  
  
-   <span data-ttu-id="f3a91-302">**fn: содержит**.</span><span class="sxs-lookup"><span data-stu-id="f3a91-302">**fn:contains**.</span></span>  
  
-   <span data-ttu-id="f3a91-303">**fn: Concat**.</span><span class="sxs-lookup"><span data-stu-id="f3a91-303">**fn:concat**.</span></span>  
  
-   <span data-ttu-id="f3a91-304">операторы сравнения и предложение **ORDER BY**</span><span class="sxs-lookup"><span data-stu-id="f3a91-304">comparison operators and **order by** clause</span></span>  
  
 <span data-ttu-id="f3a91-305">**Применение нового поведения зависит от URI-кода пространства имен по умолчанию для функций**</span><span class="sxs-lookup"><span data-stu-id="f3a91-305">**New behavior depends on default namespace URI for functions**</span></span>  
  
 <span data-ttu-id="f3a91-306">Следующие функции демонстрируют новое поведение, описанное выше, только когда URI пространства имен по умолчанию соответствует пространству имен в конечной рекомендации, то есть [http://www.w3.org/2005/xpath-functions](http://www.w3.org/2005/xpath-functions) .</span><span class="sxs-lookup"><span data-stu-id="f3a91-306">The following functions demonstrate the new behavior described above only when the default namespace URI corresponds to the namespace in the final recommendation, that is, [http://www.w3.org/2005/xpath-functions](http://www.w3.org/2005/xpath-functions).</span></span> <span data-ttu-id="f3a91-307">Если уровень совместимости составляет 110 или выше, [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] по умолчанию привязывает стандартное пространство имен функции к этому пространству имен.</span><span class="sxs-lookup"><span data-stu-id="f3a91-307">When the compatibility level is 110 or higher, then by default [!INCLUDE[ssSQL11](../includes/sssql11-md.md)] binds the default function namespace to this namespace.</span></span> <span data-ttu-id="f3a91-308">Однако, если используется это пространство имен, функции ведут себя по-новому, независимо от уровня совместимости.</span><span class="sxs-lookup"><span data-stu-id="f3a91-308">However these functions demonstrate the new behavior when this namespace is used regardless of the compatibility level.</span></span>  
  
-   <span data-ttu-id="f3a91-309">**FN: длина строки**</span><span class="sxs-lookup"><span data-stu-id="f3a91-309">**fn:string-length**</span></span>  
  
-   <span data-ttu-id="f3a91-310">**FN: подстрока**</span><span class="sxs-lookup"><span data-stu-id="f3a91-310">**fn:substring**</span></span>  
  
##  <a name="breaking-changes-in-sql-server-2008sql-server-2008r2"></a><a name="KJKatmai"></a><span data-ttu-id="f3a91-311">Критические изменения в SQL Server 2008 и SQL Server 2008R2</span><span class="sxs-lookup"><span data-stu-id="f3a91-311">Breaking Changes in SQL Server 2008/SQL Server 2008R2</span></span>  
 <span data-ttu-id="f3a91-312">Этот раздел содержит описание критических изменений, внесенных в [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3a91-312">This section contains the breaking changes introduced in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="f3a91-313">В [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)] не были внесены никакие изменения.</span><span class="sxs-lookup"><span data-stu-id="f3a91-313">No changes were introduced in [!INCLUDE[ssKilimanjaro](../includes/sskilimanjaro-md.md)].</span></span>  
  
### <a name="collations"></a><span data-ttu-id="f3a91-314">Параметры сортировки</span><span class="sxs-lookup"><span data-stu-id="f3a91-314">Collations</span></span>  
  
|<span data-ttu-id="f3a91-315">Компонент</span><span class="sxs-lookup"><span data-stu-id="f3a91-315">Feature</span></span>|<span data-ttu-id="f3a91-316">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-316">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="f3a91-317">Новые параметры сортировки</span><span class="sxs-lookup"><span data-stu-id="f3a91-317">New collations</span></span>|<span data-ttu-id="f3a91-318">В [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] были добавлены новые параметры сортировки, полностью согласованные с параметрами, предоставляемыми в Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="f3a91-318">[!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] introduces new collations that are in full alignment with the collations provided by Windows Server 2008.</span></span> <span data-ttu-id="f3a91-319">Эти 80 новых параметров сортировки имеют улучшенную точность индексирования и отмечены пометками версии \*_100.</span><span class="sxs-lookup"><span data-stu-id="f3a91-319">These 80 new collations have improved linguistic accuracy and are denoted by \*_100 version references.</span></span> <span data-ttu-id="f3a91-320">При выборе новых параметров сортировки для сервера или базы данных помните, что они могут не распознаваться клиентами со старыми драйверами.</span><span class="sxs-lookup"><span data-stu-id="f3a91-320">If you choose a new collation for your server or database, be aware that the collation may not be recognized by clients with older client drivers.</span></span> <span data-ttu-id="f3a91-321">Нераспознанные параметры сортировки могут привести к возвращению ошибок и сбою приложения.</span><span class="sxs-lookup"><span data-stu-id="f3a91-321">Unrecognized collations can cause the application to return errors and fail.</span></span> <span data-ttu-id="f3a91-322">Рассмотрите следующие решения.</span><span class="sxs-lookup"><span data-stu-id="f3a91-322">Consider the following solutions:</span></span><br /><br /> <span data-ttu-id="f3a91-323">Обновление клиентской операционной системы, что приведет к обновлению базовых параметров сортировки.</span><span class="sxs-lookup"><span data-stu-id="f3a91-323">Upgrade the client operating system so that the underlying system collations are updated.</span></span><br /><br /> <span data-ttu-id="f3a91-324">Если у клиента установлено клиентское программное обеспечение базы данных, рекомендуется применить обновление службы к данному программному обеспечению.</span><span class="sxs-lookup"><span data-stu-id="f3a91-324">If your client has database client software installed, consider applying a service update to the database client software.</span></span><br /><br /> <span data-ttu-id="f3a91-325">Выберите существующие параметры сортировки, сопоставленные с кодовой страницей клиента.</span><span class="sxs-lookup"><span data-stu-id="f3a91-325">Choose an existing collation that maps to a code page on the client.</span></span>|  
  
### <a name="common-language-runtime-clr"></a><span data-ttu-id="f3a91-326">Среда CLR</span><span class="sxs-lookup"><span data-stu-id="f3a91-326">Common Language Runtime (CLR)</span></span>  
  
|<span data-ttu-id="f3a91-327">Компонент</span><span class="sxs-lookup"><span data-stu-id="f3a91-327">Feature</span></span>|<span data-ttu-id="f3a91-328">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-328">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="f3a91-329">Сборки среды CLR</span><span class="sxs-lookup"><span data-stu-id="f3a91-329">CLR Assemblies</span></span>|<span data-ttu-id="f3a91-330">При обновлении базы данных до версии [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] для поддержки новых типов данных автоматически устанавливается сборка `Microsoft.SqlServer.Types`.</span><span class="sxs-lookup"><span data-stu-id="f3a91-330">When a database is upgraded to [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], the `Microsoft.SqlServer.Types` assembly to support new data types is automatically installed.</span></span> <span data-ttu-id="f3a91-331">Правила помощника по обновлению обнаружат все пользовательские типы данных или сборки с конфликтующими именами.</span><span class="sxs-lookup"><span data-stu-id="f3a91-331">Upgrade Advisor rules detect any user type or assemblies with conflicting names.</span></span> <span data-ttu-id="f3a91-332">Помощник по обновлению посоветует переименовать все конфликтующие сборки и либо переименовать все конфликтующие типы данных, либо использовать в программном коде двухкомпонентные имена для ссылок на существующие определяемые пользователем типы данных.</span><span class="sxs-lookup"><span data-stu-id="f3a91-332">The Upgrade Advisor will advise renaming of any conflicting assembly, and either renaming any conflicting type, or using two-part names in the code to refer to that preexisting user type.</span></span><br /><br /> <span data-ttu-id="f3a91-333">Если при обновлении базы данных обнаружится пользовательская сборка с конфликтующим именем, эта сборка автоматически переименуется, а база данных переведется в подозрительный режим.</span><span class="sxs-lookup"><span data-stu-id="f3a91-333">If a database upgrade detects a user assembly with a conflicting name, it will automatically rename that assembly and put the database into suspect mode.</span></span><br /><br /> <span data-ttu-id="f3a91-334">Если во время обновления обнаруживается пользовательский тип данных с конфликтующим именем, никаких специальных шагов не предпринимается.</span><span class="sxs-lookup"><span data-stu-id="f3a91-334">If a user type with conflicting name exists during the upgrade, no special steps are taken.</span></span> <span data-ttu-id="f3a91-335">После обновления будут существовать как старый пользовательский тип, так и новый системный тип данных.</span><span class="sxs-lookup"><span data-stu-id="f3a91-335">After the upgrade, both the old user type, and the new system type, will exist.</span></span> <span data-ttu-id="f3a91-336">Пользовательский тип данных будет доступен только с применением двухкомпонентных имен.</span><span class="sxs-lookup"><span data-stu-id="f3a91-336">The user type will be available only through two-part names.</span></span>|  
|<span data-ttu-id="f3a91-337">Сборки среды CLR</span><span class="sxs-lookup"><span data-stu-id="f3a91-337">CLR Assemblies</span></span>|[!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] <span data-ttu-id="f3a91-338">устанавливает платформу .NET Framework 3.5 с пакетом обновления 1 (SP1), которая обновляет библиотеки в глобальном кэше сборок.</span><span class="sxs-lookup"><span data-stu-id="f3a91-338">installs .NET Framework 3.5 SP1, which updates libraries in the Global Assembly Cache (GAC).</span></span> <span data-ttu-id="f3a91-339">При наличии неподдерживаемых библиотек, зарегистрированных в базе данных [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], приложение [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] может прекратить работу после обновления до версии [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3a91-339">If you have unsupported libraries registered in a [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] database, your [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] application may stop working after upgrading to [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="f3a91-340">Это происходит вследствие того, что обслуживание или обновление библиотек в глобальном кэше сборок не обновляет сборки внутри [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3a91-340">This is because servicing or upgrading libraries in the GAC does not update assemblies inside [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f3a91-341">Если сборка существует как в базе данных [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], так и в глобальном кэше сборок, обе копии сборки должны полностью совпадать.</span><span class="sxs-lookup"><span data-stu-id="f3a91-341">If an assembly exists both in a [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] database and in the GAC, the two copies of the assembly must exactly match.</span></span> <span data-ttu-id="f3a91-342">Если они не совпадают, то при использовании сборки с интеграцией со средой [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] CLR возникает ошибка.</span><span class="sxs-lookup"><span data-stu-id="f3a91-342">If they do not match, an error will occur when the assembly is used by [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] CLR integration.</span></span> <span data-ttu-id="f3a91-343">Дополнительные сведения см. в разделе [supported .NET Framework librarys](../relational-databases/clr-integration/database-objects/supported-net-framework-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="f3a91-343">For more information, see [Supported .NET Framework Libraries](../relational-databases/clr-integration/database-objects/supported-net-framework-libraries.md).</span></span><br /><br /> <span data-ttu-id="f3a91-344">После обновления базы данных следует выполнить обслуживание или обновление копии сборки внутри баз данных [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] с помощью инструкции ALTER ASSEMBLY.</span><span class="sxs-lookup"><span data-stu-id="f3a91-344">After upgrading your database, service or upgrade the copy of the assembly inside your [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] databases with the ALTER ASSEMBLY statement.</span></span> <span data-ttu-id="f3a91-345">Дополнительные сведения см. в [статье базы знаний 949080](https://go.microsoft.com/fwlink/?LinkId=154563).</span><span class="sxs-lookup"><span data-stu-id="f3a91-345">For more information, see [Knowledge Base article 949080](https://go.microsoft.com/fwlink/?LinkId=154563).</span></span><br /><br /> <span data-ttu-id="f3a91-346">Чтобы определить, используется ли в приложении неподдерживаемая библиотека платформы .NET Framework, в базе данных следует выполнить следующий запрос:</span><span class="sxs-lookup"><span data-stu-id="f3a91-346">To detect whether you are using any unsupported .NET framework library in your application, run the following query in your database.</span></span><br /><br /> `SELECT name FROM sys.assemblies WHERE clr_name LIKE '%publickeytoken=b03f5f7f11d50a3a,%';`|  
|<span data-ttu-id="f3a91-347">Подпрограммы CLR</span><span class="sxs-lookup"><span data-stu-id="f3a91-347">CLR Routines</span></span>|<span data-ttu-id="f3a91-348">Использование олицетворения в определяемых пользователем функциях CLR, определяемых пользователем статистических функциях CLR или определяемых пользователем типах CLR после обновления до [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] может вызвать завершение приложений с ошибкой 6522.</span><span class="sxs-lookup"><span data-stu-id="f3a91-348">Using impersonation inside CLR user-defined functions, user-defined aggregates, or user-defined types (UDTs) may cause your application to fail with error 6522 after upgrading to [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="f3a91-349">Следующие сценарии выполняются успешно в [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], но завершаются ошибкой в [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3a91-349">The following scenarios succeed in [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] but fail in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="f3a91-350">Для каждого сценария указаны способы разрешения.</span><span class="sxs-lookup"><span data-stu-id="f3a91-350">Resolutions are provided for each scenario.</span></span><br /><br /> <span data-ttu-id="f3a91-351">Определяемая пользователем функция CLR, определяемая пользователем статистическая обработка или метод определяемого пользователем типа, использующий олицетворение, имеет параметр типа,,,,, `nvarchar(max)` `varchar(max)` `varbinary(max)` `ntext` `text` `image` или большого определяемого пользователем типа и не имеет атрибута **DataAccessKind. Read** в методе.</span><span class="sxs-lookup"><span data-stu-id="f3a91-351">A CLR user-defined function, user-defined aggregate, or UDT method that uses impersonation has a parameter of type `nvarchar(max)`, `varchar(max)`, `varbinary(max)`, `ntext`, `text`, `image`, or a large UDT, and does not have the **DataAccessKind.Read** attribute on the method.</span></span> <span data-ttu-id="f3a91-352">Чтобы устранить эту проблему, добавьте атрибут **DataAccessKind. Read** в метод, перекомпилируйте сборку и повторно разверните подпрограммы и сборку.</span><span class="sxs-lookup"><span data-stu-id="f3a91-352">To resolve this issue, add the **DataAccessKind.Read** attribute on the method, recompile the assembly, and re-deploy the routine and the assembly.</span></span><br /><br /> <span data-ttu-id="f3a91-353">Возвращающая табличное значение функция CLR, которая имеет метод **init** , выполняющий олицетворение.</span><span class="sxs-lookup"><span data-stu-id="f3a91-353">A CLR table-valued function that has an **Init** method that performs impersonation.</span></span> <span data-ttu-id="f3a91-354">Чтобы устранить эту проблему, добавьте атрибут **DataAccessKind. Read** в метод, перекомпилируйте сборку и повторно разверните подпрограммы и сборку.</span><span class="sxs-lookup"><span data-stu-id="f3a91-354">To resolve this issue add the **DataAccessKind.Read** attribute on the method, recompile the assembly, and re-deploy the routine and the assembly.</span></span><br /><br /> <span data-ttu-id="f3a91-355">Возвращающая табличное значение функция CLR, которая имеет метод **FillRow** , выполняющий олицетворение.</span><span class="sxs-lookup"><span data-stu-id="f3a91-355">A CLR table-valued function that has a **FillRow** method that performs impersonation.</span></span> <span data-ttu-id="f3a91-356">Чтобы устранить эту проблему, удалите олицетворение из метода **FillRow** .</span><span class="sxs-lookup"><span data-stu-id="f3a91-356">To resolve this issue, remove impersonation from the **FillRow** method.</span></span> <span data-ttu-id="f3a91-357">Не используйте доступ к внешним ресурсам с помощью метода **FillRow** .</span><span class="sxs-lookup"><span data-stu-id="f3a91-357">Do not access external resources by using the **FillRow** method.</span></span> <span data-ttu-id="f3a91-358">Вместо этого следует обращаться к внешним ресурсам из метода **init** .</span><span class="sxs-lookup"><span data-stu-id="f3a91-358">Instead, access external resources from the **Init** method.</span></span>|  
  
### <a name="dynamic-management-views"></a><span data-ttu-id="f3a91-359">Динамические административные представления</span><span class="sxs-lookup"><span data-stu-id="f3a91-359">Dynamic Management Views</span></span>  
  
|<span data-ttu-id="f3a91-360">Просмотр</span><span class="sxs-lookup"><span data-stu-id="f3a91-360">View</span></span>|<span data-ttu-id="f3a91-361">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-361">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="f3a91-362">sys.dm_os_sys_info</span><span class="sxs-lookup"><span data-stu-id="f3a91-362">sys.dm_os_sys_info</span></span>|<span data-ttu-id="f3a91-363">Удалены столбцы cpu_ticks_in_ms и sqlserver_start_time_cpu_ticks.</span><span class="sxs-lookup"><span data-stu-id="f3a91-363">Removed the cpu_ticks_in_ms and sqlserver_start_time_cpu_ticks columns.</span></span>|  
|<span data-ttu-id="f3a91-364">sys. dm_exec_query_resource_semaphoressys. dm_exec_query_memory_grants</span><span class="sxs-lookup"><span data-stu-id="f3a91-364">sys.dm_exec_query_resource_semaphoressys.dm_exec_query_memory_grants</span></span>|<span data-ttu-id="f3a91-365">Столбец resource_semaphore_id не является уникальным идентификатором в [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3a91-365">The resource_semaphore_id column is not a unique ID in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="f3a91-366">Данное изменение может повлиять на устранение проблем в запросах.</span><span class="sxs-lookup"><span data-stu-id="f3a91-366">This change can affect troubleshooting query execution.</span></span> <span data-ttu-id="f3a91-367">Дополнительные сведения см. в разделе [sys. dm_exec_query_resource_semaphores &#40;&#41;Transact-SQL ](/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-query-resource-semaphores-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f3a91-367">For more information, see [sys.dm_exec_query_resource_semaphores &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-query-resource-semaphores-transact-sql).</span></span>|  
  
### <a name="errors-and-events"></a><span data-ttu-id="f3a91-368">Ошибки и события</span><span class="sxs-lookup"><span data-stu-id="f3a91-368">Errors and Events</span></span>  
  
|<span data-ttu-id="f3a91-369">Компонент</span><span class="sxs-lookup"><span data-stu-id="f3a91-369">Feature</span></span>|<span data-ttu-id="f3a91-370">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-370">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="f3a91-371">Ошибки имени входа</span><span class="sxs-lookup"><span data-stu-id="f3a91-371">Login errors</span></span>|<span data-ttu-id="f3a91-372">В [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] ошибка 18452 возвращается при использовании имени входа SQL для соединения с сервером, настроенным для использования проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f3a91-372">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], error 18452 is returned when a SQL login is used to connect to a server configured to use only Windows Authentication.</span></span> <span data-ttu-id="f3a91-373">В [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] вместо этого возвращается ошибка 18456.</span><span class="sxs-lookup"><span data-stu-id="f3a91-373">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], error 18456 is returned instead.</span></span>|  
  
### <a name="showplan"></a><span data-ttu-id="f3a91-374">Showplan</span><span class="sxs-lookup"><span data-stu-id="f3a91-374">Showplan</span></span>  
  
|<span data-ttu-id="f3a91-375">Компонент</span><span class="sxs-lookup"><span data-stu-id="f3a91-375">Feature</span></span>|<span data-ttu-id="f3a91-376">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-376">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="f3a91-377">Схема XML Showplan</span><span class="sxs-lookup"><span data-stu-id="f3a91-377">Showplan XML schema</span></span>|<span data-ttu-id="f3a91-378">В XML-схему Showplan добавляется новый элемент **SeekPredicateNew** , а включающая XSD-последовательность (**склпредикатестипе**) преобразуется в **\<xsd:choice>** элемент.</span><span class="sxs-lookup"><span data-stu-id="f3a91-378">A new **SeekPredicateNew** element is added to the Showplan XML schema, and the enclosing xsd sequence (**SqlPredicatesType**) is converted into an **\<xsd:choice>** item.</span></span> <span data-ttu-id="f3a91-379">Вместо одного или нескольких элементов **сикпредикате** может появиться один или несколько элементов **SeekPredicateNew** в инструкции Showplan XML.</span><span class="sxs-lookup"><span data-stu-id="f3a91-379">Instead of one or more **SeekPredicate** elements, one or more **SeekPredicateNew** elements may now appear in the Showplan XML.</span></span> <span data-ttu-id="f3a91-380">Эти два элемента являются взаимоисключающими.</span><span class="sxs-lookup"><span data-stu-id="f3a91-380">The two elements are mutually exclusive.</span></span> <span data-ttu-id="f3a91-381">**Сикпредикате** поддерживается в схеме Showplan XML для обеспечения обратной совместимости; Однако планы запросов, созданные в, [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] могут содержать элемент **SeekPredicateNew** .</span><span class="sxs-lookup"><span data-stu-id="f3a91-381">**SeekPredicate** is maintained in the Showplan XML schema for backwards compatibility; however, query plans created in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] may contain the **SeekPredicateNew** element.</span></span> <span data-ttu-id="f3a91-382">Приложения, которые предполагают получение только дочернего элемента **сикпредикате** с узла ShowPlanXML/Батчсекуенце/Batch/операторы/StmtSimple/Куериплан/RelOp/Индексскан/сикпредикатес, могут завершиться ошибкой, если элемент **сикпредикате** не существует.</span><span class="sxs-lookup"><span data-stu-id="f3a91-382">Applications that expect to retrieve only the **SeekPredicate** child from the node ShowPlanXML/BatchSequence/Batch/Statements/StmtSimple/QueryPlan/RelOp/IndexScan/SeekPredicates may fail if the **SeekPredicate** element does not exist.</span></span> <span data-ttu-id="f3a91-383">Перепишите приложение, чтобы в нем можно было бы использовать элемент **сикпредикате** или **SeekPredicateNew** .</span><span class="sxs-lookup"><span data-stu-id="f3a91-383">Rewrite the application to expect either the **SeekPredicate** or **SeekPredicateNew** element in this node.</span></span> <span data-ttu-id="f3a91-384">Дополнительные сведения см. в разделе .</span><span class="sxs-lookup"><span data-stu-id="f3a91-384">For more information, see .</span></span>|  
|<span data-ttu-id="f3a91-385">Схема XML Showplan</span><span class="sxs-lookup"><span data-stu-id="f3a91-385">Showplan XML schema</span></span>|<span data-ttu-id="f3a91-386">Новый атрибут **индекскинд** добавляется в сложный тип **ObjectType** в схеме XML Showplan.</span><span class="sxs-lookup"><span data-stu-id="f3a91-386">A new **IndexKind** attribute is added to the **ObjectType** complex type in the Showplan XML schema.</span></span> <span data-ttu-id="f3a91-387">Работа приложений, выполняющих строгую проверку планов [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] по отношению к схеме [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], будет завершаться с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="f3a91-387">Applications that strictly validate [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] plans against the [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] schema will fail.</span></span>|  
  
### <a name="transact-sql"></a><span data-ttu-id="f3a91-388">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="f3a91-388">Transact-SQL</span></span>  
  
|<span data-ttu-id="f3a91-389">Компонент</span><span class="sxs-lookup"><span data-stu-id="f3a91-389">Feature</span></span>|<span data-ttu-id="f3a91-390">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-390">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="f3a91-391">DDL-событие ALTER_AUTHORIZATION_DATABASE</span><span class="sxs-lookup"><span data-stu-id="f3a91-391">ALTER_AUTHORIZATION_DATABASE DDL event</span></span>|<span data-ttu-id="f3a91-392">В [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] при срабатывании ALTER_AUTHORIZATION_DATABASE события DDL значение "Object" возвращается в элементе **ObjectType** XML-файла EVENTDATA для данного события, если тип сущности защищаемого объекта в операции языка DDL является объектом.</span><span class="sxs-lookup"><span data-stu-id="f3a91-392">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], when the DDL event ALTER_AUTHORIZATION_DATABASE fires, the value 'object' is returned in the **ObjectType** element of the EVENTDATA xml for this event when the entity type of the securable in the data definition language (DDL) operation is an object.</span></span> <span data-ttu-id="f3a91-393">В [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] возвращается действительный тип (например, «table» или «function»).</span><span class="sxs-lookup"><span data-stu-id="f3a91-393">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], the actual type (for example, 'table', or 'function') is returned.</span></span>|  
|<span data-ttu-id="f3a91-394">CONVERT</span><span class="sxs-lookup"><span data-stu-id="f3a91-394">CONVERT</span></span>|<span data-ttu-id="f3a91-395">Если в функцию CONVERT передан недопустимый стиль, при преобразовании двоичного типа в символьный или символьного в двоичный возвращается ошибка.</span><span class="sxs-lookup"><span data-stu-id="f3a91-395">If an invalid style is passed to the CONVERT function, an error is returned when the type of conversion is binary to character or character to binary.</span></span> <span data-ttu-id="f3a91-396">В предыдущих версиях [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] недопустимый стиль устанавливается на стиль по умолчанию для преобразований «двоичный в символьный» и «символьный в двоичный».</span><span class="sxs-lookup"><span data-stu-id="f3a91-396">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], the invalid style is set to the default style for binary-to-character and character-to-binary conversions.</span></span>|  
|<span data-ttu-id="f3a91-397">Разрешения GRANT/DENY/REVOKE EXECUTE для сборок</span><span class="sxs-lookup"><span data-stu-id="f3a91-397">GRANT/DENY/REVOKE EXECUTE on assemblies</span></span>|<span data-ttu-id="f3a91-398">Для сборок разрешение EXECUTE нельзя предоставить, запретить или отменить.</span><span class="sxs-lookup"><span data-stu-id="f3a91-398">EXECUTE permission cannot be granted, denied, or revoked to assemblies.</span></span> <span data-ttu-id="f3a91-399">Это разрешение не оказывает влияния и вызывает ошибку.</span><span class="sxs-lookup"><span data-stu-id="f3a91-399">This permission has no affect and now causes an error.</span></span> <span data-ttu-id="f3a91-400">Вместо этого можно предоставить, запретить или отменить разрешение EXECUTE для хранимых процедур или функций, ссылающихся на метод сборки.</span><span class="sxs-lookup"><span data-stu-id="f3a91-400">Grant, deny, or revoke EXECUTE permission on the stored procedures or functions that reference the assembly method instead.</span></span>|  
|<span data-ttu-id="f3a91-401">Разрешения GRANT/DENY/REVOKE на системные типы</span><span class="sxs-lookup"><span data-stu-id="f3a91-401">GRANT/DENY/REVOKE permissions on system types</span></span>|<span data-ttu-id="f3a91-402">Разрешения на системные типы нельзя предоставить, запретить или отменить.</span><span class="sxs-lookup"><span data-stu-id="f3a91-402">Permissions cannot be granted, denied, or revoked to system types.</span></span> <span data-ttu-id="f3a91-403">В предыдущих версиях [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] данные инструкции завершаются успешно, но не оказывают влияния.</span><span class="sxs-lookup"><span data-stu-id="f3a91-403">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], these statements succeed but have no effect.</span></span> <span data-ttu-id="f3a91-404">В [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] возвращается ошибка.</span><span class="sxs-lookup"><span data-stu-id="f3a91-404">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], an error is returned.</span></span>|  
|<span data-ttu-id="f3a91-405">GROUP BY</span><span class="sxs-lookup"><span data-stu-id="f3a91-405">GROUP BY</span></span>|<span data-ttu-id="f3a91-406">Предложение GROUP BY не может содержать вложенный запрос в выражении, используемом для списка group by.</span><span class="sxs-lookup"><span data-stu-id="f3a91-406">The GROUP BY clause cannot contain a subquery in an expression that is used for the group by list.</span></span> <span data-ttu-id="f3a91-407">В предыдущих версиях [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] это допускалось.</span><span class="sxs-lookup"><span data-stu-id="f3a91-407">In earlier versions of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], this was allowed.</span></span> <span data-ttu-id="f3a91-408">В [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] возвращается ошибка 144.</span><span class="sxs-lookup"><span data-stu-id="f3a91-408">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], error 144 is returned.</span></span><br /><br /> <span data-ttu-id="f3a91-409">Например, следующий код будет выполнен успешно в SQL Server 2005 и завершится с ошибкой в SQL Server 2008.</span><span class="sxs-lookup"><span data-stu-id="f3a91-409">For example, the following code will succeed in SQL Server 2005 and fail in SQL Server 2008.</span></span><br /><br /> `DECLARE @Test TABLE(a int NOT NULL);` <br /> `INSERT INTO @Test SELECT 1 union ALL SELECT 2;` <br /> `SELECT COUNT(*)` <br /> `FROM @Test` <br /> `GROUP BY CASE WHEN a IN (SELECT t.a FROM @Test AS t)` <br /> `THEN 1 ELSE 0` <br /> `END;`|  
|<span data-ttu-id="f3a91-410">OUTPUT, предложение</span><span class="sxs-lookup"><span data-stu-id="f3a91-410">OUTPUT clause</span></span>|<span data-ttu-id="f3a91-411">Во избежание недетерминированного поведения в предложении OUTPUT запрещено ссылаться на столбец из представления или встроенной функции, возвращающей табличное значение, если этот столбец определен одним из следующих методов.</span><span class="sxs-lookup"><span data-stu-id="f3a91-411">To prevent nondeterministic behavior, the OUTPUT clause cannot reference a column from a view or inline table-valued function when that column is defined by one of the following methods:</span></span><br /><br /> <span data-ttu-id="f3a91-412">вложенный запрос.</span><span class="sxs-lookup"><span data-stu-id="f3a91-412">A subquery.</span></span><br /><br /> <span data-ttu-id="f3a91-413">Определяемая пользователем функция, которая осуществляет или может осуществлять доступ к пользовательским или системным данным.</span><span class="sxs-lookup"><span data-stu-id="f3a91-413">A user-defined function that performs user- or system-data access, or is assumed to perform such access.</span></span><br /><br /> <span data-ttu-id="f3a91-414">Вычисляемый столбец, содержащий в своем определении определяемую пользователем функцию, которая осуществляет доступ к пользовательским или системным данным.</span><span class="sxs-lookup"><span data-stu-id="f3a91-414">A computed column that contains in its definition a user-defined function that performs user- or system-data access.</span></span><br /><br /> <br /><br /> <span data-ttu-id="f3a91-415">При обнаружении [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] такого столбца в предложении OUTPUT возвращается ошибка 4186.</span><span class="sxs-lookup"><span data-stu-id="f3a91-415">When [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] detects such a column in the OUTPUT clause, error 4186 is raised.</span></span> <span data-ttu-id="f3a91-416">Дополнительные сведения см. в разделе [MSSQLSERVER_4186](../relational-databases/errors-events/mssqlserver-4186-database-engine-error.md).</span><span class="sxs-lookup"><span data-stu-id="f3a91-416">For more information, see [MSSQLSERVER_4186](../relational-databases/errors-events/mssqlserver-4186-database-engine-error.md).</span></span>|  
|<span data-ttu-id="f3a91-417">Предложение OUTPUT INTO</span><span class="sxs-lookup"><span data-stu-id="f3a91-417">OUTPUT INTO clause</span></span>|<span data-ttu-id="f3a91-418">Целевая таблица предложения OUTPUT INTO не может иметь какие-либо включенные триггеры.</span><span class="sxs-lookup"><span data-stu-id="f3a91-418">The target table of the OUTPUT INTO clause cannot have any enabled triggers.</span></span>|  
|<span data-ttu-id="f3a91-419">Параметр уровня сервера precompute rank</span><span class="sxs-lookup"><span data-stu-id="f3a91-419">precompute rank server-level option</span></span>|<span data-ttu-id="f3a91-420">Этот параметр не поддерживается в [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3a91-420">This option is not supported in [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)].</span></span> <span data-ttu-id="f3a91-421">Как можно скорее измените приложения, в настоящее время использующие эту функцию.</span><span class="sxs-lookup"><span data-stu-id="f3a91-421">Modify applications that currently use this feature as soon as possible.</span></span>|  
|<span data-ttu-id="f3a91-422">Табличное указание READPAST</span><span class="sxs-lookup"><span data-stu-id="f3a91-422">READPAST table hint</span></span>|<span data-ttu-id="f3a91-423">Нельзя задавать указание READPAST при изоляции моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="f3a91-423">You cannot specify the READPAST hint under Snapshot Isolation.</span></span><br /><br /> <span data-ttu-id="f3a91-424">Если параметру базы данных ALLOW_SNAPSHOT_ISOLATION или READ_COMMITTED_SNAPSHOT, либо обоим этим параметрам присвоено значение ON, то указание READPAST пропускается.</span><span class="sxs-lookup"><span data-stu-id="f3a91-424">The READPAST hint is ignored when either the READ_COMMITED_SNAPSHOT or ALLOW_SNAPSHOT_ISOLATION database option is set to ON.</span></span> <span data-ttu-id="f3a91-425">Однако если указание READPAST применяется совместно с READCOMMITTEDLOCK, то READPAST будет работать таким же образом, как и при использовании блокирующего указания READCOMMITTED.</span><span class="sxs-lookup"><span data-stu-id="f3a91-425">However, if you combine the READPAST hint with READCOMMITTEDLOCK, the READPAST behavior is same as with the blocking READCOMMITTED hint.</span></span>|  
|<span data-ttu-id="f3a91-426">sp_helpuser</span><span class="sxs-lookup"><span data-stu-id="f3a91-426">sp_helpuser</span></span>|<span data-ttu-id="f3a91-427">Следующие имена столбцов, возвращаемые в результирующем наборе хранимой процедуры sp_helpuser, были изменены:</span><span class="sxs-lookup"><span data-stu-id="f3a91-427">The following column names that are returned in the result set of the sp_helpuser stored procedure have changed:</span></span><br /><br /> <span data-ttu-id="f3a91-428">GroupName теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-428">GroupName is now:</span></span><br />                            <span data-ttu-id="f3a91-429">RoleName</span><span class="sxs-lookup"><span data-stu-id="f3a91-429">RoleName</span></span><br /><br /> <span data-ttu-id="f3a91-430">Group_name теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-430">Group_name is now:</span></span><br />                            <span data-ttu-id="f3a91-431">Role_name</span><span class="sxs-lookup"><span data-stu-id="f3a91-431">Role_name</span></span><br /><br /> <span data-ttu-id="f3a91-432">Group_id теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-432">Group_id is now:</span></span><br />                            <span data-ttu-id="f3a91-433">Role_id</span><span class="sxs-lookup"><span data-stu-id="f3a91-433">Role_id</span></span><br /><br /> <span data-ttu-id="f3a91-434">Users_in_group теперь:</span><span class="sxs-lookup"><span data-stu-id="f3a91-434">Users_in_group is now:</span></span><br />                            <span data-ttu-id="f3a91-435">Users_in_role</span><span class="sxs-lookup"><span data-stu-id="f3a91-435">Users_in_role</span></span>|  
|<span data-ttu-id="f3a91-436">прозрачное шифрование данных.</span><span class="sxs-lookup"><span data-stu-id="f3a91-436">Transparent Data Encryption</span></span>|<span data-ttu-id="f3a91-437">Прозрачное шифрование данных (TDE) выполняется на уровне ввода-вывода: структура страницы остается в памяти незашифрованной и шифруется только при записи страницы на диск.</span><span class="sxs-lookup"><span data-stu-id="f3a91-437">Transparent data encryption (TDE) is performed at the I/O level: the page structure is unencrypted in memory and is encrypted only when the page is written to disk.</span></span> <span data-ttu-id="f3a91-438">Шифруются как файлы базы данных, так и файлы журнала.</span><span class="sxs-lookup"><span data-stu-id="f3a91-438">Both the database files and log files are encrypted.</span></span> <span data-ttu-id="f3a91-439">Приложения сторонних производителей, которые обходят обычный механизм [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] при доступе к страницам (например, путем прямого просмотра данных или файлов журнала), будут завершены с ошибкой при использовании базой данных прозрачного шифрования данных, так как данные в файлах зашифрованы.</span><span class="sxs-lookup"><span data-stu-id="f3a91-439">Third-party applications that bypass the regular [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] mechanism for accessing pages (for example, by scanning the data or log files directly), will fail when a database uses TDE because the data is encrypted in the files.</span></span> <span data-ttu-id="f3a91-440">Для таких приложений можно эффективно использовать API-интерфейс шифрования Window, чтобы разработать решения для расшифровки данных за пределами [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3a91-440">Such applications can leverage the Window Cryptographic API to develop a solution for decrypting the data outside of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>|  
  
### <a name="xquery"></a><span data-ttu-id="f3a91-441">XQuery</span><span class="sxs-lookup"><span data-stu-id="f3a91-441">XQuery</span></span>  
  
|<span data-ttu-id="f3a91-442">Компонент</span><span class="sxs-lookup"><span data-stu-id="f3a91-442">Feature</span></span>|<span data-ttu-id="f3a91-443">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-443">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="f3a91-444">Поддержка типа данных datetime</span><span class="sxs-lookup"><span data-stu-id="f3a91-444">Datetime support</span></span>|<span data-ttu-id="f3a91-445">В [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] типы данных, `xs:time` `xs:date` и `xs:dateTime` не поддерживают часовой пояс.</span><span class="sxs-lookup"><span data-stu-id="f3a91-445">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], the data types `xs:time`, `xs:date`, and `xs:dateTime` do not have timezone support.</span></span> <span data-ttu-id="f3a91-446">Данные часового пояса сопоставляются с часовым поясом времени в формате UTC.</span><span class="sxs-lookup"><span data-stu-id="f3a91-446">Timezone data is mapped to the UTC timezone.</span></span> [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] <span data-ttu-id="f3a91-447">обеспечивает соответствующее стандартное поведение, приводящее к следующим изменениям.</span><span class="sxs-lookup"><span data-stu-id="f3a91-447">, provides standard conformant behavior, resulting in the following changes:</span></span><br /><br /> <span data-ttu-id="f3a91-448">Данные без часового пояса проходят проверку.</span><span class="sxs-lookup"><span data-stu-id="f3a91-448">Values without timezone are validated.</span></span><br /><br /> <span data-ttu-id="f3a91-449">Предоставленный часовой пояс или его отсутствие сохраняются.</span><span class="sxs-lookup"><span data-stu-id="f3a91-449">The provided timezone or the absence of a timezone is preserved.</span></span><br /><br /> <span data-ttu-id="f3a91-450">Изменяется внутреннее представление хранилища.</span><span class="sxs-lookup"><span data-stu-id="f3a91-450">The internal storage representation is modified.</span></span><br /><br /> <span data-ttu-id="f3a91-451">Увеличивается разрешение хранимых значений.</span><span class="sxs-lookup"><span data-stu-id="f3a91-451">Resolution of stored values is increased.</span></span><br /><br /> <span data-ttu-id="f3a91-452">Отрицательные значения года запрещены.</span><span class="sxs-lookup"><span data-stu-id="f3a91-452">Negative years are disallowed.</span></span><br /><br /> <br /><br /> <span data-ttu-id="f3a91-453">Примечание. измените приложения и выражения XQuery для учета новых значений типа.</span><span class="sxs-lookup"><span data-stu-id="f3a91-453">Note: Modify applications and XQuery expressions to account for the new type values.</span></span>|  
|<span data-ttu-id="f3a91-454">Выражения XQuery и Xpath</span><span class="sxs-lookup"><span data-stu-id="f3a91-454">XQuery and Xpath expressions</span></span>|<span data-ttu-id="f3a91-455">В в [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)] выражениях XQuery или XPath, которые начинаются с двоеточия (":"), допускаются шаги.</span><span class="sxs-lookup"><span data-stu-id="f3a91-455">In [!INCLUDE[ssVersion2005](../includes/ssversion2005-md.md)], steps in an XQuery or XPath expression that begin with a colon (':') are allowed.</span></span> <span data-ttu-id="f3a91-456">Например, следующая инструкция содержит в пределах выражения пути проверку имени (`CTR02)`, которое начинается с двоеточия.</span><span class="sxs-lookup"><span data-stu-id="f3a91-456">For example, the following statement contains a name test (`CTR02)` within the path expression that begins with a colon.</span></span><br /><br /> `SELECT FileContext.query('for n$ in //CTR return <C>{data )(n$/:CTR02)} </C>) AS Files FROM dbo.MyTable;`<br /><br /> <span data-ttu-id="f3a91-457">В [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)] такое использование не допускается, поскольку это не соответствует стандартам XML.</span><span class="sxs-lookup"><span data-stu-id="f3a91-457">In [!INCLUDE[ssKatmai](../includes/sskatmai-md.md)], this usage is disallowed because it does not conform to XML standards.</span></span> <span data-ttu-id="f3a91-458">Возвращена ошибка 9341.</span><span class="sxs-lookup"><span data-stu-id="f3a91-458">Error 9341 is returned.</span></span> <span data-ttu-id="f3a91-459">Удалите начальное двоеточие или укажите префикс для проверки имени, например (n$/CTR02) или (n$/p1:CTR02).</span><span class="sxs-lookup"><span data-stu-id="f3a91-459">Remove the leading colon or specify a prefix for the name test--for example, (n$/CTR02) or (n$/p1:CTR02).</span></span>|  
  
### <a name="connecting"></a><span data-ttu-id="f3a91-460">Соединение</span><span class="sxs-lookup"><span data-stu-id="f3a91-460">Connecting</span></span>  
  
|<span data-ttu-id="f3a91-461">Компонент</span><span class="sxs-lookup"><span data-stu-id="f3a91-461">Feature</span></span>|<span data-ttu-id="f3a91-462">Описание</span><span class="sxs-lookup"><span data-stu-id="f3a91-462">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="f3a91-463">Соединение с Native Client [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] по протоколу SSL</span><span class="sxs-lookup"><span data-stu-id="f3a91-463">Connecting from [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client using SSL</span></span>|<span data-ttu-id="f3a91-464">При соединении через Native Client [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] те приложения, которые используют параметр "SERVER=shortname; FORCE ENCRYPTION=true" с сертификатом, где в субъекте указано полное доменное имя (FQDN), раньше подключались благодаря ослабленной проверке.</span><span class="sxs-lookup"><span data-stu-id="f3a91-464">When connecting with [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client, applications that use "SERVER=shortname; FORCE ENCRYPTION=true" with certificate whose Subjects specify Fully Qualified Domain Names (FQDN's) have connected in the past due to relaxed validation.</span></span> <span data-ttu-id="f3a91-465">SQL Server 2008 R2 расширяет защиту за счет включения в сертификаты предмета FQDN.</span><span class="sxs-lookup"><span data-stu-id="f3a91-465">SQL Server 2008 R2 enhances security by enforcing FQDN subjects for certificates.</span></span> <span data-ttu-id="f3a91-466">В приложениях, где используется ослабленная проверка, необходимо предпринять следующие меры.</span><span class="sxs-lookup"><span data-stu-id="f3a91-466">Applications that rely upon relaxed validation must take one of the following actions:</span></span><br /><br /> <span data-ttu-id="f3a91-467">Используйте полное доменное имя в строке подключения.</span><span class="sxs-lookup"><span data-stu-id="f3a91-467">Use the FQDN in the connection string.</span></span><br /><br /> <span data-ttu-id="f3a91-468">— Этот параметр не требует перекомпиляции приложения, если ключевое слово SERVER в строке подключения настроено вне приложения.</span><span class="sxs-lookup"><span data-stu-id="f3a91-468">-This option does not require recompiling the application if the SERVER keyword of the connection string is configured outside the application.</span></span><br /><br /> <span data-ttu-id="f3a91-469">— Этот параметр не работает для приложений, для которых строки подключения жестко закодированы.</span><span class="sxs-lookup"><span data-stu-id="f3a91-469">-This option does not work for applications that have their connection strings hardcoded.</span></span><br /><br /> <span data-ttu-id="f3a91-470">— Этот параметр не работает для приложений, использующих зеркальное отображение базы данных, так как зеркальный сервер отвечает простым именем.</span><span class="sxs-lookup"><span data-stu-id="f3a91-470">-This option does not work for applications that use Database Mirroring since the mirrored server replies with a simple name.</span></span>|  
||<span data-ttu-id="f3a91-471">Чтобы обеспечить соответствие полного доменного имени, добавьте для короткого имени псевдоним.</span><span class="sxs-lookup"><span data-stu-id="f3a91-471">Add an alias for the shortname to map to the FQDN.</span></span><br /><br /> <span data-ttu-id="f3a91-472">— Этот параметр работает даже для приложений, для которых строки подключения жестко закодированы.</span><span class="sxs-lookup"><span data-stu-id="f3a91-472">-This option works even for applications that have their connection strings hardcoded.</span></span><br /><br /> <span data-ttu-id="f3a91-473">— Этот параметр не работает для приложений, использующих зеркальное отображение базы данных, так как поставщики не ищут псевдонимы для получения имен партнеров по обеспечению отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="f3a91-473">-This option does not work for applications that use Database Mirroring since the providers don't look up aliases for received failover partner names.</span></span>|  
||<span data-ttu-id="f3a91-474">Получите сертификат для короткого имени.</span><span class="sxs-lookup"><span data-stu-id="f3a91-474">Have a certificate issued for shortname.</span></span><br /><br /> <span data-ttu-id="f3a91-475">— Этот параметр работает для всех приложений.</span><span class="sxs-lookup"><span data-stu-id="f3a91-475">-This option works for all applications.</span></span>|  

## <a name="breaking-changes-in-sql-server-2005"></a><a name="Yukon"></a><span data-ttu-id="f3a91-476">Критические изменения в SQL Server 2005</span><span class="sxs-lookup"><span data-stu-id="f3a91-476">Breaking Changes in SQL Server 2005</span></span>  

[!INCLUDE[Archived documentation for very old versions of SQL Server](../includes/paragraph-content/previous-versions-archive-documentation-sql-server.md)]

## <a name="see-also"></a><span data-ttu-id="f3a91-477">См. также:</span><span class="sxs-lookup"><span data-stu-id="f3a91-477">See Also</span></span>  
 <span data-ttu-id="f3a91-478">[Устаревшие функции ядро СУБД в SQL Server 2014](deprecated-database-engine-features-in-sql-server-2016.md?view=sql-server-2014) </span><span class="sxs-lookup"><span data-stu-id="f3a91-478">[Deprecated Database Engine Features in SQL Server 2014](deprecated-database-engine-features-in-sql-server-2016.md?view=sql-server-2014) </span></span>  
 <span data-ttu-id="f3a91-479">[Изменения в работе функций ядро СУБД в SQL Server 2014](../../2014/database-engine/behavior-changes-to-database-engine-features-in-sql-server-2014.md?view=sql-server-2014) </span><span class="sxs-lookup"><span data-stu-id="f3a91-479">[Behavior Changes to Database Engine Features in SQL Server 2014](../../2014/database-engine/behavior-changes-to-database-engine-features-in-sql-server-2014.md?view=sql-server-2014) </span></span>  
 <span data-ttu-id="f3a91-480">[Неподдерживаемые функции ядро СУБД в SQL Server 2014](discontinued-database-engine-functionality-in-sql-server-2016.md?view=sql-server-2014) </span><span class="sxs-lookup"><span data-stu-id="f3a91-480">[Discontinued Database Engine Functionality in SQL Server 2014](discontinued-database-engine-functionality-in-sql-server-2016.md?view=sql-server-2014) </span></span>  
 <span data-ttu-id="f3a91-481">[Обратная совместимость компонента ядра СУБД SQL Server](sql-server-database-engine-backward-compatibility.md) </span><span class="sxs-lookup"><span data-stu-id="f3a91-481">[SQL Server Database Engine Backward Compatibility](sql-server-database-engine-backward-compatibility.md) </span></span>  
 [<span data-ttu-id="f3a91-482">Уровень совместимости инструкции ALTER DATABASE (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="f3a91-482">ALTER DATABASE Compatibility Level &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level)  
 [<span data-ttu-id="f3a91-483">Критические изменения в функциях средств управления в SQL Server 2014</span><span class="sxs-lookup"><span data-stu-id="f3a91-483">Breaking Changes to Management Tools Features in SQL Server 2014</span></span>](breaking-changes-to-management-tools-features-in-sql-server-2014.md?view=sql-server-2014)  
  
