---
title: Использование кластеризованных индексов columnstore | Документация Майкрософт
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
ms.assetid: 5af6b91c-724f-45ac-aff1-7555014914f4
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: afc7da4e28ef7f32ca4a2b4ea762e5a5af442471
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87655304"
---
# <a name="using-clustered-columnstore-indexes"></a><span data-ttu-id="fbcff-102">Использование кластеризованных индексов columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-102">Using Clustered Columnstore Indexes</span></span>
  <span data-ttu-id="fbcff-103">Задачи при использовании кластеризованных индексов columnstore в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="fbcff-103">Tasks for using clustered columnstore indexes in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>

 <span data-ttu-id="fbcff-104">Общие сведения об индексах columnstore см. в разделе [Columnstore Indexes Described](../relational-databases/indexes/columnstore-indexes-described.md).</span><span class="sxs-lookup"><span data-stu-id="fbcff-104">For an overview of columnstore indexes, see [Columnstore Indexes Described](../relational-databases/indexes/columnstore-indexes-described.md).</span></span>

 <span data-ttu-id="fbcff-105">Дополнительные сведения о кластеризованных индексах columnstore см. в разделе [Using Clustered Columnstore Indexes](../relational-databases/indexes/indexes.md).</span><span class="sxs-lookup"><span data-stu-id="fbcff-105">For information about clustered columnstore indexes, see [Using Clustered Columnstore Indexes](../relational-databases/indexes/indexes.md).</span></span>

## <a name="contents"></a><span data-ttu-id="fbcff-106">Содержимое</span><span class="sxs-lookup"><span data-stu-id="fbcff-106">Contents</span></span>

-   [<span data-ttu-id="fbcff-107">Создание кластеризованного индекса columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-107">Create a Clustered Columnstore Index</span></span>](#create)

-   [<span data-ttu-id="fbcff-108">Удаление кластеризованного индекса columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-108">Drop a Clustered Columnstore Index</span></span>](#drop)

-   [<span data-ttu-id="fbcff-109">Загрузка данных в кластеризованный индекс columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-109">Load Data into a Clustered Columnstore Index</span></span>](#load)

-   [<span data-ttu-id="fbcff-110">Информация об изменениях в кластеризованном индексе columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-110">Change Data in a Clustered Columnstore Index</span></span>](#change)

-   [<span data-ttu-id="fbcff-111">Перестроение кластеризованного индекса columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-111">Rebuild a Clustered Columnstore Index</span></span>](#rebuild)

-   [<span data-ttu-id="fbcff-112">Реорганизация кластеризованного индекса columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-112">Reorganize a Clustered Columnstore Index</span></span>](#reorganize)

##  <a name="create-a-clustered-columnstore-index"></a><a name="create"></a><span data-ttu-id="fbcff-113">Создание кластеризованного индекса columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-113">Create a Clustered Columnstore Index</span></span>
 <span data-ttu-id="fbcff-114">Чтобы создать кластеризованный индекс columnstore, сначала создайте таблицу rowstore в виде кучи или кластеризованного индекса, а затем используйте инструкцию [CREATE Clustered COLUMNSTORE index &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) для преобразования таблицы в кластеризованный индекс columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-114">To create a clustered columnstore index, first create a rowstore table as a heap or clustered index, and then use the [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) statement to convert the table to a clustered columnstore index.</span></span> <span data-ttu-id="fbcff-115">Если кластеризованный индекс columnstore должен иметь то же имя, что и кластеризованный индекс, используйте параметр DROP_EXISTING.</span><span class="sxs-lookup"><span data-stu-id="fbcff-115">If you want the clustered columnstore index to have the same name as the clustered index, use the DROP_EXISTING option.</span></span>

 <span data-ttu-id="fbcff-116">В этом примере создается таблица как куча, затем преобразуется в кластеризованный индекс с именем columnstore cci_Simple.</span><span class="sxs-lookup"><span data-stu-id="fbcff-116">This example creates a table as a heap and then converts it to a clustered columnstore index named cci_Simple.</span></span> <span data-ttu-id="fbcff-117">В результате таблица rowstore становится таблицей columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-117">This changes the storage for the entire table from rowstore to columnstore.</span></span>

```
CREATE TABLE T1(
    ProductKey [int] NOT NULL, 
    OrderDateKey [int] NOT NULL, 
    DueDateKey [int] NOT NULL, 
    ShipDateKey [int] NOT NULL);
GO
CREATE CLUSTERED COLUMNSTORE INDEX cci_T1 ON T1;
GO
```

 <span data-ttu-id="fbcff-118">Дополнительные примеры см. в подразделе "примеры" раздела [CREATE Clustered COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="fbcff-118">For more examples, see the Examples section in [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span></span>

##  <a name="drop-a-clustered-columnstore-index"></a><a name="drop"></a><span data-ttu-id="fbcff-119">Удаление кластеризованного индекса columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-119">Drop a Clustered Columnstore Index</span></span>
 <span data-ttu-id="fbcff-120">Используйте инструкцию [&#41;Transact-SQL DROP INDEX &#40;](/sql/t-sql/statements/drop-index-transact-sql) , чтобы удалить кластеризованный индекс columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-120">Use the [DROP INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-index-transact-sql) statement to drop a clustered columnstore index.</span></span> <span data-ttu-id="fbcff-121">Эта операция удаляет индекс columnstore и преобразует таблицу columnstore в кучу rowstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-121">This operation will drop the index and convert the columnstore table to a rowstore heap.</span></span>

##  <a name="load-data-into-a-clustered-columnstore-index"></a><a name="load"></a><span data-ttu-id="fbcff-122">Загрузка данных в кластеризованный индекс columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-122">Load Data into a Clustered Columnstore Index</span></span>
 <span data-ttu-id="fbcff-123">Можно добавлять данные к существующим кластеризованным индексам columnstore с помощью любого из стандартных методов загрузки.</span><span class="sxs-lookup"><span data-stu-id="fbcff-123">You can add data to an existing clustered columnstore index by using any of the standard loading methods.</span></span>  <span data-ttu-id="fbcff-124">Например, средство bcp с массовым загрузкой, Integration Services и INSERT... SELECT может загружать данные в кластеризованный индекс columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-124">For example, the bcp bulk loading tool, Integration Services, and INSERT ... SELECT can all load data into a clustered columnstore index.</span></span>

 <span data-ttu-id="fbcff-125">Кластеризованные индексы columnstore используют deltastore, чтобы исключить фрагментацию сегментов столбца в columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-125">Clustered columnstore indexes leverage the deltastore in order to prevent fragmentation of column segments in the columnstore.</span></span>

### <a name="loading-into-a-partitioned-table"></a><span data-ttu-id="fbcff-126">Загрузка в секционированную таблицу</span><span class="sxs-lookup"><span data-stu-id="fbcff-126">Loading into a partitioned table</span></span>
 <span data-ttu-id="fbcff-127">Для секционированных данных [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] сначала назначает каждую строку секции, а затем выполняет операции columnstore для данных в секции.</span><span class="sxs-lookup"><span data-stu-id="fbcff-127">For partitioned data, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] first assigns each row to a partition, and then performs columnstore operations on the data within the partition.</span></span> <span data-ttu-id="fbcff-128">Каждая секция имеет собственную rowgroups и как минимум одно deltastore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-128">Each partition has its own rowgroups and at least one deltastore.</span></span>

### <a name="deltastore-loading-scenarios"></a><span data-ttu-id="fbcff-129">Сценарии загрузки Deltastore</span><span class="sxs-lookup"><span data-stu-id="fbcff-129">Deltastore loading scenarios</span></span>
 <span data-ttu-id="fbcff-130">Строки накапливаются в каждом deltastore до тех пор, пока число строк не достигнет максимального количества строк, допустимого для rowgroup.</span><span class="sxs-lookup"><span data-stu-id="fbcff-130">Rows accumulate in the deltastore until the number of rows is the maximum number of rows allowed for a rowgroup.</span></span> <span data-ttu-id="fbcff-131">Если deltastore содержит максимальное число строк на группы строк, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] помечает группы строк как "Closed".</span><span class="sxs-lookup"><span data-stu-id="fbcff-131">When the deltastore contains the maximum number of rows per rowgroup, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the rowgroup as "CLOSED".</span></span> <span data-ttu-id="fbcff-132">Фоновый процесс, называемый «переносом кортежей», находит ЗАКРЫТые группы строк и перемещает в columnstore, где группы строк сжимается в сегменты столбцов, а сегменты столбцов хранятся в columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-132">A background process, called the "tuple-mover", finds the CLOSED rowgroup and moves into the columnstore, where the rowgroup is compressed into column segments and the column segments are stored in the columnstore.</span></span>

 <span data-ttu-id="fbcff-133">Для каждого кластеризованного индекса columnstore может быть несколько deltastore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-133">For each clustered columnstore index there can be multiple deltastores.</span></span>

-   <span data-ttu-id="fbcff-134">Если deltastore блокировано, компонент [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] пытается получить блокировку на другом deltastore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-134">If a deltastore is locked, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] will try to obtain a lock on a different deltastore.</span></span> <span data-ttu-id="fbcff-135">Если доступных deltastore нет, компонент [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] создает новое deltastore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-135">If there are no deltastores available, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] will create a new deltastore.</span></span>

-   <span data-ttu-id="fbcff-136">Для секционированной таблицы может быть одно или несколько deltastore для каждой секции.</span><span class="sxs-lookup"><span data-stu-id="fbcff-136">For a partitioned table, there can be one or more deltastores for each partition.</span></span>

 <span data-ttu-id="fbcff-137">Только для кластеризованных индексов columnstore в следующих сценариях показывается, когда загруженные строки перейдут непосредственно в columnstore, а когда в deltastore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-137">For clustered columnstore indexes only, the following scenarios describe when loaded rows go directly to the columnstore or when they go to the deltastore.</span></span>

 <span data-ttu-id="fbcff-138">В примере каждая rowgroup может иметь 102 400-1 048 576 строк на rowgroup.</span><span class="sxs-lookup"><span data-stu-id="fbcff-138">In the example, each rowgroup can have 102,400-1,048,576 rows per rowgroup.</span></span>

|<span data-ttu-id="fbcff-139">Строки для массовой загрузки</span><span class="sxs-lookup"><span data-stu-id="fbcff-139">Rows to Bulk Load</span></span>|<span data-ttu-id="fbcff-140">Строки, добавленные в Columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-140">Rows Added to the Columnstore</span></span>|<span data-ttu-id="fbcff-141">Строки, добавленные в Deltastore</span><span class="sxs-lookup"><span data-stu-id="fbcff-141">Rows Added to the Deltastore</span></span>|
|-----------------------|-----------------------------------|----------------------------------|
|<span data-ttu-id="fbcff-142">102 000</span><span class="sxs-lookup"><span data-stu-id="fbcff-142">102,000</span></span>|<span data-ttu-id="fbcff-143">0</span><span class="sxs-lookup"><span data-stu-id="fbcff-143">0</span></span>|<span data-ttu-id="fbcff-144">102 000</span><span class="sxs-lookup"><span data-stu-id="fbcff-144">102,000</span></span>|
|<span data-ttu-id="fbcff-145">145,000</span><span class="sxs-lookup"><span data-stu-id="fbcff-145">145,000</span></span>|<span data-ttu-id="fbcff-146">145,000</span><span class="sxs-lookup"><span data-stu-id="fbcff-146">145,000</span></span><br /><br /> <span data-ttu-id="fbcff-147">Размер группы строк: 145,000</span><span class="sxs-lookup"><span data-stu-id="fbcff-147">Rowgroup size: 145,000</span></span>|<span data-ttu-id="fbcff-148">0</span><span class="sxs-lookup"><span data-stu-id="fbcff-148">0</span></span>|
|<span data-ttu-id="fbcff-149">1,048,577</span><span class="sxs-lookup"><span data-stu-id="fbcff-149">1,048,577</span></span>|<span data-ttu-id="fbcff-150">1 048 576</span><span class="sxs-lookup"><span data-stu-id="fbcff-150">1,048,576</span></span><br /><br /> <span data-ttu-id="fbcff-151">Размер группы строк: 1 048 576.</span><span class="sxs-lookup"><span data-stu-id="fbcff-151">Rowgroup size: 1,048,576.</span></span>|<span data-ttu-id="fbcff-152">1</span><span class="sxs-lookup"><span data-stu-id="fbcff-152">1</span></span>|
|<span data-ttu-id="fbcff-153">2,252,152</span><span class="sxs-lookup"><span data-stu-id="fbcff-153">2,252,152</span></span>|<span data-ttu-id="fbcff-154">2,252,152</span><span class="sxs-lookup"><span data-stu-id="fbcff-154">2,252,152</span></span><br /><br /> <span data-ttu-id="fbcff-155">Размеры групп строк: 1 048 576, 1 048 576, 155 000.</span><span class="sxs-lookup"><span data-stu-id="fbcff-155">Rowgroup sizes: 1,048,576, 1,048,576, 155,000.</span></span>|<span data-ttu-id="fbcff-156">0</span><span class="sxs-lookup"><span data-stu-id="fbcff-156">0</span></span>|

 <span data-ttu-id="fbcff-157">В следующем примере показаны результаты загрузки 1 048 577 строк в секцию.</span><span class="sxs-lookup"><span data-stu-id="fbcff-157">The following example shows the results of loading 1,048,577 rows into a partition.</span></span> <span data-ttu-id="fbcff-158">Результаты показывают наличие одной СЖАТОЙ rowgroup в columnstore (в виде сжатых сегментов столбцов) и 1 строки в deltastore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-158">The results show that one COMPRESSED rowgroup in the columnstore (as compressed column segments), and 1 row in the deltastore.</span></span>

```sql
SELECT * FROM sys.column_store_row_groups;
```

 <span data-ttu-id="fbcff-159">![Элементы rowgroup и deltastore для загрузки пакета](../../2014/database-engine/media/sql-server-pdw-columnstore-batchload.gif "Элементы rowgroup и deltastore для загрузки пакета")</span><span class="sxs-lookup"><span data-stu-id="fbcff-159">![Rowgroup and deltastore for a batch load](../../2014/database-engine/media/sql-server-pdw-columnstore-batchload.gif "Rowgroup and deltastore for a batch load")</span></span>



##  <a name="change-data-in-a-clustered-columnstore-index"></a><a name="change"></a><span data-ttu-id="fbcff-160">Изменение данных в кластеризованном индексе columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-160">Change Data in a Clustered Columnstore Index</span></span>
 <span data-ttu-id="fbcff-161">Кластеризованные индексы columnstore поддерживают операции DML вставки, обновления и удаления.</span><span class="sxs-lookup"><span data-stu-id="fbcff-161">Clustered columnstore indexes support insert, update, and delete DML operations.</span></span>

 <span data-ttu-id="fbcff-162">Для вставки строки используйте [инструкцию insert &#40;Transact-SQL&#41;](/sql/t-sql/statements/insert-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="fbcff-162">Use [INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/insert-transact-sql) to insert a row.</span></span> <span data-ttu-id="fbcff-163">Строка будет добавлена в deltastore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-163">The row will be added to the deltastore.</span></span>

 <span data-ttu-id="fbcff-164">Используйте синтаксис [DELETE (Transact-SQL)](/sql/t-sql/statements/delete-transact-sql) для удаления строки.</span><span class="sxs-lookup"><span data-stu-id="fbcff-164">Use [DELETE &#40;Transact-SQL&#41;](/sql/t-sql/statements/delete-transact-sql) to delete a row.</span></span>

-   <span data-ttu-id="fbcff-165">Если строка находится в columnstore, компонент [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] помечает строку как логически удаленную, но не возвращает физическое хранилище для строки до тех пор, пока индекс не будет перестроен.</span><span class="sxs-lookup"><span data-stu-id="fbcff-165">If the row is in the columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the row as logically deleted but does not reclaim the physical storage for the row until the index is rebuilt.</span></span>

-   <span data-ttu-id="fbcff-166">Если строка содержится в deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] логически и физически удаляет ее.</span><span class="sxs-lookup"><span data-stu-id="fbcff-166">If the row is in the deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] logically and physically deletes the row.</span></span>

 <span data-ttu-id="fbcff-167">Используйте синтаксис [UPDATE (Transact-SQL)](/sql/t-sql/queries/update-transact-sql) для обновления строки.</span><span class="sxs-lookup"><span data-stu-id="fbcff-167">Use [UPDATE &#40;Transact-SQL&#41;](/sql/t-sql/queries/update-transact-sql) to update a row.</span></span>

-   <span data-ttu-id="fbcff-168">Если строка содержится в columnstore, компонент [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] помечает строку как логически удаленную, а затем вставляет обновленную строку в deltastore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-168">If the row is in the columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the row as logically deleted, and then inserts the updated row into the deltastore.</span></span>

-   <span data-ttu-id="fbcff-169">Если строка находится в deltastore, компонент [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] обновляет строку в deltastore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-169">If the row is in the deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] updates the row in the deltastore.</span></span>

##  <a name="rebuild-a-clustered-columnstore-index"></a><a name="rebuild"></a><span data-ttu-id="fbcff-170">Перестроение кластеризованного индекса columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-170">Rebuild a Clustered Columnstore Index</span></span>
 <span data-ttu-id="fbcff-171">Чтобы выполнить полное перестроение существующего кластеризованного индекса columnstore, используйте инструкцию [CREATE Clustered COLUMNSTORE index &#40;Transact-sql&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) или [ALTER INDEX &#40;&#41;Transact-SQL](/sql/t-sql/statements/alter-index-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="fbcff-171">Use [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) or [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) to perform a full rebuild of an existing clustered columnstore index.</span></span> <span data-ttu-id="fbcff-172">Кроме того, можно использовать инструкцию ALTER INDEX... REBUILD для перестроения определенной секции.</span><span class="sxs-lookup"><span data-stu-id="fbcff-172">Additionally, you can use ALTER INDEX ... REBUILD to rebuild a specific partition.</span></span>

### <a name="rebuild-process"></a><span data-ttu-id="fbcff-173">Процесс перестроения</span><span class="sxs-lookup"><span data-stu-id="fbcff-173">Rebuild Process</span></span>
 <span data-ttu-id="fbcff-174">Перестроение кластеризованного индекса columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="fbcff-174">To rebuild a clustered columnstore index, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>

-   <span data-ttu-id="fbcff-175">Приобретает монопольную блокировку на таблице или секции на то время, как происходит перестроение.</span><span class="sxs-lookup"><span data-stu-id="fbcff-175">Acquires an exclusive lock on the table or partition while the rebuild occurs.</span></span>  <span data-ttu-id="fbcff-176">Во время перестроения данные находятся в автономном режиме и недоступны.</span><span class="sxs-lookup"><span data-stu-id="fbcff-176">The data is "offline" and unavailable during the rebuild.</span></span>

-   <span data-ttu-id="fbcff-177">Дефрагментирует таблицу columnstore, физически удаляя строки, которые были логически удалены из таблиц; удаленные байты освобождают место на физическом носителе.</span><span class="sxs-lookup"><span data-stu-id="fbcff-177">Defragments the columnstore by physically deleting rows that have been logically deleted from the table; the deleted bytes are reclaimed on the physical media.</span></span>

-   <span data-ttu-id="fbcff-178">Объединяет данные rowstore в deltastore с данными в columnstore перед перестроением индекса.</span><span class="sxs-lookup"><span data-stu-id="fbcff-178">Merges the rowstore data in the deltastore with the data in the columnstore before it rebuilds the index.</span></span> <span data-ttu-id="fbcff-179">После завершения перестроения все данные хранятся в формате columnstore, а deltastore пустует.</span><span class="sxs-lookup"><span data-stu-id="fbcff-179">When the rebuild is finished, all data is stored in columnstore format, and the deltastore is empty.</span></span>

-   <span data-ttu-id="fbcff-180">Повторно сжимает все данные в columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-180">Re-compresses all data into the columnstore.</span></span> <span data-ttu-id="fbcff-181">Во время перестроения существуют две копии индекса columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-181">Two copies of the columnstore index exist while the rebuild is taking place.</span></span> <span data-ttu-id="fbcff-182">После завершения перестроения [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] удаляет исходный индекс columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-182">When the rebuild is finished, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] deletes the original columnstore index.</span></span>

### <a name="recommendations-for-rebuilding-a-clustered-columnstore-index"></a><span data-ttu-id="fbcff-183">Рекомендации по перестраиванию кластеризованного индекса Columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-183">Recommendations for Rebuilding a Clustered Columnstore Index</span></span>
 <span data-ttu-id="fbcff-184">Перестраивание кластеризованного индекса columnstore полезно для устранения фрагментации и перемещения всех строк в columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-184">Rebuilding a clustered columnstore index is useful for removing fragmentation, and for moving all rows into the columnstore.</span></span> <span data-ttu-id="fbcff-185">Предлагаются следующие рекомендации.</span><span class="sxs-lookup"><span data-stu-id="fbcff-185">We have the following recommendations:</span></span>

-   <span data-ttu-id="fbcff-186">Перестраивайте секцию, а не всю таблицу.</span><span class="sxs-lookup"><span data-stu-id="fbcff-186">Rebuild a partition instead of the entire table.</span></span>

    1.  <span data-ttu-id="fbcff-187">Если индекс большой, то перестроение всей таблицы занимает много времени и на диске должно хватать места для сохранения дополнительной копии во время перестроения.</span><span class="sxs-lookup"><span data-stu-id="fbcff-187">Rebuilding the entire table takes a long time if the index is large, and it requires enough disk space to store an additional copy of the index during the rebuild.</span></span> <span data-ttu-id="fbcff-188">Обычно бывает необходимо перестроить только недавно использованную секцию.</span><span class="sxs-lookup"><span data-stu-id="fbcff-188">Usually it is only necessary to rebuild the most recently used partition.</span></span>

    2.  <span data-ttu-id="fbcff-189">Для секционированных таблиц нет необходимости перестраивать весь индекс columnstore, поскольку фрагментация вероятна только в секциях, которые были недавно изменены.</span><span class="sxs-lookup"><span data-stu-id="fbcff-189">For partitioned tables, you do not need to rebuild the entire columnstore index because fragmentation is likely to occur in only the partitions that have been modified recently.</span></span> <span data-ttu-id="fbcff-190">Таблицы фактов и большие таблицы измерений обычно бывают секционированы для выполнения операций резервного копирования и управления с фрагментами данных таблицы.</span><span class="sxs-lookup"><span data-stu-id="fbcff-190">Fact tables and large dimension tables are usually partitioned in order to perform backup and management operations on chunks of the table.</span></span>

-   <span data-ttu-id="fbcff-191">Перестраивайте секцию после масштабных операций DML.</span><span class="sxs-lookup"><span data-stu-id="fbcff-191">Rebuild a partition after heavy DML operations.</span></span>

     <span data-ttu-id="fbcff-192">Перестроение секции дефрагментирует ее и уменьшит занимаемое место на диске.</span><span class="sxs-lookup"><span data-stu-id="fbcff-192">Rebuilding a partition will defragment the partition and reduce disk storage.</span></span> <span data-ttu-id="fbcff-193">Перестроение удалит все строки из columnstore, помеченные для удаления, и переместит все строки из deltastore в columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-193">Rebuilding will delete all rows from the columnstore that are marked for deletion, and it will move all rows from the deltastore into the columnstore.</span></span>

-   <span data-ttu-id="fbcff-194">Перестраивайте секцию после загрузки данных.</span><span class="sxs-lookup"><span data-stu-id="fbcff-194">Rebuild a partition after loading data.</span></span>

     <span data-ttu-id="fbcff-195">Это гарантирует, что все данные будут храниться в columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-195">This ensures all data is stored in the columnstore.</span></span> <span data-ttu-id="fbcff-196">Если одновременно выполняется несколько загрузок, то в каждой секции может образоваться несколько deltastore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-196">If multiple loads occur at the same time, each partition could end up having multiple deltastores.</span></span> <span data-ttu-id="fbcff-197">Перестроение переместит все строки из deltastore в columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-197">Rebuilding will move all deltastore rows into the columnstore.</span></span>

##  <a name="reorganize-a-clustered-columnstore-index"></a><a name="reorganize"></a><span data-ttu-id="fbcff-198">Реорганизация кластеризованного индекса columnstore</span><span class="sxs-lookup"><span data-stu-id="fbcff-198">Reorganize a Clustered Columnstore Index</span></span>
 <span data-ttu-id="fbcff-199">Реорганизация кластеризованный индекса columnstore перемещает все ЗАКРЫТЫЕ rowgroups в columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-199">Reorganizing a clustered columnstore index moves all CLOSED rowgroups into the columnstore.</span></span> <span data-ttu-id="fbcff-200">Чтобы выполнить реорганизацию, используйте [инструкцию ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)с параметром реорганизовать.</span><span class="sxs-lookup"><span data-stu-id="fbcff-200">To perform a reorganize, use [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)with the REORGANIZE option.</span></span>

 <span data-ttu-id="fbcff-201">Реорганизация не требуется для перемещения ЗАКРЫТЫХ rowgroup в columnstore.</span><span class="sxs-lookup"><span data-stu-id="fbcff-201">Reorganizing is not required in order to move CLOSED rowgroups into the columnstore.</span></span> <span data-ttu-id="fbcff-202">Процесс перемещения кортежей в конечном счете находит все группы строк CLOSED и перемещает их.</span><span class="sxs-lookup"><span data-stu-id="fbcff-202">The tuple-mover process will eventually find all CLOSED rowgroups and move them.</span></span> <span data-ttu-id="fbcff-203">Но процесс перемещения кортежей является однопотоковым и может не перемещать группы строк достаточно быстро применительно к конкретной рабочей нагрузке.</span><span class="sxs-lookup"><span data-stu-id="fbcff-203">However, the tuple-mover is single-threaded and might not move rowgroups fast enough for your workload.</span></span>

### <a name="recommendations-for-reorganizing"></a><span data-ttu-id="fbcff-204">Рекомендации по реорганизации</span><span class="sxs-lookup"><span data-stu-id="fbcff-204">Recommendations for Reorganizing</span></span>
 <span data-ttu-id="fbcff-205">Когда реорганизовать кластеризованный индекс columnstore:</span><span class="sxs-lookup"><span data-stu-id="fbcff-205">When to reorganize a clustered columnstore index:</span></span>

-   <span data-ttu-id="fbcff-206">Реорганизуйте кластеризованный индекс columnstore после одной или нескольких загрузок данных для получения выигрыша в производительности запросов как можно быстрее.</span><span class="sxs-lookup"><span data-stu-id="fbcff-206">Reorganize a clustered columnstore index after one or more data loads to achieve query performance benefits as quickly as possible.</span></span> <span data-ttu-id="fbcff-207">Реорганизация изначально потребует дополнительных ресурсов ЦП для сжатия данных, что может снизить общую производительность системы.</span><span class="sxs-lookup"><span data-stu-id="fbcff-207">Reorganizing will initially require additional CPU resources to compress the data, which could slow overall system performance.</span></span> <span data-ttu-id="fbcff-208">Однако после сжатия данных производительность запросов может возрасти.</span><span class="sxs-lookup"><span data-stu-id="fbcff-208">However, as soon as the data is compressed, query performance can improve.</span></span>


