---
title: Прослушиватели групп доступности, подключение клиентов и отработка отказа приложений (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], listeners
- read-only routing
- read-intent connections [AlwaysOn Availability Groups]
- Availability Groups [SQL Server], configuring
- Availability Groups [SQL Server], read-only routing
- Availability Groups [SQL Server], client connectivity
ms.assetid: 76fb3eca-6b08-4610-8d79-64019dd56c44
author: rothja
ms.author: jroth
ms.openlocfilehash: f66046625ca0078904e9555d1cf586873b9f697f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87730874"
---
# <a name="availability-group-listeners-client-connectivity-and-application-failover-sql-server"></a><span data-ttu-id="c4a85-102">Прослушиватели групп доступности, возможность подключения клиентов и отработка отказа приложений (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c4a85-102">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>
  <span data-ttu-id="c4a85-103">В этом разделе содержатся сведения о клиентских компонентах [!INCLUDE[ssHADR](../includes/sshadr-md.md)] и функциях переключения приложений.</span><span class="sxs-lookup"><span data-stu-id="c4a85-103">This topic contains information about considerations for [!INCLUDE[ssHADR](../includes/sshadr-md.md)] client connectivity and application-failover functionality.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c4a85-104">В большинстве стандартных конфигураций прослушивателей первый прослушиватель группы доступности можно создать просто с помощью инструкции [!INCLUDE[tsql](../includes/tsql-md.md)] или командлетов PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c4a85-104">For the majority of the common listener configurations, you can create the first availability group listener simply by using [!INCLUDE[tsql](../includes/tsql-md.md)] statements or PowerShell cmdlets.</span></span> <span data-ttu-id="c4a85-105">Дополнительные сведения см. в подразделе [Связанные задачи](#RelatedTasks)далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="c4a85-105">For more information, see [Related Tasks](#RelatedTasks), later in this topic.</span></span>  
  
 
  
##  <a name="availability-group-listeners"></a><a name="AGlisteners"></a><span data-ttu-id="c4a85-106">Прослушиватели группы доступности</span><span class="sxs-lookup"><span data-stu-id="c4a85-106">Availability Group Listeners</span></span>  
 <span data-ttu-id="c4a85-107">Можно обеспечить клиентское соединение с базой данных определенной группы доступности, создав прослушиватель группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-107">You can provide client connectivity to the database of a given availability group by creating an availability group listener.</span></span> <span data-ttu-id="c4a85-108">Прослушиватель группы доступности ― это виртуальное сетевое имя (VNN), к которому могут подключаться клиенты, чтобы получить доступ к базе данных из первичной или вторичной реплики группы доступности AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="c4a85-108">An availability group listener is a virtual network name (VNN) to which clients can connect in order to access a database in a primary or secondary replica of an AlwaysOn availability group.</span></span> <span data-ttu-id="c4a85-109">Прослушиватель группы доступности позволяет клиенту подключаться к реплике доступности, не зная имени физического экземпляра SQL Server, с которым устанавливается соединение.</span><span class="sxs-lookup"><span data-stu-id="c4a85-109">An availability group listener enables a client to connect to an availability replica without knowing the name of the physical instance of SQL Server to which the client is connecting.</span></span>  <span data-ttu-id="c4a85-110">Изменять строку подключения клиента, чтобы установить соединение с текущим расположением текущей первичной реплики, не требуется.</span><span class="sxs-lookup"><span data-stu-id="c4a85-110">The client connection string does not need to be modified to connect to the current location of the current primary replica.</span></span>  
  
 <span data-ttu-id="c4a85-111">Прослушиватель группы доступности состоит из службы доменных имен прослушивателя (DNS), обозначения порта прослушивателя, а также одного или нескольких IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="c4a85-111">An availability group listener consists of a Domain Name System (DNS) listener name, listener port designation, and one or more IP addresses.</span></span> <span data-ttu-id="c4a85-112">Для работы прослушивателя группы доступности поддерживается только протокол TCP.</span><span class="sxs-lookup"><span data-stu-id="c4a85-112">Only the TCP protocol is supported by availability group listener.</span></span>  <span data-ttu-id="c4a85-113">DNS-имя прослушивателя должно быть уникальным в домене и в NetBIOS.</span><span class="sxs-lookup"><span data-stu-id="c4a85-113">The DNS name of the listener must also be unique in the domain and in NetBIOS.</span></span>  <span data-ttu-id="c4a85-114">При создании нового прослушивателя группы доступности он становится ресурсом кластера с соответствующим виртуальным сетевым именем (VNN), виртуальным IP-адресом (VIP) и зависимостью группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-114">When you create a new availability group listener it becomes a resource in a cluster with an associated virtual network name (VNN), virtual IP (VIP), and availability group dependency.</span></span> <span data-ttu-id="c4a85-115">Клиент с помощью DNS разрешает VNN в несколько IP-адресов, а затем пытается подключаться по каждому адресу, пока запрос подключения не завершится успехом или не истечет время ожидания.</span><span class="sxs-lookup"><span data-stu-id="c4a85-115">A client uses DNS to resolve the VNN into multiple IP addresses and then tries to connect to each address, until a connection request succeeds or until the connection requests time out.</span></span>  
  
 <span data-ttu-id="c4a85-116">Если для одной или нескольких[вторичных реплик для чтения](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md)настроена маршрутизация только для чтения, то клиентские соединения с первичной репликой с намерением чтения направляются во вторичную реплику для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-116">If read-only routing is configured for one or more[readable secondary replicas](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md), read-intent client connections to the primary replica are redirected to a readable secondary replica.</span></span> <span data-ttu-id="c4a85-117">Кроме того, если первичная реплика переходит в режим «вне сети» на одном экземпляре SQL Server, а на другом экземпляре SQL Server новая первичная реплика переходит в режим «в сети», то прослушиватель группы доступности позволяет клиентам подключаться к новой первичной реплике.</span><span class="sxs-lookup"><span data-stu-id="c4a85-117">Also, if the primary replica goes offline on one instance of SQL Server, and a new primary replica comes online on another instance of SQL Server, the availability group listener enables clients to connect to the new primary replica.</span></span>  
  
 <span data-ttu-id="c4a85-118">Основные сведения о прослушивателях групп доступности см. в разделе [Создание или настройка прослушивателя группы доступности (SQL Server)](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c4a85-118">For essential information about availability group listeners, see [Create or Configure an Availability Group Listener &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span></span>  
  
 
  
###  <a name="availability-group-listener-configuration"></a><a name="AGlConfig"></a> <span data-ttu-id="c4a85-119">Конфигурация прослушивателя группы доступности</span><span class="sxs-lookup"><span data-stu-id="c4a85-119">Availability Group Listener Configuration</span></span>  
 <span data-ttu-id="c4a85-120">Прослушиватель группы доступности определяется следующими параметрами.</span><span class="sxs-lookup"><span data-stu-id="c4a85-120">An availability group listener is defined by the following:</span></span>  
  
 <span data-ttu-id="c4a85-121">Уникальное имя DNS</span><span class="sxs-lookup"><span data-stu-id="c4a85-121">A unique DNS name</span></span>  
 <span data-ttu-id="c4a85-122">Оно известно также как имя виртуальной сети (VNN).</span><span class="sxs-lookup"><span data-stu-id="c4a85-122">This is also known as a Virtual Network Name (VNN).</span></span> <span data-ttu-id="c4a85-123">Действуют правила именования Active Directory для DNS-имен узла.</span><span class="sxs-lookup"><span data-stu-id="c4a85-123">Active Directory naming rules for DNS host names apply.</span></span> <span data-ttu-id="c4a85-124">Дополнительные сведения см. в статье базы знаний [Соглашения о наименовании в Active Directory для компьютеров, доменов, сайтов и подразделений](https://support.microsoft.com/kb/909264) .</span><span class="sxs-lookup"><span data-stu-id="c4a85-124">For more information, see the [Naming conventions in Active Directory for computers, domains, sites, and OUs](https://support.microsoft.com/kb/909264) KB article.</span></span>  
  
 <span data-ttu-id="c4a85-125">Один или несколько виртуальных IP-адресов (VIP)</span><span class="sxs-lookup"><span data-stu-id="c4a85-125">One or more Virtual IP addresses (VIPs)</span></span>  
 <span data-ttu-id="c4a85-126">Виртуальные IP-адреса настраиваются для одной или нескольких подсетей, для которых группа доступности может выполнить отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="c4a85-126">VIPs are configured for one or more subnets to which the availability group can failover.</span></span>  
  
 <span data-ttu-id="c4a85-127">Настройка IP-адресов</span><span class="sxs-lookup"><span data-stu-id="c4a85-127">IP address configuration</span></span>  
 <span data-ttu-id="c4a85-128">Для данного прослушивателя группы доступности IP-адрес использует протокол DHCP или один или несколько статических IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="c4a85-128">For a given availability group listener, the IP address uses either Dynamic Host Configuration Protocol (DHCP) or one or more static IP addresses.</span></span>  
  
-   <span data-ttu-id="c4a85-129">Протокол DHCP</span><span class="sxs-lookup"><span data-stu-id="c4a85-129">Dynamic Host Configuration Protocol (DHCP)</span></span>  
  
     <span data-ttu-id="c4a85-130">Если группа доступности расположена в одной подсети, можно настроить использование протокола DHCP для всех IP-адресов прослушивателя группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-130">If an availability group resides on a single subnet, you can configure all the availability group listener IP addresses to use DHCP.</span></span> <span data-ttu-id="c4a85-131">В предварительной рабочей среде протокол DHCP упрощает настройку группы доступности, для которой не требуется выполнять аварийное восстановление на удаленный сервер, находящийся в другой подсети.</span><span class="sxs-lookup"><span data-stu-id="c4a85-131">For pre-production environments, DHCP offers an easy setup for an availability group that does not require disaster recovery to a remote site on a separate subnet.</span></span> <span data-ttu-id="c4a85-132">Но не рекомендуется использовать протокол DHCP совместно с прослушивателем группы доступности для производственной среды.</span><span class="sxs-lookup"><span data-stu-id="c4a85-132">However, you should not use DHCP in conjunction with an availability group listener in a production environment.</span></span> <span data-ttu-id="c4a85-133">Причина в том, что в случае простоя, если время действия IP-адреса протокола DHCP истекло, на регистрацию нового сетевого IP-адреса протокола DHCP, связанного с DNS-именем прослушивателя, уйдет дополнительное время.</span><span class="sxs-lookup"><span data-stu-id="c4a85-133">This is because, in the event of down time, if the DHCP IP lease expires, extra time is required to re-register the new DHCP IP address associated with the listener DNS name.</span></span> <span data-ttu-id="c4a85-134">Из-за дополнительного затраченного времени возникнет ошибка подключения клиента.</span><span class="sxs-lookup"><span data-stu-id="c4a85-134">The extra time will cause client-connection failure.</span></span>  
  
-   <span data-ttu-id="c4a85-135">Статические IP-адреса</span><span class="sxs-lookup"><span data-stu-id="c4a85-135">Static IP addresses</span></span>  
  
     <span data-ttu-id="c4a85-136">В рабочей среде прослушивателям группы доступности рекомендуется использовать статические IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="c4a85-136">In production environments, we recommend that availability group listeners use static IP addresses.</span></span> <span data-ttu-id="c4a85-137">Кроме того, если группа доступности охватывает более одной подсети в домене с несколькими подсетями, прослушиватель группы доступности должен использовать статические IP-адреса.</span><span class="sxs-lookup"><span data-stu-id="c4a85-137">Furthermore, where availability groups extend across subnets in a multi-subnet domain, an availability group listener must use static IP addresses.</span></span>  
  
 <span data-ttu-id="c4a85-138">Гибридные конфигурации сети и использование протокола DHCP в нескольких подсетях не поддерживаются для прослушивателей групп доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-138">Hybrid network configurations and DHCP across subnets are not supported for availability group listeners.</span></span> <span data-ttu-id="c4a85-139">Это связано с тем, что при отработке отказа время действия динамического IP-адреса может закончиться, что снижает общий высокий уровень доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-139">This is because when a failover happens, a dynamic IP might expire or be released, which jeopardizes overall high availability.</span></span>  
  
###  <a name="selecting-an-availability-group-listener-port"></a><a name="SelectListenerPort"></a> <span data-ttu-id="c4a85-140">Выбор порта прослушивателя группы доступности</span><span class="sxs-lookup"><span data-stu-id="c4a85-140">Selecting an Availability Group Listener Port</span></span>  
 <span data-ttu-id="c4a85-141">При настройке прослушивателя группы доступности необходимо назначить порт.</span><span class="sxs-lookup"><span data-stu-id="c4a85-141">When configuring an availability group listener, you must designate a port.</span></span>  <span data-ttu-id="c4a85-142">Для упрощения строки подключения клиента в качестве порта по умолчанию можно задать порт 1433.</span><span class="sxs-lookup"><span data-stu-id="c4a85-142">You can configure the default port to 1433 in order to allow for simplicity of the client connection strings.</span></span> <span data-ttu-id="c4a85-143">При использовании порта 1433 указывать номер порта в строках подключения не требуется.</span><span class="sxs-lookup"><span data-stu-id="c4a85-143">If using 1433, you do not need to designate a port number in a connection string.</span></span>   <span data-ttu-id="c4a85-144">Кроме того, поскольку каждый прослушиватель группы доступности будет иметь собственное имя виртуальной сети, каждый прослушиватель группы доступности, настроенный в одном кластере WSFC, может использовать один и тот же порт по умолчанию ― 1433.</span><span class="sxs-lookup"><span data-stu-id="c4a85-144">Also, since each availability group listener will have a separate virtual network name, each availability group listener configured on a single WSFC can be configured to reference the same default port of 1433.</span></span>  
  
 <span data-ttu-id="c4a85-145">Также можно назначить нестандартный порт прослушивателя, однако это приведет к тому, что при подключении к прослушивателю группы доступности его также придется явно указывать в строках подключения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-145">You can also designate a non-standard listener port; however this means that you will also need to explicitly specify a target port in your connection string whenever connecting to the availability group listener.</span></span>  <span data-ttu-id="c4a85-146">Кроме того, для нестандартного порта также придется создавать разрешение в брандмауэре.</span><span class="sxs-lookup"><span data-stu-id="c4a85-146">You will also need to open permission on the firewall for the non-standard port.</span></span>  
  
 <span data-ttu-id="c4a85-147">Если для имен виртуальной сети прослушивателей используется порт по умолчанию 1433, необходимо будет сделать так, чтобы никакая другая служба в узле кластера не использовала этот порт. В противном случае возникнет конфликт порта.</span><span class="sxs-lookup"><span data-stu-id="c4a85-147">If you use the default port of 1433 for availability group listener VNNs, you will still need to ensure that no other services on the cluster node are using this port; otherwise this would cause a port conflict.</span></span>  
  
 <span data-ttu-id="c4a85-148">Если один из экземпляров SQL Server уже прослушивает TCP-порт 1433 через прослушиватель экземпляра и при этом на данном компьютере больше нет служб (включая дополнительные экземпляры SQL Server), прослушивающие порт 1433, это не приведет к конфликту порта с прослушивателем группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-148">If one of the instances of SQL Server is already listening on TCP port 1433 via the instance listener and there are no other services (including additional instances of SQL Server) on the computer listening on port 1433, this will not cause a port conflict with the availability group listener.</span></span>  <span data-ttu-id="c4a85-149">Обусловлено это тем, что прослушиватель группы доступности может совместно использовать один TCP-порт внутри одного процесса службы.</span><span class="sxs-lookup"><span data-stu-id="c4a85-149">This is because the availability group listener can share the same TCP port inside the same service process.</span></span>  <span data-ttu-id="c4a85-150">Однако не следует настраивать прослушивание одного порта несколькими экземплярами SQL Server (работающими параллельно).</span><span class="sxs-lookup"><span data-stu-id="c4a85-150">However multiple instances of SQL Server (side-by-side)should not be configured to listen on the same port.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-the-primary-replica"></a><a name="ConnectToPrimary"></a><span data-ttu-id="c4a85-151">Использование прослушивателя для подключения к первичной реплике</span><span class="sxs-lookup"><span data-stu-id="c4a85-151">Using a Listener to Connect to the Primary Replica</span></span>  
 <span data-ttu-id="c4a85-152">Чтобы установить соединение с первичной репликой с доступом для чтения и записи с помощью прослушивателя группы доступности, необходимо указать в строке подключения DNS-имя прослушивателя группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-152">To use an availability group listener to connect to the primary replica for read-write access, the connection string specifies the availability group listener DNS name.</span></span>  <span data-ttu-id="c4a85-153">Если роль первичной реплики группы доступности переходит к другой реплике, существующие подключения, в которых используется сетевое имя прослушивателя группы доступности, разрываются.</span><span class="sxs-lookup"><span data-stu-id="c4a85-153">If an availability group primary replica changes to a new replica, existing connections that use an availability group listener's network name are disconnected.</span></span>  <span data-ttu-id="c4a85-154">Новые подключения к прослушивателю группы доступности будут перенаправляться к новой первичной реплике.</span><span class="sxs-lookup"><span data-stu-id="c4a85-154">New connections to the availability group listener are then directed to the new primary replica.</span></span> <span data-ttu-id="c4a85-155">Пример простейшей строки соединения для поставщика данных ADO.NET (System.Data.SqlClient) выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="c4a85-155">An example of a basic connection string for the ADO.NET provider (System.Data.SqlClient) is as follows:</span></span>  
  
```  
Server=tcp: AGListener,1433;Database=MyDB;IntegratedSecurity=SSPI  
```  
  
 <span data-ttu-id="c4a85-156">При всем этом вместо использования имени сервера прослушивателя группы доступности можно применять прямое обращение к имени экземпляра SQL Server первичной или вторичной реплики, однако в этом случае нельзя будет обеспечить автоматическое перенаправление новых подключений на текущую первичную реплику.</span><span class="sxs-lookup"><span data-stu-id="c4a85-156">You can still choose to directly reference the instance of SQL Server name of the primary or secondary replicas instead of using the availability group listener server name, however if you choose to do so you will lose the benefit of new connections being directed automatically to the current primary replica.</span></span>  <span data-ttu-id="c4a85-157">Также нельзя будет маршрутизировать подключения с доступом только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-157">You will also lose the benefit of read-only routing.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-a-read-only-secondary-replica-read-only-routing"></a><a name="ConnectToSecondary"></a> <span data-ttu-id="c4a85-158">Соединение с помощью прослушивателя со вторичной репликой только для чтения (маршрутизация только для чтения)</span><span class="sxs-lookup"><span data-stu-id="c4a85-158">Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)</span></span>  
 <span data-ttu-id="c4a85-159">*Маршрутизация только для чтения* означает способность [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] направлять входящие подключения к прослушивателю группы доступности на вторичную реплику, которая поддерживает доступ только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-159">*Read-only routing* refers to the ability of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to route incoming connections to an availability group listener to a secondary replica that is configured to allow read-only workloads.</span></span> <span data-ttu-id="c4a85-160">Входящее подключение, ссылающееся на имя прослушивателя группы доступности, может быть автоматически перенаправлено на реплику, поддерживающую доступ только для чтения, при соблюдении следующих условий.</span><span class="sxs-lookup"><span data-stu-id="c4a85-160">An incoming connection referencing an availability group listener name can automatically be routed to a read-only replica if the following are true:</span></span>  
  
-   <span data-ttu-id="c4a85-161">Как минимум одна вторичная реплика устанавливается для доступа только для чтения, а первичная и все вторичные реплики только для чтения настраиваются для поддержки маршрутизации только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-161">At least one secondary replica is set to read-only access, and each read-only secondary replica and the primary replica are configured to support read-only routing.</span></span> <span data-ttu-id="c4a85-162">Дополнительные сведения см. ниже в подразделе [Настройка реплик доступности для маршрутизации только для чтения](#ConfigureARsForROR).</span><span class="sxs-lookup"><span data-stu-id="c4a85-162">For more information, see [To Configure Availability Replicas for Read-Only Routing](#ConfigureARsForROR), later in this section.</span></span>  
  
-   <span data-ttu-id="c4a85-163">В строке подключения указывается прослушиватель группы доступности, а в качестве намерения приложения входящего подключения задается доступ только для чтения (например, с помощью ключевого слова **Application Intent=ReadOnly** в строке подключения ODBC или OLEDB либо атрибутами или свойствами соединения).</span><span class="sxs-lookup"><span data-stu-id="c4a85-163">The connection string references an availability group listener, and the application intent of the incoming connection is set to read-only (for example, by using the **Application Intent=ReadOnly** keyword in the ODBC or OLEDB connection strings or connection attributes or properties).</span></span> <span data-ttu-id="c4a85-164">Дополнительные сведения см. ниже в подразделе [Приложение с намерением доступа только для чтения и маршрутизация только для чтения](#ReadOnlyAppIntent).</span><span class="sxs-lookup"><span data-stu-id="c4a85-164">For more information, see [Read-Only Application Intent and Read-Only Routing](#ReadOnlyAppIntent), later in this section.</span></span>  
  
###  <a name="to-configure-availability-replicas-for-read-only-routing"></a><a name="ConfigureARsForROR"></a> <span data-ttu-id="c4a85-165">Настройка реплик доступности для маршрутизации только для чтения</span><span class="sxs-lookup"><span data-stu-id="c4a85-165">To Configure Availability Replicas for Read-Only Routing</span></span>  
 <span data-ttu-id="c4a85-166">Администратор базы данных должен настроить реплики доступности следующим образом.</span><span class="sxs-lookup"><span data-stu-id="c4a85-166">A database administrator must configure the availability replicas as follows:</span></span>  
  
1.  <span data-ttu-id="c4a85-167">Для каждой реплики доступности, которую нужно настроить в качестве вторичной реплики с возможностью чтения, администратор базы данных должен задать следующие параметры, которые действуют только для вторичной роли.</span><span class="sxs-lookup"><span data-stu-id="c4a85-167">For each availability replica that you want to configure as a readable secondary replica, a database administrator must configure the following settings, which take effect only under the secondary role:</span></span>  
  
    -   <span data-ttu-id="c4a85-168">Соединение должно иметь доступ «все» или «только для чтения».</span><span class="sxs-lookup"><span data-stu-id="c4a85-168">Connection access must be set to "all" or "read only".</span></span>  
  
    -   <span data-ttu-id="c4a85-169">Необходимо указать URL-адрес маршрутизации только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-169">The read-only routing URL must be specified.</span></span>  
  
2.  <span data-ttu-id="c4a85-170">Для каждой из этих реплик необходимо для первичной роли указать список маршрутизации только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-170">For each of these replicas, a read-only routing list must be specified for the primary role.</span></span> <span data-ttu-id="c4a85-171">Укажите имена одного или нескольких серверов в качестве целей маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="c4a85-171">Specify one or more server names as routing targets.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksROR"></a> <span data-ttu-id="c4a85-172">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="c4a85-172">Related Tasks</span></span>  
  
-   [<span data-ttu-id="c4a85-173">Настройка доступа только для чтения в реплике доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c4a85-173">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="c4a85-174">Настройка маршрутизации только для чтения в группе доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c4a85-174">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
###  <a name="read-only-application-intent-and-read-only-routing"></a><a name="ReadOnlyAppIntent"></a><span data-ttu-id="c4a85-175">Назначение приложения только для чтения и маршрутизация только для чтения</span><span class="sxs-lookup"><span data-stu-id="c4a85-175">Read-Only Application Intent and Read-Only Routing</span></span>  
 <span data-ttu-id="c4a85-176">Свойство намерения приложения в строке подключения выражает запрос клиентского приложения на перенаправление к версии базы данных группы доступности, предназначенной для чтения и записи или только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-176">The application intent connection string property expresses the client application's request to be directed either to a read-write or read-only version of an availability group database.</span></span> <span data-ttu-id="c4a85-177">Чтобы обеспечить маршрутизацию только для чтения, в качестве намерения приложения клиент должен при соединении с прослушивателем группы доступности указать в строке подключения доступ только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-177">To use read-only routing, a client must use an application intent of read-only in the connection string when connecting to the availability group listener.</span></span> <span data-ttu-id="c4a85-178">Если намерением приложения не является доступ только для чтения, то соединения с прослушивателем группы доступности направляются к базе данных на первичной реплике.</span><span class="sxs-lookup"><span data-stu-id="c4a85-178">Without the read-only application intent, connections to the availability group listener are directed to the database on the primary replica.</span></span>  
  
 <span data-ttu-id="c4a85-179">Атрибут намерения приложения сохраняется в сеансе клиента во время входа в систему, после чего экземпляр SQL Server обрабатывает это назначение и определяет, что делать в соответствии с конфигурацией группы доступности, а также текущим состоянием чтения и записи целевой базы данных на вторичной реплике.</span><span class="sxs-lookup"><span data-stu-id="c4a85-179">The application intent attribute is stored in the client's session during login and the instance of SQL Server will then process this intent and determine what to do according to the configuration of the availability group and the current read-write state of the target database in the secondary replica.</span></span>  
  
 <span data-ttu-id="c4a85-180">Пример строки соединения для поставщика данных ADO.NET (Systen.Data.SqlClient) ADO.NET), обозначающий намерение приложение получить доступ только для чтения:</span><span class="sxs-lookup"><span data-stu-id="c4a85-180">An example of a connection string for the ADO.NET provider (System.Data.SqlClient) that designates read-only application intent is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI;ApplicationIntent=ReadOnly  
```  
  
 <span data-ttu-id="c4a85-181">В этом примере строки подключения клиент пытается подключиться к прослушивателю группы доступности `AGListener` через порт 1433 (номер порта также можно не указывать, если прослушиватель группы доступности отслеживает порт 1433).</span><span class="sxs-lookup"><span data-stu-id="c4a85-181">In this connection string example, the client is attempting to connect to an availability group listener named `AGListener` on port 1433 (you may also omit the port if the availability group listener is listening on 1433).</span></span>  <span data-ttu-id="c4a85-182">Для строки подключения свойство имеет `ApplicationIntent` значение `ReadOnly` , что делает *строку подключения с намерением чтения*.</span><span class="sxs-lookup"><span data-stu-id="c4a85-182">The connection string has the `ApplicationIntent` property set to `ReadOnly`, making this a *read-intent connection string*.</span></span>  <span data-ttu-id="c4a85-183">Без этого параметра сервер не стал бы пытаться выполнить для этого подключения маршрутизацию только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-183">Without this setting, the server would not have attempted a read-only routing of the connection.</span></span>  
  
 <span data-ttu-id="c4a85-184">База данных-источник группы доступности обрабатывает входящий запрос на маршрутизацию только для чтения и пытается найти находящуюся в сети и доступную только для чтения реплику, присоединенную к первичной реплике и настроенную для маршрутизации только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-184">The primary database of the availability group processes the incoming read-only routing request and attempts to locate an online, read-only replica that is joined to the primary replica and is configured for read-only routing.</span></span>  <span data-ttu-id="c4a85-185">Клиент получает от сервера первичной реплики данные для подключения и устанавливает соединение с указанной, доступной только для чтения репликой.</span><span class="sxs-lookup"><span data-stu-id="c4a85-185">The client receives back connection information from the primary replica server and connects to the identified read-only replica.</span></span>  
  
 <span data-ttu-id="c4a85-186">Обратите внимание, что намерение приложения можно отправить из клиентского драйвера на экземпляр SQL Server более низкого уровня.</span><span class="sxs-lookup"><span data-stu-id="c4a85-186">Note that the application intent can be sent from a client driver to a down-level instance of SQL Server.</span></span>  <span data-ttu-id="c4a85-187">В этом случае намерение приложения получить доступ только для чтения не учитывается, а соединение осуществляется в обычном режиме.</span><span class="sxs-lookup"><span data-stu-id="c4a85-187">In this case, application intent of read-only is ignored and the connection proceeds as normal.</span></span>  
  
 <span data-ttu-id="c4a85-188">Маршрутизацию только для чтения можно обойти, не задав в строке подключения свойству намерения приложения значение `ReadOnly` (если оно не указывается, во время входа в систему используется значения по умолчанию `ReadWrite`) или путем подключения непосредственно к экземпляру SQL Server первичной реплики вместо использования имени прослушивателя группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-188">You can bypass read-only routing by not setting the application intent connection property to `ReadOnly` (when not designated, the default is `ReadWrite` during login) or by connecting directly to the primary replica instance of SQL Server instead of using the availability group listener name.</span></span>  <span data-ttu-id="c4a85-189">Маршрутизация только для чтения также не выполняется при подключении непосредственно к реплике, доступной только для чтения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-189">Read-only routing will also not occur if you connect directly to a read-only replica.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksApps"></a> <span data-ttu-id="c4a85-190">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="c4a85-190">Related Tasks</span></span>  
  
-   [<span data-ttu-id="c4a85-191">Поддержка высокого уровня доступности и аварийного восстановления собственного клиента SQL Server</span><span class="sxs-lookup"><span data-stu-id="c4a85-191">SQL Server Native Client Support for High Availability, Disaster Recovery</span></span>](../relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery.md)  
  
-   [<span data-ttu-id="c4a85-192">Использование ключевых слов строки подключения с собственным клиентом SQL Server</span><span class="sxs-lookup"><span data-stu-id="c4a85-192">Using Connection String Keywords with SQL Server Native Client</span></span>](../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md)  
  
##  <a name="bypassing-availability-group-listeners"></a><a name="BypassAGl"></a><span data-ttu-id="c4a85-193">Обход прослушивателей группы доступности</span><span class="sxs-lookup"><span data-stu-id="c4a85-193">Bypassing Availability Group Listeners</span></span>  
 <span data-ttu-id="c4a85-194">Хотя прослушиватели групп доступности обеспечивают поддержку перенаправления отработки отказа и маршрутизации только для чтения, клиентские подключения не обязательно должны использовать их.</span><span class="sxs-lookup"><span data-stu-id="c4a85-194">While availability group listeners enable support for failover redirection and read-only routing, client connections are not required to use them.</span></span> <span data-ttu-id="c4a85-195">Клиентское подключение может обращаться непосредственно к экземпляру SQL Server, а не к прослушивателю группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-195">A client connection can also directly reference the instance of SQL Server instead of connecting to the availability group listener.</span></span>  
  
 <span data-ttu-id="c4a85-196">С точки зрения экземпляра SQL Server нет никакой разницы, использует соединение для входа в систему прослушиватель группы доступности или конечную точку другого экземпляра.</span><span class="sxs-lookup"><span data-stu-id="c4a85-196">To the instance of SQL Server it is irrelevant whether a connection logs in using the availability group listener or using another instance endpoint.</span></span>  <span data-ttu-id="c4a85-197">Экземпляр SQL Server проверяет состояние целевой базы данных и разрешает или запрещает подключение, исходя из конфигурации группы доступности, а также текущего состояния базы данных на экземпляре.</span><span class="sxs-lookup"><span data-stu-id="c4a85-197">The instance of SQL Server will verify the state of the targeted database and either allow or disallow connectivity based on the configuration of the availability group and the current state of the database on the instance.</span></span>  <span data-ttu-id="c4a85-198">Например, если клиентское приложение подключается напрямую к порту экземпляра SQL Server, а затем соединяется с целевой базой данных, размещенной в группе доступности, при этом целевая база данных является базой данных-источником и находится в сети, связь будет успешно установлена.</span><span class="sxs-lookup"><span data-stu-id="c4a85-198">For example, if a client application connects directly to a instance of SQL Server port and connects to a target database hosted in an availability group, and the target database is in primary state and online, then connectivity will succeed.</span></span>  <span data-ttu-id="c4a85-199">Если база данных-получатель не находится в сети или находится в переходном состоянии, связь с ней установить не удастся.</span><span class="sxs-lookup"><span data-stu-id="c4a85-199">If the target database is offline or in a transitional state, connectivity to the database will fail.</span></span>  
  
 <span data-ttu-id="c4a85-200">Кроме того, при переходе с зеркального отображения базы данных на [!INCLUDE[ssHADR](../includes/sshadr-md.md)]приложения могут указывать строку подключения к зеркально отображаемой базе данных при условии, что имеется только одна вторичная реплика, которая запрещает подключения пользователей.</span><span class="sxs-lookup"><span data-stu-id="c4a85-200">Alternatively, while migrating from database mirroring to [!INCLUDE[ssHADR](../includes/sshadr-md.md)], applications can specify the database mirroring connection string as long as only one secondary replica exists and it disallows user connections.</span></span> <span data-ttu-id="c4a85-201">Дополнительные сведения см. далее в подразделе [Использование строк подключения зеркального отображения баз данных с группами доступности](#DbmConnectionString)ниже.</span><span class="sxs-lookup"><span data-stu-id="c4a85-201">For more information, see [Using Database-Mirroring Connection Strings with Availability Groups](#DbmConnectionString), later in this section.</span></span>  
  
###  <a name="using-database-mirroring-connection-strings-with-availability-groups"></a><a name="DbmConnectionString"></a><span data-ttu-id="c4a85-202">Использование строк подключения зеркального отображения базы данных с группами доступности</span><span class="sxs-lookup"><span data-stu-id="c4a85-202">Using Database-Mirroring Connection Strings with Availability Groups</span></span>  
 <span data-ttu-id="c4a85-203">Если в группе доступности имеется только одна вторичная реплика и не разрешен доступ только для чтения к этой вторичной реплике, клиенты смогут подключаться к первичной реплике доступности с помощью строк подключения к зеркально отображаемой базе данных.</span><span class="sxs-lookup"><span data-stu-id="c4a85-203">If an availability group possesses only one secondary replica and is not configured to allow read-access to the secondary replica, clients can connect to the primary replica by using a database mirroring connection string.</span></span> <span data-ttu-id="c4a85-204">Такой подход можно использовать при переносе существующего приложения с зеркально отображаемой базы данных в группу доступности при условии ограничения группы доступности до двух реплик доступности (одной первичной и одной вторичной).</span><span class="sxs-lookup"><span data-stu-id="c4a85-204">This approach can be useful while migrating an existing application from database mirroring to an availability group, as long as you limit the availability group to two availability replicas (a primary replica and one secondary replica).</span></span> <span data-ttu-id="c4a85-205">При добавлении дополнительных вторичных реплик потребуется создать прослушиватель группы доступности и обновить приложения так, чтобы они использовали DNS-имя прослушивателя группы доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-205">If you add additional secondary replicas, you will need to create an availability group listener for the availability group and update your applications to use the availability group listener DNS name.</span></span>  
  
 <span data-ttu-id="c4a85-206">При использовании строк подключения к зеркальному отображения баз данных клиент может использовать собственный клиент [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] или поставщика данных .NET Framework для [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c4a85-206">When using database mirroring connection strings, the client can use either [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client or .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="c4a85-207">В строке подключения, предоставленной клиентом, должно быть как минимум указано имя экземпляра сервера, *имя изначального участника*, для определения экземпляра сервера, на котором первоначально размещалась реплика доступности, к которой необходимо подключиться.</span><span class="sxs-lookup"><span data-stu-id="c4a85-207">The connection string provided by a client must minimally supply the name of one server instance, the *initial partner name*, to identify the server instance that initially hosts the availability replica to which you intend to connect.</span></span> <span data-ttu-id="c4a85-208">При необходимости строка подключения может также содержать имя другого экземпляра сервера, *имя партнера по обеспечению отработки отказа*, обозначающее экземпляр сервера, на котором первоначально размещалась вторичная реплика, в качестве имени участника отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="c4a85-208">Optionally, the connection string can also supply the name of another server instance, the *failover partner name*, to identify the server instance that initially hosts the secondary replica as the failover partner name.</span></span>  
  
 <span data-ttu-id="c4a85-209">Дополнительные сведения о строках подключения зеркального отображения баз данных см. в разделе [Подключение клиентов к сеансу зеркального отображения базы данных (SQL Server)](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c4a85-209">For more information about database mirroring connection strings, see [Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span></span>  
  
##  <a name="behavior-of-client-connections-on-failover"></a><a name="CCBehaviorOnFailover"></a><span data-ttu-id="c4a85-210">Поведение клиентских подключений при отработке отказа</span><span class="sxs-lookup"><span data-stu-id="c4a85-210">Behavior of Client Connections on Failover</span></span>  
 <span data-ttu-id="c4a85-211">В случае отработки отказа группы доступности существующие постоянные подключения к группе доступности разрываются, при этом, чтобы продолжить работать с той же базой данных-источником или доступной только для чтения базой данных-получателем, клиент должен установить новое соединение.</span><span class="sxs-lookup"><span data-stu-id="c4a85-211">When an availability group failover occurs, existing persistent connections to the availability group are terminated and the client must establish a new connection in order to continue working with the same primary database or read-only secondary database.</span></span>  <span data-ttu-id="c4a85-212">Пока на стороне сервера выполняется отработка отказа, связь с группой доступности может прерваться, что заставит клиентское приложение начать попытки установить новое подключение до тех пор, пока база данных-источник не будет переведена в режим «в сети».</span><span class="sxs-lookup"><span data-stu-id="c4a85-212">While a failover is occurring on the server side, connectivity to the availability group may fail, forcing the client application to retry connecting until the primary is brought fully back online.</span></span>  
  
 <span data-ttu-id="c4a85-213">Если группа доступности возвращается в режим "в сети" в то время, когда клиентское приложение пытается установить соединение, и до истечения времени ожидания подключения, то драйвер клиента может успешно выполнить одну из своих внутренних попыток установить соединение. В этом случае приложение не выдаст никакого сообщения об ошибке.</span><span class="sxs-lookup"><span data-stu-id="c4a85-213">If the availability group comes back online during a client application's connection attempt but before the connect timeout period, the client driver may successfully connect during one of its internal retry attempts and no error will be surfaced to the application in this case.</span></span>  
  
##  <a name="supporting-availability-group-multi-subnet-failovers"></a><a name="SupportAgMultiSubnetFailover"></a> <span data-ttu-id="c4a85-214">Поддержка отказоустойчивых кластеров с несколькими подсетями группы доступности</span><span class="sxs-lookup"><span data-stu-id="c4a85-214">Supporting Availability Group Multi-Subnet Failovers</span></span>  
 <span data-ttu-id="c4a85-215">Если используются клиентские библиотеки, поддерживающие в строке подключения параметр подключения MultiSubnetFailover, то можно оптимизировать отработку отказа группы доступности в другую подсеть, задав для свойства MultiSubnetFailover значение True или Yes, в зависимости от синтаксиса используемого поставщика данных.</span><span class="sxs-lookup"><span data-stu-id="c4a85-215">If you are using client libraries that support the MultiSubnetFailover connection option in the connection string, you can optimize availability group failover to a different subnet by setting MultiSubnetFailover to "True" or "Yes", depending on the syntax of the provider you are using.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c4a85-216">Этим параметром рекомендуется пользоваться для соединения с прослушивателем группы доступности как с одной, так и с несколькими подсетями, а также для имени экземпляра отказоустойчивого кластера SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c4a85-216">We recommend this setting for both single and multi-subnet connections to availability groups listeners and to SQL Server Failover Cluster Instance names.</span></span>  <span data-ttu-id="c4a85-217">При использовании этого параметра задействуется дополнительная оптимизация, даже при работе с одной подсетью.</span><span class="sxs-lookup"><span data-stu-id="c4a85-217">Enabling this option adds additional optimizations, even for single-subnet scenarios.</span></span>  
  
 <span data-ttu-id="c4a85-218">Параметр подключения `MultiSubnetFailover` работает только с сетевым протоколом TCP и поддерживается только при подключении к прослушивателю группы доступности, а также для любого имени виртуальной сети, связанного с [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c4a85-218">The `MultiSubnetFailover` connection option only works with the TCP network protocol and is only supported when connecting to an availability group listener and for any virtual network name connecting to [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span></span>  
  
 <span data-ttu-id="c4a85-219">Вот пример подобной строки подключения (позволяющей выполнять отработку отказа в нескольких подсетях) для поставщика данных ADO.NET (System.Data.SqlClient):</span><span class="sxs-lookup"><span data-stu-id="c4a85-219">An example of a for the ADO.NET provider (System.Data.SqlClient) connection string that enables multi-subnet failover is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI; MultiSubnetFailover=True  
```  
  
 <span data-ttu-id="c4a85-220">Параметру подключения `MultiSubnetFailover` следует задать значение `True`, даже если группа доступности размещена только в одной подсети.</span><span class="sxs-lookup"><span data-stu-id="c4a85-220">The `MultiSubnetFailover` connection option should be set to `True` even if the availability group only spans a single subnet.</span></span>  <span data-ttu-id="c4a85-221">Это позволяет настроить новых клиентов для обеспечения поддержки расширения в будущем без необходимости вносить какие-либо изменения в строки подключения клиентов, а также оптимизирует производительность отработки отказа при работе в одной подсети.</span><span class="sxs-lookup"><span data-stu-id="c4a85-221">This allows you to preconfigure new clients to support future spanning of subnets without any need for future client connection string changes and also optimizes failover performance for single subnet failovers.</span></span>  <span data-ttu-id="c4a85-222">Хотя параметр подключения `MultiSubnetFailover` не является обязательным, он обеспечивает повышение скорости отработки отказа в подсети.</span><span class="sxs-lookup"><span data-stu-id="c4a85-222">While the `MultiSubnetFailover` connection option is not required, it does provide the benefit of a faster subnet failover.</span></span>  <span data-ttu-id="c4a85-223">Обусловлено это тем, что драйвер клиента пытается открыть TCP-сокет для каждого IP-адреса, параллельно связанного с группой доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-223">This is because the client driver will attempt to open up a TCP socket for each IP address in parallel associated with the availability group.</span></span>  <span data-ttu-id="c4a85-224">Драйвер клиента ждет ответа от первого IP-адреса с сообщением об успехе, а после его получения использует этот IP-адрес для подключения.</span><span class="sxs-lookup"><span data-stu-id="c4a85-224">The client driver will wait for the first IP to respond with success and once it does, will then use it for the connection.</span></span>  
  
##  <a name="availability-group-listeners-and-ssl-certificates"></a><a name="SSLcertificates"></a> <span data-ttu-id="c4a85-225">Прослушиватели группы доступности и SSL-сертификаты</span><span class="sxs-lookup"><span data-stu-id="c4a85-225">Availability Group Listeners and SSL Certificates</span></span>  
 <span data-ttu-id="c4a85-226">При подключении к прослушивателю группы доступности, если экземпляры-участники SQL Server используют SSL-сертификаты в сочетании с шифрованием сеанса, для обеспечения шифрования драйвер клиента, устанавливающего подключение, должен поддерживать альтернативное имя объекта (Subject Alternate Name) из SSL-сертификата.</span><span class="sxs-lookup"><span data-stu-id="c4a85-226">When connecting to an availability group listener, if the participating instances of SQL Server use SSL certificates in conjunction with session encryption, the connecting client driver will need to support the Subject Alternate Name in the SSL certificate in order to force encryption.</span></span>  <span data-ttu-id="c4a85-227">Поддержка драйвером SQL Server альтернативного имени объекта (Subject Alternative Name) сертификата планируется для ADO.NET (SqlClient), Microsoft JDBC и SQL Native Client (SNAC).</span><span class="sxs-lookup"><span data-stu-id="c4a85-227">SQL Server driver support for certificate Subject Alternative Name is planned for ADO.NET (SqlClient), Microsoft JDBC and SQL Native Client (SNAC).</span></span>  
  
 <span data-ttu-id="c4a85-228">Для каждого узла сервера-участника в отказоустойчивом кластере необходимо настроить сертификат X.509, задав список всех прослушивателей групп доступности, указанных в альтернативном имени объекта (Subject Alternate Name) сертификата.</span><span class="sxs-lookup"><span data-stu-id="c4a85-228">A X.509 certificate must be configured for each participating server node in the failover cluster with a list of all availability group listeners set in the Subject Alternate Name of the certificate.</span></span>  
  
 <span data-ttu-id="c4a85-229">Например, если в кластере WSFC есть три прослушивателя групп доступности с именами `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`и `AG3_listener.Adventure-Works.com`, альтернативное имя объекта (Subject Alternative Name) в сертификате должно быть задано следующим образом.</span><span class="sxs-lookup"><span data-stu-id="c4a85-229">For example, if the WSFC has three availability group listeners with the names `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`, and `AG3_listener.Adventure-Works.com`, the Subject Alternative Name for the certificate should be set as follows:</span></span>  
  
```  
CN = ServerFQDN  
SAN = ServerFQDN,AG1_listener.Adventure-Works.com, AG2_listener.Adventure-Works.com, AG3_listener.Adventure-Works.com  
```  
  
##  <a name="availability-group-listeners-and-server-principal-names-spns"></a><a name="SPNs"></a><span data-ttu-id="c4a85-230">Прослушиватели групп доступности и имена участников-серверов (SPN)</span><span class="sxs-lookup"><span data-stu-id="c4a85-230">Availability Group Listeners and Server Principal Names (SPNs)</span></span>  
 <span data-ttu-id="c4a85-231">Имя участника-службы сервера (SPN) должно быть задано в Active Directory администратором домена для каждого имени прослушивателя группы доступности с тем, чтобы включить Kerberos для клиентских подключений к прослушивателям групп доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-231">A Server Principal Name (SPN) must be configured in Active Directory by a domain administrator for each availability group listener name in order to enable Kerberos for the client connection to the availability group listener.</span></span> <span data-ttu-id="c4a85-232">При регистрации имени субъекта-службы необходимо использовать учетную запись службы экземпляра сервера, на котором размещена реплика доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-232">When registering the SPN, you must use the service account of the server instance that hosts the availability replica .</span></span>  <span data-ttu-id="c4a85-233">Для обеспечения работы SPN во всех репликах необходимо использовать одну учетную запись службы для всех экземпляров из кластера WSFC, на которых размещается группа доступности.</span><span class="sxs-lookup"><span data-stu-id="c4a85-233">For the SPN to work across all replicas, the same service account must be used for all instances in the WSFC cluster that hosts the availability group.</span></span>  
  
 <span data-ttu-id="c4a85-234">Для задания SPN используйте программу командной строки Windows `setspn`.</span><span class="sxs-lookup"><span data-stu-id="c4a85-234">Use the `setspn` Windows command line tool to configure the SPN.</span></span>  <span data-ttu-id="c4a85-235">Пример настройки SPN для группы доступности `AG1listener.Adventure-Works.com` , размещенной на наборе экземпляров SQL Server, работающих под учетной записью домена `corp/svclogin2`.</span><span class="sxs-lookup"><span data-stu-id="c4a85-235">For example to configure an SPN for an availability group named `AG1listener.Adventure-Works.com` hosted on a set of instances of SQL Server all configured to run under the domain account `corp/svclogin2`:</span></span>  
  
```cmd
setspn -A MSSQLSvc/AG1listener.Adventure-Works.com:1433 corp/svclogin2  
```  
  
 <span data-ttu-id="c4a85-236">Дополнительные сведения о ручной регистрации SPN для SQL Server см. в разделе [Регистрация имени участника-службы для соединений Kerberos](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span><span class="sxs-lookup"><span data-stu-id="c4a85-236">For more information about manual registration of a SPN for SQL Server, see [Register a Service Principal Name for Kerberos Connections](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="c4a85-237">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="c4a85-237">Related Tasks</span></span>  
  
-   [<span data-ttu-id="c4a85-238">&#40;SQL Server подключения клиента AlwaysOn&#41;</span><span class="sxs-lookup"><span data-stu-id="c4a85-238">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)
  
-   [<span data-ttu-id="c4a85-239">Создание или настройка прослушивателя группы доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c4a85-239">Create or Configure an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="c4a85-240">Просмотр свойств прослушивателя группы доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c4a85-240">View Availability Group Listener Properties &#40;SQL Server&#41;</span></span>](availability-groups/windows/view-availability-group-listener-properties-sql-server.md)  
  
-   [<span data-ttu-id="c4a85-241">Удаление прослушивателя группы доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c4a85-241">Remove an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/remove-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="c4a85-242">Настройка доступа только для чтения в реплике доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c4a85-242">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="c4a85-243">Настройка маршрутизации только для чтения в группе доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c4a85-243">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="c4a85-244">См. также</span><span class="sxs-lookup"><span data-stu-id="c4a85-244">Related Content</span></span>  
  
-   [<span data-ttu-id="c4a85-245">Руководство по решениям режима AlwaysOn в Microsoft SQL Server для обеспечения высокой доступности и аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="c4a85-245">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   <span data-ttu-id="c4a85-246">[Общие сведения о прослушивателях группы доступности](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (блог группы разработчиков SQL Server AlwaysOn)</span><span class="sxs-lookup"><span data-stu-id="c4a85-246">[Introduction to the Availability Group Listener](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (a SQL Server AlwaysOn team blog)</span></span>  
  
-   [<span data-ttu-id="c4a85-247">Блог группы разработчиков SQL Server AlwaysOn: официальный блог группы разработчиков SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="c4a85-247">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="c4a85-248">См. также:</span><span class="sxs-lookup"><span data-stu-id="c4a85-248">See Also</span></span>  
 <span data-ttu-id="c4a85-249">[Общие сведения о группы доступности AlwaysOn &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="c4a85-249">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="c4a85-250">&#40;SQL Server подключения клиента AlwaysOn&#41;</span><span class="sxs-lookup"><span data-stu-id="c4a85-250">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)  
 <span data-ttu-id="c4a85-251">[Сведения о доступе клиентского подключения к репликам доступности (SQL Server)](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="c4a85-251">[About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span></span>  
 <span data-ttu-id="c4a85-252">[Активные вторичные реплики: &#40;группы доступности AlwaysOn для чтения&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="c4a85-252">[Active Secondaries: Readable Secondary Replicas &#40;AlwaysOn Availability Groups&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span></span>  
 [<span data-ttu-id="c4a85-253">Подключение клиентов к сеансу зеркального отображения базы данных (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="c4a85-253">Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;</span></span>](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md)
