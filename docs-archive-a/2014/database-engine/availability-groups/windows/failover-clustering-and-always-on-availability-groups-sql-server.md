---
title: Отказоустойчивая кластеризация и группы доступности AlwaysOn (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- clustering [SQL Server]
- Availability Groups [SQL Server], WSFC clusters
- Failover Cluster Instances [SQL Server], see failover clustering [SQL Server]
- quorum [SQL Server]
- failover clustering [SQL Server], AlwaysOn Availability Groups
- Availability Groups [SQL Server], Failover Cluster Instances
ms.assetid: 613bfbf1-9958-477b-a6be-c6d4f18785c3
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 64ee815c2b852849d9506ca6c3fc114d3d0e4935
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87658991"
---
# <a name="failover-clustering-and-alwayson-availability-groups-sql-server"></a><span data-ttu-id="b7137-102">Отказоустойчивая кластеризация и группы доступности AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="b7137-102">Failover Clustering and AlwaysOn Availability Groups (SQL Server)</span></span>
  [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="b7137-103">— решение высокого уровня доступности и аварийного восстановления, появившееся в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]. Требует наличия отказоустойчивого кластера Windows Server (WSFC).</span><span class="sxs-lookup"><span data-stu-id="b7137-103">, the high availability and disaster recovery solution introduced in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)], requires Windows Server Failover Clustering (WSFC).</span></span> <span data-ttu-id="b7137-104">Кроме того, хотя [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] не зависит от отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , на экземпляре отказоустойчивого кластера (FCI) можно размещать реплику для группы доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-104">Also, though [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is not dependent upon [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Clustering, you can use a failover clustering instance (FCI) to host an availability replica for an availability group.</span></span> <span data-ttu-id="b7137-105">При проектировании среды [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] важно знать роль каждой из технологий кластеризации, а также иметь представления о необходимых требованиях.</span><span class="sxs-lookup"><span data-stu-id="b7137-105">It is important to know the role of each clustering technology, and to know what considerations are necessary as you design your [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] environment.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b7137-106">Сведения о концепциях [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] см. в разделе [Обзор групп доступности AlwaysOn (SQL Server)](overview-of-always-on-availability-groups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b7137-106">For information about [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] concepts, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md).</span></span>  
  

  
##  <a name="windows-server-failover-clustering-and-availability-groups"></a><a name="WSFC"></a><span data-ttu-id="b7137-107">Отказоустойчивая кластеризация и группы доступности Windows Server</span><span class="sxs-lookup"><span data-stu-id="b7137-107">Windows Server Failover Clustering and Availability Groups</span></span>  
 <span data-ttu-id="b7137-108">Для развертывания [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] требуется WSFC-кластер.</span><span class="sxs-lookup"><span data-stu-id="b7137-108">Deploying [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] requires a Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="b7137-109">Чтобы экземпляр [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]можно было использовать в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , необходимо, чтобы он размещался на узле WSFC, а кластер и узел WSFC находились в режиме «в сети».</span><span class="sxs-lookup"><span data-stu-id="b7137-109">To be enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] must reside on a WSFC node, and the WSFC cluster and node must be online.</span></span> <span data-ttu-id="b7137-110">Также все реплики доступности в заданной группе доступности должны располагаться на разных узлах одного кластера WSFC.</span><span class="sxs-lookup"><span data-stu-id="b7137-110">Furthermore, each availability replica of a given availability group must reside on a different node of the same WSFC cluster.</span></span> <span data-ttu-id="b7137-111">Единственное исключение состоит в том, что при переносе в другой кластер WSFC группа доступности может временно находится в двух кластерах.</span><span class="sxs-lookup"><span data-stu-id="b7137-111">The only exception is that while being migrated to another WSFC cluster, an availability group can temporarily straddle two clusters.</span></span>  
  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="b7137-112">использует кластер отказоустойчивой кластеризации Windows Server для наблюдения за текущими ролями реплик доступности, принадлежащих к данной группе доступности, и управления ими, а также для определения влияния отработки отказа на реплики доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-112">relies on the Windows Failover Clustering (WSFC) cluster to monitor and manage the current roles of the availability replicas that belong to a given availability group and to determine how a failover event affects the availability replicas.</span></span> <span data-ttu-id="b7137-113">Группа ресурсов WSFC создается для каждой создаваемой группы доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-113">A WSFC resource group is created for every availability group that you create.</span></span> <span data-ttu-id="b7137-114">Кластер WSFC отслеживает данную группу ресурсов для оценки работоспособности первичной реплики.</span><span class="sxs-lookup"><span data-stu-id="b7137-114">The WSFC cluster monitors this resource group to evaluate the health of the primary replica.</span></span>  
  
 <span data-ttu-id="b7137-115">Кворум для [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] рассчитывается на всех узлах в кластере WSFC вне зависимости от того, хранится ли на данном узле кластера какая-либо реплика доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-115">The quorum for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is based on all nodes in the WSFC cluster regardless of whether a given cluster node hosts any availability replicas.</span></span> <span data-ttu-id="b7137-116">В отличие от процесса зеркального отображения базы данных, в [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] нет роли следящего объекта.</span><span class="sxs-lookup"><span data-stu-id="b7137-116">In contrast to database mirroring, there is no witness role in [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="b7137-117">Общая исправность кластера WSFC определяется голосами на кворуме узлов в кластере.</span><span class="sxs-lookup"><span data-stu-id="b7137-117">The overall health of a WSFC cluster is determined by the votes of quorum of nodes in the cluster.</span></span> <span data-ttu-id="b7137-118">Если кластер WSFC перешел в режим «вне сети» в результате непредвиденной аварийной ситуации, постоянно возникающего сбоя в оборудовании или ошибки связи, то требуется вмешательство администратора.</span><span class="sxs-lookup"><span data-stu-id="b7137-118">If the WSFC cluster goes offline because of an unplanned disaster, or due to a persistent hardware or communications failure, manual administrative intervention is required.</span></span> <span data-ttu-id="b7137-119">Администратор кластера Windows Server или WSFC должен будет создать принудительный кворум, а затем перевести работоспособные узлы кластера обратно в режим «в сети» в неотказоустойчивой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="b7137-119">A Windows Server or WSFC cluster administrator will need to force a quorum and then bring the surviving cluster nodes back online in a non-fault-tolerant configuration.</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="b7137-120">— это подразделы кластера WSFC.</span><span class="sxs-lookup"><span data-stu-id="b7137-120">registry keys are subkeys of the WSFC cluster.</span></span> <span data-ttu-id="b7137-121">При удалении и повторном создании кластера WSFC необходимо отключить и повторно включить функцию [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] в каждом экземпляре [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , который обеспечил размещение реплики доступности в исходном кластере WSFC.</span><span class="sxs-lookup"><span data-stu-id="b7137-121">If you delete and re-create a WSFC cluster, you must disable and re-enable the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] feature on each instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that hosted an availability replica on the original WSFC cluster.</span></span>  
  
 <span data-ttu-id="b7137-122">Дополнительные сведения о запуске [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в узлах отказоустойчивого кластера Windows Server (WSFC) и кворуме WSFC см. в разделе [Отказоустойчивая кластеризация Windows Server (WSFC) с SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b7137-122">For information about running [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] on Windows Server Failover Clustering (WSFC) nodes and about WSFC quorum, see [Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span></span>  
  
### <a name="cross-cluster-migration-of-alwayson-availability-groups-for-os-upgrade"></a><span data-ttu-id="b7137-123">Миграция между кластерами групп доступности AlwaysOn для обновления ОС</span><span class="sxs-lookup"><span data-stu-id="b7137-123">Cross-Cluster Migration of AlwaysOn Availability Groups for OS Upgrade</span></span>  
 <span data-ttu-id="b7137-124">Начиная с версии [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)], [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] поддерживает миграцию групп доступности между кластерами для развертывания в новый кластер отказоустойчивой кластеризации Windows Server (WSFC).</span><span class="sxs-lookup"><span data-stu-id="b7137-124">Beginning with [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)], [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] supports cross-cluster migration of availability groups for deployments to a new Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="b7137-125">При выполнении миграции между кластерами одна или несколько групп доступности переносятся в новый, целевой кластер WSFC с минимальным временем простоя.</span><span class="sxs-lookup"><span data-stu-id="b7137-125">A cross-cluster migration moves one availability group or a batch of availability groups to the new, destination WSFC cluster with minimal downtime.</span></span> <span data-ttu-id="b7137-126">Процесс миграции между кластерами позволяет выполнять соглашения об уровне обслуживания при переходе на версию кластера [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b7137-126">The cross-cluster migration process enables you to maintain your service level agreements (SLAs) when upgrading to a [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] cluster.</span></span> <span data-ttu-id="b7137-127">В целевом кластере WSFC должен быть установлен компонент [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)] (или более поздней версии), в котором должно быть включено использование AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="b7137-127">[!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)] (or a later version) must be installed and enabled for AlwaysOn on the destination WSFC cluster.</span></span> <span data-ttu-id="b7137-128">Для успешной миграции между кластерами необходимо тщательно спланировать и подготовить целевой кластер WSFC.</span><span class="sxs-lookup"><span data-stu-id="b7137-128">The success of a cross-cluster migration depends on thorough planning and preparation of the destination WSFC cluster.</span></span>  
  
 <span data-ttu-id="b7137-129">Дополнительные сведения см. в документе [Миграция между кластерами групп доступности AlwaysOn для обновления ОС](https://msdn.microsoft.com/library/jj873730.aspx).</span><span class="sxs-lookup"><span data-stu-id="b7137-129">For more information, see [Cross-Cluster Migration of AlwaysOn Availability Groups for OS Upgrade](https://msdn.microsoft.com/library/jj873730.aspx).</span></span>  
  
##  <a name="ssnoversion-failover-cluster-instances-fcis-and-availability-groups"></a><a name="SQLServerFC"></a> <span data-ttu-id="b7137-130">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Экземпляры отказоустойчивого кластера (FCI) и группы доступности</span><span class="sxs-lookup"><span data-stu-id="b7137-130">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Cluster Instances (FCIs) and Availability Groups</span></span>  
 <span data-ttu-id="b7137-131">Можно настроить второй уровень отказоустойчивости на уровне экземпляра сервера путем реализации отказоустойчивой кластеризации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] совместно с кластером WSFC.</span><span class="sxs-lookup"><span data-stu-id="b7137-131">You can set up a second layer of failover at the server-instance level by implementing [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover clustering together with the WSFC cluster.</span></span> <span data-ttu-id="b7137-132">Реплика доступности может размещаться либо с помощью отдельного экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] или экземпляра FCI.</span><span class="sxs-lookup"><span data-stu-id="b7137-132">An availability replica can be hosted by either a standalone instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] or an FCI instance.</span></span> <span data-ttu-id="b7137-133">Только партнер FCI может размещать реплику для данной группы доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-133">Only one FCI partner can host a replica for a given availability group.</span></span> <span data-ttu-id="b7137-134">Во время работы реплики доступности на экземплярах отказоустойчивого кластера (FCI) список возможных владельцев для группы доступности будет содержать только активный узел FCI.</span><span class="sxs-lookup"><span data-stu-id="b7137-134">When an availability replica is running on an FCI, the possible owners list for the availability group will contain only the active FCI node.</span></span>  
  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="b7137-135">не зависит от формы общего хранилища.</span><span class="sxs-lookup"><span data-stu-id="b7137-135">does not depend on any form of shared storage.</span></span> <span data-ttu-id="b7137-136">Однако при использовании экземпляра отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для размещения одной или нескольких реплик доступности для каждого из этих экземпляров потребуется общее хранилище в соответствии со стандартной установкой экземпляра отказоустойчивого кластера SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b7137-136">However, if you use a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI) to host one or more availability replicas, each of those FCIs will require shared storage as per standard SQL Server failover cluster instance installation.</span></span>  
  
 <span data-ttu-id="b7137-137">Дополнительные сведения о других предварительных требованиях см. в подразделе "Предварительные требования и ограничения, связанные с использованием экземпляра отказоустойчивого кластера SQL Server (FCI) для размещения реплики доступности" раздела [Предварительные требования, ограничения и рекомендации для групп доступности AlwaysOn (SQL Server)](prereqs-restrictions-recommendations-always-on-availability.md).</span><span class="sxs-lookup"><span data-stu-id="b7137-137">For more information about additional prerequisites, see the "Prerequisites and Restrictions for Using a SQL Server Failover Cluster Instance (FCI) to Host an Availability Replica" section of [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="comparison-of-failover-cluster-instances-and-availability-groups"></a><span data-ttu-id="b7137-138">Сравнение экземпляров отказоустойчивого кластера и групп доступности</span><span class="sxs-lookup"><span data-stu-id="b7137-138">Comparison of Failover Cluster Instances and Availability Groups</span></span>  
 <span data-ttu-id="b7137-139">Независимо от количества узлов в FCI, во всем FCI размещается одна реплика в группе доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-139">Regardless of the number of nodes in the FCI, an entire FCI hosts a single replica within an availability group.</span></span> <span data-ttu-id="b7137-140">В следующей таблице описаны различия концепций узлов в FCI и репликах в группе доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-140">The following table describes the distinctions in concepts between nodes in an FCI and replicas within an availability group.</span></span>  
  
||<span data-ttu-id="b7137-141">Узлы в FCI</span><span class="sxs-lookup"><span data-stu-id="b7137-141">Nodes within an FCI</span></span>|<span data-ttu-id="b7137-142">Реплики в группе доступности</span><span class="sxs-lookup"><span data-stu-id="b7137-142">Replicas within an availability group</span></span>|  
|-|-------------------------|-------------------------------------------|  
|<span data-ttu-id="b7137-143">**Используется кластер WSFC**</span><span class="sxs-lookup"><span data-stu-id="b7137-143">**Uses WSFC cluster**</span></span>|<span data-ttu-id="b7137-144">Да</span><span class="sxs-lookup"><span data-stu-id="b7137-144">Yes</span></span>|<span data-ttu-id="b7137-145">Да</span><span class="sxs-lookup"><span data-stu-id="b7137-145">Yes</span></span>|  
|<span data-ttu-id="b7137-146">**Уровень защиты**</span><span class="sxs-lookup"><span data-stu-id="b7137-146">**Protection level**</span></span>|<span data-ttu-id="b7137-147">Экземпляр</span><span class="sxs-lookup"><span data-stu-id="b7137-147">Instance</span></span>|<span data-ttu-id="b7137-148">База данных</span><span class="sxs-lookup"><span data-stu-id="b7137-148">Database</span></span>|  
|<span data-ttu-id="b7137-149">**Тип хранилища**</span><span class="sxs-lookup"><span data-stu-id="b7137-149">**Storage type**</span></span>|<span data-ttu-id="b7137-150">Совмещаемая блокировка</span><span class="sxs-lookup"><span data-stu-id="b7137-150">Shared</span></span>|<span data-ttu-id="b7137-151">Не общее</span><span class="sxs-lookup"><span data-stu-id="b7137-151">Non-shared</span></span><br /><br /> <span data-ttu-id="b7137-152">Обратите внимание, что хотя реплики в группе доступности не используют общее хранилище, реплика, размещенная FCI, использует решение общего хранилища в соответствии с требованиями этого FCI.</span><span class="sxs-lookup"><span data-stu-id="b7137-152">Note that while the replicas in an availability group do not share storage, a replica that is hosted by an FCI uses a shared storage solution as required by that FCI.</span></span> <span data-ttu-id="b7137-153">Решение хранения данных совместно используется только узлами в FCI, но не между репликами группы доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-153">The storage solution is shared only by nodes within the FCI and not between replicas of the availability group.</span></span>|  
|<span data-ttu-id="b7137-154">**Решения хранения данных**</span><span class="sxs-lookup"><span data-stu-id="b7137-154">**Storage solutions**</span></span>|<span data-ttu-id="b7137-155">Прямое подключение, SAN, точки подключения, SMB</span><span class="sxs-lookup"><span data-stu-id="b7137-155">Direct attached, SAN, mount points, SMB</span></span>|<span data-ttu-id="b7137-156">Зависит от типа узла</span><span class="sxs-lookup"><span data-stu-id="b7137-156">Depends on node type</span></span>|  
|<span data-ttu-id="b7137-157">**Доступные для чтения вторичные**</span><span class="sxs-lookup"><span data-stu-id="b7137-157">**Readable secondaries**</span></span>|<span data-ttu-id="b7137-158">Нет\*</span><span class="sxs-lookup"><span data-stu-id="b7137-158">No\*</span></span>|<span data-ttu-id="b7137-159">Да</span><span class="sxs-lookup"><span data-stu-id="b7137-159">Yes</span></span>|  
|<span data-ttu-id="b7137-160">**Применимые параметры политики отработки отказа**</span><span class="sxs-lookup"><span data-stu-id="b7137-160">**Applicable failover policy settings**</span></span>|<span data-ttu-id="b7137-161">Кворум WSFC</span><span class="sxs-lookup"><span data-stu-id="b7137-161">WSFC quorum</span></span><br /><br /> <span data-ttu-id="b7137-162">Связанный с FCI</span><span class="sxs-lookup"><span data-stu-id="b7137-162">FCI-specific</span></span><br /><br /> <span data-ttu-id="b7137-163">Параметры группы доступности\*\*</span><span class="sxs-lookup"><span data-stu-id="b7137-163">Availability group settings\*\*</span></span>|<span data-ttu-id="b7137-164">Кворум WSFC</span><span class="sxs-lookup"><span data-stu-id="b7137-164">WSFC quorum</span></span><br /><br /> <span data-ttu-id="b7137-165">Параметры группы доступности</span><span class="sxs-lookup"><span data-stu-id="b7137-165">Availability group settings</span></span>|  
|<span data-ttu-id="b7137-166">**Ресурсы для перехода в случае сбоя**</span><span class="sxs-lookup"><span data-stu-id="b7137-166">**Failed-over resources**</span></span>|<span data-ttu-id="b7137-167">Сервер, экземпляр и база данных</span><span class="sxs-lookup"><span data-stu-id="b7137-167">Server, instance, and database</span></span>|<span data-ttu-id="b7137-168">Только база данных</span><span class="sxs-lookup"><span data-stu-id="b7137-168">Database only</span></span>|  
  
 <span data-ttu-id="b7137-169">\*Хотя синхронные вторичные реплики в группе доступности всегда запускаются в соответствующих экземплярах [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , соответствующие экземпляры [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на вторичных узлах в FCI не запущены и, следовательно, недоступны для чтения.</span><span class="sxs-lookup"><span data-stu-id="b7137-169">\*Whereas synchronous secondary replicas in an availability group are always running on their respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances, secondary nodes in an FCI actually have not started their respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances and are therefore not readable.</span></span> <span data-ttu-id="b7137-170">В FCI вторичный узел запускает экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] только при передаче группы ресурсов во владение при отработке отказа FCI.</span><span class="sxs-lookup"><span data-stu-id="b7137-170">In an FCI, a secondary node starts its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance only when the resource group ownership is transferred to it during an FCI failover.</span></span> <span data-ttu-id="b7137-171">Однако на активном узле FCI в случаях, когда база данных, размещенная FCI, принадлежит группе доступности, если локальная реплика доступности запускается как вторичная реплика, доступная для чтения, база данных также доступна для чтения.</span><span class="sxs-lookup"><span data-stu-id="b7137-171">However, on the active FCI node, when an FCI-hosted database belongs to an availability group, if the local availability replica is running as a readable secondary replica, the database is readable.</span></span>  
  
 <span data-ttu-id="b7137-172">\*\*Параметры политики перехода на другой ресурс для группы доступности применимы ко всем репликам, независимо от того, размещаются ли они в автономном экземпляре или экземпляре FCI.</span><span class="sxs-lookup"><span data-stu-id="b7137-172">\*\*Failover policy settings for the availability group apply to all replicas, whether it is hosted in a standalone instance or an FCI instance.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b7137-173">Дополнительные сведения о **количестве узлов** в отказоустойчивой кластеризации и **группы доступности AlwaysOn** для различных выпусков [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] см. [в разделе функции, поддерживаемые различными выпусками SQL Server 2012](https://go.microsoft.com/fwlink/?linkid=232473) ( https://go.microsoft.com/fwlink/?linkid=232473) .</span><span class="sxs-lookup"><span data-stu-id="b7137-173">For more information about **Number of nodes** within Failover Clustering and **AlwaysOn Availability Groups** for different editions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2012](https://go.microsoft.com/fwlink/?linkid=232473) (https://go.microsoft.com/fwlink/?linkid=232473).</span></span>  
  
### <a name="considerations-for-hosting-an-availability-replica-on-an-fci"></a><span data-ttu-id="b7137-174">Рекомендации для размещения реплики доступности на FCI</span><span class="sxs-lookup"><span data-stu-id="b7137-174">Considerations for hosting an Availability Replica on an FCI</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="b7137-175">При необходимости в размещении реплики доступности в экземпляре отказоустойчивого кластера SQL Server убедитесь, что узлы Windows Server 2008 соответствуют предварительным требованиям AlwaysOn и ограничениям для экземпляров отказоустойчивого кластера.</span><span class="sxs-lookup"><span data-stu-id="b7137-175">If you plan to host an availability replica on a SQL Server Failover Cluster Instance (FCI), ensure that the Windows Server 2008 host nodes meet the AlwaysOn prerequisites and restrictions for Failover Cluster Instances (FCIs).</span></span> <span data-ttu-id="b7137-176">Дополнительные сведения см. в разделе [Предварительные требования, ограничения и рекомендации для групп доступности AlwaysOn (SQL Server)](prereqs-restrictions-recommendations-always-on-availability.md).</span><span class="sxs-lookup"><span data-stu-id="b7137-176">For more information, see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="b7137-177">Экземпляры отказоустойчивого кластера (FCI) не поддерживают автоматический переход на другой ресурс с учетом групп доступности, поэтому любая реплика доступности, размещенная в них, должна быть настроена для перехода на другой ресурс вручную.</span><span class="sxs-lookup"><span data-stu-id="b7137-177">Failover Cluster Instances (FCIs) do not support automatic failover by availability groups, so any availability replica that is hosted by an FCI can only be configured for manual failover.</span></span>  
  
 <span data-ttu-id="b7137-178">Может потребоваться настройка отказоустойчивой кластеризации Windows Server (WSFC) для включения общих дисков, которые недоступны на всех узлах.</span><span class="sxs-lookup"><span data-stu-id="b7137-178">You might need to configure a Windows Server Failover Clustering (WSFC) cluster to include shared disks that are not available on all nodes.</span></span> <span data-ttu-id="b7137-179">Например, рассмотрим кластер WSFC между двумя центрами обработки данных с тремя узлами.</span><span class="sxs-lookup"><span data-stu-id="b7137-179">For example, consider a WSFC cluster across two data centers with three nodes.</span></span> <span data-ttu-id="b7137-180">На двух узлах размещается экземпляр отказоустойчивой кластеризации SQL Server в основном центре обработки данных и предоставлен доступ к тем же общим дискам.</span><span class="sxs-lookup"><span data-stu-id="b7137-180">Two of the nodes host a SQL Server failover clustering instance (FCI) in the primary data center and have access to the same shared disks.</span></span> <span data-ttu-id="b7137-181">На третьем узле размещается автономный экземпляр SQL Server в другом центре обработки данных и отсутствует доступ к общим дискам от основного центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="b7137-181">The third node hosts a stand-alone instance of SQL Server in a different data center and does not have access to the shared disks from the primary data center.</span></span> <span data-ttu-id="b7137-182">Эта конфигурация кластеров WSFC поддерживает развертывание группы доступности, если на экземпляре отказоустойчивого кластера размещена первичная реплика и на автономном экземпляре находится вторичная реплика.</span><span class="sxs-lookup"><span data-stu-id="b7137-182">This WSFC cluster configuration supports the deployment of an availability group if the FCI hosts the primary replica and the stand-alone instance hosts the secondary replica.</span></span>  
  
 <span data-ttu-id="b7137-183">При выборе FCI для размещения реплики доступности для данной группы доступности убедитесь, что отработка отказа FCI не может привести к попытке отдельного узла WSFC размещения двух реплик доступности для одной группы доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-183">When choosing an FCI to host an availability replica for a given availability group, ensure that an FCI failover could not potentially cause a single WSFC node to attempt to host two availability replicas for the same availability group.</span></span>  
  
 <span data-ttu-id="b7137-184">В следующем примере сценария показано, как подобная конфигурация может вызывать проблемы.</span><span class="sxs-lookup"><span data-stu-id="b7137-184">The following example scenario illustrates how this configuration could lead to problems:</span></span>  
  
 <span data-ttu-id="b7137-185">Марцелл настраивает два отказоустойчивых кластера WSFC, состоящие из двух узлов каждый: `NODE01` и `NODE02`.</span><span class="sxs-lookup"><span data-stu-id="b7137-185">Marcel configures two a WSFC cluster with two nodes, `NODE01` and `NODE02`.</span></span> <span data-ttu-id="b7137-186">Он устанавливает экземпляр отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , `fciInstance1`на `NODE01` и `NODE02` , где `NODE01` является текущим владельцем для `fciInstance1`.</span><span class="sxs-lookup"><span data-stu-id="b7137-186">He installs a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance, `fciInstance1`, on both `NODE01` and `NODE02` where `NODE01` is the current owner for `fciInstance1`.</span></span>  
 <span data-ttu-id="b7137-187">На `NODE02`Марцелл устанавливает еще один экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], `Instance3`, который является автономным.</span><span class="sxs-lookup"><span data-stu-id="b7137-187">On `NODE02`, Marcel installs another instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], `Instance3`, which is a stand-alone instance.</span></span>  
 <span data-ttu-id="b7137-188">На узле `NODE01`Марцелл включает fciInstance1 для [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b7137-188">On `NODE01`, Marcel enables fciInstance1 for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="b7137-189">В `NODE02`он включает `Instance3` для [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b7137-189">On `NODE02`, he enables `Instance3` for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="b7137-190">Затем он настраивает группу доступности, для которой `fciInstance1` размещает первичную реплику, а `Instance3` размещает вторичную реплику.</span><span class="sxs-lookup"><span data-stu-id="b7137-190">Then he sets up an availability group for which `fciInstance1` hosts the primary replica, and `Instance3` hosts the secondary replica.</span></span>  
 <span data-ttu-id="b7137-191">В какой-то момент экземпляр `fciInstance1` становится недоступным на `NODE01`, и кластер WSFC вызывает отработку отказа `fciInstance1` на `NODE02`.</span><span class="sxs-lookup"><span data-stu-id="b7137-191">At some point `fciInstance1` becomes unavailable on `NODE01`, and the WSFC cluster causes a failover of `fciInstance1` to `NODE02`.</span></span> <span data-ttu-id="b7137-192">После отработки отказа экземпляр `fciInstance1` является экземпляром с [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], запущенным в основной роли на узле `NODE02`.</span><span class="sxs-lookup"><span data-stu-id="b7137-192">After the failover, `fciInstance1` is a [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]-enabled instance running under the primary role on `NODE02`.</span></span> <span data-ttu-id="b7137-193">Однако экземпляр `Instance3` теперь находится на том же узле кластера WSFC, что и `fciInstance1`.</span><span class="sxs-lookup"><span data-stu-id="b7137-193">However, `Instance3` now resides on the same WSFC node as `fciInstance1`.</span></span> <span data-ttu-id="b7137-194">Это нарушает ограничение [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b7137-194">This violates the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] constraint.</span></span>  
 <span data-ttu-id="b7137-195">Чтобы проблема, описанная в этом сценарии, не возникала, изолированный экземпляр `Instance3`должен находиться на отдельном узле в том же кластере WSFC, что и узлы `NODE01` и `NODE02`.</span><span class="sxs-lookup"><span data-stu-id="b7137-195">To correct the problem that this scenario presents, the stand-alone instance, `Instance3`, must reside on another node in the same WSFC cluster as `NODE01` and `NODE02`.</span></span>  
  
 <span data-ttu-id="b7137-196">Дополнительные сведения об отказоустойчивой кластеризации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] см. в статье [Экземпляры отказоустойчивого кластера (режим AlwaysOn) (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b7137-196">For more information about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover clustering, see [AlwaysOn Failover Cluster Instances &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
##  <a name="restrictions-on-using-the-wsfc-failover-cluster-manager-with-availability-groups"></a><a name="FCMrestrictions"></a><span data-ttu-id="b7137-197">Ограничения на использование диспетчер отказоустойчивости кластеров WSFC с группами доступности</span><span class="sxs-lookup"><span data-stu-id="b7137-197">Restrictions on Using The WSFC Failover Cluster Manager with Availability Groups</span></span>  
 <span data-ttu-id="b7137-198">Не используйте диспетчер отказоустойчивости кластеров для управления группами доступности, например:</span><span class="sxs-lookup"><span data-stu-id="b7137-198">Do not use the Failover Cluster Manager to manipulate availability groups, for example:</span></span>  
  
-   <span data-ttu-id="b7137-199">Нельзя добавлять или удалять ресурсы в службе, поддерживающей работу в кластере (группе ресурсов) для группы доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-199">Do not add or remove resources in the clustered service (resource group) for the availability group.</span></span>  
  
-   <span data-ttu-id="b7137-200">Не изменяйте свойства групп доступности, такие как возможные владельцы и предпочтительные владельцы.</span><span class="sxs-lookup"><span data-stu-id="b7137-200">Do not change any availability group properties, such as the possible owners and preferred owners.</span></span> <span data-ttu-id="b7137-201">Эти свойства устанавливаются автоматически группой доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-201">These properties are set automatically by the availability group.</span></span>  
  
-   <span data-ttu-id="b7137-202">Не используйте диспетчер отказоустойчивого кластера для перемещения групп доступности на другие узлы или резервные группы доступности.</span><span class="sxs-lookup"><span data-stu-id="b7137-202">Do not use the Failover Cluster Manager to move availability groups to different nodes or to fail over availability groups.</span></span> <span data-ttu-id="b7137-203">Диспетчер отказоустойчивого кластера не имеет сведений о состоянии синхронизации реплик доступности, и это может привести к длительному простою.</span><span class="sxs-lookup"><span data-stu-id="b7137-203">The Failover Cluster Manager is not aware of the synchronization status of the availability replicas, and doing so can lead to extended downtime.</span></span> <span data-ttu-id="b7137-204">Необходимо использовать [!INCLUDE[tsql](../../../includes/tsql-md.md)] или среду [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b7137-204">You must use [!INCLUDE[tsql](../../../includes/tsql-md.md)] or [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span>  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="b7137-205">См. также</span><span class="sxs-lookup"><span data-stu-id="b7137-205">Related Content</span></span>  
  
-   <span data-ttu-id="b7137-206">**Блоги**</span><span class="sxs-lookup"><span data-stu-id="b7137-206">**Blogs:**</span></span>  
  
     [<span data-ttu-id="b7137-207">Настроить отказоустойчивую кластеризацию Windows для SQL Server (группы доступности или экземпляр отказоустойчивого кластера) с ограниченной безопасностью</span><span class="sxs-lookup"><span data-stu-id="b7137-207">Configure Windows Failover Clustering for SQL Server (Availability Group or FCI) with Limited Security</span></span>](https://blogs.msdn.com/b/sqlalwayson/archive/2012/06/05/configure-windows-failover-clustering-for-sql-server-availability-group-or-fci-with-limited-security.aspx)  
  
     [<span data-ttu-id="b7137-208">Блоги команды разработчиков SQL Server AlwaysOn: официальный блог по SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="b7137-208">SQL Server AlwaysOn Team Blogs: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
     [<span data-ttu-id="b7137-209">Блоги инженеров CSS SQL Server</span><span class="sxs-lookup"><span data-stu-id="b7137-209">CSS SQL Server Engineers Blogs</span></span>](https://blogs.msdn.com/b/psssql/)  
  
-   <span data-ttu-id="b7137-210">**Технические документы**</span><span class="sxs-lookup"><span data-stu-id="b7137-210">**Whitepapers:**</span></span>  
  
     [<span data-ttu-id="b7137-211">Руководство по архитектуре AlwaysOn. Построение решения для обеспечения высокого уровня доступности и аварийного восстановления с помощью экземпляров отказоустойчивого кластера и групп доступности</span><span class="sxs-lookup"><span data-stu-id="b7137-211">AlwaysOn Architecture Guide: Building a High Availability and Disaster Recovery Solution by Using Failover Cluster Instances and Availability Groups</span></span>](https://msdn.microsoft.com/library/jj215886.aspx)  
  
     [<span data-ttu-id="b7137-212">Руководство по решениям режима AlwaysOn в Microsoft SQL Server для обеспечения высокой доступности и аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="b7137-212">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
     [<span data-ttu-id="b7137-213">Технические документы Майкрософт Microsoft по SQL Server 2012</span><span class="sxs-lookup"><span data-stu-id="b7137-213">Microsoft White Papers for SQL Server 2012</span></span>](https://msdn.microsoft.com/library/hh403491.aspx)  
  
     [<span data-ttu-id="b7137-214">Технические документы группы консультантов по SQL Server</span><span class="sxs-lookup"><span data-stu-id="b7137-214">SQL Server Customer Advisory Team Whitepapers</span></span>](http://sqlcat.com/)  
  
## <a name="see-also"></a><span data-ttu-id="b7137-215">См. также:</span><span class="sxs-lookup"><span data-stu-id="b7137-215">See Also</span></span>  
 <span data-ttu-id="b7137-216">[Общие сведения о группы доступности AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) [включение и отключение группы доступности AlwaysOn &#40;SQL Server](enable-and-disable-always-on-availability-groups-sql-server.md)&#41;[мониторинг групп доступности &#40;Transact-SQL&#41;](monitor-availability-groups-transact-sql.md)</span><span class="sxs-lookup"><span data-stu-id="b7137-216">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) [Enable and Disable AlwaysOn Availability Groups &#40;SQL Server&#41;](enable-and-disable-always-on-availability-groups-sql-server.md) [Monitor Availability Groups &#40;Transact-SQL&#41;](monitor-availability-groups-transact-sql.md)</span></span>  
 [<span data-ttu-id="b7137-217">Экземпляры отказоустойчивого кластера AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b7137-217">AlwaysOn Failover Cluster Instances &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) 
  
  
