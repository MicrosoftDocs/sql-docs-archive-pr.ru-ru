---
title: Обновление и обновление серверов групп доступности с минимальным временем простоя и потерей данных | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
ms.assetid: f670af56-dbcc-4309-9119-f919dcad8a65
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6bac882b93016a430fbcace2d590e6cc087123d2
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750171"
---
# <a name="upgrade-and-update-of-availability-group-servers-with-minimal-downtime-and-data-loss"></a><span data-ttu-id="f4849-102">Модернизация или обновление серверов группы доступности при минимальных значениях времени простоя и потери данных</span><span class="sxs-lookup"><span data-stu-id="f4849-102">Upgrade and Update of Availability Group Servers with Minimal Downtime and Data Loss</span></span>
  <span data-ttu-id="f4849-103">При обновлении или модернизации экземпляров сервера с переходом от SQL Server 2012 на пакет обновления или более новую версию можно сократить время простоя для группы доступности лишь до единственного перехода на другой ресурс вручную путем последовательного обновления или модернизации.</span><span class="sxs-lookup"><span data-stu-id="f4849-103">When updating or upgrading server instances from SQL Server 2012 to a service pack or a newer version, you can reduce downtime for an availability group to only a single manual failover by performing a sequential update or upgrade.</span></span> <span data-ttu-id="f4849-104">Обновления версий SQL Server принято называть последовательной модернизацией, а обновления текущих версий SQL Server с применением исправлений или пакетов обновления именуются последовательным обновлением.</span><span class="sxs-lookup"><span data-stu-id="f4849-104">For upgrading SQL Server versions, it is known as rolling upgrade; for updating the current SQL Server version with hotfixes or service packs, it is known as rolling update.</span></span>  
  
 <span data-ttu-id="f4849-105">В этом разделе мы ограничимся обсуждением только модернизаций или обновлений SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f4849-105">This topic limits the discussion to SQL Server upgrades/updates only.</span></span> <span data-ttu-id="f4849-106">Сведения об обновлениях, связанных с операционной системой, а также об обновлении, в котором выполняются экземпляры SQL Server, см. в разделе [Миграция между кластерами группы доступности AlwaysOn для обновления операционной системы](https://msdn.microsoft.com/library/jj873730.aspx) .</span><span class="sxs-lookup"><span data-stu-id="f4849-106">For operating system-related upgrades/updates that the highly-available SQL Server instances are running on, see [Cross-cluster Migration of AlwaysOn Availability Groups for Operating System Upgrades](https://msdn.microsoft.com/library/jj873730.aspx)</span></span>  
  
## <a name="rolling-upgradeupdate-best-practices-for-alwayson-availability-groups"></a><span data-ttu-id="f4849-107">Рекомендации по последовательной модернизации или обновлению для групп доступности AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="f4849-107">Rolling Upgrade/Update Best Practices for AlwaysOn Availability Groups</span></span>  
 <span data-ttu-id="f4849-108">Необходимо руководствоваться следующими рекомендациями при модернизации или обновлении сервера, чтобы свести к минимуму время простоя и потерю данных для групп доступности.</span><span class="sxs-lookup"><span data-stu-id="f4849-108">The following best practices should be observed when performing server upgrades/updates in order to minimize downtime and data loss for your availability groups:</span></span>  
  
-   <span data-ttu-id="f4849-109">Перед запуском последовательной модернизации или обновления:</span><span class="sxs-lookup"><span data-stu-id="f4849-109">Before starting the rolling upgrade/update,</span></span>  
  
    -   <span data-ttu-id="f4849-110">Получите опыт перехода на другой ресурс вручную по крайней мере на одной из применяемых реплик синхронной фиксации.</span><span class="sxs-lookup"><span data-stu-id="f4849-110">Perform a practice manual failover on at least one of your synchronous-commit replicas</span></span>  
  
    -   <span data-ttu-id="f4849-111">Защитите данные, выполнив полное резервное копирование базы данных на каждой базе данных доступности.</span><span class="sxs-lookup"><span data-stu-id="f4849-111">Protect your data by performing a full database backup on every availability database</span></span>  
  
    -   <span data-ttu-id="f4849-112">Выполните команду DBCC CHECKDB на каждой базе данных доступности.</span><span class="sxs-lookup"><span data-stu-id="f4849-112">Run DBCC CHECKDB on every availability database</span></span>  
  
-   <span data-ttu-id="f4849-113">Всегда модернизируйте или обновляйте в первую очередь удаленные вторичные узлы реплики, затем локальные вторичные узлы реплики и, наконец, первичный узел реплики.</span><span class="sxs-lookup"><span data-stu-id="f4849-113">Always upgrade/update the remote secondary replica nodes first, then local secondary replica nodes next, and the primary replica node last.</span></span>  
  
-   <span data-ttu-id="f4849-114">Резервное копирование базы данных, которая находится в процессе обновления, не может быть выполнено.</span><span class="sxs-lookup"><span data-stu-id="f4849-114">Backups cannot occur on a database that is in the process of being upgraded.</span></span>  <span data-ttu-id="f4849-115">Перед обновлением вторичных реплик настройте автоматическое резервное копирование так, чтобы оно создавало резервные копии только первичной реплики.</span><span class="sxs-lookup"><span data-stu-id="f4849-115">Prior to upgrading the secondary replicas, configure the automated backup preference to run backups only on the primary replica.</span></span>  <span data-ttu-id="f4849-116">До обновления основной реплики измените этот приоритет так, чтобы резервное копирование выполнялось только на вторичных репликах.</span><span class="sxs-lookup"><span data-stu-id="f4849-116">Prior to upgrading the primary replica, modify this setting to run backups only on the secondary replicas.</span></span>  
  
-   <span data-ttu-id="f4849-117">Чтобы предотвратить непреднамеренный переход на другой ресурс групп доступности в процессе модернизации или обновления, удалите конфигурацию перехода на другой ресурс доступности со всех реплик с синхронной фиксацией до начала работы.</span><span class="sxs-lookup"><span data-stu-id="f4849-117">To prevent the availability group from unintended failovers during the upgrade/update process, remove availability failover from all synchronous-commit replicas before you begin.</span></span>  
  
-   <span data-ttu-id="f4849-118">Не обновляйте первичный узел реплики перед возобновлением работы группы доступности на обновленном в первую очередь узле со вторичной репликой.</span><span class="sxs-lookup"><span data-stu-id="f4849-118">Do not upgrade the primary replica node before failing over the availability group to an upgraded node with a secondary replica first.</span></span> <span data-ttu-id="f4849-119">В противном случае клиентские приложения могут испытывать влияние более продолжительного времени простоя в ходе модернизации или обновления на первичной реплике.</span><span class="sxs-lookup"><span data-stu-id="f4849-119">Otherwise, client applications may suffer extended downtime during the upgrade/update on the primary replica.</span></span>  
  
-   <span data-ttu-id="f4849-120">Всегда возобновляйте работу группы доступности на узле вторичной реплики с синхронной фиксацией.</span><span class="sxs-lookup"><span data-stu-id="f4849-120">Always fail over the availability group to a synchronous-commit secondary replica node.</span></span> <span data-ttu-id="f4849-121">Если возобновление работы производится во вторичной реплике с асинхронной фиксацией, то в базах данных происходит потеря данных, а перемещение данных автоматически приостанавливается до возобновления его вручную.</span><span class="sxs-lookup"><span data-stu-id="f4849-121">If you fail over to an asynchronous-commit secondary replica, the databases will suffer data loss, and data movement is automatically suspended until you manually resume data movement.</span></span>  
  
-   <span data-ttu-id="f4849-122">Не проводите модернизацию или обновление узла первичной реплики до модернизации или обновления всех прочих узлов вторичной реплики.</span><span class="sxs-lookup"><span data-stu-id="f4849-122">Do not upgrade/update the primary replica node before upgrading/updating any other secondary replica nodes.</span></span> <span data-ttu-id="f4849-123">Обновленная первичная реплика больше не сможет поставлять журналы на те вторичные реплики, которые еще не были обновлены с переходом на ту же версию.</span><span class="sxs-lookup"><span data-stu-id="f4849-123">An upgraded primary replica can no longer ship logs to any secondary replica that has not yet been upgraded to the same version.</span></span> <span data-ttu-id="f4849-124">Если перемещение данных к вторичной реплике приостанавливается, то для этой реплики не может осуществляться автоматический переход на другой ресурс, а базы данных доступности становятся подверженными потере данных.</span><span class="sxs-lookup"><span data-stu-id="f4849-124">When data movement to a secondary replica is suspended, no automatic failover can occur for that replica, and your availability databases are vulnerable to data loss.</span></span>  
  
-   <span data-ttu-id="f4849-125">Перед возобновлением работы группы доступности проверьте, чтобы состоянием синхронизации для цели перехода на другой ресурс было SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="f4849-125">Before failing over an availability group, verify that the synchronization state of the failover target is SYNCHRONIZED.</span></span>  
  
## <a name="rolling-upgradeupdate-process"></a><span data-ttu-id="f4849-126">Процесс последовательной модернизации или обновления</span><span class="sxs-lookup"><span data-stu-id="f4849-126">Rolling Upgrade/Update Process</span></span>  
 <span data-ttu-id="f4849-127">На практике способ организации процесса зависит от многих факторов, в том числе топологии развертывания групп доступности и режима фиксации каждой реплики.</span><span class="sxs-lookup"><span data-stu-id="f4849-127">In practice, the exact process will depend on factors such as the deployment topology of your availability groups and the commit mode of each replica.</span></span> <span data-ttu-id="f4849-128">Но и в простейшем сценарии последовательная модернизация или обновление представляет собой многоступенчатый процесс, который даже в самой простой форме включает следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="f4849-128">But in the simplest scenario, a rolling upgrade/update is a multi-stage process that in its simplest form involves the following steps:</span></span>  
  
 <span data-ttu-id="f4849-129">![Обновление группы доступности в сценарии HADR](../../media/alwaysonupgrade-ag-hadr.gif "Обновление группы доступности в сценарии HADR")</span><span class="sxs-lookup"><span data-stu-id="f4849-129">![Availability Group Upgrade in HADR Scenario](../../media/alwaysonupgrade-ag-hadr.gif "Availability Group Upgrade in HADR Scenario")</span></span>  
  
1.  <span data-ttu-id="f4849-130">Удаление конфигурации автоматического перехода на другой ресурс на всех репликах с синхронной фиксацией</span><span class="sxs-lookup"><span data-stu-id="f4849-130">Remove automatic failover on all synchronous-commit replicas</span></span>  
  
2.  <span data-ttu-id="f4849-131">Модернизация или обновление всех удаленных экземпляров сервера, на которых функционируют вторичные реплики с асинхронной фиксацией</span><span class="sxs-lookup"><span data-stu-id="f4849-131">Upgrade/update all remote server instances running asynchronous-commit secondary replicas</span></span>  
  
3.  <span data-ttu-id="f4849-132">Модернизация или обновление всех экземпляров локального сервера, на которых в настоящее время не функционирует первичная реплика</span><span class="sxs-lookup"><span data-stu-id="f4849-132">Upgrade/update the all local server instances that are not currently running the primary replica</span></span>  
  
4.  <span data-ttu-id="f4849-133">Возобновление вручную работы группы доступности на вторичной реплике с синхронной фиксацией</span><span class="sxs-lookup"><span data-stu-id="f4849-133">Manually fail over the availability group to a synchronous-commit secondary replica</span></span>  
  
5.  <span data-ttu-id="f4849-134">Модернизация или обновление экземпляра сервера, на котором прежде размещалась первичная реплика</span><span class="sxs-lookup"><span data-stu-id="f4849-134">Upgrade/update the server instance that formerly hosted the primary replica</span></span>  
  
6.  <span data-ttu-id="f4849-135">Настройка участников автоматического перехода на другой ресурс желаемым образом</span><span class="sxs-lookup"><span data-stu-id="f4849-135">Configure automatic failover partners as desired</span></span>  
  
 <span data-ttu-id="f4849-136">В случае необходимости можно выполнить дополнительный переход на другой ресурс вручную, чтобы возвратить группу доступности к ее исходной конфигурации.</span><span class="sxs-lookup"><span data-stu-id="f4849-136">If necessary, you can perform an extra manual failover to return the availability group to its original configuration.</span></span>  
  
## <a name="availability-group-with-one-remote-secondary-replica"></a><span data-ttu-id="f4849-137">Группа доступности с одной удаленной вторичной репликой</span><span class="sxs-lookup"><span data-stu-id="f4849-137">Availability Group with One Remote Secondary Replica</span></span>  
 <span data-ttu-id="f4849-138">Если группа доступности развернута только для аварийного восстановления, то может потребоваться возобновить работу группы доступности для вторичной реплики с асинхронной фиксацией.</span><span class="sxs-lookup"><span data-stu-id="f4849-138">If you have deployed an availability group only for disaster recovery, you may need to fail over the availability group to an asynchronous-commit secondary replica.</span></span> <span data-ttu-id="f4849-139">Такая конфигурация показана на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="f4849-139">Such configuration is illustrated by the following figure:</span></span>  
  
 <span data-ttu-id="f4849-140">![Обновление группы доступности в сценарии DR](../../media/agupgrade-ag-dr.gif "Обновление группы доступности в сценарии DR")</span><span class="sxs-lookup"><span data-stu-id="f4849-140">![Availability Group Upgrade in DR Scenario](../../media/agupgrade-ag-dr.gif "Availability Group Upgrade in DR Scenario")</span></span>  
  
 <span data-ttu-id="f4849-141">В этой ситуации необходимо возобновить работу групп доступности для вторичной реплики с асинхронной фиксацией во время последовательной модернизации или обновления.</span><span class="sxs-lookup"><span data-stu-id="f4849-141">In this situation, you must fail over the availability group to the asynchronous-commit secondary replica during the rolling upgrade/update.</span></span> <span data-ttu-id="f4849-142">Чтобы предотвратить потерю данных, измените режим фиксации на синхронную фиксацию и ожидайте, пока вторичная реплика не будет синхронизирована, прежде чем возобновить работу группы доступности.</span><span class="sxs-lookup"><span data-stu-id="f4849-142">To prevent data loss, change the commit mode to synchronous commit and wait for the secondary replica to be synchronized before you fail over the availability group.</span></span> <span data-ttu-id="f4849-143">Поэтому процесс последовательной модернизации или обновления может выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="f4849-143">Therefore, the rolling upgrade/update process may look as follows:</span></span>  
  
1.  <span data-ttu-id="f4849-144">Модернизация или обновление удаленного сервера</span><span class="sxs-lookup"><span data-stu-id="f4849-144">Upgrade/update the remote server</span></span>  
  
2.  <span data-ttu-id="f4849-145">Изменение режима фиксации на синхронную фиксацию</span><span class="sxs-lookup"><span data-stu-id="f4849-145">Change the commit mode to synchronous commit</span></span>  
  
3.  <span data-ttu-id="f4849-146">Ожидание достижения состояния синхронизации SYNCHRONIZED</span><span class="sxs-lookup"><span data-stu-id="f4849-146">Wait until synchronization state is SYNCHRONIZED</span></span>  
  
4.  <span data-ttu-id="f4849-147">Возобновление работы группы доступности на удаленном узле</span><span class="sxs-lookup"><span data-stu-id="f4849-147">Fail over the availability group to the remote site</span></span>  
  
5.  <span data-ttu-id="f4849-148">Модернизация или обновление локального сервера (первичного сайта)</span><span class="sxs-lookup"><span data-stu-id="f4849-148">Upgrade/update the local (primary site) server</span></span>  
  
6.  <span data-ttu-id="f4849-149">Возобновление работы группы доступности на первичном сайте</span><span class="sxs-lookup"><span data-stu-id="f4849-149">Fail over the availability group to the primary site</span></span>  
  
7.  <span data-ttu-id="f4849-150">Изменение режима фиксации на асинхронную фиксацию</span><span class="sxs-lookup"><span data-stu-id="f4849-150">Change the commit mode to asynchronous commit</span></span>  
  
 <span data-ttu-id="f4849-151">Режим синхронной фиксации не представляет собой рекомендуемую настройку для синхронизации данных на удаленном узле, поэтому в клиентских приложениях может обнаруживаться непосредственное увеличение задержки базы данных после изменения этого параметра.</span><span class="sxs-lookup"><span data-stu-id="f4849-151">Since the synchronous-commit mode is not a recommended setting for data synchronization to a remote site, client applications may notice an immediate increase in database latency after the setting change.</span></span> <span data-ttu-id="f4849-152">Кроме того, выполнение перехода на другой ресурс приведет к тому, что все неподтвержденные сообщения журнала будут отброшены.</span><span class="sxs-lookup"><span data-stu-id="f4849-152">Moreover, performing a failover will cause all unacknowledged log messages to be discarded.</span></span> <span data-ttu-id="f4849-153">Количество отброшенных сообщений журнала может быть весьма большим из-за высокой задержки сети между этими двумя сайтами, а это приведет к тому, что клиенты столкнутся с увеличением количества сбоев транзакций.</span><span class="sxs-lookup"><span data-stu-id="f4849-153">The amount of discarded log messages can be quite large due to the high network latency between the two sites, causing clients to experience a high volume of transactional failure.</span></span> <span data-ttu-id="f4849-154">Можно свести к минимуму отрицательное воздействие на клиентские приложения, выполнив следующее.</span><span class="sxs-lookup"><span data-stu-id="f4849-154">You can minimize impact to client applications by doing the following:</span></span>  
  
-   <span data-ttu-id="f4849-155">Тщательный выбор перерыва на профилактическое техобслуживание в период снижения клиентского трафика</span><span class="sxs-lookup"><span data-stu-id="f4849-155">Carefully select a maintenance window during low client traffic</span></span>  
  
-   <span data-ttu-id="f4849-156">При модернизации или обновлении SQL Server на первичном сайте изменение режима доступности снова на асинхронную фиксацию, затем возврат к синхронной фиксации, когда все будет готово для повторного возобновления работы на первичном сайте</span><span class="sxs-lookup"><span data-stu-id="f4849-156">While upgrading/updating SQL Server on the primary site, change the availability mode back to asynchronous commit, then revert to synchronous commit when you are ready to fail over to the primary site again</span></span>  
  
## <a name="availability-group-with-failover-cluster-instance-nodes"></a><span data-ttu-id="f4849-157">Группа доступности с узлами экземпляра отказоустойчивого кластера</span><span class="sxs-lookup"><span data-stu-id="f4849-157">Availability Group with Failover Cluster Instance Nodes</span></span>  
 <span data-ttu-id="f4849-158">Если группа доступности содержит узлы экземпляра отказоустойчивого кластера (FCI), необходимо модернизировать или обновлять неактивные узлы перед модернизацией или обновлением активных узлов.</span><span class="sxs-lookup"><span data-stu-id="f4849-158">If an availability group contains failover cluster instance (FCI) nodes, you should upgrade/update the inactive nodes before you upgrade/update the active nodes.</span></span> <span data-ttu-id="f4849-159">На приведенном ниже рисунке показан обычный сценарий для групп доступности с использованием экземпляров FCI для достижения локального высокого уровня доступности и асинхронной фиксации между экземплярами FCIs для удаленного аварийного восстановления, а также последовательность обновления.</span><span class="sxs-lookup"><span data-stu-id="f4849-159">The figure below illustrates a common availability group scenario with FCIs for local high availability and asynchronous commit between the FCIs for remote disaster recovery, and the upgrade sequence.</span></span>  
  
 <span data-ttu-id="f4849-160">![Обновление группы доступности с FCI](../../media/agupgrade-ag-fci-dr.gif "Обновление группы доступности с FCI")</span><span class="sxs-lookup"><span data-stu-id="f4849-160">![Availability Group Upgrade with FCIs](../../media/agupgrade-ag-fci-dr.gif "Availability Group Upgrade with FCIs")</span></span>  
  
1.  <span data-ttu-id="f4849-161">Модернизация или обновление REMOTE2</span><span class="sxs-lookup"><span data-stu-id="f4849-161">Upgrade/update REMOTE2</span></span>  
  
2.  <span data-ttu-id="f4849-162">Возобновление работы FCI2 на REMOTE2</span><span class="sxs-lookup"><span data-stu-id="f4849-162">Fail over FCI2 to REMOTE2</span></span>  
  
3.  <span data-ttu-id="f4849-163">Модернизация или обновление REMOTE1</span><span class="sxs-lookup"><span data-stu-id="f4849-163">Upgrade/update REMOTE1</span></span>  
  
4.  <span data-ttu-id="f4849-164">Модернизация или обновление PRIMARY2</span><span class="sxs-lookup"><span data-stu-id="f4849-164">Upgrade/update PRIMARY2</span></span>  
  
5.  <span data-ttu-id="f4849-165">Возобновление работы FCI1 на PRIMARY2</span><span class="sxs-lookup"><span data-stu-id="f4849-165">Fail over FCI1 to PRIMARY2</span></span>  
  
6.  <span data-ttu-id="f4849-166">Модернизация или обновление PRIMARY1</span><span class="sxs-lookup"><span data-stu-id="f4849-166">Upgrade/update PRIMARY1</span></span>  
  
## <a name="upgradeupdate-sql-server-instances-with-multiple-availability-groups"></a><span data-ttu-id="f4849-167">Модернизация или обновление экземпляров SQL Server с несколькими группами доступности</span><span class="sxs-lookup"><span data-stu-id="f4849-167">Upgrade/Update SQL Server Instances with Multiple Availability Groups</span></span>  
 <span data-ttu-id="f4849-168">Если эксплуатируются несколько групп доступности с первичными репликами на отдельных узлах сервера (активно-активная конфигурация), то путь модернизации или обновления предусматривает применение большего количества шагов перехода на другой ресурс для сохранения высокого уровня доступности в этом процессе.</span><span class="sxs-lookup"><span data-stu-id="f4849-168">If you are running multiple availability groups with primary replicas on separate server nodes (an Active/Active configuration), the upgrade/update path involves more failover steps to preserve high availability in the process.</span></span> <span data-ttu-id="f4849-169">Предположим, что эксплуатируются три группы доступности на трех узлах сервера, как показано в следующей таблице, а все вторичные реплики работают в режиме синхронной фиксации.</span><span class="sxs-lookup"><span data-stu-id="f4849-169">Suppose you are running three availability groups on three server nodes as shown in the following table, and all secondary replicas are running in synchronous-commit mode.</span></span>  
  
|<span data-ttu-id="f4849-170">Группа доступности</span><span class="sxs-lookup"><span data-stu-id="f4849-170">Availability Group</span></span>|<span data-ttu-id="f4849-171">Узел1</span><span class="sxs-lookup"><span data-stu-id="f4849-171">Node1</span></span>|<span data-ttu-id="f4849-172">Узел2</span><span class="sxs-lookup"><span data-stu-id="f4849-172">Node2</span></span>|<span data-ttu-id="f4849-173">Node3</span><span class="sxs-lookup"><span data-stu-id="f4849-173">Node3</span></span>|  
|------------------------|-----------|-----------|-----------|  
|<span data-ttu-id="f4849-174">ГД1</span><span class="sxs-lookup"><span data-stu-id="f4849-174">AG1</span></span>|<span data-ttu-id="f4849-175">Первичная</span><span class="sxs-lookup"><span data-stu-id="f4849-175">Primary</span></span>|||  
|<span data-ttu-id="f4849-176">ГД2</span><span class="sxs-lookup"><span data-stu-id="f4849-176">AG2</span></span>||<span data-ttu-id="f4849-177">Первичная</span><span class="sxs-lookup"><span data-stu-id="f4849-177">Primary</span></span>||  
|<span data-ttu-id="f4849-178">ГД3</span><span class="sxs-lookup"><span data-stu-id="f4849-178">AG3</span></span>|||<span data-ttu-id="f4849-179">Первичная</span><span class="sxs-lookup"><span data-stu-id="f4849-179">Primary</span></span>|  
  
 <span data-ttu-id="f4849-180">В конкретной ситуации бывает приемлема последовательная модернизация или обновление со сбалансированной нагрузкой в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="f4849-180">It may be appropriate in your situation to perform a load-balanced rolling upgrade/update in the following sequence:</span></span>  
  
1.  <span data-ttu-id="f4849-181">Возобновление работы ГД2 на Узле3 (для освобождения Узла2)</span><span class="sxs-lookup"><span data-stu-id="f4849-181">Fail over AG2 to Node3 (to free up Node2)</span></span>  
  
2.  <span data-ttu-id="f4849-182">Модернизация или обновление Узла2</span><span class="sxs-lookup"><span data-stu-id="f4849-182">Upgrade/update Node2</span></span>  
  
3.  <span data-ttu-id="f4849-183">Возобновление работы ГД1 на Узле2 (для освобождения Узла1)</span><span class="sxs-lookup"><span data-stu-id="f4849-183">Fail over AG1 to Node2 (to free up Node1)</span></span>  
  
4.  <span data-ttu-id="f4849-184">Модернизация или обновление Узла1</span><span class="sxs-lookup"><span data-stu-id="f4849-184">Upgrade/update Node1</span></span>  
  
5.  <span data-ttu-id="f4849-185">Возобновление работы обеих групп доступности, ГД2 и ГД3, на Узле1 (для освобождения Узла3)</span><span class="sxs-lookup"><span data-stu-id="f4849-185">Fail over both AG2 and AG3 to Node1 (to free up Node3)</span></span>  
  
6.  <span data-ttu-id="f4849-186">Модернизация или обновление Узла3</span><span class="sxs-lookup"><span data-stu-id="f4849-186">Upgrade/update Node3</span></span>  
  
7.  <span data-ttu-id="f4849-187">Возобновление работы ГД3 на Узле3</span><span class="sxs-lookup"><span data-stu-id="f4849-187">Fail over AG3 to Node3</span></span>  
  
 <span data-ttu-id="f4849-188">Эта последовательность модернизации или обновления характеризуется средним временем простоя меньше двух переходов на другой ресурс в расчете на группу доступности.</span><span class="sxs-lookup"><span data-stu-id="f4849-188">This upgrade/update sequence has an average downtime of less than two failovers per availability group.</span></span> <span data-ttu-id="f4849-189">Результирующая конфигурация показана в приведенной ниже таблице.</span><span class="sxs-lookup"><span data-stu-id="f4849-189">The resulting configuration is shown in the table below.</span></span>  
  
|<span data-ttu-id="f4849-190">Группа доступности</span><span class="sxs-lookup"><span data-stu-id="f4849-190">Availability Group</span></span>|<span data-ttu-id="f4849-191">Узел1</span><span class="sxs-lookup"><span data-stu-id="f4849-191">Node1</span></span>|<span data-ttu-id="f4849-192">Узел2</span><span class="sxs-lookup"><span data-stu-id="f4849-192">Node2</span></span>|<span data-ttu-id="f4849-193">Node3</span><span class="sxs-lookup"><span data-stu-id="f4849-193">Node3</span></span>|  
|------------------------|-----------|-----------|-----------|  
|<span data-ttu-id="f4849-194">ГД1</span><span class="sxs-lookup"><span data-stu-id="f4849-194">AG1</span></span>||<span data-ttu-id="f4849-195">Первичная</span><span class="sxs-lookup"><span data-stu-id="f4849-195">Primary</span></span>||  
|<span data-ttu-id="f4849-196">ГД2</span><span class="sxs-lookup"><span data-stu-id="f4849-196">AG2</span></span>|<span data-ttu-id="f4849-197">Первичная</span><span class="sxs-lookup"><span data-stu-id="f4849-197">Primary</span></span>|||  
|<span data-ttu-id="f4849-198">ГД3</span><span class="sxs-lookup"><span data-stu-id="f4849-198">AG3</span></span>|||<span data-ttu-id="f4849-199">Первичная</span><span class="sxs-lookup"><span data-stu-id="f4849-199">Primary</span></span>|  
  
 <span data-ttu-id="f4849-200">Путь модернизации или обновления может изменяться в зависимости от конкретной реализации, то же относится к времени простоя клиентских приложений.</span><span class="sxs-lookup"><span data-stu-id="f4849-200">Based on your specific implementation, your upgrade/update path may vary, and the downtime that client applications experience may vary as well.</span></span>  
  
  
