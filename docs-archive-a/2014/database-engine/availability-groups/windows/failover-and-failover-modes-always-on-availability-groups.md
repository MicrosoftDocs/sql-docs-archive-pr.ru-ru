---
title: Отработка отказа и режимы отработки отказа (группы доступности AlwaysOn) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], failover
- Availability Groups [SQL Server], failover modes
- failover [SQL Server], AlwaysOn Availability Groups
ms.assetid: 378d2d63-50b9-420b-bafb-d375543fda17
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: eb904cd0f0649c43553b5d6c8b031c5f284901f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87658999"
---
# <a name="failover-and-failover-modes-alwayson-availability-groups"></a><span data-ttu-id="fe259-102">Отработка отказа и режимы отработки отказа (группы доступности AlwaysOn)</span><span class="sxs-lookup"><span data-stu-id="fe259-102">Failover and Failover Modes (AlwaysOn Availability Groups)</span></span>
  <span data-ttu-id="fe259-103">В контексте группы доступности роли первичной и вторичной реплик доступности обычно являются взаимозаменяемыми в ходе процесса, известного как *переход на другой ресурс или отработка отказа*.</span><span class="sxs-lookup"><span data-stu-id="fe259-103">Within the context of an availability group, the primary role and secondary role of availability replicas are typically interchangeable in a process known as *failover*.</span></span> <span data-ttu-id="fe259-104">Существуют три формы перехода на другой ресурс: автоматический переход на другой ресурс (без потери данных), запланированный переход на другой ресурс вручную (без потери данных) и принудительный переход на другой ресурс вручную (с возможной потерей данных), обычно именуемый *принудительным переходом на другой ресурс*.</span><span class="sxs-lookup"><span data-stu-id="fe259-104">Three forms of failover exist: automatic failover (without data loss), planned manual failover (without data loss), and forced manual failover (with possible data loss), typically called *forced failover*.</span></span> <span data-ttu-id="fe259-105">При автоматическом и запланированном ручном переходе на другой ресурс все данные сохраняются.</span><span class="sxs-lookup"><span data-stu-id="fe259-105">Automatic and planned manual failover preserve all your data.</span></span> <span data-ttu-id="fe259-106">Группа доступности выполняет переход на другой ресурс на уровне реплики доступности.</span><span class="sxs-lookup"><span data-stu-id="fe259-106">An availability group fails over at the availability-replica level.</span></span> <span data-ttu-id="fe259-107">Это значит, что при отработке отказа группа доступности переходит на одну из ее вторичных реплик (на текущую *цель отработки отказа*).</span><span class="sxs-lookup"><span data-stu-id="fe259-107">That is, an availability group fails over to one of its secondary replicas (the current *failover target*).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="fe259-108">Переход группы доступности на другой ресурс не вызывается проблемами на уровне баз данных, например обозначением базы данных как подозрительной в связи с потерей файла данных или повреждением журнала транзакций.</span><span class="sxs-lookup"><span data-stu-id="fe259-108">Issues at the database level, such as a database becoming suspect due to the loss of a data file, deletion of a database, or corruption of a transaction log, do not cause an availability group to failover.</span></span>  
  
 <span data-ttu-id="fe259-109">Во время отработки отказа цель принимает первичную роль, восстанавливает свои базы данных и переводит их в режим «в сети» в качестве новых баз данных-источников.</span><span class="sxs-lookup"><span data-stu-id="fe259-109">During the failover, the failover target takes over the primary role, recovers its databases, and brings them online as the new primary databases.</span></span> <span data-ttu-id="fe259-110">Бывшая первичная реплика, если она доступна, переключается в роль вторичной, а ее базы данных становятся базами данных-получателями.</span><span class="sxs-lookup"><span data-stu-id="fe259-110">The former primary replica, when available, switches to the secondary role, and its databases become secondary databases.</span></span> <span data-ttu-id="fe259-111">Возможно многократное переключение ролей между двумя (и большим числом целей обработки отказа) либо в результате многочисленных ошибок, либо в целях администрирования.</span><span class="sxs-lookup"><span data-stu-id="fe259-111">Potentially, these roles can switch back and forth (or to a different failover target) in response to multiple failures or for administrative purposes.</span></span>  
  
 <span data-ttu-id="fe259-112">Виды отработки отказа, которые поддерживает данная реплика доступности, задаются свойством *режим отработки отказов* .</span><span class="sxs-lookup"><span data-stu-id="fe259-112">The form(s) of failover that a given availability replica supports is specified by the *failover mode* property.</span></span> <span data-ttu-id="fe259-113">Возможные режимы отработки отказа определенной реплики доступности зависят от [режима доступности](availability-modes-always-on-availability-groups.md) реплики следующим образом:</span><span class="sxs-lookup"><span data-stu-id="fe259-113">For a given availability replica, the possible failover modes depends on the [availability mode](availability-modes-always-on-availability-groups.md) of the replica, as follows:</span></span>  
  
-   <span data-ttu-id="fe259-114">**Реплики синхронной фиксации** поддерживают два параметра: автоматически или вручную.</span><span class="sxs-lookup"><span data-stu-id="fe259-114">**Synchronous-commit replicas** support two settings-automatic or manual.</span></span> <span data-ttu-id="fe259-115">Параметр «автоматическая» поддерживает как автоматическую так ручную отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-115">The "automatic" setting supports both automatic failover and manual failover.</span></span> <span data-ttu-id="fe259-116">Чтобы предотвратить потерю данных, для автоматической отработки отказа и запланированной отработки отказа необходимо, чтобы целью была вторичная реплика синхронной фиксации с работоспособным состоянием синхронизации (это значит, что каждая база данных-получатель в цели отработки отказа синхронизирована с соответствующей базой данных-источником).</span><span class="sxs-lookup"><span data-stu-id="fe259-116">To prevent data loss, automatic failover and planned failover require that the failover target be a synchronous-commit secondary replica with a healthy synchronization state (this indicates that every secondary database on the failover target is synchronized with its corresponding primary database).</span></span> <span data-ttu-id="fe259-117">Если вторичная реплика не соответствует ни одному из этих условий, то она поддерживает только принудительную ручную отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-117">Whenever a secondary replica does not meet both of these conditions, it supports only forced failover.</span></span> <span data-ttu-id="fe259-118">Обратите внимание, что принудительная отработка отказа также поддерживается репликами, роль которых находится в состоянии RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="fe259-118">Note that forced failover is also supported a replicas whose role is in the RESOLVING state.</span></span>  
  
-   <span data-ttu-id="fe259-119">**Реплики асинхронной фиксации** поддерживают отработку отказа только вручную.</span><span class="sxs-lookup"><span data-stu-id="fe259-119">**Asynchronous-commit replicas** support only the manual failover mode.</span></span> <span data-ttu-id="fe259-120">Кроме того, поскольку они никогда не синхронизированы, они поддерживают только принудительную отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-120">Moreover, because they are never synchronized, they support only forced failover.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="fe259-121">После отработки отказа клиентским приложениям, которым требуется доступ к базам данных-источникам, будет необходимо подключиться к новой первичной реплике.</span><span class="sxs-lookup"><span data-stu-id="fe259-121">After a failover, client applications that need to access the primary databases must connect to the new primary replica.</span></span> <span data-ttu-id="fe259-122">Кроме того, если новая вторичная реплика настроена на доступ только на чтение, то клиентские приложения с доступом только на чтение могут подключиться к ней.</span><span class="sxs-lookup"><span data-stu-id="fe259-122">Also, if the new secondary replica is configured to allow read-only access, read-only client applications can connect to it.</span></span> <span data-ttu-id="fe259-123">Дополнительные сведения о подключении клиентов в группе доступности см. в статье [Прослушиватели групп доступности, возможность подключения клиентов и отработка отказа приложений (SQL Server)](../../listeners-client-connectivity-application-failover.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-123">For information about how clients connect to an availability group, see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md).</span></span>  
  
  
##  <a name="terms-and-definitions"></a><a name="TermsAndDefinitions"></a> <span data-ttu-id="fe259-124">Термины и определения</span><span class="sxs-lookup"><span data-stu-id="fe259-124">Terms and Definitions</span></span>  
 <span data-ttu-id="fe259-125">автоматический переход на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="fe259-125">Automatic failover</span></span>  
 <span data-ttu-id="fe259-126">Отработка отказа, которая выполняется автоматически при потере первичной реплики.</span><span class="sxs-lookup"><span data-stu-id="fe259-126">A failover that occurs automatically on the loss of the primary replica.</span></span> <span data-ttu-id="fe259-127">Автоматический переход на другой ресурс поддерживается только в ситуации, когда текущая первичная и одна из вторичных реплик настроены на режим перехода на другой ресурс AUTOMATIC, а вторичная реплика в данный момент синхронизована.</span><span class="sxs-lookup"><span data-stu-id="fe259-127">Automatic failover is supported only when the current primary and one secondary replica are both configured with failover mode set to AUTOMATIC and the secondary replica currently synchronized.</span></span>  <span data-ttu-id="fe259-128">Если для первичной или вторичной реплики задан режим отработки отказа MANUAL, автоматический переход на другой ресурс будет невозможен.</span><span class="sxs-lookup"><span data-stu-id="fe259-128">If the failover mode of either the primary or secondary replica is MANUAL, automatic failover cannot occur.</span></span>  
  
 <span data-ttu-id="fe259-129">Запланированный переход на другой ресурс вручную (без потери данных)</span><span class="sxs-lookup"><span data-stu-id="fe259-129">Planned manual failover (without data loss)</span></span>  
 <span data-ttu-id="fe259-130">Запланированный переход на другой ресурс вручную или *переход на другой ресурс вручную*обычно осуществляется администратором базы данных в административных целях.</span><span class="sxs-lookup"><span data-stu-id="fe259-130">Planned manual failover, or *manual failover*, is a failover that is initiated by a database administrator, typically, for administrative purposes.</span></span> <span data-ttu-id="fe259-131">Запланированный переход на другой ресурс вручную поддерживается лишь в случае, когда первичная и вторичная реплики настроены на режим синхронной фиксации, а вторичная реплика в данный момент синхронизована (находится в состоянии SYNCHRONIZED).</span><span class="sxs-lookup"><span data-stu-id="fe259-131">A planned manual failover is supported only if both the primary replica and secondary replica are configured for synchronous-commit mode and the secondary replica is currently synchronized (in the SYNCHRONIZED state).</span></span> <span data-ttu-id="fe259-132">Если целевая вторичная реплика синхронизирована, то переход на другой ресурс вручную (без потери данных) возможен даже в случае сбоя первичной реплики, поскольку базы данных-получатели готовы к отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-132">When the target secondary replica is synchronized, manual failover (without data loss) is possible even if the primary replica has crashed because the secondary databases are ready for failover.</span></span> <span data-ttu-id="fe259-133">Администратор базы данных вручную запускает переход на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="fe259-133">A database administrator manually initiates a manual failover.</span></span>  
  
 <span data-ttu-id="fe259-134">Принудительная отработка отказа (с возможной потерей данных)</span><span class="sxs-lookup"><span data-stu-id="fe259-134">Forced failover (with possible data loss)</span></span>  
 <span data-ttu-id="fe259-135">Отработка отказа, которая может быть инициирована администратором базы данных, если ни одна вторичная реплика не синхронизирована (SYNCHRONIZED) с первичной репликой либо первичная реплика не запущена и ни одна вторичная реплика не готова к отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-135">A failover that can be initiated by a database administrator when no secondary replica is SYNCHRONIZED with the primary replica or the primary replica is not running and no secondary replica is failover ready.</span></span> <span data-ttu-id="fe259-136">Принудительная отработка отказа может привести к потере данных, ее рекомендуется использовать исключительно при аварийном восстановлении.</span><span class="sxs-lookup"><span data-stu-id="fe259-136">Forced failover risks possible data loss and is recommended strictly for disaster recovery.</span></span> <span data-ttu-id="fe259-137">Принудительная отработка отказа также известна как принудительная отработка отказа вручную, поскольку она может быть инициирована только вручную.</span><span class="sxs-lookup"><span data-stu-id="fe259-137">Forced failover is also known as forced manual failover because it can only be initiated manually.</span></span> <span data-ttu-id="fe259-138">Это единственная форма отработки отказа, которая поддерживается в режиме доступности асинхронной фиксации.</span><span class="sxs-lookup"><span data-stu-id="fe259-138">This is the only form of failover supported by in asynchronous-commit availability mode.</span></span>  
  
 [!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)]  
 <span data-ttu-id="fe259-139">В пределах заданной группы доступности это пара реплик доступности (включая текущую первичную реплику), которые настроены для режима синхронной фиксации с автоматическим переходом на другой ресурс (если они есть).</span><span class="sxs-lookup"><span data-stu-id="fe259-139">Within a given availability group, a pair of availability replicas (including the current primary replica) that are configured for synchronous-commit mode with automatic failover, if any.</span></span> <span data-ttu-id="fe259-140">[!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]вступает в силу только в случае, если вторичная реплика в настоящее время находится в состоянии SYNCHRONIZED с первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-140">An[!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]takes effect only if the secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 [!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)]  
 <span data-ttu-id="fe259-141">В пределах заданной группы доступности это набор из двух или трех реплик доступности (включая текущую первичную реплику), в которых, при их наличии, настроен режим синхронной фиксации.</span><span class="sxs-lookup"><span data-stu-id="fe259-141">Within a given availability group, a set of two or three availability replicas (including the current primary replica) that are configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="fe259-142">[!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]вступает в силу, только если во вторичных репликах настроен режим перехода на другой ресурс вручную и как минимум одна вторичная реплика находится в состоянии SYNCHRONIZED с первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-142">A [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]takes effect only if the secondary replicas are configured for manual failover mode and at least one secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 [!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)]  
 <span data-ttu-id="fe259-143">В данной группе доступности набор всех реплик доступности, состоянием работоспособности которых в данный момент является ONLINE, вне зависимости от режима доступности или режима отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-143">Within a given availability group, the set of all availability replicas whose operational state is currently ONLINE, regardless of availability mode and of failover mode.</span></span> <span data-ttu-id="fe259-144">[!INCLUDE[ssFosEntire](../../../includes/ssfosentire-md.md)]вступает в силу только в случае, если вторичная реплика в настоящее время находится в состоянии SYNCHRONIZED с первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-144">The [!INCLUDE[ssFosEntire](../../../includes/ssfosentire-md.md)]becomes relevant when no secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
##  <a name="overview-of-failover"></a><a name="Overview"></a> <span data-ttu-id="fe259-145">Общие сведения об отработке отказа</span><span class="sxs-lookup"><span data-stu-id="fe259-145">Overview of Failover</span></span>  
 <span data-ttu-id="fe259-146">Следующая таблица содержит сводные данные о различных видах отработки отказа, поддерживаемых в различных режимах доступности и отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-146">The following table summarizes which forms of failover are supported under different availability and failover modes.</span></span> <span data-ttu-id="fe259-147">Для каждой пары действующий режим доступности и отработки отказа определяется как пересечение режимов первичной реплики и режимов одной или нескольких вторичных реплик.</span><span class="sxs-lookup"><span data-stu-id="fe259-147">For each pairing, the effective availability mode and failover mode is determined by the intersection of the modes of the primary replica plus the modes of one or more secondary replicas.</span></span>  
  
||<span data-ttu-id="fe259-148">Режим асинхронной фиксации</span><span class="sxs-lookup"><span data-stu-id="fe259-148">Asynchronous-commit mode</span></span>|<span data-ttu-id="fe259-149">Режим синхронной фиксации с режимом перехода на другой ресурс вручную</span><span class="sxs-lookup"><span data-stu-id="fe259-149">Synchronous-commit mode with manual-failover mode</span></span>|<span data-ttu-id="fe259-150">Режим синхронной фиксации с режимом автоматического перехода на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="fe259-150">Synchronous-commit mode with automatic-failover mode</span></span>|  
|-|-------------------------------|---------------------------------------------------------|------------------------------------------------------------|  
|<span data-ttu-id="fe259-151">автоматический переход на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="fe259-151">Automatic failover</span></span>|<span data-ttu-id="fe259-152">Нет</span><span class="sxs-lookup"><span data-stu-id="fe259-152">No</span></span>|<span data-ttu-id="fe259-153">Нет</span><span class="sxs-lookup"><span data-stu-id="fe259-153">No</span></span>|<span data-ttu-id="fe259-154">Да</span><span class="sxs-lookup"><span data-stu-id="fe259-154">Yes</span></span>|  
|<span data-ttu-id="fe259-155">Запланированная отработка отказа вручную</span><span class="sxs-lookup"><span data-stu-id="fe259-155">Planned manual failover</span></span>|<span data-ttu-id="fe259-156">Нет</span><span class="sxs-lookup"><span data-stu-id="fe259-156">No</span></span>|<span data-ttu-id="fe259-157">Да</span><span class="sxs-lookup"><span data-stu-id="fe259-157">Yes</span></span>|<span data-ttu-id="fe259-158">Да</span><span class="sxs-lookup"><span data-stu-id="fe259-158">Yes</span></span>|  
|<span data-ttu-id="fe259-159">принудительным переходом на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="fe259-159">Forced failover</span></span>|<span data-ttu-id="fe259-160">Да</span><span class="sxs-lookup"><span data-stu-id="fe259-160">Yes</span></span>|<span data-ttu-id="fe259-161">Да</span><span class="sxs-lookup"><span data-stu-id="fe259-161">Yes</span></span>|<span data-ttu-id="fe259-162">Да**<sup>\*</sup>**</span><span class="sxs-lookup"><span data-stu-id="fe259-162">Yes**<sup>\*</sup>**</span></span>|  
  
 <span data-ttu-id="fe259-163">**<sup>\*</sup>** При выполнении команды принудительной отработки отказа на синхронизированной вторичной реплике вторичная реплика ведет себя так же, как и при переходе на другой ресурс вручную.</span><span class="sxs-lookup"><span data-stu-id="fe259-163">**<sup>\*</sup>**  If you issue a forced failover command on a synchronized secondary replica, the secondary replica behaves the same as for a manual failover.</span></span>  
  
 <span data-ttu-id="fe259-164">Время, в течение которого база данных недоступна в ходе отработки отказа, зависит от типа отработки отказа и причины, вызвавшей его.</span><span class="sxs-lookup"><span data-stu-id="fe259-164">The amount of time that the database is unavailable during a failover depends on the type of failover and its cause.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="fe259-165">Для обеспечения поддержки клиентских подключений после отработки отказа (за исключением автономных баз данных) имена входа и задания, определенные для всех бывших баз данных-источников, будет необходимо создать вручную для новой первичной базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="fe259-165">To support client connections after failover, except for contained databases, logins and jobs defined on any of the former primary databases must be manually recreated on the new primary database.</span></span> <span data-ttu-id="fe259-166">Дополнительные сведения см. в разделе [Управление именами входа и заданиями для баз данных группы доступности (SQL Server)](../../logins-and-jobs-for-availability-group-databases.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-166">For more information, see [Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span></span>  
  
### <a name="failover-sets"></a><span data-ttu-id="fe259-167">Наборы отработки отказа</span><span class="sxs-lookup"><span data-stu-id="fe259-167">Failover Sets</span></span>  
 <span data-ttu-id="fe259-168">Формы отработки отказа, которые могут быть реализованы для данной группы доступности, можно называть наборами отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-168">The forms of failover that are possible for a given availability group can be understood in terms of failover sets.</span></span> <span data-ttu-id="fe259-169">Набор отработки отказа состоит из первичной и вторичной реплик, поддерживающих данную форму отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-169">A failover set consists of the primary replica and secondary replicas that support a given form of failover, as follows:</span></span>  
  
-   <span data-ttu-id="fe259-170">**[!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)] (необязательно):**  В пределах заданной группы доступности это пара реплик доступности (включая текущую первичную реплику), которые настроены для режима синхронной фиксации с автоматическим переходом на другой ресурс (если они есть).</span><span class="sxs-lookup"><span data-stu-id="fe259-170">**[!INCLUDE[ssFosAutoC](../../../includes/ssfosautoc-md.md)] (optional):**  Within a given availability group, a pair of availability replicas (including the current primary replica) that are configured for synchronous-commit mode with automatic failover, if any.</span></span> <span data-ttu-id="fe259-171">Набор автоматического перехода на другой ресурс учитывается только в случае, если вторичная реплика в настоящее время находится в состоянии SYNCHRONIZED с первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-171">An automatic failover set takes effect only if the secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
-   <span data-ttu-id="fe259-172">**[!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)] (необязательно):**  В пределах заданной группы доступности это набор из двух или трех реплик доступности (включая текущую первичную реплику), в которых, при их наличии, настроен режим синхронной фиксации.</span><span class="sxs-lookup"><span data-stu-id="fe259-172">**[!INCLUDE[ssFosSyncC](../../../includes/ssfossyncc-md.md)] (optional):**  Within a given availability group, a set of two or three availability replicas (including the current primary replica) that are configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="fe259-173">Набор отработки отказа с синхронной фиксаций используется, только если во вторичных репликах настроен режим отработки отказа вручную и как минимум одна вторичная реплика находится в состоянии SYNCHRONIZED с первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-173">A synchronous-commit failover set takes effect only if the secondary replicas are configured for manual failover mode and at least one secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
-   <span data-ttu-id="fe259-174">**[!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)] :**  В данной группе доступности набор всех реплик доступности, состоянием работоспособности которых в данный момент является ONLINE, вне зависимости от режима доступности или режима отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-174">**[!INCLUDE[ssFosEntireC](../../../includes/ssfosentirec-md.md)] :**  Within a given availability group, the set of all availability replicas whose operational state is currently ONLINE, regardless of availability mode and of failover mode.</span></span> <span data-ttu-id="fe259-175">Полный набор отработки отказа используется только в случае, если вторичная реплика в настоящее время находится в состоянии SYNCHRONIZED с первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-175">The entire failover set becomes relevant when no secondary replica is currently SYNCHRONIZED with the primary replica.</span></span>  
  
 <span data-ttu-id="fe259-176">Если реплика доступности настраивается на синхронную фиксацию с автоматическим переходом на другой ресурс, реплика доступности входит в состав [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)].</span><span class="sxs-lookup"><span data-stu-id="fe259-176">When you configure an availability replica as synchronous commit with automatic failover, the availability replica becomes part of the [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)].</span></span> <span data-ttu-id="fe259-177">Однако функционирование набора зависит от текущей первичной реплики.</span><span class="sxs-lookup"><span data-stu-id="fe259-177">However whether the set takes effect depends the current primary.</span></span> <span data-ttu-id="fe259-178">То, какие виды перехода на другой ресурс являются доступными в определенный момент, зависит от наборов отработки отказа, действующих на данный момент.</span><span class="sxs-lookup"><span data-stu-id="fe259-178">The forms of failover that are actually possible at a given time depends on what failover sets are currently in effect.</span></span>  
  
 <span data-ttu-id="fe259-179">Например, рассмотрим группу доступности, которая имеет четыре реплики доступности:</span><span class="sxs-lookup"><span data-stu-id="fe259-179">For example, consider an availability group that has four availability replicas, as follows:</span></span>  
  
|<span data-ttu-id="fe259-180">Реплика</span><span class="sxs-lookup"><span data-stu-id="fe259-180">Replica</span></span>|<span data-ttu-id="fe259-181">Настройки режима доступности и режима отработки отказа</span><span class="sxs-lookup"><span data-stu-id="fe259-181">Availability Mode and Failover Mode Settings</span></span>|  
|-------------|--------------------------------------------------|  
|<span data-ttu-id="fe259-182">Объект</span><span class="sxs-lookup"><span data-stu-id="fe259-182">A</span></span>|<span data-ttu-id="fe259-183">Синхронная фиксация с автоматической отработкой отказа</span><span class="sxs-lookup"><span data-stu-id="fe259-183">Synchronous commit with automatic failover</span></span>|  
|<span data-ttu-id="fe259-184">B</span><span class="sxs-lookup"><span data-stu-id="fe259-184">B</span></span>|<span data-ttu-id="fe259-185">Синхронная фиксация с автоматической отработкой отказа</span><span class="sxs-lookup"><span data-stu-id="fe259-185">Synchronous commit with automatic failover</span></span>|  
|<span data-ttu-id="fe259-186">C</span><span class="sxs-lookup"><span data-stu-id="fe259-186">C</span></span>|<span data-ttu-id="fe259-187">Синхронная фиксация только с плановой отработкой отказа вручную</span><span class="sxs-lookup"><span data-stu-id="fe259-187">Synchronous commit with planned manual failover only</span></span>|  
|<span data-ttu-id="fe259-188">D</span><span class="sxs-lookup"><span data-stu-id="fe259-188">D</span></span>|<span data-ttu-id="fe259-189">Асинхронная фиксация (только с режимом принудительной отработки отказа)</span><span class="sxs-lookup"><span data-stu-id="fe259-189">Asynchronous commit (with only forced failover)</span></span>|  
  
 <span data-ttu-id="fe259-190">Поведение отработки отказа каждой из вторичных реплик зависит от того, какая реплика доступности назначена в данный момент первичной.</span><span class="sxs-lookup"><span data-stu-id="fe259-190">The failover behavior for each secondary replica depends on which availability replica is currently the primary replica.</span></span> <span data-ttu-id="fe259-191">Обычно для данной вторичной реплики отработка отказа— это худший возможный вариант при текущей первичной реплике.</span><span class="sxs-lookup"><span data-stu-id="fe259-191">Basically, for a given secondary replica, the failover behavior is the worst case given the current primary replica.</span></span> <span data-ttu-id="fe259-192">На следующем рисунке показано, как способ отработки отказа на вторичных репликах зависит от текущей первичной реплики и от того, настроена она на режим асинхронной фиксации (только с принудительным переходом на другой ресурс) или режим синхронной фиксации (с автоматическим переходом на другой ресурс или без него).</span><span class="sxs-lookup"><span data-stu-id="fe259-192">The following figure illustrates how the failover behavior of secondary replicas varies depending on the current primary replica, and whether it is configured for asynchronous-commit mode (with only forced failover) or synchronous-commit mode (with or without automatic failover).</span></span>  
  
 <span data-ttu-id="fe259-193">![Влияние конфигурации первичной реплики на отработку отказа](../../media/aoag-failoversetexample.gif "Влияние конфигурации первичной реплики на отработку отказа")</span><span class="sxs-lookup"><span data-stu-id="fe259-193">![How primary replica configuration affects failover](../../media/aoag-failoversetexample.gif "How primary replica configuration affects failover")</span></span>  
  
##  <a name="automatic-failover"></a><a name="AutomaticFailover"></a> <span data-ttu-id="fe259-194">Automatic Failover</span><span class="sxs-lookup"><span data-stu-id="fe259-194">Automatic Failover</span></span>  
 <span data-ttu-id="fe259-195">Автоматический переход на другой ресурс вызывает переключение подходящей вторичной реплики в первичную роль после того, как первичная реплика становится недоступной.</span><span class="sxs-lookup"><span data-stu-id="fe259-195">An automatic failover causes a qualified secondary replica to automatically transition to the primary role after the primary replica becomes unavailable.</span></span> <span data-ttu-id="fe259-196">Автоматический переход на другой ресурс наиболее полезен в случае, если узел WSFC, на котором размещена первичная реплика, является локальным для узла, на котором размещена вторичная реплика.</span><span class="sxs-lookup"><span data-stu-id="fe259-196">Automatic failover is best suited when the WSFC node that hosts the primary replica is local to the node that hosts the secondary replica.</span></span> <span data-ttu-id="fe259-197">Так происходит потому, что синхронизация данных лучше всего работает при малой задержке сообщений между компьютерами, а клиентские соединения могут оставаться локальными.</span><span class="sxs-lookup"><span data-stu-id="fe259-197">This is because data synchronization works best with low message latency between computers and because client connections can remain local.</span></span>  
  
  
###  <a name="conditions-required-for-an-automatic-failover"></a><a name="RequiredConditions"></a> <span data-ttu-id="fe259-198">Необходимые условия для автоматического перехода на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="fe259-198">Conditions Required for an Automatic Failover</span></span>  
 <span data-ttu-id="fe259-199">Автоматический переход на другой ресурс происходит только при следующих условиях.</span><span class="sxs-lookup"><span data-stu-id="fe259-199">Automatic failover occurs only under the following conditions:</span></span>  
  
-   <span data-ttu-id="fe259-200">Наличие набора автоматического перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="fe259-200">An automatic failover set exists.</span></span> <span data-ttu-id="fe259-201">Этот набор состоит из первичной реплики и вторичной реплики ( *цель автоматического перехода на другой ресурс*), причем на обеих настроен режим синхронной фиксации и обе реплики имеют режим перехода на другой ресурс AUTOMATIC.</span><span class="sxs-lookup"><span data-stu-id="fe259-201">This set consists of a primary replica and a secondary replica (the *automatic failover target*) that are both configured for synchronous-commit mode and set to AUTOMATIC failover.</span></span> <span data-ttu-id="fe259-202">HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6fe88e12-4df1-4025-ba24-7579635ccecf\\\HTM\\\html\\\29e0ac5d-eb58-4801-82b9-e278f08db920" Если для первичной реплики задан режим перехода на другой ресурс MANUAL, автоматический переход на другой ресурс не может быть выполнен, даже если на вторичной реплике задан режим перехода на другой ресурс AUTOMATIC.</span><span class="sxs-lookup"><span data-stu-id="fe259-202">HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6fe88e12-4df1-4025-ba24-7579635ccecf\\\HTM\\\html\\\29e0ac5d-eb58-4801-82b9-e278f08db920"  If the primary replica is set MANUAL failover, automatic failover cannot occur, even if a secondary replica is set to AUTOMATIC failover.</span></span>  
  
     <span data-ttu-id="fe259-203">Дополнительные сведения см. в разделе [Режимы доступности (группы доступности AlwaysOn)](availability-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-203">For more information, see [Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="fe259-204">Цель автоматического перехода на другой ресурс имеет нормальное состояние синхронизации (то есть все базы данных-получатели на цели отработки отказа синхронизированы с соответствующей базой данных-источником).</span><span class="sxs-lookup"><span data-stu-id="fe259-204">The automatic failover target has a healthy synchronization state (this indicates that every secondary database on the failover target is synchronized with its corresponding primary database).</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="fe259-205">Группы доступности AlwaysOn отслеживают состояние обеих реплик из набора автоматического перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="fe259-205">AlwaysOn Availability Groups monitors the health of both replicas in an automatic failover set.</span></span> <span data-ttu-id="fe259-206">В случае сбоя одной из реплик состоянию исправности группы доступности задается значение CRITICAL.</span><span class="sxs-lookup"><span data-stu-id="fe259-206">If either replica fails, the availability group's health state is set to CRITICAL.</span></span> <span data-ttu-id="fe259-207">В случае сбоя вторичной реплики выполнение автоматической отработки отказа невозможно, поскольку цель автоматического перехода на другой ресурс недоступна.</span><span class="sxs-lookup"><span data-stu-id="fe259-207">If the secondary replica fails, automatic failover is not possible because the automatic failover target is unavailable.</span></span> <span data-ttu-id="fe259-208">В случае сбоя первичной реплики группа доступности выполнит переход на вторичную реплику.</span><span class="sxs-lookup"><span data-stu-id="fe259-208">If the primary replica fails, the availability group will fail over to the secondary replica.</span></span> <span data-ttu-id="fe259-209">Цель автоматического перехода на другой ресурс будет отсутствовать, пока реплика, которая ранее была первичной, не вернется в режим «в сети».</span><span class="sxs-lookup"><span data-stu-id="fe259-209">Until the former primary replica comes online, no automatic failover target exists.</span></span> <span data-ttu-id="fe259-210">В любом случае для обеспечения доступности в случае последовательного сбоя (который маловероятен) рекомендуется в качестве цели автоматического перехода на другой ресурс задать другую вторичную реплику.</span><span class="sxs-lookup"><span data-stu-id="fe259-210">In either case, to ensure availability in the unlikely case of a sequential failure, we recommend that you configure a different secondary replica as the automatic failover target.</span></span>  
    >   
    >  <span data-ttu-id="fe259-211">Дополнительные сведения см. в статьях [Использование политик AlwaysOn для определения работоспособности группы доступности (SQL Server)](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md) и [Изменение режима отработки отказа для реплики доступности (SQL Server)](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-211">For more information, see [Use AlwaysOn Policies to View the Health of an Availability Group &#40;SQL Server&#41;](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md) and [Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
-   <span data-ttu-id="fe259-212">Кластер WSFC имеет кворум.</span><span class="sxs-lookup"><span data-stu-id="fe259-212">The Windows Server Failover Clustering (WSFC) cluster has quorum.</span></span> <span data-ttu-id="fe259-213">Дополнительные сведения см. в статье [Режимы кворума и конфигурация голосования WSFC (SQL Server)](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-213">For more information, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
-   <span data-ttu-id="fe259-214">Первичная реплика стала недоступной и уровни условий перехода на другой ресурс, заданные гибкой политикой отработки отказа, были удовлетворены.</span><span class="sxs-lookup"><span data-stu-id="fe259-214">The primary replica has become unavailable, and the failover-condition levels defined by your the flexible failover policy have been met.</span></span> <span data-ttu-id="fe259-215">Дополнительные сведения об уровнях условий перехода на другой ресурс см. в статье [Гибкая политика отработки отказа для автоматического перехода на другой ресурс группы доступности (SQL Server)](flexible-automatic-failover-policy-availability-group.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-215">For information about failover-condition levels, see [Flexible Failover Policy for Automatic Failover of an Availability Group &#40;SQL Server&#41;](flexible-automatic-failover-policy-availability-group.md).</span></span>  
  
###  <a name="how-automatic-failover-works"></a><a name="HowAutoFoWorks"></a> <span data-ttu-id="fe259-216">Принцип работы автоматической отработки отказа</span><span class="sxs-lookup"><span data-stu-id="fe259-216">How Automatic Failover Works</span></span>  
 <span data-ttu-id="fe259-217">Автоматический переход на другой ресурс включает в себя следующие действия.</span><span class="sxs-lookup"><span data-stu-id="fe259-217">An automatic failover initiates the following sequence of actions:</span></span>  
  
1.  <span data-ttu-id="fe259-218">Если экземпляр сервера, на котором размещена текущая первичная реплика, все еще работает, он изменяет состояние баз данных-источников на DISCONNECTED и отсоединяет всех клиентов.</span><span class="sxs-lookup"><span data-stu-id="fe259-218">If the server instance that is hosting the current primary replica is still running, it changes the state of the primary databases to DISCONNECTED and disconnects all clients.</span></span>  
  
2.  <span data-ttu-id="fe259-219">Если в очередях восстановления целевой вторичной реплики существуют ожидающие записи журнала, вторичная реплика применит оставшиеся записи журнала, чтобы завершить накат баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="fe259-219">If any log records are waiting in recovery queues on the target secondary replica, the secondary replica applies the remaining log records to finish rolling forward the secondary databases.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="fe259-220">Длительность применения журнала к заданной базе данных зависит от скорости системы, текущего уровня загрузки и количества записей журнала в очереди восстановления.</span><span class="sxs-lookup"><span data-stu-id="fe259-220">The amount of time required to apply the log to a given database depends on the speed of the system, the recent work load, and the amount of log in the recovery queue.</span></span>  
  
3.  <span data-ttu-id="fe259-221">Бывшая вторичная реплика переключается на первичную роль.</span><span class="sxs-lookup"><span data-stu-id="fe259-221">The former secondary replica transitions to the primary role.</span></span> <span data-ttu-id="fe259-222">Ее базы данных становятся базами данных-источниками.</span><span class="sxs-lookup"><span data-stu-id="fe259-222">Its databases become the primary databases.</span></span> <span data-ttu-id="fe259-223">Новая первичная реплика выполнит откат всех незафиксированных транзакций (этап отката восстановления) как можно скорее.</span><span class="sxs-lookup"><span data-stu-id="fe259-223">The new primary replica rolls back any uncommitted transactions (the undo phase of recovery) as quickly as possible.</span></span> <span data-ttu-id="fe259-224">Блокировки изолируют эти незафиксированные транзакции, позволяя выполнить откат в фоновом режиме, давая пользователям возможность работать с базой данных.</span><span class="sxs-lookup"><span data-stu-id="fe259-224">Locks isolate these uncommitted transactions, allowing roll back to occur in the background while clients use the database.</span></span> <span data-ttu-id="fe259-225">Этот процесс не выполняет откат каких-либо зафиксированных транзакций.</span><span class="sxs-lookup"><span data-stu-id="fe259-225">This process does not roll back any committed transactions.</span></span>  
  
     <span data-ttu-id="fe259-226">До момента подключения база данных-получатель временно помечается как NOT_SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="fe259-226">Until a given secondary database is connected, it is briefly marked as NOT_SYNCHRONIZED.</span></span> <span data-ttu-id="fe259-227">Перед началом восстановления с откатом базы данных-получатели могут подключаться к новым базам данных-источникам и быстро переходить в состояние SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="fe259-227">Before the rollback recovery starts, secondary databases can connect to the new primary databases and quickly transition to the SYNCHRONIZED state.</span></span> <span data-ttu-id="fe259-228">Как правило, лучшим вариантом является третья реплика синхронной фиксации, которая остается во вторичной роли после отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-228">The best case is usually for a third synchronous-commit replica that remains in the secondary role after the failover.</span></span>  
  
4.  <span data-ttu-id="fe259-229">Позднее, когда экземпляр сервера, на котором размещена бывшая первичная реплика, перезагрузится, он распознает, что первичная роль теперь принадлежит другой реплике доступности.</span><span class="sxs-lookup"><span data-stu-id="fe259-229">Later, when the server instance that is hosting the former primary replica restarts, it recognizes that another availability replica now owns the primary role.</span></span> <span data-ttu-id="fe259-230">Бывшая первичная реплика перейдет в роль вторичной, а ее базы данных станут базами данных-получателями.</span><span class="sxs-lookup"><span data-stu-id="fe259-230">The former primary replica transitions to the secondary role, and its databases become secondary databases.</span></span> <span data-ttu-id="fe259-231">Новая вторичная реплика как можно быстрее установит соединение с текущей первичной репликой и обновит свои базы данных до состояния текущих баз данных-источников.</span><span class="sxs-lookup"><span data-stu-id="fe259-231">The new secondary replica connects to the current primary replica and catches its database up to the current primary databases as quickly as possible.</span></span> <span data-ttu-id="fe259-232">Как только новая вторичная реплика выполнит повторную синхронизацию своих баз данных, отработка отказа снова станет возможной, но уже в обратном направлении.</span><span class="sxs-lookup"><span data-stu-id="fe259-232">As soon as the new secondary replica has resynchronized its databases, failover is again possible, in the reverse direction.</span></span>  
  
###  <a name="to-configure-automatic-failover"></a><a name="EnableAutoFo"></a> <span data-ttu-id="fe259-233">Настройка автоматического перехода на другой ресурс</span><span class="sxs-lookup"><span data-stu-id="fe259-233">To Configure Automatic Failover</span></span>  
 <span data-ttu-id="fe259-234">Реплика доступности в любой момент может быть настроена на поддержку автоматического перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="fe259-234">An availability replica can be configured to support automatic failover at any point.</span></span>  
  
 <span data-ttu-id="fe259-235">**To configure automatic failover**</span><span class="sxs-lookup"><span data-stu-id="fe259-235">**To configure automatic failover**</span></span>  
  
1.  <span data-ttu-id="fe259-236">Убедитесь, что вторичная реплика настроена на использование режима доступности синхронной фиксации.</span><span class="sxs-lookup"><span data-stu-id="fe259-236">Ensure that the secondary replica is configured to use the synchronous-commit availability mode.</span></span> <span data-ttu-id="fe259-237">Дополнительные сведения см. в разделе [Смена режима доступности для реплики доступности (SQL Server)](change-the-availability-mode-of-an-availability-replica-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-237">For more information, see [Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;](change-the-availability-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="fe259-238">Задайте автоматический режим перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="fe259-238">Set the failover mode to automatic.</span></span> <span data-ttu-id="fe259-239">Дополнительные сведения см. в разделе [Смена режима отработки отказа для реплики доступности (SQL Server)](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-239">For more information, see [Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;](change-the-failover-mode-of-an-availability-replica-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="fe259-240">Также можно изменить политику гибкой отработки отказа в группе доступности и указать типы сбоев, которые вызывают автоматический переход на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="fe259-240">Optionally, change the flexible failover policy of the availability group to specify the sorts of failures that can cause an automatic failover to occur.</span></span> <span data-ttu-id="fe259-241">Дополнительные сведения см. в статьях [Настройка гибкой политики отработки отказа для элемента управления для автоматического перехода на другой ресурс (группы доступности AlwaysOn)](configure-flexible-automatic-failover-policy.md) "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6a8d98a9-6e6a-40d1-9809-efa9013d7452\\\HTM\\\html\\\1ed564b4-9835-4245-ae35-9ba67419a4ce" и [Политика отработки отказа для экземпляров отказоустойчивого кластера](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-241">For more information, see [Configure the Flexible Failover Policy to Control Conditions for Automatic Failover &#40;AlwaysOn Availability Groups&#41;](configure-flexible-automatic-failover-policy.md) HYPERLINK "file:///C:\\\Users\\\marshow\\\AppData\\\Local\\\Temp\\\DxEditor\\\DduePreview\\\Default\\\6a8d98a9-6e6a-40d1-9809-efa9013d7452\\\HTM\\\html\\\1ed564b4-9835-4245-ae35-9ba67419a4ce"  and [Failover Policy for Failover Cluster Instances](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md).</span></span>  
  
##  <a name="planned-manual-failover-without-data-loss"></a><a name="ManualFailover"></a> <span data-ttu-id="fe259-242">Запланированный переход на другой ресурс вручную (без потери данных)</span><span class="sxs-lookup"><span data-stu-id="fe259-242">Planned Manual Failover (Without Data Loss)</span></span>  
 <span data-ttu-id="fe259-243">При использовании перехода на другой ресурс вручную, вторичная реплика принимает первичную роль после того, как администратор базы данных отдает команду перехода на другой ресурс вручную для экземпляра сервера, на котором размещена целевая вторичная реплика.</span><span class="sxs-lookup"><span data-stu-id="fe259-243">A manual failover causes a synchronized secondary replica to transition to the primary role after a database administrator issues a manual-failover command on the server instance that hosts the target secondary replica.</span></span> <span data-ttu-id="fe259-244">Для поддержки перехода на другой ресурс вручную во вторичной реплике и текущей первичной реплике должен быть настроен режим синхронной фиксации.</span><span class="sxs-lookup"><span data-stu-id="fe259-244">To support manual failover, the secondary replica and the current primary replica must both be configured for synchronous-commit mode, if any.</span></span> <span data-ttu-id="fe259-245">Все базы данных-получатели на реплике доступности должны быть соединены с группой доступности и синхронизированы с ее соответствующими базами данных-источниками (то есть вторичная реплика должна быть синхронизирована).</span><span class="sxs-lookup"><span data-stu-id="fe259-245">Every secondary database on the availability replica must be joined to the availability group and synchronized with its corresponding primary database (that is, the secondary replica must be synchronized).</span></span> <span data-ttu-id="fe259-246">Это гарантирует, что все транзакции, зафиксированные в бывшей базе данных-источнике, также будут зафиксированы в новой базе данных-источнике.</span><span class="sxs-lookup"><span data-stu-id="fe259-246">This guarantees that every transaction that was committed on a former primary database has also been committed on the new primary database.</span></span> <span data-ttu-id="fe259-247">По этой причине новые базы данных-источники будут идентичны старым базам данных-источникам.</span><span class="sxs-lookup"><span data-stu-id="fe259-247">Therefore, the new primary databases are identical to the old primary databases.</span></span>  
  
 <span data-ttu-id="fe259-248">На следующем рисунке показаны этапы запланированной отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-248">The following figure illustrates the stages of a planned failover:</span></span>  
  
1.  <span data-ttu-id="fe259-249">Перед отработкой отказа первичная реплика размещается на экземпляре сервера на узле `Node01`.</span><span class="sxs-lookup"><span data-stu-id="fe259-249">Before the failover, the primary replica is hosted by the server instance on `Node01`.</span></span>  
  
2.  <span data-ttu-id="fe259-250">Администратор базы данных запускает запланированный переход на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="fe259-250">A database administrator initiates a planned failover.</span></span> <span data-ttu-id="fe259-251">Целью является реплика доступности, размещаемая в экземпляре сервера в узле `Node02`.</span><span class="sxs-lookup"><span data-stu-id="fe259-251">The failover target is the availability replica hosted by the server instance on `Node02`.</span></span>  
  
3.  <span data-ttu-id="fe259-252">Цель перехода на другой ресурс (в узле `Node02`) становится новой первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-252">The failover target (on `Node02`) becomes the new primary replica.</span></span> <span data-ttu-id="fe259-253">Поскольку это запланированный переход на другой ресурс, бывшая первичная реплика принимает вторичную роль и немедленно переводит свои базы данных в режим «в сети» в качестве баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="fe259-253">Because this is a planned failover, the former primary replica switches to the secondary role during the failover and brings its databases online as secondary databases immediately.</span></span>  
  
 <span data-ttu-id="fe259-254">![Демонстрация запланированного перехода на другой ресурс вручную](../../media/aoag-plannedmanualfailover.gif "Демонстрация запланированного перехода на другой ресурс вручную")</span><span class="sxs-lookup"><span data-stu-id="fe259-254">![Illustation of a planned manual failover](../../media/aoag-plannedmanualfailover.gif "Illustation of a planned manual failover")</span></span>  
  
  
###  <a name="conditions-required-for-a-manual-failover"></a><a name="ManualFailoverConditions"></a> <span data-ttu-id="fe259-255">Условия для отработки отказа вручную</span><span class="sxs-lookup"><span data-stu-id="fe259-255">Conditions Required for a Manual Failover</span></span>  
 <span data-ttu-id="fe259-256">Для обеспечения поддержки перехода на другой ресурс вручную текущая первичная реплика должна быть настроена на режим синхронной фиксации. Кроме того, вторичная реплика должна удовлетворять следующим условиям.</span><span class="sxs-lookup"><span data-stu-id="fe259-256">To support a manual failover, the current primary replica must be set to synchronous-commit mode and a secondary replica must be:</span></span>  
  
-   <span data-ttu-id="fe259-257">Она должна быть настроена на работу в режиме синхронной фиксации.</span><span class="sxs-lookup"><span data-stu-id="fe259-257">Configured for synchronous-commit mode.</span></span>  
  
-   <span data-ttu-id="fe259-258">В данный момент она должна быть синхронизирована с первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-258">Currently synchronized with the primary replica.</span></span>  
  
 <span data-ttu-id="fe259-259">Чтобы вручную перевести группу доступности на другой ресурс, нужно подключиться ко вторичной реплике, которую планируется сделать первичной.</span><span class="sxs-lookup"><span data-stu-id="fe259-259">To manually fail over an availability group, you must be connected to the secondary replica that is to become the new primary replica.</span></span>  
  
###  <a name="how-a-planned-manual-failover-works"></a><a name="ManualFailoverHowWorks"></a> <span data-ttu-id="fe259-260">Как работает запланированный переход на другой ресурс вручную</span><span class="sxs-lookup"><span data-stu-id="fe259-260">How a Planned Manual Failover Works</span></span>  
 <span data-ttu-id="fe259-261">Запланированный переход на другой ресурс вручную, который должен инициироваться на целевой вторичной реплике, вызывает следующую последовательность действий.</span><span class="sxs-lookup"><span data-stu-id="fe259-261">A planned manual failover, which must be initiated on the target secondary replica, initiates the following sequence of actions:</span></span>  
  
1.  <span data-ttu-id="fe259-262">Чтобы не допустить выполнения новых пользовательских транзакций в исходных базах данных-источниках, кластер WSFC отправляет запрос на перевод первичной реплики в режим «вне сети».</span><span class="sxs-lookup"><span data-stu-id="fe259-262">To ensure that no new user transactions occur on the original primary databases, the WSFC cluster sends a request to the primary replica to go offline.</span></span>  
  
2.  <span data-ttu-id="fe259-263">Если в очереди восстановления любой базы данных-получателя присутствуют какие либо журналы, вторичная реплика закончит накат для этой базы данных-получателя.</span><span class="sxs-lookup"><span data-stu-id="fe259-263">If any log is waiting in the recovery queue of any secondary database, the secondary replica finishes rolling forward that secondary database.</span></span> <span data-ttu-id="fe259-264">Длительность выполнения зависит от скорости системы, текущей рабочей нагрузки и количества записей журнала в очереди восстановления.</span><span class="sxs-lookup"><span data-stu-id="fe259-264">The amount of time required depends on the speed of the system, the recent workload, and the amount of log in the recovery queue.</span></span> <span data-ttu-id="fe259-265">Для определения текущего размера очереди восстановления используйте счетчик производительности **Recovery Queue** .</span><span class="sxs-lookup"><span data-stu-id="fe259-265">To learn the current size of the recovery queue, use the **Recovery Queue** performance counter.</span></span> <span data-ttu-id="fe259-266">Дополнительные сведения см. в статье [SQL Server, реплика базы данных](../../../relational-databases/performance-monitor/sql-server-database-replica.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-266">For more information, see [SQL Server, Database Replica](../../../relational-databases/performance-monitor/sql-server-database-replica.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="fe259-267">Время отработки отказа можно регулировать путем ограничения размера очереди восстановления.</span><span class="sxs-lookup"><span data-stu-id="fe259-267">The failover time can be regulated by limiting the size of the recovery queue.</span></span> <span data-ttu-id="fe259-268">Однако это может привести к замедлению работы первичной реплики, чтобы дать возможность вторичной реплике не отставать.</span><span class="sxs-lookup"><span data-stu-id="fe259-268">However, this can cause the primary replica to slow down to allow the secondary replica to keep up.</span></span>  
  
3.  <span data-ttu-id="fe259-269">Вторичная реплика становится новой первичной репликой, а бывшая первичная реплика становится вторичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-269">The secondary replica becomes the new primary replica, and the former primary replica becomes the new secondary replica.</span></span>  
  
4.  <span data-ttu-id="fe259-270">Новая первичная реплика выполняет откат всех незафиксированных транзакций и переводит свои базы данных в режим «в сети» в качестве баз данных-источников. Все базы данных-получатели кратковременно помечаются состоянием NOT SYNCHRONIZED до момента их подключения и повторной синхронизации с новыми базами данных-источниками.</span><span class="sxs-lookup"><span data-stu-id="fe259-270">The new primary replica rolls back any uncommitted transactions and brings its databases online as the primary databases.All secondary databases are briefly marked as NOT SYNCHRONIZED until they connect and resynchronize to the new primary databases.</span></span> <span data-ttu-id="fe259-271">Этот процесс не выполняет откат каких-либо зафиксированных транзакций.</span><span class="sxs-lookup"><span data-stu-id="fe259-271">This process does not roll back any committed transactions.</span></span>  
  
5.  <span data-ttu-id="fe259-272">Когда бывшая первичная реплика перейдет в режим «в сети», она примет вторичную роль, а бывшая база данных-источник станет базой данных-получателем.</span><span class="sxs-lookup"><span data-stu-id="fe259-272">When the former primary replica comes back online, it takes on the secondary role, and the former primary database becomes the secondary database.</span></span> <span data-ttu-id="fe259-273">Новая вторичная реплика быстро выполнит повторную синхронизацию новых баз данных-получателей с соответствующими базами данных-источниками.</span><span class="sxs-lookup"><span data-stu-id="fe259-273">The new secondary replica quickly resynchronizes the new secondary databases with the corresponding primary databases.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="fe259-274">Как только новая вторичная реплика выполнит повторную синхронизацию баз данных, отработка отказа снова станет возможной, но уже в обратном направлении.</span><span class="sxs-lookup"><span data-stu-id="fe259-274">As soon as the new secondary replica has resynchronized the databases, failover is again possible, but in the reverse direction.</span></span>  
  
 <span data-ttu-id="fe259-275">После отработки отказа клиенты должны повторно подключиться к текущей базе данных-источнику.</span><span class="sxs-lookup"><span data-stu-id="fe259-275">After failover, clients must reconnect to the current primary database.</span></span> <span data-ttu-id="fe259-276">Дополнительные сведения см. в разделе [Прослушиватели групп доступности, возможность подключения клиентов и отработка отказа приложений (SQL Server)](../../listeners-client-connectivity-application-failover.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-276">For more information, see [Availability Group Listeners, Client Connectivity, and Application Failover &#40;SQL Server&#41;](../../listeners-client-connectivity-application-failover.md).</span></span>  
  
###  <a name="maintaining-availability-during-upgrades"></a><a name="ManualFailoverDuringUpgrades"></a> <span data-ttu-id="fe259-277">Поддержка уровня доступности при обновлениях</span><span class="sxs-lookup"><span data-stu-id="fe259-277">Maintaining Availability During Upgrades</span></span>  
 <span data-ttu-id="fe259-278">Администратор базы данных групп доступности может использовать переходы на другой ресурс вручную для поддержки доступности баз данных при обновлении программного обеспечения или оборудования.</span><span class="sxs-lookup"><span data-stu-id="fe259-278">The database administrator for your availability groups can use manual failovers to maintain database availability when you upgrade hardware or software.</span></span> <span data-ttu-id="fe259-279">Для использования группы доступности для выполнения программных обновлений экземпляр сервера или узел компьютера, на котором размещена целевая вторичная реплика, должен уже иметь соответствующие обновления.</span><span class="sxs-lookup"><span data-stu-id="fe259-279">To use an availability group for software upgrades, the server instance and/or computer node that hosts the target secondary replica must have already received the upgrades.</span></span> <span data-ttu-id="fe259-280">Дополнительные сведения см. в статье [Upgrade and Update of Availability Group Servers with Minimal Downtime and Data Loss](upgrading-always-on-availability-group-replica-instances.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-280">For more information, see [Upgrade and Update of Availability Group Servers with Minimal Downtime and Data Loss](upgrading-always-on-availability-group-replica-instances.md).</span></span>  
  
##  <a name="forced-failover-with-possible-data-loss"></a><a name="ForcedFailover"></a> <span data-ttu-id="fe259-281">Принудительная отработка отказа (с возможной потерей данных)</span><span class="sxs-lookup"><span data-stu-id="fe259-281">Forced Failover (with Possible Data Loss)</span></span>  
 <span data-ttu-id="fe259-282">Принудительный переход на другой ресурс группы доступности (с возможной потерей данных) — метод аварийного восстановления, позволяющий использовать вторичную реплику в качестве резервного сервера. Поскольку принудительный переход на другой ресурс может привести к потере данных, его следует использовать осторожно и только в случае необходимости.</span><span class="sxs-lookup"><span data-stu-id="fe259-282">Forcing failover of an availability group (with possible data loss) is a disaster recovery method that allows you to use a secondary replica as a warm standby server.Because forcing failover risks possible data loss, it should be used cautiously and sparingly.</span></span> <span data-ttu-id="fe259-283">Принудительную отработку отказа рекомендуется применять только когда требуется немедленное восстановление доступа к базам данных доступности и допускается риск потери данных.</span><span class="sxs-lookup"><span data-stu-id="fe259-283">We recommend forcing failover only if you must restore service to your availability databases immediately and are willing to risk losing data.</span></span> <span data-ttu-id="fe259-284">Дополнительные сведения о требованиях и рекомендациях для принудительной отработки отказа, а также пример использования принудительного перехода на другой ресурс для восстановления из ситуации критического сбоя см. в статье [Выполнение принудительного перехода на другой ресурс вручную для группы доступности (SQL Server)](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-284">For more information about the prerequisites and recommendations for forcing failover and for an example scenario that uses a forced failover to recover from a catastrophic failure, see [Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="fe259-285">Для принудительной отработки отказа необходим кворум в кластере WSFC.</span><span class="sxs-lookup"><span data-stu-id="fe259-285">Forcing failover requires that the WSFC cluster have quorum.</span></span> <span data-ttu-id="fe259-286">Дополнительные сведения о настройке кворума и принудительном создании кворума см. в статье [Отказоустойчивая кластеризация Windows Server (WSFC) с SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-286">For information about configuring quorum and forcing quorum, see [Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span></span>  
  
  
###  <a name="how-forced-failover-works"></a><a name="ForcedFailoverHowWorks"></a> <span data-ttu-id="fe259-287">Принципы работы принудительной отработки отказа</span><span class="sxs-lookup"><span data-stu-id="fe259-287">How Forced Failover Works</span></span>  
 <span data-ttu-id="fe259-288">Принудительная отработка отказа инициирует переход первичной роли целевой реплике, роль которой находится в состоянии SECONDARY или RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="fe259-288">Forcing failover initiates a transition of the primary role to a target replica whose role is in the SECONDARY or RESOLVING state.</span></span> <span data-ttu-id="fe259-289">Цель отработки отказа становится новой первичной репликой и немедленно доставляет свои копии баз данных клиентам.</span><span class="sxs-lookup"><span data-stu-id="fe259-289">The failover target becomes the new primary replica and immediately serves its copies of the databases to clients.</span></span> <span data-ttu-id="fe259-290">Если бывшая первичная реплика станет доступной, она переключится в роль вторичной; ее базы данных станут базами данных-получателями.</span><span class="sxs-lookup"><span data-stu-id="fe259-290">When the former primary replica becomes available, it will transition to the secondary role and its databases will become secondary databases.</span></span>  
  
 <span data-ttu-id="fe259-291">Все базы данных-получатели (включая бывшие базы данных-источники, когда они станут доступны) приостановлены.</span><span class="sxs-lookup"><span data-stu-id="fe259-291">All secondary databases (including the former primary databases, when they become available) are SUSPENDED.</span></span> <span data-ttu-id="fe259-292">В зависимости от предыдущего состояния синхронизации данных в приостановленной базе данных-получателе, возможно, из нее не удастся извлечь отсутствующие зафиксированные данные этой базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="fe259-292">Depending on the previous data synchronization state of a suspended secondary database, it might be suitable for salvaging missing committed data for that primary database.</span></span> <span data-ttu-id="fe259-293">Во вторичной реплике, настроенной на доступ только для чтения, можно выполнять запросы к базам данных-получателям для извлечения отсутствующих данных вручную.</span><span class="sxs-lookup"><span data-stu-id="fe259-293">On a secondary replica that is configured for read-only access, you can query the secondary databases to manually discover missing data.</span></span> <span data-ttu-id="fe259-294">Затем можно выполнить инструкции [!INCLUDE[tsql](../../../includes/tsql-md.md)] в новых базах данных-источниках для внесения необходимых изменений.</span><span class="sxs-lookup"><span data-stu-id="fe259-294">Then you can issue [!INCLUDE[tsql](../../../includes/tsql-md.md)] statements on the new primary databases to make any necessary changes.</span></span>  
  
###  <a name="risks-of-forcing-failover"></a><a name="ForcedFailoverRisks"></a> <span data-ttu-id="fe259-295">Риск использования принудительной отработки отказа</span><span class="sxs-lookup"><span data-stu-id="fe259-295">Risks of Forcing Failover</span></span>  
 <span data-ttu-id="fe259-296">Важно понимать, что принудительная отработка отказа может привести к потере данных.</span><span class="sxs-lookup"><span data-stu-id="fe259-296">It is essential to understand that forcing failover can cause data loss.</span></span> <span data-ttu-id="fe259-297">Возможность потери данных обусловлена тем, что целевая реплика не может взаимодействовать с первичной, поэтому не может гарантировать синхронизацию баз данных.</span><span class="sxs-lookup"><span data-stu-id="fe259-297">Data loss is possible because the target replica cannot communicate with the primary replica and, therefore, cannot guarantee that the databases are synchronized.</span></span> <span data-ttu-id="fe259-298">Кроме того, принудительная отработка отказа создает новую вилку восстановления.</span><span class="sxs-lookup"><span data-stu-id="fe259-298">Forcing failover starts a new recovery fork.</span></span> <span data-ttu-id="fe259-299">Поскольку исходные базы данных-источники и базы данных-получатели находятся на разных вилках восстановления, каждая из них содержит данные, отсутствующие в других. Каждая исходная база данных-источник содержит изменения, которые еще не были отправлены из ее очереди отправки в бывшую базу данных-получатель (неотправленный журнал); бывшие базы данных-получатели содержат изменения, внесенные после принудительного перехода на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="fe259-299">Because the original primary databases and secondary databases are on different recovery forks, each of them now contains data that the other database does not contain: each original primary database contains whatever changes were not yet sent from its send queue to the former secondary database (the unsent log); the former secondary databases contain whatever changes occur after failover was forced.</span></span>  
  
 <span data-ttu-id="fe259-300">Если принудительная отработка отказа выполняется из-за выхода из строя первичной реплики, вероятность потери данных зависит от того, были ли журналы транзакций отправлены вторичной реплике перед сбоем.</span><span class="sxs-lookup"><span data-stu-id="fe259-300">If failover is forced because the primary replica has failed, potential data loss is depends on whether any transaction logs had not been sent to the secondary replica before the failure.</span></span> <span data-ttu-id="fe259-301">В режиме асинхронной фиксации всегда возможно накопление журнала неотправленных изменений.</span><span class="sxs-lookup"><span data-stu-id="fe259-301">Under the asynchronous-commit mode, accumulated unsent log is always a possibility.</span></span> <span data-ttu-id="fe259-302">В режиме синхронной фиксации это возможно только до момента, пока база данных-получатель синхронизована.</span><span class="sxs-lookup"><span data-stu-id="fe259-302">Under synchronous-commit mode, this is possible only until the secondary databases becomes synchronized.</span></span>  
  
 <span data-ttu-id="fe259-303">В следующей таблице приведена сводка возможных ситуаций потери данных в конкретной базе данных в реплике, на которую выполняется принудительная отработка отказа.</span><span class="sxs-lookup"><span data-stu-id="fe259-303">The following table summarizes the possibility of data loss for a particular database on the replica to which you force failover.</span></span>  
  
|<span data-ttu-id="fe259-304">Режим доступности вторичной реплики</span><span class="sxs-lookup"><span data-stu-id="fe259-304">Availability mode of Secondary Replica</span></span>|<span data-ttu-id="fe259-305">База данных синхронизирована?</span><span class="sxs-lookup"><span data-stu-id="fe259-305">Is database synchronized?</span></span>|<span data-ttu-id="fe259-306">Потеря данных возможна?</span><span class="sxs-lookup"><span data-stu-id="fe259-306">Is data loss possible?</span></span>|  
|--------------------------------------------|-------------------------------|----------------------------|  
|<span data-ttu-id="fe259-307">Синхронная фиксация</span><span class="sxs-lookup"><span data-stu-id="fe259-307">Synchronous-commit</span></span>|<span data-ttu-id="fe259-308">Да</span><span class="sxs-lookup"><span data-stu-id="fe259-308">Yes</span></span>|<span data-ttu-id="fe259-309">Нет</span><span class="sxs-lookup"><span data-stu-id="fe259-309">No</span></span>|  
|<span data-ttu-id="fe259-310">Синхронная фиксация</span><span class="sxs-lookup"><span data-stu-id="fe259-310">Synchronous-commit</span></span>|<span data-ttu-id="fe259-311">Нет</span><span class="sxs-lookup"><span data-stu-id="fe259-311">No</span></span>|<span data-ttu-id="fe259-312">Да</span><span class="sxs-lookup"><span data-stu-id="fe259-312">Yes</span></span>|  
|<span data-ttu-id="fe259-313">Асинхронная фиксация</span><span class="sxs-lookup"><span data-stu-id="fe259-313">Asynchronous-commit</span></span>|<span data-ttu-id="fe259-314">Нет</span><span class="sxs-lookup"><span data-stu-id="fe259-314">No</span></span>|<span data-ttu-id="fe259-315">Да</span><span class="sxs-lookup"><span data-stu-id="fe259-315">Yes</span></span>|  
||||  
  
 <span data-ttu-id="fe259-316">Базы данных-получатели отслеживают только две вилки восстановления, поэтому, если выполнить несколько принудительных переходов на другой ресурс, любая база данных-получатель, которая начала синхронизацию данных после предыдущей принудительной отработки отказа, не сможет продолжить работу.</span><span class="sxs-lookup"><span data-stu-id="fe259-316">Secondary databases track only two recovery forks, so if you perform multiple forced failovers, any secondary database that did start data synchronization with the previous force failover might not be able to resume.</span></span> <span data-ttu-id="fe259-317">Если это происходит, все базы данных-получатели, возобновить работу которых не удастся, потребуется удалить из группы доступности, восстановить на нужный момент времени и повторно присоединить к группе доступности.</span><span class="sxs-lookup"><span data-stu-id="fe259-317">If this occurs, any secondary databases that cannot be resumed will need to be removed from the availability group, restored to the correct point in time, and rejoined to the availability group.</span></span> <span data-ttu-id="fe259-318">Восстановление не работает по нескольким вилкам, поэтому после выполнения дополнительных принудительных отработок отказа необходимо создать резервную копию журнала.</span><span class="sxs-lookup"><span data-stu-id="fe259-318">A restore will not work across multiple recovery forks, therefore, be sure to perform a log backup after performing more than one forced failover.</span></span>  
  
###  <a name="why-forced-failover-is-required-after-forcing-quorum"></a><a name="WhyFFoPostForcedQuorum"></a> <span data-ttu-id="fe259-319">Почему принудительная отработка отказа требуется после принудительного создания кворума</span><span class="sxs-lookup"><span data-stu-id="fe259-319">Why Forced Failover is Required After Forcing Quorum</span></span>  
 <span data-ttu-id="fe259-320">После принудительного создания кворума в кластере WSFC (*принудительный кворум*) необходимо выполнить принудительную отработку отказа (с возможной потерей данных) для каждой группы доступности.</span><span class="sxs-lookup"><span data-stu-id="fe259-320">After quorum is forced on the WSFC cluster (*forced quorum*) you need to perform a forced failover (with possible data loss) on each availability group.</span></span> <span data-ttu-id="fe259-321">Принудительная отработка отказа необходима, поскольку реальное состояние значений кластера WSFC могло быть потеряно.</span><span class="sxs-lookup"><span data-stu-id="fe259-321">The forced failover is required because the real state of the WSFC cluster values might have been lost.</span></span> <span data-ttu-id="fe259-322">Предотвращение нормальных отработок отказа после принудительного создания кворума необходимо из-за возможности того, что несинхронизированная вторичная реплика будет выглядеть синхронизированной на вновь скомпонованном кластере WSFC.</span><span class="sxs-lookup"><span data-stu-id="fe259-322">Preventing normal failovers after a forced quorum is required because of the possibility than an unsynchronized secondary replica would appear to be synchronized on the reconfigured WSFC cluster.</span></span>  
  
 <span data-ttu-id="fe259-323">Например, рассмотрим кластер WSFC с размещенной на трех узлах группой доступности.  Первичная реплика находится на узле A, a на каждом из узлов B и C размещается вторичная реплика.</span><span class="sxs-lookup"><span data-stu-id="fe259-323">For example, consider a WSFC cluster that hosts an availability group on three nodes:  Node A hosts the primary replica and Node B and Node C each hosts a secondary replica.</span></span> <span data-ttu-id="fe259-324">Узел C отключается от кластера WSFC, пока локальная вторичная реплика находится в состоянии SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="fe259-324">Node C gets disconnected from the WSFC cluster while the local secondary replica is SYNCHRONIZED.</span></span>  <span data-ttu-id="fe259-325">Однако узел A и узел B сохраняют работоспособный кворум, а группа доступности остается подключенной к сети.</span><span class="sxs-lookup"><span data-stu-id="fe259-325">But Node A and Node B retain a healthy quorum and the availability group remains online.</span></span> <span data-ttu-id="fe259-326">На узле A первичная реплика по-прежнему принимает обновления, а на узле B вторичная реплика продолжает синхронизироваться с первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-326">On Node A, the primary replica continues to accept updates, and on Node B, the secondary replica continues to synchronize with the primary replica.</span></span> <span data-ttu-id="fe259-327">На узле C вторичная реплика становится несинхронизированной и все больше отстает от первичной реплики.</span><span class="sxs-lookup"><span data-stu-id="fe259-327">The secondary replica on Node C becomes unsynchronized and falls increasingly behind the primary replica.</span></span> <span data-ttu-id="fe259-328">Однако, поскольку узел C отключен от сети, реплика остается (неправильно) в состоянии SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="fe259-328">However, because Node C is disconnected, the replica remains, incorrectly, in the SYNCHRONIZED state.</span></span>  
  
 <span data-ttu-id="fe259-329">Если кворум будет потерян, а затем принудительно создан на узле A, состояние синхронизации группы доступности в кластере WSFC должно быть правильным: вторичная реплика на узле С должна быть показана как несинхронизированная (UNSYNCHRONIZED).</span><span class="sxs-lookup"><span data-stu-id="fe259-329">If quorum is lost and is then forced on Node A, the synchronization state of the availability group on the WSFC cluster should be correct-with the secondary replica on Node C shown as UNSYNCHRONIZED.</span></span> <span data-ttu-id="fe259-330">Однако, если кворум принудительно создан на узле C, синхронизация группы доступности будет неверной.</span><span class="sxs-lookup"><span data-stu-id="fe259-330">However, if quorum is forced on Node C, the synchronization of the availability group will be incorrect.</span></span> <span data-ttu-id="fe259-331">Синхронизация на кластере вернется к состоянию, существовавшему в то время, когда узел C был отключен — вторичная реплика на узле C будет *неправильно* показана как синхронизированная (SYNCHRONIZED).</span><span class="sxs-lookup"><span data-stu-id="fe259-331">The synchronization state on the cluster will have reverted back to when Node C was disconnected-with the secondary replica on Node C *incorrectly* shown as SYNCHRONIZED.</span></span> <span data-ttu-id="fe259-332">Поскольку запланированные отработки отказа вручную гарантируют безопасность данных, им запрещено возвращать группу доступности в сеть после принудительного создания кворума.</span><span class="sxs-lookup"><span data-stu-id="fe259-332">Since planned manual failovers guarantee the safety of the data, they are disallowed for bring an availability group back online after quorum is forced.</span></span>  
  
###  <a name="tracking-potential-data-loss"></a><a name="TrackPotentialDataLoss"></a> <span data-ttu-id="fe259-333">Отслеживание возможной потери данных</span><span class="sxs-lookup"><span data-stu-id="fe259-333">Tracking Potential Data Loss</span></span>  
 <span data-ttu-id="fe259-334">Если кластер WSFC имеет работоспособный кворум, можно оценить текущую вероятность потери данных в базах данных.</span><span class="sxs-lookup"><span data-stu-id="fe259-334">When the WSFC cluster has a healthy quorum, you can estimate the current potential for data loss on databases.</span></span> <span data-ttu-id="fe259-335">Для данной вторичной реплики текущая вероятность потери данных зависит от того, насколько сильно локальные базы данных-получатели отстают от соответствующих баз данных-источников.</span><span class="sxs-lookup"><span data-stu-id="fe259-335">For a given secondary replica, the current potential for data loss depends on how far the local secondary databases are lagging behind the corresponding primary databases.</span></span> <span data-ttu-id="fe259-336">Так как величина запаздывания изменяется со временем, рекомендуется периодически отслеживать потенциальные потери данных для несинхронизированных баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="fe259-336">Because the amount of lag varies over time, we recommend that you periodically track potential data loss for your unsynchronized secondary databases.</span></span> <span data-ttu-id="fe259-337">Журнал отслеживания обеспечивает сравнение номера LSN последней фиксации и времени последней фиксации для каждой базы данных-источника и ее баз данных-получателей следующим образом.</span><span class="sxs-lookup"><span data-stu-id="fe259-337">Tracking lag involves comparing the Last Commit LSN and Last Commit Time for each primary database and its secondary databases, as follows:</span></span>  
  
1.  <span data-ttu-id="fe259-338">Подключитесь к первичной реплике.</span><span class="sxs-lookup"><span data-stu-id="fe259-338">Connect to the primary replica.</span></span>  
  
2.  <span data-ttu-id="fe259-339">Запрос `last_commit_lsn` (номер LSN последней зафиксированной транзакции) и `last_commit_time` (время последнего фиксации) столбцов динамического административного представления [sys. dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="fe259-339">Query the `last_commit_lsn` (LSN of the last committed transaction) and `last_commit_time` (time of the last commit) columns of the [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) dynamic management view.</span></span>  
  
3.  <span data-ttu-id="fe259-340">Сравните значения, возвращаемые для каждой базы данных-источника и каждой из ее баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="fe259-340">Compare the values returned for each primary database and each of its secondary databases.</span></span> <span data-ttu-id="fe259-341">Различие между их номерами LSN последней фиксации указывает величину отставания.</span><span class="sxs-lookup"><span data-stu-id="fe259-341">The difference between their Last Commit LSNs indicate the amount of lag.</span></span>  
  
4.  <span data-ttu-id="fe259-342">Можно инициировать предупреждение, если величина отставания для базы данных или набора баз данных превышает заданное максимальное отставание за определенный период времени.</span><span class="sxs-lookup"><span data-stu-id="fe259-342">You can trigger an alert when the amount of lag on a database or set of databases exceeds your desired maximum lag for a given period of time.</span></span> <span data-ttu-id="fe259-343">Например, запрос может быть инициирован заданием, которое выполняется каждую минуту на каждой базе данных-источнике.</span><span class="sxs-lookup"><span data-stu-id="fe259-343">For example, the query can be run by a job that executes every minute on each primary database.</span></span> <span data-ttu-id="fe259-344">Если различие между `last_commit_time` базы данных-источника и любой из ее баз данных-получателей превышает целевую точку восстановления (RPO) (например, 5 минут) с момента последнего выполнения задания, задание может инициировать предупреждение.</span><span class="sxs-lookup"><span data-stu-id="fe259-344">If the difference between the `last_commit_time` of a primary database and any of its secondary databases has exceeded the recovery point objective (RPO) (for example, 5 minutes) since the last time the job executed, the job can raise an alert.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="fe259-345">Если кластер WSFC не имеет кворума или кворум был создан принудительно, `last_commit_lsn` и `last_commit_time` равны NULL.</span><span class="sxs-lookup"><span data-stu-id="fe259-345">When the WSFC cluster lacks quorum or quorum has been forced, `last_commit_lsn` and `last_commit_time` are NULL.</span></span> <span data-ttu-id="fe259-346">Дополнительные сведения о том, как избежать потери данных после принудительного создания кворума, см. в подразделе "Потенциальные методы избежания потери данных после принудительного создания кворума" в статье [Выполнение принудительного перехода на другой ресурс вручную для группы доступности (SQL Server)](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="fe259-346">For information about how you might be able to avoid data loss after you forced quorum, see "Potential Ways to Avoid Data Loss After Quorum is Forced" in [Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).</span></span>  
  
###  <a name="managing-the-potential-data-loss"></a><a name="ForcedFailoverManagingDataLoss"></a> <span data-ttu-id="fe259-347">Управление возможной потерей данных</span><span class="sxs-lookup"><span data-stu-id="fe259-347">Managing the Potential Data Loss</span></span>  
 <span data-ttu-id="fe259-348">После принудительной отработки отказа все базы данных-получатели приостанавливаются.</span><span class="sxs-lookup"><span data-stu-id="fe259-348">After failover is forced, all secondary databases are suspended.</span></span> <span data-ttu-id="fe259-349">Это относится к бывшим базам данных-источникам, для которых бывшая первичная реплика вновь переходит в режим «в сети» и обнаруживает, что отныне является вторичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-349">This includes the former primary databases, after the former primary replica comes back online and discovers that it is now a secondary replica.</span></span> <span data-ttu-id="fe259-350">Необходимо вручную возобновить работу каждой приостановленной базы данных во вторичной реплике.</span><span class="sxs-lookup"><span data-stu-id="fe259-350">You must manually resume each suspended database individually on each secondary replica.</span></span>  
  
 <span data-ttu-id="fe259-351">Как только бывшая первичная реплика становится доступной (при условии, что базы данных остались неповрежденными), можно попытаться избежать потенциальной потери данных.</span><span class="sxs-lookup"><span data-stu-id="fe259-351">Once the former primary replica is available, assuming that its databases are undamaged, you can attempt to manage the potential data loss.</span></span> <span data-ttu-id="fe259-352">Доступные подходы управления возможной потерей данных зависят от того, была ли исходная первичная реплика соединена с новой первичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-352">The available approach for managing potential data loss depends on whether the original primary replica has connected to the new primary replica.</span></span> <span data-ttu-id="fe259-353">Если исходная первичная реплика может обратиться к новому первичному экземпляру, восстановление соединения произойдет автоматически и прозрачно.</span><span class="sxs-lookup"><span data-stu-id="fe259-353">Assuming that the original primary replica can access the new primary instance, reconnecting occurs automatically and transparently.</span></span>  
  
#### <a name="the-original-primary-replica-has-reconnected"></a><span data-ttu-id="fe259-354">Исходная первичная реплика была повторно присоединена</span><span class="sxs-lookup"><span data-stu-id="fe259-354">The Original Primary Replica Has Reconnected</span></span>  
 <span data-ttu-id="fe259-355">После сбоя бывшая первичная реплика обычно быстро восстанавливает соединение со своим партнером.</span><span class="sxs-lookup"><span data-stu-id="fe259-355">Typically, after a failure, when the original primary replica restarts it quickly reconnects to its partner.</span></span> <span data-ttu-id="fe259-356">После повторного подключения, исходная первичная реплика становится вторичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-356">On reconnecting, the original primary replica becomes the secondary replica.</span></span> <span data-ttu-id="fe259-357">Ее базы данных становятся базами данных-получателями и переходят в состояние SUSPENDED.</span><span class="sxs-lookup"><span data-stu-id="fe259-357">Its databases becomes the secondary databases and enter the SUSPENDED state.</span></span> <span data-ttu-id="fe259-358">Откат новых баз данных-получателей будет нельзя выполнить до тех пор, пока они не будут возобновлены.</span><span class="sxs-lookup"><span data-stu-id="fe259-358">The new secondary databases will not be not rolled back unless you resume them.</span></span>  
  
 <span data-ttu-id="fe259-359">Однако приостановленные базы данных являются недоступными, поэтому их нельзя исследовать и определить, какие данные будут потеряны при возобновлении данной базы данных.</span><span class="sxs-lookup"><span data-stu-id="fe259-359">However, the suspended databases are inaccessible, so you cannot inspect them to evaluate what data would be lost if you were to resume a given database.</span></span> <span data-ttu-id="fe259-360">Таким образом, решение о возобновлении или удалении базы данных-получателя зависит от того, допустима ли потеря данных следующим образом.</span><span class="sxs-lookup"><span data-stu-id="fe259-360">Therefore, the decision on whether to resume or remove a secondary database depends on whether you are willing to accept any data loss, as follows:</span></span>  
  
-   <span data-ttu-id="fe259-361">Если потеря данных недопустима, следует удалить базы данных из группы доступности, чтобы сохранить их.</span><span class="sxs-lookup"><span data-stu-id="fe259-361">If losing any data would be unacceptable, you should remove the databases from the availability group to salvage them.</span></span>  
  
     <span data-ttu-id="fe259-362">Теперь администратор базы данных сможет восстановить бывшие базы данных-источники и попытаться восстановить данные, которые были бы потеряны.</span><span class="sxs-lookup"><span data-stu-id="fe259-362">The database administrator can now recover the former primary databases and attempt to recover the data that would have been lost.</span></span> <span data-ttu-id="fe259-363">Однако когда бывшая база данных-источник станет доступной, она будет отличаться от текущей базы данных-источника, поэтому администратору баз данных придется сделать либо удаленную, либо текущую базу данных-источник недоступной клиентам, чтобы избежать их дальнейшего расхождения и проблем, связанных с переходом на другой ресурс на стороне клиентов.</span><span class="sxs-lookup"><span data-stu-id="fe259-363">However, when a former primary database comes online, it is divergent from the current primary database, so the database administrator needs to make either the removed database or the current primary database inaccessible to clients to avoid further divergence of the databases and to prevent client-failover issues.</span></span>  
  
-   <span data-ttu-id="fe259-364">Если потеря данных будет приемлема для ваших бизнес-целей, можно возобновить базы данных-получатели.</span><span class="sxs-lookup"><span data-stu-id="fe259-364">If losing data would be acceptable to your business goals, you can resume the secondary databases.</span></span>  
  
     <span data-ttu-id="fe259-365">При возобновлении базы данных-получателя, первым шагом ее синхронизации является откат.</span><span class="sxs-lookup"><span data-stu-id="fe259-365">Resuming a new secondary database causes it to be rolled back as the first step in synchronizing the database.</span></span> <span data-ttu-id="fe259-366">Если очередь отправки содержала какие-либо записи журнала в момент выхода из строя сервера, соответствующие транзакции будут потеряны, даже если они были зафиксированы.</span><span class="sxs-lookup"><span data-stu-id="fe259-366">If any log records were waiting in the send queue at the time of failure, the corresponding transactions are lost, even if they were committed.</span></span>  
  
#### <a name="the-original-primary-replica-has-not-reconnected"></a><span data-ttu-id="fe259-367">Исходная первичная реплика не была повторно присоединена</span><span class="sxs-lookup"><span data-stu-id="fe259-367">The Original Primary Replica Has Not Reconnected</span></span>  
 <span data-ttu-id="fe259-368">Если вы можете временно предотвратить повторное подключение исходной первичной реплики по сети к новой первичной реплике, у вас будет возможность изучить исходные базы данных-источники и оценить, какие данные будут потеряны при их возобновлении.</span><span class="sxs-lookup"><span data-stu-id="fe259-368">If you can temporarily prevent the original primary replica from reconnecting over the network to the new primary replica, you can inspect the original primary databases to evaluate what data would be lost if they were resumed.</span></span>  
  
-   <span data-ttu-id="fe259-369">Если потенциальная потеря данных допустима</span><span class="sxs-lookup"><span data-stu-id="fe259-369">If the potential data loss is acceptable</span></span>  
  
     <span data-ttu-id="fe259-370">Разрешите исходной первичной реплике повторно подключиться к новой первичной реплике.</span><span class="sxs-lookup"><span data-stu-id="fe259-370">Allow the original primary replica to reconnect to the new primary replica.</span></span> <span data-ttu-id="fe259-371">Повторное подключение приводит к приостановке новых баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="fe259-371">Reconnecting causes the new secondary databases to be suspended.</span></span> <span data-ttu-id="fe259-372">Чтобы начать синхронизацию данных в базе данных, просто возобновите ее.</span><span class="sxs-lookup"><span data-stu-id="fe259-372">To start data synchronization on a database, simply resume it.</span></span> <span data-ttu-id="fe259-373">Новая вторичная реплика удалит исходную вилку восстановления для этой базы данных, потеряв все транзакции, которые не были переданы или получены бывшей вторичной репликой.</span><span class="sxs-lookup"><span data-stu-id="fe259-373">The new secondary replica drops the original recovery fork for that database, losing any transactions that were never sent to or received by the former secondary replica.</span></span>  
  
-   <span data-ttu-id="fe259-374">Потеря данных недопустима</span><span class="sxs-lookup"><span data-stu-id="fe259-374">If the data loss is unacceptable</span></span>  
  
     <span data-ttu-id="fe259-375">Если исходная база данных-источник содержит важные данные, которые будут потеряны при возобновлении приостановленной базы данных, их можно сохранить в исходной базе данных-источнике, удалив ее из группы доступности.</span><span class="sxs-lookup"><span data-stu-id="fe259-375">If the original primary database contains critical data that would be lost if you resumed the suspended database, you can preserve the data on the original primary database by removing it from the availability group.</span></span> <span data-ttu-id="fe259-376">При этом база данных перейдет в состояние RESTORING.</span><span class="sxs-lookup"><span data-stu-id="fe259-376">This causes the database to enter the RESTORING state.</span></span> <span data-ttu-id="fe259-377">В этот момент рекомендуется попытаться выполнить резервное копирование заключительного фрагмента журнала удаленной базы данных.</span><span class="sxs-lookup"><span data-stu-id="fe259-377">At this point, we recommend that you attempt to back up the tail of the removed database's log.</span></span> <span data-ttu-id="fe259-378">Затем можно обновить текущую базу данных-источник (бывшую базу данных-получатель), экспортировав данные, которые необходимо сохранить, из исходной базы данных-источника и импортировав их в текущую базу данных-источник.</span><span class="sxs-lookup"><span data-stu-id="fe259-378">Then, you can update the current primary (the former secondary database) by exporting the data you want to salvage from the original primary database and importing it into the current primary database.</span></span> <span data-ttu-id="fe259-379">При этом рекомендуется как можно скорее создать полную резервную копию обновленной базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="fe259-379">We recommend taking a full database backup of the updated primary database as quickly as possible.</span></span>  
  
     <span data-ttu-id="fe259-380">Затем на экземпляре сервера, на котором размещена новая вторичная реплика, можно удалить приостановленную базу данных-получатель и создать новую базу данных-получатель, восстановив эту резервную копию (и по крайней мере одну из последующих резервных копий журнала) с помощью инструкции RESTORE WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="fe259-380">Then, on the server instance that hosts the new secondary replica, you can delete the suspended secondary database and create a new secondary database by restoring this backup (and least one subsequent log backup) using RESTORE WITH NORECOVERY.</span></span> <span data-ttu-id="fe259-381">Рекомендуется отложить создание дополнительных резервных копий журнала текущих баз данных-источников до возобновления соответствующих баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="fe259-381">We recommend delaying additional log backups of the current primary databases until the corresponding secondary databases are resumed.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="fe259-382">Если хотя бы одна из баз данных-получателей приостановлена, усечение журнала транзакций в базе данных-источнике откладывается.</span><span class="sxs-lookup"><span data-stu-id="fe259-382">Transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="fe259-383">Кроме того, во время приостановки любой локальной базы данных невозможен переход состояния вторичной реплики с синхронной фиксацией в HEALTHY.</span><span class="sxs-lookup"><span data-stu-id="fe259-383">Also the synchronization health of a synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="fe259-384">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="fe259-384">Related Tasks</span></span>  
 <span data-ttu-id="fe259-385">**Настройка режима перехода на другой ресурс**</span><span class="sxs-lookup"><span data-stu-id="fe259-385">**To configure failover behavior**</span></span>  
  
-   [<span data-ttu-id="fe259-386">Смена режима доступности для реплики доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="fe259-386">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="fe259-387">Смена режима отработки отказа для реплики доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="fe259-387">Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-failover-mode-of-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="fe259-388">Настройка гибкой политики отработки отказа для управления условиями автоматического перехода на другой ресурс &#40;группы доступности AlwaysOn&#41;</span><span class="sxs-lookup"><span data-stu-id="fe259-388">Configure the Flexible Failover Policy to Control Conditions for Automatic Failover &#40;AlwaysOn Availability Groups&#41;</span></span>](configure-flexible-automatic-failover-policy.md)  
  
 <span data-ttu-id="fe259-389">**Выполнение перехода на другой ресурс вручную**</span><span class="sxs-lookup"><span data-stu-id="fe259-389">**To perform a manual fail over**</span></span>  
  
-   [<span data-ttu-id="fe259-390">Выполнение запланированного перехода на другой ресурс вручную для группы доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="fe259-390">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="fe259-391">Выполнение принудительного перехода на другой ресурс вручную для группы доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="fe259-391">Perform a Forced Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="fe259-392">Использование мастера отработки отказа группы доступности (среда SQL Server Management Studio)</span><span class="sxs-lookup"><span data-stu-id="fe259-392">Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="fe259-393">Управление именами входа и заданиями для баз данных группы доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="fe259-393">Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;</span></span>](../../logins-and-jobs-for-availability-group-databases.md)  
  
 <span data-ttu-id="fe259-394">**Настройка конфигурации кворума WSFC**</span><span class="sxs-lookup"><span data-stu-id="fe259-394">**To configure WSFC Quorum Configuration**</span></span>  
  
-   [<span data-ttu-id="fe259-395">Настройка параметров NodeWeight для кворума кластера</span><span class="sxs-lookup"><span data-stu-id="fe259-395">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="fe259-396">Просмотр параметров NodeWeight кворума кластера</span><span class="sxs-lookup"><span data-stu-id="fe259-396">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="fe259-397">Принудительный запуск кластера WSFC без кворума</span><span class="sxs-lookup"><span data-stu-id="fe259-397">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="fe259-398">См. также</span><span class="sxs-lookup"><span data-stu-id="fe259-398">Related Content</span></span>  
  
-   [<span data-ttu-id="fe259-399">Руководство по решениям режима AlwaysOn в Microsoft SQL Server для обеспечения высокой доступности и аварийного восстановления</span><span class="sxs-lookup"><span data-stu-id="fe259-399">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   [<span data-ttu-id="fe259-400">Блог группы разработчиков SQL Server AlwaysOn: официальный блог группы разработчиков SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="fe259-400">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="fe259-401">См. также:</span><span class="sxs-lookup"><span data-stu-id="fe259-401">See Also</span></span>  
 <span data-ttu-id="fe259-402">[Общие сведения о группы доступности AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="fe259-402">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="fe259-403">[Режимы доступности &#40;группы доступности AlwaysOn&#41;](availability-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="fe259-403">[Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="fe259-404">[Отказоустойчивая кластеризация Windows Server (WSFC) с SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="fe259-404">[Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md) </span></span>  
 <span data-ttu-id="fe259-405">[Межбазовые транзакции не поддерживаются для зеркального отображения базы данных или группы доступности AlwaysOn &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="fe259-405">[Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md) </span></span>  
 <span data-ttu-id="fe259-406">[Политика отработки отказа для экземпляров откзоустойчивого кластера](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md) </span><span class="sxs-lookup"><span data-stu-id="fe259-406">[Failover Policy for Failover Cluster Instances](../../../sql-server/failover-clusters/windows/failover-policy-for-failover-cluster-instances.md) </span></span>  
 [<span data-ttu-id="fe259-407">Гибкая политика отработки отказа для автоматического перехода на другой ресурс группы доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="fe259-407">Flexible Failover Policy for Automatic Failover of an Availability Group &#40;SQL Server&#41;</span></span>](flexible-automatic-failover-policy-availability-group.md)  
  
  
