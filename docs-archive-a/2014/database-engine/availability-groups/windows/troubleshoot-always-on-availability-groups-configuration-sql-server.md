---
title: Устранение неполадок группы доступности AlwaysOn конфигурации (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 01/31/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- troubleshooting [SQL Server], deploying
- Availability Groups [SQL Server], troubleshooting
- Availability Groups [SQL Server], configuring
ms.assetid: 8c222f98-7392-4faf-b7ad-5fb60ffa237e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 165036ba539c3392b1944282bd9d6126eb471a97
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750179"
---
# <a name="troubleshoot-alwayson-availability-groups-configuration-sql-server"></a><span data-ttu-id="4c059-102">Поиск и устранение неисправностей конфигурации групп доступности AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4c059-102">Troubleshoot AlwaysOn Availability Groups Configuration (SQL Server)</span></span>
  <span data-ttu-id="4c059-103">Этот раздел содержит сведения об устранении типичных проблем, возникающих при настройке экземпляров сервера для [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4c059-103">This topic provides information to help you troubleshoot typical problems with configuring server instances for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="4c059-104">Примеры типичных проблем настройки: [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] отключен, учетные записи настроены неправильно, конечная точка зеркального отображения баз данных не существует, конечная точка недоступна (ошибка SQL Server 1418), отсутствует сетевой доступ, команда присоединения базы данных завершается с ошибкой (ошибка SQL Server 35250).</span><span class="sxs-lookup"><span data-stu-id="4c059-104">Typical configuration problems include [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is disabled, accounts are incorrectly configured, the database mirroring endpoint does not exist, the endpoint is inaccessible (SQL Server Error 1418), network access does not exist, and a join database command fails (SQL Server Error 35250).</span></span>

> [!NOTE]
>  <span data-ttu-id="4c059-105">Проверьте, выполняются ли предварительные требования [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4c059-105">Ensure that you are meeting the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] prerequisites.</span></span> <span data-ttu-id="4c059-106">Дополнительные сведения см. в разделе [Предварительные требования, ограничения и рекомендации для групп доступности AlwaysOn (SQL Server)](prereqs-restrictions-recommendations-always-on-availability.md).</span><span class="sxs-lookup"><span data-stu-id="4c059-106">For more information, see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>

 <span data-ttu-id="4c059-107">**В этом разделе:**</span><span class="sxs-lookup"><span data-stu-id="4c059-107">**In This Topic:**</span></span>

|<span data-ttu-id="4c059-108">Section</span><span class="sxs-lookup"><span data-stu-id="4c059-108">Section</span></span>|<span data-ttu-id="4c059-109">Описание</span><span class="sxs-lookup"><span data-stu-id="4c059-109">Description</span></span>|
|-------------|-----------------|
|[<span data-ttu-id="4c059-110">Функция групп доступности AlwaysOn не включена</span><span class="sxs-lookup"><span data-stu-id="4c059-110">AlwaysOn Availability Groups Is Not Enabled</span></span>](#IsHadrEnabled)|<span data-ttu-id="4c059-111">Если экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не включен для [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], то экземпляр не поддерживает создание групп доступности и на нем не могут размещаться реплики доступности.</span><span class="sxs-lookup"><span data-stu-id="4c059-111">If an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], the instance does not support availability group creation and cannot host any availability replicas.</span></span>|
|[<span data-ttu-id="4c059-112">Измерение счетов</span><span class="sxs-lookup"><span data-stu-id="4c059-112">Accounts</span></span>](#Accounts)|<span data-ttu-id="4c059-113">Обсуждаются требования к правильной настройке учетных записей, под которыми работает [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4c059-113">Discusses requirements for correctly configuring the accounts under which [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is running.</span></span>|
|[<span data-ttu-id="4c059-114">Конечные точки</span><span class="sxs-lookup"><span data-stu-id="4c059-114">Endpoints</span></span>](#Endpoints)|<span data-ttu-id="4c059-115">Описывается диагностика проблем конечной точки зеркального отображения баз данных для экземпляра сервера.</span><span class="sxs-lookup"><span data-stu-id="4c059-115">Discusses how to diagnose issues with the database mirroring endpoint of a server instance.</span></span>|
|[<span data-ttu-id="4c059-116">Имя системы</span><span class="sxs-lookup"><span data-stu-id="4c059-116">System name</span></span>](#SystemName)|<span data-ttu-id="4c059-117">Обобщаются альтернативы указанию системного имени экземпляра сервера в URL-адресе конечной точки.</span><span class="sxs-lookup"><span data-stu-id="4c059-117">Summarizes the alternatives for specifying the system name of a server instance in an endpoint URL.</span></span>|
|[<span data-ttu-id="4c059-118">Сетевой доступ</span><span class="sxs-lookup"><span data-stu-id="4c059-118">Network access</span></span>](#NetworkAccess)|<span data-ttu-id="4c059-119">Документирует требование к каждому экземпляру сервера, на котором размещается реплика доступности, чтобы каждый такой экземпляр имел доступ к порту каждого другого экземпляра сервера по протоколу TCP.</span><span class="sxs-lookup"><span data-stu-id="4c059-119">Documents the requirement that each server instance that is hosting an availability replica must be able to access the port of each of the other server instances over TCP.</span></span>|
|[<span data-ttu-id="4c059-120">Доступ к конечной точке (ошибка SQL Server 1418)</span><span class="sxs-lookup"><span data-stu-id="4c059-120">Endpoint Access (SQL Server Error 1418)</span></span>](#Msg1418)|<span data-ttu-id="4c059-121">Содержит сведения об этом сообщении об ошибке [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4c059-121">Contains information about this [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error message.</span></span>|
|[<span data-ttu-id="4c059-122">Ошибка присоединения базы данных (ошибка SQL Server 35250)</span><span class="sxs-lookup"><span data-stu-id="4c059-122">Join Database Fails (SQL Server Error 35250)</span></span>](#JoinDbFails)|<span data-ttu-id="4c059-123">Обсуждаются возможные причины и способы устранения проблемы с присоединением баз данных-получателей к группе доступности, поскольку соединение с первичной репликой неактивно.</span><span class="sxs-lookup"><span data-stu-id="4c059-123">Discusses the possible causes and resolution of a failure to join secondary databases to an availability group because the connection to the primary replica is not active.</span></span>|
|[<span data-ttu-id="4c059-124">Маршрутизация только для чтения работает неправильно</span><span class="sxs-lookup"><span data-stu-id="4c059-124">Read-Only Routing is Not Working Correctly</span></span>](#ROR)||
|[<span data-ttu-id="4c059-125">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="4c059-125">Related Tasks</span></span>](#RelatedTasks)|<span data-ttu-id="4c059-126">Содержит список разбитых по задачам разделов в электронной документации по [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] , особенно важных для устранения неполадок с конфигурацией группы.</span><span class="sxs-lookup"><span data-stu-id="4c059-126">Contains a list of task-oriented topics in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] Books Online that are particularly relevant to troubleshooting an availability group configuration.</span></span>|
|[<span data-ttu-id="4c059-127">См. также</span><span class="sxs-lookup"><span data-stu-id="4c059-127">Related Content</span></span>](#RelatedContent)|<span data-ttu-id="4c059-128">Содержит список важных ресурсов, не входящих в состав электронной документации по [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4c059-128">Contains a list of relevant resources that are external to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Books Online.</span></span>|

##  <a name="alwayson-availability-groups-is-not-enabled"></a><a name="IsHadrEnabled"></a><span data-ttu-id="4c059-129">группы доступности AlwaysOn не включена</span><span class="sxs-lookup"><span data-stu-id="4c059-129">AlwaysOn Availability Groups Is Not Enabled</span></span>
 <span data-ttu-id="4c059-130">Функция [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] должна быть включена на каждом из экземпляров [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4c059-130">The [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] feature must be enabled on each of the instances of [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="4c059-131">Дополнительные сведения см. в разделе [Включение и отключение групп доступности AlwaysOn (SQL Server)](enable-and-disable-always-on-availability-groups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="4c059-131">For more information, see [Enable and Disable AlwaysOn Availability Groups &#40;SQL Server&#41;](enable-and-disable-always-on-availability-groups-sql-server.md).</span></span>

##  <a name="accounts"></a><a name="Accounts"></a> <span data-ttu-id="4c059-132">Измерение счетов</span><span class="sxs-lookup"><span data-stu-id="4c059-132">Accounts</span></span>
 <span data-ttu-id="4c059-133">Учетные записи, под которыми работает [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , должны быть правильно настроены.</span><span class="sxs-lookup"><span data-stu-id="4c059-133">The accounts under which [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is running must be correctly configured.</span></span>

1.  <span data-ttu-id="4c059-134">Имеют ли учетные записи нужные разрешения?</span><span class="sxs-lookup"><span data-stu-id="4c059-134">Do the accounts have the correct permissions?</span></span>

    1.  <span data-ttu-id="4c059-135">Если участники запущены под одной и той же учетной записью домена, то правильные имена входа существуют в обеих базах данных **master** .</span><span class="sxs-lookup"><span data-stu-id="4c059-135">If the partners run as the same domain user account, the correct user logins exist automatically in both **master** databases.</span></span> <span data-ttu-id="4c059-136">Это рекомендовано и упрощает настройку безопасности базы данных.</span><span class="sxs-lookup"><span data-stu-id="4c059-136">This simplifies the security configuration the database and is recommended.</span></span>

    2.  <span data-ttu-id="4c059-137">Если два экземпляра сервера выполняются под разными учетными записями, то для каждой учетной записи должно быть создано имя входа в базе данных **master** на удаленном экземпляре сервера и этому имени входа необходимо присвоить разрешения CONNECT для подключения к конечной точке зеркального отображения базы данных на этом экземпляре сервера.</span><span class="sxs-lookup"><span data-stu-id="4c059-137">If two server instances run as different accounts, the login each account must be created in **master** on the remote server instance, and that login must be granted CONNECT permissions to connect to the database mirroring endpoint of that server instance.</span></span> <span data-ttu-id="4c059-138">Дополнительные сведения см. в разделе[Настройка учетных записей входа для зеркального отображения базы данных или группы доступности AlwaysOn &#40;SQL Server&#41;](../../database-mirroring/set-up-login-accounts-database-mirroring-always-on-availability.md).</span><span class="sxs-lookup"><span data-stu-id="4c059-138">For more information, see[Set Up Login Accounts for Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-mirroring/set-up-login-accounts-database-mirroring-always-on-availability.md).</span></span>

2.  <span data-ttu-id="4c059-139">Если [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] выполняется как встроенная учетная запись, например как учетная запись локальной системы, локальной службы, сетевой службы или как недоменная учетная запись, для проверки подлинности конечных точек следует использовать сертификаты.</span><span class="sxs-lookup"><span data-stu-id="4c059-139">If [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is running as a built-in account, such as Local System, Local Service, or Network Service, or a nondomain account, you must use certificates for endpoint authentication.</span></span> <span data-ttu-id="4c059-140">Если учетные записи служб используют учетные записи доменов в одном домене, вы можете предоставить доступ CONNECT для каждой учетной записи службы на всех расположениях реплики либо воспользоваться сертификатами.</span><span class="sxs-lookup"><span data-stu-id="4c059-140">If your service accounts are using domain accounts in the same domain, you can choose to grant CONNECT access for each service account on all the replica locations or you can use certificates.</span></span> <span data-ttu-id="4c059-141">Дополнительные сведения см. в разделе [Использование сертификатов для конечной точки зеркального отображения базы данных (Transact-SQL)](../../database-mirroring/use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="4c059-141">For more information, see[Use Certificates for a Database Mirroring Endpoint &#40;Transact-SQL&#41;](../../database-mirroring/use-certificates-for-a-database-mirroring-endpoint-transact-sql.md).</span></span>

##  <a name="endpoints"></a><a name="Endpoints"></a> <span data-ttu-id="4c059-142">Конечные точки</span><span class="sxs-lookup"><span data-stu-id="4c059-142">Endpoints</span></span>
 <span data-ttu-id="4c059-143">Конечные точки должны быть правильно настроены.</span><span class="sxs-lookup"><span data-stu-id="4c059-143">Endpoints must be correctly configured.</span></span>

1.  <span data-ttu-id="4c059-144">Убедитесь, что каждый экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , на котором планируется размещать реплику доступности (каждое *расположение реплики*), имеет конечную точку зеркального отображения баз данных.</span><span class="sxs-lookup"><span data-stu-id="4c059-144">Make sure that each instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that is going to host an availability replica (each *replica location*) has a database mirroring endpoint.</span></span> <span data-ttu-id="4c059-145">Чтобы определить, существует ли конечная точка зеркального отображения баз данных на данном экземпляре сервера, воспользуйтесь представлением каталога [sys.database_mirroring_endpoints](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="4c059-145">To determine whether a database mirroring endpoint exists on a given server instance, use the [sys.database_mirroring_endpoints](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql) catalog view.</span></span> <span data-ttu-id="4c059-146">Дополнительные сведения см. в статье [Создание конечной точки зеркального отображения базы данных с проверкой подлинности Windows (Transact-SQL)](../../database-mirroring/create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md) или [Включение использования сертификатов для исходящих соединений в конечной точке зеркального отображения базы данных (Transact-SQL)](../../database-mirroring/database-mirroring-use-certificates-for-outbound-connections.md).</span><span class="sxs-lookup"><span data-stu-id="4c059-146">For more information, see either [Create a Database Mirroring Endpoint for Windows Authentication &#40;Transact-SQL&#41;](../../database-mirroring/create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md) or [Allow a Database Mirroring Endpoint to Use Certificates for Outbound Connections &#40;Transact-SQL&#41;](../../database-mirroring/database-mirroring-use-certificates-for-outbound-connections.md).</span></span>

2.  <span data-ttu-id="4c059-147">Убедитесь, что номера портов правильны.</span><span class="sxs-lookup"><span data-stu-id="4c059-147">Check that the port numbers are correct.</span></span>

     <span data-ttu-id="4c059-148">Чтобы определить, какой порт в текущий момент связан с конечной точкой зеркального отображения базы данных экземпляра сервера, воспользуйтесь следующей инструкцией [!INCLUDE[tsql](../../../includes/tsql-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="4c059-148">To identify the port currently associated with database mirroring endpoint of a server instance, use the following [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement:</span></span>

    ```
    SELECT type_desc, port FROM sys.tcp_endpoints;
    GO
    ```

3.  <span data-ttu-id="4c059-149">Если при настройке [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] возникают труднообъяснимые неполадки, рекомендуется на каждом экземпляре сервера проверить, правильный ли порт он прослушивает.</span><span class="sxs-lookup"><span data-stu-id="4c059-149">For [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] setup issues that are difficult to explain, we recommend that you inspect each server instance to determine whether it is listening on the correct ports.</span></span> <span data-ttu-id="4c059-150">Сведения о проверке доступности порта см. в разделе [MSSQLSERVER_1418](../../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md).</span><span class="sxs-lookup"><span data-stu-id="4c059-150">For information about verifying port availability, see [MSSQLSERVER_1418](../../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md).</span></span>

4.  <span data-ttu-id="4c059-151">Убедитесь, что конечные точки запущены (STATE=STARTED).</span><span class="sxs-lookup"><span data-stu-id="4c059-151">Make sure that the endpoints are started (STATE=STARTED).</span></span> <span data-ttu-id="4c059-152">На каждом экземпляре сервера выполните следующую инструкцию [!INCLUDE[tsql](../../../includes/tsql-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="4c059-152">On each server instance, use the following [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement:</span></span>

    ```
    SELECT state_desc FROM sys.database_mirroring_endpoints
    ```

     <span data-ttu-id="4c059-153">Дополнительные сведения о столбце **state_desc** см. в разделе [sys.database_mirroring_endpoints (Transact-SQL)](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="4c059-153">For more information about the **state_desc** column, see [sys.database_mirroring_endpoints &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-endpoints-transact-sql).</span></span>

     <span data-ttu-id="4c059-154">Чтобы запустить конечную точку, выполните следующую инструкцию [!INCLUDE[tsql](../../../includes/tsql-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="4c059-154">To start an endpoint, use the following [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement:</span></span>

    ```
    ALTER ENDPOINT Endpoint_Mirroring 
    STATE = STARTED 
    AS TCP (LISTENER_PORT = <port_number>)
    FOR database_mirroring (ROLE = ALL);
    GO
    ```

     <span data-ttu-id="4c059-155">Дополнительные сведения см. в статье [ALTER ENDPOINT (Transact-SQL)](/sql/t-sql/statements/alter-endpoint-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="4c059-155">For more information, see [ALTER ENDPOINT &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-endpoint-transact-sql).</span></span>

5.  <span data-ttu-id="4c059-156">Убедитесь, что имени входа на другом сервере предоставлено разрешение CONNECT.</span><span class="sxs-lookup"><span data-stu-id="4c059-156">Make sure that the login from the other server has CONNECT permission.</span></span> <span data-ttu-id="4c059-157">Чтобы узнать, кто имеет разрешение CONNECT для конечной точки, выполните следующую инструкцию [!INCLUDE[tsql](../../../includes/tsql-md.md)] на каждом экземпляре сервера:</span><span class="sxs-lookup"><span data-stu-id="4c059-157">To determine who has CONNECT permission for an endpoint, on each server instance use the following [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement:</span></span>

    ```
    SELECT 'Metadata Check';
    SELECT EP.name, SP.STATE, 
       CONVERT(nvarchar(38), suser_name(SP.grantor_principal_id)) 
          AS GRANTOR, 
       SP.TYPE AS PERMISSION,
       CONVERT(nvarchar(46),suser_name(SP.grantee_principal_id)) 
          AS GRANTEE 
       FROM sys.server_permissions SP , sys.endpoints EP
       WHERE SP.major_id = EP.endpoint_id
       ORDER BY Permission,grantor, grantee; 
    GO

    ```

##  <a name="system-name"></a><a name="SystemName"></a> <span data-ttu-id="4c059-158">System Name</span><span class="sxs-lookup"><span data-stu-id="4c059-158">System Name</span></span>
 <span data-ttu-id="4c059-159">В качестве системного имени экземпляра сервера в URL-адресе конечной точки можно использовать любое имя, которое однозначно идентифицирует систему.</span><span class="sxs-lookup"><span data-stu-id="4c059-159">For the system name of a server instance in an endpoint URL, you can use any name that unambiguously identifies the system.</span></span> <span data-ttu-id="4c059-160">Адрес сервера может представлять собой системное имя (если системы находятся в одном), полное доменное имя или IP-адрес (желательно статический).</span><span class="sxs-lookup"><span data-stu-id="4c059-160">The server address can be a system name (if the systems are in the same domain), a fully qualified domain name, or an IP address (preferably, a static IP address).</span></span> <span data-ttu-id="4c059-161">Полное доменное имя будет работать гарантированно.</span><span class="sxs-lookup"><span data-stu-id="4c059-161">Using the fully qualified domain name is guaranteed to work.</span></span> <span data-ttu-id="4c059-162">Дополнительные сведения см. в разделе [Указание URL-адреса конечной точки при добавлении или изменении реплики доступности (SQL Server)](specify-endpoint-url-adding-or-modifying-availability-replica.md).</span><span class="sxs-lookup"><span data-stu-id="4c059-162">For more information, see [Specify the Endpoint URL When Adding or Modifying an Availability Replica &#40;SQL Server&#41;](specify-endpoint-url-adding-or-modifying-availability-replica.md).</span></span>

##  <a name="network-access"></a><a name="NetworkAccess"></a> <span data-ttu-id="4c059-163">Network Access</span><span class="sxs-lookup"><span data-stu-id="4c059-163">Network Access</span></span>
 <span data-ttu-id="4c059-164">Каждый экземпляр сервера, на котором размещается реплика доступности, должен иметь доступ к порту каждого другого экземпляра сервера по протоколу TCP.</span><span class="sxs-lookup"><span data-stu-id="4c059-164">Each server instance that is hosting an availability replica must be able to access the port of each of the other server instance over TCP.</span></span> <span data-ttu-id="4c059-165">Это особенно важно, если экземпляры сервера находятся в разных доменах, не имеющих доверительных отношений друг с другом (домены без доверия).</span><span class="sxs-lookup"><span data-stu-id="4c059-165">This is especially important if the server instances are in different domains that do not trust each other (untrusted domains).</span></span>

##  <a name="endpoint-access-sql-server-error-1418"></a><a name="Msg1418"></a> <span data-ttu-id="4c059-166">Доступ к конечной точке (ошибка SQL Server 1418)</span><span class="sxs-lookup"><span data-stu-id="4c059-166">Endpoint Access (SQL Server Error 1418)</span></span>
 <span data-ttu-id="4c059-167">Это сообщение [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] уведомляет, что сетевой адрес сервера, указанный в URL-адресе конечной точки сервера, недоступен или не существует, и предлагает выполнить проверку имени сетевого адреса и повторно выполнить команду.</span><span class="sxs-lookup"><span data-stu-id="4c059-167">This [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] message indicates that the server network address specified in the endpoint URL cannot be reached or does not exist, and it suggests that you verify the network address name and reissue the command.</span></span> <span data-ttu-id="4c059-168">Дополнительные сведения см. в статье [MSSQLSERVER_1418](../../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md).</span><span class="sxs-lookup"><span data-stu-id="4c059-168">For more information, see [MSSQLSERVER_1418](../../../relational-databases/errors-events/mssqlserver-1418-database-engine-error.md).</span></span>

##  <a name="join-database-fails-sql-server-error-35250"></a><a name="JoinDbFails"></a> <span data-ttu-id="4c059-169">Ошибка присоединения базы данных (ошибка SQL Server 35250)</span><span class="sxs-lookup"><span data-stu-id="4c059-169">Join Database Fails (SQL Server Error 35250)</span></span>
 <span data-ttu-id="4c059-170">В этом разделе обсуждаются возможные причины и способы устранения проблемы с присоединением баз данных-получателей к группе доступности, вызванные тем, что соединение с первичной репликой неактивно.</span><span class="sxs-lookup"><span data-stu-id="4c059-170">This section discusses the possible causes and resolution of a failure to join secondary databases to the availability group because the connection to the primary replica is not active.</span></span>

 <span data-ttu-id="4c059-171">**Решение.**</span><span class="sxs-lookup"><span data-stu-id="4c059-171">**Resolution:**</span></span>

1.  <span data-ttu-id="4c059-172">Проверьте настройку брандмауэра: разрешена ли связь для портов конечных точек между экземплярами серверов, на которых размещаются первичная и вторичная реплика (по умолчанию порт 5022).</span><span class="sxs-lookup"><span data-stu-id="4c059-172">Check the firewall setting to see if whether allows the endpoint port communication between the server instances that host primary replica and the secondary replica (port 5022 by default).</span></span>

2.  <span data-ttu-id="4c059-173">Проверьте, обладает ли учетная запись сетевой службы разрешением на подключение к конечной точке.</span><span class="sxs-lookup"><span data-stu-id="4c059-173">Check whether the network service account has connect permission to the endpoint.</span></span>

##  <a name="read-only-routing-is-not-working-correctly"></a><a name="ROR"></a> <span data-ttu-id="4c059-174">Маршрутизация только для чтения работает неправильно</span><span class="sxs-lookup"><span data-stu-id="4c059-174">Read-Only Routing is Not Working Correctly</span></span>
 <span data-ttu-id="4c059-175">Проверьте следующие параметры значений конфигурации и исправьте их при необходимости.</span><span class="sxs-lookup"><span data-stu-id="4c059-175">Verify the following configuration values settings and correct them if necessary.</span></span>

||<span data-ttu-id="4c059-176">Если...</span><span class="sxs-lookup"><span data-stu-id="4c059-176">On...</span></span>|<span data-ttu-id="4c059-177">Действие</span><span class="sxs-lookup"><span data-stu-id="4c059-177">Action</span></span>|<span data-ttu-id="4c059-178">Комментарии</span><span class="sxs-lookup"><span data-stu-id="4c059-178">Comments</span></span>|<span data-ttu-id="4c059-179">Ссылка</span><span class="sxs-lookup"><span data-stu-id="4c059-179">Link</span></span>|
|------|---------|------------|--------------|----------|
|<span data-ttu-id="4c059-180">![Флажок](../../media/checkboxemptycenterxtraspacetopandright.gif "Флажок")</span><span class="sxs-lookup"><span data-stu-id="4c059-180">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="4c059-181">Текущая первичная реплика</span><span class="sxs-lookup"><span data-stu-id="4c059-181">Current primary replica</span></span>|<span data-ttu-id="4c059-182">Убедитесь, что прослушиватель группы доступности находится в режиме «в сети».</span><span class="sxs-lookup"><span data-stu-id="4c059-182">Ensure that the availability group listener is online.</span></span>|<span data-ttu-id="4c059-183">**Чтобы убедиться, что прослушиватель имеет состояние «в сети», выполните следующие действия.**</span><span class="sxs-lookup"><span data-stu-id="4c059-183">**To verify whether the listener is online:**</span></span><br /><br /> `SELECT * FROM sys.dm_tcp_listener_states;`<br /><br /> <span data-ttu-id="4c059-184">**Перезапуск прослушивателя с состоянием «вне сети»**</span><span class="sxs-lookup"><span data-stu-id="4c059-184">**To restart an offline listener:**</span></span><br /><br /> `ALTER AVAILABILITY GROUP myAG RESTART LISTENER 'myAG_Listener';`|[<span data-ttu-id="4c059-185">sys.dm_tcp_listener_states (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="4c059-185">sys.dm_tcp_listener_states &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-tcp-listener-states-transact-sql)<br /><br /> [<span data-ttu-id="4c059-186">ALTER AVAILABILITY GROUP (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="4c059-186">ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-availability-group-transact-sql)|
|<span data-ttu-id="4c059-187">![Флажок](../../media/checkboxemptycenterxtraspacetopandright.gif "Флажок")</span><span class="sxs-lookup"><span data-stu-id="4c059-187">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="4c059-188">Текущая первичная реплика</span><span class="sxs-lookup"><span data-stu-id="4c059-188">Current primary replica</span></span>|<span data-ttu-id="4c059-189">Убедитесь, что параметр READ_ONLY_ROUTING_LIST содержит только экземпляры сервера, где размещена вторичная реплика.</span><span class="sxs-lookup"><span data-stu-id="4c059-189">Ensure that the READ_ONLY_ROUTING_LIST contains only server instances that are hosting a readable secondary replica.</span></span>|<span data-ttu-id="4c059-190">**Определение доступных для чтения вторичных реплик:** sys.availability_replicas (столбец**secondary_role_allow_connections_desc** )</span><span class="sxs-lookup"><span data-stu-id="4c059-190">**To identify readable secondary replicas:** sys.availability_replicas  (**secondary_role_allow_connections_desc** column)</span></span><br /><br /> <span data-ttu-id="4c059-191">**Просмотр списка маршрутизации только для чтения:** sys.availability_read_only_routing_lists</span><span class="sxs-lookup"><span data-stu-id="4c059-191">**To view a read-only routing list:** sys.availability_read_only_routing_lists</span></span><br /><br /> <span data-ttu-id="4c059-192">**Изменение списка маршрутизации только для чтения.** ALTER AVAILABILITY GROUP</span><span class="sxs-lookup"><span data-stu-id="4c059-192">**To change a read-only routing list:** ALTER AVAILABILITY GROUP</span></span>|[<span data-ttu-id="4c059-193">sys.availability_replicas (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="4c059-193">sys.availability_replicas &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql)<br /><br /> [<span data-ttu-id="4c059-194">sys.availability_read_only_routing_lists (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="4c059-194">sys.availability_read_only_routing_lists &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-read-only-routing-lists-transact-sql)<br /><br /> [<span data-ttu-id="4c059-195">ALTER AVAILABILITY GROUP (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="4c059-195">ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-availability-group-transact-sql)|
|<span data-ttu-id="4c059-196">![Флажок](../../media/checkboxemptycenterxtraspacetopandright.gif "Флажок")</span><span class="sxs-lookup"><span data-stu-id="4c059-196">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="4c059-197">Каждая реплика в списке read_only_routing_list</span><span class="sxs-lookup"><span data-stu-id="4c059-197">Every replica in the read_only_routing_list</span></span>|<span data-ttu-id="4c059-198">Убедитесь, что брандмауэр Windows не блокирует порт READ_ONLY_ROUTING_URL.</span><span class="sxs-lookup"><span data-stu-id="4c059-198">Ensure that the Windows firewall is not blocking the READ_ONLY_ROUTING_URL port.</span></span>|-|[<span data-ttu-id="4c059-199">Настройка брандмауэра Windows для доступа к компоненту Database Engine</span><span class="sxs-lookup"><span data-stu-id="4c059-199">Configure a Windows Firewall for Database Engine Access</span></span>](../../configure-windows/configure-a-windows-firewall-for-database-engine-access.md)|
|<span data-ttu-id="4c059-200">![Флажок](../../media/checkboxemptycenterxtraspacetopandright.gif "Флажок")</span><span class="sxs-lookup"><span data-stu-id="4c059-200">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="4c059-201">Каждая реплика в списке read_only_routing_list</span><span class="sxs-lookup"><span data-stu-id="4c059-201">Every replica in the read_only_routing_list</span></span>|<span data-ttu-id="4c059-202">В диспетчере конфигурации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] убедитесь в следующем.</span><span class="sxs-lookup"><span data-stu-id="4c059-202">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager, verify that:</span></span><br /><br /> <span data-ttu-id="4c059-203">Удаленное соединение с SQL Server включено.</span><span class="sxs-lookup"><span data-stu-id="4c059-203">SQL Server remote connectivity is enabled.</span></span><br /><br /> <span data-ttu-id="4c059-204">TCP/IP включен.</span><span class="sxs-lookup"><span data-stu-id="4c059-204">TCP/IP is enabled.</span></span><br /><br /> <span data-ttu-id="4c059-205">IP-адреса настроены правильно.</span><span class="sxs-lookup"><span data-stu-id="4c059-205">The IP addresses are configured correctly.</span></span>|-|[<span data-ttu-id="4c059-206">Просмотр или изменение свойств сервера (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4c059-206">View or Change Server Properties &#40;SQL Server&#41;</span></span>](../../configure-windows/view-or-change-server-properties-sql-server.md)<br /><br /> [<span data-ttu-id="4c059-207">Настройка сервера для прослушивания указанного TCP-порта (диспетчер конфигурации SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4c059-207">Configure a Server to Listen on a Specific TCP Port &#40;SQL Server Configuration Manager&#41;</span></span>](../../configure-windows/configure-a-server-to-listen-on-a-specific-tcp-port.md)|
|<span data-ttu-id="4c059-208">![Флажок](../../media/checkboxemptycenterxtraspacetopandright.gif "Флажок")</span><span class="sxs-lookup"><span data-stu-id="4c059-208">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="4c059-209">Каждая реплика в списке read_only_routing_list</span><span class="sxs-lookup"><span data-stu-id="4c059-209">Every replica in the read_only_routing_list</span></span>|<span data-ttu-id="4c059-210">Убедитесь, что READ_ONLY_ROUTING_URL (TCP<strong>:// *`system-address`* :</strong>*порт*) содержит правильное полное доменное имя (FQDN) и номер порта.</span><span class="sxs-lookup"><span data-stu-id="4c059-210">Ensure that the READ_ONLY_ROUTING_URL (TCP<strong>://*`system-address`*:</strong>*port*) contains the correct fully-qualified domain name (FQDN) and port number.</span></span>|-|[<span data-ttu-id="4c059-211">Вычисление для AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="4c059-211">Calculating read_only_routing_url for AlwaysOn</span></span>](https://docs.microsoft.com/archive/blogs/mattn/calculating-read_only_routing_url-for-alwayson)<br /><br /> [<span data-ttu-id="4c059-212">sys.availability_replicas (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="4c059-212">sys.availability_replicas &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql)<br /><br /> [<span data-ttu-id="4c059-213">ALTER AVAILABILITY GROUP (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="4c059-213">ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-availability-group-transact-sql)|
|<span data-ttu-id="4c059-214">![Флажок](../../media/checkboxemptycenterxtraspacetopandright.gif "Флажок")</span><span class="sxs-lookup"><span data-stu-id="4c059-214">![Checkbox](../../media/checkboxemptycenterxtraspacetopandright.gif "Checkbox")</span></span>|<span data-ttu-id="4c059-215">Система клиента</span><span class="sxs-lookup"><span data-stu-id="4c059-215">Client system</span></span>|<span data-ttu-id="4c059-216">Убедитесь, что драйвер клиента поддерживает маршрутизацию только для чтения.</span><span class="sxs-lookup"><span data-stu-id="4c059-216">Verify that the client driver supports read-only routing.</span></span>|-|[<span data-ttu-id="4c059-217">Подключение клиента AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4c059-217">AlwaysOn Client Connectivity (SQL Server)</span></span>](always-on-client-connectivity-sql-server.md)|

##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="4c059-218">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="4c059-218">Related Tasks</span></span>

-   [<span data-ttu-id="4c059-219">Создание и настройка групп доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4c059-219">Creation and Configuration of Availability Groups &#40;SQL Server&#41;</span></span>](creation-and-configuration-of-availability-groups-sql-server.md)

-   [<span data-ttu-id="4c059-220">Создание конечной точки зеркального отображения базы данных с проверкой подлинности Windows (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="4c059-220">Create a Database Mirroring Endpoint for Windows Authentication &#40;Transact-SQL&#41;</span></span>](../../database-mirroring/create-a-database-mirroring-endpoint-for-windows-authentication-transact-sql.md)

-   [<span data-ttu-id="4c059-221">Укажите URL-адрес конечной точки при добавлении или изменении реплики доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4c059-221">Specify the Endpoint URL When Adding or Modifying an Availability Replica &#40;SQL Server&#41;</span></span>](specify-endpoint-url-adding-or-modifying-availability-replica.md)

-   [<span data-ttu-id="4c059-222">Подготовка базы данных-получателя для присоединения к группе доступности вручную (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4c059-222">Manually Prepare a Secondary Database for an Availability Group &#40;SQL Server&#41;</span></span>](manually-prepare-a-secondary-database-for-an-availability-group-sql-server.md)

-   [<span data-ttu-id="4c059-223">Устранение неполадок при &#40;операции добавления файла группы доступности AlwaysOn&#41;</span><span class="sxs-lookup"><span data-stu-id="4c059-223">Troubleshoot a Failed Add-File Operation &#40;AlwaysOn Availability Groups&#41;</span></span>](troubleshoot-a-failed-add-file-operation-always-on-availability-groups.md)

-   [<span data-ttu-id="4c059-224">Управление именами входа и заданиями для баз данных группы доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4c059-224">Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;</span></span>](../../logins-and-jobs-for-availability-group-databases.md)

-   [<span data-ttu-id="4c059-225">Управление метаданными при обеспечении доступности базы данных на другом экземпляре сервера (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4c059-225">Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;</span></span>](../../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md)

##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="4c059-226">См. также</span><span class="sxs-lookup"><span data-stu-id="4c059-226">Related Content</span></span>

-   <span data-ttu-id="4c059-227">[Просмотр событий и журналов для отказоустойчивого кластера](https://technet.microsoft.com/library/cc772342\(WS.10\).aspx)</span><span class="sxs-lookup"><span data-stu-id="4c059-227">[View Events and Logs for a Failover Cluster](https://technet.microsoft.com/library/cc772342\(WS.10\).aspx)</span></span>

-   [<span data-ttu-id="4c059-228">Командлет Get-ClusterLog отказоустойчивого кластера</span><span class="sxs-lookup"><span data-stu-id="4c059-228">Get-ClusterLog Failover Cluster Cmdlet</span></span>](https://technet.microsoft.com/library/ee461045.aspx)

-   [<span data-ttu-id="4c059-229">Блог группы разработчиков SQL Server AlwaysOn: официальный блог группы разработчиков SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="4c059-229">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)

## <a name="see-also"></a><span data-ttu-id="4c059-230">См. также:</span><span class="sxs-lookup"><span data-stu-id="4c059-230">See Also</span></span>
 <span data-ttu-id="4c059-231">[Безопасность транспорта для зеркального отображения базы данных и группы доступности AlwaysOn &#40;SQL Server&#41;](../../database-mirroring/transport-security-database-mirroring-always-on-availability.md) требования к [конфигурации сети клиента](../../configure-windows/client-network-configuration.md) [, ограничения и рекомендации для группы доступности AlwaysOn &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md)</span><span class="sxs-lookup"><span data-stu-id="4c059-231">[Transport Security for Database Mirroring and AlwaysOn Availability Groups &#40;SQL Server&#41;](../../database-mirroring/transport-security-database-mirroring-always-on-availability.md) [Client Network Configuration](../../configure-windows/client-network-configuration.md) [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md)</span></span>


