---
title: Уровни изоляции транзакций оптимизированные для памяти таблицы | Документация Майкрософт
ms.custom: seo-dt-2019
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 8a6a82bf-273c-40ab-a101-46bd3615db8a
author: stevestein
ms.author: sstein
ms.openlocfilehash: 5ee0ba17dc999c9076ca4622d47db28b8200b851
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87730857"
---
# <a name="transaction-isolation-levels-in-memory-optimized-tables"></a>Уровни изоляции транзакций в таблицах, оптимизированных для памяти

  Поддерживаются следующие уровни изоляции для транзакций, обращающихся к оптимизированным для памяти таблицам.  
  
-   SNAPSHOT  
  
-   REPEATABLE READ  
  
-   SERIALIZABLE  
  
-   READ COMMITTED  
  
 Уровень изоляции транзакции может быть указан как часть блока ATOMIC хранимой процедуры, скомпилированной в собственном коде. Дополнительные сведения см. в статье [CREATE PROCEDURE (Transact-SQL)](/sql/t-sql/statements/create-procedure-transact-sql). При доступе к оптимизированным для памяти таблицам из интерпретируемого [!INCLUDE[tsql](../includes/tsql-md.md)] уровень изоляции можно указать с помощью указаний уровня таблицы.  
  
 При определении скомпилированной в собственном коде хранимой процедуры необходимо указать уровень изоляции транзакции. Задание уровня изоляции в табличных указаниях требуется при доступе к оптимизированным для памяти таблицам из пользовательских транзакций в интерпретируемом [!INCLUDE[tsql](../includes/tsql-md.md)]. Дополнительные сведения см. в разделе [рекомендации по уровню изоляции транзакций с таблицами, оптимизированными для памяти](../relational-databases/in-memory-oltp/memory-optimized-tables.md).  
  
 Уровень изоляции READ COMMITTED поддерживается для оптимизированных для памяти таблиц с транзакциями с автоматической фиксацией. Использование уровня изоляции READ COMMITTED недопустимо в пользовательских транзакциях или в атомарном блоке. Для явных и неявных пользовательских транзакций не поддерживается READ COMMITTED. Уровень изоляции READ_COMMITTED_SNAPSHOT поддерживается для таблиц, оптимизированных для памяти, с транзакциями в режиме автофиксации и только в том случае, если запрос не обращается к таблицам на локальном компьютере. Кроме того, транзакции, которые запущены с использованием интерпретируемого [!INCLUDE[tsql](../includes/tsql-md.md)] с режимом изоляции SNAPSHOT, не могут получить доступ к оптимизированным для памяти таблицам. Транзакции, использующие интерпретируемый [!INCLUDE[tsql](../includes/tsql-md.md)] с уровнем изоляции REPEATABLE READ или SERIALIZABLE, должны обращаться к оптимизированным для памяти таблицам с использованием режима изоляции SNAPSHOT. Дополнительные сведения об этом сценарии см. в разделе [транзакции между контейнерами](cross-container-transactions.md).  
  
 READ COMMITTED — это уровень изоляции по умолчанию в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Если уровень изоляции сессии задан как READ COMMITED (или ниже), то можно выполнить одно из следующих действий.  
  
-   Явно используйте более высокий уровень изоляции для доступа к оптимизированной для памяти таблицы (например, WITH (SNAPSHOT)).  
  
-   Укажите параметр `MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT`, который установит уровень изоляции SNAPSHOT для оптимизированных для памяти таблиц (если бы вы добавили указание WITH (SNAPSHOT) в каждую оптимизированную для памяти таблицу). Дополнительные сведения о `MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT` см. в разделе [Параметры ALTER DATABASE SET &#40;TRANSACT-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options).  
  
 Кроме того, если уровень изоляции сессии задан как уровень изоляции READ COMMITTED, можно использовать режим автоматической фиксации транзакций.  
  
 Транзакции SNAPSHOT, запущенные в интерпретированном [!INCLUDE[tsql](../includes/tsql-md.md)], не смогут получать доступ к таблицам, оптимизированным для памяти.  
  
 Поддерживаемые для оптимизированных для памяти таблиц уровни изоляции транзакций предоставляют те же логические гарантии, что и дисковые таблицы. Механизм, используемый для предоставления гарантий уровня изоляции, — иной.  
  
 Для дисковых таблиц большинство гарантий уровня изоляции реализуются с использованием блокировки, что предотвращает конфликты через блокировку. Гарантии для оптимизированных для памяти таблиц задаются с помощью механизма обнаружения конфликтов, который исключает необходимость принимать блокировки. Исключение — режим изоляции SNAPSHOT в дисковых таблицах. Способ реализации такой же, как в режиме изоляции SNAPSHOT для оптимизированных для памяти таблиц с помощью механизма обнаружения конфликтов.  
  
 SNAPSHOT  
 Этот уровень изоляции указывает на то, что данные, считанные любой инструкцией транзакции, будут согласованы на уровне транзакции с версией данных, существовавших в ее начале. Транзакция распознает только те изменения, которые были зафиксированы до ее начала. Инструкции, выполняемые текущей транзакцией, не видят изменений данных, произведенных другими транзакциями после запуска текущей транзакции. Инструкции в транзакции получают моментальный снимок зафиксированных данных на момент запуска транзакции.  
  
 Операции записи (обновления, вставки и удаления) всегда полностью изолированы от других транзакций. Таким образом, операции записи в транзакции SNAPSHOT могут конфликтовать с операциями записи других транзакций. Если текущая транзакция пытается обновить или удалить строку, которая была обновлена или удалена другой транзакцией, зафиксированной после начала текущей транзакции, она прерывается со следующим сообщением об ошибке.  
  
 Ошибка 41302. Текущая транзакция попыталась обновить запись в таблице X, которая была изменена после начала этой транзакции. Транзакция была прервана.  
  
 Если текущая транзакция попытается вставить строку с тем же значением первичного ключа, как у строки, вставленной другой транзакцией, зафиксированной до текущей транзакции, то произойдет сбой фиксации со следующим сообщением об ошибке.  
  
 Ошибка 41325. Текущей транзакции не удалось выполнить фиксацию из-за ошибки сериализуемой проверки.  
  
 Если транзакция выполняет запись в таблицу, которая удалена до того, как транзакция зафиксирована, она прекращается со следующим сообщением об ошибке.  
  
 Ошибка 41305. Текущей транзакции не удалось выполнить фиксацию из-за ошибки проверки уровня изоляции REPEATABLE READ.  
  
 REPEATABLE READ  
 Этот уровень изоляции включает гарантии, заданные уровнем изоляции SNAPSHOT. Кроме того, REPEATABLE READ гарантирует, что для любой строки, считанной транзакцией, в момент фиксации строка не была изменена никакой другой транзакцией. Каждая операция чтения в транзакции повторяема до конца транзакции.  
  
 Если текущая транзакция прочитала любую строку, которая затем обновлена другой транзакцией, которая выполнила фиксацию до текущей транзакции, то фиксация завершается сбоем и возвращает сообщение об ошибке.  
  
 Ошибка 41305. Текущей транзакции не удалось выполнить фиксацию из-за ошибки проверки уровня изоляции REPEATABLE READ.  
  
 SERIALIZABLE  
 Этот уровень изоляции включает гарантии, предоставляемые уровнем изоляции REPEATABLE READ. Фантомные строки не появлялись между созданием моментального снимка и окончанием транзакции. Фантомные строки удовлетворяют условию фильтра выбора, обновления или удаления.  
  
 Транзакция выполняется, как будто параллельных транзакций нет. Фактически все действия выполняются в одной точке сериализации (время фиксации).  
  
 Если любая из этих гарантий нарушена, транзакции не удастся выполнить фиксацию со следующим сообщением об ошибке.  
  
 Ошибка 41325. Текущей транзакции не удалось выполнить фиксацию из-за ошибки сериализуемой проверки.  
  
## <a name="see-also"></a>См. также:  
 [Основные сведения о транзакциях в таблицах, оптимизированных для памяти](../../2014/database-engine/understanding-transactions-on-memory-optimized-tables.md)   
 [Рекомендации по уровню изоляции транзакций с таблицами, оптимизированными для памяти](../relational-databases/in-memory-oltp/memory-optimized-tables.md)   
 [Рекомендации для логики повторного выполнения транзакций для таблиц, оптимизированных для памяти](../../2014/database-engine/guidelines-for-retry-logic-for-transactions-on-memory-optimized-tables.md)  
  
  
