---
title: Управление именами входа и заданиями для баз данных группы доступности (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], deploying
- Availability Groups [SQL Server], failover
- failover [SQL Server], AlwaysOn Availability Groups
ms.assetid: d7da14d3-848c-44d4-8e49-d536a1158a61
author: rothja
ms.author: jroth
ms.openlocfilehash: 457f3ef946b5cfaf86a4a19774af63c5d7635882
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669043"
---
# <a name="management-of-logins-and-jobs-for-the-databases-of-an-availability-group-sql-server"></a><span data-ttu-id="aa8af-102">Управление именами входа и заданиями для баз данных группы доступности (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="aa8af-102">Management of Logins and Jobs for the Databases of an Availability Group (SQL Server)</span></span>
  <span data-ttu-id="aa8af-103">Необходимо постоянно поддерживать одинаковый набор имен входа пользователей и заданий агента [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] в каждой базе данных-источнике группы доступности AlwaysOn и соответствующих баз данных-получателей.</span><span class="sxs-lookup"><span data-stu-id="aa8af-103">You should routinely maintain the same set of user logins and [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Agent jobs on every primary database of an AlwaysOn availability group and the corresponding secondary databases.</span></span> <span data-ttu-id="aa8af-104">Имена входа и задания необходимо воспроизвести на каждом экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , на котором размещается реплика доступности для группы доступности.</span><span class="sxs-lookup"><span data-stu-id="aa8af-104">The logins and jobs must be reproduced on every instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] that hosts an availability replica for the availability group.</span></span>  
  
-   <span data-ttu-id="aa8af-105">**[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]Задания агента**</span><span class="sxs-lookup"><span data-stu-id="aa8af-105">**[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Agent jobs**</span></span>  
  
     <span data-ttu-id="aa8af-106">Необходимо вручную скопировать соответствующие задания с экземпляра сервера, на котором размещена исходная первичная реплика, на экземпляры серверов, где размещены исходные вторичные реплики.</span><span class="sxs-lookup"><span data-stu-id="aa8af-106">You need to manually copy relevant jobs from the server instance that hosts the original primary replica to the server instances that host the original secondary replicas.</span></span> <span data-ttu-id="aa8af-107">Для всех баз данных необходимо добавить логику в начале каждого соответствующего задания, чтобы задание выполнялось только для базы данных-источника, то есть только тогда, когда локальная реплика является первичной репликой базы данных.</span><span class="sxs-lookup"><span data-stu-id="aa8af-107">For all databases, you need to add logic at the beginning of each relevant job to make the job execute only on the primary database, that is, only when the local replica is the primary replica for the database.</span></span>  
  
     <span data-ttu-id="aa8af-108">Экземпляры серверов, на которых размещены реплики доступности для группы доступности, могут быть настроены по-разному, например с использованием других букв дисков ленточных накопителей и т. д.</span><span class="sxs-lookup"><span data-stu-id="aa8af-108">The server instances that host the availability replicas of an availability group might be configured differently, with different tape drive letters or such.</span></span> <span data-ttu-id="aa8af-109">Задания для каждой группы доступности должны допускать подобные различия.</span><span class="sxs-lookup"><span data-stu-id="aa8af-109">The jobs for each availability replica must allow for any such differences.</span></span>  
  
     <span data-ttu-id="aa8af-110">Обратите внимание, что задания резервного копирования могут использовать функцию [sys.fn_hadr_is_preferred_backup_replica](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql) , чтобы определить, является ли локальная реплика предпочтительной для выполнения резервного копирования согласно настройкам резервного копирования группы доступности.</span><span class="sxs-lookup"><span data-stu-id="aa8af-110">Notice that backup jobs can use the [sys.fn_hadr_is_preferred_backup_replica](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql) function to identify whether the local replica is the preferred one for backups, according to the availability group backup preferences.</span></span> <span data-ttu-id="aa8af-111">Задания резервного копирования, созданные с помощью [мастера планов обслуживания](../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md) , изначально используют эту функцию.</span><span class="sxs-lookup"><span data-stu-id="aa8af-111">Backup jobs created using the [Maintenance Plan Wizard](../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md) natively use this function.</span></span> <span data-ttu-id="aa8af-112">Для других заданий резервного копирования рекомендуется использовать эту функцию в качестве условия в заданиях резервного копирования, чтобы они выполнялись только для предпочитаемой реплики.</span><span class="sxs-lookup"><span data-stu-id="aa8af-112">For other backup jobs, we recommend that you use this function as a condition in your backup jobs, so they execute only on the preferred replica.</span></span> <span data-ttu-id="aa8af-113">Дополнительные сведения см. [в разделе Активные вторичные реплики: резервное копирование во вторичных копиях (группы доступности AlwaysOn)](availability-groups/windows/active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="aa8af-113">For more information, see [Active Secondaries: Backup on Secondary Replicas (AlwaysOn Availability Groups)](availability-groups/windows/active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="aa8af-114">**Имена входа**</span><span class="sxs-lookup"><span data-stu-id="aa8af-114">**Logins**</span></span>  
  
     <span data-ttu-id="aa8af-115">При использовании автономных баз данных в них вы можете настроить автономных пользователей, при этом для таких пользователей не требуется создавать имена входа на экземплярах сервера, где размещена вторичная реплика.</span><span class="sxs-lookup"><span data-stu-id="aa8af-115">If you are using contained databases, you can configure contained users in the databases, and for these users, you do not need to create logins on the server instances that host a secondary replica.</span></span> <span data-ttu-id="aa8af-116">При работе с неавтономной базой данных доступности потребуется создать пользователей для имен входа на экземплярах серверов, где размещены реплики доступности.</span><span class="sxs-lookup"><span data-stu-id="aa8af-116">For a non-contained availability database, you will need to create users for the logins on the server instances that host the availability replicas.</span></span> <span data-ttu-id="aa8af-117">Дополнительные сведения см. в разделе [CREATE USER (Transact-SQL)](/sql/t-sql/statements/create-user-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="aa8af-117">For more information, see [CREATE USER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-user-transact-sql).</span></span>  
  
     <span data-ttu-id="aa8af-118">Если какое-либо из ваших приложений использует проверку подлинности [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] или локальное имя входа Windows, см. раздел [Имена входа для приложений, использующих проверку подлинности SQL Server или локальное имя входа Windows](../../2014/database-engine/logins-and-jobs-for-availability-group-databases.md#SSauthentication).</span><span class="sxs-lookup"><span data-stu-id="aa8af-118">If any of your applications use [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Authentication or a local Windows login, see [Logins Of Applications That Use SQL Server Authentication or a Local Windows Login](../../2014/database-engine/logins-and-jobs-for-availability-group-databases.md#SSauthentication), later in this topic.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="aa8af-119">Пользователь базы данных, для которого соответствующее имя входа SQL Server не определено или задано неправильно на экземпляре сервера, не сможет подключиться к этому экземпляру.</span><span class="sxs-lookup"><span data-stu-id="aa8af-119">A database user for which the SQL Server login is undefined or is incorrectly defined on a server instance cannot log in to the instance.</span></span> <span data-ttu-id="aa8af-120">Такой пользователь называется *утратившим связь с учетной записью* базы данных на этом экземпляре сервера.</span><span class="sxs-lookup"><span data-stu-id="aa8af-120">Such a user is said to be an *orphaned user* of the database on that server instance.</span></span> <span data-ttu-id="aa8af-121">Если пользователь утратил связь с данным экземпляром базы данных, то в любое время можно настроить имена входа для этого пользователя.</span><span class="sxs-lookup"><span data-stu-id="aa8af-121">If a user is orphaned on a given server instance, you can set up the user logins at any time.</span></span> <span data-ttu-id="aa8af-122">Дополнительные сведения см. в статье [Диагностика пользователей, утративших связь с учетной записью (SQL Server)](../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="aa8af-122">For more information, see [Troubleshoot Orphaned Users &#40;SQL Server&#41;](../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md).</span></span>  
  
-   <span data-ttu-id="aa8af-123">**Дополнительные метаданные**</span><span class="sxs-lookup"><span data-stu-id="aa8af-123">**Additional metadata**</span></span>  
  
     <span data-ttu-id="aa8af-124">Имена входа и задания — это не единственные сведения, которые должны быть созданы повторно на каждом экземпляре сервера, размещающем вторичную реплику доступности.</span><span class="sxs-lookup"><span data-stu-id="aa8af-124">Logins and jobs are not the only information that need to be recreated on each of the server instances that hosts an secondary replica for a given availability group.</span></span> <span data-ttu-id="aa8af-125">Например, возможно, потребуется воссоздать параметры конфигурации сервера, учетные данные, зашифрованные данные, разрешения и параметры репликации, приложения компонента Service Broker, триггеры уровня сервера и т. д.</span><span class="sxs-lookup"><span data-stu-id="aa8af-125">For example, you might need to recreate server configuration settings, credentials, encrypted data, permissions, replication settings, service broker applications, triggers (at server level), and so forth.</span></span> <span data-ttu-id="aa8af-126">Дополнительные сведения см. в статье [Управление метаданными при обеспечении доступности базы данных на другом экземпляре сервера (SQL Server)](../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span><span class="sxs-lookup"><span data-stu-id="aa8af-126">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span></span>  
  
##  <a name="logins-of-applications-that-use-sql-server-authentication-or-a-local-windows-login"></a><a name="SSauthentication"></a> <span data-ttu-id="aa8af-127">Имена входа для приложений, использующих проверку подлинности SQL Server или локальное имя входа Windows</span><span class="sxs-lookup"><span data-stu-id="aa8af-127">Logins Of Applications That Use SQL Server Authentication or a Local Windows Login</span></span>  
 <span data-ttu-id="aa8af-128">Если приложение использует проверку подлинности SQL Server или локальное имя входа Windows, то несоответствие идентификаторов безопасности может привести к ошибке входа на удаленный экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="aa8af-128">If an application uses SQL Server Authentication or a local Windows login, mismatched SIDs can prevent the application's login from resolving on a remote instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="aa8af-129">Несоответствие идентификаторов безопасности вызывает утрату связи с учетной записью на удаленном экземпляре сервера.</span><span class="sxs-lookup"><span data-stu-id="aa8af-129">The mismatched SIDs cause the login to become an orphaned user on the remote server instance.</span></span> <span data-ttu-id="aa8af-130">Эта проблема может возникать при подключении приложения к зеркальной базе данных или базе данных доставки журналов после отработки отказа либо к базе данных подписчика репликации, которая была инициализирована из резервной копии.</span><span class="sxs-lookup"><span data-stu-id="aa8af-130">This issue can occur when an application connects to a mirrored or log shipping database after a failover or to a replication subscriber database that was initialized from a backup.</span></span>  
  
 <span data-ttu-id="aa8af-131">Во избежание этой проблемы рекомендуется предпринять профилактические меры во время настройки такого приложения на использование базы данных, размещенной на удаленном экземпляре [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="aa8af-131">To prevent this issue, we recommend that you take preventative measures when you set up such an application to use a database that is hosted by a remote instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="aa8af-132">Среди таких мер — перенос имен входа и паролей с локального экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] на удаленный экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="aa8af-132">Prevention involves transferring the logins and the passwords from the local instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to the remote instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="aa8af-133">Дополнительные сведения о предотвращении этой проблемы см. в статье базы знаний 918992 —[как передавать имена входа и пароли между экземплярами SQL Server](https://support.microsoft.com/kb/918992/)).</span><span class="sxs-lookup"><span data-stu-id="aa8af-133">For more information about how to prevent this issue, see KB article 918992-[How to transfer the logins and the passwords between instances of SQL Server](https://support.microsoft.com/kb/918992/)).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="aa8af-134">Эта проблема затрагивает локальные учетные записи Windows на разных компьютерах.</span><span class="sxs-lookup"><span data-stu-id="aa8af-134">This problem affects Windows local accounts on different computers.</span></span> <span data-ttu-id="aa8af-135">Для доменных учетных записей эта проблема не возникает, поскольку идентификатор безопасности там один для всех компьютеров.</span><span class="sxs-lookup"><span data-stu-id="aa8af-135">However, this problem does not occur for domain accounts because the SID is the same on each of the computers.</span></span>  
  
 <span data-ttu-id="aa8af-136">Дополнительные сведения см. в записи [Пользователи, утратившие связь с учетной записью при работе с зеркальным отображением базы данных и доставкой журналов](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (блог Database Engine).</span><span class="sxs-lookup"><span data-stu-id="aa8af-136">For more information, see [Orphaned Users with Database Mirroring and Log Shipping](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (a Database Engine blog).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="aa8af-137">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="aa8af-137">Related Tasks</span></span>  
  
-   [<span data-ttu-id="aa8af-138">Создание имени входа</span><span class="sxs-lookup"><span data-stu-id="aa8af-138">Create a Login</span></span>](../relational-databases/security/authentication-access/create-a-login.md)  
  
-   <span data-ttu-id="aa8af-139">[Создайте пользователя базы данных](../relational-databases/security/authentication-access/create-a-database-user.md).</span><span class="sxs-lookup"><span data-stu-id="aa8af-139">[Create a Database User](../relational-databases/security/authentication-access/create-a-database-user.md).</span></span>  
  
-   [<span data-ttu-id="aa8af-140">Создание задания</span><span class="sxs-lookup"><span data-stu-id="aa8af-140">Create a Job</span></span>](../ssms/agent/create-a-job.md)  
  
-   [<span data-ttu-id="aa8af-141">Управление метаданными при обеспечении доступности базы данных на другом экземпляре сервера (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="aa8af-141">Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;</span></span>](../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="aa8af-142">См. также:</span><span class="sxs-lookup"><span data-stu-id="aa8af-142">See Also</span></span>  
 <span data-ttu-id="aa8af-143">[Общие сведения о группы доступности AlwaysOn &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="aa8af-143">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="aa8af-144">[Автономные базы данных](../relational-databases/databases/contained-databases.md) </span><span class="sxs-lookup"><span data-stu-id="aa8af-144">[Contained Databases](../relational-databases/databases/contained-databases.md) </span></span>  
 [<span data-ttu-id="aa8af-145">Создание заданий</span><span class="sxs-lookup"><span data-stu-id="aa8af-145">Create Jobs</span></span>](../ssms/agent/create-jobs.md)  
  
  
