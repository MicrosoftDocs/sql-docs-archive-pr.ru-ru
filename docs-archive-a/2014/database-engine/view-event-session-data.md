---
title: Просмотр данных сеанса событий | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
ms.assetid: ac742a01-2a95-42c7-b65e-ad565020dc49
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: eaeb5fd22b95b8f1056b8dce9e3c7d683b52602f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87750103"
---
# <a name="view-event-session-data"></a>Просмотр данных о сеансе событий
  В этом разделе описывается использование пользовательского интерфейса для просмотра и анализа данных расширенных событий.  
  
-   Просмотр целевых данных  
  
-   Работа с данными  
  
## <a name="view-target-data"></a>Просмотр целевых данных  
 Собранные данные можно отобразить в указанном целевом объекте в среде [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)].  
  
### <a name="view-target-data"></a>Просмотр целевых данных  
 Для просмотра целевых данных выполните следующие действия.  
  
1.  В обозревателе объектов разверните узлы **Управление**, **Расширенные события**и **Сеансы**, а затем разверните сеанс.  
  
2.  Щелкните правой кнопкой мыши целевое имя, затем выберите **Просмотр целевых данных** , чтобы отобразить целевые данные.  
  
     В представлении по умолчанию отобразится окно целевых данных с целевыми данными.  
  
 Примечания по просмотру целевых данных.  
  
-   Целевые данные недоступны для цели трассировки событий Windows.  
  
-   Чтобы просматривать данные ring_buffer в формате XML, выберите в окне целевых данных ссылку **целевые данные ring_buffer** . Файл ring_buffer.xml откроется в редакторе XML.  
  
-   Для целевого объекта event_file XEL-файл с данными можно просматривать одним из следующих методов.  
  
    -   Используйте файловый > открыть в [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)] .
    
    -   Перетащите файл в [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)] . 
    
    -   Дважды щелкнуть XEL-файл.  
    
    -   В среде [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)]щелкните правой кнопкой мыши работающий сеанс расширенных событий и выберите пункт «Просмотр целевых данных». 
    
    -   [fn_xe_file_target_read_file](/sql/relational-databases/system-functions/sys-fn-xe-file-target-read-file-transact-sql).
    
    -   Используйте PowerShell Read-Склксевент в [модуле SQLServer. XEvent](https://www.powershellgallery.com/packages/SqlServer.XEvent).
    
    -   Программное использование XEvents с помощью [Кселите NuGet](https://www.nuget.org/packages/Microsoft.SqlServer.XEvent.XELite).
    
    -   Можно просмотреть более одного. XEL-файл, выбрав команду **объединить файлы расширенных событий** в меню файл-> открыть.

### <a name="watching-live-data"></a>Просмотр данных, передаваемых в режиме реального времени  
 Можно просматривать данные, передаваемые в режиме реального времени, в ходе их записи.  
  
-   В обозревателе объектов разверните узлы **Управление**, **Расширенные события**и **сеансы** .  

-   Щелкните правой кнопкой мыши имя сеанса, а затем выберите пункт **Просмотр данных, передаваемых в режиме реального времени** для начала отображения данных трассировки.  
  
     По умолчанию отображаются столбцы **Имя события** и **Отметка времени**.  
  
     Для добавления дополнительных столбцов к окну трассировки нажмите кнопку **Выбрать столбцы** на панели инструментов «Расширенные события». На вкладке **Сведения** отображаются все сведения о событии для выбранного события.  
  
     Обычно события отображаются приблизительно через 30 секунд. Если требуется изменить период задержки, то можно изменить параметр **Максимальная задержка диспетчера** на странице **Расширенные** в диалоговом окне **Новый сеанс** .  
     
-    Данные в реальном времени могут передаваться [модулем PowerShell SQLServer. XEvent](https://www.powershellgallery.com/packages/SqlServer.XEvent).
     
### <a name="to-refresh-target-data"></a>Обновление целевых данных  
 Обновление целевых данных не поддерживается для объектов event_files.  
  
1.  Чтобы целевые данные обновлялись автоматически, щелкните их правой кнопкой мыши, выберите **Интервал обновления**, затем выберите нужный интервал из списка.  
  
2.  Чтобы приостановить и возобновить автоматическое обновление, щелкните правой кнопкой мыши целевые данные и выберите **Пауза** или **Возобновить**.  
  
3.  Чтобы обновить целевые данные вручную, щелкните их правой кнопкой мыши и выберите **Обновить**.  
  
## <a name="working-with-data"></a>Работа с данными  
 Возможности анализа, доступные в пользовательском интерфейсе расширенных событий, позволяют выявлять проблемы.  
  
### <a name="details-pane"></a>Панель сведений  
 В области **Сведения** показаны все столбцы для выбранного события, включая поля и действия. Чтобы добавить столбец в таблицу целевых данных, щелкните правой кнопкой мыши строку в области **Сведения** и выберите пункт **Показать столбец в таблице**.  
  
### <a name="create-modify-or-delete-merged-columns"></a>Создание, изменение и удаление объединенных столбцов  
 Объединенный столбец позволяет объединить набор полей и отображать их в одном столбце. В объединенном столбце данные показываются, начиная с первого поля со значением, отличным от NULL, в порядке добавления в список полей. Это аналогично представлению в приложении [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Profiler, где данные в некотором столбце могут отображаться по-разному в зависимости от события (наиболее распространенным примером служит поле TextData в приложении [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Profiler). Например, можно объединить поля statement и batch_text из событий sql_statement_completed и sql_batch_completed в поле с именем myStatement. В столбце myStatement, отображаемом в таблице, будут показаны данные, соответствующие связанному событию.  
  
 Объединенные столбцы можно создавать, изменять и удалять.  
  
1.  Откройте XEL-файл для просмотра результатов трассировки. (Также можно щелкнуть правой кнопкой мыши имя сеанса и выбрать пункт **Показать данные, передаваемые в режиме реального времени**.)  
  
2.  В окне результатов трассировки щелкните правой кнопкой мыши заголовок столбца и выберите команду **Выбрать столбцы**.  
  
 Чтобы создать объединенный столбец, нажмите кнопку **Создать** в диалоговом окне **Выбор столбцов** .  В диалоговом окне **Новый объединенный столбец** задайте имя для столбца и выберите исходные столбцы для включения в объединенный столбец.  
  
 Чтобы изменить объединенный столбец, выберите его в диалоговом окне **Выбор столбцов** и нажмите кнопку **Изменить**. В диалоговом окне **Изменение объединенного столбца** измените имя столбца или измените исходные столбцы для включения в объединенный столбец.  
  
 Чтобы удалить объединенный столбец, выберите его в диалоговом окне **Выбор столбцов** и нажмите кнопку **Удалить**.  
  
### <a name="filter-results"></a>Фильтрация результатов  
 Можно просмотреть результаты трассировки и применить фильтры, чтобы уменьшить объем результатов, отображаемых в окне трассировки. Фильтр отображения включает в себя фильтр времени и расширенный фильтр. Для фильтрации результатов трассировки по отметкам времени событий используется фильтр времени, а для создания условий фильтра с использованием полей события и действий — дополнительный фильтр. Между фильтрами времени и дополнительными фильтрами определено отношение И.  
  
 Чтобы создать фильтр, сделайте следующее:  
  
1.  Откройте XEL-файл для просмотра результатов трассировки. (Также можно щелкнуть правой кнопкой мыши имя сеанса и выбрать пункт **Показать данные, передаваемые в режиме реального времени**.)  
  
2.  В окне результатов трассировки выберите результаты, которые необходимо отфильтровать, а затем на панели инструментов **Расширенные события** нажмите кнопку **Фильтры**.  
  
3.  В диалоговом окне **Фильтры** выберите команду **Задать фильтр времени** , чтобы установить фильтр времени, перетаскивая ползунки или изменяя время в поле ввода.  
  
4.  В разделе **Дополнительные фильтры** примените требуемые условия фильтра и нажмите кнопку **Применить**.  
  
### <a name="sort-results"></a>Сортировка результатов  
 Сортировка результатов по возрастанию или убыванию  
  
1.  Откройте XEL-файл для просмотра результатов трассировки. (Также можно щелкнуть правой кнопкой мыши имя сеанса, выбрать пункт **Просмотр данных, передаваемых в режиме реального времени**, а затем нажать кнопку **Остановить поток данных** на панели инструментов.)  
  
2.  В окне с результатами трассировки щелкните правой кнопкой мыши заголовок столбца, который нужно отсортировать, и выберите пункт **Сортировка по возрастанию** или **Сортировка по убыванию**.  
  
 Можно также щелкнуть любой заголовок столбца, чтобы изменить порядок сортировки.  
  
 Если имеются сгруппированные столбцы, то сортировка столбца приводит лишь к сортировке данных в пределах группы.  
  
### <a name="group-results"></a>Группирование результатов  
 Возможности группировки результатов эквивалентны функциям предложения `GROUP BY` в [!INCLUDE[tsql](../includes/tsql-md.md)]. В таблице целевых данных данные будут сгруппированы с возможностью разворачивания и сворачивания.  
  
 Перед агрегатной обработкой данные необходимо сгруппировать. Например, можно выполнить группирование по значению query_hash, отсортировать по убыванию продолжительности, получить среднюю продолжительность для каждой группы, а затем отсортировать по убыванию агрегатного значения.  В результате получится список уникальных инструкций, идущих от самой большой до самой маленькой средней продолжительности. После развертывания верхней группы отображаются отдельные выполнения заданного запроса, отсортированные от самого длительного к самому короткому.  
  
 Результаты можно группировать по одному или по нескольким столбцам.  
  
 Откройте XEL-файл для просмотра результатов трассировки. (Также можно щелкнуть правой кнопкой мыши имя сеанса, выбрать пункт **Просмотр данных, передаваемых в режиме реального времени**, а затем нажать кнопку **Остановить поток данных** на панели инструментов.)  
  
 Чтобы сгруппировать результаты по одному столбцу, щелкните правой кнопкой мыши заголовок столбца в окне результатов трассировки и выберите пункт **Группировать по этому столбцу**. Чтобы отменить группирование, выберите одну из строк и нажмите кнопку **Отменить все группирование**.  
  
 Чтобы сгруппировать результаты по нескольким столбцам, нажмите кнопку **Группирование** на панели инструментов **Расширенные события** . В поле **Доступные столбцы** диалогового окна **Группирование** выберите столбцы, которые нужно сгруппировать, и переместите их в поле **Столбцы, сгруппированные по** . Чтобы изменить порядок группирования в поле **Столбцы, сгруппированные по** , используйте кнопки со стрелками вверх и вниз.  
  
### <a name="aggregate-results"></a>Агрегатная обработка результатов  
 Можно просматривать результаты трассировки, а затем подвергать дополнительному анализу данные события, применяя статистическую обработку к столбцам в результатах. Расширенные события поддерживают пять агрегатных функций:  
  
-   Sum  
  
-   Min  
  
-   max  
  
-   average  
  
-   count (счетчик)  
  
 Функции sum, min, max и average можно использовать только для числовых столбцов. Count — это количество не равных NULL значений, имеющихся в выбранном столбце в группе.  
  
 Агрегатная обработка применяется к группе, поэтому перед ней необходимо сгруппировать результаты. Агрегатная обработка результатов  
  
1.  Откройте XEL-файл для просмотра результатов трассировки. (Также можно щелкнуть правой кнопкой мыши имя сеанса, выбрать пункт **Просмотр данных, передаваемых в режиме реального времени**, а затем нажать кнопку **Остановить поток данных** на панели инструментов.)  
  
2.  На панели инструментов **Расширенные события** нажмите кнопку **Статистическая обработка** . В диалоговом окне «Статистическая обработка» появятся столбцы, доступные для агрегатной обработки.  
  
3.  В столбце **Тип статистической обработки** выберите тип обработки.  
  
4.  В поле **Сортировать результаты статистической обработки по** выберите столбец для сортировки. Затем выберите порядок: по возрастанию или по убыванию.  
  
### <a name="search-for-text-in-columns"></a>Поиск текста в столбцах  
 В столбцах можно искать текст.  
  
1.  Откройте XEL-файл для просмотра результатов трассировки. (Также можно щелкнуть правой кнопкой мыши имя сеанса и выбрать пункт **Показать данные, передаваемые в режиме реального времени**.)  
  
2.  Нажмите кнопку **Найти** на панели инструментов **Расширенные события** .  
  
3.  В поле **Найти** диалогового окна **Найти в расширенных событиях** введите текст для поиска. В раскрывающемся списке можно выбрать одну из 20 последних строк поиска.  
  
4.  В поле **Искать в** выберите расположение для поиска указанного текста. Можно использовать следующие параметры для поиска:  
  
    -   Столбцы таблицы. Этот параметр служит для поиска всех видимых столбцов в окне трассировки.  
  
    -   Сведения. Этот параметр используется для поиска в окне трассировки всех столбцов (повышенных и неповышенных), которые были выбраны перед открытием диалогового окна **найти в расширенных событиях** .  
  
    -   *Event_column_name*. Этот параметр служит для поиска в столбце определенного события из раскрывающегося списка.  
  
5.  Чтобы указать, как должен быть определен поиск, можно также задать следующие параметры:  
  
    -   Учитывать регистр. Этот параметр используется для отображения результатов поиска текста, введенного в поле Найти, которые согласуются с ним и по содержанию, и по регистру.  
  
    -   Слово целиком. Этот параметр служит для отображения результатов поиска введенного текста, которые согласуются с полными словами.  
  
    -   Поиск назад. Этот параметр используется для поиска от местоположения курсора к началу результатов.  
  
    -   Назначение. Этот параметр указывает, каким образом следует интерпретировать специальные символы и регулярные выражения, введенные в поле Найти. Специальные символы — это символы-шаблоны (*) и (?), представляющие один или нескольких символов. Регулярные выражения представляют собой специальные обозначения, используемые для определения искомого текста с помощью шаблонов.  
  
    -   Щелкните **Найти далее** , чтобы найти следующее вхождение текста, введенного в поле **Найти** .  
  
### <a name="bookmarks"></a>Закладки  
 Чтобы упростить возврат к строке, можно создать закладку для одной или нескольких строк в целевых данных. Чтобы изменить закладку, щелкните строку правой кнопкой мыши. Для перехода к строкам с закладками используйте кнопки «Назад» и «Далее» на панели инструментов **Расширенные события** .  
  
### <a name="change-display-settings"></a>Изменение параметров отображения  
 Можно сохранить сведения о столбцах (порядок столбцов, объединенный столбец и ширина столбца) и отфильтрованные результаты трассировки в файле параметров представления «Расширенные события» (VIEWSETTING-файл). После сохранения файла можно его использовать для трассировки результатов и изменения представления.  
  
 Изменение параметров отображения  
  
1.  Откройте XEL-файл для просмотра результатов трассировки. (Также можно щелкнуть правой кнопкой мыши имя сеанса и выбрать пункт **Показать данные, передаваемые в режиме реального времени**.)  
  
2.  На панели инструментов **Расширенные события** нажмите кнопку **Параметры отображения**. Выберите один из следующих параметров из раскрывающегося списка.  
  
    -   Сохранить как. Сохраните столбцы и сведения о результатах трассировки в файле .viewsetting.  
  
    -   Открытие. Открыть существующий VIEWSETTING-файл.  
  
    -   Открыть последний. Открыть недавно сохраненный VIEWSETTING-файл.  
  
### <a name="copy-or-export-trace-results"></a>Копирование или экспорт результатов трассировки  
 Можно копировать ячейки, строки и подробные сведения в выбранные строки из результатов трассировки. Кроме того, можно экспортировать результаты трассировки следующим образом:  
  
-   в XEL-файл  
  
-   table  
  
-   в CSV-файл  
  
 Чтобы скопировать результаты трассировки, выделите ячейку, строку или строки, щелкните правой кнопкой мыши, выберите команду **Копировать** , а затем выберите пункт **Ячейка**, **Строка**или **Сведения**. Расширенные события поддерживают копирование максимум 1000 строк.  
  
 Результаты трассировки можно экспортировать в XEL-файл, в таблицу или в CSV-файл, выбрав команду **Экспорт** в меню **Расширенные события** среды [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)].  
  
### <a name="view-a-deadlock-graph-and-query-plans"></a>Просмотр графика взаимоблокировок и планов запроса  
 Для устранения неполадок с взаимоблокировками можно просматривать график взаимоблокировки для **xml_deadlock_report** на панели «Сведения». Можно также просматривать графики плана запросов для следующих событий:  
  
-   query_post_compilation_showplan  
  
-   query_pre_execution_showplan  
  
-   query_post_execution_showplan  
  
 Просмотр графика взаимоблокировок  
  
-   В обозревателе объектов разверните узлы **Управление**, **Расширенные события**и **сеансы** .  
  
-   Щелкните правой кнопкой мыши сеанс, содержащий настроенное событие взаимоблокировки, которые необходимо просматривать, а затем выберите пункт **Просмотр данных, передаваемых в режиме реального времени**.  
  
-   Выберите событие взаимоблокировки и просмотрите график на вкладке **Взаимоблокировка** в области сведений.  
  
 Просмотр графиков плана запроса  
  
1.  В обозревателе объектов разверните узлы **Управление**, **Расширенные события**и **сеансы** .  
  
2.  Щелкните правой кнопкой мыши сеанс, содержащий график плана запроса, который необходимо просматривать (например, query_post_compilation_showplan), а затем выберите пункт **Просмотр данных, передаваемых в режиме реального времени**.  
  
3.  Выберите событие графика плана запроса (например, query_post_compilation_showplan) и просмотрите график на вкладке **План запроса** в области сведений.  
  
  
