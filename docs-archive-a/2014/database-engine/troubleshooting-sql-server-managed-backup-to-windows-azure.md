---
title: Устранение неполадок SQL Server управляемого резервного копирования в Azure | Документация Майкрософт
description: В этой статье описываются задачи и средства, которые можно использовать для устранения ошибок, которые могут возникнуть во время SQL Server управляемого резервного копирования для Microsoft Azure операций.
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: a34d35b0-48eb-4ed1-9f19-ea14754650da
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: 9c7ed5dd25ed2b02445bfae5eb78ac03b2270552
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87732894"
---
# <a name="troubleshooting-sql-server-managed--backup-to-azure"></a><span data-ttu-id="4f5b5-103">Устранение неполадок с управляемым резервным копированием SQL Server в Azure</span><span class="sxs-lookup"><span data-stu-id="4f5b5-103">Troubleshooting SQL Server Managed  Backup to Azure</span></span>
  <span data-ttu-id="4f5b5-104">В этом разделе описываются задачи и средства, позволяющие устранять ошибки, которые могут возникнуть при выполнении операций [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4f5b5-104">This topic describes the tasks and tools you can use to troubleshoot errors that may occur during [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] operations.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="4f5b5-105">Обзор</span><span class="sxs-lookup"><span data-stu-id="4f5b5-105">Overview</span></span>  
 <span data-ttu-id="4f5b5-106">В [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] есть встроенные проверки и процедуры устранения неполадок, поэтому во многих случаях внутренними сбоями занимается сам процесс [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4f5b5-106">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] has built in checks and troubleshooting, so in many cases internal failures are taken care of by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] process itself.</span></span>  
  
 <span data-ttu-id="4f5b5-107">Примером такого случая является удаление файла резервной копии, что привело к разрыву цепочки журналов, влияющей на возможность восстановления [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] . будет определять перерыв в цепочке журналов и планировать резервное копирование немедленно.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-107">Example of one such case is a deletion of a backup file resulting in a break of the log chain affecting recoverability - [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will identify the break in log chain and schedule a backup to be taken immediately.</span></span> <span data-ttu-id="4f5b5-108">Однако рекомендуется отслеживать состояние и устранять все ошибки, требующие вмешательства пользователя.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-108">However we recommend that you monitor the status and address any errors that require manual intervention.</span></span>  
  
 <span data-ttu-id="4f5b5-109">В журналы [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] записываются события и ошибки с использованием системных хранимых процедур, системных представлений и расширенных событий.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-109">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] logs events and errors using system stored procedures, system views and extended events.</span></span> <span data-ttu-id="4f5b5-110">Системные представления и хранимые процедуры предоставляют данные конфигурации [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], состояние запланированных операций резервного копирования, а также ошибки, зарегистрированные расширенными событиями.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-110">System views and stored procedures provide [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configuration information, status of backup scheduled backups, and also the errors captured by Extended Events.</span></span> [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] <span data-ttu-id="4f5b5-111">использует расширенные события для регистрации событий и последующего устранения неполадок.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-111">uses Extended Events to capture the errors to use for troubleshooting.</span></span> <span data-ttu-id="4f5b5-112">Помимо регистрации событий политики SQL Server Smart Admin предоставляют состояние работоспособности, используемое заданием уведомления по электронной почте для отправки уведомлений об ошибках и проблемах.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-112">In addition to logging events, SQL Server Smart Admin Policies provide a health status which is used by an email notification job to provide notification or errors and issues.</span></span> <span data-ttu-id="4f5b5-113">Дополнительные сведения см. [в статье мониторинг SQL Server управляемого резервного копирования в Azure](../relational-databases/backup-restore/sql-server-managed-backup-to-microsoft-azure.md).</span><span class="sxs-lookup"><span data-stu-id="4f5b5-113">For more information see [Monitor SQL Server Managed Backup to Azure](../relational-databases/backup-restore/sql-server-managed-backup-to-microsoft-azure.md).</span></span>  
  
 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]<span data-ttu-id="4f5b5-114">также использует то же ведение журнала, которое используется при ручном резервном копировании в службу хранилища Azure (SQL Server резервное копирование на URL-адрес).</span><span class="sxs-lookup"><span data-stu-id="4f5b5-114">also uses the same logging that is used when manually backing up to Azure storage (SQL Server Backup to URL).</span></span> <span data-ttu-id="4f5b5-115">Дополнительные сведения о проблемах резервного копирования по URL-адресу см. в разделе Устранение неполадок статьи [SQL Server резервное копирование в URL-адрес рекомендации и устранение неполадок](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md) .</span><span class="sxs-lookup"><span data-stu-id="4f5b5-115">For more information on Backup to URL related issues, see the troubleshooting section in [SQL Server Backup to URL Best Practices and Troubleshooting](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md)</span></span>  
  
### <a name="general-troubleshooting-steps"></a><span data-ttu-id="4f5b5-116">Основные шаги диагностики</span><span class="sxs-lookup"><span data-stu-id="4f5b5-116">General Troubleshooting Steps</span></span>  
  
1.  <span data-ttu-id="4f5b5-117">Включите уведомление по электронной почте, чтобы получать сообщения с ошибками и предупреждениями.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-117">Enable Email Notification to start to receive emails for error and warnings.</span></span>  
  
     <span data-ttu-id="4f5b5-118">Кроме того, можно периодически выполнять `smart_admin.fn_get_health_status` для проверки статистических ошибок и счетчиков.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-118">Alternatively, you can also periodically run `smart_admin.fn_get_health_status` to check the aggregated errors and counts.</span></span> <span data-ttu-id="4f5b5-119">Например, `number_of_invalid_credential_errors` указывает, сколько раз резервное копирование Smart Backup завершилось с ошибкой из-за неверных учетных данных.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-119">For example, `number_of_invalid_credential_errors` is the number of times smart backup attempted a backup but got invalid credential error.</span></span> <span data-ttu-id="4f5b5-120">`Number_of_backup_loops` и `number_of_retention_loops` не являются ошибками, но указывают, сколько раз поток резервного копирования и поток хранения сканировали список баз данных.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-120">`Number_of_backup_loops` and `number_of_retention_loops` are not errors; but they indicate the number of times backup thread and retention thread scanned the list of databases.</span></span> <span data-ttu-id="4f5b5-121">Как правило, когда @begin_time и @end_time не предоставляется, функция отображает сведения за последние 30 минут, а затем обычно для этих двух столбцов должны отображаться ненулевые значения.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-121">Typically, when @begin_time and @end_time are not provided, the function is showing the information from last 30 minutes, then we should normally see non-zero values for these two columns.</span></span> <span data-ttu-id="4f5b5-122">Если они равны нулю, это означает, что система перегружена или даже не отвечает.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-122">If they are zero then it implies system overloaded or even system not responding.</span></span> <span data-ttu-id="4f5b5-123">Дополнительные сведения см. в подразделе **Устранение неполадок системы** далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-123">For more information, see **Troubleshooting System Issues** section later in this topic.</span></span>  
  
2.  <span data-ttu-id="4f5b5-124">Изучите журналы расширенных событий, чтобы получить дополнительные сведения об ошибках и связанных событиях.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-124">Review the Extended Event logs to learn more details on the errors and other associated events.</span></span>  
  
3.  <span data-ttu-id="4f5b5-125">Данные в журналах помогут устранить проблему.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-125">Use the information in the logs to resolve the issue.</span></span>  <span data-ttu-id="4f5b5-126">В случае системной проблемы или ошибки, возможно, придется перезапустить службу или агент SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-126">In case of a system issue or error, you may need to restart the service or SQL Server Agent.</span></span>  
  
### <a name="common-causes-of-errors"></a><span data-ttu-id="4f5b5-127">Распространенные причины появления ошибок</span><span class="sxs-lookup"><span data-stu-id="4f5b5-127">Common Causes of Errors</span></span>  
 <span data-ttu-id="4f5b5-128">Далее представлен список распространенных причин, приводящих к сбоям.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-128">Following is the list of common causes resulting in failures:</span></span>  
  
1.  <span data-ttu-id="4f5b5-129">**Изменения в учетных данных SQL:** Если имя учетных данных, используемое, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] изменилось или удалено, то [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] не сможет создавать резервные копии.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-129">**Changes to SQL Credential:** If the name of the credential used by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is changed or if it is deleted, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will not be able to take backups.</span></span> <span data-ttu-id="4f5b5-130">Изменение должно быть применено к параметрам конфигурации [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4f5b5-130">The change should be applied to [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configuration settings.</span></span>  
  
2.  <span data-ttu-id="4f5b5-131">**Изменения в значениях ключа доступа к хранилищу:** Если значения ключа хранилища изменены для учетной записи Azure, но учетные данные SQL не обновляются новыми значениями, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] будут завершаться ошибкой при проверке подлинности в хранилище и не смогут создать резервные копии баз данных, настроенных для использования этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-131">**Changes to storage access key values:** If the storage key values are changed for the Azure account, but SQL Credential is not updated with the new values, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will fail when authenticating to the storage, and fails to backup databases configured to use this account.</span></span>  
  
3.  <span data-ttu-id="4f5b5-132">**Изменения в учетной записи хранения Azure:** Удаление или переименование учетной записи хранения без соответствующих изменений учетных данных SQL приведет [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] к сбою и резервные копии не будут выполняться.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-132">**Changes to Azure Storage Account:** Deleting or renaming storage account without corresponding changes to the SQL Credential will cause [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] to fail and no backups will be taken.</span></span> <span data-ttu-id="4f5b5-133">При удалении учетной записи хранения убедитесь, что в настройки баз данных будут внесены сведения о действительной учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-133">If you delete a storage account, ensure that the databases are reconfigured with valid storage account information.</span></span> <span data-ttu-id="4f5b5-134">Если учетная запись хранения переименована или меняются значения ключей, убедитесь в том, что эти изменения отражены в учетных данных SQL, используемых [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4f5b5-134">If a storage account is renamed or the key values are changed, ensure that these changes are reflected in the SQL Credential used by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span>  
  
4.  <span data-ttu-id="4f5b5-135">**Изменения в свойствах базы данных:** Внесение изменений в модели восстановления или изменение имени может привести к сбою резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-135">**Changes to Database Properties:** Changes to recovery models or changing the name can cause backups to fail.</span></span>  
  
5.  <span data-ttu-id="4f5b5-136">**Изменения в модели восстановления:** Если модель восстановления базы данных изменена на Simple с полной или с неполным протоколированием, резервные копии будут прекращаться, а базы данных будут пропущены [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4f5b5-136">**Changes to Recovery Model:** If the recovery model of the database is changed to simple from full or bulk-logged, backups will stop, and the databases will be skipped by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="4f5b5-137">Дополнительные сведения см [. в статье SQL Server управляемое резервное копирование в Azure: взаимодействие и сосуществование.](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-interoperability-and-coexistence.md)</span><span class="sxs-lookup"><span data-stu-id="4f5b5-137">For more information, see [SQL Server Managed Backup to Azure: Interoperability and Coexistence](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-interoperability-and-coexistence.md)</span></span>  
  
### <a name="most-common-error-messages-and-solutions"></a><span data-ttu-id="4f5b5-138">Самые распространенные сообщения об ошибках и способы их устранения</span><span class="sxs-lookup"><span data-stu-id="4f5b5-138">Most Common Error Messages and Solutions</span></span>  
  
1.  <span data-ttu-id="4f5b5-139">**Ошибки при включении или настройке [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] :**</span><span class="sxs-lookup"><span data-stu-id="4f5b5-139">**Errors when enabling or configuring [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]:**</span></span>  
  
     <span data-ttu-id="4f5b5-140">Ошибка: "не удалось получить доступ к URL-адресу хранилища... Укажите допустимые учетные данные SQL... ": вы можете увидеть эту и другие аналогичные ошибки, ссылающиеся на учетные данные SQL.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-140">Error: " Failed to access the storage URL.... Provide a valid SQL Credential..." : You may see this and other similar errors referring to SQL Credentials.</span></span>  <span data-ttu-id="4f5b5-141">В таких случаях проверьте имя предоставленных учетных данных SQL, а также сведения, хранящиеся в учетных данных SQL — имя учетной записи хранения и ключ доступа к хранилищу, и убедитесь, что они являются актуальными и допустимыми.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-141">In such cases, review the name of the SQL Credential you provided, and also the information stored in the SQL Credential - the storage account name, and the storage access key and make sure that they are current and valid.</span></span>  
  
     <span data-ttu-id="4f5b5-142">Ошибка: "... не удается настроить базу данных... так как это системная база данных ": вы увидите эту ошибку при попытке включить [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] для системной базы данных.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-142">Error: "... cannot configure the database....because it is a system database": You will see this error if you try to enable [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for a system database.</span></span>  [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] <span data-ttu-id="4f5b5-143">не поддерживает резервные копии для системных баз данных.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-143">does not support backups for system databases.</span></span>  <span data-ttu-id="4f5b5-144">Чтобы настроить резервное копирование для системных баз данных, используйте другие технологии резервного копирования SQL Server, например планы обслуживания.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-144">To configure backup for a system database use other SQL Server Backup technologies such as maintenance plans.</span></span>  
  
     <span data-ttu-id="4f5b5-145">Ошибка: "... Укажите срок хранения.... ": вы можете столкнуться с ошибками, связанными с сроком хранения, если вы не указали срок хранения для базы данных или экземпляра при первой настройке этих значений.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-145">Error:" ... Provide a retention period...." : You may see errors regarding the retention period if you either have not specified a retention period for the database or instance when you are configuring these values for the first time.</span></span> <span data-ttu-id="4f5b5-146">Ошибка также может возникнуть в том случае, если указано значение, не входящее в диапазон от 1 до 30.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-146">You may also see an error if you provide a value other than a number between 1 and 30.</span></span> <span data-ttu-id="4f5b5-147">Допустимые значения срока хранения — число от 1 до 30.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-147">The allowed value for the retention period is a number between 1 and 30.</span></span>  
  
2.  <span data-ttu-id="4f5b5-148">**Сообщения с уведомлениями по электронной почте**</span><span class="sxs-lookup"><span data-stu-id="4f5b5-148">**Email Notification Errors:**</span></span>  
  
     <span data-ttu-id="4f5b5-149">Ошибка: "Database Mail не включена..." — вы увидите эту ошибку, если включаете уведомления по электронной почте, но Database Mail не настроена в экземпляре.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-149">Error: "Database Mail is not enabled..." - You will see this error if you enable e-mail notifications, but Database Mail is not configured on the instance.</span></span> <span data-ttu-id="4f5b5-150">Необходимо настроить компонент Database Mail в экземпляре, чтобы получать уведомление о состоянии работоспособности [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4f5b5-150">You must configure Database Mail on the instance to be able to receive notification of the health status of [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="4f5b5-151">Сведения о том, как включить компонент Database Mail, см. в разделе [Configure Database Mail](../relational-databases/database-mail/configure-database-mail.md).</span><span class="sxs-lookup"><span data-stu-id="4f5b5-151">For information about how to enable database mail, see [Configure Database Mail](../relational-databases/database-mail/configure-database-mail.md).</span></span> <span data-ttu-id="4f5b5-152">Чтобы использовать Database Mail для уведомлений, также необходимо включить агент SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-152">You must also enable SQL Server Agent to use Database Mail for notifications.</span></span> <span data-ttu-id="4f5b5-153">Дополнительные сведения см. в разделе [перед началом](../relational-databases/database-mail/configure-sql-server-agent-mail-to-use-database-mail.md#BeforeYouBegin).</span><span class="sxs-lookup"><span data-stu-id="4f5b5-153">For more information, see [Before You Begin](../relational-databases/database-mail/configure-sql-server-agent-mail-to-use-database-mail.md#BeforeYouBegin).</span></span>  
  
     <span data-ttu-id="4f5b5-154">Ниже приведен список кодов возможных ошибок, связанных с уведомлениями по электронной почте.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-154">Following is a list of error numbers you might see that are associated with email notifications:</span></span>  
  
    -   <span data-ttu-id="4f5b5-155">Номер ошибки: 45209</span><span class="sxs-lookup"><span data-stu-id="4f5b5-155">ErrorNumber: 45209</span></span>  
  
    -   <span data-ttu-id="4f5b5-156">Номер ошибки: 45210</span><span class="sxs-lookup"><span data-stu-id="4f5b5-156">ErrorNumber: 45210</span></span>  
  
    -   <span data-ttu-id="4f5b5-157">Номер ошибки: 45211</span><span class="sxs-lookup"><span data-stu-id="4f5b5-157">ErrorNumber: 45211</span></span>  
  
3.  <span data-ttu-id="4f5b5-158">**Ошибки подключения:**</span><span class="sxs-lookup"><span data-stu-id="4f5b5-158">**Connectivity Errors:**</span></span>  
  
    -   <span data-ttu-id="4f5b5-159">**Ошибки, связанные с подключением SQL:** Эти ошибки возникают при возникновении проблем с подключением к SQL Server экземпляру.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-159">**Errors Related to SQL Connectivity:** These errors happen when there are issues connecting to SQL Server instance.</span></span> <span data-ttu-id="4f5b5-160">Расширенные события предоставляют тип ошибок в канале администратора.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-160">The extended events expose these type of errors through the admin channel.</span></span> <span data-ttu-id="4f5b5-161">Далее приведены два расширенных события, которые можно видеть в связи с возникновением ошибок подключения.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-161">Following are the two extended events that you might see for errors related to this type of connectivity issues:</span></span>  
  
         <span data-ttu-id="4f5b5-162">FileRetentionAdminXEvent with event_type = SqlError.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-162">FileRetentionAdminXEvent with event_type = SqlError.</span></span> <span data-ttu-id="4f5b5-163">Сведения о данной ошибке см. в параметрах error_code, error_message и stack_trace данного события.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-163">For details of this error, look at the error_code, error_message and stack_trace of that event.</span></span> <span data-ttu-id="4f5b5-164">Error_code — номер ошибки SqlException.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-164">The error_code is the SqlException's error number.</span></span>  
  
         <span data-ttu-id="4f5b5-165">SmartBackupAdminXevent со следующими префиксами сообщения:</span><span class="sxs-lookup"><span data-stu-id="4f5b5-165">SmartBackupAdminXevent with the following messages/message prefixes:</span></span>  
  
         <span data-ttu-id="4f5b5-166">*"Произошла внутренняя ошибка при настройке SQL Server управляемого резервного копирования в параметры Azure по умолчанию для экземпляра. Ошибка может быть временной. "*</span><span class="sxs-lookup"><span data-stu-id="4f5b5-166">*"An internal error occurred while configuring SQL Server Managed Backup to Azure default settings for instance. Error might be transient."*</span></span>  
  
         <span data-ttu-id="4f5b5-167">*"Возможно, возникли проблемы с подключением к SQL Server. Пропуск базы данных в текущей итерации ".*</span><span class="sxs-lookup"><span data-stu-id="4f5b5-167">*"Probably experiencing connectivity issues with SQL Server. Skipping database in the current iteration."*</span></span>  
  
         <span data-ttu-id="4f5b5-168">*"Не удалось запросить сведения об использовании журнала. Сбой может быть временным. Пропуск базы данных в текущей итерации ".*</span><span class="sxs-lookup"><span data-stu-id="4f5b5-168">*"Querying log usage info failed. The failure might be transient. Skipping database in the current iteration."*</span></span>  
  
         <span data-ttu-id="4f5b5-169">*"При загрузке метаданных агента SSMBackup2WA возникло исключение SQL. Сбой может быть временным. Операция будет повторена. "*</span><span class="sxs-lookup"><span data-stu-id="4f5b5-169">*"SQL exception encountered while loading SSMBackup2WA agent metadata. The failure might be transient. Operation will be retried."*</span></span>  
  
         <span data-ttu-id="4f5b5-170">*"SSMBackup2WA обнаружил исключение SQL while... "*</span><span class="sxs-lookup"><span data-stu-id="4f5b5-170">*"SSMBackup2WA encountered SQL exception while ... "*</span></span>  
  
    -   <span data-ttu-id="4f5b5-171">**Ошибки при подключении к учетной записи хранения**</span><span class="sxs-lookup"><span data-stu-id="4f5b5-171">**Errors Connecting to the storage account:**</span></span>  
  
         <span data-ttu-id="4f5b5-172">Исключения хранилища в событии FileRetentionAdminXEvent с event_type = XstoreError.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-172">Storage exceptions are reported in FileRetentionAdminXEvent with event_type = XstoreError.</span></span> <span data-ttu-id="4f5b5-173">Сведения о данной ошибке см. в параметрах error_message и stack_trace данного события.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-173">For details of the error, look at the error_message and stack_trace of that event.</span></span>  
  
         <span data-ttu-id="4f5b5-174">В управляемом резервном копировании SQL Server используется нижележащий компонент «Резервное копирование на URL-адрес», поэтому ошибки, связанные с подключением к хранилищу, относятся к обоим компонентам.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-174">Since SQL Server Managed Backup uses the underlying Backup to URL technology, the errors related to storage connectivity apply to both the features.</span></span> <span data-ttu-id="4f5b5-175">Дополнительные сведения об устранении неполадок см. в **разделе "Устранение неполадок** " статьи [рекомендации по SQL Server резервного копирования на URL-адреса и инструкции по устранению неполадок](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md) .</span><span class="sxs-lookup"><span data-stu-id="4f5b5-175">For more information on troubleshooting steps, see **troubleshooting section** of the [SQL Server Backup to URL Best Practices and Troubleshooting](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md) article.</span></span>  
  
### <a name="troubleshooting-system-issues"></a><span data-ttu-id="4f5b5-176">Проблемы системы диагностики</span><span class="sxs-lookup"><span data-stu-id="4f5b5-176">Troubleshooting System Issues</span></span>  
 <span data-ttu-id="4f5b5-177">Ниже приведены некоторые сценарии, описывающие проблему с системой (SQL Server, агент SQL Server) и ее влияние на [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4f5b5-177">Following are some scenarios when there is an issue with the system (SQL Server, SQL Server Agent) and its effects on [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]:</span></span>  
  
-   <span data-ttu-id="4f5b5-178">**Sqlservr.exe перестает отвечать на запросы или прекращает работу при [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] выполнении:** если SQL Server перестанет работать, работа агента SQL Server будет остановлена, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] также прекращается и события регистрируются в файле агента SQL. out.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-178">**Sqlservr.exe stops responding or stops working when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is running:** If SQL Server stops working, SQL Agent will gracefully shut down, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] also stops and the events are logged in SQL Agent.out file.</span></span>  
  
     <span data-ttu-id="4f5b5-179">Если SQL Server прекращает отвечать, события записываются в канал администратора.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-179">If SQL Server stops responding, events are logged in the admin channel.</span></span>  <span data-ttu-id="4f5b5-180">Пример журнала событий.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-180">An example of the event log:</span></span>  
  
     <span data-ttu-id="4f5b5-181">*Ошибка SQL (модуль не отвечает или Get sqlException: SqlException:* </span><span class="sxs-lookup"><span data-stu-id="4f5b5-181">*Sql Error (engine not responding or get sqlException: SqlException:* </span></span>  
     <span data-ttu-id="4f5b5-182">*код ошибки, сообщение и StackTrace будут отображаться в XEvent на канале администрирования, а также некоторые дополнительные сведения, например:* </span><span class="sxs-lookup"><span data-stu-id="4f5b5-182">*error code, message and stacktrace will be displayed in an admin channel xevent, together with some extra information, such as :* </span></span>  
    <span data-ttu-id="4f5b5-183">*"Возможно, возникли проблемы с подключением к SQL Server. Пропуск базы данных в текущей итерации "*</span><span class="sxs-lookup"><span data-stu-id="4f5b5-183">*"Probably experiencing connectivity issues with SQL Server. Skipping database in the current iteration"*</span></span>  
  
-   <span data-ttu-id="4f5b5-184">**Агент SQL Server перестает отвечать на запросы или перестает работать при [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] выполнении:**</span><span class="sxs-lookup"><span data-stu-id="4f5b5-184">**SQL Agent stops responding or stops working when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is running:**</span></span>  
  
     <span data-ttu-id="4f5b5-185">Если агент SQL Server прекращает работу, то службы [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] также останавливаются, а события записываются в канал администратора.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-185">If SQL Agent stops working, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] also stops and events are logged in the admin channel.</span></span> <span data-ttu-id="4f5b5-186">Это аналогично сценариям, когда SQL Server прекращает отвечать.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-186">This is similar to the scenarios when SQL Server stops responding.</span></span>  
  
     <span data-ttu-id="4f5b5-187">Если агент SQL Server прекращает отвечать, то службы [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] не смогут продолжать операции резервного копирования, а события будут записаны в канал администратора.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-187">If SQL Agent stops responding, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will be unable to continue with backup operations, and events are logged in the admin channel.</span></span> <span data-ttu-id="4f5b5-188">Пример журнала событий.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-188">An example of the event log:</span></span>  
  
     <span data-ttu-id="4f5b5-189">*Зависание задания: см. канал администратора XEvents* </span><span class="sxs-lookup"><span data-stu-id="4f5b5-189">*Job hangs: see admin channel xevents* </span></span>  
    <span data-ttu-id="4f5b5-190">*"Не было получено обновление хода выполнения SQL Server более чем" + констант. Дббаккупинфомсгмаксваиттиме + "часов для резервного копирования базы данных.   SSM облачное резервное копирование будет продолжать ждать ".*</span><span class="sxs-lookup"><span data-stu-id="4f5b5-190">*"A progress update hasn't been received from SQL Server in more than " + Constants.DBBackupInfoMsgMaxWaitTime  + " hours for database backup.   SSM Cloud Backup will continue to wait."*</span></span>  
  
 <span data-ttu-id="4f5b5-191">Если вы включили уведомления по электронной почте, вы получите уведомление, которое включает **число циклов резервного копирования** и **число циклов хранения**.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-191">If you have enabled email notification, you will receive a notification which includes **Number of Backup Loops** and **Number of Retention Loops**.</span></span> <span data-ttu-id="4f5b5-192">Если значения, возвращенные в уведомлении для одного или обоих этих столбцов, равны нулю, это может указывать на то, что система не отвечает.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-192">If the value returned in the notification for one or both of these two columns is zero, it could be an indication that the system is not responding.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="4f5b5-193">Внутренние процессы, которые формируют результаты для отчета, предполагают, что журналы диагностики ядра находятся в одном расположении с журналом ошибок агента SQL, который по умолчанию находится в той же папке, что и журналы ошибок экземпляра SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-193">The internal processes that generate the results for the report, assumes that the engine diagnostic logs are in the same location of SQL Agent error log, which by default is in the same folder as the error logs of the SQL Server instance.</span></span> <span data-ttu-id="4f5b5-194">Если в журналах диагностики ядра перемещаются в каталог, который отличается от места хранения журнала ошибок агента SQL Server, то система не может найти журналы диагностики интеллектуального резервного копирования, что в свою очередь ведет к тому, что отчет, приведенный в отправляемом по электронной почте уведомлении, может быть неправильным.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-194">If the engine diagnostic logs are moved to a location other than SQL Agent error log location, the system is unable to find the smart backup diagnostic logs, and hence the report in the email notification may not be correct.</span></span> <span data-ttu-id="4f5b5-195">Например, вы можете увидеть значение **0** во всех полях, включая количество циклов резервного копирования и число циклов хранения.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-195">For example, you might see a value of **0** in all the fields reported including the Number of Backup Loops and Number of Retention Loops.</span></span> <span data-ttu-id="4f5b5-196">В этом случае, когда журналы диагностики перемещены в другое расположение, это может означать не то, что система не отвечает, а то, что система не может найти журналы.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-196">In this case where the diagnostic logs are moved to a different location, it may not mean that the system is not responding, but that the system is unable to find the logs.</span></span> <span data-ttu-id="4f5b5-197">Прежде всего убедитесь в том, что журналы диагностики и журналы ошибок агента SQL Server находятся в одном расположении.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-197">Ensure that the location of the diagnostic logs and SQL Agent error logs are at the same location first.</span></span> <span data-ttu-id="4f5b5-198">Чтобы проверить текущее расположение журналов диагностики, можно использовать представление [sys. dm_os_server_diagnostics_log_configurations](/sql/relational-databases/system-dynamic-management-views/sys-dm-os-server-diagnostics-log-configurations).</span><span class="sxs-lookup"><span data-stu-id="4f5b5-198">To verify the current location of the diagnostic logs, you can use [sys.dm_os_server_diagnostics_log_configurations](/sql/relational-databases/system-dynamic-management-views/sys-dm-os-server-diagnostics-log-configurations).</span></span> <span data-ttu-id="4f5b5-199">`path`Столбец возвращает текущее расположение журналов диагностики подсистемы.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-199">The `path` column returns the current location of the engine diagnostic logs.</span></span>  <span data-ttu-id="4f5b5-200">Он должен находиться в той же папке, что и журналы ошибок агента SQL.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-200">It should be in the same folder as the SQL Agent error logs.</span></span> <span data-ttu-id="4f5b5-201">Получить путь к журналам ошибок агента SQL Server можно с помощью хранимой процедуры `dbo.sp_get_sqlagent_properties`.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-201">You can get SQL Agent error log path using the `dbo.sp_get_sqlagent_properties` stored procedure.</span></span>  
  
 <span data-ttu-id="4f5b5-202">Проверьте журналы расширенных событий, чтобы просмотреть подробные сведения об ошибках.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-202">Check the extended event logs to see details of the errors.</span></span> <span data-ttu-id="4f5b5-203">исправьте ошибки или перезапустите агент SQL Server, чтобы исправить ситуацию.</span><span class="sxs-lookup"><span data-stu-id="4f5b5-203">fix the errors, or restart SQL Server Agent to correct the situation.</span></span>  
  
  
