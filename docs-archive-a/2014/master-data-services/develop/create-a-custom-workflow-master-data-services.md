---
title: Создание настраиваемого рабочего процесса (службы Master Data Services) | Документы Майкрософт
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: reference
ms.assetid: 8e4403e9-595c-4b6b-9d0c-f6ae1b2bc99d
author: lrtoyou1223
ms.author: lle
ms.openlocfilehash: cac53946d83eda178328b153875a86440517a560
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669446"
---
# <a name="create-a-custom-workflow-master-data-services"></a><span data-ttu-id="6933b-102">Создание настраиваемого рабочего процесса (службы Master Data Services)</span><span class="sxs-lookup"><span data-stu-id="6933b-102">Create a Custom Workflow (Master Data Services)</span></span>
  [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] <span data-ttu-id="6933b-103">использует бизнес-правила для создания таких базовых решений рабочего процесса, как автоматическое обновление и проверка данных, а также отправка уведомлений по электронной почте с учетом заданных условий.</span><span class="sxs-lookup"><span data-stu-id="6933b-103">uses business rules to create basic workflow solutions, such as to automatically update and validate data and have e-mail notifications sent, based on conditions you specify.</span></span> <span data-ttu-id="6933b-104">Когда требуется более сложная обработка, чем та, которую обеспечивают действия встроенного рабочего процесса, используйте пользовательский рабочий процесс.</span><span class="sxs-lookup"><span data-stu-id="6933b-104">When you require processing that is more complex than what the built-in workflow actions provide, use a custom workflow.</span></span> <span data-ttu-id="6933b-105">Пользовательский рабочий процесс ― это создаваемая вами сборка .NET.</span><span class="sxs-lookup"><span data-stu-id="6933b-105">A custom workflow is a .NET assembly that you create.</span></span> <span data-ttu-id="6933b-106">При вызове вашей сборки рабочего процесса код может выполнять любые действия, которые требуются в данной ситуации.</span><span class="sxs-lookup"><span data-stu-id="6933b-106">When your workflow assembly is called, your code can take whatever action your situation requires.</span></span> <span data-ttu-id="6933b-107">Если рабочему процессу требуется сложная обработка событий, например многоуровневые утверждения или сложные деревья принятия решений, можно настроить [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] на запуск пользовательского рабочего процесса, который анализирует данные и определяет, куда их отправить для утверждения.</span><span class="sxs-lookup"><span data-stu-id="6933b-107">For example, if your workflow requires complex event processing, such as multi-tiered approvals or complicated decision trees, you can configure [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] to start a custom workflow that analyzes the data and determines where to send it for approval.</span></span>  
  
## <a name="how-custom-workflows-are-processed"></a><span data-ttu-id="6933b-108">Как обрабатываются пользовательские рабочие процессы</span><span class="sxs-lookup"><span data-stu-id="6933b-108">How Custom Workflows Are Processed</span></span>  
 <span data-ttu-id="6933b-109">В обработку пользовательских рабочих процессов вовлечены три основных компонента: веб-приложение [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], служба SQL Server MDS Workflow Integration Service и сборка обработчика рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="6933b-109">There are three main components involved to process custom workflows: the [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] web application, SQL Server MDS Workflow Integration Service, and the workflow handler assembly.</span></span> <span data-ttu-id="6933b-110">Эти компоненты обрабатывают пользовательский рабочий процесс следующим образом:</span><span class="sxs-lookup"><span data-stu-id="6933b-110">These components process a custom workflow as follows:</span></span>  
  
1.  <span data-ttu-id="6933b-111">Веб-приложение [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] используется для проверки сущности, которая запускает рабочий процесс.</span><span class="sxs-lookup"><span data-stu-id="6933b-111">You use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to validate an entity that starts a workflow.</span></span>  
  
2.  <span data-ttu-id="6933b-112">Веб-приложение [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] отправляет элементы, которые удовлетворяют условиям бизнес-правила, в очередь компонента Service Broker в базе данных [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6933b-112">[!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] sends members that meet the business rule conditions to a Service Broker queue in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span>  
  
3.  <span data-ttu-id="6933b-113">Служба SQL Server MDS Workflow Integration Service через регулярные интервалы обращается к хранимой процедуре в базе данных [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6933b-113">At regular intervals, SQL Server MDS Workflow Integration Service calls a stored procedure in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span>  
  
4.  <span data-ttu-id="6933b-114">Когда хранимая процедура находит записи в очереди компонента Service Broker, она возвращает их службе SQL Server MDS Workflow Integration Service.</span><span class="sxs-lookup"><span data-stu-id="6933b-114">When this stored procedure finds records in the Service Broker queue, it returns them to SQL Server MDS Workflow Integration Service.</span></span>  
  
5.  <span data-ttu-id="6933b-115">Служба SQL Server Службы Integration Services MDS направляет данные в сборку обработчика рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="6933b-115">SQL Server MDS Workflow Integration Services routes the data to your workflow handler assembly.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6933b-116">Примечание. Служба SQL Server MDS Workflow Integration Service предназначена для запуска простых процессов.</span><span class="sxs-lookup"><span data-stu-id="6933b-116">Note: SQL Server MDS Workflow Integration Service is meant to trigger simple processes.</span></span> <span data-ttu-id="6933b-117">Если пользовательскому коду требуется сложная обработка, ее следует выполнить либо в отдельном потоке, либо за пределами обработки рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="6933b-117">If your custom code requires complex processing, complete your processing either in a separate thread or outside of the workflow process.</span></span>  
  
## <a name="configure-master-data-services-for-custom-workflows"></a><span data-ttu-id="6933b-118">Настройка служб Master Data Services для пользовательских рабочих процессов</span><span class="sxs-lookup"><span data-stu-id="6933b-118">Configure Master Data Services for Custom Workflows</span></span>  
 <span data-ttu-id="6933b-119">Для создания пользовательского рабочего процесса потребуется написать определенный объем пользовательского кода и настроить веб-приложение [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] на передачу данных рабочего процесса используемому обработчику рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="6933b-119">Creating a custom workflow requires writing some custom code and configuring [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] to pass workflow data to your workflow handler.</span></span> <span data-ttu-id="6933b-120">Выполните следующие действия, чтобы включить обработку пользовательских рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="6933b-120">Follow these steps to enable custom workflow processing:</span></span>  
  
1.  <span data-ttu-id="6933b-121">Создайте сборку .NET, которая реализует [Microsoft. MasterDataServices. воркфловтипикстендер. иворкфловтипикстендер](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)).</span><span class="sxs-lookup"><span data-stu-id="6933b-121">Create a .NET assembly that implements [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)).</span></span>  
  
2.  <span data-ttu-id="6933b-122">Настройте службу SQL Server MDS Workflow Integration Service для соединения с базой данных [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)], а также для связи тега с используемым обработчиком рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="6933b-122">Configure SQL Server MDS Workflow Integration Service to connect to your [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database and to associate a tag with your workflow handler.</span></span>  
  
3.  <span data-ttu-id="6933b-123">Запустите службу SQL Server MDS Workflow Integration Service.</span><span class="sxs-lookup"><span data-stu-id="6933b-123">Start SQL Server MDS Workflow Integration Service.</span></span>  
  
4.  <span data-ttu-id="6933b-124">Создайте бизнес-правило в веб-приложении [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], которое запускает рабочий процесс, обозначенный именем используемого обработчика рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="6933b-124">Create a business rule in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] that starts a workflow that is tagged with the name of your workflow handler.</span></span>  
  
5.  <span data-ttu-id="6933b-125">Примените бизнес-правило к элементу, который запускает пользовательский рабочий процесс.</span><span class="sxs-lookup"><span data-stu-id="6933b-125">Apply the business rule to a member that triggers your custom workflow.</span></span>  
  
### <a name="create-the-workflow-handler-assembly"></a><span data-ttu-id="6933b-126">Создание сборки обработчика рабочих процессов</span><span class="sxs-lookup"><span data-stu-id="6933b-126">Create the Workflow Handler Assembly</span></span>  
 <span data-ttu-id="6933b-127">Настраиваемый рабочий процесс — это сборка библиотеки классов .NET, которая реализует интерфейс [Microsoft. MasterDataServices. воркфловтипикстендер. иворкфловтипикстендер](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) .</span><span class="sxs-lookup"><span data-stu-id="6933b-127">A custom workflow is a .NET class library assembly that implements the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) interface.</span></span> <span data-ttu-id="6933b-128">Служба интеграции рабочего процесса MDS SQL Server вызывает метод [Microsoft. MasterDataServices. воркфловтипикстендер. иворкфловтипикстендер. стартворкфлов \*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) для выполнения кода.</span><span class="sxs-lookup"><span data-stu-id="6933b-128">SQL Server MDS Workflow Integration Service calls the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) method to run your code.</span></span> <span data-ttu-id="6933b-129">Пример кода, который реализует [Microsoft. MasterDataServices. воркфловтипикстендер. иворкфловтипикстендер. стартворкфлов \*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)), см. в разделе [Пример настраиваемого рабочего процесса &#40;Master Data Services&#41;](create-a-custom-workflow-example.md).</span><span class="sxs-lookup"><span data-stu-id="6933b-129">For example code that implements [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)), see [Custom Workflow Example &#40;Master Data Services&#41;](create-a-custom-workflow-example.md).</span></span>  
  
 <span data-ttu-id="6933b-130">Выполните следующие действия, чтобы создать с помощью Visual Studio 2010 сборку, которую сможет вызывать служба SQL Server MDS Workflow Integration Service для обработки пользовательского рабочего процесса:</span><span class="sxs-lookup"><span data-stu-id="6933b-130">Follow these steps to use Visual Studio 2010 to create an assembly that SQL Server MDS Workflow Integration Service can call to handle a custom workflow:</span></span>  
  
1.  <span data-ttu-id="6933b-131">В Visual Studio 2010 создайте проект **Библиотека классов**, в котором используется язык по вашему выбору.</span><span class="sxs-lookup"><span data-stu-id="6933b-131">In Visual Studio 2010, create a new **Class Library** project that uses the language of your choice.</span></span> <span data-ttu-id="6933b-132">Чтобы создать библиотеку классов C#, выберите типы проектов **Visual C#\Windows** и шаблон **Библиотека классов**.</span><span class="sxs-lookup"><span data-stu-id="6933b-132">To create a C# Class Library, select the **Visual C#\Windows** project types and select the **Class Library** template.</span></span> <span data-ttu-id="6933b-133">Введите имя проекта, например **MDSWorkflowTest**, и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="6933b-133">Enter a name for your project, such as **MDSWorkflowTest**, and click **OK**.</span></span>  
  
2.  <span data-ttu-id="6933b-134">Добавьте ссылку на файл Microsoft.MasterDataServices.WorkflowTypeExtender.dll.</span><span class="sxs-lookup"><span data-stu-id="6933b-134">Add a reference to Microsoft.MasterDataServices.WorkflowTypeExtender.dll.</span></span> <span data-ttu-id="6933b-135">Эту сборку можно найти в \<Your installation folder> \Мастер данных Services\WebApplication\bin.</span><span class="sxs-lookup"><span data-stu-id="6933b-135">This assembly can be found in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
3.  <span data-ttu-id="6933b-136">Добавьте строку "using Microsoft.MasterDataServices.Core.Workflow;" в файл с кодом C#.</span><span class="sxs-lookup"><span data-stu-id="6933b-136">Add 'using Microsoft.MasterDataServices.Core.Workflow;' to your C# code file.</span></span>  
  
4.  <span data-ttu-id="6933b-137">Наследуйте из [Microsoft. MasterDataServices. воркфловтипикстендер. иворкфловтипикстендер](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) в объявлении класса.</span><span class="sxs-lookup"><span data-stu-id="6933b-137">Inherit from [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) in your class declaration.</span></span> <span data-ttu-id="6933b-138">Объявление класса должно выглядеть примерно так: public class WorkflowTester : IWorkflowTypeExtender.</span><span class="sxs-lookup"><span data-stu-id="6933b-138">The class declaration should be similar to: 'public class WorkflowTester : IWorkflowTypeExtender'.</span></span>  
  
5.  <span data-ttu-id="6933b-139">Реализуйте интерфейс [Microsoft. MasterDataServices. воркфловтипикстендер. иворкфловтипикстендер](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) .</span><span class="sxs-lookup"><span data-stu-id="6933b-139">Implement the [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender](/previous-versions/sql/sql-server-2016/hh758785(v=sql.130)) interface.</span></span> <span data-ttu-id="6933b-140">Метод [Microsoft. MasterDataServices. воркфловтипикстендер. иворкфловтипикстендер. стартворкфлов \*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) вызывается службой интеграции рабочего процесса MDS SQL Server для запуска рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="6933b-140">The [Microsoft.MasterDataServices.WorkflowTypeExtender.IWorkflowTypeExtender.StartWorkflow\*](/previous-versions/sql/sql-server-2016/hh759009(v=sql.130)) method is called by SQL Server MDS Workflow Integration Service to start your workflow.</span></span>  
  
6.  <span data-ttu-id="6933b-141">Скопируйте сборку в расположение исполняемого файла SQL Server службы интеграции рабочих процессов MDS с именем Microsoft.MasterDataServices.Workflow.exe в \<Your installation folder> \Мастер Data Services\WebApplication\bin.</span><span class="sxs-lookup"><span data-stu-id="6933b-141">Copy your assembly to the location of the SQL Server MDS Workflow Integration Service executable, named Microsoft.MasterDataServices.Workflow.exe, in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
### <a name="configure-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="6933b-142">Настройка службы Configure SQL Server MDS Workflow Integration Service</span><span class="sxs-lookup"><span data-stu-id="6933b-142">Configure SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="6933b-143">Измените файл конфигурации [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)], включив в него данные соединения для базы данных [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)], и свяжите тег со сборкой обработчика рабочих процессов, выполнив следующие действия.</span><span class="sxs-lookup"><span data-stu-id="6933b-143">Edit the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] configuration file to include connection information for your [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database and to associate a tag with your workflow handler assembly by following these steps:</span></span>  
  
1.  <span data-ttu-id="6933b-144">Поиск Microsoft.MasterDataServices.Workflow.exe.config в \<Your installation folder> Services\WebApplication\bin. данных \Мастер</span><span class="sxs-lookup"><span data-stu-id="6933b-144">Find Microsoft.MasterDataServices.Workflow.exe.config in \<Your installation folder>\Master Data Services\WebApplication\bin.</span></span>  
  
2.  <span data-ttu-id="6933b-145">Добавьте сведения о подключении к базе данных [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] в параметр ConnectionString.</span><span class="sxs-lookup"><span data-stu-id="6933b-145">Add the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database connection information to the "ConnectionString" setting.</span></span> <span data-ttu-id="6933b-146">Если в установке [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] используются параметры сортировки, учитывающие регистр, то имя базы данных следует ввести в том же регистре, который используется в базе данных.</span><span class="sxs-lookup"><span data-stu-id="6933b-146">If your [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] installation uses case-sensitive collation, the name of the database must be entered in the same case as in the database.</span></span> <span data-ttu-id="6933b-147">Например, полный тег параметра может выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="6933b-147">For example, the complete setting tag might look like this:</span></span>  
  
    ```xml  
    <setting name="ConnectionString" serializeAs="String">  
        <value>Server=myServer;Database=myDatabase;Integrated Security=True</value>  
    </setting>  
    ```  
  
3.  <span data-ttu-id="6933b-148">Под параметром ConnectionString добавьте параметр WorkflowTypeExtenders, чтобы связать имя тега с используемой сборкой обработчика рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="6933b-148">Below the "ConnectionString" setting add a "WorkflowTypeExtenders" setting to associate a tag name with your workflow handler assembly.</span></span> <span data-ttu-id="6933b-149">Пример:</span><span class="sxs-lookup"><span data-stu-id="6933b-149">For example:</span></span>  
  
    ```xml  
    <setting name="WorkflowTypeExtenders" serializeAs="String">  
        <value>TEST=MDSWorkflowTestLib.WorkflowTester, MDSWorkflowTestLib</value>  
    </setting>  
    ```  
  
     <span data-ttu-id="6933b-150">Внутренний текст \<value> тега имеет вид \<Workflow tag> = \<assembly-qualified workflow type name> .</span><span class="sxs-lookup"><span data-stu-id="6933b-150">The inner text of the \<value> tag is in the form of \<Workflow tag>=\<assembly-qualified workflow type name>.</span></span> <span data-ttu-id="6933b-151">\<Workflow tag>— Это имя, которое используется для задания сборки обработчика рабочего процесса при создании бизнес-правила в [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="6933b-151">\<Workflow tag> is a name you use to identify the workflow handler assembly when you create a business rule in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)].</span></span> <span data-ttu-id="6933b-152">\<assembly-qualified workflow type name>— Это имя класса рабочего процесса с указанием пространства имен, за которым следует запятая, за которым следует отображаемое имя сборки.</span><span class="sxs-lookup"><span data-stu-id="6933b-152">\<assembly-qualified workflow type name> is the namespace-qualified name of your workflow class, followed by a comma, followed by the display name of the assembly.</span></span> <span data-ttu-id="6933b-153">Если сборка имеет строгое имя, то также необходимо указать данные о версии и ее PublicKeyToken.</span><span class="sxs-lookup"><span data-stu-id="6933b-153">If your assembly is strongly named, you also have to include version information and its PublicKeyToken.</span></span> <span data-ttu-id="6933b-154">\<setting>Если вы создали несколько обработчиков рабочих процессов для различных типов рабочих процессов, можно включить несколько тегов.</span><span class="sxs-lookup"><span data-stu-id="6933b-154">You can include multiple \<setting> tags if you have created multiple workflow handlers for different kinds of workflows.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6933b-155">В зависимости от конфигурации сервера при попытке сохранить файл Microsoft.MasterDataServices.Workflow.exe.config на экране может появиться сообщение об ошибке "В доступе отказано".</span><span class="sxs-lookup"><span data-stu-id="6933b-155">Depending on the configuration of your server, you may see an "Access is denied" error when you try to save the Microsoft.MasterDataServices.Workflow.exe.config file.</span></span> <span data-ttu-id="6933b-156">В этом случае временно отключите контроль учетных записей на сервере.</span><span class="sxs-lookup"><span data-stu-id="6933b-156">If this occurs, temporarily disable User Account Control (UAC) on the server.</span></span> <span data-ttu-id="6933b-157">Для этого откройте панель управления и выберите пункт **Система и безопасность**.</span><span class="sxs-lookup"><span data-stu-id="6933b-157">To do this, open Control Panel, click **System and Security**.</span></span> <span data-ttu-id="6933b-158">В разделе **Центр уведомлений** щелкните **Изменить параметры контроля учетных записей**.</span><span class="sxs-lookup"><span data-stu-id="6933b-158">Under **Action Center**, click **Change User Account Control Settings**.</span></span> <span data-ttu-id="6933b-159">В диалоговом окне **Параметры контроля учетных записей** передвиньте ползунок в самый низ, чтобы не получать никаких уведомлений.</span><span class="sxs-lookup"><span data-stu-id="6933b-159">In the **User Account Control Settings** dialog, slide the bar to the bottom so that you are never notified.</span></span> <span data-ttu-id="6933b-160">Перезагрузите компьютер и повторите описанные ранее действия для изменения файла конфигурации.</span><span class="sxs-lookup"><span data-stu-id="6933b-160">Restart your computer and repeat the preceding steps to edit your configuration file.</span></span> <span data-ttu-id="6933b-161">После сохранения файла, сбросьте параметры контроля учетных записей пользователей на значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="6933b-161">After saving the file, reset your UAC settings to the default level.</span></span>  
  
### <a name="start-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="6933b-162">Запуск службы SQL Server MDS Workflow Integration Service</span><span class="sxs-lookup"><span data-stu-id="6933b-162">Start SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="6933b-163">По умолчанию служба SQL Server MDS Workflow Integration Service не установлена.</span><span class="sxs-lookup"><span data-stu-id="6933b-163">By default, SQL Server MDS Workflow Integration Service is not installed.</span></span> <span data-ttu-id="6933b-164">Чтобы использовать эту службу, ее сначала необходимо установить.</span><span class="sxs-lookup"><span data-stu-id="6933b-164">You must install the service before it can be used.</span></span> <span data-ttu-id="6933b-165">Для обеспечения наибольшей безопасности создайте локального пользователя для этой службы и предоставьте этому пользователю только те разрешения, которые необходимы для выполнения операций рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="6933b-165">For the greatest security, create a local user for the service and grant this user only the permissions needed to perform workflow operations.</span></span> <span data-ttu-id="6933b-166">Чтобы создать пользователя, установите службу, запустите ее и выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="6933b-166">To create a user, install the service, and start the service, follow these steps:</span></span>  
  
1.  <span data-ttu-id="6933b-167">С помощью диспетчера локальных пользователей и групп создайте локального пользователя с именем, например, mds_workflow_service.</span><span class="sxs-lookup"><span data-stu-id="6933b-167">Use the Local Users and Groups manager to create a local user named, for example, mds_workflow_service.</span></span>  
  
2.  <span data-ttu-id="6933b-168">С помощью среды SQL Server Management Studio предоставьте пользователю mds_workflow_service разрешение на выполнение хранимой процедуры [mdm].[udpExternalActionsGet].</span><span class="sxs-lookup"><span data-stu-id="6933b-168">Use SQL Server Management Studio to grant the mds_workflow_service user permission to execute the [mdm].[udpExternalActionsGet] stored procedure.</span></span> <span data-ttu-id="6933b-169">Для этого создайте новое имя входа для учетной записи mds_workflow_service, создайте нового пользователя в базе данных [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)], сопоставьте этого пользователя с именем входа mds_workflow_service и предоставьте ему разрешение EXECUTE для хранимой процедуры [mdm].[udpExternalActionsGet].</span><span class="sxs-lookup"><span data-stu-id="6933b-169">To do this, create a new login for the mds_workflow_service account, create a new user in the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database, map this user to the mds_workflow_service login, and grant the user EXECUTE permission to the [mdm].[udpExternalActionsGet] stored procedure.</span></span>  
  
3.  <span data-ttu-id="6933b-170">Предоставьте пользователю mds_workflow_service разрешение на выполнение сборки обработчика рабочих процессов.</span><span class="sxs-lookup"><span data-stu-id="6933b-170">Grant the mds_workflow_service user permission to execute the workflow handler assembly.</span></span> <span data-ttu-id="6933b-171">Для этого добавьте пользователя mds_workflow_service на вкладку **Безопасность** диалогового окна **Свойства** сборки обработчика рабочих процессов и предоставьте пользователю службы mds_workflow_service разрешение READ и EXECUTE.</span><span class="sxs-lookup"><span data-stu-id="6933b-171">To do this, add the mds_workflow_service user to the **Security** tab of the **Properties** of the workflow handler assembly and grant the mds_workflow_service user READ and EXECUTE permission.</span></span>  
  
4.  <span data-ttu-id="6933b-172">Предоставьте пользователю службы mds_workflow_service разрешение на выполнение исполняемого файла службы SQL Server MDS Workflow Integration Service.</span><span class="sxs-lookup"><span data-stu-id="6933b-172">Grant the mds_workflow_service user permission to execute the SQL Server MDS Workflow Integration Service executable.</span></span> <span data-ttu-id="6933b-173">Для этого добавьте mds_workflow_service пользователя на вкладку **Безопасность** **свойств** Microsoft.MasterDataServices.Workflow.exe, в поле \<Your installation folder> \Мастер Data Services\WebApplication\bin и предоставьте пользователю MDS_WORKFLOW_SERVICE разрешение на чтение и выполнение.</span><span class="sxs-lookup"><span data-stu-id="6933b-173">To do this, add the mds_workflow_service user to the **Security** tab of the **Properties** of Microsoft.MasterDataServices.Workflow.exe, in \<Your installation folder>\Master Data Services\WebApplication\bin and grant the mds_workflow_service user READ and EXECUTE permission.</span></span>  
  
5.  <span data-ttu-id="6933b-174">Установите службу SQL Server MDS Workflow Integration Service с помощью программы установки .NET с именем InstallUtil.exe.</span><span class="sxs-lookup"><span data-stu-id="6933b-174">Install SQL Server MDS Workflow Integration Service by using the .NET installation utility, named InstallUtil.exe.</span></span> <span data-ttu-id="6933b-175">Программа InstallUtil.exe может находиться в установочной папке платформы .NET, например C:\Windows\Microsoft.NET\Framework\v4.0.30319\\.</span><span class="sxs-lookup"><span data-stu-id="6933b-175">InstallUtil.exe can be found in the .NET installation folder, such as C:\Windows\Microsoft.NET\Framework\v4.0.30319\\.</span></span> <span data-ttu-id="6933b-176">Установите службу SQL Server MDS Workflow Integration Service, введя в командной строке следующую команду:</span><span class="sxs-lookup"><span data-stu-id="6933b-176">Install SQL Server MDS Workflow Integration Service by entering the following in an elevated command prompt:</span></span>  
  
    ```  
    C:\Windows\Microsoft.NET\Framework\v4.0.30319\InstallUtil Microsoft.MasterDataServices.Workflow.exe  
    ```  
  
     <span data-ttu-id="6933b-177">При запросе во время установки укажите пользователя mds_workflow_service.</span><span class="sxs-lookup"><span data-stu-id="6933b-177">Specify the mds_workflow_service user when prompted during installation.</span></span>  
  
6.  <span data-ttu-id="6933b-178">Запустите службу SQL Server MDS Workflow Integration Service с помощью оснастки «Службы».</span><span class="sxs-lookup"><span data-stu-id="6933b-178">Start SQL Server MDS Workflow Integration Service by using the Services snap-in.</span></span> <span data-ttu-id="6933b-179">Для этого найдите службу SQL Server MDS Workflow Integration Service в оснастке "Службы", выделите ее и щелкните ссылку **Запустить**.</span><span class="sxs-lookup"><span data-stu-id="6933b-179">To do this, find SQL Server MDS Workflow Integration Service in the Services snap-in, select it, and click the  **Start** link.</span></span>  
  
### <a name="create-a-workflow-business-rule"></a><span data-ttu-id="6933b-180">Создание бизнес-правила рабочего процесса</span><span class="sxs-lookup"><span data-stu-id="6933b-180">Create a Workflow Business Rule</span></span>  
 <span data-ttu-id="6933b-181">С помощью веб-приложения [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] создайте и опубликуйте бизнес-правило, которое при его применении будет запускать рабочий процесс.</span><span class="sxs-lookup"><span data-stu-id="6933b-181">Use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to create and publish a business rule that will start the workflow when applied.</span></span> <span data-ttu-id="6933b-182">Бизнес-правило должно содержать действия, которые изменяют значения атрибутов таким образом, чтобы после его применения правило не могло быть применено еще раз.</span><span class="sxs-lookup"><span data-stu-id="6933b-182">You should ensure that your business rule contains actions that change attribute values, so that the rule evaluates to false after it has been applied once.</span></span> <span data-ttu-id="6933b-183">Например, критерии бизнес-правила должны быть соблюдены, когда значение атрибута «Price» больше 500, а значение атрибута «Approved» не задано.</span><span class="sxs-lookup"><span data-stu-id="6933b-183">For example, your business rule might evaluate to true when a Price attribute value is greater than 500 and the Approved attribute value is blank.</span></span> <span data-ttu-id="6933b-184">В этом случае правило должно включать два действия: задание значения «Pending» атрибуту «Approved» и запуск рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="6933b-184">The rule can then include two actions: one to set the Approved attribute value to Pending and one to start the workflow.</span></span> <span data-ttu-id="6933b-185">Также можно создать правило, в котором будет использоваться условие "изменилось", и добавить атрибуты в группы отслеживания изменений.</span><span class="sxs-lookup"><span data-stu-id="6933b-185">Alternatively, you may want to create a rule that uses the "has changed" condition and add your attributes to change tracking groups.</span></span> <span data-ttu-id="6933b-186">Дополнительные сведения о бизнес-правилах см. в статье [Бизнес-правила (службы Master Data Services)](../business-rules-master-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="6933b-186">For more information about business rules, see [Business Rules &#40;Master Data Services&#41;](../business-rules-master-data-services.md).</span></span>  
  
 <span data-ttu-id="6933b-187">Создайте бизнес-правило, которое будет запускать пользовательский рабочий процесс в [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], выполнив следующие действия.</span><span class="sxs-lookup"><span data-stu-id="6933b-187">Create a business rule that starts a custom workflow in [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] by following these steps:</span></span>  
  
1.  <span data-ttu-id="6933b-188">В редакторе бизнес-правил [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] , после того как вы указали условия бизнес-правила, перетащите действие **запустить рабочий процесс** из списка **внешние действия** в метку **действия** панели **then** .</span><span class="sxs-lookup"><span data-stu-id="6933b-188">In the business rule editor of [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], after you have specified the conditions of your business rule, drag the **Start Workflow** action from the **External actions** list to the **THEN** pane's **Action** label.</span></span>  
  
2.  <span data-ttu-id="6933b-189">На панели **Изменение действия** в поле **Тип рабочего процесса** введите тег, который обозначает сборку обработчика рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="6933b-189">In the **Edit Action** pane, in the **Workflow type** box, type the tag that identifies your workflow handler assembly.</span></span> <span data-ttu-id="6933b-190">Это тег, который был задан в файле конфигурации сборки, например, TEST.</span><span class="sxs-lookup"><span data-stu-id="6933b-190">This is the tag you specified in the configuration file for your assembly, for example, TEST.</span></span>  
  
3.  <span data-ttu-id="6933b-191">При необходимости установите флажок **Включить данные элемента**.</span><span class="sxs-lookup"><span data-stu-id="6933b-191">Optionally, select the **Include member data** check box.</span></span> <span data-ttu-id="6933b-192">Этот параметр устанавливается для того, чтобы включать имена атрибутов и значения из XML-файла, который передается обработчику рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="6933b-192">Choose this to include attribute names and values in the XML that is passed to the workflow handler.</span></span>  
  
4.  <span data-ttu-id="6933b-193">В поле **Сайт рабочего процесса** введите имя веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="6933b-193">In the **Workflow site** box, type the name of a website.</span></span> <span data-ttu-id="6933b-194">Для пользовательского рабочего процесса это может и не применяться, но может быть использовано для формирования дополнительного контекста.</span><span class="sxs-lookup"><span data-stu-id="6933b-194">For your custom workflow this may not apply, but can be used for added context.</span></span>  
  
5.  <span data-ttu-id="6933b-195">В поле **Имя рабочего процесса** введите имя рабочего процесса, которое указано в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6933b-195">In the **Workflow name** box, type the name of your workflow from Visual Studio.</span></span> <span data-ttu-id="6933b-196">Для пользовательского рабочего процесса это может и не применяться, но может быть использовано для формирования дополнительного контекста.</span><span class="sxs-lookup"><span data-stu-id="6933b-196">For your custom workflow this may not apply, but can be used for added context.</span></span>  
  
6.  <span data-ttu-id="6933b-197">Сохраните и опубликуйте бизнес-правило.</span><span class="sxs-lookup"><span data-stu-id="6933b-197">Save and publish the business rule.</span></span>  
  
### <a name="apply-business-rules-to-start-a-workflow"></a><span data-ttu-id="6933b-198">Применение бизнес-правила к запуску рабочего процесса</span><span class="sxs-lookup"><span data-stu-id="6933b-198">Apply Business Rules to Start a Workflow</span></span>  
 <span data-ttu-id="6933b-199">Примените бизнес-правило к данным, чтобы запустить рабочий процесс.</span><span class="sxs-lookup"><span data-stu-id="6933b-199">Apply the business rule to your data to start the workflow.</span></span> <span data-ttu-id="6933b-200">Для этого с помощью веб-приложения [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] измените запись, содержащую элементы, которые требуется проверить.</span><span class="sxs-lookup"><span data-stu-id="6933b-200">To do this, use [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] to edit the entity that contains the members you want to validate.</span></span> <span data-ttu-id="6933b-201">Нажмите кнопку **Применить бизнес-правила**.</span><span class="sxs-lookup"><span data-stu-id="6933b-201">Click **Apply business rules**.</span></span> <span data-ttu-id="6933b-202">В ответ на бизнес-правило веб-приложение [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] заполняет очередь компонента Service Broker базы данных [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6933b-202">In response to the business rule, [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] populates the Service Broker queue of the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span> <span data-ttu-id="6933b-203">Когда служба SQL Server MDS Workflow Integration Service проверяет очередь, она отправляет данные указанной сборке обработчика рабочего процесса и очищает очередь.</span><span class="sxs-lookup"><span data-stu-id="6933b-203">When SQL Server MDS Workflow Integration Service checks the queue, it sends the data to the specified workflow handler assembly and clears the queue.</span></span> <span data-ttu-id="6933b-204">Сборка обработчика рабочего процесса выполняет те действия, которые были запрограммированы.</span><span class="sxs-lookup"><span data-stu-id="6933b-204">The workflow handler assembly performs whatever actions you have coded into it.</span></span>  
  
## <a name="troubleshoot-custom-workflows"></a><span data-ttu-id="6933b-205">Устранение неполадок пользовательских рабочих процессов</span><span class="sxs-lookup"><span data-stu-id="6933b-205">Troubleshoot Custom Workflows</span></span>  
 <span data-ttu-id="6933b-206">Если сборка обработчика рабочего процесса не получает данные, можно попробовать выполнить отладку службы SQL Server MDS Workflow Integration Service или просмотреть очередь компонента Service Broker.</span><span class="sxs-lookup"><span data-stu-id="6933b-206">If your workflow handler assembly doesn't receive data, you can try debugging SQL Server MDS Workflow Integration Service or viewing the Service Broker queue.</span></span>  
  
### <a name="debug-sql-server-mds-workflow-integration-service"></a><span data-ttu-id="6933b-207">Отладка службы SQL Server MDS Workflow Integration Service</span><span class="sxs-lookup"><span data-stu-id="6933b-207">Debug SQL Server MDS Workflow Integration Service</span></span>  
 <span data-ttu-id="6933b-208">Для отладки службы SQL Server Workflow Integration Service выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="6933b-208">To debug SQL Server Workflow Integration Service, take the following steps:</span></span>  
  
1.  <span data-ttu-id="6933b-209">С помощью оснастки «Службы» остановите службу.</span><span class="sxs-lookup"><span data-stu-id="6933b-209">Use the Services snap-in to stop the service.</span></span>  
  
2.  <span data-ttu-id="6933b-210">Откройте командную строку, перейдите в каталог, в котором находится служба и запустите службу в пультовом режиме, введя следующую команду: Microsoft.MasterDataServices.Workflow.exe -console.</span><span class="sxs-lookup"><span data-stu-id="6933b-210">Open a command prompt, navigate to the location of the service, and run the service in console mode by entering: Microsoft.MasterDataServices.Workflow.exe -console.</span></span>  
  
3.  <span data-ttu-id="6933b-211">В веб-приложении [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)] обновите элемент и примените бизнес-правило еще раз.</span><span class="sxs-lookup"><span data-stu-id="6933b-211">In [!INCLUDE[ssMDSmdm](../../includes/ssmdsmdm-md.md)], update your member and apply business rules again.</span></span> <span data-ttu-id="6933b-212">В окне консоли будут отображены подробные записи журнала.</span><span class="sxs-lookup"><span data-stu-id="6933b-212">Detailed logs are displayed in the console window.</span></span>  
  
### <a name="view-the-service-broker-queue"></a><span data-ttu-id="6933b-213">Просмотр очереди компонента Service Broker</span><span class="sxs-lookup"><span data-stu-id="6933b-213">View the Service Broker Queue</span></span>  
 <span data-ttu-id="6933b-214">Очередь компонента Service Broker, в которой содержатся основные данные, переданные в рамках рабочего процесса, находится по адресу mdm.microsoft/mdm/queue/externalaction.</span><span class="sxs-lookup"><span data-stu-id="6933b-214">The Service Broker queue that contains the master data passed as part of the workflow is: mdm.microsoft/mdm/queue/externalaction.</span></span> <span data-ttu-id="6933b-215">В **обозревателе объектов** среды SQL Management Studio очереди находятся в узле компонента Service Broker базы данных [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6933b-215">Queues can be found in the **Object Explorer** of SQL Management Studio under the Service Broker node of the [!INCLUDE[ssMDSshort](../../includes/ssmdsshort-md.md)] database.</span></span> <span data-ttu-id="6933b-216">Имейте в виду, что если служба должным образом очистила очередь, она будет пуста.</span><span class="sxs-lookup"><span data-stu-id="6933b-216">Be aware that, if the service cleared the queue properly, this queue will be empty.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6933b-217">См. также:</span><span class="sxs-lookup"><span data-stu-id="6933b-217">See Also</span></span>  
 <span data-ttu-id="6933b-218">[Пример настраиваемого рабочего процесса &#40;Master Data Services&#41;](create-a-custom-workflow-example.md) </span><span class="sxs-lookup"><span data-stu-id="6933b-218">[Custom Workflow Example &#40;Master Data Services&#41;](create-a-custom-workflow-example.md) </span></span>  
 [<span data-ttu-id="6933b-219">Описание XML настраиваемого рабочего процесса (службы Master Data Services)</span><span class="sxs-lookup"><span data-stu-id="6933b-219">Custom Workflow XML Description &#40;Master Data Services&#41;</span></span>](create-a-custom-workflow-xml-description.md)  
  
  
