---
title: Пользовательский код и ссылки на сборки в выражениях в конструкторе отчетов (службы SSRS) | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: reporting-services-native
ms.topic: conceptual
helpviewer_keywords:
- items [Reporting Services], expressions
- data [Reporting Services], expressions
- expressions [Reporting Services], about expressions
- expressions [Reporting Services]
- SSRS, expressions
- formulas [Reporting Services]
- data manipulation [Reporting Services]
- SQL Server Reporting Services, expressions
ms.assetid: ae8a0166-2ccc-45f4-8d28-c150da7b73de
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: 0f895d1ecc569092dfbae22b514d3470e020b94d
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87736121"
---
# <a name="custom-code-and-assembly-references-in-expressions-in-report-designer-ssrs"></a><span data-ttu-id="0a49d-102">Пользовательский код и ссылок на сборки в выражениях в конструкторе отчетов (службы SSRS)</span><span class="sxs-lookup"><span data-stu-id="0a49d-102">Custom Code and Assembly References in Expressions in Report Designer (SSRS)</span></span>
  <span data-ttu-id="0a49d-103">Можно добавлять ссылки на пользовательский код, внедренный в отчет, или пользовательские сборки, построенные и сохраненные на компьютере и развернутые на сервере отчетов.</span><span class="sxs-lookup"><span data-stu-id="0a49d-103">You can add references to custom code embedded in a report or to custom assemblies that you build and save to your computer and deploy to the report server.</span></span> <span data-ttu-id="0a49d-104">Используйте внедренный код для пользовательских констант, сложных функций или функций, которые используются в одном отчете несколько раз.</span><span class="sxs-lookup"><span data-stu-id="0a49d-104">Use embedded code for custom constants, complex functions or functions that are used multiple times in a single report.</span></span> <span data-ttu-id="0a49d-105">Сборки с пользовательским кодом используйте для сохранения кода в одном месте и его общего использования в нескольких отчетах.</span><span class="sxs-lookup"><span data-stu-id="0a49d-105">Use custom code assemblies to maintain code in a single place and share it for use by multiple reports.</span></span> <span data-ttu-id="0a49d-106">Пользовательский код может включать новые пользовательские константы, переменные, функции или подпрограммы.</span><span class="sxs-lookup"><span data-stu-id="0a49d-106">Custom code can include new custom constants, variables, functions, or subroutines.</span></span> <span data-ttu-id="0a49d-107">Можно включать ссылки, доступные только для чтения, во встроенные коллекции, например коллекцию Parameters.</span><span class="sxs-lookup"><span data-stu-id="0a49d-107">You can include read-only references to built-in collections such as the Parameters collection.</span></span> <span data-ttu-id="0a49d-108">Однако эти наборы значений данных отчета невозможно передать пользовательским функциям (в частности, не поддерживаются пользовательские статистические вычисления).</span><span class="sxs-lookup"><span data-stu-id="0a49d-108">However, you cannot pass sets of report data values to custom functions; specifically, custom aggregates are not supported.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="0a49d-109">В критичных по времени вычислениях, которые выполняются один раз при запуске и значения которых требуется сохранить неизменными в процессе обработки отчета, рассмотрите возможность использования групповой переменной или переменной отчета.</span><span class="sxs-lookup"><span data-stu-id="0a49d-109">For time-sensitive calculations that are evaluated once at run-time and that you want to remain the same value throughout report processing, consider whether to use a report variable or group variable.</span></span> <span data-ttu-id="0a49d-110">Дополнительные сведения см. в разделе [Ссылки на коллекции переменных отчета и группы (построитель отчетов и службы SSRS)](built-in-collections-report-and-group-variables-references-report-builder.md).</span><span class="sxs-lookup"><span data-stu-id="0a49d-110">For more information, see [Report and Group Variables Collections References &#40;Report Builder and SSRS&#41;](built-in-collections-report-and-group-variables-references-report-builder.md).</span></span>  
  
 <span data-ttu-id="0a49d-111">Конструктор отчетов — предпочтительная среда создания отчетов, используемая для добавления пользовательского кода в отчет.</span><span class="sxs-lookup"><span data-stu-id="0a49d-111">Report Designer is the preferred authoring environment to use to add custom code to a report.</span></span> <span data-ttu-id="0a49d-112">Построитель отчетов поддерживает обработку отчетов, которые содержат допустимые выражения или ссылки на пользовательские сборки на сервере отчетов.</span><span class="sxs-lookup"><span data-stu-id="0a49d-112">Report Builder supports processing reports that have valid expressions, or that include references to custom assemblies on a report server.</span></span> <span data-ttu-id="0a49d-113">В построителе отчетов нет способа добавить ссылку в пользовательскую сборку.</span><span class="sxs-lookup"><span data-stu-id="0a49d-113">Report Builder does not provide a way to add a reference to a custom assembly.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0a49d-114">Следует помнить, что при обновлении сервера отчетов отчеты, которые зависят от пользовательских сборок, могут потребовать дополнительных шагов для завершения обновления.</span><span class="sxs-lookup"><span data-stu-id="0a49d-114">Be aware that during an upgrade of a report server, reports that depend on custom assemblies might require additional steps to complete the upgrade.</span></span> <span data-ttu-id="0a49d-115">Дополнительные сведения см. в разделе [Use Upgrade Advisor to Prepare for Upgrades](../../sql-server/install/use-upgrade-advisor-to-prepare-for-upgrades.md).</span><span class="sxs-lookup"><span data-stu-id="0a49d-115">For more information, see [Use Upgrade Advisor to Prepare for Upgrades](../../sql-server/install/use-upgrade-advisor-to-prepare-for-upgrades.md).</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssRBRDDup](../../includes/ssrbrddup-md.md)]  
  
##  <a name="working-with-custom-code-in-report-builder"></a><a name="RB3"></a> <span data-ttu-id="0a49d-116">Работа с пользовательским кодом в построителе отчетов</span><span class="sxs-lookup"><span data-stu-id="0a49d-116">Working with Custom Code in Report Builder</span></span>  
 <span data-ttu-id="0a49d-117">В построителе отчетов можно открыть отчет на сервере отчетов, который включает в себя ссылки на пользовательские сборки.</span><span class="sxs-lookup"><span data-stu-id="0a49d-117">In Report Builder, you can open a report from a report server that includes references to custom assemblies.</span></span> <span data-ttu-id="0a49d-118">Например, можно редактировать отчеты, которые созданы и развертываются с помощью конструктора отчетов в среде [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0a49d-118">For example, you can edit reports that are created and deployed by using Report Designer in [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)].</span></span> <span data-ttu-id="0a49d-119">Пользовательские сборки должны быть развернуты на сервере отчетов.</span><span class="sxs-lookup"><span data-stu-id="0a49d-119">The custom assemblies must be deployed to the report server.</span></span>  
  
 <span data-ttu-id="0a49d-120">Нельзя выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="0a49d-120">You cannot do the following:</span></span>  
  
1.  <span data-ttu-id="0a49d-121">Добавлять ссылки или экземпляры члена класса в отчет.</span><span class="sxs-lookup"><span data-stu-id="0a49d-121">Add references or class member instances to a report.</span></span>  
  
2.  <span data-ttu-id="0a49d-122">Просматривать отчет с ссылками на пользовательские сборки в локальном режиме.</span><span class="sxs-lookup"><span data-stu-id="0a49d-122">Preview a report with references to custom assemblies in local mode.</span></span>  
  
##  <a name="including-references-to-commonly-used-functions"></a><a name="Common"></a><span data-ttu-id="0a49d-123">Включение ссылок на часто используемые функции</span><span class="sxs-lookup"><span data-stu-id="0a49d-123">Including References to Commonly Used Functions</span></span>  
 <span data-ttu-id="0a49d-124">Для просмотра упорядоченного по категориям списка часто используемых функций, встроенных в службы **, используется диалоговое окно** Выражение [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0a49d-124">Use the **Expression** dialog box to view a categorized list of common functions built-in to [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)].</span></span> <span data-ttu-id="0a49d-125">При развертывании **Общие функции** и щелчке по категории в панели **Элемент** отображается список функций, включенных в выражение.</span><span class="sxs-lookup"><span data-stu-id="0a49d-125">When you expand **Common Functions** and click a category, the **Item** pane displays the list of functions that you include in an expression.</span></span> <span data-ttu-id="0a49d-126">Общие функции включают классы из [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] <xref:System.Math> <xref:System.Convert> пространств имен и и [!INCLUDE[vbprvb](../../includes/vbprvb-md.md)] функций библиотеки времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="0a49d-126">The common functions include classes from the [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] <xref:System.Math> and <xref:System.Convert> namespaces and [!INCLUDE[vbprvb](../../includes/vbprvb-md.md)] run-time library functions.</span></span> <span data-ttu-id="0a49d-127">Для удобства существует просмотр в диалоговом окне **Выражение** наиболее часто используемых функций, где они перечислены по категориям: текст, дата и время, математические, проверка, программный поток, статистическая обработка, финансовые, преобразование и прочие.</span><span class="sxs-lookup"><span data-stu-id="0a49d-127">For convenience, you can view the most commonly used functions in the **Expression** dialog box, where they are listed by category: Text, Date and Time, Math, Inspection, Program Flow, Aggregate, Financial, Conversion, and Miscellaneous.</span></span> <span data-ttu-id="0a49d-128">Менее часто используемые функции не отображаются в списке, но тем не менее могут использоваться в выражении.</span><span class="sxs-lookup"><span data-stu-id="0a49d-128">Less commonly used functions do not appear in the list but can still be used in an expression.</span></span>  
  
 <span data-ttu-id="0a49d-129">Для использования встроенной функции дважды щелкните имя функции на панели "Элемент".</span><span class="sxs-lookup"><span data-stu-id="0a49d-129">To use a built-in function, double-click the function name in the Item pane.</span></span> <span data-ttu-id="0a49d-130">Описание функции появится на панели «Описание», а пример вызова функции отобразится в панели «Пример».</span><span class="sxs-lookup"><span data-stu-id="0a49d-130">A description of the function appears in the Description pane and an example of the function call appears in the Example pane.</span></span> <span data-ttu-id="0a49d-131">В области кода при вводе имени функции, за которой следует левая круглая скобка **(**, в справке IntelliSense отображается каждый допустимый синтаксис для вызова функции.</span><span class="sxs-lookup"><span data-stu-id="0a49d-131">In the code pane, when you type the function name followed by a left parenthesis **(**, the IntelliSense help displays each valid syntax for the function call.</span></span> <span data-ttu-id="0a49d-132">Например, чтобы вычислить максимальное значение для поля с именем `Quantity` в таблице, добавьте простое выражение `=Max(` в панель кода и затем используйте смарт-теги для просмотра всех возможных действительных синтаксисов для вызова функции.</span><span class="sxs-lookup"><span data-stu-id="0a49d-132">For example, to calculate the maximum value for a field named `Quantity` in a table, add the simple expression `=Max(` to the Code pane, and then use the smart tags to view all possible valid syntaxes for the function call.</span></span> <span data-ttu-id="0a49d-133">Чтобы завершить этот пример, введите `=Max(Fields!Quantity.Value)`.</span><span class="sxs-lookup"><span data-stu-id="0a49d-133">To complete this example, type `=Max(Fields!Quantity.Value)`.</span></span>  
  
 <span data-ttu-id="0a49d-134">Дополнительные сведения о каждой функции см. в описании <xref:System.Math>, <xref:System.Convert>и в статье [Компоненты библиотеки Visual Basic времени выполнения](https://go.microsoft.com/fwlink/?LinkId=198941) на сайте MSDN.</span><span class="sxs-lookup"><span data-stu-id="0a49d-134">For more information about each function, see <xref:System.Math>, <xref:System.Convert>, and [Visual Basic Runtime Library Members](https://go.microsoft.com/fwlink/?LinkId=198941) on MSDN.</span></span>  
  
##  <a name="including-references-to-less-commonly-used-functions"></a><a name="NotCommon"></a><span data-ttu-id="0a49d-135">Включение ссылок на менее часто используемые функции</span><span class="sxs-lookup"><span data-stu-id="0a49d-135">Including References to Less Commonly Used Functions</span></span>  
 <span data-ttu-id="0a49d-136">Для включения ссылки на наименее часто используемые пространства имен CLR необходимо использовать полную ссылку, например <xref:System.Text.StringBuilder>.</span><span class="sxs-lookup"><span data-stu-id="0a49d-136">To include a reference to other less commonly used CLR namespaces, you must use a fully qualified reference, for example, <xref:System.Text.StringBuilder>.</span></span> <span data-ttu-id="0a49d-137">Для наименее часто используемых функций технология Intellisense не поддерживается на панели кода диалогового окна **Выражение** .</span><span class="sxs-lookup"><span data-stu-id="0a49d-137">IntelliSense is not supported in the code pane of the **Expression** dialog box for these less commonly used functions.</span></span>  
  
 <span data-ttu-id="0a49d-138">Дополнительные сведения см. в разделе [Компоненты библиотеки времени выполнения Visual Basic](https://go.microsoft.com/fwlink/?LinkId=198941) в MSDN.</span><span class="sxs-lookup"><span data-stu-id="0a49d-138">For more information, see [Visual Basic Runtime Library Members](https://go.microsoft.com/fwlink/?LinkId=198941) on MSDN.</span></span>  
  
##  <a name="including-references-to-external-assemblies"></a><a name="External"></a> <span data-ttu-id="0a49d-139">Включение ссылок к внешним сборкам</span><span class="sxs-lookup"><span data-stu-id="0a49d-139">Including References to External Assemblies</span></span>  
 <span data-ttu-id="0a49d-140">Для включения ссылки к классу во внешней сборке необходимо определить сборку для обработчика отчетов.</span><span class="sxs-lookup"><span data-stu-id="0a49d-140">To include a reference to a class in an external assembly, you must identify the assembly for the report processor.</span></span> <span data-ttu-id="0a49d-141">Используйте страницу **Ссылки** диалогового окна **Свойства отчета** для определения полного имени сборки, добавляемого в отчет.</span><span class="sxs-lookup"><span data-stu-id="0a49d-141">Use the **References** page of the **Report Properties** dialog box to specify the fully qualified name of the assembly to add to the report.</span></span> <span data-ttu-id="0a49d-142">В выражении необходимо использовать полное имя для класса сборки.</span><span class="sxs-lookup"><span data-stu-id="0a49d-142">In your expression, you must use the fully qualified name for the class in the assembly.</span></span> <span data-ttu-id="0a49d-143">Классы во внешней сборке не отображаются в диалоговом окне **Выражение** . Для отображения необходимо вести правильное имя класса.</span><span class="sxs-lookup"><span data-stu-id="0a49d-143">Classes in an external assembly do not appear in the **Expression** dialog box; you must provide the correct name for the class.</span></span> <span data-ttu-id="0a49d-144">Полное имя включает пространство имен, имя класса и имя элемента.</span><span class="sxs-lookup"><span data-stu-id="0a49d-144">A fully qualified name includes the namespace, the class name, and the member name.</span></span>  
  
##  <a name="including-embedded-code"></a><a name="Embedded"></a> <span data-ttu-id="0a49d-145">Включение внедренного кода</span><span class="sxs-lookup"><span data-stu-id="0a49d-145">Including Embedded Code</span></span>  
 <span data-ttu-id="0a49d-146">Чтобы добавить внедренный код в отчет, используйте вкладку «Код» диалогового окна **Свойства отчета** .</span><span class="sxs-lookup"><span data-stu-id="0a49d-146">To add embedded code to a report, use the Code tab of the **Report Properties** dialog box.</span></span> <span data-ttu-id="0a49d-147">Этот созданный блок кода может содержать несколько методов.</span><span class="sxs-lookup"><span data-stu-id="0a49d-147">The code block you create can contain multiple methods.</span></span> <span data-ttu-id="0a49d-148">Методы во внедренном коде должны быть написаны в [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[vbprvb](../../includes/vbprvb-md.md)] и должны быть основаны на экземпляре.</span><span class="sxs-lookup"><span data-stu-id="0a49d-148">Methods in embedded code must be written in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[vbprvb](../../includes/vbprvb-md.md)] and must be instance-based.</span></span> <span data-ttu-id="0a49d-149">Обработчик отчетов автоматически добавляет ссылки на пространства имен System.Convert и System.Math.</span><span class="sxs-lookup"><span data-stu-id="0a49d-149">The report processor automatically adds references for the System.Convert and System.Math namespaces.</span></span> <span data-ttu-id="0a49d-150">Для добавления дополнительных ссылок на сборки используйте страницу **Ссылки** диалогового окна **Свойства отчета** .</span><span class="sxs-lookup"><span data-stu-id="0a49d-150">Use the **References** page of the **Report Properties** dialog box to add additional assembly references.</span></span> <span data-ttu-id="0a49d-151">Дополнительные сведения см. в разделе [Добавление в отчет ссылки на сборку (службы SSRS)](add-an-assembly-reference-to-a-report-ssrs.md).</span><span class="sxs-lookup"><span data-stu-id="0a49d-151">For more information, see [Add an Assembly Reference to a Report &#40;SSRS&#41;](add-an-assembly-reference-to-a-report-ssrs.md).</span></span>  
  
 <span data-ttu-id="0a49d-152">Методы во внедренном коде доступны через глобально определенный элемент `Code`.</span><span class="sxs-lookup"><span data-stu-id="0a49d-152">Methods in embedded code are available through a globally defined `Code` member.</span></span> <span data-ttu-id="0a49d-153">Получить к ним доступ можно с помощью ссылки на элемент `Code` и имени метода.</span><span class="sxs-lookup"><span data-stu-id="0a49d-153">You access these by referring to the `Code` member and the method name.</span></span> <span data-ttu-id="0a49d-154">В следующем примере демонстрируется вызов метода `ToUSD`, который преобразует значение поля `StandardCost` в долларовое значение:</span><span class="sxs-lookup"><span data-stu-id="0a49d-154">The following example calls the method `ToUSD`, which converts the value in the `StandardCost` field to a dollar value:</span></span>  
  
```  
=Code.ToUSD(Fields!StandardCost.Value)  
```  
  
 <span data-ttu-id="0a49d-155">Чтобы сослаться на встроенные коллекции в пользовательском коде, включите ссылку во встроенный объект `Report`:</span><span class="sxs-lookup"><span data-stu-id="0a49d-155">To reference built-in collections in your custom code, include a reference to the built-in `Report` object:</span></span>  
  
```  
=Report.Parameters!Param1.Value  
```  
  
 <span data-ttu-id="0a49d-156">В следующих примерах показано, как можно определить некоторые пользовательские константы и переменные:</span><span class="sxs-lookup"><span data-stu-id="0a49d-156">The following examples show how to define some custom constants and variables.</span></span>  
  
```  
Public Const MyNote = "Authored by Bob"  
Public Const NCopies As Int32 = 2  
Public Dim  MyVersion As String = "123.456"  
Public Dim MyDoubleVersion As Double = 123.456  
```  
  
 <span data-ttu-id="0a49d-157">Хотя пользовательские константы не появляются в категории **Константы** диалогового окна **Выражение** (в котором отображаются только встроенные константы), на них можно добавить ссылку из любого выражения, как это показано в следующих примерах.</span><span class="sxs-lookup"><span data-stu-id="0a49d-157">Although custom constants do not appear in the **Constants** category in the **Expression** dialog box (which only displays built-in constants), you can add references to them from any expression, as shown in the following examples.</span></span> <span data-ttu-id="0a49d-158">В выражении пользовательская константа рассматривается как данные типа `Variant`.</span><span class="sxs-lookup"><span data-stu-id="0a49d-158">In an expression, a custom constant is treated as a `Variant`.</span></span>  
  
```  
=Code.MyNote  
=Code.NCopies  
=Code.MyVersion  
=Code.MyDoubleVersion  
```  
  
 <span data-ttu-id="0a49d-159">Следующий пример содержит ссылку на код и код реализации функции `FixSpelling`, которая подставляет текст `"Bicycle"` вместо всех вхождений текста «Bike» в поле `SubCategory`.</span><span class="sxs-lookup"><span data-stu-id="0a49d-159">The following example includes both the code reference and the code implementation of the function `FixSpelling`, which substitutes the text `"Bicycle"` for all occurrences of the text "Bike" in the `SubCategory` field.</span></span>  
  
 `=Code.FixSpelling(Fields!SubCategory.Value)`  
  
 <span data-ttu-id="0a49d-160">Следующий код показывает реализацию метода `FixSpelling` при его внедрении в блок кода определения отчета.</span><span class="sxs-lookup"><span data-stu-id="0a49d-160">The following code, when embedded in a report definition code block, shows an implementation of the `FixSpelling` method.</span></span> <span data-ttu-id="0a49d-161">В этом примере показано, как использовать полную ссылку на [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] `StringBuilder` класс.</span><span class="sxs-lookup"><span data-stu-id="0a49d-161">This example shows you how to use a fully qualified reference to the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] `StringBuilder` class.</span></span>  
  
```vb  
Public Function FixSpelling(ByVal s As String) As String  
   Dim strBuilder As New System.Text.StringBuilder(s)  
   If s.Contains("Bike") Then  
      strBuilder.Replace("Bike", "Bicycle")  
      Return strBuilder.ToString()  
      Else : Return s  
   End If  
End Function  
```  
  
 <span data-ttu-id="0a49d-162">Дополнительные сведения о встроенных коллекциях объектов и инициализации см. в разделах [Встроенные глобальные значения и ссылки на пользовательские поля (построитель отчетов и службы SSRS)](built-in-collections-built-in-globals-and-users-references-report-builder.md) и [Инициализация объектов пользовательских сборок](../custom-assemblies/initializing-custom-assembly-objects.md).</span><span class="sxs-lookup"><span data-stu-id="0a49d-162">For more information about built-in object collections and initialization, see [Built-in Globals and Users References &#40;Report Builder and SSRS&#41;](built-in-collections-built-in-globals-and-users-references-report-builder.md) and [Initializing Custom Assembly Objects](../custom-assemblies/initializing-custom-assembly-objects.md).</span></span>  
  
##  <a name="including-references-to-parameters-from-code"></a><a name="Parameters"></a> <span data-ttu-id="0a49d-163">Включение ссылок на параметры из кода</span><span class="sxs-lookup"><span data-stu-id="0a49d-163">Including References to Parameters from Code</span></span>  
 <span data-ttu-id="0a49d-164">Можно ссылаться на коллекции глобальных параметров через пользовательский код в блоке «Код» определения отчета или в предоставляемой пользовательской сборке.</span><span class="sxs-lookup"><span data-stu-id="0a49d-164">You can reference the global parameters collection via custom code in a Code block of the report definition or in a custom assembly that you provide.</span></span> <span data-ttu-id="0a49d-165">Коллекция параметров допускает только чтение, и у нее нет общих итераторов.</span><span class="sxs-lookup"><span data-stu-id="0a49d-165">The parameters collection is read-only and has no public iterators.</span></span> <span data-ttu-id="0a49d-166">[!INCLUDE[vbprvb](../../includes/vbprvb-md.md)] `For Each` Для пошагового просмотра коллекции нельзя использовать конструкцию.</span><span class="sxs-lookup"><span data-stu-id="0a49d-166">You cannot use a [!INCLUDE[vbprvb](../../includes/vbprvb-md.md)] `For Each` construct to step through the collection.</span></span> <span data-ttu-id="0a49d-167">Прежде чем сослаться на параметр из своего кода, необходимо узнать его имя, заданное в определении отчета.</span><span class="sxs-lookup"><span data-stu-id="0a49d-167">You need to know the name of the parameter defined in the report definition before you can reference it in your code.</span></span> <span data-ttu-id="0a49d-168">Однако можно организовать итерацию по всем значениям многозначного параметра.</span><span class="sxs-lookup"><span data-stu-id="0a49d-168">You can, however, iterate through all the values of a multivalue parameter.</span></span>  
  
 <span data-ttu-id="0a49d-169">Следующая таблица включает примеры ссылок на встроенную коллекцию `Parameters` из пользовательского кода:</span><span class="sxs-lookup"><span data-stu-id="0a49d-169">The following table includes examples of referencing the built-in collection `Parameters` from custom code:</span></span>  
  
|<span data-ttu-id="0a49d-170">Описание</span><span class="sxs-lookup"><span data-stu-id="0a49d-170">Description</span></span>|<span data-ttu-id="0a49d-171">Ссылки в выражении</span><span class="sxs-lookup"><span data-stu-id="0a49d-171">Reference in Expression</span></span>|<span data-ttu-id="0a49d-172">Определение пользовательского кода</span><span class="sxs-lookup"><span data-stu-id="0a49d-172">Custom Code definition</span></span>|  
|-----------------|-----------------------------|----------------------------|  
|<span data-ttu-id="0a49d-173">Передача всей коллекции глобальных параметров в пользовательский код.</span><span class="sxs-lookup"><span data-stu-id="0a49d-173">Passing an entire global parameter collection to custom code.</span></span><br /><br /> <span data-ttu-id="0a49d-174">Эта функция возвращает значение конкретного параметра отчета *MyParameter*.</span><span class="sxs-lookup"><span data-stu-id="0a49d-174">This function returns the value of a specific report parameter *MyParameter*.</span></span>|`=Code.DisplayAParameterValue(Parameters)`|`Public Function DisplayAParameterValue(`<br /><br /> `ByVal parameters as Parameters) as Object`<br /><br /> `Return parameters("MyParameter").Value`<br /><br /> `End Function`|  
|<span data-ttu-id="0a49d-175">Передача отдельных параметров в пользовательский код.</span><span class="sxs-lookup"><span data-stu-id="0a49d-175">Passing an individual parameter to custom code.</span></span><br /><br /> <span data-ttu-id="0a49d-176">Этот пример возвращает значение переданного параметра.</span><span class="sxs-lookup"><span data-stu-id="0a49d-176">This example returns the value of the parameter passed in.</span></span> <span data-ttu-id="0a49d-177">Если этот параметр является многозначным, возвращаемая строка представляет собой объединение всех значений.</span><span class="sxs-lookup"><span data-stu-id="0a49d-177">If the parameter is a multivalue parameter, the return string is a concatenation of all the values.</span></span>|`=Code.ShowParametersValues(Parameters!DayOfTheWeek)`|`Public Function ShowParameterValues(ByVal parameter as Parameter)` <br />  `as String` <br /> `Dim s as String`  <br />  `If parameter.IsMultiValue then` <br />  `s = "Multivalue: "`  <br /> `For i as integer = 0 to parameter.Count-1` <br />  `s = s + CStr(parameter.Value(i)) + " "`  <br />  `Next` <br /> `Else` <br /> `s = "Single value: " + CStr(parameter.Value)` <br /> `End If` <br />  `Return s` <br /> `End Function`|  
  
##  <a name="including-references-to-code-from-custom-assemblies"></a><a name="Custom"></a><span data-ttu-id="0a49d-178">Включение ссылок на код из пользовательских сборок</span><span class="sxs-lookup"><span data-stu-id="0a49d-178">Including References to Code from Custom Assemblies</span></span>  
 <span data-ttu-id="0a49d-179">Для использования в отчете пользовательских сборок необходимо сначала создать сборку, сделать ее доступной для конструктора отчетов, добавить в отчет на нее ссылку, а затем использовать в выражениях отчета ссылки на методы этой сборки.</span><span class="sxs-lookup"><span data-stu-id="0a49d-179">To use custom assemblies in a report, you must first create the assembly, make it available to Report Designer, add a reference to the assembly in the report, and then use an expression in the report to refer to the methods contained in that assembly.</span></span> <span data-ttu-id="0a49d-180">При развертывании отчета на сервере отчетов следует также развернуть на сервере отчетов и пользовательскую сборку.</span><span class="sxs-lookup"><span data-stu-id="0a49d-180">When the report is deployed to the report server, you must also deploy the custom assembly to the report server.</span></span>  
  
 <span data-ttu-id="0a49d-181">Дополнительные сведения о создании пользовательской сборки и предоставления к ней доступа для служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)]см. в разделе [Использование пользовательских сборок с отчетами](../custom-assemblies/using-custom-assemblies-with-reports.md).</span><span class="sxs-lookup"><span data-stu-id="0a49d-181">For information about creating a custom assembly and making it available to [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)], see [Using Custom Assemblies with Reports](../custom-assemblies/using-custom-assemblies-with-reports.md).</span></span>  
  
 <span data-ttu-id="0a49d-182">Для ссылки в выражении на пользовательский код следует вызвать элемент класса этой сборки.</span><span class="sxs-lookup"><span data-stu-id="0a49d-182">To refer to custom code in an expression, you must call the member of a class within the assembly.</span></span> <span data-ttu-id="0a49d-183">Способ создания ссылки зависит от того, является ли метод статическим или основывается на экземпляре.</span><span class="sxs-lookup"><span data-stu-id="0a49d-183">How you do this depends on whether the method is static or instance-based.</span></span> <span data-ttu-id="0a49d-184">Статические методы в пользовательской сборке доступны из всех элементов отчета.</span><span class="sxs-lookup"><span data-stu-id="0a49d-184">Static methods within a custom assembly are available globally within the report.</span></span> <span data-ttu-id="0a49d-185">В выражениях можно получить доступ к статическим методам с помощью указания пространства имен, класса и имени метода.</span><span class="sxs-lookup"><span data-stu-id="0a49d-185">You can access static methods in expressions by specifying the namespace, class, and method name.</span></span> <span data-ttu-id="0a49d-186">В следующем примере вызывается метод `ToGBP` , который преобразует значение **StandardCost** из доллара в фунты стерлингов:</span><span class="sxs-lookup"><span data-stu-id="0a49d-186">The following example calls the method `ToGBP`, which converts the value of the **StandardCost** value from dollar to pounds sterling:</span></span>  
  
```  
=CurrencyConversion.DollarCurrencyConversion.ToGBP(Fields!StandardCost.Value)  
```  
  
 <span data-ttu-id="0a49d-187">Методы на основе экземпляра доступны через глобально определенный элемент `Code`.</span><span class="sxs-lookup"><span data-stu-id="0a49d-187">Instance-based methods are available through a globally defined `Code` member.</span></span> <span data-ttu-id="0a49d-188">Получить к ним доступ можно с помощью ссылки на элемент `Code`, затем на экземпляр и на имя метода.</span><span class="sxs-lookup"><span data-stu-id="0a49d-188">You access these by referring to the `Code` member, followed by the instance and method name.</span></span> <span data-ttu-id="0a49d-189">В следующем примере вызывается метод экземпляра `ToEUR` , который преобразует значение **StandardCost** из доллара в евро:</span><span class="sxs-lookup"><span data-stu-id="0a49d-189">The following example calls the instance method `ToEUR`, which converts the value of **StandardCost** from dollar to euro:</span></span>  
  
```  
=Code.m_myDollarCoversion.ToEUR(Fields!StandardCost.Value)  
```  
  
> [!NOTE]  
>  <span data-ttu-id="0a49d-190">В конструкторе отчетов пользовательская сборка загружается один раз и не выгружается до тех пор, пока не будет закрыта среда [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0a49d-190">In Report Designer, a custom assembly is loaded once and is not unloaded until you close [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)].</span></span> <span data-ttu-id="0a49d-191">Если при предварительном просмотре производятся изменения использованной в отчете пользовательской сборки, а затем отчет просматривается снова, то при повторном открытии отчета для предварительного просмотра изменения отображаться не будут.</span><span class="sxs-lookup"><span data-stu-id="0a49d-191">If you preview a report, make changes to a custom assembly used in the report, and then preview the report again, the changes will not appear in the second preview.</span></span> <span data-ttu-id="0a49d-192">Чтобы перезагрузить сборку, закройте, а затем повторно откройте среду [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] , а потом произведите предварительный просмотр.</span><span class="sxs-lookup"><span data-stu-id="0a49d-192">To reload the assembly, close and reopen [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] and then preview the report.</span></span>  
  
 <span data-ttu-id="0a49d-193">Дополнительные сведения о доступе к коду см. в разделе [Accessing Custom Assemblies Through Expressions](../custom-assemblies/accessing-custom-assemblies-through-expressions.md).</span><span class="sxs-lookup"><span data-stu-id="0a49d-193">For more information about accessing your code, see [Accessing Custom Assemblies Through Expressions](../custom-assemblies/accessing-custom-assemblies-through-expressions.md).</span></span>  
  
##  <a name="passing-built-in-collections-into-custom-assemblies"></a><a name="collections"></a> <span data-ttu-id="0a49d-194">Передача встроенных коллекций в пользовательские сборки</span><span class="sxs-lookup"><span data-stu-id="0a49d-194">Passing Built-in Collections into Custom Assemblies</span></span>  
 <span data-ttu-id="0a49d-195">Если необходимо передать встроенные коллекции, например *Globals* или *Parameters* , в пользовательскую сборку для обработки, следует добавить ссылку на сборку из проекта кода в сборку, определяющую встроенные коллекции и доступ к правильному пространству имен.</span><span class="sxs-lookup"><span data-stu-id="0a49d-195">If you want to pass built-in collections, such as the *Globals* or *Parameters* collection, into a custom assembly for processing, you must add an assembly reference in your code project to the assembly that defines the built-in collections and access the correct namespace.</span></span> <span data-ttu-id="0a49d-196">В зависимости от того, разрабатывается ли пользовательская сборка для отчета, выполняемого на сервере отчетов (серверный отчет), или отчета, выполняемого локально, в приложении платформы .NET (локальный отчет) может понадобиться использовать ссылки на разные сборки.</span><span class="sxs-lookup"><span data-stu-id="0a49d-196">Depending on whether you are developing the custom assembly for a report that is run on a report server (server report) or a report that is run locally in a .NET application (local report), the assembly you need to reference is different.</span></span> <span data-ttu-id="0a49d-197">Подробности см. ниже.</span><span class="sxs-lookup"><span data-stu-id="0a49d-197">See below for details.</span></span>  
  
-   <span data-ttu-id="0a49d-198">**Пространство имен:** Microsoft.ReportingServices.ReportProcessing.ReportObjectModel</span><span class="sxs-lookup"><span data-stu-id="0a49d-198">**Namespace:** Microsoft.ReportingServices.ReportProcessing.ReportObjectModel</span></span>  
  
-   <span data-ttu-id="0a49d-199">**Сборка (локальный отчет):** Microsoft.ReportingServices.ProcessingObjectModel.dll</span><span class="sxs-lookup"><span data-stu-id="0a49d-199">**Assembly (local report):** Microsoft.ReportingServices.ProcessingObjectModel.dll</span></span>  
  
-   <span data-ttu-id="0a49d-200">**Сборка (отчет по серверу):** Microsoft.ReportViewer.ProcessingObjectModel.dll</span><span class="sxs-lookup"><span data-stu-id="0a49d-200">**Assembly (server report):** Microsoft.ReportViewer.ProcessingObjectModel.dll</span></span>  
  
 <span data-ttu-id="0a49d-201">Поскольку содержимое коллекций *Fields* и *ReportItems* может динамически изменяться во время выполнения, доступ к нему не следует производить посредством вызовов пользовательской сборки (например, в переменной члена).</span><span class="sxs-lookup"><span data-stu-id="0a49d-201">Since the content of the *Fields* and *ReportItems* collections can change dynamically at runtime, you should not hold onto them across calls into the custom assembly (for example, in a member variable).</span></span> <span data-ttu-id="0a49d-202">Та же самая рекомендация применяется обычно для всех встроенных коллекций.</span><span class="sxs-lookup"><span data-stu-id="0a49d-202">The same recommendation applies generally to all built-in collections.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0a49d-203">См. также:</span><span class="sxs-lookup"><span data-stu-id="0a49d-203">See Also</span></span>  
 <span data-ttu-id="0a49d-204">[Добавление кода в отчет &#40;SSRS&#41;](add-code-to-a-report-ssrs.md) </span><span class="sxs-lookup"><span data-stu-id="0a49d-204">[Add Code to a Report &#40;SSRS&#41;](add-code-to-a-report-ssrs.md) </span></span>  
 <span data-ttu-id="0a49d-205">[Использование пользовательских сборок с отчетами](../custom-assemblies/using-custom-assemblies-with-reports.md) </span><span class="sxs-lookup"><span data-stu-id="0a49d-205">[Using Custom Assemblies with Reports](../custom-assemblies/using-custom-assemblies-with-reports.md) </span></span>  
 <span data-ttu-id="0a49d-206">[Добавление ссылки на сборку в отчет &#40;SSRS&#41;](add-an-assembly-reference-to-a-report-ssrs.md) </span><span class="sxs-lookup"><span data-stu-id="0a49d-206">[Add an Assembly Reference to a Report &#40;SSRS&#41;](add-an-assembly-reference-to-a-report-ssrs.md) </span></span>  
 <span data-ttu-id="0a49d-207">[Reporting Services учебники &#40;службы SSRS&#41;](../reporting-services-tutorials-ssrs.md) </span><span class="sxs-lookup"><span data-stu-id="0a49d-207">[Reporting Services Tutorials &#40;SSRS&#41;](../reporting-services-tutorials-ssrs.md) </span></span>  
 <span data-ttu-id="0a49d-208">[Примеры выражений (построитель отчетов и службы SSRS)](expression-examples-report-builder-and-ssrs.md) </span><span class="sxs-lookup"><span data-stu-id="0a49d-208">[Expression Examples &#40;Report Builder and SSRS&#41;](expression-examples-report-builder-and-ssrs.md) </span></span>  
 [<span data-ttu-id="0a49d-209">Образцы отчетов (построитель отчетов и службы SSRS)</span><span class="sxs-lookup"><span data-stu-id="0a49d-209">Report Samples (Report Builder and SSRS)</span></span>](https://go.microsoft.com/fwlink/?LinkId=198283)  
  
  
