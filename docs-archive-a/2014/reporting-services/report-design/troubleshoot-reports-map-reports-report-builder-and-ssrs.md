---
title: 'Устранение неполадок в отчетах: отчеты-карты (построитель отчетов и службы SSRS) | Документы Майкрософт'
ms.custom: ''
ms.date: 12/29/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: reporting-services-native
ms.topic: conceptual
ms.assetid: a690aec2-056b-40bc-8cab-c694bd2d6d62
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: e9279b9cc52aa2a1178fe6093ee56120859b867b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87733605"
---
# <a name="troubleshoot-reports-map-reports-report-builder-and-ssrs"></a>Устранение неполадок в отчетах. Отчеты-карты (построитель отчетов и службы SSRS)
  Проблемы с картами могут возникнуть при добавлении карты или слоя карты в отчет, при настройке существующей карты или слоя карты в отчете, при предварительном просмотре карты в отчете или при публикации отчета с картой. Этот раздел помогает устранять эти проблемы.  
  
> [!NOTE]  
>  [!INCLUDE[ssRBRDDup](../../includes/ssrbrddup-md.md)]  
  
##  <a name="report-definition-size-issues"></a><a name="Embedded"></a>Проблемы с размером определения отчета  
 Этот раздел нужен для решения проблем, связанных с размером определения отчета.  
  
### <a name="how-do-i-reduce-the-report-definition-size"></a>Как уменьшить размер определения отчета?  
 Слой карты содержит элементы карты, созданные на основании пространственных данных. Иногда элементы карты внедрены в определение отчета. Это происходит следующим образом.  
  
-   Если источником пространственных данных является карта из галереи карт или из файла фигуры ESRI на локальном компьютере, элементы карты автоматически внедряются в определение отчета.  
  
     Если отчет публикуется на сервере отчетов и существует ссылка источника пространственных данных на локальный файл, то к этим данным нельзя обратиться во время обработки отчета. Чтобы избежать этой проблемы, данные карты внедряются в определение отчета.  
  
-   В мастере карты или мастере слоя, если выбрать внедрение пространственных данных, элементы карты, основанные на них, будут внедряться в слой карты в определении отчета.  
  
-   На панели "Карта", если щелкнуть правой кнопкой слой, а затем выбрать один из параметров **Внедрить пространственные данные** , элементы карты, основанные на пространственных данных, будут внедрены в слой карты в определении отчета.  
  
-   Чтобы удалить внедренные данные, основанные на файле фигуры ESRI, из определения отчета, сделайте следующее.  
  
1.  Передайте на сервер отчетов или опубликуйте SHP- и DBF-файлы ESRI.  
  
2.  В отчете, на панели «Карта» в режиме конструктора, выберите слой с внедренными данными и откройте **Свойства слоя данных** . В поле **Использовать пространственные данные из**выберите **Связать с файлом фигуры ESRI**, затем перейдите в папку на сервере отчетов, содержащую файлы фигур ESRI, выберите файл и нажмите кнопку «ОК».  
  
3.  Сохраните отчет. Измененные внедренные данные слоя были удалены из определения отчета.  
  
 Элементы карты из отчета в галерее карт всегда будут внедрены в слой карты.  
  
  
  
##  <a name="spatial-data-issues"></a><a name="Spatial"></a>Проблемы с пространственными данными  
 Этот раздел используется, чтобы решить проблемы, связанные с пространственными данными.  
  
### <a name="on-the-design-surface-i-see-sample-spatial-data"></a>В области конструктора виден образец пространственных данных  
 Во время разработки область конструктора может показывать сообщение об образце пространственных данных по следующим причинам.  
  
-   Пространственные данные получены из SHP-файла ESRI, но соответствующий DBF-файл недоступен. Файлы фигур ESRI обычно включают и SHP-файл с пространственными данными, и DBF-файл поддержки. Убедитесь, что DBF-файл находится в том же каталоге, что и SHP-файл.  
  
-   Пространственные данные получены из набора данных, а подключение к данным для запроса недоступно, или текущие учетные данные недопустимы.  
  
-   Слой карты содержит свойство с выражением. Выражения не вычисляются, пока отчет не будет запущен. Чтобы увидеть карту, следует запустить предварительный просмотр отчета.  
  
-   Пространственные данные получены из набора данных, у которого нет своей области. Например, если карта вложена в область данных табликса или карта использует один и тот же набор данных для аналитических и пространственных данных, область данных не будет вычисляться, пока отчет не будет запущен.  
  
### <a name="when-i-set-an-offset-for-an-individual-map-element-a-cluster-of-map-elements-move"></a>При задании смещения для конкретного элемента карты перемещается кластер элементов карты  
 Пространственные данные задают элементы карты, отображаемые на каждом слое карты. Пространственные данные из источника данных могут представлять собой точку, несколько точек, линию, несколько линий или набор многоугольников. Все элементы карты являются отдельными единицами. Если элемент карты содержит несколько точек, то при перемещении элемента будут перемещены все точки этого элемента карты.  
  
 Данные всех элементов карты определяются с помощью формата пространственных данных из внешнего источника. Например, если запрос задает пространственные данные из базы данных SQL Server, каждая строка в результирующем наборе может содержать множественные наборы точек, линий или координат вершин многоугольника. Все элементы карты, заданные одной строкой в результирующем наборе, обрабатываются как целое. Если требуется изменить отображение конкретных наборов координат, выполните одно из следующих действий.  
  
-   Измените запрос, чтобы он возвращал набор координат как отдельные строки в результирующем наборе.  
  
-   Выберите элементы карты, которые нужно изменить, и установите соответствующую внедренную точку, линию, или свойства многоугольника путем переопределения свойств отображения по умолчанию для соответствующего типа слоя.  
  
### <a name="my-layer-that-uses-spatial-data-from-an-esri-shapefile-always-has-embedded-data"></a>Слой, использующий пространственные данные из файла фигуры ESRI, всегда содержит внедренные данные.  
 Чтобы гарантировать, что отчет с картами может быть запущен на сервере отчетов, шейп-файлы ESRI должны быть доступны в качестве ресурса на сервере отчетов. Если добавить слой в карту и указать файл фигуры в локальной файловой системе, пространственные данные будут автоматически внедрены в отчет.  
  
 Чтобы заменить внедренные данные на ссылку на файл фигуры ESRI, необходимо передать файл фигуры ESRI с расширением SHP и совпадающий с DBF-файлом на сервер отчетов, а затем изменить источник пространственных данных для слоя.  
  
### <a name="i-renamed-a-data-source-or-dataset-to-a-friendly-name-and-now-no-data-appears-in-my-map"></a>Источнику или набору данных было дано понятное имя, и теперь данные на карте не отображаются.  
 Определение отчета не обновляется автоматически при ручном изменении имени элемента отчета.  
  
 При изменении имени набора данных любая область данных или слой карты, которые ссылаются на этот набор, должны быть обновлены вручную. Для повторной привязки табликса, диаграммы или датчика к набору данных выберите элемент в области конструктора, откройте свойства области данных и выберите имя соответствующего набора данных. Для повторной привязки слоя карты к набору данных выберите слой, откройте свойства слоя и выберите имя соответствующего набора данных.  
  
### <a name="my-spatial-data-contains-nulls-and-empty-strings"></a>Пространственные данные содержат значения NULL и пустые строки.  
 В пространственных данных для элемента отчета-карты значения NULL устанавливаются в ноль (0), а пустые строки — в пустые строки ("").  
  
 Для пространственных данных, полученных из базы данных SQL Server, чтобы изменить это поведение, следует изменить запрос, который возвращает пространственные данные.  
  
### <a name="my-map-exceeds-the-maximum-number-of-spatial-elements"></a>Максимальное количество пространственных элементов превышено  
 По умолчанию, карта может иметь 20 000 элементов или 1 000 000 точек. Если карта превышает эти пределы, можно воспользоваться одним из следующих методов.  
  
-   Удалить слой.  
  
-   Уменьшить разрешение карты.  
  
-   Уменьшить координаты окна просмотра карты, чтобы просматривать меньшую область.  
  
-   Если пространственные данные получены из набора данных отчета, установите фильтр, чтобы ограничить количество данных из набора. Фильтр должен быть задан для поля, имеющего непространственный тип данных.  
  
-   Если пространственные данные получены из базы данных SQL Server, измените запрос, чтобы он использовал пространственные функции для ограничения данных меньшей областью.  
  
  
  
##  <a name="viewport-center-and-view-issues"></a><a name="Viewport"></a>Проблемы с центром и просмотром окна просмотра  
 Этот раздел используется, чтобы решить проблемы, связанные с параметрами области просмотра.  
  
### <a name="i-cannot-set-the-center-and-view-on-an-embedded-map-element"></a>Невозможно установить центрирование и область просмотра внедренного элемента карты.  
 Чтобы центрировать область просмотра на конкретном элементе карты, нужно, чтобы связанные пространственные данные находились на слое с аналитическими данными.  
  
### <a name="i-set-the-map-center-and-view-in-my-report-when-i-reopen-the-report-why-isnt-the-map-view-the-same"></a>Для карты были заданы центрирование и область просмотра в отчете. Почему при повторном открытии отчета карта выглядит иначе?  
 Если учетные данные пользователя, необходимые для считывания пространственных данных, недоступны отчету при его открытии, используются пространственные данные заполнителя. В зависимости от параметров центрирования и масштабирования, заданных для окна просмотра карты, представление карты может быть центрировано на различных слоях.  
  
 Чтобы перезагрузить пространственные данные и использовать сохраненный в отчете центр представления карты, щелкните правой кнопкой окно просмотра карты и выберите команду **Перезагрузить**. После ввода учетных данных для пространственного источника данных слой загрузит пространственные данные и вид карты будет восстановлен.  
  
### <a name="the-center-and-view-for-a-map-layer-option-does-not-work"></a>Параметры центрирования и области просмотра для слоя карты не работают.  
 Когда область просмотра центрирована на пространственных данных конкретного слоя и центр просмотра не совпадает с центром слоя, это значит, что, возможно, есть небольшие области, включенные в пространственные данные, которые слишком малы, чтобы отображаться в области просмотра. Например, пространственные данные для страны могут включать в себя маленькие острова или другие небольшие территории как часть общей территории. Область просмотра использует пространственные данные для вычисление центра слоя.  
  
 Переопределить вычисления для слоя можно одним из следующих способов.  
  
-   Задать пользовательский центр области просмотра.  
  
-   Изменить масштаб области просмотра, чтобы устранить местоположения, которые должны быть исключены.  
  
-   Внедрить пространственные данные в отчет и удалить местоположения, которые следует исключить.  
  
  
  
##  <a name="layer-issues"></a><a name="Layers"></a>Проблемы слоя  
 Этот раздел используется, чтобы решить проблемы, связанные с параметрами слоя.  
  
### <a name="i-do-not-see-one-or-more-layers-in-my-map"></a>На карте не видны один или несколько слоев.  
 Видимость слоев карты в отчете зависит от доступности пространственных данных, связи между пространственными и аналитическими данными, типа пространственных данных и типа соответствующего слоя, видимости и прозрачности параметров слоя и порядка отображения слоев. Если данные слоя не видны, проверьте следующие параметры.  
  
-   **Тип слоя и тип пространственных данных.** Тип слоя отображает только пространственные данные, соответствующие типу уровня. Например, если тип уровня — «Точка», а тип пространственных данных — «Линия», ничего не отобразится.  
  
-   **Совпадения значений полей.** Значения в полях, заданных для связи аналитических и пространственных данных, должны уникальным образом указывать на каждый элемент карты. Типы данных полей должны совпадать. Значения полей должны быть одинаковыми. Дополнительные сведения см. в разделе [Проблемы с условными обозначениями, цветовой шкалой и шкалой расстояний](#Legend).  
  
-   **Порядок слоев.** Порядок слоев на панели «Карта» — это порядок, в котором слои отображаются в модуле подготовки отчетов. Пространственные данные на слоях, которые отображаются первыми, могут быть заменены пространственными данными слоев, отображаемых позже. Слои наверху списка отображаются первыми. При изменении порядка слоев в списке изменяется и порядок отображения слоев.  
  
-   **Прозрач.** Можно задать прозрачность каждого слоя карты независимо. Значения по умолчанию для прозрачности зависят от того, как был добавлен слой. Прозрачность 0% означает, что слой непрозрачен и что через него не будут видны данные никаких других слоев. Чтобы другие данные были видны сквозь существующий слой, измените значение на более высокое, что обеспечит нужный эффект.  
  
-   **Доступности.** Видимость для слоя может принимать значения **Видимый**, **Скрытый**или **По масштабу**, на основании масштаба окна просмотра карты. Также можно задать максимум и минимум диапазона для масштаба. Видимость может быть основана на выражении, которое вычисляет одно из этих значений.  
  
    > [!TIP]  
    >  Можно переключать видимость каждого слоя на панели «Карта». При конструировании каждого слоя выключите все остальные, чтобы определить, относится проблема к конкретному слою или же она связана с проблемами прозрачности других слоев.  
  
### <a name="i-set-a-filter-on-the-map-layer-and-it-has-no-effect"></a>Для слоя карты установлен фильтр, но он не действует.  
 Чтобы отфильтровать данные слоя, следует указать тип данных в критерии фильтра. Убедитесь, что был указан верный базовый тип данных, так что уравнение фильтра верно вычисляет заданное условие. Дополнительные сведения см. в разделе [Примеры уравнений фильтра (построитель отчетов и службы SSRS)](filter-equation-examples-report-builder-and-ssrs.md).  
  
##  <a name="legend-color-scale-and-rule-issues"></a><a name="Legend"></a> Проблемы условных обозначений, цветовой шкалы и правил  
 Этот раздел используется, чтобы решить проблемы, связанные с правилами, условными обозначениями и параметрами цветовой шкалы.  
  
### <a name="how-do-i-control-the-values-in-the-map-legend"></a>Как управлять значениями в условных обозначениях карты?  
 Значения условных обозначений определяются автоматически на основании правил типа элемента карты, заданных для каждого слоя карты, и правил распределения, заданных для условных обозначений.  
  
 По умолчанию все элементы условных обозначений, созданные по правилам, появляются в первом обозначении. Значения для всех правил многоугольников, линий и точек для каждого слоя вносят свой вклад в объединенный диапазон условных обозначений. Чтобы отобразить элементы различных условных обозначений, следует сперва создать множественные условные обозначения и затем для каждого правила указать, в каких условных обозначениях отображать связанные элементы.  
  
 Чтобы связать правило с конкретными условными обозначениями, откройте свойства правила и на странице «Условные обозначения» укажите имя условных обозначений. Чтобы удалить элементы из условных обозначений, в параметрах условных обозначений выберите пустую строку в качестве имени условных обозначений. При переименовании элементов условных обозначений в отчете следует вручную назначить каждому слою соответствующий элемент условных обозначений.  
  
 Чтобы управлять заголовком и содержимым условных обозначений, используйте свойства условных обозначений для правила. Можно указать, сколько делений следует создать, изменить вычисления, назначающие значения каждому делению, задать максимальное и минимальное значения диапазона и изменить формат текста условных обозначений.  
  
 Дополнительные сведения см. в разделе [Изменение условных обозначений карты, цветовой шкалы и связанных правил (построитель отчетов и службы SSRS)](change-map-legends-color-scale-and-associated-rules-report-builder-and-ssrs.md).  
  
### <a name="the-rules-that-i-set-do-not-give-the-results-that-i-expect"></a>Заданные правила не дают ожидаемых результатов.  
 Правила применяются к тем аналитическим данным, которые связаны с элементами карты на слое. Используйте следующий список, чтобы идентифицировать проблемы со всеми правилами цвета, размера, ширины и правил типа маркера.  
  
-   Очередность применения стиля к каждому элементу карты (многоугольнику, линии, точке) такова: свойства слоя, свойства элемента карты для всех элементов карты на слое, заданные правила и для внедренных элементов карты, для которых выбран параметр переопределения, указанные значения. Если для внедренного элемента выбрано переопределение параметра, правила более не применяются, даже если впоследствии изменить значения обратно.  
  
-   Проблемы полей соответствия. Поля соответствия включают привязку данных между элементами карты и аналитическими данными. Пространственные и аналитические поля данных, которые соответствуют полям совпадения, должны иметь один и тот же тип данных и тот же формат. Если поля соответствия не соответствуют в точности пространственным и аналитическим данным, правило не будет действовать. Например, если поле соответствия для пространственных данных содержит дополнительные пробелы или знаки препинания по сравнению с полем соответствия для аналитических данных, совпадения не будет.  
  
-   Дополнительные сведения см. в разделе [Изменение параметров отображения многоугольников, линий и точек с помощью правил и аналитических данных (построитель отчетов и службы SSRS)](vary-polygon-line-and-point-display-by-rules-and-analytical-data.md).  
  
### <a name="what-is-the-value-nan-on-the-color-scale"></a>Что означает значение NaN на цветовой шкале?  
 `NaN` означает «Не является числом». Значения на цветовой шкале должны быть численными. Проверьте настройки распределения и текстовое значение условных обозначений для правил, связанных с цветовой шкалой. Если были созданы пользовательские диапазоны распределения, убедитесь, что нижняя граница соответствует первому диапазону, а верхняя граница — последнему.  
  
### <a name="my-color-scale-does-not-appear-when-i-run-the-report"></a>Цветовая шкала не появляется при запуске отчета.  
 Цветовая шкала содержит информацию для пользователя, в то время как слой карты задает цветовые правила для многоугольников, линий и точек слоя в целом или для внедренных элементов карты. Если ни один элемент карты не задает правило цвета или если правила цвета указаны с помощью условных обозначений вместо цветовой карты, то цветовая карта не появится в отчете, готовом для просмотра.  
  
 Чтобы отобразить цветовую шкалу, укажите правила цвета для слоя или внедренного элемента карты. Дополнительные сведения см. в разделе [Изменение условных обозначений карты, цветовой шкалы и связанных правил (построитель отчетов и службы SSRS)](change-map-legends-color-scale-and-associated-rules-report-builder-and-ssrs.md).  
  
  
  
##  <a name="tile-issues"></a><a name="Tile"></a> Проблемы мозаичного слоя  
 Этот раздел используется, чтобы решить проблемы, связанные с параметрами фона мозаики.  
  
### <a name="i-cannot-see-the-bing-maps-tile-background"></a>Не виден фон мозаики Bing maps.  
 Следующие настройки определяют видимость фона мозаики Bing maps при локальном предварительном просмотре или в отчете, запущенном на сервере отчетов.  
  
-   Должен существовать мозаичный слой карты. В мастере карт или мастере слоев выберите **Добавить фон карт Bing для этого представления карты**. Это добавит мозаичный слой для представления текущего окна просмотра карты уровня центрирования и масштабирования. Также можно добавить мозаичный слой c панели инструментов панели «Карта».  
  
-   Координатная система карты для области просмотра должна быть **Географическая**, а не **Двумерная**.  
  
-   Проекция карты должна быть **Меркатор**.  
  
-   Для локального предварительного просмотра необходимо иметь доступ в Интернет. Для отчета, запускаемого на сервере отчетов, сервер отчетов должен быть настроен для поддержки мозаичного фона. Дополнительные сведения см. в разделе «Планирование поддержки карты» [документации по службам Reporting Services](https://go.microsoft.com/fwlink/?linkid=121312) , входящей в состав электронной документации по SQL Server.  
  
 Дополнительные сведения о добавлении слоя мозаики см. в разделе [Добавление, изменение или удаление карты или слоя карты (построитель отчетов и службы SSRS)](add-change-or-delete-a-map-or-map-layer-report-builder-and-ssrs.md).  
  
### <a name="how-do-i-control-the-text-on-a-tile-layer"></a>Как изменить текст на мозаичном слое?  
 И представление **Дорога** , и представление **Гибридное** включает в себя текст. Текст — это часть мозаики, приходящая с веб-служб Bing maps.  
  
 Чтобы включить мозаичный слой без текста, выберите вид **Воздушный** .  
  
  
  
##  <a name="tooltip-and-label-issues"></a><a name="Tooltip"></a>Проблемы с подсказкой и меткой  
 Этот раздел используется, чтобы решить проблемы, связанные с подсказками и метками.  
  
### <a name="i-get-an-expression-error-about-dataset-scope-when-i-set-a-label-or-tooltip-to-an-expression"></a>Произошла ошибка выражения, связанная с областью набора данных, при установке выражения в качестве метки или подсказки.  
 Если пространственные данные переданы из галереи данных или файла фигуры ESRI, то связанные данные не являются частью набора данных отчета. Нельзя использовать синтаксис выражений для ссылки на поле набора данных, чтобы установить эти данные в качестве метки или подсказки.  
  
 Чтобы указать данные, связанные с пространственными данными, которые не являются частью набора данных отчета, следует использовать символ # и затем метку, которая указывает на имя данных.  
  
  
  
## <a name="see-also"></a>См. также:  
 [Карты (построитель отчетов и службы SSRS)](maps-report-builder-and-ssrs.md)   
 [Устранение неполадок в построителе отчетов](../troubleshoot-report-builder.md)  
  
  
