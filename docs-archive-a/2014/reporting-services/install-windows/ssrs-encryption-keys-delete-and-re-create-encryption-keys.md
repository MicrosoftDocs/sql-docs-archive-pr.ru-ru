---
title: Удаление и повторное создание ключей шифрования (диспетчер конфигурации служб SSRS) | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
helpviewer_keywords:
- re-creating encryption keys
- encryption keys [Reporting Services]
- deleting encryption keys
- symmetric keys [Reporting Services]
- removing encryption keys
- resetting encryption keys
ms.assetid: 201afe5f-acc9-4a37-b5ec-121dc7df2a61
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: 8fa5138e4bbb84395bad79a272d2bde31389396b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751832"
---
# <a name="delete-and-re-create-encryption-keys--ssrs-configuration-manager"></a><span data-ttu-id="ff042-102">Удаление и повторное создание ключей шифрования (диспетчер конфигурации служб SSRS)</span><span class="sxs-lookup"><span data-stu-id="ff042-102">Delete and Re-create Encryption Keys  (SSRS Configuration Manager)</span></span>
  <span data-ttu-id="ff042-103">Удаление и повторное создание ключей шифрования — действия, которые выходят за пределы обычного обслуживания ключа шифрования.</span><span class="sxs-lookup"><span data-stu-id="ff042-103">Deleting and re-creating encryption keys are activities that fall outside of routine encryption key maintenance.</span></span> <span data-ttu-id="ff042-104">Эти задачи выполняются в ответ на определенную угрозу серверу отчетов или как последнее средство спасения, когда больше нельзя получить доступ к базе данных сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="ff042-104">You perform these tasks in response to a specific threat to your report server, or as a last resort when you can no longer access a report server database.</span></span>  
  
-   <span data-ttu-id="ff042-105">Создайте повторно симметричный ключ, если есть основания полагать, что существующий симметричный ключ скомпрометирован.</span><span class="sxs-lookup"><span data-stu-id="ff042-105">Re-create the symmetric key when you believe the existing symmetric key is compromised.</span></span> <span data-ttu-id="ff042-106">Также можно регулярно создавать повторно ключ для наибольшей эффективности системы безопасности.</span><span class="sxs-lookup"><span data-stu-id="ff042-106">You can also re-create the key on a regular basis as a security best practice.</span></span>  
  
-   <span data-ttu-id="ff042-107">Удалите существующие ключи шифрования и непригодное для использования зашифрованное содержимое, если нельзя восстановить симметричный ключ.</span><span class="sxs-lookup"><span data-stu-id="ff042-107">Delete existing encryption keys and unusable encrypted content when you cannot restore the symmetric key.</span></span>  
  
## <a name="re-creating-encryption-keys"></a><span data-ttu-id="ff042-108">повторное создание ключей шифрования</span><span class="sxs-lookup"><span data-stu-id="ff042-108">Re-creating Encryption Keys</span></span>  
 <span data-ttu-id="ff042-109">Если очевидно, что симметричный ключ известен неправомочным пользователям, или если сервер отчетов подвергся атаке и в качестве меры предосторожности необходимо сбросить симметричный ключ, можно создать повторно симметричный ключ.</span><span class="sxs-lookup"><span data-stu-id="ff042-109">If you have evidence that the symmetric key is known to unauthorized users, or if your report server has been under attack and you want to reset the symmetric key as a precaution, you can re-create the symmetric key.</span></span> <span data-ttu-id="ff042-110">При создании повторно симметричного ключа все зашифрованные значения будут повторно зашифрованы с помощью нового значения.</span><span class="sxs-lookup"><span data-stu-id="ff042-110">When you re-create the symmetric key, all encrypted values will be re-encrypted using the new value.</span></span> <span data-ttu-id="ff042-111">Если работает несколько серверов отчетов в масштабном развертывании, то все копии симметричного ключа будут обновлены новым значением.</span><span class="sxs-lookup"><span data-stu-id="ff042-111">If you are running multiple report servers in a scale-out deployment, all copies of the symmetric key will be updated to the new value.</span></span> <span data-ttu-id="ff042-112">Сервер отчетов использует доступные для него открытые ключи, чтобы обновить симметричный ключ для каждого сервера в развертывании.</span><span class="sxs-lookup"><span data-stu-id="ff042-112">The report server uses the public keys available to it to update the symmetric key for each server in the deployment.</span></span>  
  
 <span data-ttu-id="ff042-113">Когда сервер отчетов находится в рабочем состоянии, можно только создать повторно симметричный ключ.</span><span class="sxs-lookup"><span data-stu-id="ff042-113">You can only re-create the symmetric key when the report server is in a working state.</span></span> <span data-ttu-id="ff042-114">Повторное создание ключей шифрования и повторное шифрование содержимого нарушают работу сервера.</span><span class="sxs-lookup"><span data-stu-id="ff042-114">Re-creating the encryption keys and re-encrypting content disrupts server operations.</span></span> <span data-ttu-id="ff042-115">На время повторного шифрования необходимо обеспечить режим «вне сети» работы сервера.</span><span class="sxs-lookup"><span data-stu-id="ff042-115">You must take the server offline while re-encryption is underway.</span></span> <span data-ttu-id="ff042-116">Во время повторного шифрования какие-либо запросы к серверу отчетов не должны выполняться.</span><span class="sxs-lookup"><span data-stu-id="ff042-116">There should be no requests made to the report server during re-encryption.</span></span>  
  
 <span data-ttu-id="ff042-117">Можно использовать средство настройки служб Reporting Services или программу **rskeymgmt** , чтобы сбросить симметричный ключ и зашифрованные данные.</span><span class="sxs-lookup"><span data-stu-id="ff042-117">You can use the Reporting Services Configuration tool or the **rskeymgmt** utility to reset the symmetric key and encrypted data.</span></span> <span data-ttu-id="ff042-118">Дополнительные сведения о создании симметричного ключа см. в разделе [Инициализация сервера отчетов (диспетчер конфигурации служб SSRS)](ssrs-encryption-keys-initialize-a-report-server.md).</span><span class="sxs-lookup"><span data-stu-id="ff042-118">For more information about how the symmetric key is created, see [Initialize a Report Server &#40;SSRS Configuration Manager&#41;](ssrs-encryption-keys-initialize-a-report-server.md).</span></span>  
  
#### <a name="how-to-re-create-encryption-keys-reporting-services-configuration-tool"></a><span data-ttu-id="ff042-119">Как создать повторно ключи шифрования (программа настройки служб Reporting Services)</span><span class="sxs-lookup"><span data-stu-id="ff042-119">How to re-create encryption keys (Reporting Services Configuration Tool)</span></span>  
  
1.  <span data-ttu-id="ff042-120">Отключите веб-службу сервера отчетов и доступ по протоколу HTTP, изменив свойство `IsWebServiceEnabled` в файле конфигурации rsreportserver.config.</span><span class="sxs-lookup"><span data-stu-id="ff042-120">Disable the Report Server Web service and HTTP access by modifying the `IsWebServiceEnabled` property in the rsreportserver.config file.</span></span> <span data-ttu-id="ff042-121">Выполнение этого шага приводит к временному прекращению передачи запросов проверки подлинности на сервер отчетов без полного останова сервера.</span><span class="sxs-lookup"><span data-stu-id="ff042-121">This step temporarily stops authentication requests from being sent to the report server without completely shutting down the server.</span></span> <span data-ttu-id="ff042-122">Минимальный набор служб необходим для того, чтобы иметь возможность повторного создания ключей.</span><span class="sxs-lookup"><span data-stu-id="ff042-122">You must have minimal service so that you can recreate the keys.</span></span>  
  
     <span data-ttu-id="ff042-123">Если повторно создаются ключи шифрования для сервера отчетов с масштабным развертыванием, нужно отключить это свойство на всех экземплярах в развертывании.</span><span class="sxs-lookup"><span data-stu-id="ff042-123">If you are recreating encryption keys for a report server scale-out deployment, disable this property on all instances in the deployment.</span></span>  
  
    1.  <span data-ttu-id="ff042-124">Откройте проводник Windows и перейдите в папку " *диск*:\Program Files\Microsoft SQL Server\\*экземпляр_сервера_отчетов*\Reporting Services".</span><span class="sxs-lookup"><span data-stu-id="ff042-124">Open Windows Explorer and navigate to *drive*:\Program Files\Microsoft SQL Server\\*report_server_instance*\Reporting Services.</span></span> <span data-ttu-id="ff042-125">Замените *диск* своей буквой диска, а *экземпляр_сервера_отчетов* — именем папки, соответствующей экземпляру сервера отчетов, для которого нужно отключить веб-службу и доступ по протоколу HTTP.</span><span class="sxs-lookup"><span data-stu-id="ff042-125">Replace *drive* with your drive letter and *report_server_instance* with the folder name that corresponds to the report server instance for which you want to disable the Web service and HTTP access.</span></span> <span data-ttu-id="ff042-126">Например, «C:\Program Files\Microsoft SQL Server\MSRS10_50.MSSQLSERVER\Reporting Services».</span><span class="sxs-lookup"><span data-stu-id="ff042-126">For example, C:\Program Files\Microsoft SQL Server\MSRS10_50.MSSQLSERVER\Reporting Services.</span></span>  
  
    2.  <span data-ttu-id="ff042-127">Откройте файл rsreportserver.config.</span><span class="sxs-lookup"><span data-stu-id="ff042-127">Open the rsreportserver.config file.</span></span>  
  
    3.  <span data-ttu-id="ff042-128">Для свойства `IsWebServiceEnabled` укажите ключевое слово `False` и сохраните изменения.</span><span class="sxs-lookup"><span data-stu-id="ff042-128">For the `IsWebServiceEnabled` property, specify `False`, and then save your changes.</span></span>  
  
2.  <span data-ttu-id="ff042-129">Запустите программу настройки служб Reporting Services и подключитесь к экземпляру сервера отчетов, который нужно настроить.</span><span class="sxs-lookup"><span data-stu-id="ff042-129">Start the Reporting Services Configuration tool, and then connect to the report server instance you want to configure.</span></span>  
  
3.  <span data-ttu-id="ff042-130">На странице «Ключи шифрования» нажмите кнопку **Изменить**.</span><span class="sxs-lookup"><span data-stu-id="ff042-130">On the Encryption Keys page, click **Change**.</span></span> [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
4.  <span data-ttu-id="ff042-131">Перезапустите службу Windows «Сервер отчетов».</span><span class="sxs-lookup"><span data-stu-id="ff042-131">Restart the Report Server Windows service.</span></span> <span data-ttu-id="ff042-132">Если повторно создаются ключи шифрования для масштабного развертывания, нужно перезапустить службу на всех экземплярах.</span><span class="sxs-lookup"><span data-stu-id="ff042-132">If you are recreating encryption keys for a scale-out deployment, restart the service on all instances.</span></span>  
  
5.  <span data-ttu-id="ff042-133">Повторно включите веб-службу сервера отчетов и доступ по протоколу HTTP, изменив свойство `IsWebServiceEnabled` в файле конфигурации rsreportserver.config.</span><span class="sxs-lookup"><span data-stu-id="ff042-133">Re-enable the Web service and HTTP access by modifying the `IsWebServiceEnabled` property in the rsreportserver.config file.</span></span> <span data-ttu-id="ff042-134">Сделайте это для всех экземпляров при работе с масштабным развертыванием.</span><span class="sxs-lookup"><span data-stu-id="ff042-134">Do this for all instances if you are working with a scale out deployment.</span></span>  
  
#### <a name="how-to-re-create-encryption-keys-rskeymgmt"></a><span data-ttu-id="ff042-135">Как создать повторно ключи шифрования (rskeymgmt)</span><span class="sxs-lookup"><span data-stu-id="ff042-135">How to re-create encryption keys (rskeymgmt)</span></span>  
  
1.  <span data-ttu-id="ff042-136">Отключите веб-службу сервера отчетов и доступ по протоколу HTTP.</span><span class="sxs-lookup"><span data-stu-id="ff042-136">Disable the Report Server Web service and HTTP access.</span></span> <span data-ttu-id="ff042-137">Используйте инструкции из предыдущей процедуры, чтобы остановить операции веб-службы.</span><span class="sxs-lookup"><span data-stu-id="ff042-137">Use the instructions in the previous procedure to stop Web service operations.</span></span>  
  
2.  <span data-ttu-id="ff042-138">На компьютере, на котором выполняется сервер отчетов, запустите программу **rskeymgmt.exe** .</span><span class="sxs-lookup"><span data-stu-id="ff042-138">Run **rskeymgmt.exe** locally on the computer that hosts the report server.</span></span> <span data-ttu-id="ff042-139">Используйте аргумент `-s`, чтобы сбросить симметричный ключ.</span><span class="sxs-lookup"><span data-stu-id="ff042-139">Use the `-s` argument to reset the symmetric key.</span></span> <span data-ttu-id="ff042-140">Никакие другие аргументы не требуются:</span><span class="sxs-lookup"><span data-stu-id="ff042-140">No other arguments are required:</span></span>  
  
    ```  
    rskeymgmt -s  
    ```  
  
3.  <span data-ttu-id="ff042-141">Перезапустите службу Windows и включите операции веб-службы.</span><span class="sxs-lookup"><span data-stu-id="ff042-141">Restart the Windows service and enable Web service operations.</span></span>  
  
## <a name="deleting-unusable-encrypted-content"></a><span data-ttu-id="ff042-142">Удаление непригодного для использования зашифрованного содержимого</span><span class="sxs-lookup"><span data-stu-id="ff042-142">Deleting Unusable Encrypted Content</span></span>  
 <span data-ttu-id="ff042-143">Если по каким-то причинам нельзя восстановить ключ шифрования, сервер отчетов никогда не будет в состоянии расшифровать и использовать любые данные, зашифрованные этим ключом.</span><span class="sxs-lookup"><span data-stu-id="ff042-143">If for some reason you cannot restore the encryption key, the report server will never be able to decrypt and use any data that is encrypted with that key.</span></span> <span data-ttu-id="ff042-144">Чтобы вернуть сервер отчетов к рабочему состоянию, необходимо удалить зашифрованные значения, которые в настоящее время сохранены в базе данных сервера отчетов, и затем вручную повторно определить необходимые значения.</span><span class="sxs-lookup"><span data-stu-id="ff042-144">To return the report server to a working state, you must delete the encrypted values that are currently stored in the report server database and then manually re-specify the values you need.</span></span>  
  
 <span data-ttu-id="ff042-145">Удаление ключей шифрования удаляет все сведения о симметричном ключе из базы данных сервера отчетов и удаляет любое зашифрованное содержимое.</span><span class="sxs-lookup"><span data-stu-id="ff042-145">Deleting the encryption keys removes all symmetric key information from the report server database and deletes any encrypted content.</span></span> <span data-ttu-id="ff042-146">Все незашифрованные данные остаются целыми, будет удалено только зашифрованное содержимое.</span><span class="sxs-lookup"><span data-stu-id="ff042-146">All unencrypted data is left intact; only encrypted content is removed.</span></span> <span data-ttu-id="ff042-147">При удалении ключей шифрования сервер отчетов автоматически повторно инициализирует себя, добавляя новый симметричный ключ.</span><span class="sxs-lookup"><span data-stu-id="ff042-147">When you delete the encryption keys, the report server re-initializes itself automatically by adding a new symmetric key.</span></span> <span data-ttu-id="ff042-148">При удалении зашифрованного содержимого происходит следующее:</span><span class="sxs-lookup"><span data-stu-id="ff042-148">The following occurs when you delete encrypted content:</span></span>  
  
-   <span data-ttu-id="ff042-149">Строки соединения в общих источниках данных будут удалены.</span><span class="sxs-lookup"><span data-stu-id="ff042-149">Connection strings in shared data sources are deleted.</span></span> <span data-ttu-id="ff042-150">Пользователи, выполняющие отчеты, получат сообщение об ошибке «Свойство ConnectionString не инициализировано».</span><span class="sxs-lookup"><span data-stu-id="ff042-150">Users who run reports get the error "The ConnectionString property has not been initialized."</span></span>  
  
-   <span data-ttu-id="ff042-151">Хранимые учетные данные будут удалены.</span><span class="sxs-lookup"><span data-stu-id="ff042-151">Stored credentials are deleted.</span></span> <span data-ttu-id="ff042-152">Отчеты и общие источники данных будут перенастроены на использование запрашиваемых учетных данных.</span><span class="sxs-lookup"><span data-stu-id="ff042-152">Reports and shared data sources are reconfigured to use prompted credentials.</span></span>  
  
-   <span data-ttu-id="ff042-153">Отчеты, основанные на моделях (которым необходимы общие источники данных, настроенные на работу с хранимыми учетными данными или без них), не будут выполняться.</span><span class="sxs-lookup"><span data-stu-id="ff042-153">Reports that are based on models (and require shared data sources configured with stored or no credentials) will not run.</span></span>  
  
-   <span data-ttu-id="ff042-154">Подписки будут деактивированы.</span><span class="sxs-lookup"><span data-stu-id="ff042-154">Subscriptions are deactivated.</span></span>  
  
 <span data-ttu-id="ff042-155">Если зашифрованное содержимое было удалено, его нельзя восстановить.</span><span class="sxs-lookup"><span data-stu-id="ff042-155">Once you delete encrypted content, you cannot recover it.</span></span> <span data-ttu-id="ff042-156">Необходимо повторно определить строки соединений и хранимые учетные данные и активизировать подписки.</span><span class="sxs-lookup"><span data-stu-id="ff042-156">You must re-specify connection strings and stored credentials, and you must activate subscriptions.</span></span>  
  
 <span data-ttu-id="ff042-157">Можно использовать средство настройки служб Reporting Services или программу **rskeymgmt** для удаления значений.</span><span class="sxs-lookup"><span data-stu-id="ff042-157">You can use the Reporting Services Configuration tool or the **rskeymgmt** utility to remove the values.</span></span>  
  
#### <a name="how-to-delete-encryption-keys-reporting-services-configuration-tool"></a><span data-ttu-id="ff042-158">Как удалить ключи шифрования (программа настройки служб Reporting Services)</span><span class="sxs-lookup"><span data-stu-id="ff042-158">How to delete encryption keys (Reporting Services Configuration Tool)</span></span>  
  
1.  <span data-ttu-id="ff042-159">Запустите программу настройки служб Reporting Services и подключитесь к экземпляру сервера отчетов, который нужно настроить.</span><span class="sxs-lookup"><span data-stu-id="ff042-159">Start the Reporting Services Configuration tool, and then connect to the report server instance you want to configure.</span></span>  
  
2.  <span data-ttu-id="ff042-160">Щелкните **Ключи шифрования**, затем щелкните **Удалить**.</span><span class="sxs-lookup"><span data-stu-id="ff042-160">Click **Encryption Keys**, and then click **Delete**.</span></span> [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
3.  <span data-ttu-id="ff042-161">Перезапустите службу Windows «Сервер отчетов».</span><span class="sxs-lookup"><span data-stu-id="ff042-161">Restart the Report Server Windows service.</span></span> <span data-ttu-id="ff042-162">Для масштабного развертывания это необходимо сделать на всех экземплярах сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="ff042-162">For a scale-out deployment, do this on all report server instances.</span></span>  
  
#### <a name="how-to-delete-encryption-keys-rskeymmgt"></a><span data-ttu-id="ff042-163">Как удалить ключи шифрования (rskeymmgt)</span><span class="sxs-lookup"><span data-stu-id="ff042-163">How to delete encryption keys (rskeymmgt)</span></span>  
  
1.  <span data-ttu-id="ff042-164">На компьютере, на котором выполняется сервер отчетов, запустите программу **rskeymgmt.exe** .</span><span class="sxs-lookup"><span data-stu-id="ff042-164">Run **rskeymgmt.exe** locally on the computer that hosts the report server.</span></span> <span data-ttu-id="ff042-165">Необходимо использовать аргумент **-d** .</span><span class="sxs-lookup"><span data-stu-id="ff042-165">You must use the **-d** apply argument.</span></span> <span data-ttu-id="ff042-166">В следующем примере приводится аргумент, который необходимо указать:</span><span class="sxs-lookup"><span data-stu-id="ff042-166">The following example illustrates the argument you must specify:</span></span>  
  
    ```  
    rskeymgmt -d  
    ```  
  
2.  <span data-ttu-id="ff042-167">Перезапустите службу Windows «Сервер отчетов».</span><span class="sxs-lookup"><span data-stu-id="ff042-167">Restart the Report Server Windows service.</span></span> <span data-ttu-id="ff042-168">Для масштабного развертывания это необходимо сделать на всех экземплярах сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="ff042-168">For a scale-out deployment, do this on all report server instances.</span></span>  
  
#### <a name="how-to-re-specify-encrypted-values"></a><span data-ttu-id="ff042-169">Как повторно определить зашифрованные значения</span><span class="sxs-lookup"><span data-stu-id="ff042-169">How to re-specify encrypted values</span></span>  
  
1.  <span data-ttu-id="ff042-170">Для каждого общего источника данных необходимо повторно ввести строку соединения.</span><span class="sxs-lookup"><span data-stu-id="ff042-170">For each shared data source, you must retype the connection string.</span></span>  
  
2.  <span data-ttu-id="ff042-171">Для каждого отчета и общего источника данных, который использует сохраненные учетные данные, необходимо заново ввести имя пользователя и пароль, затем сохранить.</span><span class="sxs-lookup"><span data-stu-id="ff042-171">For each report and shared data source that uses stored credentials, you must retype the user name and password, and then save.</span></span> <span data-ttu-id="ff042-172">Дополнительные сведения см. в статье [Задание учетных данных и сведениях о соединении для источников данных отчета](../../integration-services/connection-manager/data-sources.md) в электронной документации [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ff042-172">For more information, see [Specify Credential and Connection Information for Report Data Sources](../../integration-services/connection-manager/data-sources.md) in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Books Online.</span></span>  
  
3.  <span data-ttu-id="ff042-173">Откройте каждую управляемую данными подписку и заново введите учетные данные для базы данных подписки.</span><span class="sxs-lookup"><span data-stu-id="ff042-173">For each data-driven subscription, open each subscription and retype the credentials to the subscription database.</span></span>  
  
4.  <span data-ttu-id="ff042-174">Для подписок, которые используют зашифрованные данные (это включает модуль доставки в общую папку и любые сторонние расширения доставки, использующие шифрование), откройте каждую подписку и повторно введите учетные данные.</span><span class="sxs-lookup"><span data-stu-id="ff042-174">For subscriptions that use encrypted data (this includes the File Share delivery extension and any third-party delivery extension that uses encryption), open each subscription and retype credentials.</span></span> <span data-ttu-id="ff042-175">Подписки, которые используют доставку по электронной почте сервера отчетов, не используют зашифрованные данные и не затрагиваются изменением ключа.</span><span class="sxs-lookup"><span data-stu-id="ff042-175">Subscriptions that use Report Server e-mail delivery do not use encrypted data and are unaffected by the key change.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ff042-176">См. также:</span><span class="sxs-lookup"><span data-stu-id="ff042-176">See Also</span></span>  
 <span data-ttu-id="ff042-177">[Настройка ключей шифрования и управление ими &#40;служб SSRS Configuration Manager&#41;](ssrs-encryption-keys-manage-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="ff042-177">[Configure and Manage Encryption Keys &#40;SSRS Configuration Manager&#41;](ssrs-encryption-keys-manage-encryption-keys.md) </span></span>  
 [<span data-ttu-id="ff042-178">Хранение зашифрованных данных сервера отчетов &#40;диспетчер конфигурации служб SSRS&#41;</span><span class="sxs-lookup"><span data-stu-id="ff042-178">Store Encrypted Report Server Data &#40;SSRS Configuration Manager&#41;</span></span>](ssrs-encryption-keys-store-encrypted-report-server-data.md)  
  
  
