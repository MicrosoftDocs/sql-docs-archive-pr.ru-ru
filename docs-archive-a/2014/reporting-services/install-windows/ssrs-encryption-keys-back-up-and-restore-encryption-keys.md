---
title: Резервное копирование и восстановление ключей шифрования служб Reporting Services | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
helpviewer_keywords:
- backing up encryption keys [Reporting Services]
- restoring encryption keys [Reporting Services]
- encryption keys [Reporting Services]
- symmetric keys [Reporting Services]
ms.assetid: 6773d5df-03ef-4781-beb7-9f6825bac979
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: c8e7e61f58632898fc6150210598a671157639a3
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751840"
---
# <a name="back-up-and-restore-reporting-services-encryption-keys"></a><span data-ttu-id="34269-102">Резервное копирование и восстановление ключей шифрования служб Reporting Services</span><span class="sxs-lookup"><span data-stu-id="34269-102">Back Up and Restore Reporting Services Encryption Keys</span></span>
  <span data-ttu-id="34269-103">Одним из важных аспектов конфигурирования сервера отчетов является создание резервной копии симметричного ключа, используемого для шифрования конфиденциальных данных.</span><span class="sxs-lookup"><span data-stu-id="34269-103">An important part of report server configuration is creating a backup copy of the symmetric key used for encrypting sensitive information.</span></span> <span data-ttu-id="34269-104">Резервная копия ключа требуется для выполнения многих распространенных операций и позволяет повторно использовать базу данных существующего сервера отчетов в новом сервере.</span><span class="sxs-lookup"><span data-stu-id="34269-104">A backup copy of the key is required for many routine operations, and enables you to reuse an existing report server database in a new installation.</span></span>  
  
 <span data-ttu-id="34269-105">**[!INCLUDE[applies](../../includes/applies-md.md)]** [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] в собственном режиме | [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] в режиме интеграции с SharePoint</span><span class="sxs-lookup"><span data-stu-id="34269-105">**[!INCLUDE[applies](../../includes/applies-md.md)]**  [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] Native Mode | [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] SharePoint mode</span></span>  
  
 <span data-ttu-id="34269-106">Восстанавливать резервную копию ключа шифрования нужно в ответ на любое из следующих событий:</span><span class="sxs-lookup"><span data-stu-id="34269-106">It is necessary to restore the backup copy of the encryption key when any of the following events occur:</span></span>  
  
-   <span data-ttu-id="34269-107">Изменение имени учетной записи Windows-службы сервера отчетов или переназначение пароля.</span><span class="sxs-lookup"><span data-stu-id="34269-107">Changing the Report Server Windows service account name or resetting the password.</span></span> <span data-ttu-id="34269-108">Когда используется диспетчер конфигурации служб Reporting Services, создание резервной копии ключа входит в операцию изменения имени учетной записи службы.</span><span class="sxs-lookup"><span data-stu-id="34269-108">When you use the Reporting Services Configuration Manager, backing up the key is part of a service account name change operation.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="34269-109">Переназначение пароля и изменение пароля — не одно и то же.</span><span class="sxs-lookup"><span data-stu-id="34269-109">Resetting the password is not the same as changing the password.</span></span> <span data-ttu-id="34269-110">Для переназначения пароля необходимо разрешение на перезапись учетных данных в контроллере домена.</span><span class="sxs-lookup"><span data-stu-id="34269-110">A password reset requires permission to overwrite account information on the domain controller.</span></span> <span data-ttu-id="34269-111">Переназначение пароля выполняется системным администратором в том случае, если пользователь забывает или не знает конкретный пароль.</span><span class="sxs-lookup"><span data-stu-id="34269-111">Password resets are performed by a system administrator when you forget or do not know a particular password.</span></span> <span data-ttu-id="34269-112">Восстановление симметричного ключа требуется только при переназначении паролей.</span><span class="sxs-lookup"><span data-stu-id="34269-112">Only password resets require symmetric key restoration.</span></span> <span data-ttu-id="34269-113">При периодическом изменении пароля учетной записи переназначать симметричный ключ не нужно.</span><span class="sxs-lookup"><span data-stu-id="34269-113">Periodically changing an account password does not require you to reset the symmetric key.</span></span>  
  
-   <span data-ttu-id="34269-114">Переименование компьютера или экземпляра, на котором размещен сервер отчетов (экземпляр сервера отчетов связан с именем экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ).</span><span class="sxs-lookup"><span data-stu-id="34269-114">Renaming the computer or instance that hosts the report server (a report server instance is based on a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance name).</span></span>  
  
-   <span data-ttu-id="34269-115">Выполнение миграции сервера отчетов или настройка сервера отчетов на использование другой базы данных сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="34269-115">Migrating a report server installation or configuring a report server to use a different report server database.</span></span>  
  
-   <span data-ttu-id="34269-116">Восстановление сервера отчетов по журналу после аппаратного сбоя.</span><span class="sxs-lookup"><span data-stu-id="34269-116">Recovering a report server installation due to hardware failure.</span></span>  
  
 <span data-ttu-id="34269-117">Необходимо создать только одну резервную копию симметричного ключа.</span><span class="sxs-lookup"><span data-stu-id="34269-117">You only need to back up one copy of the symmetric key.</span></span> <span data-ttu-id="34269-118">Между базой данных сервера отчетов и симметричным ключом имеется однозначное соответствие.</span><span class="sxs-lookup"><span data-stu-id="34269-118">There is a one-to-one correspondence between a report server database and a symmetric key.</span></span> <span data-ttu-id="34269-119">Несмотря на то, что необходимо создать только одну резервную копию ключа, восстанавливать ключ, возможно, придется несколько раз, если выполняется несколько серверов отчетов, использующих модель масштабного развертывания.</span><span class="sxs-lookup"><span data-stu-id="34269-119">Although you only need to back up one copy, you might need to restore the key multiple times if you are running multiple report servers in a scale-out deployment model.</span></span> <span data-ttu-id="34269-120">Каждому экземпляру сервера отчетов потребуется своя копия симметричного ключа для блокирования и разблокирования данных в базе данных сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="34269-120">Each report server instance will need its copy of the symmetric key to lock and unlock data in the report server database.</span></span>  
  
  
## <a name="backing-up-the-encryption-keys"></a><span data-ttu-id="34269-121">Создание резервных копий ключей шифрования</span><span class="sxs-lookup"><span data-stu-id="34269-121">Backing Up the Encryption Keys</span></span>  
 <span data-ttu-id="34269-122">Созданием резервной копии симметричного ключа называют процесс, в ходе которого ключ записывается в указанный файл, после чего шифруется с использованием заданного пароля.</span><span class="sxs-lookup"><span data-stu-id="34269-122">Backing up the symmetric key is a process that writes the key to a file that you specify, and then scrambles the key using a password that you provide.</span></span> <span data-ttu-id="34269-123">Симметричный ключ не может быть сохранен в незашифрованном состоянии, поэтому при его сохранении на диске необходимо указать пароль для шифрования ключа.</span><span class="sxs-lookup"><span data-stu-id="34269-123">The symmetric key can never be stored in an unencrypted state so you must provide a password to encrypt the key when you save it to disk.</span></span> <span data-ttu-id="34269-124">После создания файла необходимо сохранить его в безопасном месте **и запомнить пароль** , служащий для разблокирования файла.</span><span class="sxs-lookup"><span data-stu-id="34269-124">After the file is created, you must store it in a secure location **and remember the password** that is used to unlock the file.</span></span> <span data-ttu-id="34269-125">Для создания резервной копии симметричного ключа можно использовать следующие средства:</span><span class="sxs-lookup"><span data-stu-id="34269-125">To backup the symmetric key, you can use the following tools:</span></span>  
  
 <span data-ttu-id="34269-126">**Основной режим.** Диспетчер конфигурации служб Reporting Services или программа **rskeymgmt** .</span><span class="sxs-lookup"><span data-stu-id="34269-126">**Native mode:** Either the Reporting Services Configuration Manager or the **rskeymgmt** utility.</span></span>  
  
 <span data-ttu-id="34269-127">**Режим SharePoint.** Страницы центра администрирования SharePoint или PowerShell.</span><span class="sxs-lookup"><span data-stu-id="34269-127">**SharePoint mode:** SharePoint Central Administration pages or PowerShell.</span></span>  
  
####  <a name="backup-sharepoint-mode-report-servers"></a><a name="bkmk_backup_sharepoint"></a> <span data-ttu-id="34269-128">Резервное копирование серверов отчетов в режиме интеграции с SharePoint</span><span class="sxs-lookup"><span data-stu-id="34269-128">Backup SharePoint Mode Report Servers</span></span>  
 <span data-ttu-id="34269-129">Для серверов отчетов, работающих в режиме интеграции с SharePoint, можно использовать команды PowerShell или страницы управления для приложений служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="34269-129">For SharePoint mode report servers you can either use PowerShell commands or use the management pages for the [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] service application.</span></span> <span data-ttu-id="34269-130">Дополнительные сведения см. в разделе "Управление ключами" статьи [Управление служебным приложением SharePoint службы Reporting Services](../manage-a-reporting-services-sharepoint-service-application.md).</span><span class="sxs-lookup"><span data-stu-id="34269-130">For more information, see the "Key Management" section of [Manage a Reporting Services SharePoint Service Application](../manage-a-reporting-services-sharepoint-service-application.md)</span></span>  
  
####  <a name="back-up-encryption-keys--reporting-services-configuration-manager-native-mode"></a><a name="bkmk_backup_configuration_manager"></a> <span data-ttu-id="34269-131">Резервное копирование ключей шифрования — диспетчер служб Reporting Services (собственный режим)</span><span class="sxs-lookup"><span data-stu-id="34269-131">Back up encryption keys -Reporting Services Configuration Manager (Native Mode)</span></span>  
  
1.  <span data-ttu-id="34269-132">Запустите диспетчер конфигурации служб Reporting Services и подключитесь к экземпляру сервера отчетов, который нужно настроить.</span><span class="sxs-lookup"><span data-stu-id="34269-132">Start the Reporting Services Configuration Manager, and then connect to the report server instance you want to configure.</span></span>  
  
2.  <span data-ttu-id="34269-133">Щелкните **Ключи шифрования**, а затем — **Создать резервную копию**.</span><span class="sxs-lookup"><span data-stu-id="34269-133">Click **Encryption Keys**, and then click **Back Up**.</span></span>  
  
3.  <span data-ttu-id="34269-134">Введите надежный пароль.</span><span class="sxs-lookup"><span data-stu-id="34269-134">Type a strong password.</span></span>  
  
4.  <span data-ttu-id="34269-135">Укажите файл, предназначенный для сохранения ключа.</span><span class="sxs-lookup"><span data-stu-id="34269-135">Specify a file to contain the stored key.</span></span> [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] <span data-ttu-id="34269-136">к имени файла будет добавлено расширение SNK.</span><span class="sxs-lookup"><span data-stu-id="34269-136">appends a .snk file extension to the file.</span></span> <span data-ttu-id="34269-137">Возможно, лучше будет записать файл на диск, чтобы не хранить его на компьютере, где запускается сервер отчетов.</span><span class="sxs-lookup"><span data-stu-id="34269-137">Consider storing the file on a disk separate from the report server.</span></span>  
  
5.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
####  <a name="back-up-encryption-keys--rskeymgmt-native-mode"></a><a name="bkmk_backup_rskeymgmt"></a><span data-ttu-id="34269-138">Резервное копирование ключей шифрования — rskeymgmt (собственный режим)</span><span class="sxs-lookup"><span data-stu-id="34269-138">Back up encryption keys -rskeymgmt (Native Mode)</span></span>  
  
1.  <span data-ttu-id="34269-139">На компьютере, на котором выполняется сервер отчетов, запустите программу **rskeymgmt.exe** .</span><span class="sxs-lookup"><span data-stu-id="34269-139">Run **rskeymgmt.exe** locally on the computer that hosts the report server.</span></span> <span data-ttu-id="34269-140">Укажите для копирования ключа аргумент `-e`, задайте имя файла и пароль.</span><span class="sxs-lookup"><span data-stu-id="34269-140">You must use the `-e` extract argument to copy the key, provide a file name, and specify a password.</span></span> <span data-ttu-id="34269-141">Аргументы, которые необходимо задать, приведены в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="34269-141">The following example illustrates the arguments you must specify:</span></span>  
  
    ```cmd
    rskeymgmt -e -f d:\rsdbkey.snk -p<password>  
    ```  
  
## <a name="restore-encryption-keys"></a><span data-ttu-id="34269-142">Восстановление ключей шифрования</span><span class="sxs-lookup"><span data-stu-id="34269-142">Restore Encryption Keys</span></span>  
 <span data-ttu-id="34269-143">При восстановлении симметричного ключа выполняется перезапись существующего симметричного ключа, хранящегося в базе данных сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="34269-143">Restoring the symmetric key overwrites the existing symmetric key that is stored in the report server database.</span></span> <span data-ttu-id="34269-144">В результате восстановления ключа шифрования неиспользуемый ключ заменяется копией, которая ранее была сохранена на диске.</span><span class="sxs-lookup"><span data-stu-id="34269-144">Restoring an encryption key replaces an unusable key with a copy that you previously saved to disk.</span></span> <span data-ttu-id="34269-145">Восстановление ключа шифрования складывается из следующих операций:</span><span class="sxs-lookup"><span data-stu-id="34269-145">Restoring encryption keys results in the following actions:</span></span>  
  
-   <span data-ttu-id="34269-146">Из защищенного паролем файла резервной копии ключа извлекается симметричный ключ.</span><span class="sxs-lookup"><span data-stu-id="34269-146">The symmetric key is opened from the password protected backup file.</span></span>  
  
-   <span data-ttu-id="34269-147">Симметричный ключ шифруется с использованием открытого ключа Windows-службы сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="34269-147">The symmetric key is encrypted using the public key of the Report Server Windows service.</span></span>  
  
-   <span data-ttu-id="34269-148">Зашифрованный симметричный ключ сохраняется в базе данных сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="34269-148">The encrypted symmetric key is stored in the report server database.</span></span>  
  
-   <span data-ttu-id="34269-149">Данные симметричного ключа, которые хранились в базе данных до этого (например, данные ключа, которые была записаны в базу данных сервера отчетов при развертывании предыдущего экземпляра), удаляются.</span><span class="sxs-lookup"><span data-stu-id="34269-149">The previously stored symmetric key data (for example, key information that was already in the report server database from a previous deployment) is deleted.</span></span>  
  
 <span data-ttu-id="34269-150">Для восстановления ключа шифрования необходим файл с копией ключа.</span><span class="sxs-lookup"><span data-stu-id="34269-150">To restore the encryption key, you must have a copy of the encryption key on file.</span></span> <span data-ttu-id="34269-151">Кроме того, необходимо знать пароль, позволяющий разблокировать хранимую копию ключа.</span><span class="sxs-lookup"><span data-stu-id="34269-151">You must also know the password that unlocks the stored copy.</span></span> <span data-ttu-id="34269-152">Если эти условия выполнены, для восстановления ключа можно запустить средство настройки служб Reporting Services или программу **rskeymgmt** .</span><span class="sxs-lookup"><span data-stu-id="34269-152">If you have the key and the password, you can run the Reporting Services Configuration tool or **rskeymgmt** utility to restore the key.</span></span> <span data-ttu-id="34269-153">Симметричный ключ должен быть тем же, что служит и для блокирования и разблокирования зашифрованного содержимого, хранящегося в базе данных сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="34269-153">The symmetric key must be the same one that locks and unlocks encrypted data currently stored in the report server database.</span></span> <span data-ttu-id="34269-154">При попытке восстановления некорректной копии ключа сервер отчетов не сможет получить доступ к зашифрованным данным, хранящимся в базе данных сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="34269-154">If you restore a copy that is not valid, the report server cannot access the encrypted data currently stored in the report server database.</span></span> <span data-ttu-id="34269-155">В этом случае, возможно, придется удалить все зашифрованные значения, если не получится восстановить корректный ключ.</span><span class="sxs-lookup"><span data-stu-id="34269-155">If this occurs, you might need to delete all encrypted values if you cannot restore a valid key.</span></span> <span data-ttu-id="34269-156">Если в силу той или иной причины восстановить ключ шифрования не удается (например, нет резервной копии ключа), существующий ключ и зашифрованные данные необходимо удалить.</span><span class="sxs-lookup"><span data-stu-id="34269-156">If for some reason you cannot restore the encryption key (for example, if you do not have a backup copy), you must delete the existing key and encrypted content.</span></span> <span data-ttu-id="34269-157">Дополнительные сведения см. в разделе [Удаление и повторное создание ключей шифрования (диспетчер конфигураций служб SSRS)](ssrs-encryption-keys-delete-and-re-create-encryption-keys.md).</span><span class="sxs-lookup"><span data-stu-id="34269-157">For more information, see [Delete and Re-create Encryption Keys  &#40;SSRS Configuration Manager&#41;](ssrs-encryption-keys-delete-and-re-create-encryption-keys.md).</span></span> <span data-ttu-id="34269-158">Дополнительные сведения о создании симметричного ключа см. в разделе [Инициализация сервера отчетов (диспетчер конфигураций служб SSRS)](ssrs-encryption-keys-initialize-a-report-server.md).</span><span class="sxs-lookup"><span data-stu-id="34269-158">For more information about creating symmetric keys, see [Initialize a Report Server &#40;SSRS Configuration Manager&#41;](ssrs-encryption-keys-initialize-a-report-server.md).</span></span>  
  
####  <a name="restore-encryption-keys--reporting-services-configuration-manager-native-mode"></a><a name="bkmk_restore_configuration_manager"></a><span data-ttu-id="34269-159">Восстановление ключей шифрования — диспетчер конфигурации служб Reporting Services (собственный режим)</span><span class="sxs-lookup"><span data-stu-id="34269-159">Restore encryption keys -Reporting Services Configuration Manager (Native Mode)</span></span>  
  
1.  <span data-ttu-id="34269-160">Запустите диспетчер конфигурации служб Reporting Services и подключитесь к экземпляру сервера отчетов, который нужно настроить.</span><span class="sxs-lookup"><span data-stu-id="34269-160">Start the Reporting Services Configuration Manager, and then connect to the report server instance you want to configure.</span></span>  
  
2.  <span data-ttu-id="34269-161">На странице ключи шифрования нажмите кнопку **восстановить**.</span><span class="sxs-lookup"><span data-stu-id="34269-161">On the Encryption Keys page, click **Restore**.</span></span>  
  
3.  <span data-ttu-id="34269-162">Выберите SNK-файл, содержащий резервную копию ключа.</span><span class="sxs-lookup"><span data-stu-id="34269-162">Select the .snk file that contains the back up copy.</span></span>  
  
4.  <span data-ttu-id="34269-163">Введите пароль, позволяющий разблокировать файл.</span><span class="sxs-lookup"><span data-stu-id="34269-163">Type the password that unlocks the file.</span></span>  
  
5.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
####  <a name="restore-encryption-keys---rskeymgmt-native-mode"></a><a name="bkmk_restore_rskeymgmt"></a><span data-ttu-id="34269-164">Восстановление ключей шифрования — rskeymgmt (собственный режим)</span><span class="sxs-lookup"><span data-stu-id="34269-164">Restore encryption keys - rskeymgmt (Native Mode)</span></span>  
  
1.  <span data-ttu-id="34269-165">На компьютере, на котором выполняется сервер отчетов, запустите программу **rskeymgmt.exe** .</span><span class="sxs-lookup"><span data-stu-id="34269-165">Run **rskeymgmt.exe** locally on the computer that hosts the report server.</span></span> <span data-ttu-id="34269-166">Укажите для восстановления ключа аргумент `-a`.</span><span class="sxs-lookup"><span data-stu-id="34269-166">Use the `-a` argument to restore the keys.</span></span> <span data-ttu-id="34269-167">Необходимо указать полностью определенное имя файла и пароль.</span><span class="sxs-lookup"><span data-stu-id="34269-167">You must provide a fully-qualified file name and specify a password.</span></span> <span data-ttu-id="34269-168">Аргументы, которые необходимо задать, приведены в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="34269-168">The following example illustrates the arguments you must specify:</span></span>  
  
    ```cmd
    rskeymgmt -a -f d:\rsdbkey.snk -p<password>  
    ```  
  
## <a name="see-also"></a><span data-ttu-id="34269-169">См. также:</span><span class="sxs-lookup"><span data-stu-id="34269-169">See Also</span></span>  
 [<span data-ttu-id="34269-170">Настройка ключей шифрования и управление ими (диспетчер конфигурации служб SSRS)</span><span class="sxs-lookup"><span data-stu-id="34269-170">Configure and Manage Encryption Keys &#40;SSRS Configuration Manager&#41;</span></span>](ssrs-encryption-keys-manage-encryption-keys.md)  
