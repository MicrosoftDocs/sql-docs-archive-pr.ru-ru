---
title: Резервное копирование и восстановление ключей шифрования служб Reporting Services | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
helpviewer_keywords:
- backing up encryption keys [Reporting Services]
- restoring encryption keys [Reporting Services]
- encryption keys [Reporting Services]
- symmetric keys [Reporting Services]
ms.assetid: 6773d5df-03ef-4781-beb7-9f6825bac979
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: c8e7e61f58632898fc6150210598a671157639a3
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751840"
---
# <a name="back-up-and-restore-reporting-services-encryption-keys"></a>Резервное копирование и восстановление ключей шифрования служб Reporting Services
  Одним из важных аспектов конфигурирования сервера отчетов является создание резервной копии симметричного ключа, используемого для шифрования конфиденциальных данных. Резервная копия ключа требуется для выполнения многих распространенных операций и позволяет повторно использовать базу данных существующего сервера отчетов в новом сервере.  
  
 **[!INCLUDE[applies](../../includes/applies-md.md)]** [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] в собственном режиме | [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] в режиме интеграции с SharePoint  
  
 Восстанавливать резервную копию ключа шифрования нужно в ответ на любое из следующих событий:  
  
-   Изменение имени учетной записи Windows-службы сервера отчетов или переназначение пароля. Когда используется диспетчер конфигурации служб Reporting Services, создание резервной копии ключа входит в операцию изменения имени учетной записи службы.  
  
    > [!NOTE]  
    >  Переназначение пароля и изменение пароля — не одно и то же. Для переназначения пароля необходимо разрешение на перезапись учетных данных в контроллере домена. Переназначение пароля выполняется системным администратором в том случае, если пользователь забывает или не знает конкретный пароль. Восстановление симметричного ключа требуется только при переназначении паролей. При периодическом изменении пароля учетной записи переназначать симметричный ключ не нужно.  
  
-   Переименование компьютера или экземпляра, на котором размещен сервер отчетов (экземпляр сервера отчетов связан с именем экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ).  
  
-   Выполнение миграции сервера отчетов или настройка сервера отчетов на использование другой базы данных сервера отчетов.  
  
-   Восстановление сервера отчетов по журналу после аппаратного сбоя.  
  
 Необходимо создать только одну резервную копию симметричного ключа. Между базой данных сервера отчетов и симметричным ключом имеется однозначное соответствие. Несмотря на то, что необходимо создать только одну резервную копию ключа, восстанавливать ключ, возможно, придется несколько раз, если выполняется несколько серверов отчетов, использующих модель масштабного развертывания. Каждому экземпляру сервера отчетов потребуется своя копия симметричного ключа для блокирования и разблокирования данных в базе данных сервера отчетов.  
  
  
## <a name="backing-up-the-encryption-keys"></a>Создание резервных копий ключей шифрования  
 Созданием резервной копии симметричного ключа называют процесс, в ходе которого ключ записывается в указанный файл, после чего шифруется с использованием заданного пароля. Симметричный ключ не может быть сохранен в незашифрованном состоянии, поэтому при его сохранении на диске необходимо указать пароль для шифрования ключа. После создания файла необходимо сохранить его в безопасном месте **и запомнить пароль** , служащий для разблокирования файла. Для создания резервной копии симметричного ключа можно использовать следующие средства:  
  
 **Основной режим.** Диспетчер конфигурации служб Reporting Services или программа **rskeymgmt** .  
  
 **Режим SharePoint.** Страницы центра администрирования SharePoint или PowerShell.  
  
####  <a name="backup-sharepoint-mode-report-servers"></a><a name="bkmk_backup_sharepoint"></a> Резервное копирование серверов отчетов в режиме интеграции с SharePoint  
 Для серверов отчетов, работающих в режиме интеграции с SharePoint, можно использовать команды PowerShell или страницы управления для приложений служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] . Дополнительные сведения см. в разделе "Управление ключами" статьи [Управление служебным приложением SharePoint службы Reporting Services](../manage-a-reporting-services-sharepoint-service-application.md).  
  
####  <a name="back-up-encryption-keys--reporting-services-configuration-manager-native-mode"></a><a name="bkmk_backup_configuration_manager"></a> Резервное копирование ключей шифрования — диспетчер служб Reporting Services (собственный режим)  
  
1.  Запустите диспетчер конфигурации служб Reporting Services и подключитесь к экземпляру сервера отчетов, который нужно настроить.  
  
2.  Щелкните **Ключи шифрования**, а затем — **Создать резервную копию**.  
  
3.  Введите надежный пароль.  
  
4.  Укажите файл, предназначенный для сохранения ключа. [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] к имени файла будет добавлено расширение SNK. Возможно, лучше будет записать файл на диск, чтобы не хранить его на компьютере, где запускается сервер отчетов.  
  
5.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
####  <a name="back-up-encryption-keys--rskeymgmt-native-mode"></a><a name="bkmk_backup_rskeymgmt"></a>Резервное копирование ключей шифрования — rskeymgmt (собственный режим)  
  
1.  На компьютере, на котором выполняется сервер отчетов, запустите программу **rskeymgmt.exe** . Укажите для копирования ключа аргумент `-e`, задайте имя файла и пароль. Аргументы, которые необходимо задать, приведены в следующем примере.  
  
    ```cmd
    rskeymgmt -e -f d:\rsdbkey.snk -p<password>  
    ```  
  
## <a name="restore-encryption-keys"></a>Восстановление ключей шифрования  
 При восстановлении симметричного ключа выполняется перезапись существующего симметричного ключа, хранящегося в базе данных сервера отчетов. В результате восстановления ключа шифрования неиспользуемый ключ заменяется копией, которая ранее была сохранена на диске. Восстановление ключа шифрования складывается из следующих операций:  
  
-   Из защищенного паролем файла резервной копии ключа извлекается симметричный ключ.  
  
-   Симметричный ключ шифруется с использованием открытого ключа Windows-службы сервера отчетов.  
  
-   Зашифрованный симметричный ключ сохраняется в базе данных сервера отчетов.  
  
-   Данные симметричного ключа, которые хранились в базе данных до этого (например, данные ключа, которые была записаны в базу данных сервера отчетов при развертывании предыдущего экземпляра), удаляются.  
  
 Для восстановления ключа шифрования необходим файл с копией ключа. Кроме того, необходимо знать пароль, позволяющий разблокировать хранимую копию ключа. Если эти условия выполнены, для восстановления ключа можно запустить средство настройки служб Reporting Services или программу **rskeymgmt** . Симметричный ключ должен быть тем же, что служит и для блокирования и разблокирования зашифрованного содержимого, хранящегося в базе данных сервера отчетов. При попытке восстановления некорректной копии ключа сервер отчетов не сможет получить доступ к зашифрованным данным, хранящимся в базе данных сервера отчетов. В этом случае, возможно, придется удалить все зашифрованные значения, если не получится восстановить корректный ключ. Если в силу той или иной причины восстановить ключ шифрования не удается (например, нет резервной копии ключа), существующий ключ и зашифрованные данные необходимо удалить. Дополнительные сведения см. в разделе [Удаление и повторное создание ключей шифрования (диспетчер конфигураций служб SSRS)](ssrs-encryption-keys-delete-and-re-create-encryption-keys.md). Дополнительные сведения о создании симметричного ключа см. в разделе [Инициализация сервера отчетов (диспетчер конфигураций служб SSRS)](ssrs-encryption-keys-initialize-a-report-server.md).  
  
####  <a name="restore-encryption-keys--reporting-services-configuration-manager-native-mode"></a><a name="bkmk_restore_configuration_manager"></a>Восстановление ключей шифрования — диспетчер конфигурации служб Reporting Services (собственный режим)  
  
1.  Запустите диспетчер конфигурации служб Reporting Services и подключитесь к экземпляру сервера отчетов, который нужно настроить.  
  
2.  На странице ключи шифрования нажмите кнопку **восстановить**.  
  
3.  Выберите SNK-файл, содержащий резервную копию ключа.  
  
4.  Введите пароль, позволяющий разблокировать файл.  
  
5.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
####  <a name="restore-encryption-keys---rskeymgmt-native-mode"></a><a name="bkmk_restore_rskeymgmt"></a>Восстановление ключей шифрования — rskeymgmt (собственный режим)  
  
1.  На компьютере, на котором выполняется сервер отчетов, запустите программу **rskeymgmt.exe** . Укажите для восстановления ключа аргумент `-a`. Необходимо указать полностью определенное имя файла и пароль. Аргументы, которые необходимо задать, приведены в следующем примере.  
  
    ```cmd
    rskeymgmt -a -f d:\rsdbkey.snk -p<password>  
    ```  
  
## <a name="see-also"></a>См. также:  
 [Настройка ключей шифрования и управление ими (диспетчер конфигурации служб SSRS)](ssrs-encryption-keys-manage-encryption-keys.md)  
