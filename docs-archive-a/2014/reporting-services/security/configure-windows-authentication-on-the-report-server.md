---
title: Настройка проверки подлинности Windows на сервере отчетов | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: reporting-services-native
ms.topic: conceptual
helpviewer_keywords:
- Windows authentication [Reporting Services]
- Reporting Services, configuration
ms.assetid: 4de9c3dd-0ee7-49b3-88bb-209465ca9d86
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: 879c036977f9a34528dbf38e42fa080e72617a14
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87731410"
---
# <a name="configure-windows-authentication-on-the-report-server"></a><span data-ttu-id="ac9be-102">Настройка проверки подлинности Windows на сервере отчетов</span><span class="sxs-lookup"><span data-stu-id="ac9be-102">Configure Windows Authentication on the Report Server</span></span>
  <span data-ttu-id="ac9be-103">По умолчанию службы [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] принимают запросы, в которых определена проверка подлинности Negotiate или NTLM.</span><span class="sxs-lookup"><span data-stu-id="ac9be-103">By default, [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] accepts requests that specify Negotiate or NTLM authentication.</span></span> <span data-ttu-id="ac9be-104">Если в развертывание входят клиентские приложения и браузеры, в которых используются поставщики безопасности, то можно использовать значения по умолчанию без дополнительной настройки.</span><span class="sxs-lookup"><span data-stu-id="ac9be-104">If your deployment includes client applications and browsers that use these security providers, you can use the default values without additional configuration.</span></span> <span data-ttu-id="ac9be-105">Если нужно использовать другого поставщика безопасности для встроенной безопасности Windows (например, требуется применять протокол Kerberos напрямую) или если значения по умолчанию были изменены, и нужно восстановить первоначальные настройки, то можно использовать сведения данного раздела, чтобы указать настройки проверки подлинности на сервере отчетов.</span><span class="sxs-lookup"><span data-stu-id="ac9be-105">If you want to use a different security provider for Windows integrated security (for example, if you want to use Kerberos directly), or if you modified the default values and want to restore the original settings, you can use the information in this topic to specify authentication settings on the report server.</span></span>  
  
 <span data-ttu-id="ac9be-106">Чтобы использовать встроенную безопасность Windows, каждый пользователь, обращающийся к серверу отчетов, должен иметь правильную локальную или доменную учетную запись Windows или входить в локальную или доменную группу Windows.</span><span class="sxs-lookup"><span data-stu-id="ac9be-106">To use Windows integrated security, each user who requires access to a report server must have a valid Windows local or domain user account or be a member of a Windows local or domain group account.</span></span> <span data-ttu-id="ac9be-107">В группу можно включать учетные записи, относящиеся к другим доменам, если эти домены являются доверенными.</span><span class="sxs-lookup"><span data-stu-id="ac9be-107">You can include accounts from other domains as long as those domains are trusted.</span></span> <span data-ttu-id="ac9be-108">Учетные записи должны иметь доступ к компьютеру, на котором размещен сервер отчетов. Впоследствии учетным записям нужно назначить роли, чтобы обеспечить им доступ к специфическим операциям сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="ac9be-108">The accounts must have access to the report server computer, and must be subsequently assigned to roles in order to gain access to specific report server operations.</span></span>  
  
 <span data-ttu-id="ac9be-109">Должны выполняться также следующие дополнительные условия.</span><span class="sxs-lookup"><span data-stu-id="ac9be-109">The following additional requirements must also be met:</span></span>  
  
-   <span data-ttu-id="ac9be-110">Свойству атрибута `AuthenticationType` файлов SeportServer.config должно быть задано значение `RSWindowsNegotiate`, `RSWindowsKerberos` или `RSWindowsNTLM`.</span><span class="sxs-lookup"><span data-stu-id="ac9be-110">The RSeportServer.config files must have `AuthenticationType` set to `RSWindowsNegotiate`, `RSWindowsKerberos`, or `RSWindowsNTLM`.</span></span> <span data-ttu-id="ac9be-111">По умолчанию файл конфигурации RSReportServer.config включает настройку `RSWindowsNegotiate`, если учетной записью службы сервера отчетов является учетная запись NetworkService или LocalSystem. В противном случае используется настройка `RSWindowsNTLM`.</span><span class="sxs-lookup"><span data-stu-id="ac9be-111">By default, the RSReportServer.config file includes the `RSWindowsNegotiate` setting if the Report Server service account is either NetworkService or LocalSystem; otherwise, the `RSWindowsNTLM` setting is used.</span></span> <span data-ttu-id="ac9be-112">Можно добавить `RSWindowsKerberos`, если имеются приложения, в которых используется только проверка подлинности протокола Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ac9be-112">You can add `RSWindowsKerberos` if you have applications that only use Kerberos authentication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="ac9be-113">Использование `RSWindowsNegotiate` приведет к ошибке проверки подлинности протокола Kerberos, если служба сервера отчетов настроена на запуск с доменной учетной записью пользователя и для учетной записи не зарегистрировано имя участника-службы (SPN).</span><span class="sxs-lookup"><span data-stu-id="ac9be-113">Using `RSWindowsNegotiate` will result in a Kerberos authentication error if you configured the Report Server service to run under a domain user account and you did not register a Service Principal Name (SPN) for the account.</span></span> <span data-ttu-id="ac9be-114">Дополнительные сведения см. в разделе [Разрешение ошибок проверок подлинности протокола Kerberos при соединении с сервером отчетов](#proxyfirewallRSWindowsNegotiate) в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="ac9be-114">For more information, see [Resolving Kerberos Authentication Errors When Connecting to a report server](#proxyfirewallRSWindowsNegotiate) in this topic.</span></span>  
  
-   [!INCLUDE[vstecasp](../../includes/vstecasp-md.md)] <span data-ttu-id="ac9be-115">должна быть настроена для проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="ac9be-115">must be configured for Windows Authentication.</span></span> <span data-ttu-id="ac9be-116">По умолчанию файлы Web.config для веб-службы сервера отчетов и диспетчер отчетов включают \<authentication mode="Windows"> параметр.</span><span class="sxs-lookup"><span data-stu-id="ac9be-116">By default, the Web.config files for the Report Server Web service and Report Manager include the \<authentication mode="Windows"> setting.</span></span> <span data-ttu-id="ac9be-117">Если изменить его на \<authentication mode="Forms"> , проверка подлинности Windows для [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] завершится ошибкой.</span><span class="sxs-lookup"><span data-stu-id="ac9be-117">If you change it to \<authentication mode="Forms">, the Windows Authentication for [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] will fail.</span></span>  
  
-   <span data-ttu-id="ac9be-118">Файлы Web.config для веб-службы сервера отчетов и диспетчер отчетов должны иметь \<identity impersonate= "true" /> .</span><span class="sxs-lookup"><span data-stu-id="ac9be-118">The Web.config files for the Report Server Web service and Report Manager must have \<identity impersonate= "true" />.</span></span>  
  
-   <span data-ttu-id="ac9be-119">Клиентское приложение или браузер должны поддерживать встроенную безопасность Windows.</span><span class="sxs-lookup"><span data-stu-id="ac9be-119">The client application or browser must support Windows integrated security.</span></span>  
  
 <span data-ttu-id="ac9be-120">Чтобы изменить настройки проверки подлинности сервера отчетов, измените XML-элементы и значения в файле RSReportServer.config.</span><span class="sxs-lookup"><span data-stu-id="ac9be-120">To change the report server authentication settings, edit the XML elements and values in the RSReportServer.config file.</span></span> <span data-ttu-id="ac9be-121">Чтобы реализовать определенные сочетания, можно копировать и вставить примеры из этого раздела.</span><span class="sxs-lookup"><span data-stu-id="ac9be-121">You can copy and paste the examples in this topic to implement specific combinations.</span></span>  
  
 <span data-ttu-id="ac9be-122">Настройки по умолчанию работают лучше всего, если клиентский и серверный компьютер находятся в одном и том же домене или в доверенном домене, а сервер отчетов разворачивается для доступа из внутренней сети, защищенной корпоративным брандмауэром.</span><span class="sxs-lookup"><span data-stu-id="ac9be-122">The default settings work best if all client and server computers are in the same domain or in a trusted domain and the report server is deployed for intranet access behind a corporate firewall.</span></span> <span data-ttu-id="ac9be-123">Для передачи учетных данных Windows необходимо использовать доверенные и одиночные домены.</span><span class="sxs-lookup"><span data-stu-id="ac9be-123">Trusted and single domains are a requirement for passing Windows credentials.</span></span> <span data-ttu-id="ac9be-124">Учетные данные можно передавать несколько раз в том случае, если для серверов включен протокол Kerberos версии 5.</span><span class="sxs-lookup"><span data-stu-id="ac9be-124">Credentials can be passed more than one time if you enable the Kerberos version 5 protocol for your servers.</span></span> <span data-ttu-id="ac9be-125">В противном случае учетные данные можно передать только один раз до истечения срока их действия.</span><span class="sxs-lookup"><span data-stu-id="ac9be-125">Otherwise, credentials can be passed only one time before they expire.</span></span> <span data-ttu-id="ac9be-126">Дополнительные сведения о настройке учетных данных для нескольких подключений к компьютерам см. в разделе [Задание учетных данных и сведений о соединении для источников данных отчета](../report-data/specify-credential-and-connection-information-for-report-data-sources.md).</span><span class="sxs-lookup"><span data-stu-id="ac9be-126">For more information about configuring credentials for multiple computer connections, see [Specify Credential and Connection Information for Report Data Sources](../report-data/specify-credential-and-connection-information-for-report-data-sources.md).</span></span>  
  
 <span data-ttu-id="ac9be-127">Следующие параметры настраиваются для сервера отчетов, работающего в собственном режиме.</span><span class="sxs-lookup"><span data-stu-id="ac9be-127">The following instructions are intended for a native mode report server.</span></span> <span data-ttu-id="ac9be-128">Если развертывание сервера отчетов производилось в режиме интеграции с SharePoint, то необходимо пользоваться настройками проверки подлинности по умолчанию, в которых задана встроенная безопасность Windows.</span><span class="sxs-lookup"><span data-stu-id="ac9be-128">If the report server is deployed in SharePoint integrated mode, you must use the default authentication settings that specify Windows integrated security.</span></span> <span data-ttu-id="ac9be-129">Сервер отчетов использует внутренние функции модуля проверки подлинности Windows по умолчанию для поддержки серверов отчетов в режиме интеграции с SharePoint.</span><span class="sxs-lookup"><span data-stu-id="ac9be-129">The report server uses internal features in the default Windows Authentication extension to support report servers in SharePoint integrated mode.</span></span>  
  
## <a name="extended-protection-for-authentication"></a><span data-ttu-id="ac9be-130">Расширенная защита для проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="ac9be-130">Extended Protection for Authentication</span></span>  
 <span data-ttu-id="ac9be-131">Начиная с [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)], доступна поддержка расширенной защиты для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="ac9be-131">Beginning with [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)], support for Extended Protection for Authentication is available.</span></span> <span data-ttu-id="ac9be-132">Функция [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] использует привязку каналов и служб для повышения уровня защиты проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="ac9be-132">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] feature supports the use of channel binding and service binding to enhance protection of authentication.</span></span> <span data-ttu-id="ac9be-133">Функции [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] можно использовать в ОС, поддерживающей расширенную защиту.</span><span class="sxs-lookup"><span data-stu-id="ac9be-133">The [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] features need to be used with an operating system that supports Extended Protection.</span></span> [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] <span data-ttu-id="ac9be-134">определяется параметрами в файле RSReportServer.config.</span><span class="sxs-lookup"><span data-stu-id="ac9be-134">configuration for extended protection is determined by settings in the RSReportServer.config file.</span></span> <span data-ttu-id="ac9be-135">Это можно сделать как в текстовом редакторе, так и при помощи средств WMI API.</span><span class="sxs-lookup"><span data-stu-id="ac9be-135">The file can be updated by either editing the file or using WMI APIs.</span></span> <span data-ttu-id="ac9be-136">Дополнительные сведения см. в статье [Extended Protection for Authentication with Reporting Services](extended-protection-for-authentication-with-reporting-services.md).</span><span class="sxs-lookup"><span data-stu-id="ac9be-136">For more information, see [Extended Protection for Authentication with Reporting Services](extended-protection-for-authentication-with-reporting-services.md).</span></span>  
  
### <a name="to-configure-a-report-server-to-use-windows-integrated-security"></a><span data-ttu-id="ac9be-137">Настройка сервера отчетов на использование встроенной безопасности Windows</span><span class="sxs-lookup"><span data-stu-id="ac9be-137">To configure a report server to use Windows integrated security</span></span>  
  
1.  <span data-ttu-id="ac9be-138">Откройте файл конфигурации RSReportServer.config в текстовом редакторе.</span><span class="sxs-lookup"><span data-stu-id="ac9be-138">Open RSReportServer.config in a text editor.</span></span>  
  
2.  <span data-ttu-id="ac9be-139">Найдите `Authentication`> <.</span><span class="sxs-lookup"><span data-stu-id="ac9be-139">Find <`Authentication`>.</span></span>  
  
3.  <span data-ttu-id="ac9be-140">Выберите и скопируйте наиболее подходящую из следующих XML-структур.</span><span class="sxs-lookup"><span data-stu-id="ac9be-140">Copy one of the following XML structures that best fits your needs.</span></span> <span data-ttu-id="ac9be-141">`RSWindowsNegotiate`, `RSWindowsNTLM` и `RSWindowsKerberos` можно указывать в любом порядке.</span><span class="sxs-lookup"><span data-stu-id="ac9be-141">You can specify `RSWindowsNegotiate`, `RSWindowsNTLM`, and `RSWindowsKerberos` in any order.</span></span> <span data-ttu-id="ac9be-142">Включите сохраняемость проверки подлинности, если нужно проверить подлинность соединений, а не каждого отдельного запроса.</span><span class="sxs-lookup"><span data-stu-id="ac9be-142">You should enable authentication persistence if you want to authenticate the connection rather than each individual request.</span></span> <span data-ttu-id="ac9be-143">При сохраняемости проверки подлинности все запросы, для которых требуется проверка подлинности, разрешены в продолжение существования соединения.</span><span class="sxs-lookup"><span data-stu-id="ac9be-143">Under authentication persistence, all requests that require authentication will be allowed for the duration of the connection.</span></span>  
  
     <span data-ttu-id="ac9be-144">Первая XML-структура является настройкой по умолчанию, если учетной записью службы сервера отчетов является учетная запись NetworkService или LocalSystem:</span><span class="sxs-lookup"><span data-stu-id="ac9be-144">The first XML structure is the default configuration when the Report Server service account is either NetworkService or LocalSystem:</span></span>  
  
    ```  
    <Authentication>  
          <AuthenticationTypes>  
                 <RSWindowsNegotiate />  
          </AuthenticationTypes>  
          <EnableAuthPersistence>true</EnableAuthPersistence>  
    </Authentication>  
    ```  
  
     <span data-ttu-id="ac9be-145">Вторая XML-структура является настройкой по умолчанию, если учетной записью службы сервера отчетов не является учетная запись NetworkService или LocalSystem:</span><span class="sxs-lookup"><span data-stu-id="ac9be-145">The second XML structure is the default configuration when the Report Server service account is not NetworkService or LocalSystem:</span></span>  
  
    ```  
    <Authentication>  
          <AuthenticationTypes>  
                 <RSWindowsNTLM />  
          </AuthenticationTypes>  
          <EnableAuthPersistence>true</EnableAuthPersistence>  
    ```  
  
     \</Authentication>  
  
     <span data-ttu-id="ac9be-146">Третья XML-структура указывает все пакеты безопасности, используемые во встроенной безопасности Windows:</span><span class="sxs-lookup"><span data-stu-id="ac9be-146">The third XML structure specifies all of the security packages that are used in Windows integrated security:</span></span>  
  
    ```  
          <AuthenticationTypes>  
                 <RSWindowsNegotiate />  
                 <RSWindowsKerberos />  
                 <RSWindowsNTLM />  
          </AuthenticationTypes>  
    ```  
  
     <span data-ttu-id="ac9be-147">Четвертая XML-структура задает NTLM только для развертываний, которые не поддерживают протокол Kerberos или обходят ошибки проверки подлинности протокола Kerberos:</span><span class="sxs-lookup"><span data-stu-id="ac9be-147">The fourth XML structure specifies NTLM only for deployments that do not support Kerberos or to work around Kerberos authentication errors:</span></span>  
  
    ```  
          <AuthenticationTypes>  
                 <RSWindowsNTLM />  
          </AuthenticationTypes>  
    ```  
  
4.  <span data-ttu-id="ac9be-148">Вставьте его поверх существующих записей для <`Authentication`>.</span><span class="sxs-lookup"><span data-stu-id="ac9be-148">Paste it over the existing entries for <`Authentication`>.</span></span>  
  
     <span data-ttu-id="ac9be-149">Также невозможно использование синтаксиса `Custom` с типами `RSWindows`.</span><span class="sxs-lookup"><span data-stu-id="ac9be-149">Note that you cannot use `Custom` with the `RSWindows` types.</span></span>  
  
5.  <span data-ttu-id="ac9be-150">При необходимости измените параметры расширенной защиты.</span><span class="sxs-lookup"><span data-stu-id="ac9be-150">Modify as appropriate the settings for extended protection.</span></span> <span data-ttu-id="ac9be-151">По умолчанию расширенная защита отключена.</span><span class="sxs-lookup"><span data-stu-id="ac9be-151">Extended protection is disabled by default.</span></span>  <span data-ttu-id="ac9be-152">Если эти записи отсутствуют, возможно, на компьютере не установлена версия служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] с поддержкой расширенной защиты.</span><span class="sxs-lookup"><span data-stu-id="ac9be-152">If these entries are not present, the current computer may not be running a version of [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] which supports extended protection.</span></span> <span data-ttu-id="ac9be-153">Дополнительные сведения см. в разделе [Extended Protection for Authentication with Reporting Services](extended-protection-for-authentication-with-reporting-services.md).</span><span class="sxs-lookup"><span data-stu-id="ac9be-153">For more information, see [Extended Protection for Authentication with Reporting Services](extended-protection-for-authentication-with-reporting-services.md)</span></span>  
  
    ```  
          <RSWindowsExtendedProtectionLevel>Allow</RSWindowsExtendedProtectionLevel>  
          <RSWindowsExtendedProtectionScenario>Proxy</RSWindowsExtendedProtectionScenario>  
    ```  
  
6.  <span data-ttu-id="ac9be-154">Сохраните файл.</span><span class="sxs-lookup"><span data-stu-id="ac9be-154">Save the file.</span></span>  
  
7.  <span data-ttu-id="ac9be-155">Если настроено масштабное развертывание, повторите вышеперечисленные шаги для остальных серверов отчетов, входящих в конфигурацию развертывания.</span><span class="sxs-lookup"><span data-stu-id="ac9be-155">If you configured a scale-out deployment, repeat these steps for other report servers in the deployment.</span></span>  
  
8.  <span data-ttu-id="ac9be-156">Перезапустите сервер отчетов, чтобы очистить все открытые сеансы.</span><span class="sxs-lookup"><span data-stu-id="ac9be-156">Restart the report server to clear any sessions that are currently open.</span></span>  
  
##  <a name="resolving-kerberos-authentication-errors-when-connecting-to-a-report-server"></a><a name="proxyfirewallRSWindowsNegotiate"></a><span data-ttu-id="ac9be-157">Устранение ошибок проверки подлинности Kerberos при соединении с сервером отчетов</span><span class="sxs-lookup"><span data-stu-id="ac9be-157">Resolving Kerberos Authentication Errors When Connecting to a Report Server</span></span>  
 <span data-ttu-id="ac9be-158">На сервере отчетов, настроенном для проверки подлинности протоколов Negotiate или Kerberos, клиентское соединение с сервером отчетов завершится неудачей в случае ошибки проверки подлинности Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ac9be-158">On a report server that is configured for Negotiate or Kerberos authentication, a client connection to the report server will fail if there is a Kerberos authentication error.</span></span> <span data-ttu-id="ac9be-159">Известно, что ошибки проверки подлинности протокола Kerberos происходят вследствие следующих причин.</span><span class="sxs-lookup"><span data-stu-id="ac9be-159">Kerberos authentication errors are known to occur when:</span></span>  
  
-   <span data-ttu-id="ac9be-160">Служба сервера отчетов выполняется с доменной учетной записью пользователя Windows, и для учетной записи не зарегистрировано имя участника-службы (SPN).</span><span class="sxs-lookup"><span data-stu-id="ac9be-160">The Report Server service runs as a Windows domain user account and you did not register a Service Principal Name (SPN) for the account.</span></span>  
  
-   <span data-ttu-id="ac9be-161">Сервер отчетов настроен на режим `RSWindowsNegotiate`.</span><span class="sxs-lookup"><span data-stu-id="ac9be-161">The report server is configured with the `RSWindowsNegotiate` setting.</span></span>  
  
-   <span data-ttu-id="ac9be-162">Браузер выбирает протокол Kerberos вместо NTLM в заголовке проверки подлинности в запросе, посылаемом серверу отчетов.</span><span class="sxs-lookup"><span data-stu-id="ac9be-162">The browser chooses Kerberos over NTLM in the authentication header in the request it sends to the report server.</span></span>  
  
 <span data-ttu-id="ac9be-163">Можно заметить ошибку, если включить ведение журнала протокола Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ac9be-163">You can detect the error if you enabled Kerberos logging.</span></span> <span data-ttu-id="ac9be-164">Другой признак ошибки — многократное получение запроса для ввода учетных данных с последующим появлением пустого окна браузера.</span><span class="sxs-lookup"><span data-stu-id="ac9be-164">Another symptom of the error is that you are prompted for credentials multiple times and then see an empty browser window.</span></span>  
  
 <span data-ttu-id="ac9be-165">Вы можете убедиться, что возникает ошибка проверки подлинности Kerberos, удалив < `RSWindowsNegotiate` или > из файла конфигурации и повторно попытайтесь подключиться.</span><span class="sxs-lookup"><span data-stu-id="ac9be-165">You can confirm that you are encountering a Kerberos authentication error by removing < `RSWindowsNegotiate` /> from your configuration file and reattempting the connection.</span></span>  
  
 <span data-ttu-id="ac9be-166">Если неполадка подтверждается, ее можно устранить следующими способами:</span><span class="sxs-lookup"><span data-stu-id="ac9be-166">After you confirm the problem, you can address it in the following ways:</span></span>  
  
-   <span data-ttu-id="ac9be-167">Зарегистрируйте имя участника-службы для службы сервера отчетов, которая запускается от учетной записи пользователя домена.</span><span class="sxs-lookup"><span data-stu-id="ac9be-167">Register an SPN for the Report Server service under the domain user account.</span></span> <span data-ttu-id="ac9be-168">Дополнительные сведения см. в статье [Регистрация имени субъекта-службы (SPN) для сервера отчетов](../report-server/register-a-service-principal-name-spn-for-a-report-server.md).</span><span class="sxs-lookup"><span data-stu-id="ac9be-168">For more information, see [Register a Service Principal Name &#40;SPN&#41; for a Report Server](../report-server/register-a-service-principal-name-spn-for-a-report-server.md).</span></span>  
  
-   <span data-ttu-id="ac9be-169">Измените учетную запись службы для запуска под встроенной учетной записью, такой как сетевая служба.</span><span class="sxs-lookup"><span data-stu-id="ac9be-169">Change the service account to run under a built-in account such as Network Service.</span></span> <span data-ttu-id="ac9be-170">Встроенные учетные записи сопоставляют имя участника-службы HTTP с именем участника-службы Host, которое определяется при соединении компьютера с сетью.</span><span class="sxs-lookup"><span data-stu-id="ac9be-170">Built-in accounts map HTTP SPN to the Host SPN, which is defined when you join a computer to your network.</span></span> <span data-ttu-id="ac9be-171">Дополнительные сведения см. в разделе [Настройка учетной записи службы (диспетчер конфигураций служб SSRS)](../../sql-server/install/configure-a-service-account-ssrs-configuration-manager.md).</span><span class="sxs-lookup"><span data-stu-id="ac9be-171">For more information, see [Configure a Service Account &#40;SSRS Configuration Manager&#41;](../../sql-server/install/configure-a-service-account-ssrs-configuration-manager.md).</span></span>  
  
-   <span data-ttu-id="ac9be-172">Используйте NTLM.</span><span class="sxs-lookup"><span data-stu-id="ac9be-172">Use NTLM.</span></span> <span data-ttu-id="ac9be-173">Как правило, NTLM функционирует в случаях, когда проверка подлинности протокола Kerberos заканчивается неуспешно.</span><span class="sxs-lookup"><span data-stu-id="ac9be-173">NTLM will generally work in cases where Kerberos authentication fails.</span></span> <span data-ttu-id="ac9be-174">Чтобы задействовать NTLM, удалите `RSWindowsNegotiate` из файла RSReportServer.config и проверьте, что указан только `RSWindowsNTLM`.</span><span class="sxs-lookup"><span data-stu-id="ac9be-174">To use NTLM, remove `RSWindowsNegotiate` from the RSReportServer.config file and verify that only `RSWindowsNTLM` is specified.</span></span> <span data-ttu-id="ac9be-175">Если выбран этот подход, то можно продолжить использовать учетную запись пользователя домена для службы сервера отчетов, даже если для него не определено имя участника-службы (SPN).</span><span class="sxs-lookup"><span data-stu-id="ac9be-175">If you choose this approach, you can continue to use a domain user account for the Report Server service even if you do not define an SPN for it.</span></span>  
  
#### <a name="logging-information"></a><span data-ttu-id="ac9be-176">Сведения о ведении журнала</span><span class="sxs-lookup"><span data-stu-id="ac9be-176">Logging information</span></span>  
 <span data-ttu-id="ac9be-177">Имеется несколько источников информации, включаемой в журнал, которые могут помочь в решении проблем, связанных с протоколом Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ac9be-177">There are several sources of logging information that can help resolve Kerberos related issues.</span></span>  
  
##### <a name="user-account-control-attribute"></a><span data-ttu-id="ac9be-178">Атрибут управления учетными записями</span><span class="sxs-lookup"><span data-stu-id="ac9be-178">User-Account-Control Attribute</span></span>  
 <span data-ttu-id="ac9be-179">Определите, задан ли необходимый атрибут учетной записи служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] в Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ac9be-179">Determine if the [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] service account has the sufficient attribute set in Active Directory.</span></span> <span data-ttu-id="ac9be-180">Просмотрите файл журнала трассировки служб Reporting Services и найдите значение записи для атрибута управления учетными записями.</span><span class="sxs-lookup"><span data-stu-id="ac9be-180">Review the reporting services service trace log file to find the value logged for the UserAccountControl attribute.</span></span> <span data-ttu-id="ac9be-181">Значение записи приведено в десятичном формате.</span><span class="sxs-lookup"><span data-stu-id="ac9be-181">The value logged is in decimal form.</span></span> <span data-ttu-id="ac9be-182">Необходимо преобразовать десятичное значение в шестнадцатеричный формат и найти его в разделе MSDN, где описан атрибут управления учетными записями.</span><span class="sxs-lookup"><span data-stu-id="ac9be-182">You need to convert the decimal value to hexadecimal form and then find that value in the MSDN topic describing User-Account-Control Attribute.</span></span>  
  
-   <span data-ttu-id="ac9be-183">Журнал трассировки служб Reporting Services будет выглядеть примерно следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ac9be-183">The reporting services service trace log entry will look similar to the following:</span></span>  
  
    ```  
    appdomainmanager!DefaultDomain!8f8!01/14/2010-14:42:28:: i INFO: The UserAccountControl value for the service account is 590336  
    ```  
  
-   <span data-ttu-id="ac9be-184">Например, десятичное значение можно преобразовать в шестнадцатеричный формат с помощью калькулятора [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows.</span><span class="sxs-lookup"><span data-stu-id="ac9be-184">One option for converting the value Decimal value to hexadecimal form is to us the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows Calculator.</span></span> <span data-ttu-id="ac9be-185">Калькулятор поддерживает несколько режимов, где имеются переключатели «Dec» и «Hex».</span><span class="sxs-lookup"><span data-stu-id="ac9be-185">Windows Calculator supports several modes that show the 'Dec' option and 'Hex' options.</span></span> <span data-ttu-id="ac9be-186">Установите переключатель в положение «Dec», вставьте или введите десятичное значение из файла журнала и переведите переключатель в положение «Hex».</span><span class="sxs-lookup"><span data-stu-id="ac9be-186">Select the 'Dec' option, paste or type in the decimal value you found in the log file and then select the 'Hex' option.</span></span>  
  
-   <span data-ttu-id="ac9be-187">Откройте раздел [Атрибут управления учетными записями](https://go.microsoft.com/fwlink/?LinkId=183366) , чтобы получить атрибут для учетной записи службы.</span><span class="sxs-lookup"><span data-stu-id="ac9be-187">Then refer to the topic [User-Account-Control Attribute](https://go.microsoft.com/fwlink/?LinkId=183366) to derive the attribute for the service account.</span></span>  
  
##### <a name="spns-configured-in-active-directory-for-the-reporting-services-service-account"></a><span data-ttu-id="ac9be-188">Имена участников-служб, настроенные в Active Directory для учетной записи служб Reporting Services</span><span class="sxs-lookup"><span data-stu-id="ac9be-188">SPNs Configured in Active Directory for the Reporting Services service account.</span></span>  
 <span data-ttu-id="ac9be-189">Чтобы включить имя участника зеркального отображения в файл журнала трассировки служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] , можно временно включить функцию расширенной защиты [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ac9be-189">To log the SPNs in the [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] service trace log file, you can enable the [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] Extended Protection feature temporarily.</span></span>  
  
-   <span data-ttu-id="ac9be-190">Внесите изменения в файл конфигурации `rsreportserver.config`, задав следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="ac9be-190">Modify the configuration file `rsreportserver.config` by setting the following:</span></span>  
  
    ```  
    <RSWindowsExtendedProtectionLevel>Allow</RSWindowsExtendedProtectionLevel>   
    <RSWindowsExtendedProtectionScenario>Any</RSWindowsExtendedProtectionScenario>  
    ```  
  
-   <span data-ttu-id="ac9be-191">Перезапустите службу [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ac9be-191">Restart the [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] service.</span></span>

 <span data-ttu-id="ac9be-192">Если дальнейшей необходимости в использовании расширенной защиты нет, восстановите параметры по умолчанию и перезапустите учетную запись службы [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ac9be-192">If you do not want continue using Extended Protection, then set the configuration values back to defaults and restart the [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] Service account.</span></span>  
  
```  
<RSWindowsExtendedProtectionLevel>Off</RSWindowsExtendedProtectionLevel>  
<RSWindowsExtendedProtectionScenario>Proxy</RSWindowsExtendedProtectionScenario>  
```  
  
 <span data-ttu-id="ac9be-193">Дополнительные сведения см. в разделе [Расширенная защита для проверки подлинности with Reporting Services](extended-protection-for-authentication-with-reporting-services.md)</span><span class="sxs-lookup"><span data-stu-id="ac9be-193">For more information see, [Extended Protection for Authentication with Reporting Services](extended-protection-for-authentication-with-reporting-services.md)</span></span>  
  
#### <a name="how-the-browser-chooses-negotiated-kerberos-or-negotiated-ntlm"></a><span data-ttu-id="ac9be-194">Как браузер выбирает Negotiated Kerberos или Negotiated NTLM</span><span class="sxs-lookup"><span data-stu-id="ac9be-194">How the Browser Chooses Negotiated Kerberos or Negotiated NTLM</span></span>  
 <span data-ttu-id="ac9be-195">При использовании браузера Internet Explorer для подключения к серверу отчетов, он указывает Negotiated Kerberos или NTLM в заголовке проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="ac9be-195">When you use Internet Explorer to connect to the report server, it specifies either Negotiated Kerberos or NTLM on the authentication header.</span></span> <span data-ttu-id="ac9be-196">NTLM используется вместо протокола Kerberos, когда:</span><span class="sxs-lookup"><span data-stu-id="ac9be-196">NTLM is used instead of Kerberos when:</span></span>  
  
-   <span data-ttu-id="ac9be-197">Запрос передан в локальный сервер отчетов.</span><span class="sxs-lookup"><span data-stu-id="ac9be-197">The request is sent to a local report server.</span></span>  
  
-   <span data-ttu-id="ac9be-198">Запрос передан по IP-адресу компьютера сервера отчетов вместо заголовка узла или имени сервера.</span><span class="sxs-lookup"><span data-stu-id="ac9be-198">The request is sent to an IP address of the report server computer rather than a host header or server name.</span></span>  
  
-   <span data-ttu-id="ac9be-199">Программа брандмауэра блокирует порты, используемые для проверки подлинности протокола Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ac9be-199">Firewall software blocks ports used for Kerberos authentication.</span></span>  
  
-   <span data-ttu-id="ac9be-200">Протокол Kerberos не включен в операционной системе конкретного сервера.</span><span class="sxs-lookup"><span data-stu-id="ac9be-200">The operating system of a particular server does not have Kerberos enabled.</span></span>  
  
-   <span data-ttu-id="ac9be-201">Домен содержит старые версии клиентских и серверных операционных систем Windows, которые не поддерживают проверку подлинности протокола Kerberos, встроенную в новые версии операционной системы.</span><span class="sxs-lookup"><span data-stu-id="ac9be-201">The domain includes older versions of Windows client and server operating systems that do not support the Kerberos authentication feature built into newer versions of the operating system.</span></span>  
  
 <span data-ttu-id="ac9be-202">Кроме того, Internet Explorer может выбрать Negotiated Kerberos или NTLM в зависимости от настроек URL-адреса, ЛВС и прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="ac9be-202">In addition, Internet Explorer might choose either Negotiated Kerberos or NTLM depending on how you configured URL, LAN, and proxy settings.</span></span>  
  
###### <a name="report-server-url"></a><span data-ttu-id="ac9be-203">URL-адрес сервера отчетов</span><span class="sxs-lookup"><span data-stu-id="ac9be-203">Report Server URL</span></span>  
 <span data-ttu-id="ac9be-204">Если URL-адрес содержит полное доменное имя, то Internet Explorer выбирает NTLM.</span><span class="sxs-lookup"><span data-stu-id="ac9be-204">If the URL includes a fully qualified domain name, Internet Explorer selects NTLM.</span></span> <span data-ttu-id="ac9be-205">Если URL-адрес указывает localhost, то Internet Explorer выбирает NTLM.</span><span class="sxs-lookup"><span data-stu-id="ac9be-205">If the URL specifies localhost, Internet Explorer selects NTLM.</span></span> <span data-ttu-id="ac9be-206">Если URL-адрес указывает сетевое имя компьютера, то Internet Explorer выбирает Negotiate, и успех или неудача зависит от существования имени участника-службы (SPN) для учетной записи службы сервера отчетов.</span><span class="sxs-lookup"><span data-stu-id="ac9be-206">If the URL specifies the network name of the computer, Internet Explorer selects Negotiate, which will succeed or fail depending on whether an SPN exists for the Report Server service account.</span></span>  
  
###### <a name="lan-and-proxy-settings-on-the-client"></a><span data-ttu-id="ac9be-207">Настройки локальной сети и прокси-сервера на клиенте</span><span class="sxs-lookup"><span data-stu-id="ac9be-207">LAN and Proxy Settings on the Client</span></span>  
 <span data-ttu-id="ac9be-208">Настройки локальной сети и прокси-сервера, установленные в браузере Internet Explorer, могут определить выбор NTLM вместо протокола Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ac9be-208">LAN and proxy settings that you set in Internet Explorer can determine whether NTLM is chosen over Kerberos.</span></span> <span data-ttu-id="ac9be-209">Но поскольку настройки локальной сети и прокси-сервера различны в пределах организации, невозможно точно определить настройки, которые привели к ошибкам проверки подлинности протокола Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ac9be-209">However, because LAN and proxy settings vary across organizations, it is not possible to precisely determine the exact settings that contribute to Kerberos authentication errors.</span></span> <span data-ttu-id="ac9be-210">Например, в организации могут принудительно применяться настройки прокси-сервера, которые преобразуют URL-адреса из URL-адресов интрасети в URL-адреса полного доменного имени, разрешаемые через интернет-соединения.</span><span class="sxs-lookup"><span data-stu-id="ac9be-210">For example, your organization might enforce proxy settings that transform URLs from intranet URLs to fully-qualified domain name URLs that resolve over Internet connections.</span></span> <span data-ttu-id="ac9be-211">Если для различных типов URL-адресов используются разные поставщики проверки подлинности, то некоторые соединения могут оказаться успешными вопреки ожиданиям.</span><span class="sxs-lookup"><span data-stu-id="ac9be-211">If different authentication providers are used for different types of URLs, you might find that some connections succeed when you would have expected them to fail.</span></span>  
  
 <span data-ttu-id="ac9be-212">Если возникают ошибки соединения, которые можно объяснить сбоями проверки подлинности, можно применить различные сочетания настройки локальной сети и прокси-сервера, чтобы обнаружить проблему.</span><span class="sxs-lookup"><span data-stu-id="ac9be-212">If you encounter connection errors that you think are due to authentication failures, you can try different combinations of LAN and proxy settings to isolate the problem.</span></span> <span data-ttu-id="ac9be-213">В Internet Explorer настройки локальной сети и прокси-сервера находятся в диалоговом окне **Настройки локальной сети** , которое можно открыть, нажав кнопку **Настройки LAN** на вкладке **Подключения** окна **Свойства: Интернет**.</span><span class="sxs-lookup"><span data-stu-id="ac9be-213">In Internet Explorer, LAN and proxy settings are on the **Local Area Network (LAN) Settings** dialog box, which you open by clicking **LAN settings** on the **Connection** tab of **Internet Options**.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="ac9be-214">Внешние ресурсы</span><span class="sxs-lookup"><span data-stu-id="ac9be-214">External resources</span></span>  
  
-   <span data-ttu-id="ac9be-215">Дополнительные сведения о Kerberos и серверах отчетов см. на странице [Развертывание решений бизнес-аналитики с помощью SharePoint, служб Reporting Services и сервера мониторинга PerformancePoint с Kerberos.](https://go.microsoft.com/fwlink/?LinkID=177751)</span><span class="sxs-lookup"><span data-stu-id="ac9be-215">For additional information regarding Kerberos and report servers, see [Deploying a Business Intelligence Solution Using SharePoint, Reporting Services, and PerformancePoint Monitoring Server with Kerberos.](https://go.microsoft.com/fwlink/?LinkID=177751)</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ac9be-216">См. также:</span><span class="sxs-lookup"><span data-stu-id="ac9be-216">See Also</span></span>  
 <span data-ttu-id="ac9be-217">[Проверка подлинности с использованием сервера отчетов](authentication-with-the-report-server.md) </span><span class="sxs-lookup"><span data-stu-id="ac9be-217">[Authentication with the Report Server](authentication-with-the-report-server.md) </span></span>  
 <span data-ttu-id="ac9be-218">[Предоставление разрешений на сервер отчетов в собственном режиме](granting-permissions-on-a-native-mode-report-server.md) </span><span class="sxs-lookup"><span data-stu-id="ac9be-218">[Granting Permissions on a Native Mode Report Server](granting-permissions-on-a-native-mode-report-server.md) </span></span>  
 <span data-ttu-id="ac9be-219">[Файл конфигурации RSReportServer](../report-server/rsreportserver-config-configuration-file.md) </span><span class="sxs-lookup"><span data-stu-id="ac9be-219">[RSReportServer Configuration File](../report-server/rsreportserver-config-configuration-file.md) </span></span>  
 <span data-ttu-id="ac9be-220">[Настройка обычной проверки подлинности на сервере отчетов](configure-basic-authentication-on-the-report-server.md) </span><span class="sxs-lookup"><span data-stu-id="ac9be-220">[Configure Basic Authentication on the Report Server](configure-basic-authentication-on-the-report-server.md) </span></span>  
 <span data-ttu-id="ac9be-221">[Настройка проверки подлинности на сервере отчетов или пользовательских форм](configure-custom-or-forms-authentication-on-the-report-server.md) </span><span class="sxs-lookup"><span data-stu-id="ac9be-221">[Configure Custom or Forms Authentication on the Report Server](configure-custom-or-forms-authentication-on-the-report-server.md) </span></span>  
 [<span data-ttu-id="ac9be-222">Расширенная защита для проверки подлинности служб Reporting Services</span><span class="sxs-lookup"><span data-stu-id="ac9be-222">Extended Protection for Authentication with Reporting Services</span></span>](extended-protection-for-authentication-with-reporting-services.md)  
  
  
