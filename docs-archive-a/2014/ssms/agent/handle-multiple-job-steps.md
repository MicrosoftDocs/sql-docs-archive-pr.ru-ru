---
title: Обработка множественных шагов задания | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ssms
ms.topic: conceptual
helpviewer_keywords:
- job steps [SQL Server Agent]
- ordering job steps [SQL Server]
- multiple job steps
- SQL Server Agent jobs, job steps
- control of flow for jobs [SQL Server]
ms.assetid: 7aba19ff-72b3-45f6-8e54-23f4988d63a8
author: stevestein
ms.author: sstein
ms.openlocfilehash: fef0fb69b5bfd028977276d8efabc333a21e0feb
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87654717"
---
# <a name="handle-multiple-job-steps"></a><span data-ttu-id="03017-102">Обработка множественных шагов задания</span><span class="sxs-lookup"><span data-stu-id="03017-102">Handle Multiple Job Steps</span></span>
  <span data-ttu-id="03017-103">Если в задании содержится более одного шага, необходимо указать порядок выполнения шагов задания.</span><span class="sxs-lookup"><span data-stu-id="03017-103">If your job has more than one job step, you must specify the order in which the job steps run.</span></span> <span data-ttu-id="03017-104">Это называется \*управлением потоком \* *.*</span><span class="sxs-lookup"><span data-stu-id="03017-104">This is called *control of flow\*\*.*</span></span> <span data-ttu-id="03017-105">Добавить новые шаги задания и реорганизовать поток шагов задания можно в любое время; изменения вступают в силу при следующем выполнении задания.</span><span class="sxs-lookup"><span data-stu-id="03017-105">You can add new job steps and rearrange the flow of job steps at any time; the changes take effect the next time the job is run.</span></span> <span data-ttu-id="03017-106">На этой иллюстрации показано управление потоком для задания резервного копирования базы данных.</span><span class="sxs-lookup"><span data-stu-id="03017-106">This illustration shows the control of flow for a database backup job.</span></span>  
  
 <span data-ttu-id="03017-107">![Управление потоком шагов заданий агента SQL Server](../../database-engine/media/dbflow01.gif "Управление потоком шагов заданий агента SQL Server")</span><span class="sxs-lookup"><span data-stu-id="03017-107">![SQL Server Agent job steps control of flow](../../database-engine/media/dbflow01.gif "SQL Server Agent job steps control of flow")</span></span>  
  
 <span data-ttu-id="03017-108">Первый шаг — это создание резервной копии базы данных.</span><span class="sxs-lookup"><span data-stu-id="03017-108">The first step is Backup Database.</span></span> <span data-ttu-id="03017-109">Если этот шаг завершается ошибкой, агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] сообщает о сбое оператору, назначенному для получения уведомления.</span><span class="sxs-lookup"><span data-stu-id="03017-109">If this step fails, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent reports failure to the operator who is defined to receive notification.</span></span> <span data-ttu-id="03017-110">Если шаг создания резервной копии базы данных завершается успешно, выполнение задания переходит к следующему шагу — «очистке» данных заказчика.</span><span class="sxs-lookup"><span data-stu-id="03017-110">If the Backup Database step succeeds, the job proceeds to the next step, "Scrub" Customer Data.</span></span> <span data-ttu-id="03017-111">Если этот шаг завершается ошибкой, агент [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] пропускает его и переходит сразу к шагу восстановления базы данных.</span><span class="sxs-lookup"><span data-stu-id="03017-111">If this step fails, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agent skips forward to Restore Database.</span></span> <span data-ttu-id="03017-112">Если «очистка» данных заказчика завершается успешно, выполнение задания переходит к следующему шагу — обновлению статистики, и так далее, до тех пор, пока в результате выполнения последнего шага не будет выдан отчет об успешном или неудачном завершении.</span><span class="sxs-lookup"><span data-stu-id="03017-112">If "Scrub" Customer Data succeeds, the job proceeds to the next step, Update Statistics, and so on, until the final step either results in Report Success or Report Failure.</span></span>  
  
 <span data-ttu-id="03017-113">Пользователь определяет действие управления потоком на случай успешного или неудачного завершения каждого из шагов задания.</span><span class="sxs-lookup"><span data-stu-id="03017-113">You define a control-of-flow action for the success and failure of each job step.</span></span> <span data-ttu-id="03017-114">Необходимо указать действие, которое предпринимается, когда шаг задания завершается успешно, и действие, предпринимаемое в случае неудачного завершения шага.</span><span class="sxs-lookup"><span data-stu-id="03017-114">You must specify an action to be taken when a job step succeeds and an action to be taken when a job step fails.</span></span> <span data-ttu-id="03017-115">Можно также задать число повторных попыток для неудачно завершенных шагов задания и интервал между повторными попытками.</span><span class="sxs-lookup"><span data-stu-id="03017-115">You can also define the number of retry attempts for failed job steps and the interval between the retry attempts.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="03017-116">Если в графическом пользовательском интерфейсе (GUI) агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] удалить один или нескольких шагов из многошагового задания, то GUI удаляет все шаги задания, а затем вновь добавляет остающиеся шаги с исправленными ссылками для успешного и ошибочного завершения.</span><span class="sxs-lookup"><span data-stu-id="03017-116">When you use the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent graphical user interface (GUI) and delete one or more steps from a multistep job, the GUI removes all job steps and then adds the remaining steps back with the correct on-success or on-failure references.</span></span> <span data-ttu-id="03017-117">Предположим, что имеется задание из пяти шагов, и первый шаг сконфигурирован так, что в случае его успешного завершения задание переходит на шаг 4.</span><span class="sxs-lookup"><span data-stu-id="03017-117">For example, suppose you have a job with five steps, and the first step is configured to jump to step 4 if it completes successfully.</span></span> <span data-ttu-id="03017-118">Если удалить шаг 3, GUI удаляет все остальные шаги этого задания и добавляет остающиеся четыре шага (1, 2, 4 и 5) с исправленными ссылками.</span><span class="sxs-lookup"><span data-stu-id="03017-118">If you delete step 3, the GUI removes all steps for this job and adds the remaining four steps (1, 2, 4, and 5) with corrected references.</span></span> <span data-ttu-id="03017-119">В этом случае ссылка на шаге 1 будет перенастроена для перехода на шаг 3, если шаг 1 завершается успешно.</span><span class="sxs-lookup"><span data-stu-id="03017-119">In this case, the reference in step 1 would be reconfigured to jump to step 3 if step 1 completes successfully.</span></span>  
  
 <span data-ttu-id="03017-120">Шаги задания должны быть автономными.</span><span class="sxs-lookup"><span data-stu-id="03017-120">Job steps must be self-contained.</span></span> <span data-ttu-id="03017-121">Это значит, что задание не может передавать логические значения, данные или числовые значения между шагами задания.</span><span class="sxs-lookup"><span data-stu-id="03017-121">That is, a job cannot pass Boolean values, data, or numeric values between job steps.</span></span> <span data-ttu-id="03017-122">Однако можно передавать значения из одного шага задания [!INCLUDE[tsql](../../includes/tsql-md.md)] в другой с помощью постоянных таблиц или глобальных временных таблиц.</span><span class="sxs-lookup"><span data-stu-id="03017-122">You can, however, pass values from one [!INCLUDE[tsql](../../includes/tsql-md.md)] job step to another by using permanent tables or global temporary tables.</span></span> <span data-ttu-id="03017-123">Можно передавать значения между шагами задания, в которых запускаются исполняемые программы, с помощью файлов.</span><span class="sxs-lookup"><span data-stu-id="03017-123">You can pass values from job steps that run executable programs from one job step to another job step by using files.</span></span> <span data-ttu-id="03017-124">Например, исполняемая программа, выполняемая на одном шаге задания, записывает файл, а программа, выполняемая на последующем шаге, считывает файл.</span><span class="sxs-lookup"><span data-stu-id="03017-124">For example, the executable run by one job step writes a file, and the executable run by a subsequent job step reads the file.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="03017-125">Если создаются задания с циклическими шагами (за шагом 1 следует шаг 2, затем шаг 2 возвращается к шагу 1), то при создании задания с использованием среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]выдается предупреждающее сообщение.</span><span class="sxs-lookup"><span data-stu-id="03017-125">If you create looping job steps (job step 1 is followed by job step 2, then job step 2 returns to job step 1), a warning message appears when the job is created using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="03017-126">Агент записывает сведения о задании и шагах задания в журнал заданий.</span><span class="sxs-lookup"><span data-stu-id="03017-126">Agent records job and job step information in the job history.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="03017-127">См. также:</span><span class="sxs-lookup"><span data-stu-id="03017-127">See Also</span></span>  
 <span data-ttu-id="03017-128">[sp_add_job (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-add-job-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="03017-128">[sp_add_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-add-job-transact-sql) </span></span>  
 <span data-ttu-id="03017-129">[dbo.sysjobhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/dbo-sysjobhistory-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="03017-129">[dbo.sysjobhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/dbo-sysjobhistory-transact-sql) </span></span>  
 <span data-ttu-id="03017-130">[dbo.sysзадания &#40;&#41;Transact-SQL](/sql/relational-databases/system-tables/dbo-sysjobs-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="03017-130">[dbo.sysjobs &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/dbo-sysjobs-transact-sql) </span></span>  
 <span data-ttu-id="03017-131">[dbo.sysJobSteps &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/dbo-sysjobsteps-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="03017-131">[dbo.sysjobsteps &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/dbo-sysjobsteps-transact-sql) </span></span>  
 <span data-ttu-id="03017-132">[Реализация заданий](implement-jobs.md) </span><span class="sxs-lookup"><span data-stu-id="03017-132">[Implement Jobs](implement-jobs.md) </span></span>  
 [<span data-ttu-id="03017-133">Управление шагами задания</span><span class="sxs-lookup"><span data-stu-id="03017-133">Manage Job Steps</span></span>](manage-job-steps.md)  
  
  
