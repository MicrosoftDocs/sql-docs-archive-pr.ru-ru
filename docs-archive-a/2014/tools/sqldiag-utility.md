---
title: Программа SQLdiag | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: tools-other
ms.topic: conceptual
helpviewer_keywords:
- command prompt utilities [SQL Server], SQLdiag
- stopping diagnostic collection
- storing diagnostic information
- performance [SQL Server], diagnostic collection
- diagnostic records [SQL Server]
- scripts [SQL Server], diagnostic collection
- logs [SQL Server], diagnostic collection
- starting diagnostic collection
- clustered instance of SQL Server
- monitoring performance [SQL Server], diagnostic collection
- security [SQL Server], diagnostic collection
- SQLDIAG service
- space [SQL Server], diagnostic collection
- SQLdiag utility
- disk space [SQL Server], diagnostic collection
- configuration files [SQL Server]
- automatic diagnostic collection
- clusters [SQL Server], diagnostic collection
ms.assetid: 45ba1307-33d1-431e-872c-a6e4556f5ff2
author: stevestein
ms.author: sstein
ms.openlocfilehash: 0559e0b2261ed5ba1c9c384608d04194d685f695
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87727561"
---
# <a name="sqldiag-utility"></a><span data-ttu-id="4c943-102">SQLdiag, программа</span><span class="sxs-lookup"><span data-stu-id="4c943-102">SQLdiag Utility</span></span>
  <span data-ttu-id="4c943-103">Программа **SQLdiag** — это универсальная диагностическая программа для сбора сведений, которая может выполняться как консольное приложение или как служба.</span><span class="sxs-lookup"><span data-stu-id="4c943-103">The **SQLdiag** utility is a general purpose diagnostics collection utility that can be run as a console application or as a service.</span></span> <span data-ttu-id="4c943-104">Программа **SQLdiag** позволяет выполнять сбор журналов и файлов данных с [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] и других типов серверов, а также мониторинг серверов и устранение определенных неполадок на серверах.</span><span class="sxs-lookup"><span data-stu-id="4c943-104">You can use **SQLdiag** to collect logs and data files from [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] and other types of servers, and use it to monitor your servers over time or troubleshoot specific problems with your servers.</span></span> <span data-ttu-id="4c943-105">Программа**SQLdiag** предназначена для ускорения и упрощения сбора диагностических сведений, необходимых для службы поддержки пользователей [!INCLUDE[msCoName](../includes/msconame-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4c943-105">**SQLdiag** is intended to expedite and simplify diagnostic information gathering for [!INCLUDE[msCoName](../includes/msconame-md.md)] Customer Support Services.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4c943-106">Вследствие изменений в программе приложения или скрипты, зависящие от аргументов ее командной строки или особенностей работы, в будущих выпусках могут работать неправильно.</span><span class="sxs-lookup"><span data-stu-id="4c943-106">This utility may be changed, and applications or scripts that rely on its command line arguments or behavior may not work correctly in future releases.</span></span>  
  
 <span data-ttu-id="4c943-107">Программа**SQLdiag** может собирать следующие типы диагностических сведений:</span><span class="sxs-lookup"><span data-stu-id="4c943-107">**SQLdiag** can collect the following types of diagnostic information:</span></span>  
  
-   <span data-ttu-id="4c943-108">журналы производительности Windows;</span><span class="sxs-lookup"><span data-stu-id="4c943-108">Windows performance logs</span></span>  
  
-   <span data-ttu-id="4c943-109">Журналы событий Windows</span><span class="sxs-lookup"><span data-stu-id="4c943-109">Windows event logs</span></span>  
  
-   [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] <span data-ttu-id="4c943-110">;</span><span class="sxs-lookup"><span data-stu-id="4c943-110">traces</span></span>  
  
-   [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] <span data-ttu-id="4c943-111">;</span><span class="sxs-lookup"><span data-stu-id="4c943-111">blocking information</span></span>  
  
-   [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] <span data-ttu-id="4c943-112">.</span><span class="sxs-lookup"><span data-stu-id="4c943-112">configuration information</span></span>  
  
 <span data-ttu-id="4c943-113">Вы можете указать, какие типы сведений нужно собирать с помощью программы **SQLdiag** , в файле конфигурации SQLDiag.xml, который описывается в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="4c943-113">You can specify what types of information you want **SQLdiag** to collect by editing the configuration file SQLDiag.xml, which is described in a following section.</span></span>  
  
## <a name="syntax"></a><span data-ttu-id="4c943-114">Синтаксис</span><span class="sxs-lookup"><span data-stu-id="4c943-114">Syntax</span></span>  
  
```  
  
      sqldiag   
     { [/?] }  
     |  
     { [/I configuration_file]  
       [/O output_folder_path]  
       [/Psupport_folder_path]  
       [/Noutput_folder_management_option]  
       [/Mmachine1 [ machine2machineN]| @machinelistfile]  
       [/Cfile_compression_type]  
       [/B [+]start_time]  
       [/E [+]stop_time]  
       [/ASQLdiag_application_name]  
       [/T { tcp [ ,port ] | np | lpc } ]  
       [/Q] [/G] [/R] [/U] [/L] [/X] }  
     |  
     { [START | STOP | STOP_ABORT] }  
     |  
     { [START | STOP | STOP_ABORT] /ASQLdiag_application_name }  
```  
  
## <a name="arguments"></a><span data-ttu-id="4c943-115">Аргументы</span><span class="sxs-lookup"><span data-stu-id="4c943-115">Arguments</span></span>  
 <span data-ttu-id="4c943-116">**/?**</span><span class="sxs-lookup"><span data-stu-id="4c943-116">**/?**</span></span>  
 <span data-ttu-id="4c943-117">Отображает сведения об использовании.</span><span class="sxs-lookup"><span data-stu-id="4c943-117">Displays usage information.</span></span>  
  
 <span data-ttu-id="4c943-118">**/I** _configuration_file_</span><span class="sxs-lookup"><span data-stu-id="4c943-118">**/I** _configuration_file_</span></span>  
 <span data-ttu-id="4c943-119">Задает файл конфигурации, используемый программой **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-119">Sets the configuration file for **SQLdiag** to use.</span></span> <span data-ttu-id="4c943-120">По умолчанию **/I** задает SQLDiag.Xml.</span><span class="sxs-lookup"><span data-stu-id="4c943-120">By default, **/I** is set to SQLDiag.Xml.</span></span>  
  
 <span data-ttu-id="4c943-121">**/O** _output_folder_path_</span><span class="sxs-lookup"><span data-stu-id="4c943-121">**/O** _output_folder_path_</span></span>  
 <span data-ttu-id="4c943-122">Перенаправляет выходной поток программы **SQLdiag** в указанную папку.</span><span class="sxs-lookup"><span data-stu-id="4c943-122">Redirects **SQLdiag** output to the specified folder.</span></span> <span data-ttu-id="4c943-123">Если параметр **/O** не указан, выходной поток **SQLdiag** направляется во вложенную папку с именем SQLDIAG, расположенную в папке запуска **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-123">If the **/O** option is not specified, **SQLdiag** output is written to a subfolder named SQLDIAG under the **SQLdiag** startup folder.</span></span> <span data-ttu-id="4c943-124">Если папки SQLDIAG не существует, программа **SQLdiag** попытается создать ее.</span><span class="sxs-lookup"><span data-stu-id="4c943-124">If the SQLDIAG folder does not exist, **SQLdiag** attempts to create it.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4c943-125">Расположение выходной папки задается относительно расположения папки поддержки, которое может быть определено параметром **/P**.</span><span class="sxs-lookup"><span data-stu-id="4c943-125">The output folder location is relative to the support folder location that can be specified with **/P**.</span></span> <span data-ttu-id="4c943-126">Для установки абсолютно другого пути к выходной папке укажите полный путь каталога в параметре **/O**.</span><span class="sxs-lookup"><span data-stu-id="4c943-126">To set an entirely different location for the output folder, specify the full directory path for **/O**.</span></span>  
  
 <span data-ttu-id="4c943-127">**/P** _support_folder_path_</span><span class="sxs-lookup"><span data-stu-id="4c943-127">**/P** _support_folder_path_</span></span>  
 <span data-ttu-id="4c943-128">Устанавливает путь к папке поддержки.</span><span class="sxs-lookup"><span data-stu-id="4c943-128">Sets the support folder path.</span></span> <span data-ttu-id="4c943-129">По умолчанию параметр **/P** задает папку, в которой находится исполняемый файл **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-129">By default, **/P** is set to the folder where the **SQLdiag** executable resides.</span></span> <span data-ttu-id="4c943-130">Папка поддержки содержит файлы поддержки **SQLdiag** , например XML-файл конфигурации, скрипты Transact-SQL и другие файлы, используемые программой во время сбора диагностических сведений.</span><span class="sxs-lookup"><span data-stu-id="4c943-130">The support folder contains **SQLdiag** support files, such as the XML configuration file, Transact-SQL scripts, and other files that the utility uses during diagnostics collection.</span></span> <span data-ttu-id="4c943-131">Если этот параметр будет использован для указания дополнительного пути к файлам поддержки, программа **SQLdiag** автоматически скопирует необходимые файлы поддержки в указанную папку, если их еще не существует.</span><span class="sxs-lookup"><span data-stu-id="4c943-131">If you use this option to specify an alternate support files path, **SQLdiag** will automatically copy the support files it requires to the specified folder if they do not already exist.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4c943-132">Чтобы установить текущую папку в качестве пути к файлам поддержки, укажите **%cd%** в командной строке следующим образом:</span><span class="sxs-lookup"><span data-stu-id="4c943-132">To set your current folder as the support path, specify **%cd%** on the command line as follows:</span></span>  
>   
>  <span data-ttu-id="4c943-133">**SQLDIAG /P %cd%**</span><span class="sxs-lookup"><span data-stu-id="4c943-133">**SQLDIAG /P %cd%**</span></span>  
  
 <span data-ttu-id="4c943-134">**/N** _output_folder_management_option_</span><span class="sxs-lookup"><span data-stu-id="4c943-134">**/N** _output_folder_management_option_</span></span>  
 <span data-ttu-id="4c943-135">Определяет, должна ли программа **SQLdiag** при запуске перезаписывать или переименовывать выходную папку.</span><span class="sxs-lookup"><span data-stu-id="4c943-135">Sets whether **SQLdiag** overwrites or renames the output folder when it starts up.</span></span> <span data-ttu-id="4c943-136">Доступные параметры:</span><span class="sxs-lookup"><span data-stu-id="4c943-136">Available options:</span></span>  
  
 <span data-ttu-id="4c943-137">1 = Перезаписывает выходную папку (по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="4c943-137">1 = Overwrites the output folder (default)</span></span>  
  
 <span data-ttu-id="4c943-138">2 = при запуске программа **SQLdiag** переименовывает выходную папку в SQLDIAG_00001, SQLDIAG_00002 и так далее.</span><span class="sxs-lookup"><span data-stu-id="4c943-138">2 = When **SQLdiag** starts up, it renames the output folder to SQLDIAG_00001, SQLDIAG_00002, and so on.</span></span> <span data-ttu-id="4c943-139">После переименования текущей выходной папки программа **SQLdiag** выводит данные в папку по умолчанию SQLDIAG.</span><span class="sxs-lookup"><span data-stu-id="4c943-139">After renaming the current output folder, **SQLdiag** writes output to the default output folder SQLDIAG.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4c943-140">Программа**SQLdiag** при запуске не добавляет данные в текущую выходную папку.</span><span class="sxs-lookup"><span data-stu-id="4c943-140">**SQLdiag** does not append output to the current output folder when it starts up.</span></span> <span data-ttu-id="4c943-141">Она может только перезаписать выходную папку по умолчанию (параметр 1) или переименовать папку (параметр 2), после чего производит вывод в новую выходную папку по умолчанию, имеющую имя SQLDIAG.</span><span class="sxs-lookup"><span data-stu-id="4c943-141">It can only overwrite the default output folder (option 1) or rename the folder (option 2), and then it writes output to the new default output folder named SQLDIAG.</span></span>  
  
 <span data-ttu-id="4c943-142">**/M** _machine1_ [ *machine2 \* \* мачинен*] |*@machinelistfile*</span><span class="sxs-lookup"><span data-stu-id="4c943-142">**/M** _machine1_ [ *machine2\*\*machineN*] | *@machinelistfile*</span></span>  
 <span data-ttu-id="4c943-143">Переопределяет параметр machines, указанный в файле конфигурации.</span><span class="sxs-lookup"><span data-stu-id="4c943-143">Overrides the machines specified in the configuration file.</span></span> <span data-ttu-id="4c943-144">По умолчанию файлом конфигурации является SQLDiag.Xml либо файл, заданный параметром **/I** .</span><span class="sxs-lookup"><span data-stu-id="4c943-144">By default the configuration file is SQLDiag.Xml, or is set with the **/I** parameter.</span></span> <span data-ttu-id="4c943-145">При определении более одного компьютера, разделяйте имена компьютеров пробелами.</span><span class="sxs-lookup"><span data-stu-id="4c943-145">When specifying more than one machine, separate each machine name with a space.</span></span>  
  
 <span data-ttu-id="4c943-146">Используется *@machinelistfile* для указания имени файла списка компьютеров для сохранения в файле конфигурации.</span><span class="sxs-lookup"><span data-stu-id="4c943-146">Using *@machinelistfile* specifies a machine list filename to be stored in the configuration file.</span></span>  
  
 <span data-ttu-id="4c943-147">**/C** _file_compression_type_</span><span class="sxs-lookup"><span data-stu-id="4c943-147">**/C** _file_compression_type_</span></span>  
 <span data-ttu-id="4c943-148">Устанавливает тип сжатия файлов, используемый в файлах выходной папки программы **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-148">Sets the type of file compression used on the **SQLdiag** output folder files.</span></span> <span data-ttu-id="4c943-149">Доступные параметры:</span><span class="sxs-lookup"><span data-stu-id="4c943-149">Available options:</span></span>  
  
 <span data-ttu-id="4c943-150">0 = без сжатия (по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="4c943-150">0 = none (default)</span></span>  
  
 <span data-ttu-id="4c943-151">1 = использование сжатия NTFS</span><span class="sxs-lookup"><span data-stu-id="4c943-151">1 = uses NTFS compression</span></span>  
  
 <span data-ttu-id="4c943-152">**/B** [ **+** ]*start_time*</span><span class="sxs-lookup"><span data-stu-id="4c943-152">**/B** [**+**]*start_time*</span></span>  
 <span data-ttu-id="4c943-153">Указывает дату и время начала сбора диагностических данных в следующем формате:</span><span class="sxs-lookup"><span data-stu-id="4c943-153">Specifies the date and time to start collecting diagnostic data in the following format:</span></span>  
  
 <span data-ttu-id="4c943-154">ГГГГММДД_ЧЧ:ММ:СС</span><span class="sxs-lookup"><span data-stu-id="4c943-154">YYYYMMDD_HH:MM:SS</span></span>  
  
 <span data-ttu-id="4c943-155">Время указывается в 24-часовом формате.</span><span class="sxs-lookup"><span data-stu-id="4c943-155">The time is specified using 24-hour notation.</span></span> <span data-ttu-id="4c943-156">Например, время 14:00</span><span class="sxs-lookup"><span data-stu-id="4c943-156">For example, 2:00 P.M.</span></span> <span data-ttu-id="4c943-157">должно указываться как **14:00:00**.</span><span class="sxs-lookup"><span data-stu-id="4c943-157">should be specified as **14:00:00**.</span></span>  
  
 <span data-ttu-id="4c943-158">Используйте **+** без даты (только ЧЧ:ММ:СС) для указания времени относительно текущей даты и времени.</span><span class="sxs-lookup"><span data-stu-id="4c943-158">Use **+** without the date (HH:MM:SS only) to specify a time that is relative to the current date and time.</span></span> <span data-ttu-id="4c943-159">Например, если указать **/B +02:00:00**, то программа **SQLdiag** будет ждать 2 часа перед тем, как начать сбор сведений.</span><span class="sxs-lookup"><span data-stu-id="4c943-159">For example, if you specify **/B +02:00:00**, **SQLdiag** will wait 2 hours before it starts collecting information.</span></span>  
  
 <span data-ttu-id="4c943-160">Не вставляйте символ пробела между **+** и указанным значением *start_time*.</span><span class="sxs-lookup"><span data-stu-id="4c943-160">Do not insert a space between **+** and the specified *start_time*.</span></span>  
  
 <span data-ttu-id="4c943-161">Если указать время запуска, которое уже прошло, программа **SQLdiag** принудительно изменит дату запуска таким образом, что дата и время запуска будут находиться в будущем.</span><span class="sxs-lookup"><span data-stu-id="4c943-161">If you specify a start time that is in the past, **SQLdiag** forcibly changes the start date so the start date and time are in the future.</span></span> <span data-ttu-id="4c943-162">Например, если указать **/B 01:00:00** а текущее время — 08:00:00, то программа **SQLdiag** принудительно изменит дату запуска на следующий день.</span><span class="sxs-lookup"><span data-stu-id="4c943-162">For example, if you specify **/B 01:00:00** and the current time is 08:00:00, **SQLdiag** forcibly changes the start date so that the start date is the next day.</span></span>  
  
 <span data-ttu-id="4c943-163">Обратите внимание, что **SQLdiag** использует локальное время компьютера, на котором запущена программа.</span><span class="sxs-lookup"><span data-stu-id="4c943-163">Note that **SQLdiag** uses the local time on the computer where the utility is running.</span></span>  
  
 <span data-ttu-id="4c943-164">**/E** [ **+** ]*stop_time*</span><span class="sxs-lookup"><span data-stu-id="4c943-164">**/E** [**+**]*stop_time*</span></span>  
 <span data-ttu-id="4c943-165">Указывает дату и время остановки сбора диагностических данных в следующем формате:</span><span class="sxs-lookup"><span data-stu-id="4c943-165">Specifies the date and time to stop collecting diagnostic data in the following format:</span></span>  
  
 <span data-ttu-id="4c943-166">ГГГГММДД_ЧЧ:ММ:СС</span><span class="sxs-lookup"><span data-stu-id="4c943-166">YYYYMMDD_HH:MM:SS</span></span>  
  
 <span data-ttu-id="4c943-167">Время указывается в 24-часовом формате.</span><span class="sxs-lookup"><span data-stu-id="4c943-167">The time is specified using 24-hour notation.</span></span> <span data-ttu-id="4c943-168">Например, время 14:00</span><span class="sxs-lookup"><span data-stu-id="4c943-168">For example, 2:00 P.M.</span></span> <span data-ttu-id="4c943-169">должно указываться как **14:00:00**.</span><span class="sxs-lookup"><span data-stu-id="4c943-169">should be specified as **14:00:00**.</span></span>  
  
 <span data-ttu-id="4c943-170">Используйте **+** без даты (только ЧЧ:ММ:СС) для указания времени относительно текущей даты и времени.</span><span class="sxs-lookup"><span data-stu-id="4c943-170">Use **+** without the date (HH:MM:SS only) to specify a time that is relative to the current date and time.</span></span> <span data-ttu-id="4c943-171">Например, если время запуска и остановки указано как **/B +02:00:00 /E +03:00:00**, то **SQLdiag** будет ждать 2 часа перед тем, как начать сбор сведений, затем будет собирать сведения в течение 3 часов, прежде чем остановится и завершит работу.</span><span class="sxs-lookup"><span data-stu-id="4c943-171">For example, if you specify a start time and end time by using **/B +02:00:00 /E +03:00:00**, **SQLdiag** waits 2 hours before it starts collecting information, then collects information for 3 hours before it stops and exits.</span></span> <span data-ttu-id="4c943-172">Если параметр **/B** не указан, программа **SQLdiag** начнет сбор диагностических сведений немедленно и закончит в момент, соответствующий дате и времени, указанным в параметре **/E**.</span><span class="sxs-lookup"><span data-stu-id="4c943-172">If **/B** is not specified, **SQLdiag** starts collecting diagnostics immediately and ends at the date and time specified by **/E**.</span></span>  
  
 <span data-ttu-id="4c943-173">Не вставляйте символ пробела между **+** и указанным значением *start_time* или *end_time*.</span><span class="sxs-lookup"><span data-stu-id="4c943-173">Do not insert a space between **+** and the specified *start_time* or *end_time*.</span></span>  
  
 <span data-ttu-id="4c943-174">Обратите внимание, что **SQLdiag** использует локальное время компьютера, на котором запущена программа.</span><span class="sxs-lookup"><span data-stu-id="4c943-174">Note that **SQLdiag** uses the local time on the computer where the utility is running.</span></span>  
  
 <span data-ttu-id="4c943-175">**/A** _SQLdiag_application_name_</span><span class="sxs-lookup"><span data-stu-id="4c943-175">**/A** _SQLdiag_application_name_</span></span>  
 <span data-ttu-id="4c943-176">Разрешает запуск нескольких экземпляров программы **SQLdiag** для работы с одним экземпляром [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4c943-176">Enables running multiple instances of the **SQLdiag** utility against the same [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instance.</span></span>  
  
 <span data-ttu-id="4c943-177">Каждое значение *SQLdiag_application_name* определяет другой экземпляр **SQLdiag**.</span><span class="sxs-lookup"><span data-stu-id="4c943-177">Each *SQLdiag_application_name* identifies a different instance of **SQLdiag**.</span></span> <span data-ttu-id="4c943-178">Между экземпляром *SQLdiag_application_name* и именем экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] никакой связи не существует.</span><span class="sxs-lookup"><span data-stu-id="4c943-178">No relationship exists between a *SQLdiag_application_name* instance and a [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instance name.</span></span>  
  
 <span data-ttu-id="4c943-179">Параметр*SQLdiag_application_name* может использоваться для запуска или остановки указанного экземпляра службы **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-179">*SQLdiag_application_name* can be used to start or stop a specific instance of the **SQLdiag** service.</span></span>  
  
 <span data-ttu-id="4c943-180">Пример:</span><span class="sxs-lookup"><span data-stu-id="4c943-180">For example:</span></span>  
  
 <span data-ttu-id="4c943-181">**SQLDIAG START /A** _SQLdiag_application_name_</span><span class="sxs-lookup"><span data-stu-id="4c943-181">**SQLDIAG START /A** _SQLdiag_application_name_</span></span>  
  
 <span data-ttu-id="4c943-182">Кроме того, он может использоваться с параметром **/R** для регистрации указанного экземпляра **SQLdiag** в качестве службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-182">It can also be used with the **/R** option to register a specific instance of **SQLdiag** as a service.</span></span> <span data-ttu-id="4c943-183">Пример:</span><span class="sxs-lookup"><span data-stu-id="4c943-183">For example:</span></span>  
  
 <span data-ttu-id="4c943-184">**SQLDIAG /R /A** _SQLdiag_application_name_</span><span class="sxs-lookup"><span data-stu-id="4c943-184">**SQLDIAG /R /A** _SQLdiag_application_name_</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4c943-185">Программа**SQLdiag** автоматически добавляет префикс DIAG$ к имени экземпляра, указанному для *SQLdiag_application_name*.</span><span class="sxs-lookup"><span data-stu-id="4c943-185">**SQLdiag** automatically prefixes DIAG$ to the instance name specified for *SQLdiag_application_name*.</span></span> <span data-ttu-id="4c943-186">Это позволяет получить понятное имя службы при регистрации **SQLdiag** в качестве службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-186">This provides a sensible service name if you register **SQLdiag** as a service.</span></span>  
  
 <span data-ttu-id="4c943-187">/T { tcp [ ,*port* ] | np | lpc }</span><span class="sxs-lookup"><span data-stu-id="4c943-187">/T { tcp [ ,*port* ] | np | lpc }</span></span>  
 <span data-ttu-id="4c943-188">Подключение к экземпляру [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] с использованием определенного протокола.</span><span class="sxs-lookup"><span data-stu-id="4c943-188">Connects to an instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] using the specified protocol.</span></span>  
  
 <span data-ttu-id="4c943-189">tcp [,*port*]</span><span class="sxs-lookup"><span data-stu-id="4c943-189">tcp [,*port*]</span></span>  
 <span data-ttu-id="4c943-190">Протокол TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="4c943-190">Transmission Control Protocol/Internet Protocol (TCP/IP).</span></span> <span data-ttu-id="4c943-191">Можно дополнительно определить порт для соединения.</span><span class="sxs-lookup"><span data-stu-id="4c943-191">You can optionally specify a port number for the connection.</span></span>  
  
 <span data-ttu-id="4c943-192">np</span><span class="sxs-lookup"><span data-stu-id="4c943-192">np</span></span>  
 <span data-ttu-id="4c943-193">Именованные каналы.</span><span class="sxs-lookup"><span data-stu-id="4c943-193">Named pipes.</span></span> <span data-ttu-id="4c943-194">По умолчанию экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] прослушивает именованные каналы `\\.\pipe\sql\query` и `\\.\pipe\MSSQL$<instancename>\sql\query` для именованных экземпляров.</span><span class="sxs-lookup"><span data-stu-id="4c943-194">By default, the default instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] listens on named pipe `\\.\pipe\sql\query` and `\\.\pipe\MSSQL$<instancename>\sql\query` for a named instance.</span></span> <span data-ttu-id="4c943-195">Нельзя соединиться с экземпляром [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] с помощью другого имени канала.</span><span class="sxs-lookup"><span data-stu-id="4c943-195">You cannot connect to an instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] by using an alternate pipe name.</span></span>  
  
 <span data-ttu-id="4c943-196">lpc</span><span class="sxs-lookup"><span data-stu-id="4c943-196">lpc</span></span>  
 <span data-ttu-id="4c943-197">Вызов локальной процедуры.</span><span class="sxs-lookup"><span data-stu-id="4c943-197">Local procedure call.</span></span> <span data-ttu-id="4c943-198">Может использовать протокол общей памяти, если клиент соединяется с экземпляром компонента [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] на том же компьютере.</span><span class="sxs-lookup"><span data-stu-id="4c943-198">This shared memory protocol is available if the client is connecting to an instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] on the same computer.</span></span>  
  
 <span data-ttu-id="4c943-199">**/Q**</span><span class="sxs-lookup"><span data-stu-id="4c943-199">**/Q**</span></span>  
 <span data-ttu-id="4c943-200">Запускает **SQLdiag** в автоматическом режиме.</span><span class="sxs-lookup"><span data-stu-id="4c943-200">Runs **SQLdiag** in quiet mode.</span></span> <span data-ttu-id="4c943-201">Параметр **/Q** блокирует все запросы, например запросы на ввод пароля.</span><span class="sxs-lookup"><span data-stu-id="4c943-201">**/Q** suppresses all prompts, such as password prompts.</span></span>  
  
 <span data-ttu-id="4c943-202">**/G**</span><span class="sxs-lookup"><span data-stu-id="4c943-202">**/G**</span></span>  
 <span data-ttu-id="4c943-203">Запускает **SQLdiag** в обычном режиме.</span><span class="sxs-lookup"><span data-stu-id="4c943-203">Runs **SQLdiag** in generic mode.</span></span> <span data-ttu-id="4c943-204">Если указан параметр **/G** , то при запуске программа **SQLdiag** не осуществляет принудительную проверку подключения [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] или проверку членства пользователя в предопределенной роли сервера **sysadmin** .</span><span class="sxs-lookup"><span data-stu-id="4c943-204">When **/G** is specified, on startup **SQLdiag** does not enforce [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] connectivity checks or verify that the user is a member of the **sysadmin** fixed server role.</span></span> <span data-ttu-id="4c943-205">Вместо этого **SQLdiag** запрашивает у Windows определение наличия у пользователя соответствующих прав для сбора каждого из запрашиваемых диагностических сведений.</span><span class="sxs-lookup"><span data-stu-id="4c943-205">Instead, **SQLdiag** defers to Windows to determine whether a user has the appropriate rights to gather each requested diagnostic.</span></span>  
  
 <span data-ttu-id="4c943-206">Если параметр **/G** не указан, программа **SQLdiag** выполнит проверку, чтобы определить, является ли пользователь членом группы **Администраторы** Windows, и не будет собирать диагностические сведения [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , если пользователь не является членом группы **Администраторы** .</span><span class="sxs-lookup"><span data-stu-id="4c943-206">If **/G** is not specified, **SQLdiag** checks to determine whether the user is a member of the Windows **Administrators** group, and will not collect [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] diagnostics if the user is not an **Administrators** group member.</span></span>  
  
 <span data-ttu-id="4c943-207">**/R**</span><span class="sxs-lookup"><span data-stu-id="4c943-207">**/R**</span></span>  
 <span data-ttu-id="4c943-208">Регистрирует программу **SQLdiag** в качестве службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-208">Registers **SQLdiag** as a service.</span></span> <span data-ttu-id="4c943-209">Все аргументы командной строки, указанные при регистрации **SQLdiag** в качестве службы, сохраняются при последующих запусках службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-209">Any command line arguments that are specified when you register **SQLdiag** as a service are preserved for future runs of the service.</span></span>  
  
 <span data-ttu-id="4c943-210">При регистрации **SQLdiag** в качестве службы имя службы по умолчанию — SQLDIAG.</span><span class="sxs-lookup"><span data-stu-id="4c943-210">When **SQLdiag** is registered as a service, the default service name is SQLDIAG.</span></span> <span data-ttu-id="4c943-211">Изменить имя службы можно с помощью аргумента **/A** .</span><span class="sxs-lookup"><span data-stu-id="4c943-211">You can change the service name by using the **/A** argument.</span></span>  
  
 <span data-ttu-id="4c943-212">Для запуска службы используйте аргумент командной строки **START** :</span><span class="sxs-lookup"><span data-stu-id="4c943-212">Use the **START** command line argument to start the service:</span></span>  
  
 <span data-ttu-id="4c943-213">**SQLDIAG START**</span><span class="sxs-lookup"><span data-stu-id="4c943-213">**SQLDIAG START**</span></span>  
  
 <span data-ttu-id="4c943-214">Также для запуска службы можно использовать команду **net start** :</span><span class="sxs-lookup"><span data-stu-id="4c943-214">You can also use the **net start** command to start the service:</span></span>  
  
 <span data-ttu-id="4c943-215">**NET start SQLDIAG**</span><span class="sxs-lookup"><span data-stu-id="4c943-215">**net start SQLDIAG**</span></span>  
  
 <span data-ttu-id="4c943-216">**/U**</span><span class="sxs-lookup"><span data-stu-id="4c943-216">**/U**</span></span>  
 <span data-ttu-id="4c943-217">Отменяет регистрацию программы **SQLdiag** в качестве службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-217">Unregisters **SQLdiag** as a service.</span></span>  
  
 <span data-ttu-id="4c943-218">Кроме того, используйте аргумент **/A** , если нужно отменить регистрацию именованного экземпляра **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-218">Use the **/A** argument also if unregistering a named **SQLdiag** instance.</span></span>  
  
 <span data-ttu-id="4c943-219">**/L**</span><span class="sxs-lookup"><span data-stu-id="4c943-219">**/L**</span></span>  
 <span data-ttu-id="4c943-220">Запускает программу **SQLdiag** в непрерывном режиме, когда, помимо прочего, указано время запуска или время остановки с помощью аргумента **/B** или **/E** , соответственно.</span><span class="sxs-lookup"><span data-stu-id="4c943-220">Runs **SQLdiag** in continuous mode when a start time or end time is also specified with the **/B** or **/E** arguments, respectively.</span></span> <span data-ttu-id="4c943-221">Программа**SQLdiag** автоматически перезапускается после того, как сбор диагностических сведений останавливается из-за запланированного завершения работы.</span><span class="sxs-lookup"><span data-stu-id="4c943-221">**SQLdiag** automatically restarts after diagnostics collection stops due to a scheduled shutdown.</span></span> <span data-ttu-id="4c943-222">Например, при использовании аргументов **/E** или **/X** .</span><span class="sxs-lookup"><span data-stu-id="4c943-222">For example, by using the **/E** or the **/X** arguments.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4c943-223">Программа**SQLdiag** не учитывает аргумент **/L** , если время запуска или остановки не указано с помощью аргументов командной строки **/B** и **/E** commи line arguments.</span><span class="sxs-lookup"><span data-stu-id="4c943-223">**SQLdiag** ignores the **/L** argument if a start time or end time is not specified by using the **/B** and **/E** command line arguments.</span></span>  
  
 <span data-ttu-id="4c943-224">Параметр **/L** не подразумевает запуск в качестве службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-224">Using **/L** does not imply the service mode.</span></span> <span data-ttu-id="4c943-225">Чтобы использовать параметр **/L** при запуске **SQLdiag** в качестве службы, укажите его в командной строке при регистрации службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-225">To use **/L** when running **SQLdiag** as a service, specify it on the command line when you register the service.</span></span>  
  
 <span data-ttu-id="4c943-226">**/X**</span><span class="sxs-lookup"><span data-stu-id="4c943-226">**/X**</span></span>  
 <span data-ttu-id="4c943-227">Запускает **SQLdiag** в режиме моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="4c943-227">Runs **SQLdiag** in snapshot mode.</span></span> <span data-ttu-id="4c943-228">**SQLdiag** создает моментальный снимок всех настроенных диагностических сведений и автоматически завершает работу.</span><span class="sxs-lookup"><span data-stu-id="4c943-228">**SQLdiag** takes a snapshot of all configured diagnostics and then shuts down automatically.</span></span>  
  
 <span data-ttu-id="4c943-229">**START** | **STOP** | **STOP_ABORT**</span><span class="sxs-lookup"><span data-stu-id="4c943-229">**START** | **STOP** | **STOP_ABORT**</span></span>  
 <span data-ttu-id="4c943-230">Запускает или останавливает службу **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-230">Starts or stops the **SQLdiag** service.</span></span> <span data-ttu-id="4c943-231">Параметр**STOP_ABORT** вызывает максимально быстрое завершение работы службы, не дожидаясь окончания выполняемого в настоящий момент сбора диагностических сведений.</span><span class="sxs-lookup"><span data-stu-id="4c943-231">**STOP_ABORT** forces the service to shut down as quickly as possible without finishing collection of diagnostics it is currently collecting.</span></span>  
  
 <span data-ttu-id="4c943-232">Если используются эти аргументы управления службой, они должны быть первыми аргументами в командной строке.</span><span class="sxs-lookup"><span data-stu-id="4c943-232">When these service control arguments are used, they must be the first argument used on the command line.</span></span> <span data-ttu-id="4c943-233">Пример:</span><span class="sxs-lookup"><span data-stu-id="4c943-233">For example:</span></span>  
  
 <span data-ttu-id="4c943-234">**SQLDIAG START**</span><span class="sxs-lookup"><span data-stu-id="4c943-234">**SQLDIAG START**</span></span>  
  
 <span data-ttu-id="4c943-235">Только аргумент **/A** , указывающий именованный экземпляр **SQLdiag**, может быть использован вместе со **START**, **STOP**или **STOP_ABORT** для управления определенным экземпляром службы **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-235">Only the **/A** argument, which specifies a named instance of **SQLdiag**, can be used with **START**, **STOP**, or **STOP_ABORT** to control a specific instance of the **SQLdiag** service.</span></span> <span data-ttu-id="4c943-236">Пример:</span><span class="sxs-lookup"><span data-stu-id="4c943-236">For example:</span></span>  
  
 <span data-ttu-id="4c943-237">**SQLDIAG START /A** _SQLdiag_application_name_</span><span class="sxs-lookup"><span data-stu-id="4c943-237">**SQLDIAG START /A** _SQLdiag_application_name_</span></span>  
  
## <a name="security-requirements"></a><span data-ttu-id="4c943-238">Требования безопасности</span><span class="sxs-lookup"><span data-stu-id="4c943-238">Security Requirements</span></span>  
 <span data-ttu-id="4c943-239">Кроме случая, когда **SQLdiag** выполняется в обычном режиме (с помощью аргумента командной строки **/G** ), запускающий **SQLdiag** пользователь должен быть членом группы **Администраторы** Windows и членом предопределенной роли сервера [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] **sysadmin**.</span><span class="sxs-lookup"><span data-stu-id="4c943-239">Unless **SQLdiag** is run in generic mode (by specifying the **/G** command line argument), the user who runs **SQLdiag** must be a member of the Windows **Administrators** group and a member of the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] **sysadmin** fixed server role.</span></span> <span data-ttu-id="4c943-240">По умолчанию программа **SQLdiag** подключается к [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , используя проверку подлинности Windows, но поддерживает и проверку подлинности [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4c943-240">By default, **SQLdiag** connects to [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] by using Windows Authentication, but it also supports [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Authentication.</span></span>  
  
## <a name="performance-considerations"></a><span data-ttu-id="4c943-241">Вопросы производительности</span><span class="sxs-lookup"><span data-stu-id="4c943-241">Performance Considerations</span></span>  
 <span data-ttu-id="4c943-242">Влияние выполнения **SQLdiag** на производительность зависит от типа собираемых диагностических данных.</span><span class="sxs-lookup"><span data-stu-id="4c943-242">The performance effects of running **SQLdiag** depend on the type of diagnostic data you have configured it to collect.</span></span> <span data-ttu-id="4c943-243">Например, если программа **SQLdiag** настроена на сбор данных трассировки [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] , то количество классов событий, выбранных для трассировки, будет влиять на производительность сервера.</span><span class="sxs-lookup"><span data-stu-id="4c943-243">For example, if you have configured **SQLdiag** to collect [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] tracing information, the more event classes you choose to trace, the more your server performance is affected.</span></span>  
  
 <span data-ttu-id="4c943-244">Воздействие выполнения программы **SQLdiag** на производительность приблизительно равно сумме затрат на сбор диагностических сведений по отдельности.</span><span class="sxs-lookup"><span data-stu-id="4c943-244">The performance impact of running **SQLdiag** is approximately equivalent to the sum of the costs of collecting the configured diagnostics separately.</span></span> <span data-ttu-id="4c943-245">Например, сбор данных трассировки с помощью **SQLdiag** влияет на производительность так же, как их сбор с помощью [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4c943-245">For example, collecting a trace with **SQLdiag** incurs the same performance cost as collecting it with [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)].</span></span> <span data-ttu-id="4c943-246">Влияние программы **SQLdiag** на производительность незначительно.</span><span class="sxs-lookup"><span data-stu-id="4c943-246">The performance impact of using **SQLdiag** is negligible.</span></span>  
  
## <a name="required-disk-space"></a><span data-ttu-id="4c943-247">Необходимое место на диске</span><span class="sxs-lookup"><span data-stu-id="4c943-247">Required Disk Space</span></span>  
 <span data-ttu-id="4c943-248">Поскольку программа **SQLdiag** может собирать различные типы диагностических сведений, количество свободного места на диске, необходимого для выполнения **SQLdiag** , может различаться.</span><span class="sxs-lookup"><span data-stu-id="4c943-248">Because **SQLdiag** can collect different types of diagnostic information, the free disk space that is required to run **SQLdiag** varies.</span></span> <span data-ttu-id="4c943-249">Объем собранных диагностических сведений зависит от характера и объема рабочей нагрузки, которую обрабатывает сервер, и может меняться от нескольких мегабайтов до нескольких гигабайтов.</span><span class="sxs-lookup"><span data-stu-id="4c943-249">The amount of diagnostic information collected depends on the nature and volume of the workload that the server is processing and may range from a few megabytes to several gigabytes.</span></span>  
  
## <a name="configuration-files"></a><span data-ttu-id="4c943-250">Файлы конфигурации</span><span class="sxs-lookup"><span data-stu-id="4c943-250">Configuration Files</span></span>  
 <span data-ttu-id="4c943-251">При запуске программа **SQLdiag** считывает файл конфигурации и указанные аргументы командной строки.</span><span class="sxs-lookup"><span data-stu-id="4c943-251">On startup, **SQLdiag** reads the configuration file and the command line arguments that have been specified.</span></span> <span data-ttu-id="4c943-252">Типы диагностических сведений, которые собирает программа **SQLdiag** , указываются в файле конфигурации.</span><span class="sxs-lookup"><span data-stu-id="4c943-252">You specify the types of diagnostic information that **SQLdiag** collects in the configuration file.</span></span> <span data-ttu-id="4c943-253">По умолчанию программа **SQLdiag** использует файл конфигурации SQLDiag.Xml, который извлекается каждый раз при запуске программы и расположен в папке запуска **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-253">By default, **SQLdiag** uses the SQLDiag.Xml configuration file, which is extracted each time the tool runs and is located in the **SQLdiag** utility startup folder.</span></span> <span data-ttu-id="4c943-254">Файл конфигурации использует схему XML SQLDiag_schema.xsd, которая также извлекается в каталог запуска программы из исполняемого файла каждый раз при выполнении **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-254">The configuration file uses the XML schema, SQLDiag_schema.xsd, which is also extracted into the utility startup directory from the executable file each time **SQLdiag** runs.</span></span>  
  
### <a name="editing-the-configuration-files"></a><span data-ttu-id="4c943-255">Изменение файлов конфигурации</span><span class="sxs-lookup"><span data-stu-id="4c943-255">Editing the Configuration Files</span></span>  
 <span data-ttu-id="4c943-256">Чтобы изменить типы диагностических данных, собираемых программой **SQLdiag** , можно скопировать и изменить файл SQLDiag.Xml.</span><span class="sxs-lookup"><span data-stu-id="4c943-256">You can copy and edit SQLDiag.Xml to change the types of diagnostic data that **SQLdiag** collects.</span></span> <span data-ttu-id="4c943-257">Для изменения файла конфигурации всегда используйте редактор XML, который может проверить файл конфигурации на соответствие его схеме XML, например [!INCLUDE[ssManStudio](../includes/ssmanstudio-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4c943-257">When editing the configuration file always use an XML editor that can validate the configuration file against its XML schema, such as [!INCLUDE[ssManStudio](../includes/ssmanstudio-md.md)].</span></span> <span data-ttu-id="4c943-258">Не следует непосредственно изменять файл SQLDiag.Xml.</span><span class="sxs-lookup"><span data-stu-id="4c943-258">You should not edit SQLDiag.Xml directly.</span></span> <span data-ttu-id="4c943-259">Вместо этого скопируйте файл SQLDiag.Xml в файл с новым именем в той же самой папке.</span><span class="sxs-lookup"><span data-stu-id="4c943-259">Instead, make a copy of SQLDiag.Xml and rename it to a new file name in the same folder.</span></span> <span data-ttu-id="4c943-260">Затем отредактируйте новый файл и используйте аргумент **/I** , чтобы передать его в программу **SQLdiag**.</span><span class="sxs-lookup"><span data-stu-id="4c943-260">Then edit the new file, and use the **/I** argument to pass it to **SQLdiag**.</span></span>  
  
#### <a name="editing-the-configuration-file-when-sqldiag-runs-as-a-service"></a><span data-ttu-id="4c943-261">Изменение файла конфигурации во время выполнения программы SQLdiag в качестве службы</span><span class="sxs-lookup"><span data-stu-id="4c943-261">Editing the Configuration File When SQLdiag Runs as a Service</span></span>  
 <span data-ttu-id="4c943-262">Если программа **SQLdiag** уже запущена как служба и необходимо изменить файл конфигурации, отмените регистрацию службы SQLDIAG с помощью аргумента командной строки **/U** и повторно зарегистрируйте службу с помощью параметра командной строки **/R** .</span><span class="sxs-lookup"><span data-stu-id="4c943-262">If you have already run **SQLdiag** as a service and need to edit the configuration file, unregister the SQLDIAG service by specifying the **/U** command line argument and then re-register the service by using the **/R** command line argument.</span></span> <span data-ttu-id="4c943-263">Отмена регистрации и повторная регистрация службы удаляют старые сведения о конфигурации, которые были сохранены в реестре Windows.</span><span class="sxs-lookup"><span data-stu-id="4c943-263">Unregistering and re-registering the service removes old configuration information that was cached in the Windows registry.</span></span>  
  
## <a name="output-folder"></a><span data-ttu-id="4c943-264">Выходная папка</span><span class="sxs-lookup"><span data-stu-id="4c943-264">Output Folder</span></span>  
 <span data-ttu-id="4c943-265">Если выходная папка не была указана с помощью аргумента **/O** , программа **SQLdiag** создаст вложенную папку с именем SQLDIAG в папке запуска **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-265">If you do not specify an output folder with the **/O** argument, **SQLdiag** creates a subfolder named SQLDIAG under the **SQLdiag** startup folder.</span></span> <span data-ttu-id="4c943-266">Для сбора диагностических сведений, связанного с трассировкой больших объемов данных, например сведений [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] , убедитесь, что выходная папка находится на локальном диске, имеющем достаточное количество свободного места для хранения этих данных.</span><span class="sxs-lookup"><span data-stu-id="4c943-266">For diagnostic information collection that involves high volume tracing, such as [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] , make sure that the output folder is on a local drive with enough space to store the requested diagnostic output.</span></span>  
  
 <span data-ttu-id="4c943-267">После перезапуска программа **SQLdiag** перезаписывает содержимое выходной папки.</span><span class="sxs-lookup"><span data-stu-id="4c943-267">When **SQLdiag** is restarted, it overwrites the contents of the output folder.</span></span> <span data-ttu-id="4c943-268">Чтобы избежать этого, укажите в командной строке **/N 2** .</span><span class="sxs-lookup"><span data-stu-id="4c943-268">To avoid this, specify **/N 2** on the command line.</span></span>  
  
## <a name="data-collection-process"></a><span data-ttu-id="4c943-269">Процесс сбора данных</span><span class="sxs-lookup"><span data-stu-id="4c943-269">Data Collection Process</span></span>  
 <span data-ttu-id="4c943-270">При запуске программа **SQLdiag** выполняет начальные проверки, необходимые для сбора диагностических данных, указанных в файле SQLDiag.Xml.</span><span class="sxs-lookup"><span data-stu-id="4c943-270">When **SQLdiag** starts, it performs the initialization checks necessary to collect the diagnostic data that have been specified in SQLDiag.Xml.</span></span> <span data-ttu-id="4c943-271">Этот процесс может занять несколько секунд.</span><span class="sxs-lookup"><span data-stu-id="4c943-271">This process may take several seconds.</span></span> <span data-ttu-id="4c943-272">После того как программа **SQLdiag** начала сбор диагностических данных в консольном приложении, выводимые сообщения информируют о том, что **SQLdiag** начала сбор данных и остановить процесс можно, нажав CTRL + C.</span><span class="sxs-lookup"><span data-stu-id="4c943-272">After **SQLdiag** has started collecting diagnostic data when it is run as a console application, a message displays informing you that **SQLdiag** collection has started and that you can press CTRL+C to stop it.</span></span> <span data-ttu-id="4c943-273">Если программа **SQLdiag** работает как служба, похожее сообщение будет записано в журнал событий Windows.</span><span class="sxs-lookup"><span data-stu-id="4c943-273">When **SQLdiag** is run as a service, a similar message is written to the Windows event log.</span></span>  
  
 <span data-ttu-id="4c943-274">Если программа **SQLdiag** используется для диагностики проблемы, которую можно воспроизвести, дождитесь этого сообщения, прежде чем воспроизводить проблему на сервере.</span><span class="sxs-lookup"><span data-stu-id="4c943-274">If you are using **SQLdiag** to diagnose a problem that you can reproduce, wait until you receive this message before you reproduce the problem on your server.</span></span>  
  
 <span data-ttu-id="4c943-275">Программа**SQLdiag** собирает большую часть диагностических данных параллельно.</span><span class="sxs-lookup"><span data-stu-id="4c943-275">**SQLdiag** collects most diagnostic data in parallel.</span></span> <span data-ttu-id="4c943-276">Все диагностические сведения собираются путем подключения к специальным средствам, таким как служебная программа [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] **sqlcmd** или интерпретатор командной строки Windows, кроме тех случаев, когда сведения собираются из журналов производительности и журналов событий Windows.</span><span class="sxs-lookup"><span data-stu-id="4c943-276">All diagnostic information is collected by connecting to tools, such as the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] **sqlcmd** utility or the Windows command processor, except when information is collected from Windows performance logs and event logs.</span></span> <span data-ttu-id="4c943-277">Для наблюдения за сбором диагностических данных с помощью таких средств программа**SQLdiag** использует один рабочий поток на компьютере, при этом часто несколько средств работают одновременно.</span><span class="sxs-lookup"><span data-stu-id="4c943-277">**SQLdiag** uses one worker thread per computer to monitor the diagnostic data collection of these other tools, often simultaneously waiting for several tools to complete.</span></span> <span data-ttu-id="4c943-278">В процессе сбора данных программа **SQLdiag** направляет выходной поток каждого средства диагностики в выходную папку.</span><span class="sxs-lookup"><span data-stu-id="4c943-278">During the collection process, **SQLdiag** routes the output from each diagnostic to the output folder.</span></span>  
  
## <a name="stopping-data-collection"></a><span data-ttu-id="4c943-279">Остановка сбора данных</span><span class="sxs-lookup"><span data-stu-id="4c943-279">Stopping Data Collection</span></span>  
 <span data-ttu-id="4c943-280">После начала сбора диагностических данных **SQLdiag** продолжает этот процесс, пока не будет остановлена пользователем или не остановится в указанное время.</span><span class="sxs-lookup"><span data-stu-id="4c943-280">After **SQLdiag** starts collecting diagnostic data, it continues to do so unless you stop it or it is configured to stop at a specified time.</span></span> <span data-ttu-id="4c943-281">Настроить программу **SQLdiag** для остановки в указанное время можно с помощью аргумента **/E** , который позволяет указать время остановки, или с помощью параметра **/X** , который запускает **SQLdiag** в режиме моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="4c943-281">You can configure **SQLdiag** to stop at a specified time by using the **/E** argument, which allows you to specify a stop time, or by using the **/X** argument, which causes **SQLdiag** to run in snapshot mode.</span></span>  
  
 <span data-ttu-id="4c943-282">При остановке **SQLdiag** останавливаются и все запущенные ею средства диагностики.</span><span class="sxs-lookup"><span data-stu-id="4c943-282">When **SQLdiag** stops, it stops all diagnostics it has started.</span></span> <span data-ttu-id="4c943-283">Например, останавливается сбор трассировок [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] , прекращается выполнение запущенных скриптов [!INCLUDE[tsql](../includes/tsql-md.md)] , и останавливаются любые процессы, порожденные программой во время сбора данных.</span><span class="sxs-lookup"><span data-stu-id="4c943-283">For example, it stops [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] traces it was collecting, it stops executing [!INCLUDE[tsql](../includes/tsql-md.md)] scripts it was running, and it stops any sub processes it has spawned during data collection.</span></span> <span data-ttu-id="4c943-284">После того как сбор диагностических данных закончен, **SQLdiag** завершает работу.</span><span class="sxs-lookup"><span data-stu-id="4c943-284">After diagnostic data collection has completed, **SQLdiag** exits.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4c943-285">Приостановка службы **SQLdiag** не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="4c943-285">Pausing the **SQLdiag** service is not supported.</span></span> <span data-ttu-id="4c943-286">Если вы попытаетесь приостановить службу **SQLdiag** , она остановится после того, как закончит сбор диагностических сведений, выполняемый в момент приостановки.</span><span class="sxs-lookup"><span data-stu-id="4c943-286">If you attempt to pause the **SQLdiag** service, it stops after it finishes collecting the diagnostics that it was collecting when you paused it.</span></span> <span data-ttu-id="4c943-287">Если перезапустить **SQLdiag** после ее остановки, она запустится и перезапишет выходную папку.</span><span class="sxs-lookup"><span data-stu-id="4c943-287">If you restart **SQLdiag** after stopping it, the application restarts and overwrites the output folder.</span></span> <span data-ttu-id="4c943-288">Чтобы избежать перезаписи выходной папки, укажите в командной строке **/N 2** .</span><span class="sxs-lookup"><span data-stu-id="4c943-288">To avoid overwriting the output folder, specify **/N 2** on the command line.</span></span>  
  
 <span data-ttu-id="4c943-289">**Остановка программы SQLdiag, выполняющейся в консольном приложении**</span><span class="sxs-lookup"><span data-stu-id="4c943-289">**To stop SQLdiag when running as a console application**</span></span>  
  
 <span data-ttu-id="4c943-290">Если программа **SQLdiag** запущена в виде консольного приложения, для ее остановки нажмите CTRL + C в окне консоли, в котором выполняется **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-290">If you are running **SQLdiag** as a console application, press CTRL+C in the console window where **SQLdiag** is running to stop it.</span></span> <span data-ttu-id="4c943-291">После нажатия CTRL + C в окне консоли отобразится сообщение о том, что программа **SQLdiag** заканчивает сбор данных и нужно подождать, пока процесс завершится, что может занять несколько минут.</span><span class="sxs-lookup"><span data-stu-id="4c943-291">After you press CTRL+C, a message displays in the console window informing you that **SQLDiag** data collection is ending, and that you should wait until the process shuts down, which may take several minutes.</span></span>  
  
 <span data-ttu-id="4c943-292">Нажмите Ctrl+C дважды, чтобы принудительно завершить все дочерние диагностические процессы и немедленно завершить приложение.</span><span class="sxs-lookup"><span data-stu-id="4c943-292">Press Ctrl+C twice to terminate all child diagnostic processes and immediately terminate the application.</span></span>  
  
 <span data-ttu-id="4c943-293">**Остановка программы SQLdiag, выполняющейся в режиме службы**</span><span class="sxs-lookup"><span data-stu-id="4c943-293">**To stop SQLdiag when running as a service**</span></span>  
  
 <span data-ttu-id="4c943-294">Если **SQLdiag** запущена как служба, выполните **SQLDiag STOP** в папке запуска **SQLdiag** , чтобы остановить ее.</span><span class="sxs-lookup"><span data-stu-id="4c943-294">If you are running **SQLdiag** as a service, run **SQLDiag STOP** in the **SQLdiag** startup folder to stop it.</span></span>  
  
 <span data-ttu-id="4c943-295">Если на одном компьютере выполняется несколько экземпляров **SQLdiag** , для остановки службы в командной строке можно, помимо прочего, передать имя экземпляра **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-295">If you are running multiple instances of **SQLdiag** on the same computer, you can also pass the **SQLdiag** instance name to on the command line when you stop the service.</span></span> <span data-ttu-id="4c943-296">Например, чтобы остановить экземпляр **SQLdiag** с именем Instance1, используйте следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="4c943-296">For example, to stop a **SQLdiag** instance named Instance1, use the following syntax:</span></span>  
  
```  
SQLDIAG STOP /A Instance1  
```  
  
> [!NOTE]  
>  <span data-ttu-id="4c943-297">**/A** — единственный параметр командной строки, который может использоваться вместе со **START**, **STOP**или **STOP_ABORT**.</span><span class="sxs-lookup"><span data-stu-id="4c943-297">**/A** is the only command-line argument that can be used with **START**, **STOP**, or **STOP_ABORT**.</span></span> <span data-ttu-id="4c943-298">Если нужно указать именованный экземпляр **SQLdiag** вместе с одной из команд управления службой, укажите **/A** в командной строке после команды управления, как показано в предыдущем примере синтаксиса.</span><span class="sxs-lookup"><span data-stu-id="4c943-298">If you need to specify a named instance of **SQLdiag** with one of the service control verbs, specify **/A** after the control verb on the command line as shown in the previous syntax example.</span></span> <span data-ttu-id="4c943-299">Если используются команды управления, они должны быть первыми аргументами в командной строке.</span><span class="sxs-lookup"><span data-stu-id="4c943-299">When control verbs are used, they must be the first argument on the command line.</span></span>  
  
 <span data-ttu-id="4c943-300">Чтобы остановить службу как можно быстрее, выполните в папке запуска программы команду **SQLDIAG STOP_ABORT** .</span><span class="sxs-lookup"><span data-stu-id="4c943-300">To stop the service as quickly as possible, run **SQLDIAG STOP_ABORT** in the utility startup folder.</span></span> <span data-ttu-id="4c943-301">Эта команда прерывает любой сбор диагностических данных, выполняемый в настоящее время, не ожидая его завершения.</span><span class="sxs-lookup"><span data-stu-id="4c943-301">This command aborts any diagnostics collecting currently being performed without waiting for them to finish.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4c943-302">Используйте **SQLDiag STOP** или **SQLDIAG STOP_ABORT** для остановки службы **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-302">Use **SQLDiag STOP** or **SQLDIAG STOP_ABORT** to stop the **SQLdiag** service.</span></span> <span data-ttu-id="4c943-303">Не используйте консоль служб Windows, чтобы остановить **SQLdiag** или другие службы [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4c943-303">Do not use the Windows Services Console to stop **SQLdiag** or other [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] services.</span></span>  
  
## <a name="automatically-starting-and-stopping-sqldiag"></a><span data-ttu-id="4c943-304">Автоматический запуск и остановка SQLdiag</span><span class="sxs-lookup"><span data-stu-id="4c943-304">Automatically Starting and Stopping SQLdiag</span></span>  
 <span data-ttu-id="4c943-305">Чтобы автоматически запускать и прекращать сбор диагностических данных в указанное время, используйте аргументы **/b**_start_time_ и **/e**_stop_time_ с использованием 24-часовой нотации.</span><span class="sxs-lookup"><span data-stu-id="4c943-305">To automatically start and stop diagnostic data collection at a specified time, use the **/B**_start_time_ and **/E**_stop_time_ arguments, using 24-hour notation.</span></span> <span data-ttu-id="4c943-306">Например, если нужно устранить неполадку, которая регулярно происходит приблизительно в 02:00:00, можно настроить **SQLdiag** таким образом, чтобы она автоматически начинала собирать диагностические данные в 01:00:00 и останавливалась в 03:00:00.</span><span class="sxs-lookup"><span data-stu-id="4c943-306">For example, if you are troubleshooting a problem that consistently appears at approximately 02:00:00, you can configure **SQLdiag** to automatically start collecting diagnostic data at 01:00 and automatically stop at 03:00:00.</span></span> <span data-ttu-id="4c943-307">Укажите аргументы **/B** и **/E** , чтобы указать время запуска и остановки.</span><span class="sxs-lookup"><span data-stu-id="4c943-307">Use the **/B** and **/E** arguments to specify the start and stop time.</span></span> <span data-ttu-id="4c943-308">Используйте 24-часовой формат времени, чтобы указать точную дату и время запуска и остановки в формате ГГГГММДД_ЧЧ:ММ:СС.</span><span class="sxs-lookup"><span data-stu-id="4c943-308">Use 24-hour notation to specify an exact start and stop date and time with the format YYYYMMDD_HH:MM:SS.</span></span> <span data-ttu-id="4c943-309">Чтобы указать относительное время запуска или остановки, поставьте в начале времени запуска и остановки **+** и не указывайте составляющую даты (ГГГГММДД_), как показано в следующем примере, где программа **SQLdiag** ждет 1 час перед началом сбора сведений, затем собирает сведения в течение 3 часов и завершает работу.</span><span class="sxs-lookup"><span data-stu-id="4c943-309">To specify a relative start or stop time, prefix the start and stop time with **+** and omit the date portion (YYYYMMDD_) as shown in the following example, which causes **SQLdiag** to wait 1 hour before it starts collecting information, then it collects information for 3 hours before it stops and exits:</span></span>  
  
```  
sqldiag /B +01:00:00 /E +03:00:00  
```  
  
 <span data-ttu-id="4c943-310">Если указано относительное *start_time* , **SQLdiag** запустится в момент времени, вычисляемый относительно текущей даты и времени.</span><span class="sxs-lookup"><span data-stu-id="4c943-310">When a relative *start_time* is specified, **SQLdiag** starts at a time that is relative to the current date and time.</span></span> <span data-ttu-id="4c943-311">Если указано относительное *end_time* , **SQLdiag** завершит работу в момент времени, вычисляемый относительно указанного *start_time*.</span><span class="sxs-lookup"><span data-stu-id="4c943-311">When a relative *end_time* is specified, **SQLdiag** ends at a time that is relative to the specified *start_time*.</span></span> <span data-ttu-id="4c943-312">Если указать время запуска или окончания, которое уже прошло, **SQLdiag** принудительно изменит дату запуска таким образом, что дата и время запуска будут находиться в будущем.</span><span class="sxs-lookup"><span data-stu-id="4c943-312">If the start or end date and time that you have specified is in the past, **SQLdiag** forcibly changes the start date so that the start date and time are in the future.</span></span>  
  
 <span data-ttu-id="4c943-313">В силу этой особенности выбираемые даты запуска и завершения работы имеют большое значение.</span><span class="sxs-lookup"><span data-stu-id="4c943-313">This has important implications on the start and end dates you choose.</span></span> <span data-ttu-id="4c943-314">Рассмотрим следующий пример:</span><span class="sxs-lookup"><span data-stu-id="4c943-314">Consider the following example:</span></span>  
  
```  
sqldiag /B +01:00:00 /E 08:30:00  
```  
  
 <span data-ttu-id="4c943-315">Если текущее время — 08:00, время завершения работы наступит прежде, чем начнется сбор диагностических данных.</span><span class="sxs-lookup"><span data-stu-id="4c943-315">If the current time is 08:00, the end time passes before diagnostic collection actually begins.</span></span> <span data-ttu-id="4c943-316">Поскольку **SQLdiag** автоматически прибавляет к дате запуска и завершения работы один день в случае, если время уже просрочено, в этом примере сбор диагностических сведений начнется в 09:00 текущего дня (относительное время запуска было указано с помощью префикса **+** ) и продолжится до 08:30 следующего утра.</span><span class="sxs-lookup"><span data-stu-id="4c943-316">Because **SQLDiag** automatically adjusts start and end dates to the next day when they occur in the past, in this example diagnostic collection starts at 09:00 today (a relative start time has been specified with **+**) and continues collecting until 08:30 the following morning.</span></span>  
  
### <a name="stopping-and-restarting-sqldiag-to-collect-daily-diagnostics"></a><span data-ttu-id="4c943-317">Остановка и перезапуск SQLdiag для сбора ежедневных диагностических сведений</span><span class="sxs-lookup"><span data-stu-id="4c943-317">Stopping and Restarting SQLdiag to Collect Daily Diagnostics</span></span>  
 <span data-ttu-id="4c943-318">Для сбора указанного набора диагностических сведений ежедневно, без запуска и остановки **SQLdiag**вручную, используйте аргумент **/L** .</span><span class="sxs-lookup"><span data-stu-id="4c943-318">To collect a specified set of diagnostics on a daily basis without having to manually start and stop **SQLdiag**, use the **/L** argument.</span></span> <span data-ttu-id="4c943-319">Аргумент **/L** вызывает выполнение **SQLdiag** в непрерывном режиме с автоматическим перезапуском после запланированного завершения.</span><span class="sxs-lookup"><span data-stu-id="4c943-319">The **/L** argument causes **SQLdiag** to run continuously by automatically restarting itself after a scheduled shutdown.</span></span> <span data-ttu-id="4c943-320">Если указан аргумент **/L** , а программа **SQLdiag** останавливается, так как наступило время завершения работы, указанное в аргументе **/E** , или программа выполнялась в режиме моментального снимка, заданном аргументом **/X** , то **SQLdiag** перезапустится вместо завершения работы.</span><span class="sxs-lookup"><span data-stu-id="4c943-320">When **/L** is specified, and **SQLdiag** stops because it has reached the end time specified with the **/E** argument, or it stops because it is being run in snapshot mode by using the **/X** argument, **SQLdiag** restarts instead of exiting.</span></span>  
  
 <span data-ttu-id="4c943-321">В следующем примере указано, что **SQLdiag** запускается в непрерывном режиме для автоматического перезапуска после сбора диагностических данных, происходящего между 03:00:00 и 05:00:00.</span><span class="sxs-lookup"><span data-stu-id="4c943-321">The following example specifies that **SQLdiag** run in continuous mode to automatically restart after diagnostic data collecting occurs between 03:00:00 and 05:00:00.</span></span>  
  
```  
sqldiag /B 03:00:00 /E 05:00:00 /L  
```  
  
 <span data-ttu-id="4c943-322">В следующем примере указано, что **SQLdiag** запускается в непрерывном режиме для автоматического перезапуска после создания моментального снимка диагностических данных в 03:00:00.</span><span class="sxs-lookup"><span data-stu-id="4c943-322">The following example specifies that **SQLdiag** run in continuous mode to automatically restart after taking a diagnostic data snapshot at 03:00:00.</span></span>  
  
```  
sqldiag /B 03:00:00 /X /L  
```  
  
## <a name="running-sqldiag-as-a-service"></a><span data-ttu-id="4c943-323">Работа программы SQLdiag в качестве службы</span><span class="sxs-lookup"><span data-stu-id="4c943-323">Running SQLdiag as a Service</span></span>  
 <span data-ttu-id="4c943-324">Если вы хотите использовать **SQLdiag** для сбора диагностических данных в течение длительных промежутков времени, во время которых может понадобиться выходить из системы компьютера, на котором выполняется **SQLdiag** , можно запустить ее как службу.</span><span class="sxs-lookup"><span data-stu-id="4c943-324">When you want to use **SQLdiag** to collect diagnostic data for long periods of time during which you might need to log out of the computer on which **SQLdiag** is running, you can run it as a service.</span></span>  
  
 <span data-ttu-id="4c943-325">**Регистрация программы SQLDiag для запуска в качестве службы**</span><span class="sxs-lookup"><span data-stu-id="4c943-325">**To register SQLDiag to run as a service**</span></span>  
  
 <span data-ttu-id="4c943-326">Программу **SQLdiag** можно зарегистрировать для запуска в качестве службы, указав в командной строке аргумент **/R** .</span><span class="sxs-lookup"><span data-stu-id="4c943-326">You can register **SQLdiag** to run as a service by specifying the **/R** argument at the command line.</span></span> <span data-ttu-id="4c943-327">Таким образом, **SQLDiag** регистрируется для запуска в качестве службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-327">This registers **SQLdiag** to run as a service.</span></span> <span data-ttu-id="4c943-328">Имя службы **SQLdiag** — SQLDIAG.</span><span class="sxs-lookup"><span data-stu-id="4c943-328">The **SQLdiag** service name is SQLDIAG.</span></span> <span data-ttu-id="4c943-329">Любые другие аргументы, указанные в командной строке при регистрации **SQLdiag** в качестве службы, сохраняются и используются всякий раз при запуске службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-329">Any other arguments you specify on the command line when you register **SQLDiag** as a service are preserved and reused when the service is started.</span></span>  
  
 <span data-ttu-id="4c943-330">Чтобы изменить имя службы по умолчанию SQLDIAG, используйте параметр командной строки **/A** и укажите другое имя.</span><span class="sxs-lookup"><span data-stu-id="4c943-330">To change the default SQLDIAG service name, use the **/A** command-line argument to specify another name.</span></span> <span data-ttu-id="4c943-331">Программа**SQLdiag** автоматически добавляет префикс DIAG$ к любому имени экземпляра **SQLdiag** , указанному с помощью **/A** , чтобы получить понятное имя службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-331">**SQLdiag** automatically prefixes DIAG$ to any **SQLdiag** instance name specified with **/A** to create sensible service names.</span></span>  
  
 <span data-ttu-id="4c943-332">**Отмена регистрации службы SQLDIAG**</span><span class="sxs-lookup"><span data-stu-id="4c943-332">**To unregister the SQLDIAG service**</span></span>  
  
 <span data-ttu-id="4c943-333">Чтобы отменить регистрацию службы, укажите аргумент **/U** .</span><span class="sxs-lookup"><span data-stu-id="4c943-333">To unregister the service, specify the **/U** argument.</span></span> <span data-ttu-id="4c943-334">При отмене регистрации программы **SQLdiag** в качестве службы из реестра Windows удаляются разделы реестра этой службы.</span><span class="sxs-lookup"><span data-stu-id="4c943-334">Unregistering **SQLdiag** as a service also deletes the Windows registry keys of the service.</span></span>  
  
 <span data-ttu-id="4c943-335">**Запуск или перезапуск службы SQLDIAG**</span><span class="sxs-lookup"><span data-stu-id="4c943-335">**To start or restart the SQLDIAG service**</span></span>  
  
 <span data-ttu-id="4c943-336">Чтобы запустить или перезапустить службу SQLDIAG, запустите в командной строке **SQLDiag START** .</span><span class="sxs-lookup"><span data-stu-id="4c943-336">To start or restart the SQLDIAG service, run **SQLDiag START** from the command line.</span></span>  
  
 <span data-ttu-id="4c943-337">Если работает несколько экземпляров **SQLdiag** , при запуске службы с помощью аргумента **/A** в командной строке можно передать имя экземпляра **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="4c943-337">If you are running multiple instances of **SQLdiag** by using the **/A** argument, you can also pass the **SQLdiag** instance name on the command line when you start the service.</span></span> <span data-ttu-id="4c943-338">Например, чтобы запустить экземпляр **SQLdiag** с именем Instance1, используйте следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="4c943-338">For example, to start a **SQLdiag** instance named Instance1, use the following syntax:</span></span>  
  
```  
SQLDIAG START /A Instance1  
```  
  
 <span data-ttu-id="4c943-339">Также для запуска службы SQLDIAG можно использовать команду **net start** .</span><span class="sxs-lookup"><span data-stu-id="4c943-339">You can also use the **net start** command to start the SQLDIAG service.</span></span>  
  
 <span data-ttu-id="4c943-340">Во время перезапуска программы **SQLdiag**она перезаписывает содержимое текущей выходной папки.</span><span class="sxs-lookup"><span data-stu-id="4c943-340">When you restart **SQLdiag**, it overwrites the contents in the current output folder.</span></span> <span data-ttu-id="4c943-341">Чтобы избежать этого, укажите в командной строке **/N 2** , чтобы переименовать выходную папку при запуске программы.</span><span class="sxs-lookup"><span data-stu-id="4c943-341">To avoid this, specify **/N 2** on the command line to rename the output folder when the utility starts.</span></span>  
  
 <span data-ttu-id="4c943-342">Приостановка службы **SQLdiag** не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="4c943-342">Pausing the **SQLdiag** service is not supported.</span></span>  
  
## <a name="running-multiple-instances-of-sqldiag"></a><span data-ttu-id="4c943-343">Работа нескольких экземпляров программы SQLdiag</span><span class="sxs-lookup"><span data-stu-id="4c943-343">Running Multiple Instances of SQLdiag</span></span>  
 <span data-ttu-id="4c943-344">Запустите несколько экземпляров программы **SQLdiag** на одном компьютере, указав **/a**_SQLdiag_application_name_ в командной строке.</span><span class="sxs-lookup"><span data-stu-id="4c943-344">Run multiple instances of **SQLdiag** on the same computer by specifying **/A**_SQLdiag_application_name_ on the command line.</span></span> <span data-ttu-id="4c943-345">Это полезно для одновременного сбора различных наборов диагностических сведений для одного экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4c943-345">This is useful for collecting different sets of diagnostics simultaneously from the same [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="4c943-346">Например, именованный экземпляр **SQLdiag** можно настроить на непрерывное выполнение сбора небольшого количества данных.</span><span class="sxs-lookup"><span data-stu-id="4c943-346">For example, you can configure a named instance of **SQLdiag** to continuously perform lightweight data collection.</span></span> <span data-ttu-id="4c943-347">Тогда в случае возникновения определенной проблемы в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]можно запустить экземпляр **SQLdiag** по умолчанию, чтобы собрать диагностические данные об этой проблеме или собрать набор диагностических данных, запрошенных службами поддержки пользователей [!INCLUDE[msCoName](../includes/msconame-md.md)] для диагностики проблемы.</span><span class="sxs-lookup"><span data-stu-id="4c943-347">Then, if a specific problem occurs on [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], you can run the default **SQLdiag** instance to collect diagnostics for that problem, or to gather a set of diagnostics that [!INCLUDE[msCoName](../includes/msconame-md.md)] Customer Support Services has asked you to gather to diagnose a problem.</span></span>  
  
## <a name="collecting-diagnostic-data-from-clustered-sql-server-instances"></a><span data-ttu-id="4c943-348">Сбор диагностических данных из кластеризованных экземпляров SQL Server</span><span class="sxs-lookup"><span data-stu-id="4c943-348">Collecting Diagnostic Data from Clustered SQL Server Instances</span></span>  
 <span data-ttu-id="4c943-349">Программа**SQLdiag** поддерживает сбор диагностических данных из кластеризованных экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="4c943-349">**SQLdiag** supports collecting diagnostic data from clustered [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instances.</span></span> <span data-ttu-id="4c943-350">Для сбора диагностических данных из кластеризованных экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] убедитесь, что в качестве атрибута **name** элемента **\<Machine>** в файле конфигурации SQLDiag.Xml указан символ **.** , и не указывайте аргумент командной строки **/G**.</span><span class="sxs-lookup"><span data-stu-id="4c943-350">To gather diagnostics from clustered [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instances, make sure that **"."** is specified for the **name** attribute of the **\<Machine>** element in the configuration file SQLDiag.Xml and do not specify the **/G** argument on the command line.</span></span> <span data-ttu-id="4c943-351">По умолчанию для атрибута **name** в файле конфигурации указывается символ **"."** , а аргумент **/G** отключен.</span><span class="sxs-lookup"><span data-stu-id="4c943-351">By default, **"."** is specified for the **name** attribute in the configuration file and the **/G** argument is turned off.</span></span> <span data-ttu-id="4c943-352">Как правило, при сборе данных из кластеризованных экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] не нужно изменять файл конфигурации или аргументы командной строки.</span><span class="sxs-lookup"><span data-stu-id="4c943-352">Typically, you do not need to edit the configuration file or change the command line arguments when collecting from a clustered [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instance.</span></span>  
  
 <span data-ttu-id="4c943-353">Если в качестве имени компьютера указан символ **.** , то программа **SQLdiag** определяет, что она выполняется на кластере, и одновременно получает диагностические сведения для всех виртуальных экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , установленных в этом кластере.</span><span class="sxs-lookup"><span data-stu-id="4c943-353">When **"."** is specified as the machine name, **SQLdiag** detects that it is running on a cluster, and simultaneously retrieves diagnostic information from all virtual instances of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] that are installed on the cluster.</span></span> <span data-ttu-id="4c943-354">Если нужно собрать диагностические сведения только для одного виртуального экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], выполняемого на компьютере, укажите этот виртуальный экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] в качестве атрибута **name** элемента **\<Machine>** в файле SQLDiag.Xml.</span><span class="sxs-lookup"><span data-stu-id="4c943-354">If you want to collect diagnostic information from only one virtual instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] that is running on a computer, specify that virtual [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] for the **name** attribute of the **\<Machine>** element in SQLDiag.Xml.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4c943-355">Для сбора сведений о трассировках приложения [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] от кластеризованных экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] на кластере должны быть доступны административные общие папки (ADMIN$).</span><span class="sxs-lookup"><span data-stu-id="4c943-355">To collect [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] trace information from clustered [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instances, administrative shares (ADMIN$) must be enabled on the cluster.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4c943-356">См. также:</span><span class="sxs-lookup"><span data-stu-id="4c943-356">See Also</span></span>  
 [<span data-ttu-id="4c943-357">Справочник по программе командной строки (Database Engine)</span><span class="sxs-lookup"><span data-stu-id="4c943-357">Command Prompt Utility Reference &#40;Database Engine&#41;</span></span>](command-prompt-utility-reference-database-engine.md)  
  
  
