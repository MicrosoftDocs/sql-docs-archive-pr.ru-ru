---
title: Программа osql | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: tools-other
ms.topic: conceptual
helpviewer_keywords:
- statements [SQL Server], command prompt
- QUIT command
- Transact-SQL statements, command prompt
- EXIT command
- operating systems [SQL Server], commands
- osql utility [SQL Server]
- stored procedures [SQL Server], command prompt
- scripts [SQL Server], command prompt
- RESET command
- GO command
- command prompt utilities [SQL Server], osql
- CTRL+C command
ms.assetid: cf530d9e-0609-4528-8975-ab8e08e40b9a
author: stevestein
ms.author: sstein
ms.openlocfilehash: 95782afe0de8567781316e3478d04a090f968ed5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87727617"
---
# <a name="osql-utility"></a>Программа osql
  Программа **osql** позволяет вводить инструкции [!INCLUDE[tsql](../includes/tsql-md.md)] , системные процедуры и файлы скриптов. Для связи с сервером эта программа использует ODBC.  
  
> [!IMPORTANT]  
>  Эта функция будет исключена из будущей версии [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Не используйте эту функцию в новых разработках и планируйте изменение приложений, которые используют ее в данный момент. Вместо этого используйте **sqlcmd** . Дополнительные сведения см. в статье [sqlcmd Utility](sqlcmd-utility.md).  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
      osql  
[-?] |  
[-L] |  
[  
  {  
     {-Ulogin_id [-Ppassword]} | -E }  
     [-Sserver_name[\instance_name]] [-Hwksta_name] [-ddb_name]  
     [-ltime_out] [-ttime_out] [-hheaders]  
     [-scol_separator] [-wcolumn_width] [-apacket_size]  
     [-e] [-I] [-D data_source_name]  
     [-ccmd_end] [-q "query"] [-Q"query"]  
     [-n] [-merror_level] [-r {0 | 1}]  
     [-iinput_file] [-ooutput_file] [-p]  
     [-b] [-u] [-R] [-O]  
]  
```  
  
## <a name="arguments"></a>Аргументы  
 **-?**  
 Отображает сводку по синтаксису параметров программы **osql** .  
  
 **-L**  
 Выводит список локально настроенных серверов и имена серверов, осуществляющих трансляцию данных в сети.  
  
> [!NOTE]  
>  Из-за особенностей широковещательной передачи в сетях программа **osql** может не получить своевременный ответ от всех серверов. Поэтому возвращаемый список серверов может меняться при каждом вызове этого параметра.  
  
 **-U** _идентификатор_для_входа_  
 Идентификатор входа пользователя. Идентификаторы входа зависят от регистра.  
  
 **-P** _пароль_  
 Пароль, задаваемый пользователем. Если параметр **-P** не указан, программа **osql** запрашивает пароль. Если параметр **-P** указывается в конце командной строки без указания пароля, то программа **osql** использует пароль по умолчанию (NULL).  
  
> [!IMPORTANT]  
>  Не используйте пустые пароли. Выбирайте надежные пароли. Дополнительные сведения см. в разделе [Strong Passwords](../relational-databases/security/strong-passwords.md).  
  
 В паролях учитывается регистр символов.  
  
 Переменная среды OSQLPASSWORD позволяет установить значение пароля по умолчанию для текущего сеанса. Поэтому нет необходимости вписывать пароль в пакетные файлы.  
  
 Если пароль не указан с помощью параметра **-P** , программа **osql** сначала проверяет переменную OSQLPASSWORD. Если значение переменной не задано, программа **osql** использует пароль по умолчанию (NULL). В следующем примере задается значение переменной OSQLPASSWORD в командной строке, а затем запускается программа **osql** :  
  
```  
C:\>SET OSQLPASSWORD=abracadabra  
C:\>osql   
```  
  
> [!IMPORTANT]  
>  Чтобы скрыть пароль, не указывайте параметр **-P** вместе с параметром **-U** . Вместо этого после ввода команды **osql** с параметром **-U** и другими параметрами (не задавайте **-P**) нажмите клавишу ВВОД, и программа **osql** предложит ввести пароль. Этот метод обеспечивает скрытие пароля при вводе.  
  
 **-E**  
 Использует доверительное соединение вместо запроса пароля.  
  
 **-S** _server_name_[ **\\** _instance_name_]  
 Указывает экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] для подключения. Укажите значение *имя_сервера* , чтобы подключиться к экземпляру компонента [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] по умолчанию на этом сервере. Укажите _server_name_ **\\** _instance_name_ для подключения к именованному экземпляру [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] служб на этом сервере. Если сервер не указан, программа **osql** устанавливает подключение к используемому по умолчанию экземпляру [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] на локальном компьютере. Этот параметр необходим при выполнении программы **osql** с удаленного компьютера в сети.  
  
 **-H** _имя_wksta_  
 Имя рабочей станции. Имя рабочей станции хранится в **sysprocesses.hostname** и выводится процедурой **sp_who**. Если этот параметр не указан, используется текущее имя компьютера.  
  
 **-d** _имя_базы данных_  
 Выдает инструкцию USE *db_name* при запуске программы **osql**.  
  
 **-l** _время_ожидания_  
 Указывает время ожидания входа для программы **osql** (в секундах). По умолчанию время ожидания входа для программы **osql** составляет 8 секунд.  
  
 **-t** _время_ожидания_  
 Указывает время ожидания для выполнения команды (в секундах). Если значение *время_ожидания* не указано, команды имеют неограниченное время ожидания.  
  
 **-h** _заголовки_  
 Указывает количество строк для печати между заголовками столбцов. По умолчанию заголовки печатаются один раз для каждого набора результатов запроса. Чтобы не печатать заголовки, укажите значение -1. При использовании значения -1 между параметром и значением не должно быть пробела ( **-h-1**, а не **-h -1**).  
  
 **-s** _разделитель_столбцов_  
 Указывает символ-разделитель столбцов, по умолчанию — пробел. Чтобы использовать символы, имеющие специальное значение для операционной системы (например, |; & \< > ), заключите этот символ в двойные кавычки (").  
  
 **-w** _ширина_столбца_  
 Позволяет пользователю устанавливать ширину экрана для выводимых данных. Значение по умолчанию составляет 80 символов. Когда строка вывода достигает максимальной ширины экрана, она разбивается на несколько строк.  
  
 **-a** _размер_пакета_  
 Позволяет запросить пакет нестандартного размера. Допустимые значения для *размер_пакета* лежат в диапазоне от 512 до 65 535. Значение по умолчанию **osql** — это параметр сервера по умолчанию. Увеличенный размер пакета может увеличить производительность при выполнении большого скрипта со значительным количеством инструкций SQL между командами GO. [!INCLUDE[msCoName](../includes/msconame-md.md)] показывает, что при установке значения 8192 массовое копирование обычно происходит с максимальной скоростью. Можно запросить больший размер пакета, но программа **osql** использует значение сервера по умолчанию, если выполнить запрос невозможно.  
  
 **-e**  
 Отображает вводимые данные на экране.  
  
 **-I**  
 Включает параметр соединения QUOTED_IDENTIFIER.  
  
 **-D** _имя_источника_данных_  
 Выполняет подключение к источнику данных ODBC, который определен с помощью драйвера ODBC для [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Подключение **osql** использует параметры, указанные в источнике данных.  
  
> [!NOTE]  
>  Этот параметр не работает с источниками данных, определенными для других драйверов.  
  
 **-c** _завершение_cmd_  
 Указывает признак конца команды. По умолчанию команды заканчиваются и отправляются в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] с помощью ввода GO в отдельной строке. При сбросе признака конца команды не используйте зарезервированные слова [!INCLUDE[tsql](../includes/tsql-md.md)] или символы, которые имеют специальное значение для операционной системы независимо от того, указана ли перед ними обратная косая черта.  
  
 **-q "** _запрос_ **"**  
 Выполняет запрос при запуске программы **osql** , но не закрывает программу **osql** по завершении запроса. (Обратите внимание, что инструкция запроса не должна содержать GO.) При выполнении запроса из пакетного файла используйте синтаксис %переменные или %переменные среды%. Пример:  
  
```  
SET table=sys.objects  
osql -E -q "select name, object_id from %table%"  
```  
  
 Используйте двойные кавычки для запроса и одинарные кавычки для выражений, внедренных в запрос.  
  
 **-Q"** _запрос_ **"**  
 Выполняет запрос и сразу же закрывает программу **osql**. Используйте двойные кавычки для запроса и одинарные кавычки для выражений, внедренных в запрос.  
  
 **-n**  
 Удаляет нумерацию и символ приглашения (>) из строк ввода.  
  
 **-m** _уровень_ошибки_  
 Настраивает отображение сообщений об ошибках. Номер сообщения, состояние и уровень ошибки отображаются для ошибок указанного или более высокого уровня серьезности. Сообщения для ошибок, у которых уровень серьезности меньше заданного, не отображаются. Используйте значение **-1** , чтобы указать, что все заголовки должны возвращаться с сообщениями, даже с информационными. При использовании значения **-1**между параметром и значением не должно быть пробела ( **-m-1**, а не **-m -1**).  
  
 **-r** { **0**| **1**}  
 Перенаправляет вывод сообщений на экран (**stderr**). Если параметр не указан, или если указано значение **0**, происходит перенаправление только сообщений об ошибках с уровнем серьезности 11 и выше. Если указать значение **1**, то происходит перенаправление всех выводимых сообщений (включая сообщения для вывода на печать).  
  
 **-i** _входной_файл_  
 Указывает файл, содержащий пакет инструкций или хранимых процедур SQL. Оператор сравнения "меньше" ( **\<** ) можно использовать вместо параметра **-i**.  
  
 **-o** _выходной_файл_  
 Указывает файл, в который поступают выходные данные программы **osql**. Оператор сравнения "больше" ( **>** ) можно использовать вместо параметра **-o**.  
  
 Если *входной_файл* имеет формат, отличный от Юникода, а параметр **-u** не указан, то файл *выходной_файл* сохраняется в формате OEM. Если файл *входной_файл* имеет формат Юникода или параметр **-u** указан, то файл *выходной_файл* сохраняется в формате Юникод.  
  
 **-p**  
 Выводит статистику производительности.  
  
 **-b**  
 Указывает, что в случае ошибки программа **osql** завершает работу и возвращает значение DOS ERRORLEVEL. Значение, возвращаемое в переменную DOS ERRORLEVEL, равно 1, если сообщение об ошибке [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] имеет степень серьезности выше 11. В противном случае возвращаемое значение равно 0. [!INCLUDE[msCoName](../includes/msconame-md.md)] Пакетные файлы MS-DOS можно использовать для проверки значения DOS ERRORLEVEL и для обработки ошибки соответствующим образом.  
  
 **-u**  
 Указывает, что *выходной_файл* хранится в Юникоде независимо от формата файла *входной_файл*.  
  
 **-R**  
 Указывает, что драйвер ODBC [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] использует настройки клиента при преобразовании данных в денежном формате, формате даты и времени в символьные данные.  
  
 **-O**  
 Указывает, что определенные возможности программы **osql** будут отключены для совместимости с более ранними версиями программы **isql**. Будут отключены следующие функции.  
  
-   Пакетная обработка окончания файла  
  
-   Автоматическое масштабирование ширины консоли  
  
-   Длинные сообщения  
  
 Этот параметр также устанавливает значения ERRORLEVEL DOS по умолчанию, равное -1.  
  
> [!NOTE]  
>  Программа **osql**больше не поддерживает параметры **-n** , **-O** и **-D**.  
  
## <a name="remarks"></a>Remarks  
 Программа **osql** запускается непосредственно из операционной системы с перечисленными ниже параметрами, в которых учитывается регистр символов. После запуска программа **osql**принимает инструкции SQL и интерактивно передает их [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . Результаты форматируются и выводятся на экране (**stdout**). Для выхода из программы **osql**используются команды QUIT или EXIT.  
  
 Если не указать имя пользователя при запуске программы **osql**, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] проверяет переменные среды и использует их, например **osqluser = ( *`user`* )** или **osqlserver = ( *`server`* )**. Если переменные среды не установлены, используется имя пользователя рабочей станции. Если не указан сервер, используется имя рабочей станции.  
  
 Если параметры **-U** и **-P** не используются, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] пытается установить подключение с помощью режима проверки подлинности [!INCLUDE[msCoName](../includes/msconame-md.md)] Windows. Проверка подлинности основана на учетной записи пользователя [!INCLUDE[msCoName](../includes/msconame-md.md)] Windows, запустившего программу **osql**.  
  
 Программа **osql** использует API ODBC. Эта программа использует настройки драйвера ODBC [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] по умолчанию для параметров соединения ISO в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . Дополнительные сведения см. в разделе «Влияние параметров ANSI».  
  
> [!NOTE]  
>  Программа **osql** не поддерживает определяемые пользователем типы данных среды CLR. Для обработки этих типов данных следует использовать программу **sqlcmd** . Дополнительные сведения см. в статье [sqlcmd Utility](sqlcmd-utility.md).  
  
## <a name="osql-commands"></a>Команды OSQL  
 Помимо инструкций [!INCLUDE[tsql](../includes/tsql-md.md)] в программе **osql**также доступны следующие команды.  
  
|Get-Help|Описание|  
|-------------|-----------------|  
|GO|Выполняет все инструкции, введенные после последней команды GO.|  
|RESET|Очищает все введенные инструкции.|  
|QUIT или EXIT( )|Завершение работы программы **osql**.|  
|CTRL+C|Завершает запрос без выхода из программы **osql**.|  
  
> [!NOTE]  
>  Команды !! и ED больше не поддерживаются программой **osql**.  
  
 Признаки конца команды GO (по умолчанию), RESET, EXIT, QUIT и CTRL+C распознаются только в начале строки, сразу после запроса программы **osql** .  
  
 GO обозначает конец пакетного файла и исполнения любых кэшированных инструкций [!INCLUDE[tsql](../includes/tsql-md.md)] . При нажатии клавиши ВВОД в конце каждой строки ввода программа **osql** выполняет кэширование инструкций из этой строки. При нажатии клавиши ВВОД после ввода команды GO все текущие инструкции в кэше отправляются в виде пакета в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].  
  
 Последняя версия программы **osql** работает таким образом, как будто в конце любого выполняемого скрипта имеется подразумеваемая инструкция GO, поэтому выполняются все инструкции скрипта.  
  
 Закончите команду с помощью ввода строки, которая начинается с признака конца команды. Следом за признаком конца команды можно ввести целое число, чтобы указать, сколько раз выполнить команду. Например, чтобы выполнить эту команду 100 раз, введите:  
  
```  
SELECT x = 1  
GO 100  
```  
  
 Результаты выводятся на печать один раз после завершения. Программа**osql** не принимает более 1000 символов в одной строке. Большие инструкции должны вводиться в несколько строк.  
  
 Для повторного вызова и изменения инструкций **osql** могут использоваться средства повторного вызова команд Windows. Существующий буфер запросов можно очистить с помощью команды RESET.  
  
 При запуске хранимых процедур программа **osql** выводит пустую строку между результирующими наборами в пакете. Кроме того, сообщение «обработано строк: 0» не выводится, если оно не применимо к выполненной инструкции.  
  
## <a name="using-osql-interactively"></a>Применение программы osql в интерактивном режиме  
 Чтобы использовать программу **osql** в интерактивном режиме, введите команду **osql** (и любые параметры) в командной строке.  
  
 Файл, содержащий запрос (например, Stores.qry), можно загрузить в программу **osql** и выполнить, введя команду следующего вида:  
  
```  
osql -E -i stores.qry  
```  
  
 Можно считать запрос из файла (например, Titles.qry) и направить результаты в другой файл, введя команду, подобную следующей:  
  
```  
osql -E -i titles.qry -o titles.res  
```  
  
> [!IMPORTANT]  
>  По возможности используйте параметр **-E**(доверительное соединение).  
  
 При использовании программы **osql** в интерактивном режиме можно прочитать файл операционной системы в буфер команд с помощью команды **: r**_file_name_. Это приведет к отправке скрипта SQL в файле с именем *имя_файла* непосредственно на сервер в виде единого пакета.  
  
> [!NOTE]  
>  Если при использовании программы **osql**в файле скрипта SQL содержится разделитель пакетов GO, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] воспринимает его как синтаксическую ошибку.  
  
## <a name="inserting-comments"></a>Вставка примечаний  
 В инструкцию Transact-SQL, отправляемую программой [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] osql **в**, можно включать комментарии. Допускаются два типа стиля комментариев: -- и /*…\*/.  
  
## <a name="using-exit-to-return-results-in-osql"></a>Использование инструкции EXIT для возвращения результатов программы osql  
 Результат выполнения инструкции SELECT можно использовать в качестве возвращаемого программой **osql**значения. Если тип числовой, то последний столбец последней строки результатов преобразуется в 4-байтовое целое число (long). В MS-DOS младший байт передается родительскому процессу или уровню ошибки операционной системы. Windows передает все 4-байтовое целое число. Синтаксис:  
  
```  
EXIT ( < query > )  
```  
  
 Пример:  
  
```  
EXIT(SELECT @@ROWCOUNT)  
```  
  
 В пакетный файл также можно включить параметр EXIT. Пример:  
  
```  
osql -E -Q "EXIT(SELECT COUNT(*) FROM '%1')"  
```  
  
 Программа **osql** передает на сервер все содержимое, которое заключено в круглые скобки **()** , точно в таком виде, в котором оно введено. Если хранимая системная процедура выбирает набор и возвращает значение, то возвращается только выбранный набор. Инструкция EXIT **()** без выражения в круглых скобках выполняет все, что предшествует ей в пакете, и затем завершается, не возвращая значения.  
  
 Существуют четыре формата инструкции EXIT:  
  
-   EXIT  
  
> [!NOTE]  
>  Не выполняет пакет, немедленно завершает работу и не возвращает значение.  
  
-   EXIT **()**  
  
> [!NOTE]  
>  Выполняет пакет, завершает выполнение и не возвращает значения.  
  
-   EXIT **( *`query`* )**  
  
> [!NOTE]  
>  Выполняет пакет, включая запрос, затем возвращает результаты запроса и завершает работу.  
  
-   RAISERROR с состоянием 127  
  
> [!NOTE]  
>  Если в скрипте **osql** используется RAISERROR и при этом возникает состояние 127, программа **osql** завершает выполнение и возвращает клиенту идентификатор сообщения. Пример:  
  
```  
RAISERROR(50001, 10, 127)  
```  
  
 Эта ошибка приведет к завершению скрипта **osql** , при этом клиенту будет возвращен идентификатор сообщения 50001.  
  
 Возвращаемые значения от -1 до -99 зарезервированы для [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Программа **osql** определяет следующие значения:  
  
-   –100  
  
     Перед выбором возвращаемого значения произошла ошибка.  
  
-   –101  
  
     При выборе возвращаемого значения не найдены строки.  
  
-   –102  
  
     При выборе возвращаемого значения произошла ошибка преобразования.  
  
## <a name="displaying-money-and-smallmoney-data-types"></a>Отображение типов данных money и smallmoney  
 **osql** отображает `money` `smallmoney` типы данных и с двумя десятичными разрядами, хотя [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] сохраняет значение внутренне с четырьмя десятичными разрядами. Рассмотрим пример:  
  
```  
SELECT CAST(CAST(10.3496 AS money) AS decimal(6, 4))  
GO  
```  
  
 Эта инструкция вернет `10.3496`— это означает, что значение хранится без сокращения количества десятичных разрядов.  
  
## <a name="see-also"></a>См. также:  
 [Комментарий (MDX)](/sql/mdx/comment-mdx)   
 [-- (Комментарий) (MDX)](/sql/mdx/comment-mdx)   
 [Функции CAST и CONVERT (Transact-SQL)](/sql/t-sql/functions/cast-and-convert-transact-sql)   
 [RAISERROR (Transact-SQL)](/sql/t-sql/language-elements/raiserror-transact-sql)  
  
  
