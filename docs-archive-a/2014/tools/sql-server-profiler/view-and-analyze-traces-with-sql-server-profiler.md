---
title: Просмотр и анализ трассировок с помощью приложения SQL Server Profiler | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: profiler
ms.topic: conceptual
helpviewer_keywords:
- Profiler [SQL Server Profiler], viewing traces
- SQL Server Profiler, viewing traces
- traces [SQL Server], viewing
- SQL Server Profiler, troubleshooting
- troubleshooting [SQL Server], traces
- events [SQL Server], finding inside trace
- Profiler [SQL Server Profiler], troubleshooting
- traces [SQL Server], events
ms.assetid: 17e821ca-a12e-4192-acc1-96765d9ae266
author: stevestein
ms.author: sstein
ms.openlocfilehash: b3e848fe9a07d838631eef1737c2a7679b67e649
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87657439"
---
# <a name="view-and-analyze-traces-with-sql-server-profiler"></a><span data-ttu-id="dfa7b-102">Просмотр и анализ трассировок с помощью приложения SQL Server Profiler</span><span class="sxs-lookup"><span data-stu-id="dfa7b-102">View and Analyze Traces with SQL Server Profiler</span></span>
  <span data-ttu-id="dfa7b-103">Просмотр данных событий, перехваченных при трассировке с помощью программы [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="dfa7b-103">Use [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to view captured event data in a trace.</span></span> [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] <span data-ttu-id="dfa7b-104">отображает данные с учетом определенных свойств трассировки.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-104">displays data based on defined trace properties.</span></span> <span data-ttu-id="dfa7b-105">Одним способом анализа данных сервера [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] является их копирование в другую программу, например в сервер [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или в помощник по настройке ядра СУБД [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="dfa7b-105">One way to analyze [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data is to copy the data to another program, such as [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] or [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor.</span></span> [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="dfa7b-106">Если столбец данных **Текст** включен в трассировку, помощник по настройке может использовать файл трассировки, который содержит пакет инструкций SQL и события удаленного вызова процедуры (RPC).</span><span class="sxs-lookup"><span data-stu-id="dfa7b-106">Tuning Advisor can use a trace file that contains SQL batch and remote procedure call (RPC) events if the **Text** data column is included in the trace.</span></span> <span data-ttu-id="dfa7b-107">Для обеспечения того, чтобы при использовании помощника по настройке [!INCLUDE[ssDE](../../includes/ssde-md.md)] Д были захвачены правильные события и столбцы, используйте стандартный шаблон настройки, который поставляется с приложением [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)].</span><span class="sxs-lookup"><span data-stu-id="dfa7b-107">To make sure that the correct events and columns are captured for use with [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor, use the predefined Tuning template that is supplied with [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)].</span></span>  
  
 <span data-ttu-id="dfa7b-108">При открытии трассировки с помощью приложения [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)]трассировка не должна иметь обязательно расширение файла TRC, если файл был создан либо с помощью приложения [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] , либо системными хранимыми процедурами средства трассировки SQL.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-108">When you open a trace by using [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)], the trace file does not need to have the .trc file extension if the file was created by either [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] or SQL Trace system stored procedures.</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] <span data-ttu-id="dfa7b-109">также может считывать LOG-файл средства трассировки SQL и общие файлы сценариев SQL.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-109">can also read SQL Trace .log files and generic SQL script files.</span></span> <span data-ttu-id="dfa7b-110">При открытии LOG-файла средства трассировки SQL, который имеет расширение, отличное от LOG, например trace.txt, укажите значение **SQLTrace_Log** в качестве формата файла.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-110">When opening a SQL Trace .log file that does not have a .log file extension, such as trace.txt, specify **SQLTrace_Log** as the file format.</span></span>  
  
 <span data-ttu-id="dfa7b-111">Можно настроить формат отображения даты и времени в приложении [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] , чтобы облегчить анализ трассировки.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-111">You can configure the [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] date and time display format to assist in trace analysis.</span></span>  
  
## <a name="troubleshooting-data"></a><span data-ttu-id="dfa7b-112">Данные диагностики</span><span class="sxs-lookup"><span data-stu-id="dfa7b-112">Troubleshooting Data</span></span>  
 <span data-ttu-id="dfa7b-113">Используя приложение [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)], можно проводить диагностику данных, группируя трассировки или файлы трассировок по столбцам данных **Duration**, **CPU**, **Reads**и **Writes** .</span><span class="sxs-lookup"><span data-stu-id="dfa7b-113">Using [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)], you can troubleshoot data by grouping traces or trace files by the **Duration**, **CPU**, **Reads**, or **Writes** data columns.</span></span> <span data-ttu-id="dfa7b-114">Примерами данных, которые можно использовать при диагностике, являются запросы, которые завершаются неудачно или которые имеют исключительно высокое число логических операций чтения.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-114">Examples of data you might troubleshoot are queries that perform poorly or that have exceptionally high numbers of logical read operations.</span></span>  
  
 <span data-ttu-id="dfa7b-115">Дополнительные сведения могут быть найдены путем сохранения трассировок в таблицы и использования инструкций [!INCLUDE[tsql](../../includes/tsql-md.md)] для выполнения запросов к данным событий.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-115">Additional information can be found by saving traces to tables and using [!INCLUDE[tsql](../../includes/tsql-md.md)] to query the event data.</span></span> <span data-ttu-id="dfa7b-116">Например, чтобы определить, какие из событий **SQL:BatchCompleted** превысили время ожидания, выполните следующее:</span><span class="sxs-lookup"><span data-stu-id="dfa7b-116">For example, to determine which **SQL:BatchCompleted** events had excessive wait time, execute the following:</span></span>  
  
```  
SELECT  TextData, Duration, CPU  
FROM    trace_table_name  
WHERE   EventClass = 12 -- SQL:BatchCompleted events  
AND     CPU < (Duration * 1000)  
```  
  
> [!NOTE]  
>  <span data-ttu-id="dfa7b-117">Сервер сообщает о длительности события в микросекундах (одна миллионная доля секунды, 10<sup>-6</sup>с) и о количестве времени ЦП, затраченного на событие, в миллисекундах (одна тысячная доля секунды, 10<sup>-3</sup>с).</span><span class="sxs-lookup"><span data-stu-id="dfa7b-117">The server reports the duration of an event in microseconds (one millionth, or 10<sup>-6</sup>, of a second) and the amount of CPU time used by the event in milliseconds (one thousandth, or 10<sup>-3</sup>, of a second).</span></span> <span data-ttu-id="dfa7b-118">В [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] графический пользовательский интерфейс по умолчанию отображает столбец **Продолжительность** в миллисекундах, но, когда данные трассировки сохраняются в файле или таблице базы данных, значение столбца **Продолжительность** записывается в микросекундах.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-118">The [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] graphical user interface displays the **Duration** column in milliseconds by default, but when a trace is saved to either a file or a database table, the **Duration** column value is written in microseconds.</span></span>  
  
## <a name="displaying-object-names-when-viewing-traces"></a><span data-ttu-id="dfa7b-119">Отображение имен объектов при просмотре трассировок</span><span class="sxs-lookup"><span data-stu-id="dfa7b-119">Displaying Object Names When Viewing Traces</span></span>  
 <span data-ttu-id="dfa7b-120">Если необходимо отобразить имя объекта вместо идентификатора объекта (**Object ID**), нужно захватывать столбцы данных **Server Name** и **Database ID** вместе со столбцом данных **Object Name** .</span><span class="sxs-lookup"><span data-stu-id="dfa7b-120">If you wish to display the name of an object rather than the object identifier (**Object ID**), you must capture the **Server Name** and **Database ID** data columns along with the **Object Name** data column.</span></span>  
  
 <span data-ttu-id="dfa7b-121">При выборе группирования по столбцу данных **Object ID** убедитесь, что группирование выполняется вначале по столбцам данных **Server Name** и **Database ID** , а уже потом по столбцу **Object ID** .</span><span class="sxs-lookup"><span data-stu-id="dfa7b-121">If you choose to group by the **Object ID** data column, make sure you group by the **Server Name** and **Database ID** data columns first, and then by the **Object ID** data column.</span></span> <span data-ttu-id="dfa7b-122">Аналогично при группировании по столбцу данных **Index ID** убедитесь, что группирование выполняется вначале по столбцам данных **Server Name**, **Database ID**и **Object ID** , а потом уже по столбцу **Index ID** .</span><span class="sxs-lookup"><span data-stu-id="dfa7b-122">Similarly, if you choose to group by the **Index ID** data column, make sure you group by the **Server Name**, **Database ID**, and **Object ID** data columns first, and then by the **Index ID** data columns.</span></span> <span data-ttu-id="dfa7b-123">Группировать следует в таком порядке, так как идентификаторы объектов и индексов не являются уникальными для нескольких серверов и баз данных (и для объектов, соответствующих идентификаторам индексов).</span><span class="sxs-lookup"><span data-stu-id="dfa7b-123">You must group in this order because object and index IDs are not unique among servers and databases (and among objects for index IDs).</span></span>  
  
## <a name="finding-specific-events-within-a-trace"></a><span data-ttu-id="dfa7b-124">Поиск конкретных событий в трассировке</span><span class="sxs-lookup"><span data-stu-id="dfa7b-124">Finding Specific Events Within a Trace</span></span>  
 <span data-ttu-id="dfa7b-125">Для нахождения и группировки событий в трассировке выполните следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-125">To find and group events in a trace, follow these steps:</span></span>  
  
1.  <span data-ttu-id="dfa7b-126">Создайте трассировку.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-126">Create your trace.</span></span>  
  
    -   <span data-ttu-id="dfa7b-127">При определении трассировки укажите столбцы данных **Event Class**, **ClientProcessID**и **Start Time** в дополнение к любым другим столбцам данных, которые необходимо захватывать.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-127">When defining the trace, capture the **Event Class**, **ClientProcessID**, and **Start Time** data columns in addition to any other data columns you want to capture.</span></span> <span data-ttu-id="dfa7b-128">Дополнительные сведения см. в статье [Создание трассировки (SQL Server Profiler)](create-a-trace-sql-server-profiler.md).</span><span class="sxs-lookup"><span data-stu-id="dfa7b-128">For more information, see [Create a Trace &#40;SQL Server Profiler&#41;](create-a-trace-sql-server-profiler.md).</span></span>  
  
    -   <span data-ttu-id="dfa7b-129">Сгруппируйте захваченные данные по столбцу данных **Event Class**и захватите трассировку в файл или таблицу.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-129">Group the captured data by the **Event Class**data column, and capture the trace to a file or table.</span></span> <span data-ttu-id="dfa7b-130">Чтобы сгруппировать захваченные данные, на вкладке **Выбор событий** диалогового окна "Свойства трассировки" выберите **Расположить столбцы** .</span><span class="sxs-lookup"><span data-stu-id="dfa7b-130">To group the captured data, click **Organize Columns** on the **Events Selection** tab of the Trace Properties dialog box.</span></span> <span data-ttu-id="dfa7b-131">Дополнительные сведения см. в статье [Упорядочение столбцов, отображаемых в трассировке (приложение SQL Server Profiler)](organize-columns-displayed-in-a-trace-sql-server-profiler.md).</span><span class="sxs-lookup"><span data-stu-id="dfa7b-131">For more information, see [Organize Columns Displayed in a Trace &#40;SQL Server Profiler&#41;](organize-columns-displayed-in-a-trace-sql-server-profiler.md).</span></span>  
  
    -   <span data-ttu-id="dfa7b-132">Запустите трассировку и остановите ее по истечении определенного времени или после захвата необходимого количества событий.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-132">Start the trace and stop it after the appropriate time has passed or number of events have been captured.</span></span>  
  
2.  <span data-ttu-id="dfa7b-133">Поиск необходимых событий.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-133">Find the target events.</span></span>  
  
    -   <span data-ttu-id="dfa7b-134">Откройте файл или таблицу трассировки и раскройте узел желаемого класса событий, например **Цепочка взаимоблокировки**.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-134">Open the trace file or table, and expand the node of the desired event class; for example, **Deadlock Chain**.</span></span> <span data-ttu-id="dfa7b-135">Дополнительные сведения см. в статье [Открыть файл трассировки (приложение SQL Server Profiler)](open-a-trace-file-sql-server-profiler.md) или в помощник по настройке ядра СУБД [Открыть таблицу трассировки (приложение SQL Server Profiler)](open-a-trace-table-sql-server-profiler.md).</span><span class="sxs-lookup"><span data-stu-id="dfa7b-135">For more information, see [Open a Trace File &#40;SQL Server Profiler&#41;](open-a-trace-file-sql-server-profiler.md) or [Open a Trace Table &#40;SQL Server Profiler&#41;](open-a-trace-table-sql-server-profiler.md).</span></span>  
  
    -   <span data-ttu-id="dfa7b-136">Найдите в данных трассировки искомые события (для ускорения поиска значений в трассировке можно воспользоваться командой **Поиск** в меню **Изменить** приложения [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] ).</span><span class="sxs-lookup"><span data-stu-id="dfa7b-136">Search through the trace data until you find the events for which you are looking (use the **Find** command on the **Edit** menu of [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to help you find values in the trace).</span></span> <span data-ttu-id="dfa7b-137">Запомните значения в столбцах данных **ClientProcessID** и **Start Time** для искомых событий трассировки.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-137">Note the values in the **ClientProcessID** and **Start Time** data columns of the events you trace.</span></span>  
  
3.  <span data-ttu-id="dfa7b-138">Отображение событий в контексте.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-138">Display the events in context.</span></span>  
  
    -   <span data-ttu-id="dfa7b-139">Откройте свойства трассировки и сгруппируйте их по столбцу данных **ClientProcessID**, а не по столбцу **Event Class** .</span><span class="sxs-lookup"><span data-stu-id="dfa7b-139">Display the trace properties, and group by the **ClientProcessID**data column rather than by the **Event Class** data column.</span></span>  
  
    -   <span data-ttu-id="dfa7b-140">Раскройте узлы для каждого идентификатора клиентского процесса, который необходимо просмотреть.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-140">Expand the nodes of each client process ID you want to view.</span></span> <span data-ttu-id="dfa7b-141">Вручную или с помощью команды **поиска** найдите в трассировке отмеченные ранее значения **Start Time**нужных событий.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-141">Search through the trace manually, or use **Find** until you find the previously noted **Start Time**values of the target events.</span></span> <span data-ttu-id="dfa7b-142">События отображаются в хронологическом порядке вместе с другими событиями, которые принадлежат к каждому выбранному идентификатору клиентского процесса.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-142">The events are displayed in chronological order with the other events that belong to each selected client process ID.</span></span> <span data-ttu-id="dfa7b-143">Например, события **Deadlock** и **Deadlock Chain**, записанные в трассировке, отображаются сразу после событий **SQL:BatchStarting**в пределах раскрытого идентификатора клиентского процесса.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-143">For example, the **Deadlock** and **Deadlock Chain**events, captured within the trace, appear immediately after the **SQL:BatchStarting**events within the expanded client process ID.</span></span>  
  
 <span data-ttu-id="dfa7b-144">Такой же метод может быть применен для поиска сгруппированных событий.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-144">The same technique can be used to find any grouped events.</span></span> <span data-ttu-id="dfa7b-145">Как только будут найдены искомые события, сгруппируйте их по **ClientProcessID**, **имя_приложения**или другому классу событий для просмотра соответствующей деятельности в хронологическом порядке.</span><span class="sxs-lookup"><span data-stu-id="dfa7b-145">Once you have found the events you seek, group them by **ClientProcessID**, **ApplicationName**, or another event class to view related activity in chronological order.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dfa7b-146">См. также:</span><span class="sxs-lookup"><span data-stu-id="dfa7b-146">See Also</span></span>  
 <span data-ttu-id="dfa7b-147">[Просмотр сохраненной трассировки (Transact-SQL)](../../relational-databases/sql-trace/view-a-saved-trace-transact-sql.md) </span><span class="sxs-lookup"><span data-stu-id="dfa7b-147">[View a Saved Trace &#40;Transact-SQL&#41;](../../relational-databases/sql-trace/view-a-saved-trace-transact-sql.md) </span></span>  
 <span data-ttu-id="dfa7b-148">[sys.fn_trace_getinfo (Transact-SQL)](/sql/relational-databases/system-functions/sys-fn-trace-getinfo-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="dfa7b-148">[sys.fn_trace_getinfo &#40;Transact-SQL&#41;](/sql/relational-databases/system-functions/sys-fn-trace-getinfo-transact-sql) </span></span>  
 <span data-ttu-id="dfa7b-149">[Просмотр сведений фильтров (приложение SQL Server Profiler)](view-filter-information-sql-server-profiler.md) </span><span class="sxs-lookup"><span data-stu-id="dfa7b-149">[View Filter Information &#40;SQL Server Profiler&#41;](view-filter-information-sql-server-profiler.md) </span></span>  
 <span data-ttu-id="dfa7b-150">[Просмотр сведений фильтров (Transact-SQL)](../../relational-databases/sql-trace/view-filter-information-transact-sql.md) </span><span class="sxs-lookup"><span data-stu-id="dfa7b-150">[View Filter Information &#40;Transact-SQL&#41;](../../relational-databases/sql-trace/view-filter-information-transact-sql.md) </span></span>  
 <span data-ttu-id="dfa7b-151">[Открытие файла трассировки (приложение SQL Server Profiler)](open-a-trace-file-sql-server-profiler.md) </span><span class="sxs-lookup"><span data-stu-id="dfa7b-151">[Open a Trace File &#40;SQL Server Profiler&#41;](open-a-trace-file-sql-server-profiler.md) </span></span>  
 [<span data-ttu-id="dfa7b-152">Открыть таблицу трассировки (приложение SQL Server Profiler)</span><span class="sxs-lookup"><span data-stu-id="dfa7b-152">Open a Trace Table &#40;SQL Server Profiler&#41;</span></span>](open-a-trace-table-sql-server-profiler.md)  
  
  
