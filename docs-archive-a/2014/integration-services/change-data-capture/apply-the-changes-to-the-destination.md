---
title: Применение изменений в назначении | Документы Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- incremental load [Integration Services],applying changes
ms.assetid: 338a56db-cb14-4784-a692-468eabd30f41
author: chugugrace
ms.author: chugu
ms.openlocfilehash: dd7ab93a299ffaab2259c3d462a5c0a69160ad5b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87669014"
---
# <a name="apply-the-changes-to-the-destination"></a>Применение изменений в назначении
  В потоке данных пакета служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , который выполняет добавочную загрузку информации об измененных данных, третьей и последней задачей является применение изменений к назначению. Один компонент потребуется для применения вставок, один — для применения обновлений и один — для применения удалений.  
  
> [!NOTE]  
>  Второй задачей в проектировании потока данных пакета, выполняющего добавочную загрузку информации об измененных данных, является разделение вставок, обновлений и удалений. Дополнительные сведения об этом компоненте см. в разделе [Обработка операций вставки, обновления и удаления](process-inserts-updates-and-deletes.md). Описание общего процесса создания пакета, выполняющего добавочную загрузку информации об изменениях, см. в разделе [Система отслеживания измененных данных (SSIS)](change-data-capture-ssis.md).  
  
## <a name="applying-inserts"></a>Применение вставок  
 Для применения вставок используется назначение «OLE DB», поскольку новые строки не требуют специальной обработки.  
  
#### <a name="to-process-inserts-by-using-an-ole-db-destination"></a>Обработка вставок с использованием назначения «OLE DB»  
  
1.  На вкладке **Поток данных** добавьте назначение «OLE DB».  
  
2.  Соедините выход, содержащий вставки из преобразования «Условное разбиение», с назначением «OLE DB».  
  
3.  В **Редакторе назначения «OLE DB»** на странице **Диспетчер соединений** выберите следующие параметры.  
  
    1.  Выберите или создайте диспетчер соединений «OLE DB» для целевой базы данных.  
  
    2.  Выберите параметр **Режим доступа к данным** , а затем выберите целевую таблицу или введите инструкцию SQL, содержащую целевые столбцы.  
  
4.  На странице **Сопоставления** в редакторе сопоставьте соответствующие столбцы из измененных данных со столбцами целевой таблицы.  
  
## <a name="applying-updates"></a>Применение обновлений  
 Для применения обновлений используется преобразование «Команда OLE DB». Это преобразование используется потому, что для обновления новыми значениями столбцов по одной строке за раз требуется параметризованная инструкция UPDATE.  
  
> [!NOTE]  
>  Для применения обновлений можно также использовать компоненты назначения. Этот способ подразумевает использование компонентов назначения для сохранения строк в специально созданных временных таблицах. Затем с помощью задач «Выполнение SQL» проводятся массовые операции обновления и удаления строк, перенося данные из временных таблиц в объекты целевой базы данных.  
  
#### <a name="to-process-updates-by-using-an-ole-db-command-transformation"></a>Обработка обновлений с помощью преобразования «Команда OLE DB»  
  
1.  На вкладке **Поток данных** добавьте преобразование «Команда OLE DB».  
  
2.  Соедините выход, содержащий обновления преобразования «Условное разбиение», с преобразованием «Команда OLE DB».  
  
3.  В окне **Расширенный редактор команды OLE DB**на вкладке **Диспетчер соединений** выберите существующий или создайте новый диспетчер соединений OLE DB для целевой базы данных.  
  
4.  В **Расширенном редакторе команды OLE DB**на вкладке **Свойства компонента** для **SqlCommand**введите параметризованную инструкцию UPDATE.  
  
     Например, инструкция UPDATE для таблицы «Заказчики» может иметь следующий синтаксис:  
  
    ```  
    update CDCSample.Customer  
    set TerritoryID  = ?,  
        CustomerType  = ?,  
        rowguid  = ?,  
        ModifiedDate  = ?  
    where CustomerID = ?  
  
    ```  
  
5.  На вкладке **Сопоставления столбцов** в редакторе сопоставьте соответствующие столбцы из измененных данных с параметрами инструкции UPDATE.  
  
## <a name="applying-deletes"></a>Применение удалений  
 Для применения удалений используется преобразование «Команда OLE DB». Это преобразование используется потому, что для удаления по одной строке за раз на основании значения столбца, однозначно определяющего строку, требуется параметризованная инструкция UPDATE.  
  
> [!NOTE]  
>  Для применения удалений можно также использовать целевые компоненты. Этот способ подразумевает использование компонентов назначения для сохранения строк в специально созданных временных таблицах. Затем с помощью задач «Выполнение SQL» проводятся массовые операции обновления и удаления строк, перенося данные из временных таблиц в объекты целевой базы данных.  
  
#### <a name="to-process-deletes-by-using-an-ole-db-command-transformation"></a>Обработка удалений с помощью преобразования «Команда OLE DB»  
  
1.  На вкладке **Поток данных** добавьте преобразование «Команда OLE DB» в поток данных.  
  
2.  Соедините выход, содержащий удаления из преобразования «Условное разбиение», с преобразованием «Команда OLE DB».  
  
3.  Откройте расширенный редактор, чтобы настроить преобразование.  
  
4.  В окне **Расширенный редактор команды OLE DB**на вкладке **Диспетчер соединений** выберите существующий или создайте новый диспетчер соединений OLE DB для целевой базы данных.  
  
5.  В **Расширенном редакторе команды OLE DB**на вкладке **Свойства компонента** редактора для **SqlCommand**введите параметризованную инструкцию DELETE.  
  
     Например, инструкция DELETE для таблицы «Заказчики» может иметь следующий синтаксис:  
  
    ```  
    delete from Customer where CustomerID = ?  
  
    ```  
  
6.  На вкладке **Сопоставления столбцов** в редакторе сопоставьте соответствующий столбец из измененных данных с параметром инструкции DELETE.  
  
## <a name="optimizing-inserts-and-updates-by-using-merge-functionality"></a>Оптимизация вставок и обновлений с помощью функции MERGE  
 Обработку вставок и обновлений можно оптимизировать, объединив определенные параметры системы отслеживания измененных данных с помощью ключевого слова Transact-SQL MERGE. Дополнительные сведения о ключевом слове MERGE см. в разделе [MERGE (Transact-SQL)](/sql/t-sql/statements/merge-transact-sql).  
  
 В инструкции Transact-SQL, получающей измененные данные, в качестве значения параметра *row_filter_option* при вызове функции **cdc.fn_cdc_get_net_changes_<экземпляр_отслеживания_изменений>** можно указать *all with merge*. Эта система отслеживания измененных данных работает более эффективно, если не требуется дополнительная обработка для различения вставок и обновлений. Если параметр получает значение *all with merge* , значение **__$operation** измененных данных равно 1 для удалений или 5 для изменений, вызванных вставками или обновлениями. Дополнительные сведения о функции Transact-SQL, используемой для получения измененных данных, см. в разделе [Получение и интерпретация измененных данных](retrieve-and-understand-the-change-data.md). После получения изменений с параметром *all with merge* можно применить удаления и вывести оставшиеся строки во временную или промежуточную таблицу. Затем в нисходящей задаче «Выполнение SQL» можно использовать одну инструкцию MERGE для применения всех вставок или обновлений из промежуточной таблицы к назначению.  
  
  
