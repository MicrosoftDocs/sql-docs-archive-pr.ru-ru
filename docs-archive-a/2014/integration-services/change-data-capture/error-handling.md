---
title: Обработка ошибок | Документы Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
ms.assetid: ff79e19d-afca-42a4-81b0-62d759380d11
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 083af496c60fb11afaf85068ba980e54986134d4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87728638"
---
# <a name="error-handling"></a>Обработка ошибок
  Экземпляр Oracle CDC извлекает изменения из одной базы данных-источника Oracle (кластер Oracle RAC считается одной базой данных) и записывает зафиксированные изменения в таблицы изменений в базе данных CDC на целевом экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
 Экземпляр CDC хранит свое состояние в системной таблице с именем **cdc.xdbcdc_state**. Для получения состояния экземпляра CDC эта таблица может быть запрошена в любой момент. Дополнительные сведения о таблице cdc.xdbcdc_state см. в разделе [cdc.xdbcdc_state](the-oracle-cdc-databases.md#bkmk_cdcxdbcdc_state).  
  
 Далее приводится описание состояний экземпляра CDC, используемых в таблице xdbcdc_state.  
  
 Для каждого состояния соответствующие столбцы таблицы cdc.xdbcdc_state показывают следующее.  
  
-   Экземпляр неактивен (в настоящее время не существует процесса Windows, который бы его обрабатывал). Если в столбце **Активность** указано значение 1, это значит, что подпроцесс службы Oracle CDC Service, обрабатывающий данный экземпляр Oracle CDC, в настоящее время запущен.  
  
-   Если в столбце **Ошибка** указано значение 0, экземпляр CDC Oracle не находится в состоянии ошибки. Если в столбце **Ошибка** указано значение 1, произошла ошибка, которая не позволяет экземпляру Oracle CDC обрабатывать изменения.  
  
     Если в столбце **Ошибка** указано значение 1 и в столбце **Активность** также указано значение 1, это значит, что в экземпляре Oracle CDC произошла обратимая ошибка, которую можно устранить автоматически. Если в столбце ошибки указано значение 1, а в столбце активности указано значение 0, в большинстве случаев это означает, что для продолжения работы требуется вмешательство оператора, который устранит проблему вручную.  
  
 В следующей таблице описаны различные коды состояния, которые экземпляр Oracle CDC может публиковать в своей таблице состояний.  
  
|Состояние|Код состояния активности|Код состояния ошибки|Описания|  
|------------|------------------------|-----------------------|------------------|  
|ABORTED|0|1|Экземпляр Oracle CDC не выполняется. Подтип состояния ABORTED указывает, что экземпляр Oracle CDC был активен, а затем неожиданно остановился.<br /><br /> Подтип состояния ABORTED задается главным экземпляром службы Oracle CDC Service, когда служба обнаруживает, что экземпляр Oracle CDC не выполняется, хотя имеет состояние ACTIVE.|  
|ошибка|0|1|Экземпляр Oracle CDC не выполняется. Состояние ERROR означает, что экземпляр CDC находился в состоянии ACTIVE, но затем произошла ошибка, которая исключает дальнейшую работу, и экземпляр отключился. Состояние ERROR содержит следующие коды подсостояния:<br /><br /> MISCONFIGURED. Обнаружена неисправимая ошибка конфигурации.<br /><br /> PASSWORD-REQUIRED. Для конструктора Change Data Capture Designer for Oracle от Attunity пароль не задан или недействителен. Причиной может быть изменение пароля асимметричного ключа службы.|  
|RUNNING|1|0|Экземпляр CDC выполняется и обрабатывает записи об изменениях. Состояние RUNNING содержит следующие коды подсостояния:<br /><br /> IDLE. Все записи об изменениях были обработаны и сохранены в целевых контрольных таблицах ( **_CT**). В контрольных таблицах не существует активных транзакций.<br /><br /> PROCESSING. Экземпляр в настоящее время обрабатывает записи об изменениях, которые еще не записаны в контрольных таблицах ( **_CT**).|  
|STOPPED|0|0|Экземпляр CDC не выполняется. Подтип состояния STOP указывает, что экземпляр Oracle CDC был активен, а затем остановлен корректным образом.|  
|SUSPENDED|1|1|Экземпляр CDC запущен, но обработка приостановлена в связи с устранимой ошибкой. Состояние SUSPENDED содержит следующие коды подсостояния:<br /><br /> DISCONNECTED. Не удается установить подключение к исходной базе данных Oracle. Обработка возобновится после восстановления соединения.<br /><br /> STORAGE. Хранилище переполнено. Обработка возобновится, когда станет доступным дополнительный объем хранения данных. В некоторых случаях это состояние может не отображаться из-за того, что обновить таблицу состояний невозможно.<br /><br /> LOGGER. Средство ведения журнала подключено к базе данных Oracle, но не может считать журналы транзакций Oracle из-за временных проблем.|  
|DATAERROR|x|x|Этот код состояния используется только для таблицы **xdbcdc_trace** . Он не используется в таблице **xdbcdc_state** . Записи трассировки с этим состоянием указывают на проблему с записью журнала Oracle. Испорченная запись журнала хранится в столбце **данных** в виде большого двоичного объекта. Состояние DATAERROR содержит следующие коды подсостояния:<br /><br /> BADRECORD. Приложенную запись журнала не удается проанализировать.<br /><br /> CONVERT-ERROR. Данные из некоторых столбцов не удалось преобразовать в данные целевых столбцов таблицы отслеживания. Это состояние может появиться, только если конфигурация указывает, что при ошибках преобразования следует формировать записи трассировки.|  
  
 Поскольку состояние службы Oracle CDC Service хранится в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], в некоторых случаях значение состояния в базе данных может не отражать действительного состояния службы. Чаще всего это происходит, если подключение службы к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] было разорвано и его по какой-то причине не удается восстановить. В этом случае состояние, записанное в таблице **cdc.xdbcdc_state** , устаревает. Если метка времени последнего обновления (UTC) старше одной минуты, состояние, скорее всего, устарело. В этом случае используйте средство просмотра событий Windows для поиска дополнительных сведений о состоянии службы.  
  
## <a name="error-handling"></a>Обработка ошибок  
 В этом разделе описана обработка ошибок службой Oracle CDC Service.  
  
### <a name="logging"></a>Logging  
 Служба Oracle CDC Service записывает сведения об ошибках в одно из следующих мест.  
  
-   Журнал событий Windows. Сюда записываются сведения об ошибках и события жизненного цикла службы Oracle CDC Service (запуск, остановка, подключение (или повторное подключение) к целевому экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ).  
  
-   Таблица MSXDBCDC.dbo.xdbcdc_trace, которая используется основным процессом службы Oracle CDC Service для ведения общего журнала и трассировки.  
  
-   Таблица \<cdc-database>.cdc.xdbcdc_trace, которая используется экземплярами Oracle CDC для ведения общего журнала и трассировки. Это означает, что ошибки, связанные с определенным экземпляром Oracle CDC, записываются в таблицу трассировки данного экземпляра.  
  
 Сведения записываются в журнал службой Oracle CDC, когда служба:  
  
-   запущена или остановлена диспетчером управления служб;  
  
-   не может подключиться к связанному с ней экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или успешно устанавливает связь с ним после сбоя;  
  
-   сталкивается с ошибкой при запуске экземпляров службы Oracle CDC Service;  
  
-   обнаруживает, что работа экземпляра Oracle CDC была прервана;  
  
-   сталкивается с непредвиденной ошибкой.  
  
 Сведения записываются в журнал экземпляром Oracle CDC, когда экземпляр:  
  
-   включается или отключается;  
  
-   сталкивается с ошибкой;  
  
-   восстанавливается после устранимой ошибки.  
  
 Таблица трассировки используется также для записи подробных сведений о трассировке для поиска и устранения неполадок.  
  
### <a name="handling-source-oracle-connection-errors"></a>Обработка ошибок подключения к источнику данных Oracle  
 Службе Oracle CDC Oracle необходимо постоянное соединение с исходной базой данных Oracle. Многие ошибки соединения, не имеющие отношения к конфигурации службы (такие как неполадки в сети), считаются временными. Следовательно, если службе Oracle CDC Service не удается установить соединение с базой данных Oracle (при запуске или после разрыва соединения в процессе работы), служба меняет свое состояние на SUSPENDED/DISCONNECTED и начинает периодически повторять попытки подключения. Обработка продолжится, когда подключение будет восстановлено.  
  
 Другие типы ошибок подключения не являются временными (например, недействительные учетные данные, недостаточный уровень прав доступа и неверный адрес базы данных). Если произошла такая ошибка, службе Oracle CDC Service задается состояние ERROR/MISCONFIGURED или ERROR/PASSWORD-REQUIRED, а сама служба отключается. После устранения пользователем соответствующей ошибки экземпляр Oracle CDC нужно заново включить вручную, чтобы возобновить обработку.  
  
 Когда неясно, является ли ошибка временной, лучше предположить, что она временная.  
  
### <a name="handling-target-sql-server-connection-errors"></a>Обработка ошибок подключения к целевому SQL Server  
 Службе Oracle CDC необходимо постоянное подключение к целевому экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Это подключение используется в следующих целях.  
  
-   Проверка того факта, что никакие другие службы с тем же именем в настоящее время не работают с этим экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
-   Проверка того, какой экземпляр Oracle CDC включен или отключен, и запуск или остановка его подпроцесса.  
  
 Установив соединение с целевым экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и проверив, что это единственная работающая служба Oracle CDC с таким именем, служба Oracle CDC может проверить, какие экземпляры Oracle CDC включены, и запустить их процессы обработки (после остановки службы процессы отключаются). Экземпляры Oracle CDC используют свои соединения с [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для работы с базой данных CDC экземпляра Oracle CDC.  
  
 Способ обработки ошибок при сбое подключения к целевому экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] зависит от того, являются ли эти ошибки временными.  
  
 Если известно, что ошибка подключения не является временной (например, недействительные учетные данные, недостаточный уровень прав доступа, неверная строка соединения), служба вносит запись об ошибке в журнал событий Windows и останавливается (она не может сделать запись в таблицу трассировки из-за отсутствия подключения к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]). В этом случае пользователю необходимо устранить ошибку и перезапустить службу Windows Oracle CDC.  
  
 В случае временных и неожиданных ошибок попытка совершить операцию повторяется несколько раз. Если ошибка не исчезает в течение достаточно долгого времени, служба CDC останавливает подпроцессы экземпляров CDC и возвращается к первоначальной попытке подключения (возможно, к этому времени контроль над указанной службой CDC уже перешел к другой службе Oracle CDC Service на другом компьютере).  
  
### <a name="handling-target-sql-server-storage-full-errors"></a>Обработка ошибок, вызванных недостатком объема хранения на целевом экземпляре SQL Server  
 Когда служба Oracle CDC Service обнаруживает, что невозможно записать новую информацию об изменениях в базу данных CDC на целевом экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , она записывает предупреждение в журнал событий и пытается создать новую запись трассировки (хотя эта операция может завершиться ошибкой по той же причине). Затем служба повторяет операцию через определенные промежутки времени, пока она не будет успешно выполнена.  
  
### <a name="handling-oracle-cdc-errors"></a>Обработка ошибок Oracle CDC  
 Экземпляр Oracle CDC читает журнал транзакций Oracle и обрабатывает его. Если при обработке CDC возникает ошибка, сведения об ошибке вносятся в таблицу **cdc.xdbcdc_state** , при этом требуется вмешательство пользователя, который должен вручную устранить указанную ошибку.  
  
 Например, экземпляр Oracle CDC может быть неактивен в течение длительного времени, а нужные файлы журнала транзакций могут быть Oracle недоступны. В этом случае администратор базы данных Oracle должен восстановить необходимые журналы, чтобы экземпляр Oracle CDC мог возобновить обработку.  
  
### <a name="handling-unexpected-oracle-cdc-instance-failures"></a>Обработка неожиданных сбоев экземпляра Oracle CDC  
 Служба Oracle CDC Service отслеживает подпроцессы свих экземпляров CDC. Если выполнение подпроцесса экземпляра CDC прерывается, служба CDC Service отключает его в таблице MSXDBCDC.dbo.xdbcdc_databases и меняет его состояние в таблице cdc.xdbcdc_state на ABORTED. В этом случае можно использовать стандартное диалоговое окно отчета об ошибках Windows, чтобы передать сообщение об этой ошибке для анализа в дальнейшем.  
  
## <a name="see-also"></a>См. также:  
 [Конструктор системы отслеживания измененных данных для Oracle компании Attunity](change-data-capture-designer-for-oracle-by-attunity.md)   
 [Экземпляр CDC Oracle](the-oracle-cdc-instance.md)  
