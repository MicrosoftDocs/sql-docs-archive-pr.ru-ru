---
title: Контроль доступа для конфиденциальных данных в пакетах | Документы Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- passwords [Integration Services]
- packages [Integration Services], security
- protection levels for packages [Integration Services]
- configuration files [Integration Services]
- encryption [Integration Services]
- cryptography [Integration Services]
- security [Integration Services], protection levels
ms.assetid: d4b073c4-4238-41fc-a258-4e114216e185
author: chugugrace
ms.author: chugu
ms.openlocfilehash: af1c29f2871d0cb43436fa065d16b24cb78fcce7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87656467"
---
# <a name="access-control-for-sensitive-data-in-packages"></a>Контроль доступа для конфиденциальных данных в пакетах
  Для защиты данных в пакете служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] можно задать уровень защиты, способствующий защите или только конфиденциальных данных, или всех данных в пакете. Более того, эти данные можно зашифровать с паролем или ключом пользователя или возложить задачу шифрования данных на базу данных. Кроме того, используемый уровень защиты пакета не обязательно является статическим и изменяется в течение жизненного цикла пакета. Часто один уровень защиты устанавливается во время развертывания, а другой — сразу после развертывания пакета.  
  
> [!NOTE]  
>  Помимо уровней защиты, описанных в данном разделе, для защиты пакетов, сохраняемых на сервере [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , можно использовать предопределенные роли уровня базы данных.  
  
## <a name="definition-of-sensitive-information"></a>Определение конфиденциальных данных  
 В пакете служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] следующие данные определены как *конфиденциальные*:  
  
-   Часть строки соединения, содержащая пароль. Однако если выбран параметр, который шифрует все, строка соединения целиком будет рассматриваться как конфиденциальная.  
  
-   Сформированные задачей XML-узлы, помеченные как конфиденциальные. Пометки XML-узлов управляются службами [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] и не могут изменяться пользователями.  
  
-   Любая переменная, помеченная как конфиденциальная. Пометки переменных управляются службами [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)].  
  
 В службах [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] свойство рассматривается как конфиденциальное в зависимости от того, назначил ли свойство конфиденциальным разработчик компонента [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , такого как диспетчер соединений или задача. Пользователи не могут добавлять или удалять свойства из списка свойств, которые рассматриваются как конфиденциальные.  
  
## <a name="encryption"></a>Шифрование  
 Шифрование, используемое уровнями защиты пакетов, выполняется с помощью API защиты данных [!INCLUDE[msCoName](../../includes/msconame-md.md)] (DPAPI), являющегося частью шифровального API (CryptoAPI).  
  
 Уровни защиты пакета, шифрующие пакеты с паролями, требуют введения пароля. Если пользователь изменяет уровень защиты с уровня, не использующего пароль, на уровень, его использующий, пользователю будет предложено ввести пароль.  
  
 Кроме того, для уровней защиты, использующих пароли, службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] применяют алгоритм шифрования Triple DES с длиной ключа 192 бита, доступный из [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] Class Library (FCL).  
  
## <a name="protection-levels"></a>Уровни защиты  
 Следующая таблица описывает уровни защиты, предоставляемые службами [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] . Значения в скобках — это значения из перечисления <xref:Microsoft.SqlServer.Dts.Runtime.DTSProtectionLevel> . Эти значения отображаются в окне «Свойства», которое используется для настройки свойств пакета при работе с пакетами в среде [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)].  
  
|Уровень защиты|Description|  
|----------------------|-----------------|  
|Не сохранять конфиденциальные данные (`DontSaveSensitive`).|Подавляет значения конфиденциальных свойств в пакете при сохранении. Этот уровень защиты не шифрует, а предотвращает сохранение в пакете свойств, помеченных как конфиденциальные, и таким образом делает конфиденциальные данные недоступными для других пользователей. Если другой пользователь откроет пакет, конфиденциальная информация будет заменена пробелами и пользователь сам будет должен задать эти конфиденциальные сведения.<br /><br /> При использовании со средством **dtutil** (dtutil.exe) этот уровень защиты соответствует значению 0.|  
|Шифровать все данные паролем (`EncryptAllWithPassword`).|Использует пароль для шифрования всего пакета. Пакет шифруется с использованием пароля, который пользователь предоставляет при создании или экспорте пакета. Чтобы открыть пакет в конструкторе [!INCLUDE[ssIS](../../includes/ssis-md.md)] или запустить пакет с помощью программы командной строки **dtexec** , необходимо ввести пароль пакета. Без пароля пользователь не может получить доступ к пакету или запустить его.<br /><br /> При использовании с программой **dtutil** этот уровень защиты соответствует значению 3.|  
|Шифровать все данные пользовательским ключом (`EncryptAllWithUserKey`).|Использует ключ на основе текущего профиля пользователя для шифрования всего пакета. Открыть пакет в конструкторе [!INCLUDE[ssIS](../../includes/ssis-md.md)] или запустить пакет с помощью программы командной строки **dtexec** может только пользователь, создавший или экспортировавший пакет.<br /><br /> При использовании с программой **dtutil** этот уровень защиты соответствует значению 4.<br /><br /> Примечание. Для уровней защиты, в которых используется ключ пользователя, службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] используют стандарты DPAPI. Дополнительные сведения о DPAPI см. в библиотеке MSDN по адресу [https://msdn.microsoft.com/library](https://go.microsoft.com/fwlink/?LinkId=15408).|  
|Шифровать конфиденциальные данные паролем (`EncryptSensitiveWithPassword`).|Использует пароль для шифрования только значений конфиденциальных свойств пакета. Для шифрования используется DPAPI. Конфиденциальные данные сохраняются как часть пакета, но эти данные шифруются с использованием пароля, предоставляемого текущим пользователем при создании или экспорте пакета. Чтобы открыть пакет в конструкторе служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] , пользователь должен предоставить пароль пакета. Если пароль не предоставлен, пакет открывается без конфиденциальных данных и текущий пользователь должен ввести новые значения для конфиденциальных данных. Если пользователь пытается выполнить пакет без предоставления пароля, выполнения не происходит. Дополнительные сведения о паролях и выполнении из командной строки см. в разделе [Программа dtexec](../packages/dtexec-utility.md).<br /><br /> При использовании с программой **dtutil** этот уровень защиты соответствует значению 2.|  
|Шифровать конфиденциальные данные пользовательским ключом (`EncryptSensitiveWithUserKey`).|Использует ключ на основе текущего профиля пользователя для шифрования только значений конфиденциальных свойств пакета. Только тот же пользователь, использующий тот же профиль, сможет загрузить пакет. Если другой пользователь откроет пакет, конфиденциальная информация будет заменена пробелами и пользователь сам должен задать эти конфиденциальные данные. Если пользователь пытается выполнить пакет, запуска не происходит. Для шифрования используется DPAPI.<br /><br /> При использовании с программой **dtutil** этот уровень защиты соответствует значению 1.<br /><br /> Примечание. Для уровней защиты, в которых используется ключ пользователя, службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] используют стандарты DPAPI. Дополнительные сведения о DPAPI см. в библиотеке MSDN по адресу [https://msdn.microsoft.com/library](https://go.microsoft.com/fwlink/?LinkId=15408).|  
|Шифровать в зависимости от хранилища на сервере (`ServerStorage`).|Защищает весь пакет, используя роли базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Этот параметр поддерживается в случае, когда пакет сохраняется в базе данных msdb служб [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Кроме того, каталог SSISDB использует уровень защиты `ServerStorage`<br /><br /> Этот параметр не поддерживается, когда пакет сохраняется в файловой системе из среды [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)].|  
  
## <a name="protection-level-setting-and-the-ssisdb-catalog"></a>Установка уровня защиты и каталог SSISDB  
 Каталог SSISDB использует уровень защиты `ServerStorage`. При развертывании проекта [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] на сервере [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] каталог автоматически шифрует данные пакета и конфиденциальные значения. Каталог также автоматически расшифровывает данные после их получения.  
  
 При экспорте проекта (ISPAC-файл) с сервера [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] в файловую систему система автоматически изменяет уровень защиты на `EncryptSensitiveWithUserKey`. При импорте проекта с помощью **мастера импорта проекта Integration Services** в [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)] свойстве **ProtectionLevel** в окне **Свойства** отображается значение `EncryptSensitiveWithUserKey` .  
  
## <a name="protection-level-setting-based-on-package-life-cycle"></a>Назначение уровня защиты на основе жизненного цикла пакета  
 Уровень защиты пакета служб [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] задается, когда начинается его разработка в среде [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]. Позже, когда пакет развернут, импортирован или экспортирован из служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] в службы [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]либо скопирован из среды [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)] в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], хранилища пакетов служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] или файловой системы, можно изменить уровень защиты пакета. Например, если пользователь создает и сохраняет пакеты на своем компьютере с одним из параметров ключевых пользовательских уровней защиты, возможно, ему захочется изменить уровень защиты, предоставляя пакет другим пользователям, так как иначе они попросту не смогут открыть пакет.  
  
 Как правило, изменение уровня защиты охватывает следующие шаги.  
  
1.  Во время развертывания рекомендуется принять значение уровня защиты пакетов по умолчанию: `EncryptSensitiveWithUserKey`. Этот параметр позволит гарантировать просмотр важных значений в пакете только разработчиком. Можно подумать об использовании `EncryptAllWithUserKey` или `DontSaveSensitive`.  
  
2.  Когда все готово к развертыванию пакетов, уровень защиты следует изменить на уровень, не зависящий от ключа пользователя разработчика. В этом случае обычно требуется выбрать `EncryptSensitiveWithPassword` или `EncryptAllWithPassword`. Зашифруйте пакеты, назначив временный надежный пароль, который также известен рабочей группе в рабочей среде.  
  
3.  После развертывания пакетов в рабочей среде рабочая группа может повторно зашифровать развернутые пакеты, назначив известный им надежный пароль. Другой вариант: они могут зашифровать развернутые пакеты, выбрав `EncryptSensitiveWithUserKey` или `EncryptAllWithUserKey` и используя локальные данные учетной записи, с которой выполняются пакеты.  
  
## <a name="related-tasks"></a>Связанные задачи  
  
-   [Установка или изменение уровня защиты пакетов](../set-or-change-the-protection-level-of-packages.md)  
  
## <a name="see-also"></a>См. также:  
 [Импорт и экспорт пакетов &#40;служб SSIS&#41;](../import-and-export-packages-ssis-service.md)   
 [Integration Services &#40;пакетов&#41; SSIS](../integration-services-ssis-packages.md)   
 [Общие сведения о безопасности (службы Integration Services)](security-overview-integration-services.md)  
  
  
