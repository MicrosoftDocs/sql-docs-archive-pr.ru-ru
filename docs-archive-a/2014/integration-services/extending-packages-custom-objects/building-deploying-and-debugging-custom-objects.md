---
title: Построение, развертывание и отладка пользовательских объектов | Документы Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: reference
helpviewer_keywords:
- custom objects [Integration Services]
ms.assetid: b03685bc-5398-4c3f-901a-1219c1098fbe
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 13157fce4e5c7dd8987f4950a6b4250ea0e36094
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87736596"
---
# <a name="building-deploying-and-debugging-custom-objects"></a>Построение, развертывание и отладка пользовательских объектов
  После написания кода пользовательского объекта для служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] необходимо построить сборку, развернуть ее, интегрировать ее в конструктор служб [!INCLUDE[ssIS](../../includes/ssis-md.md)], чтобы сделать ее доступной для использования в пакетах, а затем протестировать и выполнить ее отладку.

##  <a name="steps-in-building-deploying-and-debugging-a-custom-object-for-integration-services"></a><a name="top"></a> Шаги построения, развертывания и отладки пользовательского объекта для служб Integration Services
 Пользовательская функциональность для объекта уже написана. Теперь необходимо протестировать ее и сделать доступной для пользователей. Эти шаги похожи для всех типов пользовательских объектов, которые могут быть созданы для служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)].

 Здесь приведены шаги построения, развертывания и отладки объекта:

1.  [Подпишите](#signing) сборку для формирования со строгим именем.

2.  [Постройте](#building) сборку.

3.  [Разверните ](#deploying) сборку, переместив или скопировав ее в соответствующую папку служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)].

4.  [Установите](#installing) сборку в глобальный кэш сборок (GAC).

     Объект автоматически добавляется в область элементов.

5.  [Устраните неполадки](#troubleshooting) в работе развернутой сборки, если необходимо.

6.  [Протестируйте](#testing) и выполните отладку кода.

##  <a name="signing-the-assembly"></a><a name="signing"></a> Подписывание сборки
 Если сборка предназначена для общего доступа, ее необходимо установить в глобальный кэш сборок. После добавления сборки в глобальный кэш сборок, ее можно использовать в приложениях, например, в среде [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]. Глобальный кэш сборок предъявляет к добавляемой сборке особое требование: она должна быть подписана строгим именем, что гарантирует глобальную уникальность сборки. Сборка со строгим именем имеет полное имя, включающее имя, культуру, открытый ключ и номер версии сборки. Среда выполнения использует эти сведения, чтобы найти сборку и отличить ее от других сборок с тем же именем.

 Чтобы подписать сборку строгим именем, необходимо иметь или создать пару открытого и закрытого ключей. Такая пара открытого и закрытого криптографических ключей используется во время построения для создания сборки со строгим именем.

 Дополнительные сведения о строгих именах и шагах подписывания сборки см. в следующих разделах документации к пакету SDK платформы [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)]:

-   Сборки со строгими именами

-   Создание пары ключей

-   Подписывание сборки строгим именем

 Можно легко подписать сборку строгим именем в среде [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] во время построения. В диалоговом окне **Свойства проекта** перейдите на вкладку **Подписывание** . Выберите параметр для **подписания сборки** , а затем укажите путь к файлу ключа (SNK).

##  <a name="building-the-assembly"></a><a name="building"></a> Построение сборки
 После подписывания проекта необходимо построить или перестроить проект или решение с использованием команд, доступных в меню **Построение** среды [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)]. Решение может содержать отдельный проект для пользовательского интерфейса, который также должен быть подписан строгим именем и может строиться одновременно со сборкой.

 Наиболее удобным способом выполнения следующих двух шагов — развертывания сборки и установки ее в глобальный кэш сборок — является создание скрипта для этих шагов, запускаемого после построения в [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)]. События построения доступны на странице **Компиляция** свойств проекта для проекта [!INCLUDE[vbprvb](../../includes/vbprvb-md.md)] и на странице **События построения** для проекта C#. В программах командной строки, например **gacutil.exe**, необходимо указывать полный путь. Пути, содержащие пробелы, и макросы, например, $(TargetPath), которые разворачиваются в пути, содержащие пробелы, необходимо заключать в кавычки.

 Ниже приведен образец командной строки события после построения для пользовательского регистратора.

```
"C:\Program Files (x86)\Microsoft SDKs\Windows\v7.0A\bin\NETFX 4.0 Tools\gacutil.exe" -u $(TargetName)
"C:\Program Files (x86)\Microsoft SDKs\Windows\v7.0A\bin\NETFX 4.0 Tools\gacutil.exe" -i $(TargetFileName)
copy $(TargetFileName) "C:\Program Files\Microsoft SQL Server\120\DTS\LogProviders "
```

##  <a name="deploying-the-assembly"></a><a name="deploying"></a> Развертывание сборки
 [!INCLUDE[ssIS](../../includes/ssis-md.md)]Конструктор находит пользовательские объекты, доступные для использования в пакетах, перечисляя файлы, находящиеся в ряде папок, создаваемых при [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] установке. При [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] использовании параметров установки по умолчанию этот набор папок находится в папке **C:\PROGRAM Files\Microsoft SQL Server\120\DTS**. Однако при создании программы установки для пользовательского объекта следует проверить значение раздела реестра **HKEY_LOCAL_MACHINE \СОФТВАРЕ\МИКРОСОФТ\МИКРОСОФТ SQL Server\120\SSIS\Setup\DtsPath** , чтобы проверить расположение этой папки.

 Можно поместить сборку в папку двумя способами.

-   Переместить или скопировать скомпилированную сборку в соответствующую папку после ее построения. (Для удобства можно включить команду копирования в событие после построения.)

-   Построить сборку непосредственно в нужной папке.

 Следующие папки развертывания в папке **C:\Program FILES\MICROSOFT SQL Server\120\DTS** используются для различных типов пользовательских объектов:

|Пользовательский объект|Папка развертывания|
|-------------------|-----------------------|
|Задача|Задания|
|Диспетчер соединений|Соединения|
|Регистратор|LogProviders|
|Компонент потока данных|PipelineComponents|

> [!NOTE]
>  Сборки копируются в эти папки для поддержки перечисления доступных задач, диспетчеров соединений и т. д. Поэтому нет необходимости развертывать сборки, содержащие только пользовательский интерфейс для пользовательских объектов, в этих папках.

##  <a name="installing-the-assembly-in-the-global-assembly-cache"></a><a name="installing"></a> Установка сборки в глобальный кэш сборок
 Чтобы установить сборку задачи в глобальный кэш сборок (GAC), используйте программу командной строки **gacutil.exe** или перетащите сборки в каталог `%system%\assembly`. Для удобства можно включить вызов программы **gacutil.exe** в событие после построения.

 Следующая команда устанавливает компонент с именем *MyTask.dll* в глобальный кэш сборок (GAC) с помощью программы **gacutil.exe**.

 `gacutil /iF MyTask.dll`

 После установки новой версии пользовательского объекта необходимо закрыть и заново открыть конструктор служб [!INCLUDE[ssIS](../../includes/ssis-md.md)]. Если устаревшие версии пользовательского объекта были ранее установлены в глобальный кэш сборок, необходимо удалить их перед установкой новой версии. Чтобы удалить сборку, запустите программу **gacutil.exe** и укажите имя сборки с параметром `/u`.

 Дополнительные сведения о глобальном кэше сборок см. в разделе «Программа глобального кэша сборок (Gactutil.exe)» в документации по средствам платформы [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)].

##  <a name="troubleshooting-the-deployment"></a><a name="troubleshooting"></a> Устранение неполадок в развертывании
 Если пользовательский объект отображается на **панели элементов** или в списке доступных объектов, но его не удается добавить в пакет, попробуйте выполнить следующие действия:

1.  Выполните поиск в глобальном кэше сборок на предмет наличия в нем нескольких версий компонента. При наличии нескольких версий компонента в глобальном кэше сборок конструктор не может загрузить компонент. Удалите все экземпляры сборки из глобального кэша сборок и добавьте сборку заново.

2.  Убедитесь в том, что только один экземпляр сборки существует в папке развертывания.

3.  Обновите панель элементов.

4.  Подключитесь в среде [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] к файлу **devenv.exe** и установите точку останова, чтобы выполнить в пошаговом режиме код инициализации и убедиться в отсутствии исключений.

##  <a name="testing-and-debugging-your-code"></a><a name="testing"></a> Тестирование и отладка кода
 Самым простым подходом к отладке методов времени выполнения пользовательского объекта является запуск **dtexec.exe** из среды [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] после построения пользовательского объекта и выполнение пакета, использующего этот компонент.

 Если вы хотите отладить методы времени разработки компонента, например `Validate` метод, откройте пакет, который использует этот компонент во втором экземпляре [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] , и присоедините его к **devenv.exe** процессу.

 Если также требуется выполнить отладку методов времени выполнения компонента, когда пакет открыт и выполняется в конструкторе [!INCLUDE[ssIS](../../includes/ssis-md.md)], необходимо принудительно приостановить выполнение пакета с тем, чтобы можно было также присоединиться к процессу **DtsDebugHost.exe**.

#### <a name="to-debug-an-objects-run-time-methods-by-attaching-to-dtexecexe"></a>Отладка методов времени выполнения объекта путем подключения к dtexec.exe

1.  Подпишите и постройте проект в конфигурации отладки, выполните развертывание и установку в глобальный кэш сборок, как описано в этом разделе.

2.  На вкладке **Отладка** в **свойствах проекта**выберите **Запуск внешней программы** в качестве **действия при запуске**и укажите **dtexec.exe**, который устанавливается по умолчанию в папке C:\Program Files\Microsoft SQL Server\120\DTS\Binn.

3.  В текстовом поле **Параметры командной строки** в разделе **Параметры запуска** введите аргументы командной строки, необходимые для выполнения пакета, который использует пользовательский компонент. Часто аргумент командной строки содержит параметр /F[ILE], за которым следуют путь и имя DTSX-файла. Дополнительные сведения см. в статье [dtexec Utility](../packages/dtexec-utility.md).

4.  В исходном коде, где это необходимо, задайте точки останова в методах времени выполнения компонента.

5.  Выполните проект.

#### <a name="to-debug-a-custom-objects-design-time-methods-by-attaching-to-sql-server-data-tools"></a>Отладка методов времени разработки пользовательского объекта путем присоединения к SQL Server Data Tools

1.  Подпишите и постройте проект в конфигурации отладки, выполните развертывание и установку в глобальный кэш сборок, как описано в этом разделе.

2.  В исходном коде, где это необходимо, задайте точки останова в методах времени разработки пользовательского объекта.

3.  Откройте второй экземпляр среды [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] и загрузите проект служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], содержащий пакет, в котором используется пользовательский объект.

4.  В первом экземпляре среды [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] подключитесь ко второму экземпляру **devenv.exe**, в котором загружен пакет, выбрав команду **Присоединиться к процессу** в меню **Отладка** первого экземпляра.

5.  Выполните пакет из второго экземпляра среды [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)].

#### <a name="to-debug-a-custom-objects-run-time-methods-by-attaching-to-sql-server-data-tools"></a>Отладка методов времени выполнения пользовательского объекта путем присоединения к SQL Server Data Tools

1.  После выполнения шагов, описанных в предыдущей процедуре, принудительно приостановите выполнение пакета, чтобы его можно было присоединить к **DtsDebugHost.exe**. Принудительно приостановить выполнение можно путем добавления точки останова в событие `OnPreExecute` либо добавления задачи «Скрипт» в проект и ввода скрипта, отображающего модальное окно сообщения.

2.  Запустите пакет. Во время паузы переключитесь в экземпляр среды [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)], где открыт проект кода, и выберите команду **Присоединить для обработки** в меню **Отладка**. Подсоединяться следует к экземпляру **DtsDebugHost.exe**, содержащемуся в списке **Управляемые, x86** в столбце **Тип**, а не к экземпляру из списка **x86**.

3.  Вернитесь к приостановленному пакету и продолжите выполнение после точки останова либо нажмите кнопку **ОК**, чтобы закрыть окно сообщения, выданного задачей "Скрипт", и продолжить выполнение и отладку пакета.

![Значок Integration Services (маленький)](../media/dts-16.gif "Значок служб Integration Services (маленький)")  **следит за обновлениями Integration Services**<br /> Чтобы загрузить новейшую документацию, статьи, образцы и видеоматериалы корпорации Майкрософт, а также лучшие решения участников сообщества, посетите страницу служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] на сайте MSDN:<br /><br /> [Посетить страницу «Службы Integration Services» на сайте MSDN](https://go.microsoft.com/fwlink/?LinkId=136655)<br /><br /> Чтобы получать автоматические уведомления об этих обновлениях, подпишитесь на RSS-каналы, предлагаемые на этой странице.

## <a name="see-also"></a>См. также:
 [Разработка пользовательских объектов для Integration Services](developing-custom-objects-for-integration-services.md) [Сохранение пользовательских объектов](persisting-custom-objects.md) [средства устранения неполадок для разработки пакетов](../troubleshooting/troubleshooting-tools-for-package-development.md)


