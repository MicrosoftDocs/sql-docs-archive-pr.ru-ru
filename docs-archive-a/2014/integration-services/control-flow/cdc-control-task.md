---
title: Задача управления CDC | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.ssis.designer.cdccontroltask.f1
ms.assetid: 6404dc7f-550c-47cc-b901-c072742f430a
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 36f98a02842353fd5196432738f4ebd8b2efb46c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87658951"
---
# <a name="cdc-control-task"></a><span data-ttu-id="a71a1-102">Задача управления CDC</span><span class="sxs-lookup"><span data-stu-id="a71a1-102">CDC Control Task</span></span>
  <span data-ttu-id="a71a1-103">Задача «Управление CDC» используется для управления жизненным циклом пакетов системы отслеживания изменений данных (CDC).</span><span class="sxs-lookup"><span data-stu-id="a71a1-103">The CDC Control task is used to control the life cycle of change data capture (CDC) packages.</span></span> <span data-ttu-id="a71a1-104">Эта задача обеспечивает синхронизацию пакета CDC с пакетом начальной загрузки и управление диапазонами регистрационных номеров транзакций в журнале (номеров LSN), которые обрабатываются в прогоне пакета CDC.</span><span class="sxs-lookup"><span data-stu-id="a71a1-104">It handles CDC package synchronization with the initial load package, the management of Log Sequence Number (LSN) ranges that are processed in a run of a CDC package.</span></span> <span data-ttu-id="a71a1-105">Дополнительно задача «Управление CDC» связана со сценариями обработки ошибок и с восстановлением.</span><span class="sxs-lookup"><span data-stu-id="a71a1-105">In addition, the CDC Control task deals with error scenarios and recovery.</span></span>  
  
 <span data-ttu-id="a71a1-106">Задача «Управление CDC» поддерживает информацию состояния пакета CDC в переменной пакета служб SSIS и может также сохранить ее в таблице базы данных, что позволяет поддерживать состояние от одной активации пакета к другой, а также между несколькими пакетами, которые вместе выполняют общий процесс CDC (например, одна задача может отвечать за начальную загрузку, а другая — за обновления тонкого канала).</span><span class="sxs-lookup"><span data-stu-id="a71a1-106">The CDC Control task maintains the state of the CDC package in an SSIS package variable and it can also persist it in a database table so that the state is maintained across package activations and between multiple packages that together perform a common CDC process (for example, one task may be responsible for the initial loading and the other for the trickle-feed updates).</span></span>  
  
 <span data-ttu-id="a71a1-107">Задача «Управление CDC» поддерживает две группы операций.</span><span class="sxs-lookup"><span data-stu-id="a71a1-107">The CDC Control task supports two groups of operations.</span></span> <span data-ttu-id="a71a1-108">Одна группа обеспечивает синхронизацию начальной нагрузки и обработки изменений, а другая группа управляет диапазоном номеров LSN, связанных с обработкой изменений, для прогона пакета CDC, а также следит за тем, какая часть обработки была выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="a71a1-108">One group handles the synchronization of initial load and change processing, and the other manages the change-processing range of LSNs for a run of a CDC package and keeps track of what was processed successfully.</span></span>  
  
 <span data-ttu-id="a71a1-109">Для синхронизации начальной нагрузки и обработки изменений применяются следующие операции.</span><span class="sxs-lookup"><span data-stu-id="a71a1-109">The following operations handle the synchronization of initial load and change processing:</span></span>  
  
|<span data-ttu-id="a71a1-110">Операция</span><span class="sxs-lookup"><span data-stu-id="a71a1-110">Operation</span></span>|<span data-ttu-id="a71a1-111">Description</span><span class="sxs-lookup"><span data-stu-id="a71a1-111">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="a71a1-112">ResetCdcState</span><span class="sxs-lookup"><span data-stu-id="a71a1-112">ResetCdcState</span></span>|<span data-ttu-id="a71a1-113">Эта операция используется для сброса хранимого состояния CDC, связанного с текущим контекстом CDC.</span><span class="sxs-lookup"><span data-stu-id="a71a1-113">This operation is used to reset the persistent CDC state associated with the current CDC context.</span></span> <span data-ttu-id="a71a1-114">После выполнения этой операции текущий максимальный номер LSN из таблицы LSN-timestamp `sys.fn_cdc_get_max_lsn` становится началом следующего диапазона обработки.</span><span class="sxs-lookup"><span data-stu-id="a71a1-114">After this operation is run, the current maximum LSN from the LSN-timestamp `sys.fn_cdc_get_max_lsn` table becomes the start of the range for the next processing range.</span></span> <span data-ttu-id="a71a1-115">Эта операция требует создания соединения с базой данных-источником.</span><span class="sxs-lookup"><span data-stu-id="a71a1-115">This operation requires a connection to the source database.</span></span>|  
|<span data-ttu-id="a71a1-116">MarkInitialLoadStart</span><span class="sxs-lookup"><span data-stu-id="a71a1-116">MarkInitialLoadStart</span></span>|<span data-ttu-id="a71a1-117">Операция используется в начале пакета начальной загрузки для записи текущего номера LSN в базу данных-источник перед тем как пакет начальной загрузки начинает читать исходные таблицы.</span><span class="sxs-lookup"><span data-stu-id="a71a1-117">This operation is used at the beginning of an initial-load package to record the current LSN in the source database before the initial-load package starts reading the source tables.</span></span> <span data-ttu-id="a71a1-118">Для этого требуется соединение с базой данных-источником для вызова `sys.fn_cdc_get_max_lsn`.</span><span class="sxs-lookup"><span data-stu-id="a71a1-118">This requires a connection to the source database to call `sys.fn_cdc_get_max_lsn`.</span></span><br /><br /> <span data-ttu-id="a71a1-119">Если будет выбрано MarkInitialLoadStart при работе с CDC [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] (т. е. отличной от Oracle), то пользователем, указанным в диспетчере соединений, должен быть db_owner или sysadmin.</span><span class="sxs-lookup"><span data-stu-id="a71a1-119">If you select MarkInitialLoadStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is, not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="a71a1-120">MarkInitialLoadEnd</span><span class="sxs-lookup"><span data-stu-id="a71a1-120">MarkInitialLoadEnd</span></span>|<span data-ttu-id="a71a1-121">Эта операция используется в конце пакета начальной загрузки для записи текущего номера LSN в базу данных-источник после того, как пакет начальной нагрузки завершит чтение исходных таблиц.</span><span class="sxs-lookup"><span data-stu-id="a71a1-121">This operation is used at the end of an initial-load package to record the current LSN in the source database after the initial-load package finished reading the source tables.</span></span> <span data-ttu-id="a71a1-122">Номер LSN определяется путем записи текущего времени при осуществлении данной операции и последующего запроса таблицы сопоставления `cdc.lsn_time_`в базе данных CDC для поиска любого изменения, которое произошло в последующее время.</span><span class="sxs-lookup"><span data-stu-id="a71a1-122">This LSN is determined by recording the current time when this operation occurred and then querying the `cdc.lsn_time_`mapping table in the CDC database looking for a change that occurred after that time.</span></span><br /><br /> <span data-ttu-id="a71a1-123">Если будет выбрано MarkInitialLoadEnd при работе с CDC [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] (т. е. отличной от Oracle), то пользователем, указанным в диспетчере соединений, должен быть db_owner или sysadmin.</span><span class="sxs-lookup"><span data-stu-id="a71a1-123">If you select MarkInitialLoadEnd when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="a71a1-124">MarkCdcStart</span><span class="sxs-lookup"><span data-stu-id="a71a1-124">MarkCdcStart</span></span>|<span data-ttu-id="a71a1-125">Эта операция используется, если начальная загрузка выполняется из базы данных моментальных снимков.</span><span class="sxs-lookup"><span data-stu-id="a71a1-125">This operation is used when then the initial load is made from a snapshot database.</span></span> <span data-ttu-id="a71a1-126">В таком случае обработка изменений должна начаться с номера, который непосредственно следует за номером LSN моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="a71a1-126">In this case, the change processing should start immediately after the snapshot LSN.</span></span> <span data-ttu-id="a71a1-127">Можно указать имя используемой базы данных моментальных снимков, и задача «Управление CDC» запросит в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] номер LSN моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="a71a1-127">You can specify the name of the snapshot database to use and the CDC Control task queries [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] for the snapshot LSN.</span></span> <span data-ttu-id="a71a1-128">Предусмотрена также возможность непосредственно указать номер LSN моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="a71a1-128">You also have the option to directly specify the snapshot LSN.</span></span><br /><br /> <span data-ttu-id="a71a1-129">Если будет выбрано MarkCdcStart при работе с CDC [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] (т. е. отличной от Oracle), то пользователем, указанным в диспетчере соединений, должен быть db_owner или sysadmin.</span><span class="sxs-lookup"><span data-stu-id="a71a1-129">If you select MarkCdcStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
  
 <span data-ttu-id="a71a1-130">Для управления диапазоном обработки предназначены следующие операции:</span><span class="sxs-lookup"><span data-stu-id="a71a1-130">The following operations are used to manage the processing range:</span></span>  
  
|<span data-ttu-id="a71a1-131">Операция</span><span class="sxs-lookup"><span data-stu-id="a71a1-131">Operation</span></span>|<span data-ttu-id="a71a1-132">Description</span><span class="sxs-lookup"><span data-stu-id="a71a1-132">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="a71a1-133">GetProcessingRange</span><span class="sxs-lookup"><span data-stu-id="a71a1-133">GetProcessingRange</span></span>|<span data-ttu-id="a71a1-134">Эта операция используется перед вызовом потока данных, в котором применяется поток исходных данных CDC.</span><span class="sxs-lookup"><span data-stu-id="a71a1-134">This operation is used before invoking the data flow that uses the CDC Source data flow.</span></span> <span data-ttu-id="a71a1-135">Операция устанавливает диапазон номеров LSN, считываемый потоком исходных данных CDC при вызове.</span><span class="sxs-lookup"><span data-stu-id="a71a1-135">It establishes a range of LSNs that the CDC Source data flow reads when invoked.</span></span> <span data-ttu-id="a71a1-136">Этот диапазон хранится в переменной пакета служб SSIS, которая используется источником CDC во время обработки потока данных.</span><span class="sxs-lookup"><span data-stu-id="a71a1-136">The range is stored in an SSIS package variable that is used by the CDC Source during data-flow processing.</span></span><br /><br /> <span data-ttu-id="a71a1-137">Дополнительные сведения о сохраненных состояниях см. в разделе [Определение переменной состояния](../data-flow/define-a-state-variable.md).</span><span class="sxs-lookup"><span data-stu-id="a71a1-137">For more information about the states that are stored, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>|  
|<span data-ttu-id="a71a1-138">MarkProcessedRange</span><span class="sxs-lookup"><span data-stu-id="a71a1-138">MarkProcessedRange</span></span>|<span data-ttu-id="a71a1-139">Эта операция выполняется после каждого прогона CDC (после успешного завершения потока данных CDC) для записи последнего номера LSN, который был полностью обработан в прогоне CDC.</span><span class="sxs-lookup"><span data-stu-id="a71a1-139">: This operation is executed after each CDC run (after the CDC data flow is completed successfully) to record the last LSN that was fully processed in the CDC run.</span></span> <span data-ttu-id="a71a1-140">При следующем вызове GetProcessingRange на выполнение эта позиция становится началом диапазона обработки.</span><span class="sxs-lookup"><span data-stu-id="a71a1-140">The next time GetProcessingRange is executed, this position is the start of the processing range.</span></span>|  
  
## <a name="handling-cdc-state-persistency"></a><span data-ttu-id="a71a1-141">Обработка сохраняемого состояния CDC</span><span class="sxs-lookup"><span data-stu-id="a71a1-141">Handling CDC State Persistency</span></span>  
 <span data-ttu-id="a71a1-142">Задача «Управление CDC» поддерживает сохраняемое состояние от одной активации к другой.</span><span class="sxs-lookup"><span data-stu-id="a71a1-142">The CDC Control task maintains a persistent state between activations.</span></span> <span data-ttu-id="a71a1-143">Информация, сохраняемая в состоянии CDC, используется в целях определения и сопровождения диапазона обработки для пакета CDC, а также в целях обнаружения условий возникновения ошибок.</span><span class="sxs-lookup"><span data-stu-id="a71a1-143">The information stored in the CDC state is used to determine and maintain the processing range for the CDC package and for detecting error conditions.</span></span> <span data-ttu-id="a71a1-144">Информация о сохраняемом состоянии представлена в виде строки.</span><span class="sxs-lookup"><span data-stu-id="a71a1-144">The persistent state is stored as a string.</span></span> <span data-ttu-id="a71a1-145">Дополнительные сведения см. в статье [Определение переменной состояния](../data-flow/define-a-state-variable.md).</span><span class="sxs-lookup"><span data-stu-id="a71a1-145">For more information, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>  
  
 <span data-ttu-id="a71a1-146">Задача «Управление CDC» поддерживает два типа сохранения состояния</span><span class="sxs-lookup"><span data-stu-id="a71a1-146">The CDC Control task supports two types of state persistency</span></span>  
  
-   <span data-ttu-id="a71a1-147">Сохранение состояния вручную. В этом случае задача управления CDC управляет состоянием, сохраненным в переменной пакета, но разработчик пакета должен считывать переменную из постоянного хранилища перед вызовом запроса управления CDC, а затем снова записывать ее назад в постоянное хранилище после последнего вызова запроса управления CDC и завершения прогона CDC.</span><span class="sxs-lookup"><span data-stu-id="a71a1-147">Manual State Persistency: In this case, the CDC Control task manages the state stored in a package variable but the package developer must read the variable from a persistent store before calling the CDC Control and then write it back to that persistent store after the CDC Control is last called and the CDC run completes.</span></span>  
  
-   <span data-ttu-id="a71a1-148">Автоматическое сохранение состояния. Информация о состоянии CDC хранится в таблице в базе данных.</span><span class="sxs-lookup"><span data-stu-id="a71a1-148">Automatic State Persistency: The CDC state is stored in a table in a database.</span></span> <span data-ttu-id="a71a1-149">Информация о состоянии хранится под именем, предоставленным в свойстве **StateName** в таблице, указанной в свойстве **Таблица для хранения состояния** , которую можно найти в диспетчере соединений, выбранном для сохранения состояния.</span><span class="sxs-lookup"><span data-stu-id="a71a1-149">The state is stored under a name provided in the **StateName** property in a table named in the **Table to Use for Storing State** property, which is located in a selected connection manager for storing the state.</span></span> <span data-ttu-id="a71a1-150">По умолчанию применяется диспетчер соединений с источником, но чаще всего используется диспетчер соединений с назначением.</span><span class="sxs-lookup"><span data-stu-id="a71a1-150">The default is the source connection manager but the common practice is for it to be the target connection manager.</span></span> <span data-ttu-id="a71a1-151">Задача «Управление CDC» обновляет значение состояния в таблице состояний, и это значение фиксируется в составе включающей транзакции.</span><span class="sxs-lookup"><span data-stu-id="a71a1-151">The CDC Control task updates the state value in the state table and this is committed as part of the ambient transaction.</span></span>  
  
## <a name="error-handling"></a><span data-ttu-id="a71a1-152">Обработка ошибок</span><span class="sxs-lookup"><span data-stu-id="a71a1-152">Error Handling</span></span>  
 <span data-ttu-id="a71a1-153">Задача «Управление CDC» может сообщать об ошибках в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="a71a1-153">The CDC Control task may report an error when:</span></span>  
  
-   <span data-ttu-id="a71a1-154">В задаче не удается считать хранимое состояние CDC, или обновление сохраняемого состояния оканчивается неудачей.</span><span class="sxs-lookup"><span data-stu-id="a71a1-154">It fails to read the persistent CDC state or when updating the persistent state fails.</span></span>  
  
-   <span data-ttu-id="a71a1-155">В задаче не удается считать информацию о текущем номере LSN из базы данных-источника.</span><span class="sxs-lookup"><span data-stu-id="a71a1-155">It fails to read the current LSN information from the source database.</span></span>  
  
-   <span data-ttu-id="a71a1-156">Операция чтения состояния CDC не согласована.</span><span class="sxs-lookup"><span data-stu-id="a71a1-156">The CDC state read is not consistent.</span></span>  
  
 <span data-ttu-id="a71a1-157">Во всех этих случаях задача «Управление CDC» сообщает об ошибке, которая может быть обработана стандартным способом, применяемым в службе SSIS для обработки ошибок потока управления.</span><span class="sxs-lookup"><span data-stu-id="a71a1-157">In all of these cases, the CDC Control task reports an error that can be handled in the standard way SSIS handles control-flow errors.</span></span>  
  
 <span data-ttu-id="a71a1-158">Задача «Управление CDC» может также выдать предупреждение, если операция «Получить диапазон обработки» вызывается непосредственно после другой операции «Получить диапазон обработки» без вызова операции «Отметить обработанный диапазон».</span><span class="sxs-lookup"><span data-stu-id="a71a1-158">The CDC Control task may also report a warning when the Get Processing Range operation is invoked directly after another Get Processing Range operation without Mark Processed Range being called.</span></span> <span data-ttu-id="a71a1-159">Такая ситуация указывает на то, что предыдущий прогон окончился неудачей или что, возможно, выполняется еще один пакет CDC, в котором используется то же имя состояния CDC.</span><span class="sxs-lookup"><span data-stu-id="a71a1-159">This is an indication that the previous run failed or that another CDC package may be running using the same CDC state name.</span></span>  
  
## <a name="configuring-the-cdc-control-task"></a><span data-ttu-id="a71a1-160">Настройка задачи «Управление CDC»</span><span class="sxs-lookup"><span data-stu-id="a71a1-160">Configuring the CDC Control Task</span></span>  
 <span data-ttu-id="a71a1-161">Свойства могут быть заданы с помощью конструктора SSIS или программным путем.</span><span class="sxs-lookup"><span data-stu-id="a71a1-161">You can set properties through SSIS Designer or programmatically.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="a71a1-162">в этом разделе</span><span class="sxs-lookup"><span data-stu-id="a71a1-162">In This Section</span></span>  
  
-   [<span data-ttu-id="a71a1-163">CDC Control Task Editor</span><span class="sxs-lookup"><span data-stu-id="a71a1-163">CDC Control Task Editor</span></span>](../cdc-control-task-editor.md)  
  
-   [<span data-ttu-id="a71a1-164">Пользовательские свойства задач управления CDC</span><span class="sxs-lookup"><span data-stu-id="a71a1-164">CDC Control Task Custom Properties</span></span>](cdc-control-task-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="a71a1-165">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="a71a1-165">Related Tasks</span></span>  
 [<span data-ttu-id="a71a1-166">Определение переменной состояния</span><span class="sxs-lookup"><span data-stu-id="a71a1-166">Define a State Variable</span></span>](../data-flow/define-a-state-variable.md)  
  
## <a name="related-content"></a><span data-ttu-id="a71a1-167">См. также</span><span class="sxs-lookup"><span data-stu-id="a71a1-167">Related Content</span></span>  
  
-   <span data-ttu-id="a71a1-168">Техническую статью [Установка системы отслеживания измененных данных Microsoft SQL Server 2012 для Oracle компании Attunity](https://go.microsoft.com/fwlink/?LinkId=252958)см. на сайте social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="a71a1-168">Technical article, [Installing Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252958), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="a71a1-169">Техническую статью [Устранение неполадок в конфигурации системы отслеживания измененных данных Майкрософт для Oracle компании Attunity](https://go.microsoft.com/fwlink/?LinkId=252960)см. на сайте social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="a71a1-169">Technical article, [Troubleshoot Configuration Issues in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252960), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="a71a1-170">Техническую статью [Устранение неполадок в конфигурации системы отслеживания измененных данных Майкрософт для Oracle компании Attunity](https://go.microsoft.com/fwlink/?LinkId=252961)см. на сайте social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="a71a1-170">Technical article, [Troubleshoot CDC Instance Errors in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252961), on social.technet.microsoft.com.</span></span>  
  
  
