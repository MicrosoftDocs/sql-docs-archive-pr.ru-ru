---
title: Просмотр файлов и таблиц Excel с помощью контейнера "Цикл по каждому элементу" | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- connections [Integration Services], Excel
- Excel [Integration Services]
- connection managers [Integration Services], Excel
ms.assetid: a5393c1a-cc37-491a-a260-7aad84dbff68
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 51de779b6869d80245302741035e6169aa750c83
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87658337"
---
# <a name="loop-through-excel-files-and-tables-by-using-a-foreach-loop-container"></a><span data-ttu-id="03bef-102">Просмотр файлов и таблиц Excel с помощью контейнера "Цикл по каждому элементу"</span><span class="sxs-lookup"><span data-stu-id="03bef-102">Loop through Excel Files and Tables by Using a Foreach Loop Container</span></span>
  <span data-ttu-id="03bef-103">Процедуры в этом разделе описывают, как выполнить цикл по книгам Excel в папке или цикл по таблицам в книге Excel с помощью контейнера «цикл по каждому элементу» с соответствующим перечислителем.</span><span class="sxs-lookup"><span data-stu-id="03bef-103">The procedures in this topic describe how to loop through the Excel workbooks in a folder, or through the tables in an Excel workbook, by using the Foreach Loop container with the appropriate enumerator.</span></span>  
  
### <a name="to-loop-through-excel-files-by-using-the-foreach-file-enumerator"></a><span data-ttu-id="03bef-104">Организация цикла по файлам Excel с помощью перечислителя с циклом по каждому файлу</span><span class="sxs-lookup"><span data-stu-id="03bef-104">To loop through Excel files by using the Foreach File enumerator</span></span>  
  
1.  <span data-ttu-id="03bef-105">Создайте строковую переменную, которая будет принимать значение текущего пути и имени файла Excel для каждой итерации цикла.</span><span class="sxs-lookup"><span data-stu-id="03bef-105">Create a string variable that will receive the current Excel path and file name on each iteration of the loop.</span></span> <span data-ttu-id="03bef-106">Чтобы избежать проверки данных, присвойте переменной в качестве начального значения путь и имя существующего файла Excel.</span><span class="sxs-lookup"><span data-stu-id="03bef-106">To avoid validation issues, assign a valid Excel path and file name as the initial value of the variable.</span></span> <span data-ttu-id="03bef-107">(Образец выражения, показанный ниже, использует в этой процедуре переменную `ExcelFile`.)</span><span class="sxs-lookup"><span data-stu-id="03bef-107">(The sample expression shown later in this procedure uses the variable name, `ExcelFile`.)</span></span>  
  
2.  <span data-ttu-id="03bef-108">При желании создайте другую строковую переменную, которая будет хранить значение аргумента для дополнительных свойств строки соединения с Excel.</span><span class="sxs-lookup"><span data-stu-id="03bef-108">Optionally, create another string variable that will hold the value for the Extended Properties argument of the Excel connection string.</span></span> <span data-ttu-id="03bef-109">Этот аргумент содержит серию значений, которые задают версию Excel и определяют, будет ли первая строка содержать имена столбцов и будет ли использован режим импорта.</span><span class="sxs-lookup"><span data-stu-id="03bef-109">This argument contains a series of values that specify the Excel version and determine whether the first row contains column names, and whether import mode is used.</span></span> <span data-ttu-id="03bef-110">(Образец выражения, показанный ниже, использует в этой процедуре имя переменной `ExtProperties`с начальным значением "`Excel 8.0;HDR=Yes`".)</span><span class="sxs-lookup"><span data-stu-id="03bef-110">(The sample expression shown later in this procedure uses the variable name `ExtProperties`, with an initial value of "`Excel 8.0;HDR=Yes`".)</span></span>  
  
     <span data-ttu-id="03bef-111">Если в аргументе расширенных свойств не используется переменная, то в выражение, которое содержит строку подключения, ее необходимо добавить вручную.</span><span class="sxs-lookup"><span data-stu-id="03bef-111">If you do not use a variable for the Extended Properties argument, then you must add it manually to the expression that contains the connection string.</span></span>  
  
3.  <span data-ttu-id="03bef-112">Добавьте контейнер «цикл по каждому элементу» на вкладку **поток управления** . Дополнительные сведения о настройке контейнера «цикл по каждому элементу» см. в разделе [Настройка контейнера «цикл по каждому элементу](foreach-loop-container.md)».</span><span class="sxs-lookup"><span data-stu-id="03bef-112">Add a Foreach Loop container to the **Control Flow** tab. For information about how to configure the Foreach Loop Container, see [Configure a Foreach Loop Container](foreach-loop-container.md).</span></span>  
  
4.  <span data-ttu-id="03bef-113">На странице **Коллекция** в **редакторе циклов по каждому элементу**выберите "Перечислитель с циклом по каждому файлу", задайте папку, в которой размещаются книги Excel, и фильтр файлов (обычно \*.xls).</span><span class="sxs-lookup"><span data-stu-id="03bef-113">On the **Collection** page of the **Foreach Loop Editor**, select the Foreach File enumerator, specify the folder in which the Excel workbooks are located, and specify the file filter (ordinarily \*.xls).</span></span>  
  
5.  <span data-ttu-id="03bef-114">На странице **Сопоставления переменной** сопоставьте Index 0 с определенной пользователем строковой переменной, которая будет принимать значение текущего пути Excel и имени файла на каждой итерации цикла.</span><span class="sxs-lookup"><span data-stu-id="03bef-114">On the **Variable Mapping** page, map Index 0 to a user-defined string variable that will receive the current Excel path and file name on each iteration of the loop.</span></span> <span data-ttu-id="03bef-115">(Образец выражения, показанный ниже, использует в этой процедуре переменную `ExcelFile`.)</span><span class="sxs-lookup"><span data-stu-id="03bef-115">(The sample expression shown later in this procedure uses the variable name `ExcelFile`.)</span></span>  
  
6.  <span data-ttu-id="03bef-116">Закройте **Редактор циклов по каждому элементу**.</span><span class="sxs-lookup"><span data-stu-id="03bef-116">Close the **Foreach Loop Editor**.</span></span>  
  
7.  <span data-ttu-id="03bef-117">Добавьте диспетчер подключений к Excel в пакет, как описано в разделе [Добавление, удаление или совместное использование диспетчера соединений в пакете](../add-delete-or-share-a-connection-manager-in-a-package.md).</span><span class="sxs-lookup"><span data-stu-id="03bef-117">Add an Excel connection manager to the package as described in [Add, Delete, or Share a Connection Manager in a Package](../add-delete-or-share-a-connection-manager-in-a-package.md).</span></span> <span data-ttu-id="03bef-118">Чтобы избежать ошибок проверки, выберите для подключения существующий файл книги Excel.</span><span class="sxs-lookup"><span data-stu-id="03bef-118">Select an existing Excel workbook file for the connection to avoid validation errors.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="03bef-119">Чтобы избежать ошибок проверки после настройки задач и компонентов потоков данных, которые используют этот диспетчер подключений Excel, выберите существующую книгу Excel в окне **Редакторе диспетчера соединений Excel**.</span><span class="sxs-lookup"><span data-stu-id="03bef-119">To avoid validation errors as you configure tasks and data flow components that use this Excel connection manager, select an existing Excel workbook in the **Excel Connection Manager Editor**.</span></span> <span data-ttu-id="03bef-120">Диспетчер соединений не будет использовать эту книгу в процессе выполнения, если настроить выражение для свойства `ConnectionString`, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="03bef-120">The connection manager will not use this workbook at run time after you configure an expression for the `ConnectionString` property as described in the following steps.</span></span> <span data-ttu-id="03bef-121">После создания и настройки пакета можно очистить значение свойства `ConnectionString` в окне свойств.</span><span class="sxs-lookup"><span data-stu-id="03bef-121">After you create and configure the package, you can clear the value of the `ConnectionString` property in the Properties window.</span></span> <span data-ttu-id="03bef-122">Однако если очистить это значение, свойство строки соединения диспетчера соединений Excel не будет действительно до запуска контейнера «цикл по каждому элементу».</span><span class="sxs-lookup"><span data-stu-id="03bef-122">However, if you clear this value, the connection string property of the Excel connection manager is no longer valid until the Foreach Loop runs.</span></span> <span data-ttu-id="03bef-123">Следовательно, необходимо присвоить свойству `DelayValidation` значение `True` в задачах, где используется диспетчер соединений, или в пакете, чтобы избежать ошибок проверки.</span><span class="sxs-lookup"><span data-stu-id="03bef-123">Therefore you must set the `DelayValidation` property to `True` on the tasks in which the connection manager is used, or on the package, to avoid validation errors.</span></span>  
    >   
    >  <span data-ttu-id="03bef-124">Необходимо также использовать значения по умолчанию `False` для свойства `RetainSameConnection` диспетчера соединений Excel.</span><span class="sxs-lookup"><span data-stu-id="03bef-124">You must also use the default value of `False` for the `RetainSameConnection` property of the Excel connection manager.</span></span> <span data-ttu-id="03bef-125">При изменении этого значения на `True` каждая итерация цикла будет по-прежнему открывать первую книгу Excel.</span><span class="sxs-lookup"><span data-stu-id="03bef-125">If you change this value to `True`, each iteration of the loop will continue to open the first Excel workbook.</span></span>  
  
8.  <span data-ttu-id="03bef-126">Выберите новый диспетчер подключений Excel, щелкните свойство **Выражения** в окне свойств и нажмите кнопку с многоточием.</span><span class="sxs-lookup"><span data-stu-id="03bef-126">Select the new Excel connection manager, click the **Expressions** property in the Properties window, and then click the ellipsis.</span></span>  
  
9. <span data-ttu-id="03bef-127">В **редакторе выражений свойств**выберите `ConnectionString` свойство и нажмите кнопку с многоточием.</span><span class="sxs-lookup"><span data-stu-id="03bef-127">In the **Property Expressions Editor**, select the `ConnectionString` property, and then click the ellipsis.</span></span>  
  
10. <span data-ttu-id="03bef-128">В построителе выражения введите следующее выражение.</span><span class="sxs-lookup"><span data-stu-id="03bef-128">In the Expression Builder, enter the following expression:</span></span>  
  
    ```  
    "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  @[User::ExcelFile] + ";Extended Properties=\"" + @[User::ExtProperties] + "\""  
    ```  
  
     <span data-ttu-id="03bef-129">Обратите внимание на использование escape-символа "\\" для обозначения внутренних кавычек, в которые должно быть заключено значения аргумента расширенных свойств.</span><span class="sxs-lookup"><span data-stu-id="03bef-129">Note the use of the escape character "\\" to escape the inner quotation marks required around the value of the Extended Properties argument.</span></span>  
  
     <span data-ttu-id="03bef-130">Аргумент расширенных свойств является обязательным.</span><span class="sxs-lookup"><span data-stu-id="03bef-130">The Extended Properties argument is not optional.</span></span> <span data-ttu-id="03bef-131">Если для этого значения не используется переменная, то его необходимо вручную добавить в выражение, как в следующем примере для файла Excel 2003.</span><span class="sxs-lookup"><span data-stu-id="03bef-131">If you do not use a variable to contain its value, then you must add it manually to the expression, as in the following example for an Excel 2003 file:</span></span>  
  
    ```  
    "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  @[User::ExcelFile] + ";Extended Properties=Excel 8.0"  
    ```  
  
11. <span data-ttu-id="03bef-132">Создайте задачи в контейнере «цикл по каждому элементу», которые используют диспетчер соединений с Excel для выполнения одинаковых операций для каждой книги Excel, соответствующей заданному положению и шаблону файла.</span><span class="sxs-lookup"><span data-stu-id="03bef-132">Create tasks in the Foreach Loop container that use the Excel connection manager to perform the same operations on each Excel workbook that matches the specified file location and pattern.</span></span>  
  
### <a name="to-loop-through-excel-tables-by-using-the-foreach-adonet-schema-rowset-enumerator"></a><span data-ttu-id="03bef-133">Организация цикла по таблицам Excel с помощью перечислителя по набору строк схемы ADO.NET</span><span class="sxs-lookup"><span data-stu-id="03bef-133">To loop through Excel tables by using the Foreach ADO.NET Schema Rowset enumerator</span></span>  
  
1.  <span data-ttu-id="03bef-134">Создайте диспетчер соединений ADO.NET, который использует поставщик Microsoft Jet OLE DB для подключения к книге Excel.</span><span class="sxs-lookup"><span data-stu-id="03bef-134">Create an ADO.NET connection manager that uses the Microsoft Jet OLE DB Provider to connect to an Excel workbook.</span></span> <span data-ttu-id="03bef-135">На странице "Все" диалогового окна **Диспетчер соединений** убедитесь, что в качестве значения расширенных свойств введено Excel 8.0.</span><span class="sxs-lookup"><span data-stu-id="03bef-135">On the All page of the **Connection Manager** dialog box, make sure that you enter Excel 8.0 as the value of the Extended Properties property.</span></span> <span data-ttu-id="03bef-136">Дополнительные сведения см. в статье [Добавление, удаление или совместное использование диспетчера соединений в пакете](../add-delete-or-share-a-connection-manager-in-a-package.md).</span><span class="sxs-lookup"><span data-stu-id="03bef-136">For more information, see [Add, Delete, or Share a Connection Manager in a Package](../add-delete-or-share-a-connection-manager-in-a-package.md).</span></span>  
  
2.  <span data-ttu-id="03bef-137">Создайте строковую переменную, которая будет принимать имя текущий таблицы на каждой итерации цикла.</span><span class="sxs-lookup"><span data-stu-id="03bef-137">Create a string variable that will receive the name of the current table on each iteration of the loop.</span></span>  
  
3.  <span data-ttu-id="03bef-138">Добавьте контейнер «цикл по каждому элементу» на вкладку **поток управления** . Дополнительные сведения о настройке контейнера «цикл по каждому элементу» см. в разделе [Настройка контейнера «цикл по каждому элементу](foreach-loop-container.md)».</span><span class="sxs-lookup"><span data-stu-id="03bef-138">Add a Foreach Loop container to the **Control Flow** tab. For information about how to configure the Foreach Loop container, see [Configure a Foreach Loop Container](foreach-loop-container.md).</span></span>  
  
4.  <span data-ttu-id="03bef-139">На странице **Коллекция** в **редакторе циклов по каждому элементу**выберите перечислитель набора строк схемы ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="03bef-139">On the **Collection** page of the **Foreach Loop Editor**, select the Foreach ADO.NET Schema Rowset enumerator.</span></span>  
  
5.  <span data-ttu-id="03bef-140">В качестве значения **Соединение**выберите предварительно созданный диспетчер подключений ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="03bef-140">As the value of **Connection**, select the ADO.NET connection manager that you created previously.</span></span>  
  
6.  <span data-ttu-id="03bef-141">В качестве значения **Схема**выберите "Таблицы".</span><span class="sxs-lookup"><span data-stu-id="03bef-141">As the value of **Schema**, select Tables.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="03bef-142">Список таблиц в книге Excel включает в себя и листы (которые имеют суффикс $), и именованные диапазоны.</span><span class="sxs-lookup"><span data-stu-id="03bef-142">The list of tables in an Excel workbook includes both worksheets (which have the $ suffix) and named ranges.</span></span> <span data-ttu-id="03bef-143">Если нужно отфильтровать список только по листам или только по именованным диапазонам, то, возможно, для этой цели понадобится написать свою программу в задаче «Скрипт».</span><span class="sxs-lookup"><span data-stu-id="03bef-143">If you have to filter the list for only worksheets or only named ranges, you may have to write custom code in a Script task for this purpose.</span></span> <span data-ttu-id="03bef-144">Дополнительные сведения см. в статье [Работа с файлами Excel в задаче "Скрипт"](script-task.md).</span><span class="sxs-lookup"><span data-stu-id="03bef-144">For more information, see [Working with Excel Files with the Script Task](script-task.md).</span></span>  
  
7.  <span data-ttu-id="03bef-145">На странице **Сопоставления переменной** сопоставьте Index 2 со строковой переменной, созданной ранее для хранения имени текущей таблицы.</span><span class="sxs-lookup"><span data-stu-id="03bef-145">On the **Variable Mappings** page, map Index 2 to the string variable created earlier to hold the name of the current table.</span></span>  
  
8.  <span data-ttu-id="03bef-146">Закройте **Редактор циклов по каждому элементу**.</span><span class="sxs-lookup"><span data-stu-id="03bef-146">Close the **Foreach Loop Editor**.</span></span>  
  
9. <span data-ttu-id="03bef-147">Создайте задачи в контейнере «цикл по каждому элементу», которые используют диспетчер соединений Excel для выполнения одинаковых операций для каждой таблицы Excel в заданной книге.</span><span class="sxs-lookup"><span data-stu-id="03bef-147">Create tasks in the Foreach Loop container that use the Excel connection manager to perform the same operations on each Excel table in the specified workbook.</span></span> <span data-ttu-id="03bef-148">Если задача "Скрипт" используется для анализа имени перечисляемой таблицы или работы с каждой таблицей, не забудьте добавить строковую переменную к свойству ReadOnlyVariables задачи "Скрипт".</span><span class="sxs-lookup"><span data-stu-id="03bef-148">If you use a Script Task to examine the enumerated table name or to work with each table, remember to add the string variable to the ReadOnlyVariables property of the Script task.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="03bef-149">См. также:</span><span class="sxs-lookup"><span data-stu-id="03bef-149">See Also</span></span>  
 <span data-ttu-id="03bef-150">[Импорт данных из Excel или экспорт данных в Excel с помощью SQL Server Integration Services (SSIS)](../load-data-to-from-excel-with-ssis.md) [Настройка контейнера «цикл по каждому элементу](foreach-loop-container.md) » </span><span class="sxs-lookup"><span data-stu-id="03bef-150">[Import data from Excel or export data to Excel with SQL Server Integration Services (SSIS)](../load-data-to-from-excel-with-ssis.md) [Configure a Foreach Loop Container](foreach-loop-container.md) </span></span>  
 <span data-ttu-id="03bef-151">[Добавление или изменение выражения свойства](../expressions/add-or-change-a-property-expression.md) </span><span class="sxs-lookup"><span data-stu-id="03bef-151">[Add or Change a Property Expression](../expressions/add-or-change-a-property-expression.md) </span></span>  
 <span data-ttu-id="03bef-152">[Диспетчер соединений с Excel](../connection-manager/excel-connection-manager.md) </span><span class="sxs-lookup"><span data-stu-id="03bef-152">[Excel Connection Manager](../connection-manager/excel-connection-manager.md) </span></span>  
 <span data-ttu-id="03bef-153">[Источник Excel](../data-flow/excel-source.md) </span><span class="sxs-lookup"><span data-stu-id="03bef-153">[Excel Source](../data-flow/excel-source.md) </span></span>  
 <span data-ttu-id="03bef-154">[Назначение «Excel»](../data-flow/excel-destination.md) </span><span class="sxs-lookup"><span data-stu-id="03bef-154">[Excel Destination](../data-flow/excel-destination.md) </span></span>  
 [<span data-ttu-id="03bef-155">Работа с файлами Excel в задаче «Скрипт»</span><span class="sxs-lookup"><span data-stu-id="03bef-155">Working with Excel Files with the Script Task</span></span>](script-task.md)  
  
  
