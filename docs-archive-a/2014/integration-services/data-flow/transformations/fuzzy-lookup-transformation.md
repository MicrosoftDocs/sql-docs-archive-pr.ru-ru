---
title: Преобразование "Нечеткий уточняющий запрос" | Документы Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.dts.designer.fuzzylookuptrans.f1
helpviewer_keywords:
- cleaning data
- comparing data
- token delimiters [Integration Services]
- temporary indexes [Integration Services]
- temporary tables [Integration Services]
- Fuzzy Lookup transformation
- reference tables [Integration Services]
- match similar data [Integration Services]
- replacing missing values
- correcting data [Integration Services]
- cache [Integration Services]
- standardizing data [Integration Services]
- lookups [Integration Services]
- confidence scores [Integration Services]
- fuzzy matches
- missing values replaced [Integration Services]
- similarity thresholds [Integration Services]
ms.assetid: 019db426-3de2-4ca9-8667-79fd9a47a068
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 742a87e7425fd65b8af7bcda87c237151d382f77
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87665456"
---
# <a name="fuzzy-lookup-transformation"></a><span data-ttu-id="5b691-102">преобразование «Нечеткий уточняющий запрос»</span><span class="sxs-lookup"><span data-stu-id="5b691-102">Fuzzy Lookup Transformation</span></span>
  <span data-ttu-id="5b691-103">Преобразование «Нечеткий уточняющий запрос» выполняет задачи по очистке данных, такие как стандартизация данных, исправление данных и предоставление отсутствующих значений.</span><span class="sxs-lookup"><span data-stu-id="5b691-103">The Fuzzy Lookup transformation performs data cleaning tasks such as standardizing data, correcting data, and providing missing values.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5b691-104">Дополнительные сведения о преобразовании "Нечеткий уточняющий запрос", в том числе сведения об ограничениях производительности и памяти, см. в техническом документе [Преобразования "Нечеткий уточняющий запрос" и "Нечеткое группирование" в службах SQL Server Integration Services 2005](https://go.microsoft.com/fwlink/?LinkId=96604).</span><span class="sxs-lookup"><span data-stu-id="5b691-104">For more detailed information about the Fuzzy Lookup transformation, including performance and memory limitations, see the white paper, [Fuzzy Lookup and Fuzzy Grouping in SQL Server Integration Services 2005](https://go.microsoft.com/fwlink/?LinkId=96604).</span></span>  
  
 <span data-ttu-id="5b691-105">Преобразование «Нечеткий уточняющий запрос» отличается от преобразования «Уточняющий запрос» использованием нечеткого соответствия.</span><span class="sxs-lookup"><span data-stu-id="5b691-105">The Fuzzy Lookup transformation differs from the Lookup transformation in its use of fuzzy matching.</span></span> <span data-ttu-id="5b691-106">Преобразование «Уточняющий запрос» использует эквивалентное соединение для обнаружения совпадающих записей в ссылочной таблице.</span><span class="sxs-lookup"><span data-stu-id="5b691-106">The Lookup transformation uses an equi-join to locate matching records in the reference table.</span></span> <span data-ttu-id="5b691-107">Возвращает записи хотя бы с одной совпадающей записью и возвращает записи без совпадающих записей.</span><span class="sxs-lookup"><span data-stu-id="5b691-107">It returns records with at least one matching record, and returns records with no matching records.</span></span> <span data-ttu-id="5b691-108">В то же время преобразование «Нечеткий уточняющий запрос» замечает и нечеткие соответствия, возвращая одну или несколько похожих записей из ссылочной таблицы.</span><span class="sxs-lookup"><span data-stu-id="5b691-108">In contrast, the Fuzzy Lookup transformation uses fuzzy matching to return one or more close matches in the reference table.</span></span>  
  
 <span data-ttu-id="5b691-109">В потоке данных пакета преобразование «Нечеткий уточняющий запрос» часто следует за преобразованием «Уточняющий запрос».</span><span class="sxs-lookup"><span data-stu-id="5b691-109">A Fuzzy Lookup transformation frequently follows a Lookup transformation in a package data flow.</span></span> <span data-ttu-id="5b691-110">Сначала преобразование «Уточняющий запрос» пытается найти точные совпадения.</span><span class="sxs-lookup"><span data-stu-id="5b691-110">First, the Lookup transformation tries to find an exact match.</span></span> <span data-ttu-id="5b691-111">Если ничего не найдено, преобразование «Нечеткий уточняющий запрос» приводит несколько неточных соответствий из ссылочной таблицы.</span><span class="sxs-lookup"><span data-stu-id="5b691-111">If it fails, the Fuzzy Lookup transformation provides close matches from the reference table.</span></span>  
  
 <span data-ttu-id="5b691-112">Для данного преобразования необходим доступ к эталонному источнику данных, в котором содержатся значения, используемые для очистки и расширения входных данных.</span><span class="sxs-lookup"><span data-stu-id="5b691-112">The transformation needs access to a reference data source that contains the values that are used to clean and extend the input data.</span></span> <span data-ttu-id="5b691-113">Эталонный источник данных должен быть таблицей в базе данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5b691-113">The reference data source must be a table in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span> <span data-ttu-id="5b691-114">Соответствие между значением во входном столбце и значением в ссылочной таблице может быть точным или нечетким.</span><span class="sxs-lookup"><span data-stu-id="5b691-114">The match between the value in an input column and the value in the reference table can be an exact match or a fuzzy match.</span></span> <span data-ttu-id="5b691-115">Однако для настройки преобразования необходимо хотя бы одно нечеткое соответствие столбца.</span><span class="sxs-lookup"><span data-stu-id="5b691-115">However, the transformation requires at least one column match to be configured for fuzzy matching.</span></span> <span data-ttu-id="5b691-116">Если необходимы только четкие соответствия, используйте преобразование «Уточняющий запрос».</span><span class="sxs-lookup"><span data-stu-id="5b691-116">If you want to use only exact matching, use the Lookup transformation instead.</span></span>  
  
 <span data-ttu-id="5b691-117">Это преобразование имеет один вход и один выход.</span><span class="sxs-lookup"><span data-stu-id="5b691-117">This transformation has one input and one output.</span></span>  
  
 <span data-ttu-id="5b691-118">Для нечеткого соответствия могут использоваться только входные столбцы, имеющие типы данных `DT_WSTR` либо `DT_STR`.</span><span class="sxs-lookup"><span data-stu-id="5b691-118">Only input columns with the `DT_WSTR` and `DT_STR` data types can be used in fuzzy matching.</span></span> <span data-ttu-id="5b691-119">Для четкого соответствия может использоваться любой тип данных DTS, кроме `DT_TEXT`, `DT_NTEXT` и `DT_IMAGE`.</span><span class="sxs-lookup"><span data-stu-id="5b691-119">Exact matching can use any DTS data type except `DT_TEXT`, `DT_NTEXT`, and `DT_IMAGE`.</span></span> <span data-ttu-id="5b691-120">Дополнительные сведения см. в разделе [Integration Services Data Types](../integration-services-data-types.md).</span><span class="sxs-lookup"><span data-stu-id="5b691-120">For more information, see [Integration Services Data Types](../integration-services-data-types.md).</span></span> <span data-ttu-id="5b691-121">Столбцы, которые участвуют в соединении входной и ссылочной таблиц, должны иметь совместимые типы данных.</span><span class="sxs-lookup"><span data-stu-id="5b691-121">Columns that participate in the join between the input and the reference table must have compatible data types.</span></span> <span data-ttu-id="5b691-122">Например, Допускается присоединение столбца с типом данных DTS `DT_WSTR` к столбцу с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nvarchar` типом данных, но недопустимо присоединить столбец к `DT_WSTR` типу данных к столбцу с `int` типом данных.</span><span class="sxs-lookup"><span data-stu-id="5b691-122">For example, it is valid to join a column with the DTS `DT_WSTR` data type to a column with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nvarchar` data type, but invalid to join a column with the `DT_WSTR` data type to a column with the `int` data type.</span></span>  
  
 <span data-ttu-id="5b691-123">Это преобразование можно настраивать, определяя максимальный объем памяти, алгоритм сравнения строк и используемое данным преобразованием кэширование индексов и ссылочных таблиц.</span><span class="sxs-lookup"><span data-stu-id="5b691-123">You can customize this transformation by specifying the maximum amount of memory, the row comparison algorithm, and the caching of indexes and reference tables that the transformation uses.</span></span>  
  
 <span data-ttu-id="5b691-124">Объем памяти, используемой преобразованием "Нечеткий уточняющий запрос", можно задать в пользовательском свойстве MaxMemoryUsage.</span><span class="sxs-lookup"><span data-stu-id="5b691-124">The amount of memory that the Fuzzy Lookup transformation uses can be configured by setting the MaxMemoryUsage custom property.</span></span> <span data-ttu-id="5b691-125">Можно указать число мегабайтов (МБ) или значение 0, которое позволяет преобразованию использовать динамический объем памяти в зависимости от своих потребностей и наличия доступной физической памяти.</span><span class="sxs-lookup"><span data-stu-id="5b691-125">You can specify the number of megabytes (MB), or use the value 0, which lets the transformation use a dynamic amount of memory based on its needs and the physical memory available.</span></span> <span data-ttu-id="5b691-126">Пользовательское свойство MaxMemoryUsage можно обновить с помощью выражения свойства при загрузке пакета.</span><span class="sxs-lookup"><span data-stu-id="5b691-126">The MaxMemoryUsage custom property can be updated by a property expression when the package is loaded.</span></span> <span data-ttu-id="5b691-127">Дополнительные сведения см. в разделах [Выражения служб Integration Services (SSIS)](../../expressions/integration-services-ssis-expressions.md), [Использование выражений свойств в пакетах](../../expressions/use-property-expressions-in-packages.md) и [Пользовательские свойства преобразований](transformation-custom-properties.md).</span><span class="sxs-lookup"><span data-stu-id="5b691-127">For more information, see [Integration Services &#40;SSIS&#41; Expressions](../../expressions/integration-services-ssis-expressions.md), [Use Property Expressions in Packages](../../expressions/use-property-expressions-in-packages.md), and [Transformation Custom Properties](transformation-custom-properties.md).</span></span>  
  
## <a name="controlling-fuzzy-matching-behavior"></a><span data-ttu-id="5b691-128">Управление режимом нечеткого соответствия</span><span class="sxs-lookup"><span data-stu-id="5b691-128">Controlling Fuzzy Matching Behavior</span></span>  
 <span data-ttu-id="5b691-129">Преобразование "Нечеткий уточняющий запрос" содержит три параметра настройки поиска: максимальное количество возвращаемых соответствий на входную строку, разделители маркеров и пороги подобия.</span><span class="sxs-lookup"><span data-stu-id="5b691-129">The Fuzzy Lookup transformation includes three features for customizing the lookup it performs: maximum number of matches to return per input row, token delimiters, and similarity thresholds.</span></span>  
  
 <span data-ttu-id="5b691-130">Преобразование возвращает ноль или более результатов поиска вплоть до максимального числа, определенного пользователем.</span><span class="sxs-lookup"><span data-stu-id="5b691-130">The transformation returns zero or more matches up to the number of matches specified.</span></span> <span data-ttu-id="5b691-131">Определение максимального числа результатов поиска не гарантирует того, что преобразование выдаст максимально возможное число результатов поиска; оно гарантирует только то, что количество результатов поиска, возвращаемое преобразованием, не превысит заданного числа.</span><span class="sxs-lookup"><span data-stu-id="5b691-131">Specifying a maximum number of matches does not guarantee that the transformation returns the maximum number of matches; it only guarantees that the transformation returns at most that number of matches.</span></span> <span data-ttu-id="5b691-132">Если установить значение максимального количества результатов поиска больше 1, выходные данные преобразования могут содержать более одной строки на один уточняющий запрос и некоторые строки могут дублироваться.</span><span class="sxs-lookup"><span data-stu-id="5b691-132">If you set the maximum number of matches to a value greater than 1, the output of the transformation may include more than one row per lookup and some of the rows may be duplicates.</span></span>  
  
 <span data-ttu-id="5b691-133">Преобразование предоставляет набор разделителей, используемый по умолчанию для маркировки данных, но можно добавить собственные разделители токенов.</span><span class="sxs-lookup"><span data-stu-id="5b691-133">The transformation provides a default set of delimiters used to tokenize the data, but you can add token delimiters to suit the needs of your data.</span></span> <span data-ttu-id="5b691-134">В свойстве Delimiters содержатся установленные по умолчанию разделители.</span><span class="sxs-lookup"><span data-stu-id="5b691-134">The Delimiters property contains the default delimiters.</span></span> <span data-ttu-id="5b691-135">Маркировка важна, так как она определяет блоки внутри данных, которые будут сравниваться друг с другом.</span><span class="sxs-lookup"><span data-stu-id="5b691-135">Tokenization is important because it defines the units within the data that are compared to each other.</span></span>  
  
 <span data-ttu-id="5b691-136">Пороги подобия могут быть установлены на уровне компонентов и соединений.</span><span class="sxs-lookup"><span data-stu-id="5b691-136">The similarity thresholds can be set at the component and join levels.</span></span> <span data-ttu-id="5b691-137">Порог подобия на уровне соединений доступен только тогда, когда преобразование «Нечеткий уточняющий запрос» производится между столбцами входной и ссылочной таблиц.</span><span class="sxs-lookup"><span data-stu-id="5b691-137">The join-level similarity threshold is only available when the transformation performs a fuzzy match between columns in the input and the reference table.</span></span> <span data-ttu-id="5b691-138">Диапазон подобия охватывает значения от 0 до 1.</span><span class="sxs-lookup"><span data-stu-id="5b691-138">The similarity range is 0 to 1.</span></span> <span data-ttu-id="5b691-139">Чем ближе порог к 1, тем более сходными должны быть строки и столбцы, чтобы называться дубликатами.</span><span class="sxs-lookup"><span data-stu-id="5b691-139">The closer to 1 the threshold is, the more similar the rows and columns must be to qualify as duplicates.</span></span> <span data-ttu-id="5b691-140">Порог подобия определяется при помощи установки свойства MinSimilarity на уровне компонентов и соединений.</span><span class="sxs-lookup"><span data-stu-id="5b691-140">You specify the similarity threshold by setting the MinSimilarity property at the component and join levels.</span></span> <span data-ttu-id="5b691-141">Чтобы удовлетворять условиям подобия, определенным на уровне компонентов, все строки должны иметь во всех результатах поиска степень сходства, большую, чем порог подобия, определенный на уровне компонентов, или равную ему.</span><span class="sxs-lookup"><span data-stu-id="5b691-141">To satisfy the similarity that is specified at the component level, all rows must have a similarity across all matches that is greater than or equal to the similarity threshold that is specified at the component level.</span></span> <span data-ttu-id="5b691-142">Таким образом, невозможно определить очень близкие совпадения на уровне компонентов до тех пор, пока совпадения на уровне строк или соединений не будут столь же близки.</span><span class="sxs-lookup"><span data-stu-id="5b691-142">That is, you cannot specify a very close match at the component level unless the matches at the row or join level are equally close.</span></span>  
  
 <span data-ttu-id="5b691-143">Каждое совпадение включает показатель сходства и показатель достоверности.</span><span class="sxs-lookup"><span data-stu-id="5b691-143">Each match includes a similarity score and a confidence score.</span></span> <span data-ttu-id="5b691-144">Показатель сходства — это математическая мера структурного сходства между входной записью и записью, найденной преобразованием «Нечеткий уточняющий запрос» в ссылочной таблице.</span><span class="sxs-lookup"><span data-stu-id="5b691-144">The similarity score is a mathematical measure of the textural similarity between the input record and the record that Fuzzy Lookup transformation returns from the reference table.</span></span> <span data-ttu-id="5b691-145">Показатель достоверности — это вероятность того, что полученная величина является наиболее точным совпадением с искомой величиной среди всех остальных результатов поиска в ссылочной таблице.</span><span class="sxs-lookup"><span data-stu-id="5b691-145">The confidence score is a measure of how likely it is that a particular value is the best match among the matches found in the reference table.</span></span> <span data-ttu-id="5b691-146">Присвоенный записи показатель достоверности зависит от остальных найденных совпадающих записей.</span><span class="sxs-lookup"><span data-stu-id="5b691-146">The confidence score assigned to a record depends on the other matching records that are returned.</span></span> <span data-ttu-id="5b691-147">Например, соответствие между *СПб* и *Санкт-Петербург* обладает низкой степенью сходства независимо от других результатов поиска.</span><span class="sxs-lookup"><span data-stu-id="5b691-147">For example, matching *St.* and *Saint* returns a low similarity score regardless of other matches.</span></span> <span data-ttu-id="5b691-148">Но если *Санкт-Петербург* является единственным результатом поиска, то показатель достоверности будет высоким.</span><span class="sxs-lookup"><span data-stu-id="5b691-148">If *Saint* is the only match returned, the confidence score is high.</span></span> <span data-ttu-id="5b691-149">Если же и *Санкт-Петербург* , и *СПб* найдены в ссылочной таблице, то достоверность *СПб* будет высокой, а достоверность *Санкт-Петербург* будет низкой.</span><span class="sxs-lookup"><span data-stu-id="5b691-149">If both *Saint* and *St.* appear in the reference table, the confidence in *St.* is high and the confidence in *Saint* is low.</span></span> <span data-ttu-id="5b691-150">Однако из того, что у результата поиска высокий показатель сходства может совсем не следовать, что у него высокий показатель достоверности.</span><span class="sxs-lookup"><span data-stu-id="5b691-150">However, high similarity may not mean high confidence.</span></span> <span data-ttu-id="5b691-151">Например, если ищется значение *Раздел 4*, то результаты поиска *Раздел 1*, *Раздел 2*и *Раздел 3* будут иметь высокий показатель сходства, но низкий показатель достоверности, так как остается неясным, какой из результатов является наиболее близким к искомому.</span><span class="sxs-lookup"><span data-stu-id="5b691-151">For example, if you are looking up the value *Chapter 4*, the returned results *Chapter 1*, *Chapter 2*, and *Chapter 3* have a high similarity score but a low confidence score because it is unclear which of the results is the best match.</span></span>  
  
 <span data-ttu-id="5b691-152">Показатель сходства является десятичным числом от 0 до 1, причем показатель сходства, равный единице, означает точное совпадение значения во входном столбце и значения в ссылочной таблице.</span><span class="sxs-lookup"><span data-stu-id="5b691-152">The similarity score is represented by a decimal value between 0 and 1, where a similarity score of 1 means an exact match between the value in the input column and the value in the reference table.</span></span> <span data-ttu-id="5b691-153">Показатель достоверности, также являющийся десятичным числом от 0 до 1, показывает достоверность результата поиска.</span><span class="sxs-lookup"><span data-stu-id="5b691-153">The confidence score, also a decimal value between 0 and 1, indicates the confidence in the match.</span></span> <span data-ttu-id="5b691-154">Если не найдено ни одного возможного соответствия, то данной строке присваиваются значения показателей совпадения и достоверности, равные 0, а выходные столбцы, скопированные из ссылочной таблицы, будут содержать значения NULL.</span><span class="sxs-lookup"><span data-stu-id="5b691-154">If no usable match is found, similarity and confidence scores of 0 are assigned to the row, and the output columns copied from the reference table will contain null values.</span></span>  
  
 <span data-ttu-id="5b691-155">Иногда преобразование «Нечеткий уточняющий запрос» может не найти соответствий в ссылочной таблице.</span><span class="sxs-lookup"><span data-stu-id="5b691-155">Sometimes, Fuzzy Lookup may not locate appropriate matches in the reference table.</span></span> <span data-ttu-id="5b691-156">Это может произойти в том случае, если входной строкой для уточняющего запроса является одиночное короткое слово.</span><span class="sxs-lookup"><span data-stu-id="5b691-156">This can occur if the input value that is used in a lookup is a single, short word.</span></span> <span data-ttu-id="5b691-157">Например, *helo* не совпадет с *hello* в ссылочной таблице, если в том или каком-нибудь другом столбце строки нет других токенов.</span><span class="sxs-lookup"><span data-stu-id="5b691-157">For example, *helo* is not matched with the value *hello* in a reference table when no other tokens are present in that column or any other column in the row.</span></span>  
  
 <span data-ttu-id="5b691-158">Выходные столбцы преобразования включают входные столбцы, отмеченные как передаваемые столбцы, выделенные столбцы в таблице уточняющих запросов и следующие дополнительные столбцы:</span><span class="sxs-lookup"><span data-stu-id="5b691-158">The transformation output columns include the input columns that are marked as pass-through columns, the selected columns in the lookup table, and the following additional columns:</span></span>  
  
-   <span data-ttu-id="5b691-159">**_Similarity**— столбец, содержащий показатели сходства между значениями во входном и ссылочном столбце.</span><span class="sxs-lookup"><span data-stu-id="5b691-159">**_Similarity**, a column that describes the similarity between values in the input and reference columns.</span></span>  
  
-   <span data-ttu-id="5b691-160">**_Confidence**— столбец, содержащий показатели достоверности соответствий.</span><span class="sxs-lookup"><span data-stu-id="5b691-160">**_Confidence**, a column that describes the quality of the match.</span></span>  
  
 <span data-ttu-id="5b691-161">Преобразование использует соединение с базой данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для создания временных таблиц, необходимых алгоритму нечеткого соответствия.</span><span class="sxs-lookup"><span data-stu-id="5b691-161">The transformation uses the connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database to create the temporary tables that the fuzzy matching algorithm uses.</span></span>  
  
## <a name="running-the-fuzzy-lookup-transformation"></a><span data-ttu-id="5b691-162">Выполнение преобразования «Нечеткий уточняющий запрос»</span><span class="sxs-lookup"><span data-stu-id="5b691-162">Running the Fuzzy Lookup Transformation</span></span>  
 <span data-ttu-id="5b691-163">При первом запуске преобразования пакетом преобразование копирует ссылочную таблицу, добавляет ключ целочисленного типа данных в новую таблицу и создает индекс в ключевом столбце.</span><span class="sxs-lookup"><span data-stu-id="5b691-163">When the package first runs the transformation, the transformation copies the reference table, adds a key with an integer data type to the new table, and builds an index on the key column.</span></span> <span data-ttu-id="5b691-164">Затем преобразование создает в копии ссылочной таблицы индекс, называемый индексом соответствия.</span><span class="sxs-lookup"><span data-stu-id="5b691-164">Next, the transformation builds an index, called a match index, on the copy of the reference table.</span></span> <span data-ttu-id="5b691-165">В индексе соответствия сохраняются результаты маркировки значений во входных столбцах преобразования, а затем преобразование использует эти токены при операциях поиска.</span><span class="sxs-lookup"><span data-stu-id="5b691-165">The match index stores the results of tokenizing the values in the transformation input columns, and the transformation then uses the tokens in the lookup operation.</span></span> <span data-ttu-id="5b691-166">Индекс соответствия — это таблица базы данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5b691-166">The match index is a table in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span>  
  
 <span data-ttu-id="5b691-167">При повторном выполнении пакета преобразование может либо использовать уже существующий индекс соответствия, либо создать новый индекс.</span><span class="sxs-lookup"><span data-stu-id="5b691-167">When the package runs again, the transformation can either use an existing match index or create a new index.</span></span> <span data-ttu-id="5b691-168">Если ссылочная таблица является статической, пакет может избежать потенциально затратных процессов перестроения индекса для повторных сеансов очистки данных.</span><span class="sxs-lookup"><span data-stu-id="5b691-168">If the reference table is static, the package can avoid the potentially expensive process of rebuilding the index for repeat sessions of data cleaning.</span></span> <span data-ttu-id="5b691-169">Если выбрано использование уже существующего индекса, индекс будет создан при первом запуске пакета.</span><span class="sxs-lookup"><span data-stu-id="5b691-169">If you choose to use an existing index, the index is created the first time that the package runs.</span></span> <span data-ttu-id="5b691-170">Если несколько преобразований «Нечеткий уточняющий запрос» используют одну и ту же ссылочную таблицу, то все они могут использовать один и тот же индекс.</span><span class="sxs-lookup"><span data-stu-id="5b691-170">If multiple Fuzzy Lookup transformations use the same reference table, they can all use the same index.</span></span> <span data-ttu-id="5b691-171">Операции поиска должны быть одинаковыми, чтобы можно было использовать индекс повторно; в них должны задействоваться одни и те же столбцы.</span><span class="sxs-lookup"><span data-stu-id="5b691-171">To reuse the index, the lookup operations must be identical; the lookup must use the same columns.</span></span> <span data-ttu-id="5b691-172">Индексу можно присвоить имя и выбрать соединение с базой данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , в которой он будет сохранен.</span><span class="sxs-lookup"><span data-stu-id="5b691-172">You can name the index and select the connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database that saves the index.</span></span>  
  
 <span data-ttu-id="5b691-173">Если преобразование сохраняет индекс соответствия, этот индекс может поддерживаться автоматически.</span><span class="sxs-lookup"><span data-stu-id="5b691-173">If the transformation saves the match index, the match index can be maintained automatically.</span></span> <span data-ttu-id="5b691-174">Это означает, что каждый раз при обновлении записей в ссылочной таблице индекс соответствия также будет обновляться.</span><span class="sxs-lookup"><span data-stu-id="5b691-174">This means that every time a record in the reference table is updated, the match index is also updated.</span></span> <span data-ttu-id="5b691-175">Поддержка индекса соответствия может уменьшить время обработки, так как исчезает необходимость перестройки индекса во время запуска пакета.</span><span class="sxs-lookup"><span data-stu-id="5b691-175">Maintaining the match index can save processing time, because the index does not have to be rebuilt when the package runs.</span></span> <span data-ttu-id="5b691-176">Можно определить способ, как преобразование управляет индексом соответствия.</span><span class="sxs-lookup"><span data-stu-id="5b691-176">You can specify how the transformation manages the match index.</span></span>  
  
 <span data-ttu-id="5b691-177">В следующей таблице приводятся описания параметров индекса соответствия.</span><span class="sxs-lookup"><span data-stu-id="5b691-177">The following table describes the match index options.</span></span>  
  
|<span data-ttu-id="5b691-178">Параметр</span><span class="sxs-lookup"><span data-stu-id="5b691-178">Option</span></span>|<span data-ttu-id="5b691-179">Description</span><span class="sxs-lookup"><span data-stu-id="5b691-179">Description</span></span>|  
|------------|-----------------|  
|<span data-ttu-id="5b691-180">**GenerateAndMaintainNewIndex**</span><span class="sxs-lookup"><span data-stu-id="5b691-180">**GenerateAndMaintainNewIndex**</span></span>|<span data-ttu-id="5b691-181">Создает новый индекс, сохраняет и поддерживает его.</span><span class="sxs-lookup"><span data-stu-id="5b691-181">Create a new index, save it, and maintain it.</span></span> <span data-ttu-id="5b691-182">Преобразование устанавливает триггеры на ссылочную таблицу для синхронизации ссылочной таблицы и таблицы индекса.</span><span class="sxs-lookup"><span data-stu-id="5b691-182">The transformation installs triggers on the reference table to keep the reference table and index table synchronized.</span></span>|  
|<span data-ttu-id="5b691-183">**GenerateAndPersistNewIndex**</span><span class="sxs-lookup"><span data-stu-id="5b691-183">**GenerateAndPersistNewIndex**</span></span>|<span data-ttu-id="5b691-184">Создает и сохраняет новый индекс, но не поддерживает его.</span><span class="sxs-lookup"><span data-stu-id="5b691-184">Create a new index and save it, but do not maintain it.</span></span>|  
|<span data-ttu-id="5b691-185">**GenerateNewIndex**</span><span class="sxs-lookup"><span data-stu-id="5b691-185">**GenerateNewIndex**</span></span>|<span data-ttu-id="5b691-186">Создает новый индекс, но не сохраняет его.</span><span class="sxs-lookup"><span data-stu-id="5b691-186">Create a new index, but do not save it.</span></span>|  
|<span data-ttu-id="5b691-187">**ReuseExistingIndex**</span><span class="sxs-lookup"><span data-stu-id="5b691-187">**ReuseExistingIndex**</span></span>|<span data-ttu-id="5b691-188">Повторно использует уже существующий индекс.</span><span class="sxs-lookup"><span data-stu-id="5b691-188">Reuse an existing index.</span></span>|  
  
### <a name="maintenance-of-the-match-index-table"></a><span data-ttu-id="5b691-189">Поддержка таблицы индексов соответствия</span><span class="sxs-lookup"><span data-stu-id="5b691-189">Maintenance of the Match Index Table</span></span>  
 <span data-ttu-id="5b691-190">Параметр **GenerateAndMaintainNewIndex** устанавливает триггеры на ссылочную таблицу для синхронизации ссылочной таблицы и таблицы индекса соответствия.</span><span class="sxs-lookup"><span data-stu-id="5b691-190">The **GenerateAndMaintainNewIndex** option installs triggers on the reference table to keep the match index table and the reference table synchronized.</span></span> <span data-ttu-id="5b691-191">Если необходимо удалить установленный триггер, нужно запустить хранимую процедуру **sp_FuzzyLookupTableMaintenanceUnInstall** и ввести в качестве входного параметра имя, определенное в свойстве MatchIndexName.</span><span class="sxs-lookup"><span data-stu-id="5b691-191">If you have to remove the installed trigger, you must run the **sp_FuzzyLookupTableMaintenanceUnInstall** stored procedure, and provide the name specified in the MatchIndexName property as the input parameter value.</span></span>  
  
 <span data-ttu-id="5b691-192">Нельзя удалять поддерживаемую таблицу индекса соответствия перед запуском хранимой процедуры **sp_FuzzyLookupTableMaintenanceUnInstall** .</span><span class="sxs-lookup"><span data-stu-id="5b691-192">You should not delete the maintained match index table before running the **sp_FuzzyLookupTableMaintenanceUnInstall** stored procedure.</span></span> <span data-ttu-id="5b691-193">Если таблица индекса соответствия удалена, то триггеры в ссылочной таблице будут работать неправильно.</span><span class="sxs-lookup"><span data-stu-id="5b691-193">If the match index table is deleted, the triggers on the reference table will not execute correctly.</span></span> <span data-ttu-id="5b691-194">Все последующие обновления ссылочной таблицы будут выдавать ошибку до тех пор, пока вручную не будут сброшены триггеры в ссылочной таблице.</span><span class="sxs-lookup"><span data-stu-id="5b691-194">All subsequent updates to the reference table will fail until you manually drop the triggers on the reference table.</span></span>  
  
 <span data-ttu-id="5b691-195">Команда SQL TRUNCATE TABLE не запускает триггеры DELETE.</span><span class="sxs-lookup"><span data-stu-id="5b691-195">The SQL TRUNCATE TABLE command does not invoke DELETE triggers.</span></span> <span data-ttu-id="5b691-196">Если ссылочная таблица была обработана командой TRUNCATE TABLE, то синхронизация между ссылочной таблицей и индексом соответствия нарушается и преобразование «Нечеткий уточняющий запрос» перестает работать.</span><span class="sxs-lookup"><span data-stu-id="5b691-196">If the TRUNCATE TABLE command is used on the reference table, the reference table and the match index will no longer be synchronized and the Fuzzy Lookup transformation fails.</span></span> <span data-ttu-id="5b691-197">Если триггеры, поддерживающие таблицу индекса соответствия, установлены на ссылочную таблицу, необходимо использовать команду SQL DELETE вместо команды TRUNCATE TABLE.</span><span class="sxs-lookup"><span data-stu-id="5b691-197">While the triggers that maintain the match index table are installed on the reference table, you should use the SQL DELETE command instead of the TRUNCATE TABLE command.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5b691-198">Если выбрать параметр **Поддерживать хранимый индекс** в **редакторе преобразования «Нечеткий уточняющий запрос»** на вкладке **Ссылочная таблица**, представление будет поддерживать хранимый индекс с помощью управляемых хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="5b691-198">When you select **Maintain stored index** on the **Reference Table** tab of the **Fuzzy Lookup Transformation Editor**, the transformation uses managed stored procedures to maintain the index.</span></span> <span data-ttu-id="5b691-199">Эти управляемые хранимые процедуры используют функцию интеграции со средой CLR, доступную в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5b691-199">These managed stored procedures use the common language runtime (CLR) integration feature in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="5b691-200">По умолчанию в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] отключена интеграция со средой CLR.</span><span class="sxs-lookup"><span data-stu-id="5b691-200">By default, CLR integration in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not enabled.</span></span> <span data-ttu-id="5b691-201">Чтобы использовать функцию **Поддерживать хранимый индекс** , необходимо включить интеграцию со средой CLR.</span><span class="sxs-lookup"><span data-stu-id="5b691-201">To use the **Maintain stored index** functionality, you must enable CLR integration.</span></span> <span data-ttu-id="5b691-202">Дополнительные сведения см. в статье [Enabling CLR Integration](../../../relational-databases/clr-integration/clr-integration-enabling.md).</span><span class="sxs-lookup"><span data-stu-id="5b691-202">For more information, see [Enabling CLR Integration](../../../relational-databases/clr-integration/clr-integration-enabling.md).</span></span>  
>   
>  <span data-ttu-id="5b691-203">Поскольку для параметра **Поддерживать хранимый индекс** необходима интеграция со средой CLR, эта функция работает, только если ссылочная таблица выбрана на экземпляре [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , на котором включена интеграция со средой CLR.</span><span class="sxs-lookup"><span data-stu-id="5b691-203">Because the **Maintain stored index** option requires CLR integration, this feature works only when you select a reference table on an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] where CLR integration is enabled.</span></span>  
  
## <a name="row-comparison"></a><span data-ttu-id="5b691-204">Сравнение строк</span><span class="sxs-lookup"><span data-stu-id="5b691-204">Row Comparison</span></span>  
 <span data-ttu-id="5b691-205">При настройке преобразования «Нечеткий уточняющий запрос» можно определить алгоритм сравнения, который преобразование применяет для поиска записей в ссылочной таблице.</span><span class="sxs-lookup"><span data-stu-id="5b691-205">When you configure the Fuzzy Lookup transformation, you can specify the comparison algorithm that the transformation uses to locate matching records in the reference table.</span></span> <span data-ttu-id="5b691-206">Если для свойства Exhaustive задано значение `True` , то преобразование сравнивает каждую строку во входных данных с каждой строкой в ссылочной таблице.</span><span class="sxs-lookup"><span data-stu-id="5b691-206">If you set the Exhaustive property to `True`, the transformation compares every row in the input to every row in the reference table.</span></span> <span data-ttu-id="5b691-207">Этот алгоритм сравнения может дать более точные результаты, но, вероятнее всего, данное преобразование будет выполняться довольно долго в том случае, если число строк в ссылочной таблице велико.</span><span class="sxs-lookup"><span data-stu-id="5b691-207">This comparison algorithm may produce more accurate results, but it is likely to make the transformation perform more slowly unless the number of rows is the reference table is small.</span></span> <span data-ttu-id="5b691-208">Если свойство Exhaustive имеет значение `True` , вся ссылочная таблица загружается в память.</span><span class="sxs-lookup"><span data-stu-id="5b691-208">If the Exhaustive property is set to `True`, the entire reference table is loaded into memory.</span></span> <span data-ttu-id="5b691-209">Чтобы избежать проблем с производительностью, рекомендуется задать для свойства Exhaustive значение `True` только во время разработки пакета.</span><span class="sxs-lookup"><span data-stu-id="5b691-209">To avoid performance issues, it is advisable to set the Exhaustive property to `True` during package development only.</span></span>  
  
 <span data-ttu-id="5b691-210">Если свойство Exhaustive имеет значение `False` , преобразование «Нечеткий уточняющий запрос» возвращает только те совпадения, которые имеют по крайней мере один индексированный токен или подстроку (подстрока называется *q-граммами*), общие с входной записью.</span><span class="sxs-lookup"><span data-stu-id="5b691-210">If the Exhaustive property is set to `False`, the Fuzzy Lookup transformation returns only matches that have at least one indexed token or substring (the substring is called a *q-gram*) in common with the input record.</span></span> <span data-ttu-id="5b691-211">Для повышения эффективности уточняющих запросов в инвертированном индексе, используемом преобразованием «Нечеткий уточняющий запрос» для поиска совпадений, индексируется только подмножество токенов в каждой строке таблицы.</span><span class="sxs-lookup"><span data-stu-id="5b691-211">To maximize the efficiency of lookups, only a subset of the tokens in each row in the table is indexed in the inverted index structure that the Fuzzy Lookup transformation uses to locate matches.</span></span> <span data-ttu-id="5b691-212">Если входной набор данных невелик, можно задать для него полное значение, `True` чтобы избежать пропущенных совпадений, для которых в таблице индексов не существует общих маркеров.</span><span class="sxs-lookup"><span data-stu-id="5b691-212">When the input dataset is small, you can set Exhaustive to `True` to avoid missing matches for which no common tokens exist in the index table.</span></span>  
  
## <a name="caching-of-indexes-and-reference-tables"></a><span data-ttu-id="5b691-213">Кэширование индексов и ссылочных таблиц</span><span class="sxs-lookup"><span data-stu-id="5b691-213">Caching of Indexes and Reference Tables</span></span>  
 <span data-ttu-id="5b691-214">При настройке преобразования «Нечеткий уточняющий запрос» можно определить, будет ли преобразование производить частичное кэширование индексов и ссылочных таблиц перед началом работы.</span><span class="sxs-lookup"><span data-stu-id="5b691-214">When you configure the Fuzzy Lookup transformation, you can specify whether the transformation partially caches the index and reference table in memory before the transformation does its work.</span></span> <span data-ttu-id="5b691-215">Если для свойства WarmCaches значения задано значение `True` , индекс и ссылочная таблица загружаются в память.</span><span class="sxs-lookup"><span data-stu-id="5b691-215">If you set the WarmCaches property to `True`, the index and reference table are loaded into memory.</span></span> <span data-ttu-id="5b691-216">Если входное значение содержит много строк, установка свойства WarmCaches значения в значение `True` может повысить производительность преобразования.</span><span class="sxs-lookup"><span data-stu-id="5b691-216">When the input has many rows, setting the WarmCaches property to `True` can improve the performance of the transformation.</span></span> <span data-ttu-id="5b691-217">Если количество входных строк мало, установка свойства WarmCaches значения в значение `False` позволяет ускорить повторное использование большого индекса.</span><span class="sxs-lookup"><span data-stu-id="5b691-217">When the number of input rows is small, setting the WarmCaches property to `False` can make the reuse of a large index faster.</span></span>  
  
## <a name="temporary-tables-and-indexes"></a><span data-ttu-id="5b691-218">Временные таблицы и индексы</span><span class="sxs-lookup"><span data-stu-id="5b691-218">Temporary Tables and Indexes</span></span>  
 <span data-ttu-id="5b691-219">В процессе выполнения преобразование «Нечеткий уточняющий запрос» создает временные объекты, такие как таблицы и индексы в базе данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , с которой соединяется данное преобразование.</span><span class="sxs-lookup"><span data-stu-id="5b691-219">At run time, the Fuzzy Lookup transformation creates temporary objects, such as tables and indexes, in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database that the transformation connects to.</span></span> <span data-ttu-id="5b691-220">Размер временных таблиц и индексов пропорционален числу строк и токенов в ссылочной таблице и числу токенов, которые создает преобразование «Нечеткий уточняющий запрос», поэтому они потенциально могут занимать существенный объем места на диске.</span><span class="sxs-lookup"><span data-stu-id="5b691-220">The size of these temporary tables and indexes is proportionate to the number of rows and tokens in the reference table and the number of tokens that the Fuzzy Lookup transformation creates; therefore, they could potentially consume a significant amount of disk space.</span></span> <span data-ttu-id="5b691-221">Также преобразование выполняет запросы к этим временным таблицам.</span><span class="sxs-lookup"><span data-stu-id="5b691-221">The transformation also queries these temporary tables.</span></span> <span data-ttu-id="5b691-222">Поэтому необходимо учитывать то, что преобразование "Нечеткий уточняющий запрос" должно быть соединено с экземпляром базы данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , который не связан с рабочим сервером, особенно если место на диске на рабочем сервере ограниченно.</span><span class="sxs-lookup"><span data-stu-id="5b691-222">You should therefore consider connecting the Fuzzy Lookup transformation to a non-production instance of a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database, especially if the production server has limited disk space available.</span></span>  
  
 <span data-ttu-id="5b691-223">Производительность этого преобразования может повышаться путем размещения используемых им таблиц и индексов на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="5b691-223">The performance of this transformation may improve if the tables and indexes it uses are located on the local computer.</span></span> <span data-ttu-id="5b691-224">Если используемая преобразованием «Нечеткий уточняющий запрос» ссылочная таблица находится на рабочем сервере, необходимо рассмотреть возможность копирования таблицы на отладочный сервер и настройки доступа преобразования «Нечеткий уточняющий поиск» к этой копии.</span><span class="sxs-lookup"><span data-stu-id="5b691-224">If the reference table that the Fuzzy Lookup transformation uses is on the production server, you should consider copying the table to a non-production server and configuring the Fuzzy Lookup transformation to access the copy.</span></span> <span data-ttu-id="5b691-225">С помощью этого можно предотвратить использование ресурсов рабочего сервера запросами поиска.</span><span class="sxs-lookup"><span data-stu-id="5b691-225">By doing this, you can prevent the lookup queries from consuming resources on the production server.</span></span> <span data-ttu-id="5b691-226">Кроме того, если преобразование "Нечеткий уточняющий запрос" поддерживает индекс соответствия, то есть если свойству MatchIndexOptionsis присвоено значение **GenerateAndMaintainNewIndex**, то преобразование может заблокировать ссылочную таблицу на время проведения операции по очистке данных и предотвратить доступ к ней других пользователей и приложений.</span><span class="sxs-lookup"><span data-stu-id="5b691-226">In addition, if the Fuzzy Lookup transformation maintains the match index-that is, if MatchIndexOptionsis set to **GenerateAndMaintainNewIndex**-the transformation may lock the reference table for the duration of the data cleaning operation and prevent other users and applications from accessing the table.</span></span>  
  
## <a name="configuring-the-fuzzy-lookup-transformation"></a><span data-ttu-id="5b691-227">Настройка преобразования «Нечеткий уточняющий запрос»</span><span class="sxs-lookup"><span data-stu-id="5b691-227">Configuring the Fuzzy Lookup Transformation</span></span>  
 <span data-ttu-id="5b691-228">Значения свойств можно задавать с помощью конструктора [!INCLUDE[ssIS](../../../includes/ssis-md.md)] или программными средствами.</span><span class="sxs-lookup"><span data-stu-id="5b691-228">You can set properties through [!INCLUDE[ssIS](../../../includes/ssis-md.md)] Designer or programmatically.</span></span>  
  
 <span data-ttu-id="5b691-229">Дополнительные сведения о свойствах, которые можно настроить при помощи диалогового окна **Редактор преобразования «Нечеткий уточняющий запрос»** , см. в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="5b691-229">For more information about the properties that you can set in the **Fuzzy Lookup Transformation Editor** dialog box, click one of the following topics:</span></span>  
  
-   [<span data-ttu-id="5b691-230">Редактор преобразования "Нечеткий уточняющий запрос" (вкладка "Ссылочная таблица")</span><span class="sxs-lookup"><span data-stu-id="5b691-230">Fuzzy Lookup Transformation Editor &#40;Reference Table Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-reference-table-tab.md)  
  
-   [<span data-ttu-id="5b691-231">Редактор преобразования "Нечеткий уточняющий запрос" (вкладка "Столбцы")</span><span class="sxs-lookup"><span data-stu-id="5b691-231">Fuzzy Lookup Transformation Editor &#40;Columns Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-columns-tab.md)  
  
-   [<span data-ttu-id="5b691-232">Редактор преобразования "Нечеткий уточняющий запрос" (вкладка "Дополнительно")</span><span class="sxs-lookup"><span data-stu-id="5b691-232">Fuzzy Lookup Transformation Editor &#40;Advanced Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-advanced-tab.md)  
  
 <span data-ttu-id="5b691-233">Дополнительные сведения о свойствах, которые вы можете задать в диалоговом окне **Расширенный редактор** или программными средствами, см. в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="5b691-233">For more information about the properties that you can set in the **Advanced Editor** dialog box or programmatically, click one of the following topics:</span></span>  
  
-   [<span data-ttu-id="5b691-234">Общие свойства</span><span class="sxs-lookup"><span data-stu-id="5b691-234">Common Properties</span></span>](../../common-properties.md)  
  
-   [<span data-ttu-id="5b691-235">Пользовательские свойства преобразований</span><span class="sxs-lookup"><span data-stu-id="5b691-235">Transformation Custom Properties</span></span>](transformation-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="5b691-236">Связанные задачи</span><span class="sxs-lookup"><span data-stu-id="5b691-236">Related Tasks</span></span>  
 <span data-ttu-id="5b691-237">Дополнительные сведения о настройке свойств для компонента потока данных см. в разделе [Установление свойств компонента потока данных](../set-the-properties-of-a-data-flow-component.md).</span><span class="sxs-lookup"><span data-stu-id="5b691-237">For details about how to set properties of a data flow component, see [Set the Properties of a Data Flow Component](../set-the-properties-of-a-data-flow-component.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5b691-238">См. также:</span><span class="sxs-lookup"><span data-stu-id="5b691-238">See Also</span></span>  
 <span data-ttu-id="5b691-239">[Преобразование «Уточняющий запрос»](lookup-transformation.md) </span><span class="sxs-lookup"><span data-stu-id="5b691-239">[Lookup Transformation](lookup-transformation.md) </span></span>  
 <span data-ttu-id="5b691-240">[Преобразование «Нечеткое группирование»](fuzzy-grouping-transformation.md) </span><span class="sxs-lookup"><span data-stu-id="5b691-240">[Fuzzy Grouping Transformation](fuzzy-grouping-transformation.md) </span></span>  
 [<span data-ttu-id="5b691-241">Преобразования служб Integration Services</span><span class="sxs-lookup"><span data-stu-id="5b691-241">Integration Services Transformations</span></span>](integration-services-transformations.md)  
  
  
