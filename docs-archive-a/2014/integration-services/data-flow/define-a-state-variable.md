---
title: Определение переменной состояния | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
ms.assetid: 45d66152-883a-49a7-a877-2e8ab45f8f79
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 5214b3512ea0113d1abace61a76033e5531ac99f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751359"
---
# <a name="define-a-state-variable"></a><span data-ttu-id="03302-102">Определение переменной состояния</span><span class="sxs-lookup"><span data-stu-id="03302-102">Define a State Variable</span></span>
  <span data-ttu-id="03302-103">Эта процедура описывает, как определить переменную пакета, в которой хранится информация состояния CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-103">This procedure describes how to define a package variable where the CDC state is stored.</span></span>  
  
 <span data-ttu-id="03302-104">Переменная состояния CDC загружается, инициализируется и обновляется с помощью задачи «Управление CDC» и используется компонентом потока данных «Источник CDC» в целях определения текущего диапазона обработки для записей с данными об изменениях.</span><span class="sxs-lookup"><span data-stu-id="03302-104">The CDC state variable is loaded, initialized, and updated by the CDC Control task and is used by the CDC Source data flow component to determine the current processing range for change records.</span></span> <span data-ttu-id="03302-105">Переменная состояния CDC может быть определена в контейнере, который является общим для задачи «Управление CDC» и источника CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-105">The CDC state variable can be defined on any container common to the CDC Control task and the CDC source.</span></span> <span data-ttu-id="03302-106">Такое определение может быть сделано на уровне пакета, а также в других контейнерах, таких как контейнер цикла.</span><span class="sxs-lookup"><span data-stu-id="03302-106">This may be at the package level but may also be on other containers such as a loop container.</span></span>  
  
 <span data-ttu-id="03302-107">Изменять вручную значение переменной состояния CDC не рекомендуется, но выполнение этой операции может оказаться полезным для ознакомления с содержимым переменной.</span><span class="sxs-lookup"><span data-stu-id="03302-107">Manually modifying the CDC state variable value is not recommended, however it can be useful to understand its contents.</span></span>  
  
 <span data-ttu-id="03302-108">В следующей таблице приведено общее описание компонентов значения переменной состояния CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-108">The following table provides a high-level description of the components of the CDC state variable value.</span></span>  
  
|<span data-ttu-id="03302-109">Компонент</span><span class="sxs-lookup"><span data-stu-id="03302-109">Component</span></span>|<span data-ttu-id="03302-110">Description</span><span class="sxs-lookup"><span data-stu-id="03302-110">Description</span></span>|  
|---------------|-----------------|  
|`<state-name>`|<span data-ttu-id="03302-111">Это имя текущего состояния CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-111">This is the name of the current CDC state.</span></span>|  
|`CS`|<span data-ttu-id="03302-112">Это обозначает точку начала текущего диапазона обработки (Current Start).</span><span class="sxs-lookup"><span data-stu-id="03302-112">This marks the current processing range start point (Current Start).</span></span>|  
|`<cs-lsn>`|<span data-ttu-id="03302-113">Это последний регистрационный номер транзакции в журнале, обработанный во время предыдущего запуска CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-113">This is the last (Log Sequence Number) LSN processed in the previous CDC run.</span></span>|  
|`CE`|<span data-ttu-id="03302-114">Это обозначает конечную точку текущего диапазона обработки (Current End).</span><span class="sxs-lookup"><span data-stu-id="03302-114">This marks the current processing range end point (Current End).</span></span> <span data-ttu-id="03302-115">Наличие компонента CE в состоянии CDC указывает на то, что пакет CDC обрабатывается в данный момент или что произошел сбой пакета CDC до полного завершения обработки всего диапазона CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-115">The presence of the CE component in the CDC state is an indication that either a CDC package is currently processing or that a CDC package failed before fully processing its CDC processing range.</span></span>|  
|`<ce-lsn>`|<span data-ttu-id="03302-116">Это последний номер LSN, который должен быть обработан во время текущего выполнения CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-116">This is the last LSN to be processed in the current CDC Run.</span></span> <span data-ttu-id="03302-117">Всегда предполагается, что последний последовательный номер, который должен быть обработан, является максимальным (0xFFF...).</span><span class="sxs-lookup"><span data-stu-id="03302-117">It is always assumed that the last sequence number to be processed is the maximum (0xFFF...).</span></span>|  
|`IR`|<span data-ttu-id="03302-118">Это обозначает начальный диапазон обработки.</span><span class="sxs-lookup"><span data-stu-id="03302-118">This marks the initial processing range.</span></span>|  
|`<ir-start>`|<span data-ttu-id="03302-119">Это номер LSN изменения прямо перед началом первоначальной загрузки.</span><span class="sxs-lookup"><span data-stu-id="03302-119">This is an LSN of a change just before the initial load began.</span></span>|  
|`<ir-end>`|<span data-ttu-id="03302-120">Это номер LSN изменения непосредственно после завершения первоначальной загрузки.</span><span class="sxs-lookup"><span data-stu-id="03302-120">This is an LSN of a change just after the initial load ended.</span></span>|  
|`TS`|<span data-ttu-id="03302-121">Это обозначает отметку времени последнего обновления состояния CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-121">This marks the timestamp for the last CDC state update.</span></span>|  
|**\<timestamp>**|<span data-ttu-id="03302-122">Это десятичное представление 64-разрядного свойства System.DateTime.UtcNow.</span><span class="sxs-lookup"><span data-stu-id="03302-122">This is a decimal representation of the 64-bit, System.DateTime.UtcNow property.</span></span>|  
|`ER`|<span data-ttu-id="03302-123">Оно отображается в случае сбоя последней операции и содержит краткое описание причины ошибки.</span><span class="sxs-lookup"><span data-stu-id="03302-123">This appears when the last operation failed and includes a short description of the cause of the error.</span></span> <span data-ttu-id="03302-124">При наличии этого компонента он всегда отображается последним.</span><span class="sxs-lookup"><span data-stu-id="03302-124">If this component is present, it will always appear last.</span></span>|  
|`<short-error-text>`|<span data-ttu-id="03302-125">Это краткое описание ошибки.</span><span class="sxs-lookup"><span data-stu-id="03302-125">This is the short error description.</span></span>|  
  
 <span data-ttu-id="03302-126">Номера LSN и последовательные номера кодируются в виде шестнадцатеричной строки длиной до 20 знаков, представляющей значение LSN Binary(10).</span><span class="sxs-lookup"><span data-stu-id="03302-126">The LSNs and sequence numbers are each encoded as a hexadecimal string of up to 20 digits representing the LSN value of Binary(10).</span></span>  
  
 <span data-ttu-id="03302-127">В следующей таблице описаны возможные значения состояния CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-127">The following table describes the possible CDC state values.</span></span>  
  
|<span data-ttu-id="03302-128">Состояние</span><span class="sxs-lookup"><span data-stu-id="03302-128">State</span></span>|<span data-ttu-id="03302-129">Описание</span><span class="sxs-lookup"><span data-stu-id="03302-129">Description</span></span>|  
|-----------|-----------------|  
|<span data-ttu-id="03302-130">(INITIAL)</span><span class="sxs-lookup"><span data-stu-id="03302-130">(INITIAL)</span></span>|<span data-ttu-id="03302-131">Это исходное состояние до выполнения какого-либо пакета в текущей группе CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-131">This is the initial state before the any package was run on the current CDC group.</span></span> <span data-ttu-id="03302-132">Это состояние также имеет место, если состояние CDC пусто.</span><span class="sxs-lookup"><span data-stu-id="03302-132">This is also the state when the CDC state is empty.</span></span>|  
|<span data-ttu-id="03302-133">ILSTART (запуск начальной загрузки)</span><span class="sxs-lookup"><span data-stu-id="03302-133">ILSTART (Initial Load Started)</span></span>|<span data-ttu-id="03302-134">Это состояние, когда запускается начальная загрузка пакета после вызова задачи «Управление CDC» операцией `MarkInitialLoadStart`.</span><span class="sxs-lookup"><span data-stu-id="03302-134">This is the state when the initial load package starts, after the `MarkInitialLoadStart` operation call to the CDC Control task.</span></span>|  
|<span data-ttu-id="03302-135">ILEND (завершение начальной загрузки)</span><span class="sxs-lookup"><span data-stu-id="03302-135">ILEND (Initial Load Ended)</span></span>|<span data-ttu-id="03302-136">Это состояние, когда начальная загрузка пакета успешно завершается после вызова задачи «Управление CDC» операцией `MarkInitialLoadEnd`.</span><span class="sxs-lookup"><span data-stu-id="03302-136">This is the state when the initial load package ends successfully, after the `MarkInitialLoadEnd` operation call to the CDC Control task.</span></span>|  
|<span data-ttu-id="03302-137">ILUPDATE (обновление начальной загрузки)</span><span class="sxs-lookup"><span data-stu-id="03302-137">ILUPDATE (Initial Load Update)</span></span>|<span data-ttu-id="03302-138">Это состояние после выполнения пакета обновления тонкого канала после начальной загрузки во время продолжения обработки диапазона начальной обработки.</span><span class="sxs-lookup"><span data-stu-id="03302-138">This is the state on the runs of the trickle feed update package following the initial load, while still processing the initial processing range.</span></span> <span data-ttu-id="03302-139">Это происходит после вызова задачи «Управление CDC» операцией `GetProcessingRange`.</span><span class="sxs-lookup"><span data-stu-id="03302-139">This is after the `GetProcessingRange` operation call to the CDC Control task.</span></span><br /><br /> <span data-ttu-id="03302-140">Если используется столбец __$reprocessing, он получает значение 1, чтобы показать, что пакет может повторно обрабатывать строки, уже находящиеся в целевой базе данных.</span><span class="sxs-lookup"><span data-stu-id="03302-140">If using the __$reprocessing column, it is set to 1 to indicate that the package may be re-processing rows already at the target.</span></span>|  
|<span data-ttu-id="03302-141">TFEND (завершение обновления тонкого канала)</span><span class="sxs-lookup"><span data-stu-id="03302-141">TFEND (Trickle-Feed Update Ended)</span></span>|<span data-ttu-id="03302-142">Это состояние, ожидаемое для регулярного выполнения CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-142">This is the state expected for regular CDC runs.</span></span> <span data-ttu-id="03302-143">Оно показывает, что предыдущее выполнение завершилось успешно и можно начинать новое выполнение с новым диапазоном обработки.</span><span class="sxs-lookup"><span data-stu-id="03302-143">It indicates that the previous run completed successfully and that a new run with a new processing range can be started.</span></span>|  
|<span data-ttu-id="03302-144">TFSTART</span><span class="sxs-lookup"><span data-stu-id="03302-144">TFSTART</span></span>|<span data-ttu-id="03302-145">Это состояние, которое возникает при последующем выполнении пакета обновления тонкого канала после вызова задачи «Управление CDC» операцией `GetProcessingRange`.</span><span class="sxs-lookup"><span data-stu-id="03302-145">This is the state on a non-initial run of the trickle feed update package, after the `GetProcessingRange` operation call to the CDC Control task.</span></span><br /><br /> <span data-ttu-id="03302-146">Оно показывает, что регулярное выполнение CDC начато, но еще не завершено или не завершено верно (`MarkProcessedRange`).</span><span class="sxs-lookup"><span data-stu-id="03302-146">This indicates that a regular CDC run is started but has not finished or has not yet finished, cleanly (`MarkProcessedRange`).</span></span>|  
|<span data-ttu-id="03302-147">TFREDO (повторная обработка обновления тонкого канала)</span><span class="sxs-lookup"><span data-stu-id="03302-147">TFREDO (Reprocessing Trickle-Feed Updates)</span></span>|<span data-ttu-id="03302-148">Это состояние операции `GetProcessingRange`, наступающее после TFSTART.</span><span class="sxs-lookup"><span data-stu-id="03302-148">This is the state on a `GetProcessingRange` that occurs after TFSTART.</span></span> <span data-ttu-id="03302-149">Оно показывает, что предыдущее выполнение не завершилось успешно.</span><span class="sxs-lookup"><span data-stu-id="03302-149">This indicates that the previous run did not complete successfully.</span></span><br /><br /> <span data-ttu-id="03302-150">Если используется столбец __$reprocessing, он получает значение 1, чтобы показать, что пакет может повторно обрабатывать строки, уже находящиеся в целевой базе данных.</span><span class="sxs-lookup"><span data-stu-id="03302-150">If using the __$reprocessing column, it is set to 1 to indicate that the package may be re-processing rows already at the target.</span></span>|  
|<span data-ttu-id="03302-151">ошибка</span><span class="sxs-lookup"><span data-stu-id="03302-151">ERROR</span></span>|<span data-ttu-id="03302-152">Группа CDC находится в состоянии ERROR.</span><span class="sxs-lookup"><span data-stu-id="03302-152">The CDC group is in an ERROR state.</span></span>|  
  
 <span data-ttu-id="03302-153">Ниже приведены примеры значений переменной состояния CDC.</span><span class="sxs-lookup"><span data-stu-id="03302-153">The following are examples of CDC state variable values.</span></span>  
  
-   <span data-ttu-id="03302-154">ILSTART/IR/0x0000162B158700000000//TS/2011-08-07T17:10:43.0031645/</span><span class="sxs-lookup"><span data-stu-id="03302-154">ILSTART/IR/0x0000162B158700000000//TS/2011-08-07T17:10:43.0031645/</span></span>  
  
-   <span data-ttu-id="03302-155">ILSTART/IR/0x0000162B158700000000//TS/2011-08-07T17:10:43.0031645/</span><span class="sxs-lookup"><span data-stu-id="03302-155">ILSTART/IR/0x0000162B158700000000//TS/2011-08-07T17:10:43.0031645/</span></span>  
  
-   <span data-ttu-id="03302-156">TFEND/CS/0x0000025B000001BC0003/TS/2011-07-17T12:05:58.1001145/</span><span class="sxs-lookup"><span data-stu-id="03302-156">TFEND/CS/0x0000025B000001BC0003/TS/2011-07-17T12:05:58.1001145/</span></span>  
  
-   <span data-ttu-id="03302-157">TFSTART/CS/0x0000030D000000AE0003/CE/0x0000159D1E0F01000000/TS/2011-08-09T05:30:43.9344900/</span><span class="sxs-lookup"><span data-stu-id="03302-157">TFSTART/CS/0x0000030D000000AE0003/CE/0x0000159D1E0F01000000/TS/2011-08-09T05:30:43.9344900/</span></span>  
  
-   <span data-ttu-id="03302-158">TFREDO/CS/0x0000030D000000AE0003/CE/0x0000159D1E0F01000000/TS/2011-08-09T05:30:59.5544900/</span><span class="sxs-lookup"><span data-stu-id="03302-158">TFREDO/CS/0x0000030D000000AE0003/CE/0x0000159D1E0F01000000/TS/2011-08-09T05:30:59.5544900/</span></span>  
  
### <a name="to-define-a-cdc-state-variable"></a><span data-ttu-id="03302-159">Определение переменной состояния CDC</span><span class="sxs-lookup"><span data-stu-id="03302-159">To define a CDC state variable</span></span>  
  
1.  <span data-ttu-id="03302-160">В [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)]откройте пакет [!INCLUDE[ssISCurrent](../../includes/ssiscurrent-md.md)] , в котором имеется поток CDC, где необходимо определить переменную.</span><span class="sxs-lookup"><span data-stu-id="03302-160">In [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)], open the [!INCLUDE[ssISCurrent](../../includes/ssiscurrent-md.md)] package that has the CDC flow where you need to define the variable.</span></span>  
  
2.  <span data-ttu-id="03302-161">Щелкните вкладку **Обозреватель пакетов** и добавьте новую переменную.</span><span class="sxs-lookup"><span data-stu-id="03302-161">Click the **Package Explorer** tab, and add a new variable.</span></span>  
  
3.  <span data-ttu-id="03302-162">Присвойте переменной имя, которое поможет обозначить ее как переменную состояния.</span><span class="sxs-lookup"><span data-stu-id="03302-162">Give the variable a name that you can recognize as your state variable.</span></span>  
  
4.  <span data-ttu-id="03302-163">Назначьте переменной тип данных **String** .</span><span class="sxs-lookup"><span data-stu-id="03302-163">Give the variable a **String** data type.</span></span>  
  
 <span data-ttu-id="03302-164">Не присваивайте переменной значение в составе ее определения.</span><span class="sxs-lookup"><span data-stu-id="03302-164">Do not give the variable a value as part of its definition.</span></span> <span data-ttu-id="03302-165">Значение должно быть задано задачей «Управление CDC».</span><span class="sxs-lookup"><span data-stu-id="03302-165">The value must be set by the CDC Control task.</span></span>  
  
 <span data-ttu-id="03302-166">Если намечено использовать задачу «Управление CDC» с параметром **Автоматическое сохранение состояния**, то переменная состояния CDC будет считываться из указанной таблицы состояния в базе данных и после обновления снова записываться в ту же таблицу при изменении ее значения.</span><span class="sxs-lookup"><span data-stu-id="03302-166">If you plan to use the CDC Control task with **Automatic State Persistence**, the CDC State variable will be read from the database state table you specify and will be updated back to that same table when its value changes.</span></span> <span data-ttu-id="03302-167">Дополнительные сведения о таблице состояния см. в разделах [CDC Control Task](../control-flow/cdc-control-task.md)и [CDC Control Task Editor](../cdc-control-task-editor.md).</span><span class="sxs-lookup"><span data-stu-id="03302-167">For more information about the State table, see [CDC Control Task](../control-flow/cdc-control-task.md)and [CDC Control Task Editor](../cdc-control-task-editor.md).</span></span>  
  
 <span data-ttu-id="03302-168">Если не используется задача «Управление CDC» с параметром автоматического сохранения состояния, то необходимо загружать значение переменной из постоянного хранилища, в котором это значение было сохранено в последний раз при прогоне пакета, а затем снова записывать его в постоянное хранилище после завершения работы с текущим диапазоном обработки.</span><span class="sxs-lookup"><span data-stu-id="03302-168">If you are not using the CDC Control task with Automatic State Persistence then you must load the variable value from persistent storage where its value was saved the last time the package ran and to write it back to the persistent storage when the processing of the current processing range was completed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="03302-169">См. также:</span><span class="sxs-lookup"><span data-stu-id="03302-169">See Also</span></span>  
 <span data-ttu-id="03302-170">[CDC Control Task](../control-flow/cdc-control-task.md) </span><span class="sxs-lookup"><span data-stu-id="03302-170">[CDC Control Task](../control-flow/cdc-control-task.md) </span></span>  
 [<span data-ttu-id="03302-171">CDC Control Task Editor</span><span class="sxs-lookup"><span data-stu-id="03302-171">CDC Control Task Editor</span></span>](../cdc-control-task-editor.md)  
  
  
