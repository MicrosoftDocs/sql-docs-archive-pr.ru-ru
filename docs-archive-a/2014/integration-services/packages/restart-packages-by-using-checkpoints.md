---
title: Перезапуск пакетов с помощью контрольных точек | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- checkpoints [Integration Services]
- restarting packages
- starting packages
ms.assetid: 48f2fbb7-8964-484a-8311-5126cf594bfb
author: chugugrace
ms.author: chugu
ms.openlocfilehash: aa0e0e9ad1da67bfc70dec61396ab026df62d3ee
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87665409"
---
# <a name="restart-packages-by-using-checkpoints"></a><span data-ttu-id="901f3-102">Перезапуск пакетов с помощью контрольных точек</span><span class="sxs-lookup"><span data-stu-id="901f3-102">Restart Packages by Using Checkpoints</span></span>
  [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] <span data-ttu-id="901f3-103">могут перезапустить пакеты, при выполнении которых произошел сбой, начиная с момента этого сбоя вместо перезапуска всего пакета.</span><span class="sxs-lookup"><span data-stu-id="901f3-103">can restart failed packages from the point of failure, instead of rerunning the whole package.</span></span> <span data-ttu-id="901f3-104">Если настройка пакета предполагает использование контрольных точек, сведения о выполнении пакета записываются в файл контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="901f3-104">If a package is configured to use checkpoints, information about package execution is written to a checkpoint file.</span></span> <span data-ttu-id="901f3-105">Файл контрольных точек используется при перезапуске давшего сбой пакета для осуществления повторного запуска пакета с момента сбоя.</span><span class="sxs-lookup"><span data-stu-id="901f3-105">When the failed package is rerun, the checkpoint file is used to restart the package from the point of failure.</span></span> <span data-ttu-id="901f3-106">В случае успешного выполнения пакета файл контрольных точек удаляется, а затем при следующем выполнении пакета создается повторно.</span><span class="sxs-lookup"><span data-stu-id="901f3-106">If the package runs successfully, the checkpoint file is deleted, and then re-created the next time the package is run.</span></span>  
  
 <span data-ttu-id="901f3-107">Использование контрольных точек в пакете обеспечивает следующие преимущества.</span><span class="sxs-lookup"><span data-stu-id="901f3-107">Using checkpoints in a package can provide the following benefits.</span></span>  
  
-   <span data-ttu-id="901f3-108">Предотвращение повторной загрузки и передачи файлов большого объема.</span><span class="sxs-lookup"><span data-stu-id="901f3-108">Avoid repeating the downloading and uploading of large files.</span></span> <span data-ttu-id="901f3-109">Например, пакет, осуществляющий загрузку множества файлов большого объема при помощи задачи «FTP» для каждой загрузки, можно перезапустить после сбоя, возникшего при загрузке отдельного файла, и загрузить только этот файл.</span><span class="sxs-lookup"><span data-stu-id="901f3-109">For example, a package that downloads multiple large files by using an FTP task for each download can be restarted after the downloading of a single file fails and then download only that file.</span></span>  
  
-   <span data-ttu-id="901f3-110">Предотвращение повторной загрузки больших объемов данных.</span><span class="sxs-lookup"><span data-stu-id="901f3-110">Avoid repeating the loading of large amounts of data.</span></span> <span data-ttu-id="901f3-111">Например, пакет выполняет массовые вставки в таблицы измерения в хранилище данных при помощи задачи «Массовая вставка» для каждого измерения. Пакет можно перезапустить после сбоя, возникшего при выполнении вставки для отдельной таблицы измерений, и заново загрузить только это измерение.</span><span class="sxs-lookup"><span data-stu-id="901f3-111">For example, a package that performs bulk inserts into dimension tables in a data warehouse using a different Bulk Insert task for each dimension can be restarted if the insertion fails for one dimension table, and only that dimension will be reloaded.</span></span>  
  
-   <span data-ttu-id="901f3-112">Предотвращение повторного выполнения статистической обработки значений.</span><span class="sxs-lookup"><span data-stu-id="901f3-112">Avoid repeating the aggregation of values.</span></span> <span data-ttu-id="901f3-113">Например, пакет выполняет вычисление нескольких статистических выражений, таких как среднее и суммарное значения, при помощи задачи потока данных для выполнения каждого статистического выражения. Пакет можно перезапустить после сбоя, возникшего при вычислении отдельного выражения, и заново выполнить вычисление только этого выражения.</span><span class="sxs-lookup"><span data-stu-id="901f3-113">For example, a package that computes many aggregates, such as averages and sums, using a separate Data Flow task to perform each aggregation, can be restarted after computing an aggregation fails and only that aggregation will be recomputed.</span></span>  
  
 <span data-ttu-id="901f3-114">Если настройка пакета предполагает использование контрольных точек, службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] фиксируют точку перезапуска в файле контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="901f3-114">If a package is configured to use checkpoints, [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] captures the restart point in the checkpoint file.</span></span> <span data-ttu-id="901f3-115">Тип вызвавшего сбой контейнера и выполнение таких компонентов, как транзакция, влияют на точку перезапуска, записываемую в файл контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="901f3-115">The type of container that fails and the implementation of features such as transactions affect the restart point that is recorded in the checkpoint file.</span></span> <span data-ttu-id="901f3-116">Текущие значения переменных также находятся в файле контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="901f3-116">The current values of variables are also captured in the checkpoint file.</span></span> <span data-ttu-id="901f3-117">Тем не менее значения переменных, имеющих тип данных `Object`, не содержатся в файле контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="901f3-117">However, the values of variables that have the `Object` data type are not saved in checkpoint files.</span></span>  
  
## <a name="defining-restart-points"></a><span data-ttu-id="901f3-118">Определение точек перезапуска</span><span class="sxs-lookup"><span data-stu-id="901f3-118">Defining Restart Points</span></span>  
 <span data-ttu-id="901f3-119">Контейнер сервера задач, в котором заключена единственная задача, является наименьшей единицей работы, которая может быть перезапущена.</span><span class="sxs-lookup"><span data-stu-id="901f3-119">The task host container, which encapsulates a single task, is the smallest atomic unit of work that can be restarted.</span></span> <span data-ttu-id="901f3-120">Контейнер «цикл по каждому элементу» и контейнер транзакций также рассматриваются как наименьшие единицы работы.</span><span class="sxs-lookup"><span data-stu-id="901f3-120">The Foreach Loop container and a transacted container are also treated as atomic units of work.</span></span>  
  
 <span data-ttu-id="901f3-121">Если выполнение пакета прекращается, а работа контейнера транзакций все еще продолжается, транзакция завершается, а вся работа, произведенная контейнером, отменяется.</span><span class="sxs-lookup"><span data-stu-id="901f3-121">If a package is stopped while a transacted container is running, the transaction ends and any work performed by the container is rolled back.</span></span> <span data-ttu-id="901f3-122">При перезапуске пакета заново запускается давший сбой контейнер.</span><span class="sxs-lookup"><span data-stu-id="901f3-122">When the package is restarted, the container that failed is rerun.</span></span> <span data-ttu-id="901f3-123">Сведения о завершении работы дочерних контейнеров контейнера транзакций не заносятся в файл контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="901f3-123">The completion of any child containers of transacted container is not recorded in the checkpoint file.</span></span> <span data-ttu-id="901f3-124">Поэтому при перезапуске пакета контейнер транзакций и его дочерние контейнеры запускаются снова.</span><span class="sxs-lookup"><span data-stu-id="901f3-124">Therefore, when the package is restarted, the transacted container and its child containers run again.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="901f3-125">Использование контрольных точек и транзакций в одном и том же пакете может привести к непредвиденным результатам.</span><span class="sxs-lookup"><span data-stu-id="901f3-125">Using checkpoints and transactions in the same package could cause unexpected results.</span></span> <span data-ttu-id="901f3-126">Так, если выполнение пакета завершается аварийно и возобновляется с контрольной точки, этот пакет может повторить транзакцию, которая уже была успешно зафиксирована.</span><span class="sxs-lookup"><span data-stu-id="901f3-126">For example, when a package fails and restarts from a checkpoint, the package might repeat a transaction that has already been successfully committed.</span></span>  
  
 <span data-ttu-id="901f3-127">Данные контрольных точек не сохраняются для контейнеров «цикл по элементам» и «цикл по каждому элементу».</span><span class="sxs-lookup"><span data-stu-id="901f3-127">Checkpoint data is not saved for For Loop and Foreach Loop containers.</span></span> <span data-ttu-id="901f3-128">При перезапуске пакета контейнеры «цикл по элементам» и «цикл по каждому элементу» и их дочерние контейнеры запускаются снова.</span><span class="sxs-lookup"><span data-stu-id="901f3-128">When a package is restarted, the For Loop and Foreach Loop containers and the child containers are run again.</span></span> <span data-ttu-id="901f3-129">При успешном выполнении в цикле сведения о завершении дочернего контейнера в файл контрольных точек не заносятся, вместо этого осуществляется перезапуск контейнера.</span><span class="sxs-lookup"><span data-stu-id="901f3-129">If a child container in the loop runs successfully, it is not recorded in the checkpoint file, instead it is rerun.</span></span> <span data-ttu-id="901f3-130">Дополнительные сведения и решение см. в статье [Контрольные точки служб SSIS не соблюдаются элементами контейнера «цикл по элементам» и «цикл по каждому элементу»](https://go.microsoft.com/fwlink/?LinkId=241633).</span><span class="sxs-lookup"><span data-stu-id="901f3-130">For more information and a workaround, see [SSIS Checkpoints are not honored for For Loop or Foreach Loop container items](https://go.microsoft.com/fwlink/?LinkId=241633).</span></span>  
  
 <span data-ttu-id="901f3-131">При перезапуске пакета настройки пакета не загружаются заново: пакет использует сведения о настройке, записанные в файл контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="901f3-131">If the package is restarted the package configurations are not reloaded, instead the package uses the configuration information written to the checkpoint file.</span></span> <span data-ttu-id="901f3-132">При повторном выполнении пакета это обеспечивает использование тех же настроек, которые действовали в момент сбоя.</span><span class="sxs-lookup"><span data-stu-id="901f3-132">This ensures that the package uses the same configurations when it is rerun as the time it failed.</span></span>  
  
 <span data-ttu-id="901f3-133">Перезапуск пакета можно осуществить только на уровне потока управления.</span><span class="sxs-lookup"><span data-stu-id="901f3-133">A package can be restarted only at the control flow level.</span></span> <span data-ttu-id="901f3-134">Невозможно перезапустить пакет в середине потока данных.</span><span class="sxs-lookup"><span data-stu-id="901f3-134">You cannot restart a package in the middle of a data flow.</span></span> <span data-ttu-id="901f3-135">Во избежание перезапуска всего потока данных пакет следует спроектировать таким образом, чтобы в нем содержалось несколько потоков данных, каждый из которых использовал бы свою задачу потока данных.</span><span class="sxs-lookup"><span data-stu-id="901f3-135">To avoid rerunning the whole data flow, the package might be designed to include multiple data flows, each one using a different Data Flow task.</span></span> <span data-ttu-id="901f3-136">Таким образом, пакет можно перезапустить с повторным выполнением только одной задачи потока данных.</span><span class="sxs-lookup"><span data-stu-id="901f3-136">This way the package can be restarted, rerunning only one Data Flow task.</span></span>  
  
## <a name="configuring-a-package-to-restart"></a><span data-ttu-id="901f3-137">Настройка пакета для перезапуска</span><span class="sxs-lookup"><span data-stu-id="901f3-137">Configuring a Package to Restart</span></span>  
 <span data-ttu-id="901f3-138">Файл контрольных точек содержит результаты выполнения всех завершенных контейнеров, текущие значения системных и пользовательских переменных, а также сведения о настройке пакета.</span><span class="sxs-lookup"><span data-stu-id="901f3-138">The checkpoint file includes the execution results of all completed containers, the current values of system and user-defined variables, and package configuration information.</span></span> <span data-ttu-id="901f3-139">Кроме того, файл содержит уникальный идентификатор пакета.</span><span class="sxs-lookup"><span data-stu-id="901f3-139">The file also includes the unique identifier of the package.</span></span> <span data-ttu-id="901f3-140">Для успешного перезапуска пакета идентификатор пакета в файле контрольных точек должен совпадать с идентификатором в пакете, в противном случае перезапуск завершится сбоем.</span><span class="sxs-lookup"><span data-stu-id="901f3-140">To successfully restart a package, the package identifier in the checkpoint file and the package must match; otherwise the restart fails.</span></span> <span data-ttu-id="901f3-141">Это предотвращает использование пакетом файла контрольных точек, записанного пакетом другой версии.</span><span class="sxs-lookup"><span data-stu-id="901f3-141">This prevents a package from using a checkpoint file written by a different package version.</span></span> <span data-ttu-id="901f3-142">Если пакет выполнен успешно, после его перезапуска файл контрольных точек удаляется.</span><span class="sxs-lookup"><span data-stu-id="901f3-142">If the package runs successfully, after it is restarted the checkpoint file is deleted.</span></span>  
  
 <span data-ttu-id="901f3-143">В следующей таблице представлены свойства пакета, которые устанавливаются для использования контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="901f3-143">The following table lists the package properties that you set to implement checkpoints.</span></span>  
  
|<span data-ttu-id="901f3-144">Свойство</span><span class="sxs-lookup"><span data-stu-id="901f3-144">Property</span></span>|<span data-ttu-id="901f3-145">Description</span><span class="sxs-lookup"><span data-stu-id="901f3-145">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="901f3-146">CheckpointFileName</span><span class="sxs-lookup"><span data-stu-id="901f3-146">CheckpointFileName</span></span>|<span data-ttu-id="901f3-147">Определяет имя файла контрольных точек.</span><span class="sxs-lookup"><span data-stu-id="901f3-147">Specifies the name of the checkpoint file.</span></span>|  
|<span data-ttu-id="901f3-148">CheckpointUsage</span><span class="sxs-lookup"><span data-stu-id="901f3-148">CheckpointUsage</span></span>|<span data-ttu-id="901f3-149">Определяет, используются ли контрольные точки.</span><span class="sxs-lookup"><span data-stu-id="901f3-149">Specifies whether checkpoints are used.</span></span>|  
|<span data-ttu-id="901f3-150">SaveCheckpoints</span><span class="sxs-lookup"><span data-stu-id="901f3-150">SaveCheckpoints</span></span>|<span data-ttu-id="901f3-151">Показывает, сохраняет ли пакет контрольные точки.</span><span class="sxs-lookup"><span data-stu-id="901f3-151">Indicates whether the package saves checkpoints.</span></span> <span data-ttu-id="901f3-152">Для перезапуска пакета с момента сбоя это свойство должно иметь значение True.</span><span class="sxs-lookup"><span data-stu-id="901f3-152">This property must be set to True to restart a package from a point of failure.</span></span>|  
  
 <span data-ttu-id="901f3-153">Кроме того, необходимо установить свойство FailPackageOnFailure в значение `true` для всех контейнеров пакета, которые необходимо определить как точки перезапуска.</span><span class="sxs-lookup"><span data-stu-id="901f3-153">Additionally, you must set the FailPackageOnFailure property to `true` for all the containers in the package that you want to identify as restart points.</span></span>  
  
 <span data-ttu-id="901f3-154">Для проверки использования контрольных точек в пакете можно применить свойство ForceExecutionResult.</span><span class="sxs-lookup"><span data-stu-id="901f3-154">You can use the ForceExecutionResult property to test the use of checkpoints in a package.</span></span> <span data-ttu-id="901f3-155">Установив для свойства ForceExecutionResult задачи или контейнера значение Failure, можно имитировать сбой в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="901f3-155">By setting ForceExecutionResult of a task or container to Failure, you can imitate real-time failure.</span></span> <span data-ttu-id="901f3-156">При перезапуске пакета вызвавшие сбой задача и контейнеры будут перезапущены.</span><span class="sxs-lookup"><span data-stu-id="901f3-156">When you rerun the package, the failed task and containers will be rerun.</span></span>  
  
### <a name="checkpoint-usage"></a><span data-ttu-id="901f3-157">Использование контрольных точек</span><span class="sxs-lookup"><span data-stu-id="901f3-157">Checkpoint Usage</span></span>  
 <span data-ttu-id="901f3-158">Свойство CheckpointUsage может принимать следующие значения:</span><span class="sxs-lookup"><span data-stu-id="901f3-158">The CheckpointUsage property can be set to the following values:</span></span>  
  
|<span data-ttu-id="901f3-159">Значение</span><span class="sxs-lookup"><span data-stu-id="901f3-159">Value</span></span>|<span data-ttu-id="901f3-160">Description</span><span class="sxs-lookup"><span data-stu-id="901f3-160">Description</span></span>|  
|-----------|-----------------|  
|`Never`|<span data-ttu-id="901f3-161">Указывает, что файл контрольных точек не используется и пакет выполняется с начала рабочего процесса пакета.</span><span class="sxs-lookup"><span data-stu-id="901f3-161">Specifies that the checkpoint file is not used and that the package runs from the start of the package workflow.</span></span>|  
|`Always`|<span data-ttu-id="901f3-162">Указывает, что файл контрольных точек используется всегда и пакет перезапускается с момента предыдущего сбоя в выполнении.</span><span class="sxs-lookup"><span data-stu-id="901f3-162">Specifies that the checkpoint file is always used and that the package restarts from the point of the previous execution failure.</span></span> <span data-ttu-id="901f3-163">Если файл контрольных точек не обнаружен, при выполнении пакета происходит сбой.</span><span class="sxs-lookup"><span data-stu-id="901f3-163">If the checkpoint file is not found, the package fails.</span></span>|  
|`IfExists`|<span data-ttu-id="901f3-164">Указывает, что файл контрольных точек должен использоваться, если он существует.</span><span class="sxs-lookup"><span data-stu-id="901f3-164">Specifies that the checkpoint file is used if it exists.</span></span> <span data-ttu-id="901f3-165">Если файл контрольных точек существует, пакет перезапускается с момента последнего сбоя в выполнении; иначе пакет выполняется с начала рабочего процесса пакета.</span><span class="sxs-lookup"><span data-stu-id="901f3-165">If the checkpoint file exists, the package restarts from the point of the previous execution failure; otherwise, it runs from the start of the package workflow.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="901f3-166">Параметр **/checkpointing on команды on** программы dtexec эквивалентен присвоению `SaveCheckpoints` свойству пакета значения `True` , а свойству — значение `CheckpointUsage` Always.</span><span class="sxs-lookup"><span data-stu-id="901f3-166">The **/CheckPointing on** option of dtexec is equivalent to setting the `SaveCheckpoints` property of the package to `True`, and the `CheckpointUsage` property to Always.</span></span> <span data-ttu-id="901f3-167">Дополнительные сведения см. в статье [dtexec Utility](dtexec-utility.md).</span><span class="sxs-lookup"><span data-stu-id="901f3-167">For more information, see [dtexec Utility](dtexec-utility.md).</span></span>  
  
## <a name="securing-checkpoint-files"></a><span data-ttu-id="901f3-168">Защита файлов контрольных точек</span><span class="sxs-lookup"><span data-stu-id="901f3-168">Securing Checkpoint Files</span></span>  
 <span data-ttu-id="901f3-169">Уровень защиты пакета не включает защиту файлов контрольных точек, поэтому необходимо дополнительно обеспечить их защиту.</span><span class="sxs-lookup"><span data-stu-id="901f3-169">Package level protection does not include protection of checkpoint files and you must secure these files separately.</span></span> <span data-ttu-id="901f3-170">Данные контрольных точек могут быть сохранены только в файловой системе, поэтому необходимо использовать список управления доступом (ACL) операционной системы для обеспечения безопасности места расположения или папки, где хранятся файлы.</span><span class="sxs-lookup"><span data-stu-id="901f3-170">Checkpoint data can be stored only in the file system and you should use an operating system access control list (ACL) to secure the location or folder where you store the file.</span></span> <span data-ttu-id="901f3-171">Важно защитить файлы контрольных точек, так как они содержат сведения о состоянии пакета, включая текущие значения переменных.</span><span class="sxs-lookup"><span data-stu-id="901f3-171">It is important to secure checkpoint files because they contain information about the package state, including the current values of variables.</span></span> <span data-ttu-id="901f3-172">Например, переменная может содержать набор записей с многочисленными строками личных данных, таких как номера телефонов.</span><span class="sxs-lookup"><span data-stu-id="901f3-172">For example, a variable may contain a recordset with many rows of private data such as telephone numbers.</span></span> <span data-ttu-id="901f3-173">Дополнительные сведения см. в разделе [Доступ к файлам, используемым пакетами](../access-to-files-used-by-packages.md).</span><span class="sxs-lookup"><span data-stu-id="901f3-173">For more information, see [Access to Files Used by Packages](../access-to-files-used-by-packages.md).</span></span>  
  
### <a name="to-configure-the-checkpoint-properties"></a><span data-ttu-id="901f3-174">Настройка свойств контрольных точек</span><span class="sxs-lookup"><span data-stu-id="901f3-174">To configure the checkpoint properties</span></span>  
  
-   [<span data-ttu-id="901f3-175">Настройка контрольных точек для повторного запуска пакета, завершившегося с ошибкой</span><span class="sxs-lookup"><span data-stu-id="901f3-175">Configure Checkpoints for Restarting a Failed Package</span></span>](../configure-checkpoints-for-restarting-a-failed-package.md)  
  
## <a name="external-resources"></a><span data-ttu-id="901f3-176">Внешние ресурсы</span><span class="sxs-lookup"><span data-stu-id="901f3-176">External Resources</span></span>  
  
-   <span data-ttu-id="901f3-177">Техническая статья [Автоматический перезапуск пакетов служб SSIS после отработки отказа или ошибки](https://go.microsoft.com/fwlink/?LinkId=200407)на сайте social.technet.microsoft.com</span><span class="sxs-lookup"><span data-stu-id="901f3-177">Technical article, [Automatic Restart of SSIS packages after Failover or Failure](https://go.microsoft.com/fwlink/?LinkId=200407), on social.technet.microsoft.com</span></span>  
  
-   <span data-ttu-id="901f3-178">Статья службы поддержки [Контрольные точки служб SSIS не соблюдаются элементами контейнера «цикл по элементам» и «цикл по каждому элементу»](https://go.microsoft.com/fwlink/?LinkId=241633)на сайте support.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="901f3-178">Support article, [SSIS Checkpoints are not honored for For Loop or Foreach Loop container items](https://go.microsoft.com/fwlink/?LinkId=241633), on support.microsoft.com.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="901f3-179">См. также:</span><span class="sxs-lookup"><span data-stu-id="901f3-179">See Also</span></span>  
 [<span data-ttu-id="901f3-180">SQL Server Integration Services</span><span class="sxs-lookup"><span data-stu-id="901f3-180">SQL Server Integration Services</span></span>](../sql-server-integration-services.md)  
  
  
