---
title: Импорт из Excel или экспорт в Excel с помощью SSIS | Документы Майкрософт
description: Сведения о том, как импортировать или экспортировать данные Excel с помощью служб SQL Server Integration Services (SSIS), а также о необходимых компонентах, известных проблемах и ограничениях.
ms.date: 04/10/2018
ms.prod: sql-server-2014
ms.prod_service: integration-services
ms.reviewer: ''
ms.custom: ''
ms.technology: integration-services
ms.topic: conceptual
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 58b0165925e73d0eb72b118113bc354338741a0e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87664326"
---
# <a name="import-data-from-excel-or-export-data-to-excel-with-sql-server-integration-services-ssis"></a>Импорт данных из Excel или экспорт данных в Excel с помощью служб SQL Server Integration Services (SSIS)

В этой статье описывается порядок импорта данных из приложения Excel или экспорта данных в него с помощью служб SQL Server Integration Services (SSIS). Кроме того, здесь описываются необходимые условия, ограничения и известные проблемы.

Чтобы импортировать данные из приложения Excel или экспортировать данные в него, можно создать пакет SSIS и использовать диспетчер соединений Excel, а также источник или назначение Excel. Кроме того, вы можете использовать для этих целей мастер импорта и экспорта SQL Server, который построен на основе служб SSIS.

В этой статье содержатся три набора информации, которые необходимы для успешной работы с приложением Excel из служб SSIS, а также для понимания и устранения распространенных проблем:
1.  Необходимые [файлы](#files-you-need).
2.  Сведения, которые необходимо предоставить при загрузке данных в приложение Excel или из него.
    -   [Укажите Excel](#specify-excel) в качестве источника данных.
    -   Укажите [имя файла Excel и путь к нему](#excel-file).
    -   Выберите [версию Excel](#excel-version).
    -   Укажите, содержит ли [первая строка имена столбцов](#first-row).
    -   Укажите [лист или диапазон, который содержит данные](#sheets-ranges).
3.  Известные проблемы и ограничения.
    -   Проблемы с [типами данных](#issues-types).
    -   Проблемы с [импортом](#issues-importing).
    -   Проблемы с [экспортом](#issues-exporting).

## <a name="get-the-files-you-need-to-connect-to-excel"></a><a name="files-you-need"></a> Получение файлов, необходимых для подключения к Excel

Прежде чем импортировать данные из приложения Excel или экспортировать данные в него, вам может потребоваться скачать компоненты подключений для Excel, если они еще не установлены. По умолчанию компоненты подключений для Excel не устанавливаются.

Скачать последнюю версию компонентов подключения для Excel можно на следующей странице: [Распространяемый пакет ядра СУБД Microsoft Access 2016](https://www.microsoft.com/download/details.aspx?id=54920).
  
Последняя версия компонентов позволяет открывать файлы, созданные в более ранних версиях Excel.

Обратите внимание, что необходимо скачать *распространяемый пакет* ядра СУБД Access 2016, а не *среду выполнения* Microsoft Access 2016.

Если на компьютере уже установлена 32-разрядная версия Office, необходимо установить 32-разрядную версию компонентов. Кроме того, следует выполнять пакет служб SSIS в 32-разрядном режиме или 32-разрядную версию мастера импорта и экспорта.

Если у вас есть подписка на Office 365, при запуске программы установки может появиться сообщение об ошибке. Это сообщение свидетельствует о том, что невозможно установить скачанные компоненты вместе с компонентами Office, полученными с помощью технологии "нажми и работай". Чтобы обойти это сообщение, запустите установку в тихом режиме. Для этого откройте окно командной строки и запустите скачанный EXE-файл с параметром `/quiet`. Пример:

`C:\Users\<user name>\Downloads\AccessDatabaseEngine.exe /quiet`

При возникновении проблем с установкой распространяемого пакета версии 2016 установите вместо него распространяемый пакет версии 2010 со следующей страницы: [Распространяемый пакет ядра СУБД Microsoft Access 2010](https://www.microsoft.com/download/details.aspx?id=13255). (Для Excel 2013 распространяемый пакет не предусмотрен.)

## <a name="specify-excel"></a><a name="specify-excel"></a> Указание Excel

Сначала необходимо указать, что вам требуется установить подключение к Excel.

### <a name="in-ssis"></a>В службах SSIS
В службах SSIS создайте диспетчер соединений Excel для подключения к файлу источника или назначения Excel. Создать диспетчер соединений можно несколькими способами:

-   Щелкните правой кнопкой в области **Диспетчеры соединений** и выберите команду **Создать соединение**. В диалоговом окне **Добавление диспетчера соединений со службами SSIS** выберите **EXCEL** и затем **Добавить**.
 
-   В меню **Службы SSIS** выберите **Создать соединение**. В диалоговом окне **Добавление диспетчера соединений со службами SSIS** выберите **EXCEL** и затем **Добавить**.

-   Диспетчер соединений необходимо создавать в то время, как вы настраиваете **источник Excel** или **назначение Excel** на странице **Диспетчер соединений** в **редакторе источника Excel** или в **редакторе назначения Excel**.

### <a name="in-the-sql-server-import-and-export-wizard"></a>В мастере импорта и экспорта SQL Server
В мастере импорта и экспорта на странице **Выбор источника данных** или **Выбор назначения** выберите **Microsoft Excel** в списке **Источник данных**.

Если вы не видите Excel в списке источников данных, убедитесь, что используется 32-разрядная версия мастера. Компоненты подключений для Excel обычно представляют собой 32-разрядные файлы и не отображаются в 64-разрядной версии мастера.

## <a name="excel-file-and-file-path"></a><a name="excel-file"></a> Файл Excel и путь к нему

В первую очередь необходимо предоставить имя файла Excel и путь к нему. Это можно сделать в **редакторе диспетчера соединений Excel** в пакете служб SSIS либо на странице **Выбор источника данных** или **Выбор назначения** в мастере импорта и экспорта.

Введите имя файла и путь к нему в следующем формате:

-   Для файла на локальном компьютере: **C:\\TestData.xlsx**.

-   Для файла в общей сетевой папке: **\\\\Sales\\Data\\TestData.xlsx**.

Также можно нажать кнопку **Обзор** и выбрать электронную таблицу в диалоговом окне **Открыть**.  
  
> [!IMPORTANT]
> Подключить защищенный паролем файл Excel нельзя.

## <a name="excel-version"></a><a name="excel-version"></a> Версия Excel

Далее следует предоставить сведения о версии файла Excel. Это можно сделать в **редакторе диспетчера соединений Excel** в пакете служб SSIS либо на странице **Выбор источника данных** или **Выбор назначения** в мастере импорта и экспорта.

Выберите версию Microsoft Excel, в которой был создан файл, или другую совместимую версию. Например, если вам не удалось установить компоненты подключений для версии 2016, вы можете установить компоненты для версии 2010 и выбрать в этом списке вариант **Microsoft Excel 2007-2010**.

Если у вас установлены старые версии компонентов подключений, вы не сможете выбрать более новые версии Excel в этом списке. Список **Версия Excel** содержит все версии Excel, поддерживаемые службами SSIS. Наличие элементов в этом списке не означает, что необходимые компоненты подключений были установлены. Например, вариант **Microsoft Excel 2016** будет присутствовать в этом списке даже в том случае, если у вас не установлены компоненты подключений для версии 2016.

## <a name="first-row-has-column-names"></a><a name="first-row"></a> Первая строка содержит имена столбцов

Если вы импортируете данные из Excel, далее необходимо указать, содержит ли первая строка данных имена столбцов. Это можно сделать в **редакторе диспетчера соединений Excel** в пакете служб SSIS или на странице **Выбор источника данных** в мастере импорта и экспорта.

-   Если этот параметр отключен, поскольку в данных источника отсутствуют имена столбцов, мастер будет использовать в качестве заголовков столбцов значения F1, F2 и т. д.
-   Если данные содержат имена столбцов, но этот параметр отключен, мастер импортирует строку имен столбцов как первую строку данных.
-   Если данные не содержат имена столбцов, но этот параметр включен, мастер использует первую строку данных источника как имена столбцов. В этом случае первая строка в данных источника не включается в сами данные.

Если вы экспортируете данные из Excel и включили этот параметр, первая строка экспортированных данных будет включать имена столбцов.

## <a name="worksheets-and-ranges"></a><a name="sheets-ranges"></a> Листы и диапазоны

В качестве источника или назначения для данных можно использовать три типа объектов Excel: лист, именованный диапазон или неименованный диапазон ячеек, который задается с помощью адреса.

-   **Лист** Чтобы указать лист, добавьте в конец имени листа символ `$` и окружите строку разделителями, например **[Листt1$]** . Также можно выполнить поиск имени, заканчивающегося символом `$`, в списке существующих таблиц и представлений.

-   **Именованный диапазон** Чтобы указать именованный диапазон, используйте имя диапазона, например **Мой_диапазон**. Также можно выполнить поиск имени, не заканчивающегося символом `$`, в списке существующих таблиц и представлений.
    
-   **Неименованный диапазон** Чтобы указать диапазон ячеек, которым не были заданы имена, добавьте символ $ после имени листа, добавьте спецификацию диапазона и окружите строку разделителями, например **[Лист1$A1:B4]** .

Чтобы выбрать или указать тип объекта Excel, который вы хотите использовать в качестве источника или назначения для данных, выполните одно из следующих действий:

### <a name="in-ssis"></a>В службах SSIS

В службах SSIS на странице **Диспетчер соединений** в **редакторе источника Excel** или **редакторе назначения Excel** выполните одно из следующих действий:

-   Чтобы использовать **лист** или **именованный диапазон**, выберите **Таблица или представление** в разделе **Режим доступа к данным**. Затем выберите лист или именованный диапазон в списке **Имя листа Excel**.

-   Чтобы использовать **неименованный диапазон**, который задается по адресу, выберите **Команда SQL** в разделе **Режим доступа к данным**. Затем в поле **Текст команды SQL** введите запрос, аналогичный представленному ниже примеру:

    ```sql
    SELECT * FROM [Sheet1$A1:B5]
    ```

### <a name="in-the-sql-server-import-and-export-wizard"></a>В мастере импорта и экспорта SQL Server
В мастере импорта и экспорта выполните одно из следующих действий:

-   При **импорте** из Excel выполните одно из следующих действий:

    -   Чтобы использовать **лист** или **именованный диапазон**, на странице **Выбор копирования таблицы или запроса** выберите **Скопировать данные из одной или нескольких таблиц или представлений**. Затем на странице **Выбор исходных таблиц и представлений** в столбце **Источник** укажите исходные листы и именованные диапазоны.

    -   Чтобы использовать **неименованный диапазон**, который задается по адресу, на странице **Выбор копирования таблицы или запроса** выберите **Написать запрос, указывающий данные для передачи**. Затем на странице **Определение исходного запроса** введите запрос, аналогичный показанному ниже:

        ```sql
        SELECT * FROM [Sheet1$A1:B5]
        ```

-   При **экспорте** в Excel выполните одно из следующих действий:

    -   Чтобы использовать **лист** или **именованный диапазон**, на странице **Выбор исходных таблиц и представлений** в столбце **Назначение** выберите целевые листы и именованные диапазоны.

    -   Чтобы использовать **неименованный диапазон**, который задается по адресу, на странице **Выбор исходных таблиц и представлений** в столбце **Назначение** укажите диапазон в следующем формате без использования разделителей: `Sheet1$A1:B5`. Мастер автоматически добавит разделители.

После выбора или ввода объектов Excel для импорта или экспорта вы также можете выполнить следующие действия на странице **Выбор исходных таблиц и представлений** мастера:

-   Проверить сопоставления столбцов между источником и назначением, выбрав команду **Изменить сопоставления**.

-   Выполнить предварительный просмотр данных, чтобы убедиться в правильности выбора, с помощью команды **Предварительный просмотр**.

## <a name="issues-with-data-types"></a><a name="issues-types"></a>Проблемы с типами данных

### <a name="data-types"></a>Типы данных

Драйвер Excel распознает только ограниченный набор типов данных. Например, все числовые столбцы воспринимаются как тип double (DT_R8), а все строковые столбцы (кроме столбцов типа memo) воспринимаются как строки в Юникоде длиной 255 символов (DT_WSTR). Службы SSIS сопоставляют типы данных Excel следующим образом:

-   Числовой — с плавающей запятой двойной точности (DT_R8)

-   Денежный — денежный (DT_CY)

-   Логический — логический (DT_BOOL)

-   Дата и время — datetime (DT_DATE)

-   Строковый — строка в Юникоде длиной в 255 символов (DT_WSTR)

-   Memo — текстовый поток в Юникоде (DT_NTEXT)

### <a name="data-type-and-length-conversions"></a>Преобразования типов данных и длины по умолчанию

В службах SSIS неявное преобразование типов данных не выполняется. В результате, возможно, потребуется использовать преобразование "Производный столбец" или "Преобразование данных" для явного преобразования данных Excel до их загрузки в назначение, отличное от Excel, либо для преобразования данных из источника, отличного от Excel, до их загрузки в назначение Excel.

Ниже приведены некоторые примеры преобразований, которые могут потребоваться:  
  
-   Преобразование между строковыми столбцами Excel в Юникоде и строковыми столбцами в формате с конкретными кодовыми страницами, отличными от Юникода.
  
-   Преобразование между строковыми столбцами Excel длиной в 255 символов и строковыми столбцами другой длины.
  
-   Преобразование между числовыми столбцами Excel с плавающей запятой двойной точности и числовыми столбцами других типов.

> [!TIP]
> Если вы используете мастер импорта и экспорта и вам требуется выполнить некоторые из этих преобразований данных, мастер выполнит настройку необходимых преобразований автоматически. В результате, даже если вам требуется использовать пакет служб SSIS, часто бывает полезно создать первичный пакет с помощью мастера импорта и экспорта. В таком случае мастер создаст и настроит диспетчеры соединений, источники, преобразования и назначения автоматически.

## <a name="issues-with-importing"></a><a name="issues-importing"></a> Проблемы с импортом

### <a name="empty-rows"></a>Пустые строки

Если в качестве источника указан лист или диапазон, драйвер считывает *непрерывный* блок ячеек, начиная с первой непустой ячейки в верхнем левом углу листа или диапазона. В результате данные могут начинаться не со строки 1, однако в данных источника не должны присутствовать пустые строки. Например, пустые строки не допускаются между заголовками столбцов и строками данных, а также после названия в верхней части листа.

Если над данными располагаются пустые строки, вы не сможете выполнить их запрос в качестве листа. В Excel необходимо выбрать диапазон данных, присвоить ему имя и выполнить запрос к именованному диапазону, а не к листу.

### <a name="missing-values"></a>Отсутствующие значения

Драйвер Excel считывает определенное количество строк (по умолчанию 8 строк) в указанном источнике для определения типа данных каждого столбца. Если столбец содержит смешанные типы данных, особенно если числовые данные смешаны с текстовыми данными, драйвер принимает решение в пользу того типа данных, которого больше, и возвращает значения NULL в ячейки, содержащие данные другого типа. (В случае равенства преимущество получает числовой тип.) Большинство параметров форматирования ячеек в листе Excel не затрагивает это определение типа данных.

Можно изменить поведение драйвера Excel, указав режим импорта для импорта всех значений в виде текста. Чтобы указать режим импорта, добавьте `IMEX=1` к значению **расширенных свойств** в строке соединения диспетчера соединений с Excel в окне "Свойства". 

### <a name="truncated-text"></a>Усеченный текст

Когда драйвер определяет, что столбец Excel содержит текстовые данные, он выбирает тип данных (строковый или memo) на основании самого длинного значения. Если драйвер не обнаруживает значений длиннее 255 символов в выбираемых строках, он считает, что столбец является строковым с длиной 255 символов, а не столбцом типа memo. Поэтому значения длиннее 255 символов могут быть усечены.

Чтобы импортировать данные из столбца типа memo без усечения, можно воспользоваться любым из двух способов:

-   Убедитесь, что столбец типа memo как минимум в одной из выбранных строк содержит значение длиной более 255 символов.

-   Увеличьте число строк в выборке драйвера, чтобы включить такую строку. Чтобы увеличить количество строк, включаемых в выборку, достаточно увеличить значение **TypeGuessRows** в следующем разделе реестра:

| Версия распространяемого компонента | Раздел реестра |
|---|---|
| Excel 2016 | HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Office\16.0\Access Connectivity Engine\Engines\Excel |
| Excel 2010 | HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Office\14.0\Access Connectivity Engine\Engines\Excel |
| | |

## <a name="issues-with-exporting"></a><a name="issues-exporting"></a> Проблемы с экспортом

### <a name="create-a-new-destination-file"></a>Создание нового файла назначения

#### <a name="in-ssis"></a>В службах SSIS

Создайте диспетчер соединений Excel с именем создаваемого файла Excel и путем к нему. Затем в **редакторе назначения Excel** в разделе **Имя листа Excel** выберите **Создать**, чтобы создать лист назначения. В этот момент службы SSIS создают новый файл Excel с указанным листом.

#### <a name="in-the-sql-server-import-and-export-wizard"></a>В мастере импорта и экспорта SQL Server

На странице **Выбор назначения** нажмите кнопку **Обзор**. В диалоговом окне **Открыть** перейдите в папку, в которой требуется создать новый файл Excel, укажите имя этого файла и выберите **Открыть**.

### <a name="export-to-a-large-enough-range"></a>Экспорт в достаточно большой диапазон

При указании диапазона в качестве назначения появится сообщение об ошибке, если диапазон содержит меньше *столбцов*, чем в данных источника. Если же указываемый диапазон содержит меньше *строк*, чем данные источника, мастер продолжит записывать строки без ошибки и расширит определение диапазона для соответствия новому числу строк.

### <a name="export-long-text-values"></a>Экспорт длинных текстовых значений

Чтобы успешно сохранять в столбцы Excel строки, имеющие длину более 255 символов, драйвер должен распознать тип данных целевого столбца как **memo** , а не как **string**.

-   Если в существующей целевой таблице уже содержатся строки данных, то в столбце типа memo в первых нескольких строках, которые проверит драйвер, должен содержаться, по крайней мере, один экземпляр значения, имеющего длину более 255 символов.

-   Если новая целевая таблица создается во время проектирования пакета, во время выполнения или с помощью мастера импорта и экспорта, в инструкции `CREATE TABLE` необходимо использовать LONGTEXT (или один из его синонимов) в качестве типа данных для целевого столбца типа memo. В мастере проверьте инструкцию `CREATE TABLE` и при необходимости измените ее, нажав кнопку **Изменить SQL** рядом с параметром **Создать целевую таблицу** на странице **Сопоставления столбцов**.

## <a name="related-content"></a>См. также

Дополнительные сведения о компонентах и процедурах, описываемых в этой статье, см. в следующих статьях:

### <a name="about-ssis"></a>Сведения о службах SSIS
[Диспетчер подключений Excel](connection-manager/excel-connection-manager.md)  
[Источник Excel](data-flow/excel-source.md)  
[Назначение «Excel»](data-flow/excel-destination.md)  
[Просмотр файлов и таблиц Excel с помощью контейнера «цикл по каждому элементу»](control-flow/loop-through-excel-files-and-tables-by-using-a-foreach-loop-container.md)  
[Работа с файлами Excel в задаче «Скрипт»](extending-packages-scripting-task-examples/working-with-excel-files-with-the-script-task.md)

### <a name="about-the-sql-server-import-and-export-wizard"></a>Сведения о мастере импорта и экспорта SQL Server
[Подключение к источнику данных Excel](/sql/integration-services/import-export-data/connect-to-an-excel-data-source-sql-server-import-and-export-wizard)  
[Приступая к работе с простым примером мастера импорта и экспорта](/sql/integration-services/import-export-data/get-started-with-this-simple-example-of-the-import-and-export-wizard)

### <a name="other-articles"></a>Другие статьи
[Импорт данных в SQL Server или базу данных Azure из Excel](/sql/relational-databases/import-export/import-data-from-excel-to-sql)  

