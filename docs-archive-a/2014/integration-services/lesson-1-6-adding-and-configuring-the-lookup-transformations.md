---
title: Шаг 6. Добавление и настройка преобразований «Уточняющий запрос» | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
ms.assetid: 5c59f723-9707-4407-80ae-f05f483cf65f
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 96b0a848508c19eb24cf1538244a39fcec57361a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87664345"
---
# <a name="step-6-adding-and-configuring-the-lookup-transformations"></a>Шаг 6. Добавление и настройка преобразований «Уточняющий запрос»
  После того как источник неструктурированных файлов настроен для извлечения данных из файла источника, следует определить преобразования «Уточняющий запрос», необходимые для получения значений **CurrencyKey** и **DateKey**. Преобразование «Уточняющий запрос» выполняет поиск, соединяя данные указанного входного столбца со столбцом эталонного набора данных. Эталонным набором данных может быть таблица или представление, новая таблица или результат инструкции SQL. В этом учебнике преобразование «Уточняющий запрос» использует диспетчер соединений OLE DB, чтобы подключиться к базе данных, содержащей данные, служащие источником для эталонного набора данных.  
  
> [!NOTE]  
>  Можно также настроить преобразование «Уточняющий запрос» для подключения к кэшу, который содержит эталонный набор данных. Дополнительные сведения см. в разделе [Lookup Transformation](data-flow/transformations/lookup-transformation.md).  
  
 Этот учебник описывает добавление в пакет и настройку следующих двух компонентов преобразования «Уточняющий запрос».  
  
-   Первое преобразование предназначено для уточняющего запроса значений в столбце **CurrencyKey** таблицы измерения **DimCurrency** , сопоставленных со значениями столбца **CurrencyID** неструктурированного файла.  
  
-   Второе преобразование предназначено для уточняющего запроса значений в столбце **DateKey** таблицы измерения **DimDate** , сопоставленных со значениями столбца **CurrencyDate** неструктурированного файла.  
  
 В обоих случаях в преобразовании «Уточняющий запрос» будет использоваться созданный ранее диспетчер соединений OLE DB.  
  
### <a name="to-add-and-configure-the-lookup-currency-key-transformation"></a>Добавление и настройка преобразования «Уточняющий запрос ключа валюты»  
  
1.  В **области элементов служб SSIS**разверните **узел Общие**и перетащите элемент **Поиск** в область конструктора на вкладке **поток данных** . Разместите Поиск непосредственно под источником данных " **Извлечение образца валюты** ".  
  
2.  Щелкните источник неструктурированного файла **Извлечь данные валют образца** и перетащите зеленую стрелку на вновь добавленное преобразование **Уточняющий запрос** , соединив эти два компонента.  
  
3.  В области конструктора **Поток данных** щелкните элемент **Уточняющий запрос** в преобразовании **Уточняющий запрос** и измените имя на **Уточняющий запрос ключа валюты**.  
  
4.  Дважды щелкните преобразование **Поиск CurrencyKey** , чтобы открыть редактор преобразования "Уточняющий запрос".  
  
5.  На вкладке **Общие** задайте следующие параметры.  
  
    1.  Выберите **Полное кэширование**.  
  
    2.  В области **Тип соединения** выберите **Диспетчер соединений OLE DB**.  
  
6.  На вкладке **Соединение** задайте следующие параметры.  
  
    1.  Убедитесь, что в диалоговом окне **Диспетчер соединений OLE DB** отображается **localhost.AdventureWorksDW2012** .  
  
    2.  Выберите **Использовать результаты SQL-запроса**и введите или скопируйте следующую инструкцию SQL:  
  
        ```  
        select * from (select * from [dbo].[DimCurrency]) as refTable  
        where [refTable].[CurrencyAlternateKey] = 'ARS'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'AUD'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'BRL'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'CAD'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'CNY'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'DEM'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'EUR'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'FRF'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'GBP'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'JPY'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'MXN'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'SAR'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'USD'  
        OR  
        [refTable].[CurrencyAlternateKey] = 'VEB'  
        ```  
  
7.  На вкладке **Столбцы** задайте следующие параметры.  
  
    1.  На панели **Доступные входные столбцы** перетащите **CurrencyID** на панель **Доступные столбцы подстановки** и поместите его на элемент **CurrencyAlternateKey**.  
  
    2.  В списке **Доступные столбцы подстановки** установите флажок слева от столбца **CurrencyKey**.  
  
8.  Нажмите **ОК** , чтобы вернуться в область конструктора **Поток данных** .  
  
9. Щелкните правой кнопкой мыши преобразование "Уточняющий запрос ключа валюты" и выберите пункт **Свойства**.  
  
10. В окно свойств убедитесь, что `LocaleID` свойство имеет значение **английский (США)** , а свойство **DefaultCodePage** имеет значение **1252**.  
  
### <a name="to-add-and-configure-the--lookup-datekey-transformation"></a>Добавление и настройка преобразования «Уточняющий запрос ключа даты»  
  
1.  В окне **Область элементов служб SSIS**перетащите **Уточняющий запрос** в область конструктора **Поток данных** . Поместите «Уточняющий запрос» прямо под преобразование **Уточняющий запрос ключа валюты** .  
  
2.  Щелкните преобразование **Уточняющий запрос ключа валюты** и перетащите зеленую стрелку на вновь созданное преобразование **Уточняющий запрос** , соединив эти два компонента.  
  
3.  В диалоговом окне **Выбор входов и выходов** щелкните **Выход совпадающих строк преобразования «Уточняющий запрос»** в списке **Выходы** и нажмите кнопку **ОК**.  
  
4.  В области конструктора **Поток данных** щелкните элемент **Уточняющий запрос** в только что добавленном преобразовании **Уточняющий запрос** и измените имя на **Уточняющий запрос ключа даты**.  
  
5.  Дважды щелкните преобразование **Уточняющий запрос ключа даты** .  
  
6.  На вкладке **Общие** выберите **Частичное кэширование**.  
  
7.  На вкладке **Соединение** задайте следующие параметры.  
  
    1.  Убедитесь в том, что в диалоговом окне **Диспетчер соединений OLE DB** отображается **localhost.AdventureWorksDW2012** .  
  
    2.  В поле **Использовать таблицу или представление** введите или выберите значение **[dbo].[DimDate]**.  
  
8.  На вкладке **Столбцы** задайте следующие параметры.  
  
    1.  На панели **Доступные входные столбцы** перетяните **CurrencyDate** на панель **Доступные столбцы подстановки** и поместите его на элемент **FullDateAlternateKey**.  
  
    2.  В списке **Доступные столбцы подстановки** установите флажок слева от столбца **DateKey**.  
  
9. На странице **Дополнительно** просмотрите параметры кэширования.  
  
10. Нажмите **ОК** , чтобы вернуться в область конструктора **Поток данных** .  
  
11. Щелкните правой кнопкой мыши преобразование "Уточняющий запрос ключа даты" и выберите пункт **Свойства**.  
  
12. В окно свойств убедитесь, что `LocaleID` свойство имеет значение **английский (США)** , а свойство **DefaultCodePage** имеет значение **1252**.  
  
## <a name="next-task-in-lesson"></a>Следующая задача занятия  
 [Шаг 7. Добавление и настройка назначения OLE DB](lesson-1-7-adding-and-configuring-the-ole-db-destination.md)  
  
## <a name="see-also"></a>См. также:  
 [Преобразование "Уточняющий запрос"](data-flow/transformations/lookup-transformation.md)  
  
  
