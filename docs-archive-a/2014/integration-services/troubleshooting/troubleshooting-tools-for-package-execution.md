---
title: Инструменты устранения неполадок с выполнением пакетов | Документы Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- SQL Server Integration Services packages, troubleshooting
- SSIS packages, troubleshooting
- Integration Services, troubleshooting
- errors [Integration Services], troubleshooting
- packages [Integration Services], troubleshooting
ms.assetid: f18d6ff6-e881-444c-a399-730b52130e7c
author: chugugrace
ms.author: chugu
ms.openlocfilehash: cbb19cddd202ac58cbea5622b4965449c15ba325
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87656460"
---
# <a name="troubleshooting-tools-for-package-execution"></a>Устранение неполадок инструментов с помощью отчетов
  [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] включают функции и инструменты, которые можно использовать для устранения неполадок пакетов после их завершения и развертывания.  
  
 Во время разработки в среде [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)] можно использовать точки останова выполнения пакета, окно хода выполнения и средства просмотра данных для наблюдения за потоком данных. Однако эти возможности недоступны при выполнении уже развернутых пакетов. Основными методами устранения неполадок в развернутых пакетах являются следующие.  
  
-   Перехват и обработка ошибок пакетов с помощью обработчиков событий.  
  
-   Обнаружение недопустимых данных с помощью вывода ошибок.  
  
-   Отслеживание шагов выполнения пакетов, используя ведение журналов.  
  
 Для предотвращения проблем с выполняющимися пакетами можно также пользоваться следующими советами и методами.  
  
-   **Обеспечивайте целостность данных с помощью транзакций**. Дополнительные сведения см. в разделе [Транзакции служб Integration Services](../integration-services-transactions.md).  
  
-   **Перезапускайте пакеты с точки сбоя, используя контрольные точки**. Дополнительные сведения см. в разделе [Restart Packages by Using Checkpoints](../packages/restart-packages-by-using-checkpoints.md).  
  
## <a name="catch-and-handle-package-errors-by-using-event-handlers"></a>Перехват и обработка ошибок пакетов с помощью обработчиков событий  
 Обработчики событий могут реагировать на многие события, вызванные пакетами и объектами в них.  
  
-   **Создайте обработчик события для события OnError**. В обработчике событий с помощью задачи «Отправка почты» можно уведомить администратора о сбое, использовать задачу «Скрипт» и специальную логику для получения системных сведений, чтобы устранить неполадки или очистить временные ресурсы и неполные выходные данные. Дополнительные сведения см. в разделе [Обработчики событий в службах Integration Services (SSIS)](../integration-services-ssis-event-handlers.md).  
  
## <a name="troubleshoot-bad-data-by-using-error-outputs"></a>Устранение неполадок в данных путем вывода ошибок  
 Вывод ошибок, доступный во многих компонентах потока данных, можно использовать для направления строк, содержащих ошибки, в отдельное назначение для последующего анализа.  
  
-   **Обнаруживайте недопустимые данные с помощью вывода ошибок**. Отправляйте строки, содержащие ошибки, в отдельное назначение, например в таблицу ошибок или текстовый файл. Вывод ошибок автоматически добавляет два цифровых столбца, которые содержат номер ошибки, вызвавшей отбрасывание строки, и идентификатор столбца, в котором произошла ошибка. Дополнительные сведения см. в разделе [Обработка ошибок в данных](../data-flow/error-handling-in-data.md).  
  
-   **Добавляйте дополнительные сведения к выводу ошибок**. Можно облегчить анализ вывода ошибок, добавив описательные сведения в дополнение к двум цифровым идентификаторам, которые предоставляет вывод ошибок.  
  
     **Добавьте описание ошибки**. С помощью задачи «Скрипт» можно легко найти описание ошибки. Дополнительные сведения см. [в разделе Улучшение вывода ошибок для компонента скрипта](../extending-packages-scripting-data-flow-script-component-examples/enhancing-an-error-output-with-the-script-component.md).  
  
     **Добавьте имя столбца ошибок**. С помощью компонента скрипта трудно найти имя столбца, соответствующее идентификатору столбца, который сохраняется выводом ошибок. Это требует дополнительных действий. Каждый идентификатор столбца является уникальным для задачи потока данных, он сохраняется в пакете во время разработки. Для добавления имени столбца к выводу ошибок предлагается следующий подход. 
  
    1.  **Создайте таблицу уточняющих запросов по именам столбцов**. Создайте отдельное приложение, использующее API[!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], для перебора всех сохраненных пакетов, потоков данных в пакете, объектов в потоке данных, а также входа и выхода в объекте потока данных. Это приложение должно сохранять идентификатор столбца и имя каждого столбца в таблице уточняющих запросов вместе с идентификатором родительской задачи потока данных и идентификатором пакета;  
  
    2.  **Добавьте имя столбца в выходные данные**. Добавьте к выводу ошибок преобразование «Уточняющий запрос», выполняющее поиск имени столбца в таблице уточняющих запросов, которая была создана на предыдущем шаге. Поиск может использовать идентификатор столбца в выводе ошибок, идентификатор пакета (доступный в системной переменной System::PackageID) и идентификатор задачи потока данных (доступный в системной переменной System::TaskID).  
  
## <a name="troubleshoot-package-execution-by-using-operations-reports"></a>Устранение неполадок выполнения пакетов с помощью отчетов об операциях  
 Стандартные отчеты об операциях доступны в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] и помогают при наблюдении за пакетами служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , развернутых в каталоге служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] . Они позволяют просмотреть состояние пакета и журнал и, если необходимо, определить причину сбоев.  
  
 Дополнительные сведения см. в разделе [Устранение неполадок пакетов с помощью отчетов](troubleshooting-reports-for-package-execution.md).  
  
## <a name="troubleshoot-package-execution-by-using-ssisdb-views"></a>Устранение неполадок выполнения пакетов с помощью представлений SSISDB  
 Доступно несколько представлений базы данных SSISDB, к которым вы можете выполнить запрос с целью мониторинга выполнения пакетов и получения сведений для других операторов. Дополнительные сведения см. в разделе [мониторинг выполнения пакетов и других операций](../performance/monitor-running-packages-and-other-operations.md).  
  
## <a name="troubleshoot-package-execution-by-using-logging"></a>Устранение неполадок выполнения пакетов с помощью журналов  
 С помощью ведения журналов можно отследить многие события в выполняющихся пакетах. Регистраторы захватывают сведения о конкретных событиях с целью последующего анализа и сохраняют их в таблицу базы данных, неструктурированный файл, XML-файл или в любом другом поддерживаемом формате вывода данных.  
  
-   **Включите ведение журналов**. Выходные данные журналов можно детализировать, выбрав только события и только объекты, сведения о которых требуется захватить. Дополнительные сведения см. в разделах [Ведение журналов в службах Integration Services (SSIS)](../performance/integration-services-ssis-logging.md) и [Ведение журналов в службах Integration Services (SSIS)](../performance/integration-services-ssis-logging.md).  
  
-   **Для устранения неполадок, связанных с поставщиком, выберите событие пакета, называемое «Диагностика».** Существуют сообщения журнала, которые могут помочь при устранении неполадок взаимодействия пакета с внешним источником данных. Дополнительные сведения см. в статье [Troubleshooting Tools Package Connectivity](troubleshooting-tools-for-package-connectivity.md).  
  
-   **Дополните выходные данные журналов**. При обычном ведении журналов строки присоединяются к назначению при каждом выполнении пакета. Хотя каждая строка выходных данных журнала определяет пакет по имени и уникальному идентификатору, а также определяет выполнение пакета по уникальному идентификатору ExecutionID, большой объем выходных данных анализировать трудно.  
  
     В следующем подходе предлагается расширить выходные данные журнала и облегчить создание отчетов:  
  
    1.  **Создайте родительскую таблицу, в которой регистрируется каждое выполнение пакета**. В этой родительской таблице предусматривается одна строка для каждого выполнения пакета, а идентификатор ExecutionID используется для связи с дочерними записями в таблице журналов службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] . Для создания новой строки и регистрации времени начала можно использовать задачу «Выполнение SQL». Затем при завершении пакета можно обновить строку временем окончания, продолжительностью и состоянием;  
  
    2.  **Добавьте к потоку данных данные аудита**. Преобразование «Аудит» можно использовать для добавления к строкам в потоке данных сведений о выполнении пакета, который создал или изменил каждую строку. Преобразование «Аудит» предоставляет девять разделов сведений, в том числе PackageName и ExecutionInstanceGUID. Дополнительные сведения см. в разделе [Audit Transformation](../data-flow/transformations/audit-transformation.md). Если в каждую строку в целях аудита требуется включить пользовательские данные, их можно добавить в поток данных с помощью преобразования "Производный столбец". Дополнительные сведения см. в разделе [Derived Column Transformation](../data-flow/transformations/derived-column-transformation.md).  
  
    3.  **Рассмотрите возможность захвата данных счетчика строк**. Создайте отдельную таблицу для данных счетчика строк, в которой каждый экземпляр выполнения пакета определяется идентификатором ExecutionID. Используйте преобразование «Счетчик строк» для сохранения числа строк в последовательность переменных в критических точках потока данных. После окончания потока данных используйте задачу «Выполнение SQL» для вставки этой последовательности значений в строку таблицы для последующего анализа и отчета.  
  
     Дополнительные сведения об этом подходе см. в статье "ETL Auditing and Logging" (ETL: аудит и ведение журналов), входящей в технический документ [!INCLUDE[msCoName](../../includes/msconame-md.md)][Project REAL: Business Intelligence ETL Design Practices](https://www.microsoft.com/download/details.aspx?id=14582) (Project REAL. Рекомендации по разработке ETL-решения для бизнес-аналитики).  
  
## <a name="troubleshoot-package-execution-by-using-debug-dump-files"></a>Устранение неполадок выполнения пакетов с помощью отладочных файлов дампа  
 Службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]позволяют создавать отладочные файлы дампа с информацией о выполнении пакета. Дополнительные сведения см. в статье [Generating Dump Files for Package Execution](generating-dump-files-for-package-execution.md).  
  
## <a name="troubleshoot-run-time-validation-issues"></a>Устранение неполадок проверки во время выполнения  
 Иногда невозможно подключиться к источникам данных или проверить компоненты пакета, пока не будут выполнены предыдущие задачи пакета. [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] предусмотрены следующие возможности для предотвращения ошибок проверки, которые в противном случае возникли бы в этих условиях.  
  
-   **Настройте свойство DelayValidation элементов пакета, недопустимых при загрузке пакета**. Свойству `DelayValidation` элемента пакета с недопустимой настройкой можно присвоить значение `True`, чтобы избежать ошибок проверки во время загрузки пакета. Например, может существовать задача потока данных, использующая целевую таблицу, которая не существует до тех пор, пока задача «Выполнение SQL» не создаст таблицу во время выполнения. Свойство `DelayValidation` можно включить на уровне пакета или на уровне отдельных задач или контейнеров, содержащихся в пакете.  
  
     Свойство `DelayValidation` устанавливается в задаче потока данных, но не в отдельных компонентах потока данных. Тех же результатов можно добиться, присвоив свойству <xref:Microsoft.SqlServer.Dts.Pipeline.Wrapper.IDTSComponentMetaData100.ValidateExternalMetadata%2A> отдельного компонента потока данных значение `false`. Однако если значение этого свойства равно `false`, компонент не узнает об изменениях метаданных внешних источников данных. Если свойству <xref:Microsoft.SqlServer.Dts.Pipeline.Wrapper.IDTSComponentMetaData100.ValidateExternalMetadata%2A> присвоено значение `true`, это может помочь избежать критических препятствий, возникающих из-за блокировки базы данных, особенно при использовании пакетом транзакций.  
  
## <a name="troubleshoot-run-time-permissions-issues"></a>Устранение проблем с разрешениями во время выполнения  
 Если возникают ошибки при попытке выполнения развернутых пакетов с использованием агента служб [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , их причина может заключаться в отсутствии нужных разрешений у учетных записей агента. Сведения о решении проблем с пакетами, запускаемыми из агента заданий [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , см. в статье [Пакет служб SSIS не выполняется при вызове пакета из шага задания агента SQL Server](https://support.microsoft.com/kb/918760). Дополнительные сведения о запуске пакетов из заданий агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] см. в разделе [Пакеты служб из заданий агента SQL Server](../packages/sql-server-agent-jobs-for-packages.md).  
  
 Чтобы подключиться к источникам данных Excel или Access, агенту [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] требуется учетная запись с разрешениями на чтение, запись, создание и удаление временных файлов в папке, заданной переменными среды TEMP и TMP.  
  
## <a name="troubleshoot-64-bit-issues"></a>Устранение неполадок для 64-разрядных платформ  
  
-   **Некоторые поставщики данных недоступны на 64-разрядных платформах**. Особенно часто в 64-разрядной версии недоступен поставщик OLE DB [!INCLUDE[msCoName](../../includes/msconame-md.md)] Jet, который требуется для подключения к источникам данных Excel и Access.  
  
## <a name="troubleshoot-errors-without-a-description"></a>Устранение неполадок, когда ошибка выдается без описания  
 Если ошибка служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] выдается без описания, это описание можно найти в [Справочнике по сообщениям об ошибках служб Integration Services](../integration-services-error-and-message-reference.md) , выполнив поиск по номеру ошибки. Этот список сейчас не включает сведения об устранении неполадок.  
  
## <a name="related-tasks"></a>Связанные задачи  
 [Настройка вывода ошибок в компоненте потока данных](../configure-an-error-output-in-a-data-flow-component.md)  
  
  
