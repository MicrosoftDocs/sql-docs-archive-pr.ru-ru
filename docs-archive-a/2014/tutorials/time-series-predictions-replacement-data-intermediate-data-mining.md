---
title: Прогнозирование временных рядов с использованием данных для замены (учебник по интеллектуальному анализу данных — средний уровень) | Документация Майкрософт
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: a23a6e1d-1d49-41ea-8314-925dc8e4df5e
author: minewiskan
ms.author: owend
manager: kfile
ms.openlocfilehash: c96b70775105ea9446810ac3b064ae7cb07d4337
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87654640"
---
# <a name="time-series-predictions-using-replacement-data-intermediate-data-mining-tutorial"></a>Прогнозы временных рядов с заменой данных (учебник по интеллектуальному анализу данных — средний уровень)
  В этой задаче вы создадите новую модель на основе данных о продажах во всем мире. Затем вы создадите прогнозирующий запрос, в котором модель мировых продаж будет применена к одному из регионов  
  
## <a name="building-a-general-model"></a>Создание общей модели  
 Помните, что анализ результатов начальной модели интеллектуального анализа данных показал большие различия между регионами и линейками продуктов. Например, продажи модели M200 в Северной Америке были высоки, а продажи модели T1000 были не так успешны. Однако анализ усложняется тем фактом, что некоторые ряды не содержат много данных, или данные, запущенные в другой момент времени. Кроме того, некоторые данные отсутствовали.  
  
 ![Прогнозируемые серии количества M200 и T1000](../../2014/tutorials/media/6series-defaultforecasting.gif "Прогнозируемые серии количества M200 и T1000")  
  
 Для устранения некоторых проблем с качеством данных принимается решение слить воедино данные о продажах по всему миру и использовать этот набор общих трендов продаж для создания общей модели, которая позволит прогнозировать продажи в любом регионе.  
  
 Для прогнозирования вы будете использовать закономерность, полученную во время обучения модели с данными мировых продаж, но заменять исторические точки данных данными о продажах для каждого отдельного региона. Таким образом, форма тренда сохраняется, но спрогнозированные значения будут соответствовать историческим показателям продаж для каждого региона и модели.  
  
## <a name="performing-cross-prediction-with-a-time-series-model"></a>Перекрестное прогнозирование с помощью модели временных рядов  
 Процесс использования данных одного ряда для прогнозирования трендов в другом ряду называется перекрестным прогнозированием. Перекрестное прогнозирование можно использовать во многих сценариях. Например, вы можете принять решение о том, что телевизионные продажи являются хорошим прогнозом общих экономических операций и применяют модель, обученную телевизионными продажами, в общие экономические данные.  
  
 В SQL Server интеллектуального анализа данных выполняется перекрестное прогнозирование с помощью параметра REPLACE_MODEL_CASES в аргументах функции, [PredictTimeSeries &#40;DMX&#41;](/sql/dmx/predicttimeseries-dmx).  
  
 В следующей задаче вы узнаете, как использовать параметр REPLACE_MODEL_CASES. Вы используете объединенные данные о мировых продажах для создания модели, а затем создадите прогнозирующий запрос, сопоставляющий общую модель с данными для замены.  
  
 Предполагается, что вы уже знаете, как создавать модели интеллектуального анализа данных, поэтому инструкции по созданию модели упрощены.  
  
#### <a name="to-build-a-mining-structure-and-mining-model-using-the-aggregated-data"></a>Построение структуры и модели интеллектуального анализа данных с использованием агрегатных данных  
  
1.  В **Обозреватель решений**щелкните правой кнопкой мыши элемент **структуры интеллектуального**анализа данных, а затем выберите пункт **создать структуру интеллектуального анализа** данных, чтобы запустить мастер интеллектуального анализа.  
  
2.  В окне мастера интеллектуального анализа данных выберите указанные ниже элементы.  
  
    -   Алгоритм: временные ряды (Майкрософт)  
  
    -   В качестве источника данных для модели используйте источник данных, который уже создали ранее на этом уроке. См. [руководство по созданию прогнозов временных рядов &#40;руководстве по интеллектуальному анализу данных&#41;](../../2014/tutorials/advanced-time-series-predictions-intermediate-data-mining-tutorial.md).  
  
         Представление источника данных:`AllRegions`  
  
    -   Выберите следующие столбцы для ключа ряда и временного ключа:  
  
         Ключевое время: ReportingDate  
  
         Ключ: регион  
  
    -   Выберите следующие столбцы для `Input` и `Predict`:  
  
         сумкти  
  
         сумамт  
  
         авгамт  
  
         AvgQty  
  
    -   В качестве **имени структуры интеллектуального анализа данных**введите:`All Regions`  
  
    -   В качестве **имени модели интеллектуального анализа данных**введите:`All Regions`  
  
3.  Обработайте новую структуру и новую модель.  
  
#### <a name="to-build-the-prediction-query-and-map-the-replacement-data"></a>Создание прогнозирующего запроса и сопоставление данных для замены с моделью  
  
1.  Если модель еще не открыта, дважды щелкните структуру AllRegions, а затем в конструкторе интеллектуального анализа данных перейдите на вкладку **Прогноз модели интеллектуального анализа** .  
  
2.  На панели **модель интеллектуального анализа данных** должна быть уже выбрана модель AllRegions. Если он не выбран, щелкните **выбрать модель**, а затем выберите модель AllRegions.  
  
3.  На панели **Выбор входных таблиц** нажмите кнопку **выбрать таблицу вариантов**.  
  
4.  В диалоговом окне **Выбор таблицы** измените значение в поле источник данных на T1000 Тихоокеанский регион и нажмите кнопку **ОК**.  
  
5.  Щелкните правой кнопкой мыши линию соединения между моделью интеллектуального анализа данных и входными данными и выберите пункт **Изменить соединения**. Сопоставьте данные в представлении источника данных с моделью следующим образом.  
  
    1.  Убедитесь, что столбец ReportingDate в модели интеллектуального анализа данных сопоставлен со столбцом ReportingDate во входных данных.  
  
    2.  В диалоговом окне **Изменение сопоставления** в строке столбца модели AvgQty щелкните под **столбцом таблица** , а затем выберите T1000 тихоокеанское. Quantity. Нажмите кнопку **ОК**.  
  
         На этом шаге сопоставляется столбец, созданный в модели для прогнозирования среднего количества, с фактическими данными о количестве продаж продукта T1000.  
  
    3.  Не сопоставлять область столбцов в модели ни с одним входным столбцом.  
  
         Поскольку в модели объединены данные по всем рядам, для значений рядов, таких как T1000 Pacific, совпадений нет и при выполнении прогнозирующего запроса возникает ошибка.  
  
6.  Теперь вы создадите прогнозирующий запрос.  
  
     Сначала добавьте к результатам столбец, который выдает с прогнозами метку AllRegions из модели. Таким образом, вы знаете, что результаты были основаны на общей модели.  
  
    1.  В сетке щелкните первую пустую строку в разделе **источник**, а затем выберите модель интеллектуального анализа данных AllRegions.  
  
    2.  Для **поля**выберите регион.  
  
    3.  В качестве **псевдонима** **используется тип модель**.  
  
7.  Теперь добавьте к результатам другую метку, чтобы видеть, к какому ряду относится прогноз.  
  
    1.  Щелкните пустую строку и в разделе **источник**выберите **пользовательское выражение**.  
  
    2.  В столбце **псевдоним** введите **ModelRegion**.  
  
    3.  В столбце **критерий или аргумент** введите `'T1000 Pacific'` .  
  
8.  Теперь вы создадите функцию перекрестного прогнозирования.  
  
    1.  Щелкните пустую строку и в разделе **источник**выберите **функция прогнозирования**.  
  
    2.  В столбце **поле** выберите **PredictTimeSeries**.  
  
    3.  В качестве **псевдонима**введите **прогнозируемые значения**.  
  
    4.  Перетащите поле AvgQty с панели **модель интеллектуального анализа данных** в столбец **критерий или аргумент** с помощью операции перетаскивания.  
  
    5.  В столбце **критерий или аргумент** после имени поля введите следующий текст:`,5, REPLACE_MODEL_CASES`  
  
         Полный текст текстового поля **критерий или аргумента** должен выглядеть следующим образом:`[AllRegions].[AvgQty],5,REPLACE_MODEL_CASES`  
  
9. Щелкните **результаты**.  
  
## <a name="creating-the-cross-prediction-query-in-dmx"></a>Создание запроса перекрестного прогнозирования в DMX  
 Возможно, вы заметили проблему перекрестного прогнозирования: а именно, что для применения общей модели к другому ряду данных, например модели продукта T1000 в Северная Америка регионе, необходимо создать отдельный запрос для каждого ряда, чтобы можно было сопоставлять каждый набор входных данных модели.  
  
 Но можно не создавать запрос в конструкторе, а перейти в представление DMX и отредактировать созданную инструкцию DMX. Например, следующая инструкция DMX представляет только что созданный запрос:  
  
```  
SELECT  
      ([All Regions].[Region]) as [Model Used],  
      ('T-1000 Pacific') as [ModelRegion],  
      (PredictTimeSeries([All Regions].[Avg Qty],5, REPLACE_MODEL_CASES)) as [Predicted Quantity]  
     FROM [All Regions]  
PREDICTION JOIN  
    OPENQUERY([Adventure Works DW2003R2], 'SELECT [ReportingDate] FROM  
      (  
       SELECT  ReportingDate, ModelRegion, Quantity, Amount   
       FROM dbo.vTimeSeries   
       WHERE (ModelRegion = N''T1000 Pacific'')  
       ) as [T1000 Pacific]    ')   
    AS t  
ON   
[All Regions].[Reporting Date] = t.[ReportingDate]   
AND   
[All Regions].[Avg Qty] = t.[Quantity]  
```  
  
 Чтобы применить ее к другой модели, достаточно изменить инструкцию запроса, заменив условие фильтра, и обновить метки для каждого результата.  
  
 Например, в случае изменения условий фильтра и меток столбцов путем замены «Pacific» на «North America» будут получены прогнозы для продукта T1000 в Северной Америке на основании шаблонов в общей модели.  
  
## <a name="next-task-in-lesson"></a>Следующая задача занятия  
 [Сравнение прогнозов для моделей прогнозирования &#40;руководстве по интеллектуальному анализу данных&#41;](../../2014/tutorials/comparing-predictions-for-forecasting-models-intermediate-data-mining-tutorial.md)  
  
## <a name="see-also"></a>См. также:  
 [Примеры запросов модели временных рядов](../../2014/analysis-services/data-mining/time-series-model-query-examples.md)   
 [PredictTimeSeries (расширения интеллектуального анализа данных)](/sql/dmx/predicttimeseries-dmx)  
  
  
