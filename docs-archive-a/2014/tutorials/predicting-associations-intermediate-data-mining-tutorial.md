---
title: Прогнозирование взаимосвязей (учебник по интеллектуальному анализу данных — средний уровень) | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 9140c5f2-b340-45a6-9c27-d870d15aafea
author: minewiskan
ms.author: owend
manager: kfile
ms.openlocfilehash: bee5ca4ded1b2fd5cbda0712cb766c825b9d0318
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87654670"
---
# <a name="predicting-associations-intermediate-data-mining-tutorial"></a>Прогноз взаимосвязей (учебник по интеллектуальному анализу данных — средний уровень)
  После обработки моделей для создания прогнозов можно использовать сведения о взаимосвязях, хранящиеся в модели. В последней задаче этого занятия предстоит изучить, как создавать прогнозирующие запросы к созданным моделям взаимосвязей. В этом занятии предполагается, что вы знакомы с работой построителя прогнозирующих запросов и хотите научиться создавать прогнозирующие запросы к моделям взаимосвязей. Дополнительные сведения об использовании конструктор запросов прогнозирования см. в разделе [интерфейсы запросов интеллектуального анализа данных](../../2014/analysis-services/data-mining/data-mining-query-tools.md).  
  
## <a name="creating-a-singleton-prediction-query"></a>Создание одноэлементных прогнозирующих запросов  
 Прогнозирующие запросы для модели взаимосвязей могут быть весьма полезными:  
  
-   Рекомендуйте клиентам элементы на основе предыдущих или связанных покупок  
  
-   Найдите связанные события.  
  
-   Определите отношения в наборах транзакций или через них.  
  
 Чтобы создать прогнозирующий запрос, сначала необходимо выбрать модель взаимосвязей, которая будет использоваться, а затем указать входные данные. Входные данные могут поступать из внешнего источника данных, например из списка значений, или можно создать одноэлементный запрос и предоставить значения по ходу выполнения операции.  
  
 В этом сценарии сначала будет создано несколько одноэлементных прогнозирующих запросов, чтобы получить представление о том, как работает прогнозирование. Затем будет создан запрос для пакетных прогнозов, которые можно использовать для предоставления рекомендаций на основании текущих покупок клиента.  
  
#### <a name="to-create-a-prediction-query-on-an-association-model"></a>Создание прогнозирующего запроса для модели взаимосвязей  
  
1.  Перейдите на вкладку **Прогноз модели интеллектуального анализа** данных конструктора интеллектуального анализа.  
  
2.  На панели **модель интеллектуального анализа данных** щелкните **выбрать модель**. (Если нужная модель уже выбрана, этот и следующий шаги можно пропустить.)  
  
3.  В диалоговом окне **Выбор модели интеллектуального анализа данных** разверните узел, представляющий **ассоциацию**структуры интеллектуального анализа данных, и выберите **связь**модели. Нажмите кнопку **ОК**.  
  
     На данном этапе можно не учитывать входную панель.  
  
4.  В сетке щелкните пустую ячейку в разделе **источник** и выберите **функция прогнозирования.** В **поле**в ячейке выберите `PredictAssociation` .  
  
     Для прогнозирования взаимосвязей можно также использовать функцию **Predict** . В этом случае следует выбрать версию функции **Predict** , которая принимает столбец таблицы в качестве аргумента.  
  
5.  На панели **модель интеллектуального анализа данных** выберите вложенную таблицу `vAssocSeqLineItems` и перетащите ее в сетку в поле **критерий или аргумент** для `PredictAssociation` функции.  
  
     Путем перетаскивания имен таблиц и столбцов можно создавать сложные инструкции без синтаксических ошибок. Однако он заменяет текущее содержимое ячейки, которое содержит другие необязательные аргументы `PredictAssociation` функции. Чтобы просмотреть другие аргументы, можно на время добавить в сетку второй экземпляр функции и использовать его для справки.  
  
6.  Щелкните поле **критерий или аргумент** и введите следующий текст после имени таблицы:`,3`  
  
     Полный текст в поле **критерий или аргумент** должен выглядеть следующим образом:  
  
     `[Association].[v Assoc Seq Line Items],3`  
  
7.  Нажмите кнопку **результаты** в верхнем углу конструктор запросов прогнозирования.  
  
 Ожидаемые результаты содержат один столбец с **выражением**заголовка. Столбец **выражение** содержит вложенную таблицу с одним столбцом и следующими тремя строками. Поскольку входное значение не было указано, эти прогнозы представляют наиболее вероятные взаимосвязи продуктов для модели в целом.  
  
|Модель|  
|-----------|  
|Женские шорты Mountain|  
|Фляга для воды|  
|Touring-3000|  
  
 Далее вы будете использовать панель **ввода одноэлементного запроса** для указания продукта в качестве входных данных для запроса и просмотра продуктов, которые, скорее всего, связаны с этим элементом.  
  
#### <a name="to-create-a-singleton-prediction-query-with-nested-table-inputs"></a>Создание одноэлементного прогнозирующего запроса с входными данными вложенной таблицы  
  
1.  Нажмите кнопку **конструктор** в углу конструктор запросов прогнозирования, чтобы вернуться к сетке создания запросов.  
  
2.  В меню **модель интеллектуального анализа данных** выберите пункт **одноэлементный запрос**.  
  
3.  В диалоговом окне **модель интеллектуального анализа данных** выберите модель **взаимосвязей** .  
  
4.  В сетке щелкните пустую ячейку в разделе **источник** и выберите **функция прогнозирования.** В **поле**в ячейке выберите `PredictAssociation` .  
  
5.  На панели **модель интеллектуального анализа данных** выберите вложенную таблицу `vAssocSeqLineItems` и перетащите ее в сетку в поле **критерий или аргумент** для `PredictAssociation` функции. Введите `,3` после имени вложенной таблицы точно так же, как в предыдущей процедуре.  
  
6.  В диалоговом окне **Ввод одноэлементного запроса** щелкните поле **значение** рядом с пунктом **вассок Seq Line Items**, а затем нажмите кнопку **(...)** .  
  
7.  В диалоговом окне **входные данные вложенной таблицы** выберите `Touring Tire` на панели **ключевой столбец** и нажмите кнопку **Добавить**.  
  
8.  Нажмите кнопку **результаты** .  
  
 Теперь в результатах отображаются прогнозы для продуктов, которые с наибольшей вероятностью связаны с шинами для туристических велосипедов.  
  
|Модель|  
|-----------|  
|Камера для покрышки туристического велосипеда|  
|Sport-100|  
|Фляга для воды|  
  
 В результате изучения модели уже становится известно, что камера шины для велосипеда часто приобретается вместе с шиной. Теперь вас больше интересует то, какие продукты можно порекомендовать клиентам, купившим оба этих элемента. Запрос необходимо изменить таким образом, чтобы спрогнозировать связанные продукты на основании двух элементов в корзине. Также в запрос нужно добавить степень вероятности для каждого прогнозируемого продукта.  
  
#### <a name="to-add-inputs-and-probabilities-to-the-singleton-prediction-query"></a>Добавление входных данных и вероятностей в одноэлементный прогнозирующий запрос  
  
1.  Нажмите кнопку **конструктор** в углу конструктор запросов прогнозирования, чтобы вернуться к сетке создания запросов.  
  
2.  В диалоговом окне **Ввод одноэлементного запроса** щелкните поле **значение** рядом с пунктом **вассок Seq Line Items**, а затем нажмите кнопку **(...)** .  
  
3.  На панели **ключевой столбец** выберите `Touring Tire` и нажмите кнопку **добавить**.  
  
4.  В сетке щелкните пустую ячейку в разделе **источник** и выберите **функция прогнозирования.** В **поле**в ячейке выберите `PredictAssociation` .  
  
5.  На панели **модель интеллектуального анализа данных** выберите вложенную таблицу `vAssocSeqLineItems` и перетащите ее в сетку в поле **критерий или аргумент** для `PredictAssociation` функции. Введите `,3` после имени вложенной таблицы точно так же, как в предыдущей процедуре.  
  
6.  В диалоговом окне **входные данные вложенной таблицы** выберите `Touring Tire Tube` на панели **ключевой столбец** и нажмите кнопку **Добавить**.  
  
7.  В сетке в строке `PredictAssociation` функции щелкните поле **критерий или аргумент** и измените аргументы, чтобы добавить аргумент, INCLUDE_STATISTICS.  
  
     Полный текст в поле **критерий или аргумент** должен выглядеть следующим образом:  
  
     `[Association].[v Assoc Seq Line Items], INCLUDE_STATISTICS, 3`  
  
8.  Нажмите кнопку **результаты** .  
  
 Результаты во вложенной таблице меняются, отображая прогнозы вместе с поддержкой и вероятностью. Дополнительные сведения об интерпретации этих значений см. в разделе [содержимое моделей интеллектуального анализа данных для моделей взаимосвязей &#40;Analysis Services-&#41;интеллектуального анализа ](../../2014/analysis-services/data-mining/mining-model-content-for-association-models-analysis-services-data-mining.md).  
  
|Модель|$SUPPORT|$PROBABILITY|$ADJUSTEDPROBABILITY|  
|-----------|--------------|------------------|--------------------------|  
|Sport-100|4334|0,291...|0,252...|  
|Фляга для воды|2866|0,192...|0,175...|  
|Ремонтный комплект|2113|0,142...|0,132|  
  
## <a name="working-with-results"></a>Работа с результатами  
 Если результаты содержат много вложенных таблиц, такие результаты можно преобразовать в плоский формат для более удобного просмотра. С этой целью можно вручную изменить запрос и добавить ключевое слово `FLATTENED`.  
  
#### <a name="to-flatten-nested-rowsets-in-a-prediction-query"></a>Преобразование вложенных наборов строк в плоский формат в прогнозирующем запросе  
  
1.  Нажмите кнопку **SQL** в углу конструктор запросов прогнозирования.  
  
     Сетка будет преобразована в открытую панель, в которой можно просмотреть и изменить инструкцию DMX, созданную построителем прогнозирующих запросов.  
  
2.  После ключевого слова `SELECT` введите `FLATTENED`.  
  
     Полный текст запроса должен иметь следующий вид:  
  
    ```  
    SELECT FLATTENED  
      PredictAssociation([Association].[v Assoc Seq Line Items],INCLUDE_STATISTICS,3)  
    FROM  
      [Association]  
    NATURAL PREDICTION JOIN  
    (SELECT (SELECT 'Touring Tire' AS [Model]  
      UNION SELECT 'Touring Tire Tube' AS [Model]) AS [v Assoc Seq Line Items]) AS t  
    ```  
  
3.  Нажмите кнопку **результаты** в верхнем углу конструктор запросов прогнозирования.  
  
 Следует отметить, что после редактирования запроса вручную нельзя вернуться в конструктор, не потеряв изменения. Чтобы сохранить запрос, созданную инструкцию DMX можно вручную скопировать в текстовый файл. При возврате в конструктор в нем восстанавливается последняя версия запроса, имевшаяся до выхода из него.  
  
## <a name="creating-multiple-predictions"></a>Создание нескольких прогнозов  
 Предположим, необходимо получить наилучшие прогнозы для отдельных клиентов на основании их прошлых покупок. Можно использовать внешние данные в качестве входных данных для прогнозирующего запроса, например таблицы, содержащие идентификаторы клиентов и их последние покупки товаров. При этом требуется, чтобы таблицы данных уже были определены как представление источника данных служб Analysis Services. Кроме того, входные данные должны содержать таблицы вариантов и вложенные таблицы наподобие тех, которые используются в модели. Им не обязательно иметь одинаковые имена, но структура должна быть сходной. В целях этого учебника будут использоваться исходные таблицы, которые применялись для обучения модели.  
  
#### <a name="to-change-the-input-method-for-the-prediction-query"></a>Изменение метода ввода для прогнозирующего запроса  
  
1.  В меню **модель интеллектуального анализа данных** выберите **одноэлементный запрос** еще раз, чтобы снять флажок.  
  
2.  Появится сообщение об ошибке, предупреждая о том, что одноэлементный запрос будет утерян. Нажмите кнопку **Да**.  
  
     Имя диалогового окна ввода меняется на **Выбор входных таблиц**.  
  
 Поскольку необходимо создать прогнозирующий запрос, предоставляющий идентификатор клиента и список продуктов в качестве входных данных, потребуется добавить таблицу клиентов в качестве таблицы вариантов и таблицу покупок в качестве вложенной таблицы. Затем нужно добавить прогнозирующие функции для создания рекомендаций.  
  
#### <a name="to-create-a-prediction-query-using-nested-table-inputs"></a>Создание прогнозирующего запроса с использованием входных данных вложенной таблицы  
  
1.  На панели «Модель интеллектуального анализа данных» выберите «Фильтруемые взаимосвязи».  
  
2.  В диалоговом окне **Выбор входных таблиц** нажмите кнопку **выбрать таблицу вариантов**.  
  
3.  В диалоговом окне **Выбор таблицы** для поля **источник данных**выберите AdventureWorksDW2008. В списке **имя таблицы или представления** выберите vAssocSeqOrders и нажмите кнопку **ОК**.  
  
     Таблица vAssocSeqOrders добавляется на панель.  
  
4.  В диалоговом окне **Выбор входных таблиц** нажмите кнопку **выбрать вложенную таблицу**.  
  
5.  В диалоговом окне **Выбор таблицы** для поля **источник данных**выберите AdventureWorksDW2008. В списке **имя таблицы или представления** выберите vAssocSeqLineItems и нажмите кнопку **ОК**.  
  
     Таблица vAssocSeqLineItems добавляется на панель.  
  
6.  В диалоговом окне **Указание вложенного объединения** перетащите поле OrderNumber из таблицы вариантов и поместите его в поле OrderNumber во вложенной таблице.  
  
     Можно также щелкнуть **Добавить связь** и создать связь, выбрав столбцы из списка.  
  
7.  В диалоговом окне **Определение связи** убедитесь, что поля OrderNumber сопоставлены правильно, а затем нажмите кнопку **ОК**.  
  
8.  Нажмите кнопку **ОК** , чтобы закрыть диалоговое окно **Указание вложенного объединения** .  
  
     Таблица вариантов и вложенная таблица обновляются на панели конструирования для отображения соединений между столбцами внешних данных и столбцами модели. Если связи неверны, можно щелкнуть правой кнопкой мыши линию соединения и выбрать пункт **Изменить соединения** , чтобы изменить сопоставление столбцов, или щелкнуть правой кнопкой мыши строку соединения и выбрать команду **Удалить** , чтобы полностью удалить связь.  
  
9. Добавьте в сетку новую строку. В качестве **источника**выберите **vAssocSeqOrders таблица**. Для **поля поле**выберите CustomerKey.  
  
10. Добавьте в сетку новую строку. В качестве **источника**выберите **vAssocSeqOrders таблица**. Для **поля**выберите регион.  
  
11. Добавьте в сетку новую строку. В поле **источник**выберите **функция прогнозирование**, а для **поля**выберите `PredictAssociation` .  
  
12. Перетащите vAssocSeqLineItems в поле **критерий или аргумент** `PredictAssociation` строки. Щелкните в конце поля **критерий или аргумент** и введите следующий текст:`INCLUDE_STATISTICS,3`  
  
     Полный текст в поле **критерий или аргумент** должен быть следующим:`[Association].[v Assoc Seq Line Items], INCLUDE_STATISTICS, 3`  
  
13. Нажмите кнопку **результат** , чтобы просмотреть прогнозы для каждого клиента.  
  
 Можно попытаться создать подобный прогнозирующий запрос для нескольких моделей и узнать, изменятся ли результаты прогнозов после фильтрации. Дополнительные сведения о создании прогнозов и других типов запросов см. в разделе [примеры запросов модели взаимосвязей](../../2014/analysis-services/data-mining/association-model-query-examples.md).  
  
## <a name="see-also"></a>См. также:  
 [Содержимое моделей интеллектуального анализа данных для моделей взаимосвязей &#40;Analysis Services — интеллектуальный анализ&#41;](../../2014/analysis-services/data-mining/mining-model-content-for-association-models-analysis-services-data-mining.md)   
 [PredictAssociation &#40;расширений интеллектуального анализа данных&#41;](/sql/dmx/predictassociation-dmx)   
 [Создание прогнозирующего запроса с помощью построителя прогнозирующих запросов](../../2014/analysis-services/data-mining/create-a-prediction-query-using-the-prediction-query-builder.md)  
  
  
