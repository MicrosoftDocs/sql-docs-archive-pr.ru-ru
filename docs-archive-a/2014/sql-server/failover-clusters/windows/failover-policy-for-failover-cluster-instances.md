---
title: Политика отработки отказа для экземпляров отказоустойчивого кластера | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- flexible failover policy
ms.assetid: 39ceaac5-42fa-4b5d-bfb6-54403d7f0dc9
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8d441e5627280cb46168d9ff187d7f43da8b26a6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87659278"
---
# <a name="failover-policy-for-failover-cluster-instances"></a><span data-ttu-id="b2ae4-102">Политика отработки отказа для экземпляров отказоустойчивого кластера</span><span class="sxs-lookup"><span data-stu-id="b2ae4-102">Failover Policy for Failover Cluster Instances</span></span>
  <span data-ttu-id="b2ae4-103">В экземпляре отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (FCI) в каждый момент времени только один узел может быть владельцем группы ресурсов кластера WSFC.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-103">In a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI), only one node can own the Windows Server Failover Cluster (WSFC) cluster resource group at a given time.</span></span> <span data-ttu-id="b2ae4-104">Клиентские запросы в FCI обслуживаются через этот узел.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-104">The client requests are served through this node in the FCI.</span></span> <span data-ttu-id="b2ae4-105">В случае сбоя и неуспешного перезапуска владельцем группы становится другой узел WSFC в экземпляре FCI.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-105">In the case of a failure and an unsuccessful restart, the group ownership is moved to another WSFC node in the FCI.</span></span> <span data-ttu-id="b2ae4-106">Этот процесс называется отработкой отказа.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-106">This process is called failover.</span></span> [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] <span data-ttu-id="b2ae4-107">повышает надежность обнаружения сбоев и обеспечивает гибкую политику отработки отказов.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-107">increases the reliability of failure detection and provides a flexible failover policy.</span></span>  
  
 <span data-ttu-id="b2ae4-108">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI зависит от возможностей базовой службы WSFC по обнаружению сбоев.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-108">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI depends on the underlying WSFC service for failover detection.</span></span> <span data-ttu-id="b2ae4-109">Поэтому порядок отработки отказа для FCI определяется двумя механизмами: собственными функциями WSFC и функциями, добавленными в процессе установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b2ae4-109">Therefore, two mechanisms determine the failover behavior for FCI: the former is native WSFC functionality, and the latter is functionality added by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] setup.</span></span>  
  
-   <span data-ttu-id="b2ae4-110">Кластер WSFC поддерживает конфигурацию кворума, что гарантирует наличие уникального назначения отработки отказа при автоматическом переходе на другой ресурс.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-110">The WSFC cluster maintains the quorum configuration, which ensures a unique failover target in an automatic failover.</span></span> <span data-ttu-id="b2ae4-111">Служба WSFC определяет, всегда ли кластер имеет оптимальную работоспособность кворума, и соответствующим образом переводит группу ресурсов в режим «в сети» и «вне сети».</span><span class="sxs-lookup"><span data-stu-id="b2ae4-111">The WSFC service determines whether the cluster is in optimal quorum health at all times and brings the resource group online and offline accordingly.</span></span>  
  
-   <span data-ttu-id="b2ae4-112">Активный экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] периодически передает набор диагностических параметров компонентов в группу ресурсов WSFC по выделенному соединению.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-112">The active [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance periodically reports a set of component diagnostics to the WSFC resource group over a dedicated connection.</span></span> <span data-ttu-id="b2ae4-113">Группа ресурсов WSFC соблюдает политику отработки отказа, в которой определены условия, вызывающие перезапуск и отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-113">The WSFC resource group maintains the failover policy, which defines the failure conditions that trigger restarts and failovers.</span></span>  
  
 <span data-ttu-id="b2ae4-114">В этом разделе описывается второй из представленных выше механизмов.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-114">This topic discusses the second mechanism above.</span></span> <span data-ttu-id="b2ae4-115">Дополнительные сведения о работе WSFC для настройки кворума и обнаружения работоспособности см. в статье [Режим кворума и участвующая в голосовании конфигурация WSFC (SQL Server)](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b2ae4-115">For more information on the WSFC behavior for quorum configuration and health detection, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="b2ae4-116">Автоматический переход на другой ресурс с участием FCI не допускается в группе доступности AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-116">Automatic failovers to and from an FCI are not allowed in an AlwaysOn availability group.</span></span> <span data-ttu-id="b2ae4-117">Однако допускается переход на другой ресурс вручную с участием FCI.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-117">However, manual failovers to and from and FCI are allowed in an AlwaysOn availability group.</span></span>  
  
##  <a name="failover-policy-overview"></a><a name="Concepts"></a> <span data-ttu-id="b2ae4-118">Общие сведения о политике отработки отказа</span><span class="sxs-lookup"><span data-stu-id="b2ae4-118">Failover Policy Overview</span></span>  
 <span data-ttu-id="b2ae4-119">Процесс отработки отказа можно разделить на следующие этапы.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-119">The failover process can be broken down into the following steps:</span></span>  
  
1.  [<span data-ttu-id="b2ae4-120">Мониторинг состояния работоспособности</span><span class="sxs-lookup"><span data-stu-id="b2ae4-120">Monitor the Health Status</span></span>](failover-policy-for-failover-cluster-instances.md#monitor)  
  
2.  [<span data-ttu-id="b2ae4-121">Определение сбоев</span><span class="sxs-lookup"><span data-stu-id="b2ae4-121">Determining Failures</span></span>](failover-policy-for-failover-cluster-instances.md#determine)  
  
3.  [<span data-ttu-id="b2ae4-122">Действия при сбоях</span><span class="sxs-lookup"><span data-stu-id="b2ae4-122">Responding to Failures</span></span>](failover-policy-for-failover-cluster-instances.md#respond)  
  
###  <a name="monitor-the-health-status"></a><a name="monitor"></a><span data-ttu-id="b2ae4-123">Мониторинг состояния работоспособности</span><span class="sxs-lookup"><span data-stu-id="b2ae4-123">Monitor the Health Status</span></span>  
 <span data-ttu-id="b2ae4-124">Для FCI отслеживаются три типа состояния работоспособности.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-124">There are three types of health statuses that are monitored for the FCI:</span></span>  
  
-   [<span data-ttu-id="b2ae4-125">Состояние службы SQL Server</span><span class="sxs-lookup"><span data-stu-id="b2ae4-125">State of the SQL Server service</span></span>](failover-policy-for-failover-cluster-instances.md#service)  
  
-   [<span data-ttu-id="b2ae4-126">Скорость ответа экземпляра SQL Server</span><span class="sxs-lookup"><span data-stu-id="b2ae4-126">Responsiveness of the SQL Server instance</span></span>](failover-policy-for-failover-cluster-instances.md#instance)  
  
-   [<span data-ttu-id="b2ae4-127">Диагностика компонентов SQL Server</span><span class="sxs-lookup"><span data-stu-id="b2ae4-127">SQL Server component diagnostics</span></span>](failover-policy-for-failover-cluster-instances.md#component)  
  
####  <a name="state-of-the-sql-server-service"></a><a name="service"></a><span data-ttu-id="b2ae4-128">Состояние службы SQL Server</span><span class="sxs-lookup"><span data-stu-id="b2ae4-128">State of the SQL Server service</span></span>  
 <span data-ttu-id="b2ae4-129">Служба WSFC отслеживает начальное состояние службы SQL Server на активном узле FCI, чтобы обнаружить момент ее остановки.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-129">The WSFC service monitors the start state of the SQL Server service on the active FCI node to detect when the SQL Server service is stopped.</span></span>  
  
####  <a name="responsiveness-of-the-sql-server-instance"></a><a name="instance"></a><span data-ttu-id="b2ae4-130">Скорость реагирования экземпляра SQL Server</span><span class="sxs-lookup"><span data-stu-id="b2ae4-130">Responsiveness of the SQL Server instance</span></span>  
 <span data-ttu-id="b2ae4-131">В момент запуска SQL Server служба WSFC использует библиотеку ресурсов компонента ядра СУБД SQL Server для создания нового соединения в отдельном потоке, который используется исключительно для мониторинга состояния работоспособности.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-131">During SQL Server startup, the WSFC service uses the SQL Server Database Engine resource DLL to create a new connection to on a separate thread that is used exclusively for monitoring the health status.</span></span> <span data-ttu-id="b2ae4-132">Это гарантирует наличие в экземпляре SQL Server необходимых ресурсов для сообщения о собственном состоянии работоспособности в случае высокой загрузки.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-132">This ensures that there the SQL instance has the required resources to report its health status while under load.</span></span> <span data-ttu-id="b2ae4-133">С помощью этого выделенного соединения SQL Server запускает системную хранимую процедуру [sp_server_diagnostics (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) в режиме повторения для периодической передачи сведений о состоянии работоспособности компонентов SQL Server в библиотеку ресурсов.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-133">Using this dedicated connection, SQL Server runs the [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) system stored procedure in repeat mode to periodically report the health status of the SQL Server components to the resource DLL.</span></span>  
  
 <span data-ttu-id="b2ae4-134">Библиотека DLL ресурсов определяет скорость ответа экземпляра SQL Server, оценивая время ожидания проверки работоспособности.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-134">The resource DLL determines the responsiveness of the SQL instance using a health check timeout.</span></span> <span data-ttu-id="b2ae4-135">Свойство HealthCheckTimeout определяет, сколько времени библиотека ресурсов будет ожидать получения данных от хранимой процедуры sp_server_diagnostics до того, как экземпляр SQL Server будет признан не отвечающим на запросы службы WSFC.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-135">The HealthCheckTimeout property defines how long the resource DLL should wait for the sp_server_diagnostics stored procedure before it reports the SQL instance as unresponsive to the WSFC service.</span></span> <span data-ttu-id="b2ae4-136">Это свойство настраивается с помощью T-SQL, а также в оснастке «Диспетчер отказоустойчивости кластеров».</span><span class="sxs-lookup"><span data-stu-id="b2ae4-136">This property is configurable using T-SQL as well as in the Failover Cluster Manager snap-in.</span></span> <span data-ttu-id="b2ae4-137">Дополнительные сведения см. в разделе [Configure HealthCheckTimeout Property Settings](configure-healthchecktimeout-property-settings.md).</span><span class="sxs-lookup"><span data-stu-id="b2ae4-137">For more information, see [Configure HealthCheckTimeout Property Settings](configure-healthchecktimeout-property-settings.md).</span></span> <span data-ttu-id="b2ae4-138">В следующих пунктах описывается влияние этого свойства на значений времени ожидания и интервала повтора.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-138">The following items describe how this property affects timeout and repeat interval settings:</span></span>  
  
-   <span data-ttu-id="b2ae4-139">Библиотека ресурсов вызывает хранимую процедуру sp_server_diagnostics и устанавливает интервал повтора равным одной трети значения параметра HealthCheckTimeout.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-139">The resource DLL calls the sp_server_diagnostics stored procedure and sets the repeat interval to one-third of the HealthCheckTimeout setting.</span></span>  
  
-   <span data-ttu-id="b2ae4-140">Если хранимая процедура sp_server_diagnostics выполняется слишком медленно или не возвращает данные, библиотека ресурсов будет ожидать в течение времени, равного интервалу HealthCheckTimeout, а затем сообщит службе WSFC об отсутствии ответа экземпляра SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-140">If the sp_server_diagnostics stored procedure is slow or is not returning information, the resource DLL will wait for the interval specified by HealthCheckTimeout before it reports to the WSFC service that the SQL instance is unresponsive.</span></span>  
  
-   <span data-ttu-id="b2ae4-141">Если выделенное соединение теряется, то библиотека ресурсов повторяет подключение к экземпляру SQL Server в течение интервала, указанного в свойстве HealthCheckTimeout, а затем сообщает службе WSFC об отсутствии ответа экземпляра SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-141">If the dedicated connection is lost, the resource DLL will retry the connection to the SQL instance for the interval specified by HealthCheckTimeout before it reports to the WSFC service that the SQL instance is unresponsive.</span></span>  
  
####  <a name="sql-server-component-diagnostics"></a><a name="component"></a> <span data-ttu-id="b2ae4-142">Диагностика компонентов SQL Server</span><span class="sxs-lookup"><span data-stu-id="b2ae4-142">SQL Server component diagnostics</span></span>  
 <span data-ttu-id="b2ae4-143">Системная хранимая процедура sp_server_diagnostics периодически собирает диагностические данные о компонентах в экземпляре SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-143">The system stored procedure sp_server_diagnostics periodically collects component diagnostics on the SQL instance.</span></span> <span data-ttu-id="b2ae4-144">Собранные диагностические данные отображаются в виде строки для каждого из следующих компонентов и передаются в вызывающий поток.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-144">The diagnostic information that is collected is surfaced as a row for each of the following components and passed to the calling thread.</span></span>  
  
1.  <span data-ttu-id="b2ae4-145">система</span><span class="sxs-lookup"><span data-stu-id="b2ae4-145">system</span></span>  
  
2.  <span data-ttu-id="b2ae4-146">ресурс</span><span class="sxs-lookup"><span data-stu-id="b2ae4-146">resource</span></span>  
  
3.  <span data-ttu-id="b2ae4-147">обработка запросов</span><span class="sxs-lookup"><span data-stu-id="b2ae4-147">query process</span></span>  
  
4.  <span data-ttu-id="b2ae4-148">io_subsystem</span><span class="sxs-lookup"><span data-stu-id="b2ae4-148">io_subsystem</span></span>  
  
5.  <span data-ttu-id="b2ae4-149">события</span><span class="sxs-lookup"><span data-stu-id="b2ae4-149">events</span></span>  
  
 <span data-ttu-id="b2ae4-150">Система, ресурс и компоненты процесса запроса используются для обнаружения сбоя.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-150">The system, resource, and query process components are used for failure detection.</span></span> <span data-ttu-id="b2ae4-151">Подсистема io_subsytem и компоненты событий используются только для диагностики.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-151">The io_subsytem and events components are used for diagnostic purposes only.</span></span>  
  
 <span data-ttu-id="b2ae4-152">Каждый набор строк данных также записывается в журнал диагностики кластеров SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-152">Each rowset of information is also written to the SQL Server cluster diagnostics log.</span></span> <span data-ttu-id="b2ae4-153">Дополнительные сведения см. в статье [Просмотр и чтение журнала диагностики экземпляра отказоустойчивого кластера](view-and-read-failover-cluster-instance-diagnostics-log.md).</span><span class="sxs-lookup"><span data-stu-id="b2ae4-153">For more information, see [View and Read Failover Cluster Instance Diagnostics Log](view-and-read-failover-cluster-instance-diagnostics-log.md).</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="b2ae4-154">Хранимая процедура sp_server_diagnostics применяется в технологии SQL Server AlwaysOn, но также доступна для использования в любом экземпляре SQL Server для обнаружения и устранения проблем.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-154">While the sp_server_diagnostic stored procedure is used by SQL Server AlwaysOn technology, it is available for use in any SQL Server instance to help detect and troubleshoot problems.</span></span>  
  
####  <a name="determining-failures"></a><a name="determine"></a> <span data-ttu-id="b2ae4-155">Определение сбоев</span><span class="sxs-lookup"><span data-stu-id="b2ae4-155">Determining Failures</span></span>  
 <span data-ttu-id="b2ae4-156">Библиотека ресурсов компонент ядра СУБД SQL Server определяет, является ли обнаруженное состояние работоспособности условием сбоя, используя свойство FailureConditionLevel.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-156">The SQL Server Database Engine resource DLL determines whether the detected health status is a condition for failure using the FailureConditionLevel property.</span></span> <span data-ttu-id="b2ae4-157">Свойство FailureConditionLevel определяет, какие обнаруженные состояния работоспособности вызывают перезапуск или отработку отказа.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-157">The FailureConditionLevel property defines which detected health statuses cause restarts or failovers.</span></span> <span data-ttu-id="b2ae4-158">Доступно несколько уровней вариантов, от запрета автоматического перезапуска или отработки отказа до всех возможных условий, приводящих к автоматическому перезапуску или отработке отказа.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-158">Multiple levels of options are available, ranging from no automatic restart or failover to all possible failure conditions resulting in an automatic restart or failover.</span></span> <span data-ttu-id="b2ae4-159">Дополнительные сведения о настройке этого свойства см. в разделе [Configure FailureConditionLevel Property Settings](configure-failureconditionlevel-property-settings.md).</span><span class="sxs-lookup"><span data-stu-id="b2ae4-159">For more information about how to configure this property, see [Configure FailureConditionLevel Property Settings](configure-failureconditionlevel-property-settings.md).</span></span>  
  
 <span data-ttu-id="b2ae4-160">Условия сбоя устанавливаются по прогрессирующей шкале.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-160">The failure conditions are set on an increasing scale.</span></span> <span data-ttu-id="b2ae4-161">Каждый уровень, с 1 по 5, включает все условия предыдущих уровней, а также собственные дополнительные условия.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-161">For levels 1-5, each level includes all the conditions from the previous levels in addition to its own conditions.</span></span> <span data-ttu-id="b2ae4-162">Это означает, что с каждым уровнем вероятность отработки отказа или перезапуска повышается.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-162">This means that with each level, there is an increased probability of a failover or restart.</span></span> <span data-ttu-id="b2ae4-163">Уровни условий сбоя описаны в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-163">The failure condition levels are described in the following table.</span></span>  
  
 <span data-ttu-id="b2ae4-164">Ознакомьтесь со статьей [sp_server_diagnostics (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql), поскольку эта системная хранимая процедура играет важную роль в уровнях условий сбоя.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-164">Review [sp_server_diagnostics &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql) as this system stored procedure plays in important role in the failure condition levels.</span></span>  
  
|<span data-ttu-id="b2ae4-165">Level</span><span class="sxs-lookup"><span data-stu-id="b2ae4-165">Level</span></span>|<span data-ttu-id="b2ae4-166">Условие</span><span class="sxs-lookup"><span data-stu-id="b2ae4-166">Condition</span></span>|<span data-ttu-id="b2ae4-167">Описание</span><span class="sxs-lookup"><span data-stu-id="b2ae4-167">Description</span></span>|  
|-----------|---------------|-----------------|  
|<span data-ttu-id="b2ae4-168">0</span><span class="sxs-lookup"><span data-stu-id="b2ae4-168">0</span></span>|<span data-ttu-id="b2ae4-169">Без автоматической отработки отказа или перезапуска</span><span class="sxs-lookup"><span data-stu-id="b2ae4-169">No automatic failover or restart</span></span>|<span data-ttu-id="b2ae4-170">Указывает, что при любых условиях сбоя отработка отказа или перезапуск не будет выполняться автоматически.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-170">Indicates that no failover or restart will be triggered automatically on any failure conditions.</span></span> <span data-ttu-id="b2ae4-171">Этот уровень предназначен только для обслуживания системы.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-171">This level is for system maintenance purposes only.</span></span>|  
|<span data-ttu-id="b2ae4-172">1</span><span class="sxs-lookup"><span data-stu-id="b2ae4-172">1</span></span>|<span data-ttu-id="b2ae4-173">Отработка отказа или перезапуск при отключении сервера</span><span class="sxs-lookup"><span data-stu-id="b2ae4-173">Failover or restart on server down</span></span>|<span data-ttu-id="b2ae4-174">Указывает, что при возникновении одного из следующих условий будет выполнен перезапуск или отработка отказа.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-174">Indicates that a server restart or failover will be triggered if the following condition is raised:</span></span><br /><br /> <span data-ttu-id="b2ae4-175">Служба SQL Server остановлена.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-175">SQL Server service is down.</span></span>|  
|<span data-ttu-id="b2ae4-176">2</span><span class="sxs-lookup"><span data-stu-id="b2ae4-176">2</span></span>|<span data-ttu-id="b2ae4-177">Отработка отказа или перезапуск, если сервер не отвечает</span><span class="sxs-lookup"><span data-stu-id="b2ae4-177">Failover or restart on server unresponsive</span></span>|<span data-ttu-id="b2ae4-178">Указывает, что сервер перезапускается или вызывается отработка отказа на резервный ресурс при возникновении одного из следующих условий.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-178">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="b2ae4-179">Служба SQL Server остановлена.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-179">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="b2ae4-180">Экземпляр SQL Server не отвечает (библиотеке ресурсов не удается получить данные от процедуры sp_server_diagnostics в течение времени, заданного HealthCheckTimeout).</span><span class="sxs-lookup"><span data-stu-id="b2ae4-180">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span>|  
|<span data-ttu-id="b2ae4-181">3\*</span><span class="sxs-lookup"><span data-stu-id="b2ae4-181">3\*</span></span>|<span data-ttu-id="b2ae4-182">Отработка отказа или перезапуск при возникновении критических ошибок сервера</span><span class="sxs-lookup"><span data-stu-id="b2ae4-182">Failover or restart on critical server errors</span></span>|<span data-ttu-id="b2ae4-183">Указывает, что сервер перезапускается или вызывается отработка отказа на резервный ресурс при возникновении одного из следующих условий.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-183">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="b2ae4-184">Служба SQL Server остановлена.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-184">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="b2ae4-185">Экземпляр SQL Server не отвечает (библиотеке ресурсов не удается получить данные от процедуры sp_server_diagnostics в течение времени, заданного HealthCheckTimeout).</span><span class="sxs-lookup"><span data-stu-id="b2ae4-185">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="b2ae4-186">Системная хранимая процедура sp_server_diagnostics возвращает сообщение "системная ошибка".</span><span class="sxs-lookup"><span data-stu-id="b2ae4-186">System stored procedure sp_server_diagnostics returns 'system error'.</span></span>|  
|<span data-ttu-id="b2ae4-187">4</span><span class="sxs-lookup"><span data-stu-id="b2ae4-187">4</span></span>|<span data-ttu-id="b2ae4-188">Отработка отказа или перезапуск при возникновении умеренных ошибок сервера</span><span class="sxs-lookup"><span data-stu-id="b2ae4-188">Failover or restart on moderate server errors</span></span>|<span data-ttu-id="b2ae4-189">Указывает, что сервер перезапускается или вызывается отработка отказа на резервный ресурс при возникновении одного из следующих условий.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-189">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="b2ae4-190">Служба SQL Server остановлена.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-190">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="b2ae4-191">Экземпляр SQL Server не отвечает (библиотеке ресурсов не удается получить данные от процедуры sp_server_diagnostics в течение времени, заданного HealthCheckTimeout).</span><span class="sxs-lookup"><span data-stu-id="b2ae4-191">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="b2ae4-192">Системная хранимая процедура sp_server_diagnostics возвращает сообщение "системная ошибка".</span><span class="sxs-lookup"><span data-stu-id="b2ae4-192">System stored procedure sp_server_diagnostics returns 'system error'.</span></span><br /><br /> <span data-ttu-id="b2ae4-193">Системная хранимая процедура sp_server_diagnostics возвращает сообщение "ошибка ресурса".</span><span class="sxs-lookup"><span data-stu-id="b2ae4-193">System  stored procedure sp_server_diagnostics returns 'resource error'.</span></span>|  
|<span data-ttu-id="b2ae4-194">5</span><span class="sxs-lookup"><span data-stu-id="b2ae4-194">5</span></span>|<span data-ttu-id="b2ae4-195">Отработка отказа или перезапуск при всех соответствующих условиях</span><span class="sxs-lookup"><span data-stu-id="b2ae4-195">Failover or restart on any qualified failure conditions</span></span>|<span data-ttu-id="b2ae4-196">Указывает, что сервер перезапускается или вызывается отработка отказа на резервный ресурс при возникновении одного из следующих условий.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-196">Indicates that a server restart or failover will be triggered if any of the following conditions are raised:</span></span><br /><br /> <span data-ttu-id="b2ae4-197">Служба SQL Server остановлена.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-197">SQL Server service is down.</span></span><br /><br /> <span data-ttu-id="b2ae4-198">Экземпляр SQL Server не отвечает (библиотеке ресурсов не удается получить данные от процедуры sp_server_diagnostics в течение времени, заданного HealthCheckTimeout).</span><span class="sxs-lookup"><span data-stu-id="b2ae4-198">SQL Server instance is not responsive (Resource DLL cannot receive data from sp_server_diagnostics within the HealthCheckTimeout settings).</span></span><br /><br /> <span data-ttu-id="b2ae4-199">Системная хранимая процедура sp_server_diagnostics возвращает сообщение "системная ошибка".</span><span class="sxs-lookup"><span data-stu-id="b2ae4-199">System stored procedure sp_server_diagnostics returns 'system error'.</span></span><br /><br /> <span data-ttu-id="b2ae4-200">Системная хранимая процедура sp_server_diagnostics возвращает сообщение "ошибка ресурса".</span><span class="sxs-lookup"><span data-stu-id="b2ae4-200">System  stored procedure sp_server_diagnostics returns 'resource error'.</span></span><br /><br /> <span data-ttu-id="b2ae4-201">Системная хранимая процедура sp_server_diagnostics возвращает сообщение "ошибка обработки запроса".</span><span class="sxs-lookup"><span data-stu-id="b2ae4-201">System stored procedure sp_server_diagnostics returns 'query_processing error'.</span></span>|  
  
 <span data-ttu-id="b2ae4-202">\*Значение по умолчанию</span><span class="sxs-lookup"><span data-stu-id="b2ae4-202">\*Default Value</span></span>  
  
####  <a name="responding-to-failures"></a><a name="respond"></a><span data-ttu-id="b2ae4-203">Реагирование на сбои</span><span class="sxs-lookup"><span data-stu-id="b2ae4-203">Responding to Failures</span></span>  
 <span data-ttu-id="b2ae4-204">После обнаружения одного или нескольких условий сбоя реакция службы WSFC зависит от состояния кворума WSFC и параметров перезапуска и отработки отказа для группы ресурсов FCI.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-204">After one or more failure conditions are detected, how the WSFC service responds to the failures depends on the WSFC quorum state and the restart and failover settings of the FCI resource group.</span></span> <span data-ttu-id="b2ae4-205">Если в FCI потерян кворум WSFC, то весь экземпляр FCI переводится в режим «вне сети» и высокий уровень доступности FCI утрачивается.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-205">If the FCI has lost its WSFC quorum, then the entire FCI is brought offline and the FCI has lost its high availability.</span></span> <span data-ttu-id="b2ae4-206">Если в FCI сохраняется кворум WSFC, то служба WSFC сначала может перезапустить сбойный узел, а затем выполнить отработку отказа, если попытки перезапуска не завершаются успехом.</span><span class="sxs-lookup"><span data-stu-id="b2ae4-206">If the FCI still retains its WSFC quorum, then the WSFC service may respond by first attempting to restart the failed node and then failover if the restart attempts are unsuccessful.</span></span> <span data-ttu-id="b2ae4-207">Параметры перезапуска и отработки отказа настраиваются в оснастке «Диспетчер отказоустойчивости кластеров».</span><span class="sxs-lookup"><span data-stu-id="b2ae4-207">The restart and failover settings are configured in the Failover Cluster Manager snap-in.</span></span> <span data-ttu-id="b2ae4-208">Дополнительные сведения об этих параметрах см. в разделе [ \<Resource> Свойства: вкладка "политики"](https://technet.microsoft.com/library/cc725685.aspx).</span><span class="sxs-lookup"><span data-stu-id="b2ae4-208">For more information these settings, see [\<Resource> Properties: Policies Tab](https://technet.microsoft.com/library/cc725685.aspx).</span></span>  
  
 <span data-ttu-id="b2ae4-209">Дополнительные сведения о поддержании работоспособности кворума см. в статье [Режимы кворума и конфигурация голосования WSFC (SQL Server)](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b2ae4-209">For more information on maintaining quorum health, see [WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b2ae4-210">См. также:</span><span class="sxs-lookup"><span data-stu-id="b2ae4-210">See Also</span></span>  
 [<span data-ttu-id="b2ae4-211">ALTER SERVER CONFIGURATION (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="b2ae4-211">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-server-configuration-transact-sql)  
  
  
