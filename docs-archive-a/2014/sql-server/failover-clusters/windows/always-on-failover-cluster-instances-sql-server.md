---
title: Экземпляры отказоустойчивого кластера AlwaysOn (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- clustering [SQL Server]
- high availability [SQL Server], failover clustering
- virtual servers [SQL Server], about virtual servers
- clusters [SQL Server]
- servers [SQL Server], failover clustering
- resource groups [SQL Server]
- availability [SQL Server]
- failover clustering [SQL Server]
- AlwaysOn [SQL Server], see failover clustering [SQL Server]
ms.assetid: 86a15b33-4d03-4549-8ea2-b45e4f1baad7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6adc173560fd83d00616eb00c63651ef667c2a00
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87659289"
---
# <a name="always-on-failover-cluster-instances-sql-server"></a><span data-ttu-id="1d6cf-102">Экземпляры отказоустойчивого кластера AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="1d6cf-102">Always On Failover Cluster Instances (SQL Server)</span></span>
  <span data-ttu-id="1d6cf-103">В рамках [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предложения Always On Always on экземпляры отказоустойчивого кластера используют функции отказоустойчивой кластеризации Windows Server (WSFC), чтобы обеспечить локальную высокую доступность с помощью избыточности на уровне экземпляра сервера — *экземпляра отказоустойчивого кластера* (FCI).</span><span class="sxs-lookup"><span data-stu-id="1d6cf-103">As part of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Always On offering, Always On Failover Cluster Instances leverages Windows Server Failover Clustering (WSFC) functionality to provide local high availability through redundancy at the server-instance level-a *failover cluster instance* (FCI).</span></span> <span data-ttu-id="1d6cf-104">Экземпляр отказоустойчивого кластера (FCI) является единственным экземпляром [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , установленным на всех узлах отказоустойчивой кластеризации Windows Server (WSFC) и, возможно, в нескольких подсетях.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-104">An FCI is a single instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that is installed across Windows Server Failover Clustering (WSFC) nodes and, possibly, across multiple subnets.</span></span> <span data-ttu-id="1d6cf-105">Экземпляр отказоустойчивого кластера выглядит в сети как экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , запущенный на одном компьютере, но экземпляр отказоустойчивого кластера обеспечивает отработку отказа с переходом одного узла WSFC на другой узел, если текущий узел становится недоступным.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-105">On the network, an FCI appears to be an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] running on a single computer, but the FCI provides failover from one WSFC node to another if the current node becomes unavailable.</span></span>  
  
 <span data-ttu-id="1d6cf-106">Экземпляр отказоустойчивого кластера (FCI) может эффективно использовать [Группы доступности AlwaysOn](../../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md) для выполнения удаленного аварийного восстановления на уровне базы данных.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-106">An FCI can leverage [Always On Availability Groups](../../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md)to provide remote disaster recovery at the database level.</span></span> <span data-ttu-id="1d6cf-107">Дополнительные сведения см. в разделе [Отказоустойчивая кластеризация и группы доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1d6cf-107">For more information, see [Failover Clustering and Always On Availability Groups (;SQL Server);](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1d6cf-108">Начиная с версии [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)], экземпляры отказоустойчивого кластера AlwaysOn поддерживают кластерные общие тома (CSV) как в [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)], так и в [!INCLUDE[win8srv](../../../includes/win8srv-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1d6cf-108">Beginning in [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)], Always On Failover Cluster Instances supports Clustered Shared Volumes (CSV) in both [!INCLUDE[winserver2008r2](../../../includes/winserver2008r2-md.md)] and [!INCLUDE[win8srv](../../../includes/win8srv-md.md)].</span></span> <span data-ttu-id="1d6cf-109">Дополнительные сведения о CSV-файле см. в разделе [Основные сведения о кластерных общих томах в отказоустойчивом кластере](https://technet.microsoft.com/library/dd759255.aspx).</span><span class="sxs-lookup"><span data-stu-id="1d6cf-109">For more information on CSV, see [Understanding Cluster Shared Volumes in a Failover Cluster](https://technet.microsoft.com/library/dd759255.aspx).</span></span>  
  
 <span data-ttu-id="1d6cf-110">**В этом разделе.**</span><span class="sxs-lookup"><span data-stu-id="1d6cf-110">**In this Topic:**</span></span>  
  
-   [<span data-ttu-id="1d6cf-111">Преимущества</span><span class="sxs-lookup"><span data-stu-id="1d6cf-111">Benefits</span></span>](#Benefits)  
  
-   [<span data-ttu-id="1d6cf-112">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="1d6cf-112">Recommendations</span></span>](#Recommendations)  
  
-   [<span data-ttu-id="1d6cf-113">Общие сведения об экземпляре отказоустойчивого кластера</span><span class="sxs-lookup"><span data-stu-id="1d6cf-113">Failover Cluster Instance Overview</span></span>](#Overview)  
  
-   [<span data-ttu-id="1d6cf-114">Элементы экземпляра отказоустойчивого кластера</span><span class="sxs-lookup"><span data-stu-id="1d6cf-114">Elements of a Failover Cluster Instance</span></span>](#FCIelements)  
  
-   [<span data-ttu-id="1d6cf-115">SQL Server концепции и задачи отработки отказа</span><span class="sxs-lookup"><span data-stu-id="1d6cf-115">SQL Server Failover Concepts and Tasks</span></span>](#ConceptsAndTasks)  
  
-   [<span data-ttu-id="1d6cf-116">Связанные разделы</span><span class="sxs-lookup"><span data-stu-id="1d6cf-116">Related Topics</span></span>](#RelatedTopics)  
  
##  <a name="benefits-of-a-failover-cluster-instance"></a><a name="Benefits"></a> <span data-ttu-id="1d6cf-117">Преимущества экземпляра отказоустойчивого кластера</span><span class="sxs-lookup"><span data-stu-id="1d6cf-117">Benefits of a Failover Cluster Instance</span></span>  
 <span data-ttu-id="1d6cf-118">При сбое оборудования или программного обеспечения сервера приложения или клиенты, связывающиеся с сервером, будут простаивать.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-118">When there is hardware or software failure of a server, the applications or clients connecting to the server will experience downtime.</span></span> <span data-ttu-id="1d6cf-119">Если экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] настроен как отказоустойчивый кластер (а не как независимый экземпляр), высокий уровень доступности такого экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] защищен наличием избыточных узлов в отказоустойчивом кластере.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-119">When a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is configured to be an FCI (instead of a standalone instance), the high availability of that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is protected by the presence of redundant nodes in the FCI.</span></span> <span data-ttu-id="1d6cf-120">Только один из узлов в FCI принадлежит группе ресурсов WSFC одновременно.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-120">Only one of the nodes in the FCI owns the WSFC resource group at a time.</span></span> <span data-ttu-id="1d6cf-121">В случае сбоя (отказа оборудования, сбоя операционной системы, приложений или служб) либо при выполнении запланированного обновления группа передается во владение другому узлу отказоустойчивого кластера.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-121">In case of a failure (hardware failures, operating system failures, application or service failures), or a planned upgrade, the resource group ownership is moved to another WSFC node.</span></span> <span data-ttu-id="1d6cf-122">Данный процесс не заметен для клиента или приложения, соединяющегося с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , и сводит к минимуму время ожидания приложения или клиента во время сбоя.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-122">This process is transparent to the client or application connecting to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and this minimize the downtime the application or clients experience during a failure.</span></span> <span data-ttu-id="1d6cf-123">Ниже перечислены некоторые ключевые преимущества, которые обеспечивают экземпляры отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="1d6cf-123">The following lists some key benefits that [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instances provide:</span></span>  
  
-   <span data-ttu-id="1d6cf-124">Защита на уровне экземпляра через избыточность</span><span class="sxs-lookup"><span data-stu-id="1d6cf-124">Protection at the instance level through redundancy</span></span>  
  
-   <span data-ttu-id="1d6cf-125">Автоматический переход на другой ресурс в случае сбоя (отказа оборудования, сбоя операционной системы, приложений или служб)</span><span class="sxs-lookup"><span data-stu-id="1d6cf-125">Automatic failover in the event of a failure (hardware failures, operating system failures, application or service failures)</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="1d6cf-126">В группе доступности AlwaysOn не поддерживается автоматический переход на другие узлы в пределах доступности группы от FCI.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-126">In an Always On availability group, automatic failover from an FCI to other nodes within the availability group is not supported.</span></span> <span data-ttu-id="1d6cf-127">Это означает, что отказоустойчивые кластеры и независимые узлы не следует объединять внутри одной группы доступности, если автоматический переход на другой ресурс является важным компонентом решения высокого уровня доступности.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-127">This means that FCIs and standalone nodes should not be coupled together within an availability group if automatic failover is an important component your high availability solution.</span></span> <span data-ttu-id="1d6cf-128">Однако такое объединение можно сделать для решения *аварийного восстановления* .</span><span class="sxs-lookup"><span data-stu-id="1d6cf-128">However, this coupling can be made for your *disaster recovery* solution.</span></span>  
  
-   <span data-ttu-id="1d6cf-129">Поддержка широкого массива решения хранения, включая диски кластеров WSFC (iSCSI, Fiber Channel и т. д.) и общие папки протокола SMB.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-129">Support for a broad array of storage solutions, including WSFC cluster disks (iSCSI, Fiber Channel, and so on) and server message block (SMB) file shares.</span></span>  
  
-   <span data-ttu-id="1d6cf-130">Решение для аварийного восстановления с помощью FCI с несколькими подсетями или запуска базы данных, размещенной в FCI, внутри группы доступности AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-130">Disaster recovery solution using a multi-subnet FCI or running an FCI-hosted database inside an Always On availability group.</span></span> <span data-ttu-id="1d6cf-131">Благодаря новой поддержке большого числа подсетей в среде [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]кластеру FCI с большим количеством подсетей больше не нужна виртуальная локальная сеть, что повышает управляемость и безопасность кластера FCI с большим числом подсетей.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-131">With the new multi-subnet support in [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], a multi-subnet FCI no longer requires a virtual LAN, increasing the manageability and security of a multi-subnet FCI.</span></span>  
  
-   <span data-ttu-id="1d6cf-132">Нулевая реконфигурация приложений и клиентов при сбое</span><span class="sxs-lookup"><span data-stu-id="1d6cf-132">Zero reconfiguration of applications and clients during failovers</span></span>  
  
-   <span data-ttu-id="1d6cf-133">Гибкая политика отработки отказа для гранулированных событий триггера для автоматической отработки отказа</span><span class="sxs-lookup"><span data-stu-id="1d6cf-133">Flexible failover policy for granular trigger events for automatic failovers</span></span>  
  
-   <span data-ttu-id="1d6cf-134">Надежная отработка отказа посредством периодического подробного отслеживания исправности системы с помощью выделенных и постоянных соединений</span><span class="sxs-lookup"><span data-stu-id="1d6cf-134">Reliable failovers through periodic and detailed health detection using dedicated and persisted connections</span></span>  
  
-   <span data-ttu-id="1d6cf-135">Возможность настройки и предсказуемость во время отработки отказа посредством косвенных контрольных точек</span><span class="sxs-lookup"><span data-stu-id="1d6cf-135">Configurability and predictability in failover time through indirect background checkpoints</span></span>  
  
-   <span data-ttu-id="1d6cf-136">Использование регулируемых ресурсов при отработке отказа</span><span class="sxs-lookup"><span data-stu-id="1d6cf-136">Throttled resource usage during failovers</span></span>  
  
##  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="1d6cf-137">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="1d6cf-137">Recommendations</span></span>  
 <span data-ttu-id="1d6cf-138">В рабочей среде рекомендуется использовать статические IP-адреса в сочетании с виртуальным IP-адресом экземпляра отказоустойчивого кластера.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-138">In a production environment, we recommend that you use static IP addresses in conjunction the virtual IP address of a Failover Cluster Instance.</span></span>  <span data-ttu-id="1d6cf-139">Не рекомендуется использовать протокол DHCP в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-139">We recommend against using DHCP in a production environment.</span></span> <span data-ttu-id="1d6cf-140">В случае простоя, если время действия IP-адреса протокола DHCP истекло, на регистрацию нового сетевого IP-адреса протокола DHCP, связанного с DNS-именем, уйдет дополнительное время.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-140">In the event of down time, if the DHCP IP lease expires, extra time is required to re-register the new DHCP IP address associated with the DNS name.</span></span>  
  
##  <a name="failover-cluster-instance-overview"></a><a name="Overview"></a><span data-ttu-id="1d6cf-141">Общие сведения об экземпляре отказоустойчивого кластера</span><span class="sxs-lookup"><span data-stu-id="1d6cf-141">Failover Cluster Instance Overview</span></span>  
 <span data-ttu-id="1d6cf-142">FCI работает в группе ресурсов WSFC вместе с одним или несколькими узлами WSFC.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-142">An FCI runs in a WSFC resource group with one or more WSFC nodes.</span></span> <span data-ttu-id="1d6cf-143">Когда экземпляр FCI запускается, один из узлов принимает владение группой ресурсов и выводит свой экземпляр служб [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в сеть.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-143">When the FCI starts up, one of the nodes assume ownership of the resource group and brings its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance online.</span></span> <span data-ttu-id="1d6cf-144">Ресурсы, принадлежащие данному узлу включают в себя:</span><span class="sxs-lookup"><span data-stu-id="1d6cf-144">The resources owned by this node include:</span></span>  
  
-   <span data-ttu-id="1d6cf-145">Сетевое имя</span><span class="sxs-lookup"><span data-stu-id="1d6cf-145">Network name</span></span>  
  
-   <span data-ttu-id="1d6cf-146">IP-адрес</span><span class="sxs-lookup"><span data-stu-id="1d6cf-146">IP address</span></span>  
  
-   <span data-ttu-id="1d6cf-147">Общие диски</span><span class="sxs-lookup"><span data-stu-id="1d6cf-147">Shared disks</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="1d6cf-148">Служба компонента Database Engine</span><span class="sxs-lookup"><span data-stu-id="1d6cf-148">Database Engine service</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="1d6cf-149">Служба агента</span><span class="sxs-lookup"><span data-stu-id="1d6cf-149">Agent service</span></span>  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="1d6cf-150">Analysis Services, если эти служб установлены</span><span class="sxs-lookup"><span data-stu-id="1d6cf-150">Analysis Services service, if installed</span></span>  
  
-   <span data-ttu-id="1d6cf-151">Один файловый ресурс общего доступа, если установлен компонент FILESTREAM</span><span class="sxs-lookup"><span data-stu-id="1d6cf-151">One file share resource, if the FILESTREAM feature is installed</span></span>  
  
 <span data-ttu-id="1d6cf-152">В любое время только владелец группы ресурсов (и никакой другой узел в FCI) запускает соответствующие службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-152">At any time, only the resource group owner (and no other node in the FCI) is running its respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services in the resource group.</span></span> <span data-ttu-id="1d6cf-153">Когда происходит переход на другой ресурс, будь то автоматический или запланированный переход на другой ресурс, происходит следующая последовательность событий.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-153">When a failover occurs, whether it be an automatic failover or a planned failover, the following sequence of events happen:</span></span>  
  
1.  <span data-ttu-id="1d6cf-154">Если событие не является сбоем оборудования или системы, все «грязные» страницы в буферном кэше записываются на диск.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-154">Unless a hardware or system failure occurs, all dirty pages in the buffer cache are written to disk.</span></span>  
  
2.  <span data-ttu-id="1d6cf-155">Все соответствующие службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в группе ресурсов останавливаются на активном узле.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-155">All respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services in the resource group are stopped on the active node.</span></span>  
  
3.  <span data-ttu-id="1d6cf-156">Права владения группой ресурсов переносятся на другой узел в FCI.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-156">The resource group ownership is transferred to another node in the FCI.</span></span>  
  
4.  <span data-ttu-id="1d6cf-157">Новый владелец группы ресурсов запускает свои службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1d6cf-157">The new resource group owner starts its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] services.</span></span>  
  
5.  <span data-ttu-id="1d6cf-158">Клиентские запросы на подключение приложения автоматически перенаправляются на новый активный узел, используя то же имя виртуальной сети (VNN).</span><span class="sxs-lookup"><span data-stu-id="1d6cf-158">Client application connection requests are automatically directed to the new active node using the same virtual network name (VNN).</span></span>  
  
 <span data-ttu-id="1d6cf-159">FCI находится в сети, если его базовый кластер WSFC находится в исправном состоянии (большая часть узлов кворума WSFC доступны в качестве целей автоматического перехода на другой ресурс).</span><span class="sxs-lookup"><span data-stu-id="1d6cf-159">The FCI is online as long as its underlying WSFC cluster is in good quorum health (the majority of the quorum WSFC nodes are available as automatic failover targets).</span></span> <span data-ttu-id="1d6cf-160">Когда кластер WSFC теряет кворум из-за сбоя аппаратной части, программного обеспечения, сети или неверной настройки кворума, весь кластер WSFC вместе с FCI выводится из сети.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-160">When the WSFC cluster loses its quorum, whether due to hardware, software, network failure, or improper quorum configuration, the entire WSFC cluster, along with the FCI, is brought offline.</span></span> <span data-ttu-id="1d6cf-161">Для этого незапланированного сценария отработки отказа требуется вмешательство пользователя, который должен переустановить кворум для оставшихся доступных узлов, чтобы вернуть кластер WSFC и FCI обратно в сеть.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-161">Manual intervention is then required in this unplanned failover scenario to reestablish quorum in the remaining available nodes in order to bring the WSFC cluster and FCI back online.</span></span> <span data-ttu-id="1d6cf-162">Дополнительные сведения см. в разделе [режимы кворума WSFC и конфигурация голосования (; SQL Server);](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1d6cf-162">For more information, see [WSFC Quorum Modes and Voting Configuration (;SQL Server);](wsfc-quorum-modes-and-voting-configuration-sql-server.md).</span></span>  
  
### <a name="predictable-failover-time"></a><span data-ttu-id="1d6cf-163">Прогнозируемое время отработки отказа</span><span class="sxs-lookup"><span data-stu-id="1d6cf-163">Predictable Failover Time</span></span>  
 <span data-ttu-id="1d6cf-164">В зависимости от того, когда экземпляр [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в последний раз выполнил операцию контрольной точки, в кэше буфера может быть достаточное число «грязных» страниц.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-164">Depending on when your [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance last performed a checkpoint operation, there can be a substantial amount of dirty pages in the buffer cache.</span></span> <span data-ttu-id="1d6cf-165">Последующая отработка отказа длится столько, сколько потребуется времени для записи оставшихся «грязных» страниц на диск, что может увеличить время отработки отказа непредсказуемым образом.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-165">Consequently, failovers last as long as it takes to write the remaining dirty pages to disk, which can lead to long and unpredictable failover time.</span></span> <span data-ttu-id="1d6cf-166">Начиная с [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]FCI может использовать косвенные контрольные точки для регулирования числа "грязных" страниц, хранимых в кэше буфера.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-166">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the FCI can use indirect checkpoints to throttle the amount of dirty pages kept in the buffer cache.</span></span> <span data-ttu-id="1d6cf-167">Несмотря на то что это занимает дополнительные ресурсы при нормальной рабочей нагрузке, время отработки отказа становится более прогнозируемым и регулируемым.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-167">While this does consume additional resources under regular workload, it makes the failover time more predictable as well as more configurable.</span></span> <span data-ttu-id="1d6cf-168">Это очень полезно, когда в соглашении об уровне обслуживания в организации указана цель времени восстановления (RTO) для решения высокого уровня доступности.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-168">This is very useful when the service-level agreement in your organization specifies the recovery time objective (RTO) for your high availability solution.</span></span> <span data-ttu-id="1d6cf-169">Дополнительные сведения о косвенных контрольных точках см. в разделе [Indirect Checkpoints](../../../relational-databases/logs/database-checkpoints-sql-server.md#IndirectChkpt).</span><span class="sxs-lookup"><span data-stu-id="1d6cf-169">For more information on indirect checkpoints, see [Indirect Checkpoints](../../../relational-databases/logs/database-checkpoints-sql-server.md#IndirectChkpt).</span></span>  
  
### <a name="reliable-health-monitoring-and-flexible-failover-policy"></a><span data-ttu-id="1d6cf-170">Надежный мониторинг исправности и гибкая политика отработки отказа</span><span class="sxs-lookup"><span data-stu-id="1d6cf-170">Reliable Health Monitoring and Flexible Failover Policy</span></span>  
 <span data-ttu-id="1d6cf-171">После успешного запуска FCI служба WSFC мониторит состояние базового кластера WSFC, а также состояние экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1d6cf-171">After the FCI starts successfully, the WSFC service monitors both the health of the underlying WSFC cluster, as well as the health of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="1d6cf-172">Начиная с [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)]служба WSFC использует выделенную линию для обращения к экземпляру [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] и получения подробной диагностики компонентов посредством системной хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-172">Beginning with [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)], the WSFC service uses a dedicated connection to poll the active [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance for detailed component diagnostics through a system stored procedure.</span></span> <span data-ttu-id="1d6cf-173">Это имеет три последствия.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-173">The implication of this is three-fold:</span></span>  
  
-   <span data-ttu-id="1d6cf-174">Выделенное соединение с экземпляром [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] позволяет получать надежную диагностику компонентов в любое время, даже когда FCI испытывает перегрузку.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-174">The dedicated connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance makes it possible to reliably poll for component diagnostics all the time, even when the FCI is under heavy load.</span></span> <span data-ttu-id="1d6cf-175">В результате можно выделить систему, испытывающую большую нагрузку, и систему, которая находится на грани отработки отказа, позволяя избежать проблем, связанных с ложной отработкой отказа.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-175">This makes it possible to distinguish between a system that is under heavy load and a system that actually has failure conditions, thus preventing issues such as false failovers.</span></span>  
  
-   <span data-ttu-id="1d6cf-176">Подробная диагностика компонентов позволяет настроить более гибкую политику отработки отказа, с помощью которой вы можете выбрать, какие условия отказа запускают отработку отказа, а какие нет.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-176">The detailed component diagnostics makes it possible to configure a more flexible failover policy, whereby you can choose what failure conditions trigger failovers and which failure conditions do not.</span></span>  
  
-   <span data-ttu-id="1d6cf-177">Подробная диагностика компонентов также позволяет лучше устранять ошибки автоматической отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-177">The detailed component diagnostics also enables better troubleshooting of automatic failovers retroactively.</span></span> <span data-ttu-id="1d6cf-178">Сведения диагностики сохраняются в файлы журналов, связанные с журналами ошибок [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1d6cf-178">The diagnostic information is stored to log files, which are collocated with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] error logs.</span></span> <span data-ttu-id="1d6cf-179">Файлы можно загрузить в средство просмотра файлов журнала для изучения состояний компонентов, которые привели к отработке отказа, чтобы определить причину сбоя.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-179">You can load them into the Log File Viewer to inspect the component states leading up to the failover occurrence in order to determine what cause that failover.</span></span>  
  
 <span data-ttu-id="1d6cf-180">Дополнительные сведения см. в разделе [политика отработки отказа для экземпляров отказоустойчивого кластера](failover-policy-for-failover-cluster-instances.md) .</span><span class="sxs-lookup"><span data-stu-id="1d6cf-180">For more information, see [Failover Policy for Failover Cluster Instances](failover-policy-for-failover-cluster-instances.md)</span></span>  
  
##  <a name="elements-of-a-failover-cluster-instance"></a><a name="FCIelements"></a><span data-ttu-id="1d6cf-181">Элементы экземпляра отказоустойчивого кластера</span><span class="sxs-lookup"><span data-stu-id="1d6cf-181">Elements of a Failover Cluster Instance</span></span>  
 <span data-ttu-id="1d6cf-182">FCI включает набор физических серверов (узлов), которые имеют схожую аппаратную и программную конфигурацию, в том числе версию операционной системы и уровень обновления, версию [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , ее уровень обновления, компоненты и имя экземпляра.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-182">An FCI consists of a set of physical servers (nodes) that contain similar hardware configuration as well as identical software configuration that includes operating system version and patch level, and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] version, patch level, components, and instance name.</span></span> <span data-ttu-id="1d6cf-183">Идентичная программная конфигурация необходима для того, чтобы FCI смог работать после отработки отказа между двумя узлами.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-183">Identical software configuration is necessary to ensure that the FCI can be fully functional as it fails over between the nodes.</span></span>  
  
 <span data-ttu-id="1d6cf-184">Группа ресурсов WSFC</span><span class="sxs-lookup"><span data-stu-id="1d6cf-184">WSFC Resource Group</span></span>  
 <span data-ttu-id="1d6cf-185">FCI [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] работает в группе ресурсов WSFC.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-185">A [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI runs in a WSFC resource group.</span></span> <span data-ttu-id="1d6cf-186">Каждый узел в группе ресурсов поддерживает синхронизированную копию параметров конфигурации и разделов реестра для того, чтобы сохранить полную функциональность FCI после отработки отказа, при этом только один узел в кластере владеет группой ресурсов одновременно (активный узел).</span><span class="sxs-lookup"><span data-stu-id="1d6cf-186">Each node in the resource group maintains a synchronized copy of the configuration settings and check-pointed registry keys to ensure full functionality of the FCI after a failover, and only one of the nodes in the cluster owns the resource group at a time (the active node).</span></span> <span data-ttu-id="1d6cf-187">Служба WSFC управляет кластером сервера, конфигурацией кворума, политикой и операциями отработки отказа, а также именем виртуальной сети и виртуальными IP-адресами для FCI.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-187">The WSFC service manages the server cluster, quorum configuration, failover policy, and failover operations, as well as the VNN and virtual IP addresses for the FCI.</span></span> <span data-ttu-id="1d6cf-188">В случае сбоя (аппаратной части, операционной системы, приложения или службы) или запланированного обновления права владения группой ресурсов перемещаются на другой узел в FCI. Число узлов, поддерживаемых в группе ресурсов WSFC, зависит от выпуска [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1d6cf-188">In case of a failure (hardware failures, operating system failures, application or service failures) or a planned upgrade, the resource group ownership is moved to another node in the FCI.The number of nodes that are supported in a WSFC resource group depends on your [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] edition.</span></span> <span data-ttu-id="1d6cf-189">Также один кластер WSFC может запускать несколько FCI (множественные группы ресурсов), в зависимости от возможностей оборудования, например ЦП, памяти и числа дисков.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-189">Also, the same WSFC cluster can run multiple FCIs (multiple resource groups), depending on your hardware capacity, such as CPUs, memory, and number of disks.</span></span>  
  
 <span data-ttu-id="1d6cf-190">Двоичные файлы SQL Server</span><span class="sxs-lookup"><span data-stu-id="1d6cf-190">SQL Server Binaries</span></span>  
 <span data-ttu-id="1d6cf-191">Двоичные файлы устанавливаются локально на каждом узле FCI, так же как и в случае изолированной установки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1d6cf-191">The product binaries are installed locally on each node of the FCI, a process similar to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] stand-alone installations.</span></span> <span data-ttu-id="1d6cf-192">Однако во время запуска службы не запускаются автоматически, а управляются службой WSFC.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-192">However, during startup, the services are not started automatically, but managed by WSFC.</span></span>  
  
 <span data-ttu-id="1d6cf-193">Память</span><span class="sxs-lookup"><span data-stu-id="1d6cf-193">Storage</span></span>  
 <span data-ttu-id="1d6cf-194">В отличие от группы доступности AlwaysOn, FCI должен использовать общее хранилище для всех узлов FCI для базы данных и хранения журналов.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-194">Contrary to the Always On availability group, an FCI must use shared storage between all nodes of the FCI for database and log storage.</span></span> <span data-ttu-id="1d6cf-195">Общее хранилище может быть в форме кластерных дисков WSFC, дисков на SAN или общих папок SMB.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-195">The shared storage can be in the form of WSFC cluster disks, disks on a SAN, or file shares on an SMB.</span></span> <span data-ttu-id="1d6cf-196">Таким образом, все узлы в FCI имеют одинаковое представление данных экземпляра всегда, когда происходит отработка отказа.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-196">This way, all nodes in the FCI have the same view of instance data whenever a failover occurs.</span></span> <span data-ttu-id="1d6cf-197">Однако в этом случае общее хранилище может стать единственной точкой сбоя, в то время как FCI зависит от базового решения хранилища для обеспечения защиты данных.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-197">This does mean, however, that the shared storage has the potential of being the single point of failure, and FCI depends on the underlying storage solution to ensure data protection.</span></span>  
  
 <span data-ttu-id="1d6cf-198">Сетевое имя</span><span class="sxs-lookup"><span data-stu-id="1d6cf-198">Network Name</span></span>  
 <span data-ttu-id="1d6cf-199">VNN для FCI предоставляет единую точку соединения для FCI.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-199">The VNN for the FCI provides a unified connection point for the FCI.</span></span> <span data-ttu-id="1d6cf-200">Это позволяет приложениям подключаться к VNN без необходимости знать текущий активный узел.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-200">This allows applications to connect to the VNN without the need to know the currently active node.</span></span> <span data-ttu-id="1d6cf-201">Когда происходит отработка отказа, VNN регистрируется на новом активном узле после его запуска.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-201">When a failover occurs, the VNN is registered to the new active node after it starts.</span></span> <span data-ttu-id="1d6cf-202">Данный процесс не заметен для клиента или приложения, соединяющегося с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , и сводит к минимуму время ожидания приложения или клиента во время сбоя.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-202">This process is transparent to the client or application connecting to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and this minimize the downtime the application or clients experience during a failure.</span></span>  
  
 <span data-ttu-id="1d6cf-203">Виртуальные IP-адреса</span><span class="sxs-lookup"><span data-stu-id="1d6cf-203">Virtual IPs</span></span>  
 <span data-ttu-id="1d6cf-204">В случае многоподсетевого кластера FCI виртуальный IP-адрес присваивается каждой подсети FCI.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-204">In the case of a multi-subnet FCI, a virtual IP address is assigned to each subnet in the FCI.</span></span> <span data-ttu-id="1d6cf-205">В ходе отработки отказа VNN-имя DNS-сервера обновляется и указывает на виртуальный IP-адрес соответствующей подсети.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-205">During a failover, the VNN on the DNS server is updated to point to the virtual IP address for the respective subnet.</span></span> <span data-ttu-id="1d6cf-206">Приложения и клиенты могут подключиться к FCI, используя то же самое имя VNN после многоподсетевой отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-206">Applications and clients can then connect to the FCI using the same VNN after a multi-subnet failover.</span></span>  
  
##  <a name="sql-server-failover-concepts-and-tasks"></a><a name="ConceptsAndTasks"></a> <span data-ttu-id="1d6cf-207">Основные понятия и задачи отработки отказа SQL Server</span><span class="sxs-lookup"><span data-stu-id="1d6cf-207">SQL Server Failover Concepts and Tasks</span></span>  
  
|<span data-ttu-id="1d6cf-208">Основные понятия и задачи</span><span class="sxs-lookup"><span data-stu-id="1d6cf-208">Concepts and Tasks</span></span>|<span data-ttu-id="1d6cf-209">Раздел</span><span class="sxs-lookup"><span data-stu-id="1d6cf-209">Topic</span></span>|  
|------------------------|-----------|  
|<span data-ttu-id="1d6cf-210">Описывает механизм обнаружения сбоя и гибкую политику отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-210">Describes the failure detection mechanism and the flexible failover policy.</span></span>|[<span data-ttu-id="1d6cf-211">Failover Policy for Failover Cluster Instances</span><span class="sxs-lookup"><span data-stu-id="1d6cf-211">Failover Policy for Failover Cluster Instances</span></span>](failover-policy-for-failover-cluster-instances.md)|  
|<span data-ttu-id="1d6cf-212">Описание основных понятий в управлении и обслуживании экземпляров отказоустойчивых кластеров.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-212">Describes concepts in FCI administration and maintenance.</span></span>|[<span data-ttu-id="1d6cf-213">Администрирование и обслуживание экземпляров отказоустойчивого кластера</span><span class="sxs-lookup"><span data-stu-id="1d6cf-213">Failover Cluster Instance Administration and Maintenance</span></span>](failover-cluster-instance-administration-and-maintenance.md)|  
|<span data-ttu-id="1d6cf-214">Описание и понятия конфигурации с несколькими подсетями</span><span class="sxs-lookup"><span data-stu-id="1d6cf-214">Describes multi-subnet configuration and concepts</span></span>|[<span data-ttu-id="1d6cf-215">SQL Server кластеризации с несколькими подсетями (; SQL Server);</span><span class="sxs-lookup"><span data-stu-id="1d6cf-215">SQL Server Multi-Subnet Clustering (;SQL Server);</span></span>](sql-server-multi-subnet-clustering-sql-server.md)|  
  
##  <a name="related-topics"></a><a name="RelatedTopics"></a><span data-ttu-id="1d6cf-216">См. также</span><span class="sxs-lookup"><span data-stu-id="1d6cf-216">Related Topics</span></span>  
  
|<span data-ttu-id="1d6cf-217">**Описание раздела**</span><span class="sxs-lookup"><span data-stu-id="1d6cf-217">**Topic descriptions**</span></span>|<span data-ttu-id="1d6cf-218">**Раздел**</span><span class="sxs-lookup"><span data-stu-id="1d6cf-218">**Topic**</span></span>|  
|----------------------------|---------------|  
|<span data-ttu-id="1d6cf-219">Описывает, как установить новый FCI [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1d6cf-219">Describes how to install a new [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCI.</span></span>|[<span data-ttu-id="1d6cf-220">Создание нового SQL Server отказоустойчивого кластера (; Настройка);</span><span class="sxs-lookup"><span data-stu-id="1d6cf-220">Create a New SQL Server Failover Cluster (;Setup);</span></span>](../install/create-a-new-sql-server-failover-cluster-setup.md)|  
|<span data-ttu-id="1d6cf-221">Описывает, как выполнить обновление до отказоустойчивого кластера [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1d6cf-221">Describes how to upgrade to a [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] failover cluster.</span></span>|[<span data-ttu-id="1d6cf-222">Обновление отказоустойчивого кластера SQL Server</span><span class="sxs-lookup"><span data-stu-id="1d6cf-222">Upgrade a SQL Server Failover Cluster</span></span>](upgrade-a-sql-server-failover-cluster-instance.md)|  
|<span data-ttu-id="1d6cf-223">Описание основных понятий отказоустойчивых кластеров Windows, а также ссылки на связанные с ними задачи.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-223">Describes Windows Failover Clustering Concepts and provides links to tasks related to Windows Failover Clustering</span></span>|[!INCLUDE[nextref_longhorn](../../../includes/nextref-longhorn-md.md)]<span data-ttu-id="1d6cf-224">: [обзор отказоустойчивых кластеров](https://go.microsoft.com/fwlink/?LinkId=177878)</span><span class="sxs-lookup"><span data-stu-id="1d6cf-224">: [Overview of Failover Clusters](https://go.microsoft.com/fwlink/?LinkId=177878)</span></span><br /><br /> [!INCLUDE[nextref_longhorn](../../../includes/nextref-longhorn-md.md)] <span data-ttu-id="1d6cf-225">R2: [обзор отказоустойчивых кластеров](https://go.microsoft.com/fwlink/?LinkId=177879)</span><span class="sxs-lookup"><span data-stu-id="1d6cf-225">R2: [Overview of Failover Clusters](https://go.microsoft.com/fwlink/?LinkId=177879)</span></span>|  
|<span data-ttu-id="1d6cf-226">Описывает различия в основных понятиях между узлами в экземпляре отказоустойчивого кластера и репликами внутри группы доступности, а также содержит рекомендации по использованию экземпляра отказоустойчивого кластера для размещения реплики для группы доступности.</span><span class="sxs-lookup"><span data-stu-id="1d6cf-226">Describes the distinctions in concepts between nodes in an FCI and replicas within an availability group and considerations for using an FCI to host a replica for an availability group.</span></span>|[<span data-ttu-id="1d6cf-227">Отказоустойчивая кластеризация и группы доступности AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="1d6cf-227">Failover Clustering and Always On Availability Groups (SQL Server)</span></span>](../../../database-engine/availability-groups/windows/failover-clustering-and-always-on-availability-groups-sql-server.md)|  
  
  
