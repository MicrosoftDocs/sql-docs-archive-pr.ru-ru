---
title: Управление именами для входа и заданиями после переключения ролей (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- role switching [SQL Server]
ms.assetid: fc2fc949-746f-40c7-b5d4-3fd51ccfbd7b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 9c099bf9ea271b5ea93fdebfe8f35c98864bca09
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87659294"
---
# <a name="management-of-logins-and-jobs-after-role-switching-sql-server"></a>Управление именами входа и заданиями после переключения ролей (SQL Server)
   При развертывании решения по обеспечению высокой доступности или аварийного восстановления для базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] важно воспроизвести значимые данные, хранящиеся в этой базе данных, в базе данных **master** или **msdb**. Обычно к таким данным относятся задания базы данных-источника или основной базы данных, а также имена входа пользователей или процессов, которым требуется подключаться к базе данных. Эти данные следует скопировать на экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , где размещена база данных-получатель или зеркальная база данных. После переключения ролей рекомендуется по возможности программно воспроизвести эти данные в новой базе данных-источнике или основной базе данных.  
  
## <a name="logins"></a>Имена входа  
 На каждом экземпляре сервера, где размещена копия базы данных, следует воспроизвести имена входа, имеющие разрешения на доступ к основной базе данных. При переключении ролей базы данных-источника или основной базы данных доступ к новой базе данных-источнику или основной базе данных будет только у тех пользователей, имена входа которых есть в этой базе данных. Пользователи, имена входа которых не определены в новой базе данных-источнике или основном экземпляре базы данных, утратят связь со своими учетными записями и не смогут обращаться к этой базе данных.  
  
 Если пользователь утратил связь с учетной записью, создайте имя пользователя на новом экземпляре сервера-источника или основного сервера и выполните хранимую процедуру [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql). Дополнительные сведения см. в статье [Диагностика пользователей, утративших связь с учетной записью (SQL Server)](troubleshoot-orphaned-users-sql-server.md).  
  
###  <a name="logins-of-applications-that-use-sql-server-authentication-or-a-local-windows-login"></a><a name="SSauthentication"></a> Имена входа для приложений, использующих проверку подлинности SQL Server или локальное имя входа Windows  
 Если приложение использует проверку подлинности SQL Server или локальное имя входа Windows, то несоответствие идентификаторов безопасности может привести к ошибке входа на удаленный экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Несоответствие идентификаторов безопасности вызывает утрату связи с учетной записью на удаленном экземпляре сервера. Эта проблема может возникать при подключении приложения к зеркальной базе данных или базе данных доставки журналов после отработки отказа либо к базе данных подписчика репликации, которая была инициализирована из резервной копии.  
  
 Во избежание этой проблемы рекомендуется предпринять профилактические меры во время настройки такого приложения на использование базы данных, размещенной на удаленном экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Среди таких мер — перенос имен входа и паролей с локального экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на удаленный экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения о предотвращении этой проблемы см. в статье базы знаний 918992 —[как передавать имена входа и пароли между экземплярами SQL Server](https://support.microsoft.com/kb/918992/)).  
  
> [!NOTE]  
>  Эта проблема затрагивает локальные учетные записи Windows на разных компьютерах. Для доменных учетных записей эта проблема не возникает, поскольку идентификатор безопасности там один для всех компьютеров.  
  
 Дополнительные сведения см. в записи [Пользователи, утратившие связь с учетной записью при работе с зеркальным отображением базы данных и доставкой журналов](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (блог Database Engine).  
  
## <a name="jobs"></a>Задания  
 Некоторые задания, например задания резервного копирования, следует рассмотреть особо. Обычно после переключения ролей владельцу базы данных или системному администратору приходится создавать повторно задания для новой базы данных-источника или основной базы данных.  
  
 Если бывший экземпляр сервера-источника или основного сервера доступен, то требуется также удалить исходные задания на этом экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Обратите внимание, что задания в текущей зеркальной базе данных завершатся ошибкой, поскольку она находится в состоянии RESTORING и недоступна.  
  
> [!NOTE]  
>  Разные экземпляры [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] могут быть настроены по-разному, например, могут различаться буквы, обозначающие диски. Задания для каждого участника должны допускать подобные различия.  
  
## <a name="see-also"></a>См. также:  
 [Управление метаданными при обеспечении доступности базы данных на другом экземпляре сервера (SQL Server)](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md)   
 [Диагностика пользователей, утративших связь с учетной записью (SQL Server)](troubleshoot-orphaned-users-sql-server.md)  
  
  
