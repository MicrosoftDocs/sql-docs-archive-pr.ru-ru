---
title: Управление именами для входа и заданиями после переключения ролей (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- role switching [SQL Server]
ms.assetid: fc2fc949-746f-40c7-b5d4-3fd51ccfbd7b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 9c099bf9ea271b5ea93fdebfe8f35c98864bca09
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87659294"
---
# <a name="management-of-logins-and-jobs-after-role-switching-sql-server"></a><span data-ttu-id="a590d-102">Управление именами входа и заданиями после переключения ролей (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="a590d-102">Management of Logins and Jobs After Role Switching (SQL Server)</span></span>
  <span data-ttu-id="a590d-103"> При развертывании решения по обеспечению высокой доступности или аварийного восстановления для базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] важно воспроизвести значимые данные, хранящиеся в этой базе данных, в базе данных **master** или **msdb**.</span><span class="sxs-lookup"><span data-stu-id="a590d-103">When deploying a high-availability or disaster-recovery solution for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database, it is important to reproduce relevant information that is stored for the database in the **master** or **msdb** databases.</span></span> <span data-ttu-id="a590d-104">Обычно к таким данным относятся задания базы данных-источника или основной базы данных, а также имена входа пользователей или процессов, которым требуется подключаться к базе данных.</span><span class="sxs-lookup"><span data-stu-id="a590d-104">Typically, the relevant information includes the jobs of the primary/principal database and the logins of users or processes that need to connect to the database.</span></span> <span data-ttu-id="a590d-105">Эти данные следует скопировать на экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , где размещена база данных-получатель или зеркальная база данных.</span><span class="sxs-lookup"><span data-stu-id="a590d-105">You should duplicate this information on any instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that hosts a secondary/mirror database.</span></span> <span data-ttu-id="a590d-106">После переключения ролей рекомендуется по возможности программно воспроизвести эти данные в новой базе данных-источнике или основной базе данных.</span><span class="sxs-lookup"><span data-stu-id="a590d-106">If possible after roles are switched, it is best to programmatically reproduce the information on the new primary/principal database.</span></span>  
  
## <a name="logins"></a><span data-ttu-id="a590d-107">Имена входа</span><span class="sxs-lookup"><span data-stu-id="a590d-107">Logins</span></span>  
 <span data-ttu-id="a590d-108">На каждом экземпляре сервера, где размещена копия базы данных, следует воспроизвести имена входа, имеющие разрешения на доступ к основной базе данных.</span><span class="sxs-lookup"><span data-stu-id="a590d-108">On every server instances that hosts a copy of the database, you should reproduce the logins that have permission to access the principal database.</span></span> <span data-ttu-id="a590d-109">При переключении ролей базы данных-источника или основной базы данных доступ к новой базе данных-источнику или основной базе данных будет только у тех пользователей, имена входа которых есть в этой базе данных.</span><span class="sxs-lookup"><span data-stu-id="a590d-109">When the primary/principal role switches, only users whose logins exist on the new primary/principal server instance can access the new primary/principal database.</span></span> <span data-ttu-id="a590d-110">Пользователи, имена входа которых не определены в новой базе данных-источнике или основном экземпляре базы данных, утратят связь со своими учетными записями и не смогут обращаться к этой базе данных.</span><span class="sxs-lookup"><span data-stu-id="a590d-110">Users whose logins are not defined on the new primary/principal server instance are orphaned and cannot access the database.</span></span>  
  
 <span data-ttu-id="a590d-111">Если пользователь утратил связь с учетной записью, создайте имя пользователя на новом экземпляре сервера-источника или основного сервера и выполните хранимую процедуру [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="a590d-111">If a user is orphaned, create the login on the new primary/principal server instance and run [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql).</span></span> <span data-ttu-id="a590d-112">Дополнительные сведения см. в статье [Диагностика пользователей, утративших связь с учетной записью (SQL Server)](troubleshoot-orphaned-users-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="a590d-112">For more information, see [Troubleshoot Orphaned Users &#40;SQL Server&#41;](troubleshoot-orphaned-users-sql-server.md).</span></span>  
  
###  <a name="logins-of-applications-that-use-sql-server-authentication-or-a-local-windows-login"></a><a name="SSauthentication"></a> <span data-ttu-id="a590d-113">Имена входа для приложений, использующих проверку подлинности SQL Server или локальное имя входа Windows</span><span class="sxs-lookup"><span data-stu-id="a590d-113">Logins Of Applications That Use SQL Server Authentication or a Local Windows Login</span></span>  
 <span data-ttu-id="a590d-114">Если приложение использует проверку подлинности SQL Server или локальное имя входа Windows, то несоответствие идентификаторов безопасности может привести к ошибке входа на удаленный экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a590d-114">If an application uses SQL Server Authentication or a local Windows login, mismatched SIDs can prevent the application's login from resolving on a remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a590d-115">Несоответствие идентификаторов безопасности вызывает утрату связи с учетной записью на удаленном экземпляре сервера.</span><span class="sxs-lookup"><span data-stu-id="a590d-115">The mismatched SIDs cause the login to become an orphaned user on the remote server instance.</span></span> <span data-ttu-id="a590d-116">Эта проблема может возникать при подключении приложения к зеркальной базе данных или базе данных доставки журналов после отработки отказа либо к базе данных подписчика репликации, которая была инициализирована из резервной копии.</span><span class="sxs-lookup"><span data-stu-id="a590d-116">This issue can occur when an application connects to a mirrored or log shipping database after a failover or to a replication subscriber database that was initialized from a backup.</span></span>  
  
 <span data-ttu-id="a590d-117">Во избежание этой проблемы рекомендуется предпринять профилактические меры во время настройки такого приложения на использование базы данных, размещенной на удаленном экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a590d-117">To prevent this issue, we recommend that you take preventative measures when you set up such an application to use a database that is hosted by a remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a590d-118">Среди таких мер — перенос имен входа и паролей с локального экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на удаленный экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a590d-118">Prevention involves transferring the logins and the passwords from the local instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a590d-119">Дополнительные сведения о предотвращении этой проблемы см. в статье базы знаний 918992 —[как передавать имена входа и пароли между экземплярами SQL Server](https://support.microsoft.com/kb/918992/)).</span><span class="sxs-lookup"><span data-stu-id="a590d-119">For more information about how to prevent this issue, see KB article 918992 -[How to transfer logins and passwords between instances of SQL Server](https://support.microsoft.com/kb/918992/)).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a590d-120">Эта проблема затрагивает локальные учетные записи Windows на разных компьютерах.</span><span class="sxs-lookup"><span data-stu-id="a590d-120">This problem affects Windows local accounts on different computers.</span></span> <span data-ttu-id="a590d-121">Для доменных учетных записей эта проблема не возникает, поскольку идентификатор безопасности там один для всех компьютеров.</span><span class="sxs-lookup"><span data-stu-id="a590d-121">However, this problem does not occur for domain accounts because the SID is the same on each of the computers.</span></span>  
  
 <span data-ttu-id="a590d-122">Дополнительные сведения см. в записи [Пользователи, утратившие связь с учетной записью при работе с зеркальным отображением базы данных и доставкой журналов](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (блог Database Engine).</span><span class="sxs-lookup"><span data-stu-id="a590d-122">For more information, see [Orphaned Users with Database Mirroring and Log Shipping](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (a Database Engine blog).</span></span>  
  
## <a name="jobs"></a><span data-ttu-id="a590d-123">Задания</span><span class="sxs-lookup"><span data-stu-id="a590d-123">Jobs</span></span>  
 <span data-ttu-id="a590d-124">Некоторые задания, например задания резервного копирования, следует рассмотреть особо.</span><span class="sxs-lookup"><span data-stu-id="a590d-124">Jobs, such as backup jobs, require special consideration.</span></span> <span data-ttu-id="a590d-125">Обычно после переключения ролей владельцу базы данных или системному администратору приходится создавать повторно задания для новой базы данных-источника или основной базы данных.</span><span class="sxs-lookup"><span data-stu-id="a590d-125">Typically, after a role switch, the database owner or system administrator must re-create the jobs for the new primary/principal database.</span></span>  
  
 <span data-ttu-id="a590d-126">Если бывший экземпляр сервера-источника или основного сервера доступен, то требуется также удалить исходные задания на этом экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a590d-126">When the former primary/principal server instance is available, you should delete the original jobs on that instanceof [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="a590d-127">Обратите внимание, что задания в текущей зеркальной базе данных завершатся ошибкой, поскольку она находится в состоянии RESTORING и недоступна.</span><span class="sxs-lookup"><span data-stu-id="a590d-127">Note that jobs on the current mirror database fail because it is in the RESTORING state, making it unavailable.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a590d-128">Разные экземпляры [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] могут быть настроены по-разному, например, могут различаться буквы, обозначающие диски.</span><span class="sxs-lookup"><span data-stu-id="a590d-128">Different instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might be configured differently, with different drive letters or such.</span></span> <span data-ttu-id="a590d-129">Задания для каждого участника должны допускать подобные различия.</span><span class="sxs-lookup"><span data-stu-id="a590d-129">The jobs for each partner must allow for any such differences.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a590d-130">См. также:</span><span class="sxs-lookup"><span data-stu-id="a590d-130">See Also</span></span>  
 <span data-ttu-id="a590d-131">[Управление метаданными при обеспечении доступности базы данных на другом экземпляре сервера (SQL Server)](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md) </span><span class="sxs-lookup"><span data-stu-id="a590d-131">[Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md) </span></span>  
 [<span data-ttu-id="a590d-132">Диагностика пользователей, утративших связь с учетной записью (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="a590d-132">Troubleshoot Orphaned Users &#40;SQL Server&#41;</span></span>](troubleshoot-orphaned-users-sql-server.md)  
  
  
