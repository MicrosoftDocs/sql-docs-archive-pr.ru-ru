---
title: Убедитесь, что автоувеличение включено для всех файлов данных и журналов в процессе обновления | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
helpviewer_keywords:
- log files [SQL Server], size
- data files [SQL Server], size
- tempdb [SQL Server], size
- autogrow [SQL Server]
ms.assetid: a5860904-e2be-4224-8a51-df18a10d3fb9
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: 8ca12075598bce210a905cbdfba89f2d879cf09b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87751644"
---
# <a name="verify-autogrow-is-turned-on-for-all-data-and-log-files-during-the-upgrade-process"></a>Убедитесь, что во время процесса обновления автоувеличение размера включено для всех файлов с данными и файлов журнала
  Помощник по обновлению обнаружил файлы данных или журнала, для которых не установлен параметр «Автоувеличение». Для новых и улучшенных функций требуется дополнительное место на диске для пользовательских баз данных и системной базы данных **tempdb** . Чтобы ресурсы могли увеличивать размер при обновлении и последующих производственных операциях, рекомендуется настроить Автоувеличение на ON для всех файлов данных и журналов пользователя, а также файлов данных и журналов **tempdb** перед обновлением.  
  
 После окончания обновления и тестирования рабочей нагрузки можно отключить автоувеличение или соответствующим образом откорректировать значение приращения FILEGROWTH для файлов журналов и пользовательских данных. Рекомендуется оставить автоувеличение для системной базы данных **tempdb** . Дополнительные сведения см. в разделе «Планирование загрузки базы данных tempdb» в электронной документации по [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
## <a name="component"></a>Компонент  
 [!INCLUDE[ssDE](../../includes/ssde-md.md)]  
  
## <a name="description"></a>Описание  
 **Файлы данных**  
  
 Следующая таблица отображает изменения тех функций [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], которые приводят к росту требований к месту на диске для определяемых пользователем файлов данных.  
  
|Признак|Изменения, появившиеся в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]|  
|-------------|-----------------------------------------------------|  
|Полнотекстовый|Вместо полнотекстового каталога в файле данных сохраняется схема идентификаторов документов.|  
|Столбцы типа `text`, `ntext` и `image`|Столбцы больших объектов (LOB), определенные как данные типа `text`, `ntext` или `image`, дополнительно требуют 40 байт места на диске на каждый столбец. Это единовременное увеличение необходимого пространства происходит при первом обновлении каждого столбца LOB.|  
|метаданные|В файловой группе PRIMARY каждой пользовательской базы данных создаются и поддерживаются дополнительные системные метаданные для объектов базы данных и разрешений пользователей. Например, в более ранних версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] разрешения, связанные с объектами, предоставляющими или получающими разрешения, хранились в одной строке в виде битовой карты. Битовая карта расширена до нескольких строк.<br /><br /> Для того чтобы в ходе обновления сохранились как старые, так и новые метаданные, необходимо, чтобы было достаточно места на диске. Старые метаданные удаляются после завершения обновления.|  
  
 **Файлы журнала транзакций**  
  
 Следующая таблица отображает изменения тех функций [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], которые приводят к росту требований к месту на диске для определяемых пользователем файлов журнала транзакций.  
  
|Признак|Изменения, появившиеся в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]|  
|-------------|-----------------------------------------------------|  
|Восстановление из резервной копии или по журналу транзакций|Во время стадии отката при восстановлении после сбоя [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] дает возможность пользователям производить доступ к базе данных. Это возможно потому, что транзакции, не зафиксированные на момент возникновения сбоя, повторно получают все блокировки, которыми они владели перед сбоем. При откате транзакций эти блокировки защищают транзакции от вмешательства пользователей. Эти дополнительные данные о блокировках должны сохраняться в журнале транзакций.|  
  
 **Данные tempdb и файлы журнала**  
  
 В более ранних версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] база данных **tempdb** используется для хранения следующих объектов:  
  
-   явно создаваемые временные объекты: таблицы, хранимые процедуры, табличные переменные и курсоры;  
  
-   внутренние рабочие таблицы, создаваемые компонентом [!INCLUDE[ssDE](../../includes/ssde-md.md)];  
  
-   результаты временных сортировок при создании или перестроении индексов, если указан параметр SORT_IN_TEMPDB.  
  
 Дополнительные объекты также используют базу данных **tempdb** . В следующей таблице перечислены изменения и дополнения к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] функциям, которые приводят к дополнительным требованиям к месту на диске для файлов данных и журналов **tempdb** .  
  
|Признак|Изменения, появившиеся в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]|  
|-------------|-----------------------------------------------------|  
|Управление версиями строк|Управление версиями строк — это стандартная структура в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], используемая для следующих действий.<br /><br /> Триггеры поддержки: создание таблиц inserted и deleted в триггерах. Предусмотрено управление версиями для всех строк, изменяемых триггером, в том числе строк, измененных инструкцией, которая инициировала триггер, а также всех изменений данных, выполненных триггером; Триггеры AFTER используют хранилище версий **базы данных tempdb** для хранения образов строк, измененных триггером. При массовой загрузке данных с включенными триггерами копия каждой строки добавляется в хранилище версий.<br /><br /> Поддержка режима MARS. Если в ходе сеанса MARS выдается инструкция изменения данных (например, INSERT, UPDATE или DELETE) в момент, когда есть активный результирующий набор, выполняется управление версиями строк, которых коснулось изменение.<br /><br /> поддержки операций с индексами, в которых задан параметр ONLINE; Для действий с индексами в оперативном режиме применяется управление версиями строк, позволяющее изолировать действия с индексами от воздействия изменений, внесенных другими транзакциями. Это исключает необходимость запрашивать общую блокировку уже считанных записей. Кроме того, одновременное выполнение операций обновления и удаления пользователей во время операций с индексами в сети требует наличия пространства для записей версий в **базе данных tempdb**.<br /><br /> Поддержка уровней изоляции транзакций на основе управления версиями строк: Новая реализация уровня изоляции READ COMMITTED, использующая управление версиями строк для обеспечения согласованности чтения на уровне инструкций. нового уровня изоляции и моментального снимка для обеспечения совместимости считывания на уровне транзакций.<br /><br /> <br /><br /> Версии строк хранятся в хранилище версий **tempdb** достаточно долго для удовлетворения требований транзакций, выполняемых на уровнях изоляции на основе управления версиями строк.<br /><br /> Дополнительные сведения об управлении версиями строк и хранилище версий см. в разделе «Основные сведения об уровнях изоляции на основе управления версиями строк» электронной документации по [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|Кэширование метаданных временных таблиц и временных переменных|Для всех метаданных временной таблицы и переменной TEMP, кэшированной в кэше метаданных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , для **базы данных tempdb**выделяется две дополнительные страницы.<br /><br /> Если хранимая процедура или триггер создает временную таблицу или временную переменную, то временный объект не удаляется, когда процедура или триггер завершает свое выполнение. Вместо этого временный объект усекается до одной страницы и используется заново в следующий раз, когда выполняется процедура или триггер.|  
|Индексы секционированных таблиц|При [!INCLUDE[ssDE](../../includes/ssde-md.md)] выполнении сортировки для построения секционированных индексов в **базе данных tempdb** требуется достаточно места для хранения промежуточных операций сортировки каждой секции, если указан параметр SORT_IN_TEMPDB index.|  
|[!INCLUDE[ssSB](../../includes/sssb-md.md)]|[!INCLUDE[ssSB](../../includes/sssb-md.md)]явно использует **базу данных tempdb** при сохранении существующего контекста диалогового окна, который не может оставаться в памяти (примерно 1 КБ на диалог).<br /><br /> [!INCLUDE[ssSB](../../includes/sssb-md.md)]неявно использует **базу данных tempdb** с помощью кэширования объектов в контексте выполнения запроса. Например, рабочие таблицы используются для событий таймера и доставляемых в фоне диалогов.<br /><br /> Компонент DBMail, уведомления о событиях и уведомления о запросах неявно используют компонент [!INCLUDE[ssSB](../../includes/sssb-md.md)].|  
|Тип данных больших объектов (LOB)<br /><br /> Параметры и переменные больших объектов|Типы данных `varchar(max)` , `nvarchar(max)` ,,, **varbinary (max)**, `ntext` и `image,` , `xml` являются типами больших объектов.<br /><br /> Если для базы данных включен уровень изоляции транзакций на основе управления версиями строк и выполняются изменения больших объектов, измененный фрагмент LOB копируется в хранилище версий **базы данных tempdb**.<br /><br /> Параметры, определенные как тип данных больших объектов, хранятся в **tempdb**.|  
|Обобщенные табличные выражения|Временные рабочие таблицы для операций с очередями создаются в **базе данных tempdb** при выполнении запросов обобщенных табличных выражений.|  
  
## <a name="corrective-action"></a>Действие по исправлению  
 Чтобы назначить файлу данных или журнала автоувеличение, измените следующие инструкции, указывающие файлы данных и журнала для базы данных. Следует настроить увеличение параметра FILEGROWTH до значения, соответствующего среде.  
  
```  
ALTER DATABASE tempdb  
MODIFY FILE  
    (NAME = tempdev,  
    FILEGROWTH = 20MB);  
GO  
ALTER DATABASE tempdb  
MODIFY FILE  
    (NAME = templog,  
    FILEGROWTH = 10MB);  
```  
  
 Шаг роста по умолчанию для файлов данных равен 1 МБ. Значение по умолчанию для файла журнала равно 10 %. При настройке шага роста параметра FILEGROWTH пользуйтесь следующими общими рекомендациями.  
  
|Размер файла|Шаг роста FILEGROWTH|  
|---------------|--------------------------|  
|0–50 МБ|10 МБ|  
|100–200 МБ|20 МБ|  
|500 МБ и больше|10 %|  
  
## <a name="see-also"></a>См. также:  
 [Проблемы обновления ядро СУБД](../../../2014/sql-server/install/database-engine-upgrade-issues.md)   
 [Советник по переходу SQL Server 2014 &#91;New&#93;](sql-server-2014-upgrade-advisor.md)  
  
  
