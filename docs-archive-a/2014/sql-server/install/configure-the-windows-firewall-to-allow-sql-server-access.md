---
title: Настройка брандмауэра Windows для разрешения доступа к SQL Server | Документация Майкрософт
ms.custom: ''
ms.date: 06/22/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: install
ms.topic: conceptual
helpviewer_keywords:
- Windows Firewall ports
- WMI firewall ports
- Windows Firewall [Database Engine]
- firewall systems, configuring
- advfirewall
- firewall systems
- rules firewall
- firewall systems, overview and port list
- 1433 TCP port
- portopening using netsh
- ports [SQL Server], TCP
- netsh to open firewall ports
ms.assetid: f55c6a0e-b6bd-4803-b51a-f3a419803024
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: d1a0bc32040fc90e5f73faa708f314722bc8f3b5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2020
ms.locfileid: "87657499"
---
# <a name="configure-the-windows-firewall-to-allow-sql-server-access"></a>Configure the Windows Firewall to Allow SQL Server Access
  Системы брандмауэров предотвращают несанкционированный доступ к ресурсам компьютера. Если брандмауэр включен, но настроен неправильно, попытка соединения с [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] может оказаться заблокированной.  
  
 Чтобы разрешить доступ к экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] через брандмауэр, его необходимо настроить на компьютере, на котором работает [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Брандмауэр является компонентом [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows. Вместо него можно установить брандмауэр другой компании. В данном разделе обсуждается настройка брандмауэра Windows, однако общие принципы применимы к любым другим брандмауэрам.  
  
> [!NOTE]  
>  В разделе содержатся общие сведения о настройке брандмауэра и сводные сведения, представляющие интерес для администратора [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Дополнительные сведения и официальные данные о брандмауэрах см. в документации по брандмауэру, например в разделе [Брандмауэр Windows в режиме повышенной безопасности и IPsec](https://go.microsoft.com/fwlink/?LinkID=116904).  
  
 Пользователи, хорошо знакомые с элементом **Брандмауэр Windows** на панели управления и оснасткой "Брандмауэр Windows в режиме повышенной безопасности" консоли управления (MMC) и умеющие настраивать параметры брандмауэра, могут перейти непосредственно к разделам, приведенным в списке ниже.  
  
-   [Настройка брандмауэра Windows для доступа к компоненту Database Engine](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md)  
  
-   [Настройка брандмауэра Windows на разрешение доступа к службам Analysis Services](../../../2014/analysis-services/instances/configure-the-windows-firewall-to-allow-analysis-services-access.md)  
  
-   [настроить брандмауэр для доступа к серверу отчетов](../../reporting-services/report-server/configure-a-firewall-for-report-server-access.md)  
  

  
##  <a name="basic-firewall-information"></a><a name="BKMK_basic"></a> Основные сведения о брандмауэрах  
 Брандмауэр проверяет входящие пакеты на соответствие набору правил. Если правила разрешают передачу пакета, то брандмауэр передает его протоколу TCP/IP для дальнейшей обработки. Если передача пакета правилами не разрешена, то брандмауэр отвергает его и, если включено ведение журнала, создает в файле журнала соответствующую запись.  
  
 Список разрешенного трафика заполняется одним из следующих способов.  
  
-   Когда защищенный брандмауэром компьютер открывает соединение, брандмауэр добавляет в список элемент, разрешающий ответ по этому соединению. Полученный ответ рассматривается как ожидаемый и не требует настройки.  
  
-   Работа администратора заключается в настройке исключений в работе брандмауэра. Это дает возможность разрешать доступ определенным программам, запущенным на компьютере, либо доступ к определенным портам. В этом случае компьютер принимает весь входящий трафик, выполняя роль сервера, прослушивателя или однорангового узла. Для соединения с [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]должна быть выполнена именно такая настройка.  
  
 Выбор стратегии брандмауэра является более сложной задачей и не сводится лишь к открытию или закрытию портов. При выборе стратегии брандмауэра для предприятия необходимо обязательно рассмотреть все доступные правила и параметры конфигурации. В этом разделе все возможные параметры брандмауэра не рассматриваются. Рекомендуется ознакомиться со следующими документами.  
  
 [Руководство по началу работы с брандмауэром Windows в режиме повышенной безопасности](https://go.microsoft.com/fwlink/?LinkId=116080)  
  
 [Руководство разработчика по брандмауэру Windows в режиме повышенной безопасности](https://go.microsoft.com/fwlink/?LinkId=116904)  
  
 [Основные сведения об изоляции серверов и доменов](https://go.microsoft.com/fwlink/?LinkId=116081)  
  
##  <a name="default-firewall-settings"></a><a name="BKMK_default"></a> Параметры брандмауэра по умолчанию  
 Первым шагом при планировании конфигурации брандмауэра является определение его текущего состояния в операционной системе. Если операционная система была обновлена с предыдущей версии, в ней могли сохраниться старые настройки брандмауэра. Кроме того, параметры брандмауэра могли быть изменены другим администратором или групповой политикой домена.  
  
> [!NOTE]  
>  Включение брандмауэра может повлиять на общий доступ к файлам и принтерам, подключения к удаленному рабочему столу и работу других программ, которым необходим доступ к компьютеру. Администратор должен просмотреть все приложения, которые работают на компьютере, прежде чем приступать к настройке параметров брандмауэра.  
  
##  <a name="programs-to-configure-the-firewall"></a><a name="BKMK_programs"></a> Программы для настройки брандмауэра  
 Существует три способа настройки параметров брандмауэра Windows.  
  
-   **Элемент «Брандмауэр Windows» на панели управления**  
  
     Элемент **Брандмауэр Windows** можно открыть с панели управления.  
  
    > [!IMPORTANT]  
    >  Изменения, произведенные в элементе **Брандмауэр Windows** на панели управления, применяются только к текущему профилю. На переносных компьютерах и других мобильных устройствах пользоваться элементом **Брандмауэр Windows** на панели управления нельзя, так как профиль может измениться при установлении соединения в другой конфигурации, в результате чего ранее настроенный профиль станет недоступен. Дополнительные сведения о профилях см. в разделе [Руководство по началу работы с брандмауэром Windows в режиме повышенной безопасности](https://go.microsoft.com/fwlink/?LinkId=116080).  
  
     Элемент **Брандмауэр Windows** на панели управления позволяет настроить следующие основные параметры.  
  
    -   Включение и отключение элемента **Брандмауэр Windows** на панели управления.  
  
    -   Включение и отключение правил.  
  
    -   Предоставление исключений для портов и программ.  
  
    -   Задание некоторых ограничений области действия.  
  
     Элемент **Брандмауэр Windows** на панели управления лучше всего подходит пользователям, которые не имеют опыта в настройке конфигурации брандмауэра, если необходимо настроить основные параметры брандмауэра для стационарного компьютера. Также можно открыть элемент **Брандмауэр Windows** на панели управления из `run` команды с помощью следующей процедуры:  
  
    #### <a name="to-open-the-windows-firewall-item"></a>Открытие элемента «Брандмауэр Windows»  
  
    1.  В меню **Пуск** выберите команду **Выполнить**и введите команду `firewall.cpl`.  
  
    2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
-   **Консоль управления (MMC)**  
  
     Оснастка «Брандмауэр Windows в режиме повышенной безопасности» позволяет настраивать дополнительные параметры брандмауэра. Эта оснастка представляет большинство параметров брандмауэра и в удобной форме, а также все профили брандмауэра. Дополнительные сведения см. в подразделе [Использование оснастки "Брандмауэр Windows в режиме повышенной безопасности"](#BKMK_WF_msc) далее в этом разделе.  
  
-   **netsh**  
  
     Средство **netsh.exe** позволяет администратору настраивать компьютеры с ОС Windows и наблюдать за ними из командной строки или с помощью пакетного файла **.** При использовании средства **netsh** вводимые команды направляются соответствующим помощникам, которые выполняют их. Помощник представляет собой файл библиотеки DLL, которая расширяет функциональность средства **netsh** , предоставляя возможности настройки, мониторинга и поддержки других служб, служебных программ или протоколов. Все операционные системы, поддерживающие [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , имеют модуль поддержки брандмауэра. [!INCLUDE[firstref_longhorn](../../includes/firstref-longhorn-md.md)] также содержит расширенный помощник брандмауэра **advfirewall**. В этом разделе не приведены сведения об использовании **netsh** . Однако многие из описанных параметров конфигурации можно настроить с помощью средства **netsh**. Например, выполните в командной строке следующий скрипт, чтобы открыть TCP-порт 1433:  
  
    ```  
    netsh firewall set portopening protocol = TCP port = 1433 name = SQLPort mode = ENABLE scope = SUBNET profile = CURRENT  
    ```  
  
     Аналогичный пример, использующий брандмауэр Windows для модуля поддержки повышенной безопасности:  
  
    ```  
    netsh advfirewall firewall add rule name = SQLPort dir = in protocol = tcp action = allow localport = 1433 remoteip = localsubnet profile = DOMAIN  
    ```  
  
     Дополнительные сведения о средстве **netsh**см. в следующих разделах:  
  
    -   [Использование средства Netsh.exe и параметров командной строки](https://support.microsoft.com/kb/242468)  
  
    -   [Использование контекста netsh advfirewall firewall вместо контекста netsh firewall для управления работой брандмауэра Windows в операционной системе Windows Server 2008 или Windows Vista](https://support.microsoft.com/kb/947709)  
  
    -   [Команда «netsh firewall» с параметром «profile=all» не настраивает открытый профиль на компьютере под управлением Windows Vista](https://support.microsoft.com/kb/947213)  
  
## <a name="ports-used-by-ssnoversion"></a>Порты, используемые [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]  
 Следующие таблицы помогут выяснить, какие порты использует [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
###  <a name="ports-used-by-the-database-engine"></a><a name="BKMK_ssde"></a> Ports Used By the Database Engine  
 В следующей таблице перечислены порты, обычно используемые компонентом [!INCLUDE[ssDE](../../includes/ssde-md.md)].  
  
|Сценарий|Порт|Комментарии|  
|--------------|----------|--------------|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] по умолчанию, работающий по протоколу TCP|TCP-порт 1433|Этот порт открывают в брандмауэре чаще всего. Он применяется для программных соединений с экземпляром компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)]по умолчанию или именованным экземпляром, который является единственным на данном компьютере (для именованных экземпляров следует учитывать ряд особых требований, См. раздел [динамические порты](#BKMK_dynamic_ports) далее в этом разделе.)|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в конфигурации по умолчанию|TCP-порт выделяется динамически в момент запуска компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .|См. подраздел [Динамические порты](#BKMK_dynamic_ports)далее в этом разделе. При использовании именованных экземпляров службе браузера [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] может потребоваться UDP-порт 1434.|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , если они настроены для использования фиксированного порта|Номер порта настраивается администратором.|См. подраздел [Динамические порты](#BKMK_dynamic_ports)далее в этом разделе.|  
|Выделенное административное соединение|TCP-порт 1434 предназначен для экземпляра по умолчанию. Другие порты используются для именованных экземпляров. Номер порта проверьте по журналу ошибок.|По умолчанию удаленные соединения по выделенному административному соединению (DAC) запрещены. Разрешить удаленное выделенное административное соединение можно при помощи средства настройки контактной зоны. Дополнительные сведения см. в разделе [Surface Area Configuration](../../relational-databases/security/surface-area-configuration.md).|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Служба браузера|UDP-порт 1434|Служба « [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , браузер» прослушивает входящие соединения к именованному экземпляру и возвращает клиенту номер TCP-порта, соответствующего именованному экземпляру. Обычно служба « [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , браузер» запускается при использовании именованного экземпляра компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] . Если клиент настроен для соединения с именованным экземпляром по заданному порту, то службу « [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , браузер» запускать не обязательно.|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , работающий через конечную точку HTTP|Может указываться во время создания конечной точки HTTP. По умолчанию используется TCP-порт 80 для данных CLEAR_PORT и порт 443 для данных SSL_PORT.|Используется для HTTP-соединения по URL-адресу.|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] по умолчанию, работающий через конечную точку HTTPS|TCP-порт 443|Используется для HTTPS-соединения по URL-адресу. HTTPS представляет собой HTTP-соединение, защищенное по протоколу SSL.|  
|[!INCLUDE[ssSB](../../includes/sssb-md.md)]|TCP-порт 4022. Чтобы проверить используемый порт, выполните следующий запрос:<br /><br /> `SELECT name, protocol_desc, port, state_desc`<br /><br /> `FROM sys.tcp_endpoints`<br /><br /> `WHERE type_desc = 'SERVICE_BROKER'`|Для компонента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssSB](../../includes/sssb-md.md)]нет порта по умолчанию, но эта конфигурация принята в электронной документации для использования в примерах.|  
|Зеркальное отображение базы данных|Порт, выбранный администратором. Чтобы определить порт, выполните следующий запрос.<br /><br /> `SELECT name, protocol_desc, port, state_desc FROM sys.tcp_endpoints`<br /><br /> `WHERE type_desc = 'DATABASE_MIRRORING'`|Для зеркального отображения базы данных нет порта по умолчанию, однако в примерах электронной документации используется TCP-порт 7022. Очень важно избегать прерывания используемой конечной точки зеркального отображения, особенно в режиме высокой безопасности с автоматической отработкой отказа. Конфигурация брандмауэра должна избегать прерывания кворума. Дополнительные сведения см. в разделе [Указание сетевого адреса сервера (зеркальное отображение базы данных)](../../database-engine/database-mirroring/specify-a-server-network-address-database-mirroring.md).|  
|Репликация|Соединения с [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для репликации используют порты, которые обычно использует компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] (TCP-порт 1433 для экземпляра по умолчанию и т. д.)<br /><br /> Веб-синхронизация и доступ через FTP/UNC к моментальному снимку репликации потребуют открытия в брандмауэре других портов. Передачу начальных данных и схемы из одного места в другое репликация осуществляет по протоколу FTP (TCP-порт 21) либо с помощью синхронизации через HTTP (TCP-порт 80) или общего доступа к файлам. Для общего доступа к файлам используются UDP-порты 137 и 138 и TCP-порт 139 (если используется NetBIOS). Совместное использование файлов использует TCP-порт 445.|Для синхронизации по протоколу HTTP в репликации используется конечная точка IIS (порты которой являются настраиваемыми, но порт 80 применяется по умолчанию), однако процесс IIS подключается к серверу базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] через стандартные порты (1433 для экземпляра по умолчанию).<br /><br /> При веб-синхронизации через FTP-порт передача данных выполняется между службами IIS и издателем [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , а не между подписчиком и службами IIS.|  
|[!INCLUDE[tsql](../../includes/tsql-md.md)] отладчик|TCP-порт 135<br /><br /> См. раздел [Особые замечания относительно порта 135](#BKMK_port_135)<br /><br /> Также может потребоваться исключение [IPsec](#BKMK_additional_ports) .|При использовании среды [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)]на [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] главном компьютере в список исключений необходимо также добавить программу **Devenv.exe** и открыть TCP-порт 135.<br /><br /> При использовании среды [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]на [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] главном компьютере необходимо также добавить в список исключений программу **ssms.exe** и открыть TCP-порт 135. Дополнительные сведения см. [в разделе Настройка отладчика Transact-SQL](../../relational-databases/scripting/configure-firewall-rules-before-running-the-tsql-debugger.md).|  
  
 Пошаговые инструкции по настройке брандмауэра Windows для компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)]см. в разделе [Настройка брандмауэра Windows для доступа к компоненту Database Engine](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md).  
  
####  <a name="dynamic-ports"></a><a name="BKMK_dynamic_ports"></a> Динамические порты  
 По умолчанию именованные экземпляры (включая [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)]) используют динамические порты. Это означает, что при каждом запуске компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] находит доступный порт и занимает его. Если именованный экземпляр является единственным установленным экземпляром компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] , то, скорее всего, он будет использовать TCP-порт 1433. При установке других экземпляров компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] они будут использовать другие TCP-порты. Поскольку выбираемый порт может меняться при каждом запуске компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] , настроить брандмауэр для разрешения доступа к нужному порту сложно. Поэтому, если используется брандмауэр, рекомендуется настроить компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] на постоянное использование одного и того же порта. Такой порт называется фиксированным или статическим. Дополнительные сведения см. в разделе [Настройка сервера для прослушивания указанного TCP-порта (диспетчер конфигурации SQL Server)](../../database-engine/configure-windows/configure-a-server-to-listen-on-a-specific-tcp-port.md).  
  
 В качестве альтернативы настройке именованного экземпляра для прослушивания фиксированного порта можно создать в брандмауэре исключение для программы [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], например **sqlservr.exe** (для компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)]). Это хороший выход из положения, однако номер порта не будет отображаться в столбце **Локальный порт** на странице **Правила для входящих подключений** оснастки "Брандмауэр Windows в режиме повышенной безопасности". В результате аудит открытых портов станет сложнее. Еще один нюанс заключается в том, что при применении совокупного обновления или пакета обновления может измениться путь к исполняемому файлу [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , что сделает правило брандмауэра недействительным.  
  
> [!NOTE]  
>  Следующая процедура выполняется с помощью элемента **Брандмауэр Windows** на панели управления. В оснастке MMC «Брандмауэр Windows в режиме повышенной безопасности» поддерживается настройка дополнительных параметров брандмауэра. В их число входит настройка исключение службы, которая может оказаться полезной при обеспечении углубленной защиты. См. подраздел [Использование оснастки "Брандмауэр Windows в режиме повышенной безопасности"](#BKMK_WF_msc) ниже.  
  
###### <a name="to-add-a-program-exception-to-the-firewall-using-the-windows-firewall-item-in-control-panel"></a>Добавление в брандмауэр исключения для программы при помощи элемента «Брандмауэр Windows» на панели управления  
  
1.  На вкладке **Исключения** элемента **Брандмауэр Windows** на панели управления нажмите кнопку **Добавить программу**.  
  
2.  Перейдите в расположение экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , который вы хотите разрешить через брандмауэр, например **C:\PROGRAM Files\Microsoft SQL Server\MSSQL12. <instance_name> \MSSQL\Binn**, выберите **sqlservr.exe**и нажмите кнопку **Открыть**.  
  
3.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
 Дополнительные сведения о конечных точках см. в разделах [Настройка ядра СУБД на прослушивание нескольких портов TCP](../../database-engine/configure-windows/configure-the-database-engine-to-listen-on-multiple-tcp-ports.md) и [Представления каталога конечных точек (Transact-SQL)](/sql/relational-databases/system-catalog-views/endpoints-catalog-views-transact-sql).  
  
###  <a name="ports-used-by-analysis-services"></a><a name="BKMK_ssas"></a> Порты, используемые службами Analysis Services  
 В следующей таблице перечислены порты, обычно используемые службами [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].  
  
|Компонент|Порт|Комментарии|  
|-------------|----------|--------------|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]|TCP-порт 2383 для экземпляра по умолчанию|Стандартный порт для экземпляра служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]по умолчанию.|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Служба браузера|Для именованного экземпляра служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] необходим только TCP-порт 2382|Запросы клиентского соединения к именованному экземпляру служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] , в которых не указан номер порта, направляются на порт 2382, который прослушивает служба « [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , браузер». [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] затем перенаправляет запрос на порт, используемый запрошенным именованным экземпляром.|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] настроены для работы через протокол IIS/HTTP<br /><br /> (Сводная таблица?? Служба использует HTTP или HTTPS)|TCP-порт 80|Используется для HTTP-соединения по URL-адресу.|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] настроены для работы через протокол IIS/HTTPS<br /><br /> (Сводная таблица?? Служба использует HTTP или HTTPS)|TCP-порт 443|Используется для HTTPS-соединения по URL-адресу. HTTPS представляет собой HTTP-соединение, защищенное по протоколу SSL.|  
  
 Если пользователи производят доступ к службам [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] через Интернет и службы IIS, необходимо открыть порт, который прослушивают службы IIS, и указать этот порт в строке соединения клиента. В этом случае необязательно иметь открытые порты для прямого доступа к службам [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]. Необходимо ограничить доступ к порту по умолчанию 2389, порту 2382 и другим портам, которые не нужны для осуществления доступа.  
  
 Пошаговые инструкции по настройке брандмауэра Windows для компонента [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]см. в разделе [Настройка брандмауэра Windows на разрешение доступа к службам Analysis Services](../../../2014/analysis-services/instances/configure-the-windows-firewall-to-allow-analysis-services-access.md).  
  
###  <a name="ports-used-by-reporting-services"></a><a name="BKMK_ssrs"></a> Порты, используемые службами Reporting Services  
 В следующей таблице перечислены порты, обычно используемые службами [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)].  
  
|Компонент|Порт|Комментарии|  
|-------------|----------|--------------|  
|[!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] Веб-службы|TCP-порт 80|Используется для HTTP-соединения со службами [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] по URL-адресу. Не рекомендуется использовать стандартное правило **Службы Интернета (HTTP)** . Дополнительные сведения см. в разделе [Взаимодействие с другими правилами брандмауэра](#BKMK_other_rules) ниже.|  
|[!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] настроены для работы через протокол HTTPS|TCP-порт 443|Используется для HTTPS-соединения по URL-адресу. HTTPS представляет собой HTTP-соединение, защищенное по протоколу SSL. Не рекомендуется использовать стандартное правило **Защищенные службы Интернета (HTTPS)** . Дополнительные сведения см. в разделе [Взаимодействие с другими правилами брандмауэра](#BKMK_other_rules) ниже.|  
  
 Для соединения служб [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)] с экземпляром компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] или служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)]необходимо также открыть соответствующие порты для этих служб. Пошаговые инструкции по настройке брандмауэра Windows для компонента [!INCLUDE[ssRSnoversion](../../includes/ssrsnoversion-md.md)]см. в разделе [Настройка брандмауэра для доступа к серверу отчетов](../../reporting-services/report-server/configure-a-firewall-for-report-server-access.md).  
  
###  <a name="ports-used-by-integration-services"></a><a name="BKMK_ssis"></a> Порты, используемые службами Integration Services  
 В следующей таблице перечислены порты, используемые службой [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] .  
  
|Компонент|Порт|Комментарии|  
|-------------|----------|--------------|  
|[!INCLUDE[msCoName](../../includes/msconame-md.md)] удаленные вызовы процедур (MS RPC)<br /><br /> Используется средой выполнения служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] .|TCP-порт 135<br /><br /> См. раздел [Особые замечания относительно порта 135](#BKMK_port_135)|Служба [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] обращается к DCOM по порту 135. Диспетчер управления службами использует порт 135 для запуска и остановки службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , передачи управляющих запросов запущенной службе и выполнения других задач. Номер порта не может быть изменен.<br /><br /> Это единственный порт, который должен быть открыт при соединении с удаленным экземпляром службы [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] из среды [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] или прикладной программы.|  
  
 Пошаговые инструкции по настройке брандмауэра Windows для компонента [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]см. в разделе [Настройка параметров брандмауэра Windows для доступа к службам SSIS](../../../2014/integration-services/configure-a-windows-firewall-for-access-to-the-ssis-service.md).  
  
###  <a name="additional-ports-and-services"></a><a name="BKMK_additional_ports"></a> Другие порты и службы  
 В следующей таблице перечислены порты и службы, от которых может зависеть [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
|Сценарий|Порт|Комментарии|  
|--------------|----------|--------------|  
|Инструментарий управления Windows (WMI)<br /><br /> Дополнительные сведения о WMI см. в разделе [WMI Provider for Configuration Management Concepts](../../relational-databases/wmi-provider-configuration/wmi-provider-for-configuration-management.md)|Инструментарий WMI запускается в составе общего узла службы с назначением портов через DCOM. Инструментарий WMI может пользовать TCP-порт 135.<br /><br /> См. раздел [Особые замечания относительно порта 135](#BKMK_port_135)|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] использует инструментарий WMI для просмотра и управления службами. Рекомендуется использовать стандартную группу правил **Инструментарий управления Windows (WMI)** . Дополнительные сведения см. в разделе [Взаимодействие с другими правилами брандмауэра](#BKMK_other_rules) ниже.|  
|[!INCLUDE[msCoName](../../includes/msconame-md.md)] Координатор распределенных транзакций (Майкрософт) (MS DTC)|TCP-порт 135<br /><br /> См. раздел [Особые замечания относительно порта 135](#BKMK_port_135)|Если приложение использует распределенные транзакции, то может потребоваться настройка брандмауэра таким образом, чтобы разрешить передачу данных координатора распределенных транзакций ([!INCLUDE[msCoName](../../includes/msconame-md.md)]) (MS DTC) между отдельными экземплярами MS DTC и между MS DTC и диспетчерами ресурсов (например, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]). Рекомендуется использовать стандартную группу правил **Координатор распределенных транзакций** .<br /><br /> Если для всего кластера настроен единственный общий координатор MS DTC в отдельной группе ресурсов, следует добавить программу sqlservr.exe в список исключений брандмауэра.|  
|Кнопка обзора в среде [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] соединяется со службой [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], браузер по протоколу UDP. Дополнительные сведения см. в разделе [Служба обозревателя SQL Server (ядро СУБД и SSAS)](../../database-engine/configure-windows/sql-server-browser-service-database-engine-and-ssas.md).|UDP-порт 1434|Протокол UDP не сохраняет соединения.<br /><br /> Свойство [UnicastResponsesToMulticastBroadcastDisabled интерфейса INetFwProfile](https://go.microsoft.com/fwlink/?LinkId=118371) управляет работой брандмауэра по отношению к одноадресным ответам на широковещательные (или многоадресные) UDP-запросы.  Возможны два варианта.<br /><br /> Если этот параметр имеет значение TRUE, то одноадресные ответы на широковещательные запросы запрещены. Перечисление служб завершится ошибкой.<br /><br /> Если этот параметр имеет значение FALSE (по умолчанию), то одноадресные ответы разрешены в течение 3 секунд. Время ожидания не настраивается. Если сеть переполнена, каналы имеют задержки или сервер работает в режиме высокой нагрузки, то при построении списка экземпляров [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] список может быть возвращен лишь частично и ввести пользователя в заблуждение.|  
|Трафик по протоколу IPsec|UDP-порты 500 и 4500|Если политика домена требует выполнения сетевых соединения через протокол IPsec, необходимо добавить в список исключений UDP-порты 4500 и 500. Протокол IPsec можно включить с помощью **мастера создания правила для входящего подключения** в оснастке "Брандмауэр Windows". Дополнительные сведения см. в разделе [Использование оснастки "Брандмауэр Windows в режиме повышенной безопасности"](#BKMK_WF_msc) ниже.|  
|Использование проверки подлинности Windows в надежных доменах|Брандмауэр можно настроить для разрешения запросов проверки подлинности.|Дополнительные сведения см. в разделе [Настройка брандмауэра для работы с доменами и отношениями доверия](https://support.microsoft.com/kb/179442/).|  
|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и кластеризация Windows|Кластеризация требует открытия дополнительных портов, не связанных с [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]напрямую.|Дополнительные сведения см. в разделе [Подготовка сети для работы кластера](https://go.microsoft.com/fwlink/?LinkId=118372).|  
|Пространства имен URL-адресов, зарезервированные в компоненте HTTP.SYS|Обычно TCP-порт 80, однако можно настроить для использования любого другого порта. Общие сведения см. в разделе [Настройка протоколов HTTP и HTTPS](https://go.microsoft.com/fwlink/?LinkId=118373).|Сведения о резервировании конечной точки компонента HTTP.SYS с помощью программы HttpCfg.exe, относящиеся к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], см. в разделе [Сведения о резервировании и регистрации URL-адресов (диспетчер конфигурации служб SSRS)](../../reporting-services/install-windows/about-url-reservations-and-registration-ssrs-configuration-manager.md).|  
  
##  <a name="special-considerations-for-port-135"></a><a name="BKMK_port_135"></a> Особые замечания относительно порта 135  
 При использовании в качестве транспортного протокола RPC через TCP/IP или UDP/IP входящие порты для системных служб часто выделяются динамически с номерами выше 1024. Иногда их называют «случайными RPC-портами». В этом случае RPC-клиент определяет порт, назначенный серверу, через модуль конечной точки RPC. Для некоторых служб, работающих через протокол RPC, можно настроить использование определенного фиксированного порта. Можно также ограничить диапазон портов, которые могут быть динамически назначены службой RPC независимо от службы. Поскольку порт 135 используется для многих служб, он часто подвергается атакам злоумышленников. В случае открытия порта 135 рекомендуется ограничить область действия правила брандмауэра.  
  
 Дополнительные сведения о порте 135 см. в следующих ресурсах.  
  
-   [Общие сведения о службе и требования к сетевым портам в системе Windows Server](https://support.microsoft.com/kb/832017)  
  
-   [Устранение неполадок модуля сопоставления конечной точки RPC при помощи средств поддержки, устанавливаемых с компакт-диска Windows Server 2003](https://support.microsoft.com/kb/839880)  
  
-   [Удаленный вызов процедур (RPC)](https://go.microsoft.com/fwlink/?LinkId=118375)  
  
-   [Настройка динамического выделения портов RPC для работы с брандмауэром](https://support.microsoft.com/kb/154596/)  
  
##  <a name="interaction-with-other-firewall-rules"></a><a name="BKMK_other_rules"></a> Взаимодействие с другими правилами брандмауэра  
 Настройка брандмауэра Windows производится на основе правил и групп правил. Каждое правило или группа правил обычно связаны с определенной программой или службой, которая может изменить или удалить это правило без участия пользователя. Например, группы правил **Службы Интернета (HTTP)** и **Защищенные службы Интернета (HTTPS)** связаны со службами IIS. При включении этих правил будут открыты порты 80 и 443 и разрешены функции [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , зависящие от этих портов. Однако администратор в процессе настройки служб IIS может изменить или отключить эти правила. Поэтому, если [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]использует порт 80 или 443, необходимо создать собственное правило или группу правил для поддержки необходимой конфигурации портов, не зависящей от служб IIS.  
  
 Оснастка «Брандмауэр Windows в режиме повышенной безопасности» пропускает весь трафик, соответствующий применимым разрешающим правилам. Если существует два правила для порта 80 (но с разными параметрами), будет разрешен любой трафик, соответствующий хотя бы одному из этих правил. Таким образом, если одно правило разрешает трафик по порту 80 из локальной подсети, а второе разрешает трафик с любого адреса, то будет разрешен любой трафик по порту 80, независимо от его источника. Чтобы обеспечить эффективное управление доступом к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], администратор должен периодически проверять все правила брандмауэра, разрешенные на сервере.  
  
##  <a name="overview-of-firewall-profiles"></a><a name="BKMK_profiles"></a> Общие сведения о профилях брандмауэра  
 Профили брандмауэра рассматриваются в разделе [Руководство по началу работы с брандмауэром Windows в режиме повышенной безопасности](https://go.microsoft.com/fwlink/?LinkId=116080) в подразделе **Брандмауэр узла, привязанный к местонахождению в сети**. Подводя итоги, операционная система определяет и запоминает каждую из сетей, к которым осуществлялось подключение, по обмену данными, соединениям и категории.  
  
 Брандмауэр Windows в режиме повышенной безопасности делит сети на три типа.  
  
-   Домен. Windows может выполнить проверку подлинности доступа к контроллеру домена, в который включен компьютер.  
  
-   Общедоступный. В эту категорию первоначально попадают все сети, не входящие в домены. Сети, которые представляют прямые соединения с Интернетом, являются открытыми (аэропорты, кафе и другие места открытого доступа).  
  
-   Закрытый. Сеть, определенная пользователем или приложением как личная. Только доверенные сети могут быть определены как частные. Обычно в качестве частной сети определяется сеть малого предприятия, домашняя сеть и т. п.  
  
 Администратор может создать профиль для каждого типа сети и задать для этих профилей разные политики брандмауэра. Одномоментно применим только один профиль. Профили применяются в следующем порядке.  
  
1.  Если все интерфейсы прошли проверку подлинности к контроллеру домена, членом которого является компьютер, то применяется профиль домена.  
  
2.  Если все интерфейсы либо прошли проверку подлинности к контроллеру домена, либо соединены с сетями, которые определены как частные, применяется частный профиль.  
  
3.  В противном случае применяется открытый профиль.  
  
 Просмотреть и настроить профили брандмауэра можно с помощью оснастки «Брандмауэр Windows в режиме повышенной безопасности». Элемент **Брандмауэр Windows** на панели управления позволяет настраивать только текущий профиль.  
  
##  <a name="additional-firewall-settings-using-the-windows-firewall-item-in-control-panel"></a><a name="BKMK_additional_settings"></a> Дополнительные параметры брандмауэра в элементе «Брандмауэр Windows» на панели управления  
 Исключения, добавляемые в брандмауэр, могут ограничить открытие портов для входящих соединений с определенных компьютеров или из локальной подсети. Метод ограничения области действия открытия портов способен сократить зону уязвимости компьютера, и поэтому рекомендуется к применению.  
  
> [!NOTE]  
>  Элемент **Брандмауэр Windows** на панели управления позволяет настроить только текущий профиль.  
  
#### <a name="to-change-the-scope-of-a-firewall-exception-using-the-windows-firewall-item-in-control-panel"></a>Изменение области действия исключения брандмауэра с помощью «Брандмауэра Windows» на панели управления  
  
1.  В элементе **Брандмауэр Windows** на панели управления выберите программу или порт на вкладке **Исключения** и нажмите кнопку **Свойства** или **Изменить**.  
  
2.  В диалоговом окне **Изменение программы** или **Изменение порта** нажмите кнопку **Изменить область**.  
  
3.  Выберите один из следующих параметров.  
  
    -   **Любой компьютер (включая Интернет)**  
  
         Не рекомендуется. В этом режиме любой компьютер, который имеет доступ к данному узлу, сможет подключиться к программе или порту. Этот параметр может пригодиться для передачи данных анонимным пользователям Интернета, однако он повышает уязвимость компьютера. Уязвимость еще более повысится, если одновременно с этим параметром разрешить просмотр трансляции сетевых адресов (например при помощи параметра «Разрешить просмотр узлов»).  
  
    -   **Только моя сеть (подсеть)**  
  
         Это более безопасный режим, чем **Любой компьютер**. Только компьютеры локальной подсети могут производить соединение с программой или портом.  
  
    -   **Особый список.**  
  
     Соединение разрешено только компьютерам, имеющим перечисленные IP-адреса. Это еще более безопасный режим, чем **Только локальная сеть (подсеть)** , хотя у клиентского компьютера, использующего DHCP, может измениться IP-адрес. После этого он уже не сможет установить соединение. Другой компьютер, которому доступ не предоставлялся, может получить перечисленный в списке IP-адрес, что позволит ему установить соединение. Параметр **Особый список** может пригодиться для хранения списка серверов, настроенных для использования фиксированного IP-адреса, однако эти адреса могут быть перехвачены злоумышленником. Эффект ограничения правил брандмауэра напрямую зависит от уровня защиты сетевой инфраструктуры.  
  
##  <a name="using-the-windows-firewall-with-advanced-security-snap-in"></a><a name="BKMK_WF_msc"></a> Использование оснастки «Брандмауэр Windows в режиме повышенной безопасности»  
 Дополнительные параметры брандмауэра можно настроить при помощи оснастки «Брандмауэр Windows в режиме повышенной безопасности». Эта оснастка включает в себя мастер правил и дает доступ к дополнительным параметрам, которые недоступны через элемент **Брандмауэр Windows** на панели управления. В их число входят следующие параметры.  
  
-   Параметры шифрования.  
  
-   Ограничения служб.  
  
-   Ограничение соединений для компьютеров по именам.  
  
-   Ограничение соединений для определенных пользователей или профилей.  
  
-   Разрешение просмотра узлов для исключения маршрутизаторов NAT.  
  
-   Настройка правил исходящих соединений.  
  
-   Настройка правил безопасности.  
  
-   Требование протокола IPsec для входящих соединений.  
  
#### <a name="to-create-a-new-firewall-rule-using-the-new-rule-wizard"></a>Создание правила брандмауэра при помощи мастера создания правил  
  
1.  В меню Пуск выберите команду **Выполнить**, введите **WF.msc**и нажмите кнопку **ОК**.  
  
2.  В левой части панели **Брандмауэр Windows в режиме повышенной безопасности**щелкните правой кнопкой мыши элемент **Правила для входящих подключений**и выберите пункт **Создать правило**.  
  
3.  Завершите **мастер создания правила для нового входящего подключения** , задав все необходимые параметры.  
  
##  <a name="troubleshooting-firewall-settings"></a><a name="BKMK_troubleshooting"></a> Устранение неполадок настройки брандмауэра  
 Следующие средства и методы могут оказаться полезными при устранении неполадок брандмауэра.  
  
-   Действующее состояние порта является объединением всех правил, связанных с этим портом. Чтобы заблокировать доступ к порту, бывает полезно просмотреть все правила, в которых он упоминается. Чтобы сделать это, откройте оснастку «Брандмауэр Windows в режиме повышенной безопасности» и отсортируйте правила по номеру порта.  
  
-   Просмотрите порты, которые активны на компьютере, где запущен [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . В процессе анализа необходимо проверить, на каких TCP/IP-портах осуществляется прослушивание, а также проверить состояние этих портов.  
  
     Чтобы проверить, на каких портах осуществляется прослушивание, используйте служебную программу командной строки **netstat** . Помимо активных TCP-подключений, служебная программа **netstat** также отображает различную статистику и другие сведения о протоколе IP.  
  
    #### <a name="to-list-which-tcpip-ports-are-listening"></a>Получение списка прослушиваемых TCP/IP-портов  
  
    1.  Откройте окно командной строки.  
  
    2.  В командной строке введите `netstat -n -a`.  
  
         При наличии параметра **-n** служебная программа **netstat** выводит адреса и номера портов активных подключений TCP в числовом виде. При наличии параметра **-a** служебная программа **netstat** выводит порты TCP и UDP, которые прослушиваются компьютером.  
  
-   Служебную программу **PortQry** можно использовать для вывода состояния портов TCP/IP (прослушивается, не прослушивается, фильтруется). В состоянии фильтрации порт может либо прослушиваться, либо не прослушиваться. Это состояние указывает, что программа не получила ответа от порта. Служебную программу **PortQry** можно скачать из [Центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=17148).  
  
## <a name="see-also"></a>См. также:  
 [Обзор служб и требования к сетевым портам в Windows](https://support.microsoft.com/kb/832017)  
